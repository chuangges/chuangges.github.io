<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Vue3 项目开发</title>
    <url>/2023/03/02/22-vue3%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="一、开发技术"><a href="#一、开发技术" class="headerlink" title="一、开发技术"></a>一、开发技术</h1><h2 id="项目构建"><a href="#项目构建" class="headerlink" title="项目构建"></a>项目构建</h2><ul>
<li><code>Vite</code>：开发环境时可快速冷启动，基于 esbuild 预构建依赖而无需分析模块依赖和编译代码，浏览器请求模块时才会进行按需动态编译，但是打包到生产环境时需要通过 rollup。</li>
<li><code>Webpack</code>：启动后从入口开始逐步进行语法解析、依赖收集、代码转译、打包合并、代码优化等一系列操作，最终将高版本的、离散的源码编译打包成低版本、高兼容的代码。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、vue3 + vite：官方推荐</span></span><br><span class="line">npm init vue@latest</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、vite：基于 vite 小而巧的打包方案，可选择 vue/react</span></span><br><span class="line">npm init vite@latest</span><br><span class="line">pnpm create vite</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、vue-cli3：基于 webpack 大而全的打包工具</span></span><br><span class="line">npm install -g @vue/cli</span><br><span class="line">vue create &lt;name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弃用命令</span></span><br><span class="line">npm init vite-app &lt;name&gt;    <span class="comment">// vite1.x</span></span><br><span class="line">npm init @vitejs/app        <span class="comment">// vite2.x</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 项目运行：通过 main.js 将 App.vue 渲染到 index.html 的指定区域</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> App.vue：编写待渲染模板的项目根组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> index.html：预留一个 el 区域的唯一 HTML</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> main.js：将模版渲染到预留区域的打包入口文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> Vscode 插件防止红线：Volar、Vue3 Snippets、TypeScript Vue Plugin</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">============================== axios ================================</span><br><span class="line"><span class="comment">// main.js：全局方式一</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$axios</span> = axios;</span><br><span class="line"><span class="comment">// 组件引用</span></span><br><span class="line"><span class="keyword">import</span> &#123; getCurrentInstance &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; proxy &#125; = <span class="title function_">getCurrentInstance</span>()</span><br><span class="line">proxy.$axios(&#123; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js：全局方式二</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line">app.<span class="title function_">provide</span>(<span class="string">&#x27;$axios&#x27;</span>, axios)</span><br><span class="line"><span class="comment">// 组件引用</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> $axios = <span class="title function_">inject</span>(<span class="string">&#x27;$axios&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// axios 封装：npm i axios element-plus -D</span></span><br><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosError</span>, <span class="title class_">AxiosRequestConfig</span>, </span><br><span class="line"><span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line">interface <span class="title class_">Result</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: number; </span><br><span class="line">    <span class="attr">msg</span>: string</span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">ResultData</span>&lt;T = any&gt; <span class="keyword">extends</span> <span class="title class_">Result</span> &#123;  <span class="comment">// 请求响应参数</span></span><br><span class="line">    data?: T;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">URL</span>: string = <span class="string">&#x27;&#x27;</span></span><br><span class="line">enum <span class="title class_">RequestEnums</span> &#123;</span><br><span class="line">    <span class="variable constant_">TIMEOUT</span> = <span class="number">20000</span>,    <span class="comment">// 请求超时</span></span><br><span class="line">    <span class="variable constant_">OVERDUE</span> = <span class="number">600</span>,      <span class="comment">// 登录失效</span></span><br><span class="line">    <span class="variable constant_">FAIL</span> = <span class="number">999</span>,         <span class="comment">// 请求失败</span></span><br><span class="line">    <span class="variable constant_">SUCCESS</span> = <span class="number">200</span>       <span class="comment">// 请求成功</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="attr">baseURL</span>: <span class="variable constant_">URL</span> <span class="keyword">as</span> string,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="title class_">RequestEnums</span>.<span class="property">TIMEOUT</span> <span class="keyword">as</span> number,</span><br><span class="line">    <span class="attr">withCredentials</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RequestHttp</span> &#123;</span><br><span class="line">    <span class="attr">service</span>: <span class="title class_">AxiosInstance</span>;</span><br><span class="line">    public <span class="title function_">constructor</span>(<span class="params">config: AxiosRequestConfig</span>) &#123;</span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">service</span> = axios.<span class="title function_">create</span>(config);</span><br><span class="line">         <span class="comment">// 请求拦截器</span></span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">service</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">             <span class="function">(<span class="params">config: AxiosRequestConfig</span>) =&gt;</span> &#123;</span><br><span class="line">                 <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>) || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                 <span class="keyword">return</span> &#123;</span><br><span class="line">                     ...config,</span><br><span class="line">                     <span class="attr">headers</span>: &#123; <span class="string">&#x27;x-access-token&#x27;</span>: token &#125;</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;,</span><br><span class="line">             <span class="function">(<span class="params">error: AxiosError</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">             &#125;</span><br><span class="line">         )</span><br><span class="line">         <span class="comment">// 请求拦截器</span></span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">service</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">            <span class="function">(<span class="params">response: AxiosResponse</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123;data, config&#125; = response;</span><br><span class="line">                <span class="comment">// 登录信息失效，则跳转到登录页面并清空本地 token</span></span><br><span class="line">                <span class="keyword">if</span> (data.<span class="property">code</span> === <span class="title class_">RequestEnums</span>.<span class="property">OVERDUE</span>) &#123;</span><br><span class="line">                    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(data);</span><br><span class="line">                &#125;</span><br><span class="line">                 <span class="comment">// 全局错误：防止下载文件时返回数据流则直接报错而没有 code</span></span><br><span class="line">                 <span class="keyword">if</span> (data.<span class="property">code</span> &amp;&amp; data.<span class="property">code</span> !== <span class="title class_">RequestEnums</span>.<span class="property">SUCCESS</span>) &#123;</span><br><span class="line">                     <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(data);</span><br><span class="line">                     <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(data)</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">return</span> data;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function">(<span class="params">error: AxiosError</span>) =&gt;</span> &#123;</span><br><span class="line">                 <span class="keyword">const</span> &#123;response&#125; = error;</span><br><span class="line">                 <span class="keyword">if</span> (response) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">handleCode</span>(response.<span class="property">status</span>)</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">onLine</span>) &#123;</span><br><span class="line">                    <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;网络连接失败&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">handleCode</span>(<span class="attr">code</span>: number):<span class="keyword">void</span> &#123;</span><br><span class="line">       <span class="keyword">switch</span>(code) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">             <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;登录失败，请重新登录&#x27;</span>);</span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">          <span class="attr">default</span>:</span><br><span class="line">             <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败&#x27;</span>);</span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 常用方法封装</span></span><br><span class="line">    get&lt;T&gt;(<span class="attr">url</span>: string, params?: object): <span class="title class_">Promise</span>&lt;<span class="title class_">ResultData</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">get</span>(url, &#123;params&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    post&lt;T&gt;(<span class="attr">url</span>: string, params?: object): <span class="title class_">Promise</span>&lt;<span class="title class_">ResultData</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">post</span>(url, params);</span><br><span class="line">    &#125;</span><br><span class="line">    put&lt;T&gt;(<span class="attr">url</span>: string, params?: object): <span class="title class_">Promise</span>&lt;<span class="title class_">ResultData</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">put</span>(url, params);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span>&lt;T&gt;(<span class="attr">url</span>: string, params?: object): <span class="title class_">Promise</span>&lt;<span class="title class_">ResultData</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">delete</span>(url, &#123;params&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">RequestHttp</span>(config);</span><br></pre></td></tr></table></figure>


<h2 id="版本优化"><a href="#版本优化" class="headerlink" title="版本优化"></a>版本优化</h2><ul>
<li><strong>功能特性</strong>：废弃了过滤器功能、$on&#x2F;$emit&#x2F;$off&#x2F;$once 等实例方法、支持多根节点组件和 TypeScript、新增组合式API 而取代了选项式API。</li>
<li><strong>响应式系统</strong>：<code>Proxy + Reflect</code> 取代 Object.definepeoperty() 而实现直接监听对象和数组而非属性，Proxy 返回的新对象可以直接操作而不需要每次都遍历对象属性。</li>
<li><strong>生命周期</strong>：<code>setup</code> 创建实例前、<code>onBeforeMount、onMounted</code> 挂载前后、<code>onBeforeUpdate、onUpdated</code> 更新前后、<code>onBeforeUnmount、onUnmounted</code> 卸载前后。</li>
</ul>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// Composition 组合式：内部会将多个标签包含到 Fragment，有利于代码管理和类型推导</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; counter &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrCounter&quot;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> counter = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> incrCounter = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        counter.<span class="property">value</span> += <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// Vue2 Options 选项式：适用于简单项目</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; counter &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrCounter&quot;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">incrCounter</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">counter</span> += <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Proxy：对读取和设置等对象操作拦截并在前后注入自定义逻辑的代理器。</span></span><br><span class="line"><span class="comment">// Reflect：提供了一组对象操作方法的反射器，一个 window 内置对象。</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;Jack&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;</span><br><span class="line"><span class="keyword">let</span> objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> target[property]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, newValue</span>) &#123;</span><br><span class="line">        target[property] = newValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> _objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">has</span>(<span class="params">target, name</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">has</span>(target, name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, newValue</span>) &#123;</span><br><span class="line">        <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">apply</span>(<span class="params">targetFn, thisArg, ...args</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">apply</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">defineProperty</span>(<span class="params">target, property, discriptor</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">defineProperty</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(target, prop)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">objProxy.<span class="property">age</span> = <span class="number">30</span>;   <span class="comment">// obj.age：30</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">apply</span>(<span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>, <span class="string">&#x27;str&#x27;</span>, [<span class="number">0</span>, <span class="number">3</span>])</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// reactive：创建响应式对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = &#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params">target, key, receiver</span>)&#123;</span><br><span class="line">            <span class="title function_">track</span>(target, key)</span><br><span class="line">            <span class="keyword">const</span> value = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">reactive</span>(value)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">target, key, val, receiver</span>)&#123;</span><br><span class="line">            <span class="title function_">trigger</span>(target, key, val)</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, handler)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target, key</span>)&#123; &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key, value</span>)&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ref：将普通值包装包装为一个响应式对象，通过 get/set 实现依赖收集和更新</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ref</span>(<span class="params">value</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RefImpl</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RefImpl</span> &#123;</span><br><span class="line">    private _value = <span class="literal">null</span>;</span><br><span class="line">    private __v_isRef = <span class="literal">true</span>;</span><br><span class="line">    private dep = <span class="literal">null</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">public rawValue</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_value</span> = <span class="title function_">isObject</span>(rawValue) ? <span class="title function_">reactive</span>(rawValue): rawValue</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">value</span>()&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeEffect) &#123;</span><br><span class="line">            <span class="title function_">trackEffects</span>(<span class="variable language_">this</span>.<span class="property">dep</span> ||(<span class="variable language_">this</span>.<span class="property">dep</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newValue</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue !== <span class="variable language_">this</span>.<span class="property">rawValue</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_value</span> = <span class="title function_">toReactive</span>(newValue)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">rawValue</span> = newValue</span><br><span class="line">            <span class="title function_">triggerEffects</span>(<span class="variable language_">this</span>.<span class="property">dep</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// toRef：解析 proxy 对象而对单个属性形成响应式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">toRef</span>(<span class="params">object,key</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ObjectRefImpl</span>(object,key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectRefImpl</span>&#123;</span><br><span class="line">    private __v_isRef = <span class="literal">true</span>;</span><br><span class="line">    private _value = <span class="literal">null</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">public object, public key</span>)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">object</span>[<span class="variable language_">this</span>.<span class="property">key</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">object</span>[<span class="variable language_">this</span>.<span class="property">key</span>] = newValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 创建响应式对象 API</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> ref：将任意数据转为响应式对象，对象值更新时视图会自动更新 (复制)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> toRef：将对象属性转为响应式，更新时修改原对象但视图不更新 (引用)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> toRefs：遍历对象属性并调用 toRef，用于将整个对象转化成响应式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> reactive：将一个对象或数组转换为响应式，注意不可传入原始数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> defineComponent：用于编辑器在 ts 环境的类型推导而进行语法提示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> isRef、isReactive、isReadonly、isProxy：判定数据是否响应式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> customRef：自定义一个 ref 并对依赖项跟踪和更新触发进行显式控制</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, ref, reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;HomeView&#x27;</span>,</span><br><span class="line">    setup () &#123;</span><br><span class="line">        <span class="comment">// dom 元素：&lt;span ref=&quot;span&quot;&gt;名称&lt;/span&gt;</span></span><br><span class="line">        <span class="keyword">let</span> span = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            span.<span class="property">value</span>.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 响应式变量</span></span><br><span class="line">        <span class="keyword">let</span> msg = <span class="title function_">ref</span>(<span class="string">&#x27;msg&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isRef</span>(msg))  <span class="comment">// true  </span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">changeMsg</span> () &#123;</span><br><span class="line">            msg.<span class="property">value</span>.<span class="property">msg</span> = <span class="string">&#x27;new msg&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&quot;小明&quot;</span>, <span class="attr">age</span>: <span class="number">10</span> &#125;</span><br><span class="line">        <span class="keyword">let</span> _msg = <span class="title function_">toRef</span>(person, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">_changeMsg</span> () &#123;</span><br><span class="line">            _msg.<span class="property">value</span>.<span class="property">msg</span> = <span class="string">&#x27;new msg&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> info = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;小明&quot;</span>, <span class="attr">age</span>: <span class="number">10</span> &#125;)</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">changeAge</span> () &#123;</span><br><span class="line">            info.<span class="property">age</span>++</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">watch</span>(msg, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// 自定义 ref</span></span><br><span class="line">        <span class="keyword">const</span> text = <span class="title function_">useDebouncedRef</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            msg,</span><br><span class="line">            changeMsg,</span><br><span class="line">            ...<span class="title function_">toRefs</span>(info),</span><br><span class="line">            changeAge</span><br><span class="line">            nameRef</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; customRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useDebouncedRef</span> (value, delay = <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timeout</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">customRef</span>(<span class="function">(<span class="params">track, trigger</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            get () &#123;</span><br><span class="line">                <span class="title function_">track</span>()</span><br><span class="line">                <span class="keyword">return</span> value</span><br><span class="line">            &#125;,</span><br><span class="line">            set (newValue) &#123;</span><br><span class="line">                <span class="built_in">clearTimeout</span>(timeout)</span><br><span class="line">                timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    value = newValue</span><br><span class="line">                    <span class="title function_">trigger</span>()</span><br><span class="line">                &#125;, delay)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CSS-样式"><a href="#CSS-样式" class="headerlink" title="CSS 样式"></a>CSS 样式</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span>  Vue3 特性：变量、模块化 scoped module、选择器、绑定变量</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span>  样式穿透：css &gt;&gt;&gt;、scss :deep、废弃选择器 /deep/ ::v-deep</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span>  Scss 预处理：pnpm add sass、vite.config.js、&lt;style lang=&quot;scss&quot;&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span>  TailwindCSS 原子化框架：</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">:root &#123; --bg-<span class="attr">color</span>: #<span class="number">666</span>; &#125;</span><br><span class="line">.<span class="property">wrap</span> &#123; --<span class="attr">color</span>: blue; &#125;</span><br><span class="line">:<span class="title function_">global</span>(<span class="params">.red</span>) &#123; &#125;             <span class="comment">// 全局选择器</span></span><br><span class="line">.<span class="property">box</span> :<span class="title function_">deep</span>(<span class="params">.item</span>) &#123; &#125;         <span class="comment">// 深度选择器：影响子组件</span></span><br><span class="line">:<span class="title function_">slotted</span>(<span class="params">.red</span>) &#123; &#125;            <span class="comment">// 插槽选择器：影响 slot</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vite.config.js：自动引入全局 scss</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">css</span>: &#123; <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">        <span class="attr">scss</span>: &#123; <span class="attr">additionalData</span>: <span class="string">&#x27;@import &quot;./src/styles/global.scss&quot;&#x27;</span> &#125;</span><br><span class="line">    &#125;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Scoped CSS：VueLoader 默认的模块化方案，为元素增加唯一属性 data-v-hash</span></span><br><span class="line">&lt;style scoped&gt;   </span><br><span class="line">    .<span class="property">item</span> &#123; </span><br><span class="line">        <span class="attr">color</span>: <span class="title function_">var</span>(--color);             <span class="comment">// 局部变量</span></span><br><span class="line">        <span class="attr">background</span>: <span class="title function_">var</span>(--bg-color);     <span class="comment">// 全局变量</span></span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css module：Scoped 替代方案，通过 config 命名规则生成唯一类名实现作用域隔离</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; useCssModule &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 不传递参数，获取 style module 代码块编译后的 css 类对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> style = <span class="title function_">useCssModule</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 传递参数 content，获取 &lt;style module=&quot;content&quot;&gt; 代码块编译后的 css 类对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> contentStyle = <span class="title function_">useCssModule</span>(<span class="string">&#x27;content&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;$style.red&quot;</span>&gt;</span>默认 CssModule pink<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;style.success&quot;</span>&gt;</span>默认 CssModule pink<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;contentStyle.success&quot;</span>&gt;</span>具名 CssModule blue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;content.success&quot;</span>&gt;</span>具名 CssModule blue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">module</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.red</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">color</span>: pink;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">module</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.success</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">color</span>: blue;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// 动态样式实现主题切换</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> theme = <span class="title function_">reactive</span>(&#123;&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">setWhiteTheme</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      theme.<span class="property">color</span> = <span class="string">&#x27;#000&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      theme.<span class="property">backgroundColor</span> = <span class="string">&#x27;#fff&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">setBlackTheme</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      theme.<span class="property">color</span> = <span class="string">&#x27;#fff&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      theme.<span class="property">backgroundColor</span> = <span class="string">&#x27;#000&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.content</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">color</span>: <span class="built_in">v-bind</span>(<span class="string">&#x27;theme.color&#x27;</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">background</span>: <span class="built_in">v-bind</span>(<span class="string">&#x27;theme.backgroundColor&#x27;</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



<h2 id="Pinia-状态"><a href="#Pinia-状态" class="headerlink" title="Pinia 状态"></a>Pinia 状态</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 取代 Vuex 的新一代官方状态管理器、npm i pinia -S</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  store 支持多个、mutations 舍弃，actions 支持同步和异步修改 state</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line">app.<span class="title function_">use</span>(pinia)</span><br><span class="line"></span><br><span class="line"><span class="comment">// store/count.js：返回函数使用 useX，定义模式分为选项式和组合式</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> useCounter = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;),</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="attr">doubleCount</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="title function_">increment</span>(<span class="params">num</span>) &#123; <span class="variable language_">this</span>.<span class="property">count</span> += num &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> useCounter = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> count = ref&lt;number&gt;(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params">num</span>) &#123;</span><br><span class="line">        count.<span class="property">value</span> += num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">doubleCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> count.<span class="property">value</span> * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; count, increment, doubleCount &#125;;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCounter</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件调用</span></span><br><span class="line"><span class="keyword">import</span> &#123; useCounter &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">const</span> countStore = <span class="title function_">useCounter</span>()</span><br><span class="line"><span class="keyword">const</span> &#123; count &#125; = <span class="title function_">storeToRefs</span>(countStore)</span><br><span class="line"><span class="keyword">const</span> &#123; count &#125; = countStore  <span class="comment">// 会丢失数据响应式的错误写法</span></span><br><span class="line">countStore.<span class="property">count</span> = <span class="number">10</span>         <span class="comment">// 直接修改：不推荐</span></span><br><span class="line">countStore.<span class="title function_">increment</span>(<span class="number">1</span>)       <span class="comment">// 推荐修改</span></span><br><span class="line">countStore.$patch(<span class="function"><span class="params">state</span> =&gt;</span> &#123;  <span class="comment">// 批量修改</span></span><br><span class="line">    state.<span class="property">count</span>++</span><br><span class="line">&#125;)</span><br><span class="line">countStore.$reset()           <span class="comment">// 重置 state</span></span><br></pre></td></tr></table></figure>


<h2 id="VueUse-工具"><a href="#VueUse-工具" class="headerlink" title="VueUse 工具"></a>VueUse 工具</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 类似 React Hooks 的组合式函数工具集、npm i <span class="doctag">@vueuse</span>/core</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Animation：包含易于使用的过渡、超时和计时功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Browser：可用于不同的屏幕控制、剪贴板、偏好等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Component：提供了不同组件方法的简写</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Formatters：提供响应时间格式化功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Sensors：用来监听不同的DOM事件、输入事件和网络事件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> State：管理用户状态（全局、本地存储、会话存储）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Utility：不同的实用函数，如 getter、条件、引用同步等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Watch：高级观察器，如可暂停的、退避的观察器和条件观察器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Misc：不同类型的事件、WebSockets、WebWorker 的功能</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">import</span> &#123; useMouse, useCounter &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span>;</span><br><span class="line"><span class="comment">// useMouse：鼠标位置</span></span><br><span class="line"><span class="keyword">const</span> &#123; x, y &#125; = <span class="title function_">useMouse</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;page&#x27;</span>,</span><br><span class="line">    <span class="attr">touch</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">resetOnTouchEnds</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">initialValue</span>: &#123; <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span> &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 基本计数器</span></span><br><span class="line"><span class="keyword">const</span> &#123; count, inc, dec, set, reset &#125; = <span class="title function_">useCounter</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// 响应式本地化存储</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">useStorage</span>(<span class="string">&#x27;my-count&#x27;</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">useLocalStorage</span>(<span class="string">&#x27;my-lol&#x27;</span>, &#123; <span class="attr">name</span>: <span class="string">&#x27;泰达&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;战士&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleReset</span> = (<span class="params"></span>) =&gt; &#123; state.<span class="property">value</span> = <span class="literal">null</span> &#125;</span><br><span class="line"><span class="comment">// 防抖</span></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> debouncedFn = <span class="title function_">useDebounceFn</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    counter.<span class="property">value</span> += <span class="number">1</span></span><br><span class="line">&#125;, <span class="number">1000</span>, &#123; <span class="attr">maxWait</span>: <span class="number">5000</span> &#125;)</span><br><span class="line"><span class="comment">// 剪切</span></span><br><span class="line"><span class="keyword">const</span> source = <span class="title function_">ref</span>(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; text, copy, copied, isSupported &#125; = <span class="title function_">useClipboard</span>(&#123; source &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义封装 Hooks</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useRequest</span>(<span class="params">api</span>) &#123;        <span class="comment">// 统一管理网络请求相关状态</span></span><br><span class="line">    <span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> error = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fetchResource</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line">        loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">api</span>(params).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            result.<span class="property">value</span> = data</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            error.<span class="property">value</span> = e</span><br><span class="line">        &#125;).<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; loading, error, result, fetchResource &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bus = <span class="keyword">new</span> <span class="title class_">EventBus</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useEventBus</span>(<span class="params"></span>) &#123;   <span class="comment">// 组件卸载时自动取消监听事件</span></span><br><span class="line">    <span class="keyword">let</span> instance = &#123;</span><br><span class="line">        <span class="attr">eventMap</span>: <span class="keyword">new</span> <span class="title class_">Map</span>(),</span><br><span class="line">        <span class="attr">on</span>: bus.<span class="property">on</span>,</span><br><span class="line">        <span class="attr">once</span>: bus.<span class="property">once</span>,</span><br><span class="line">        <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">eventMap</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">list, key</span>) =&gt;</span> &#123;</span><br><span class="line">                list.<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">                    bus.<span class="title function_">off</span>(key, cb)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            eventMap.<span class="title function_">clear</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> eventMap = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">on</span> = (<span class="params">key, cb</span>) =&gt; &#123;</span><br><span class="line">        instance.<span class="title function_">on</span>(key, cb)</span><br><span class="line">        bus.<span class="title function_">on</span>(key, cb)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">once</span> = (<span class="params">key, cb</span>) =&gt; &#123;</span><br><span class="line">        instance.<span class="title function_">once</span>(key, cb)</span><br><span class="line">        bus.<span class="title function_">once</span>(key, cb)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        instance.<span class="title function_">clear</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        on,</span><br><span class="line">        once,</span><br><span class="line">        <span class="attr">off</span>: bus.<span class="property">off</span>.<span class="title function_">bind</span>(bus),</span><br><span class="line">        <span class="attr">emit</span>: bus.<span class="property">emit</span>.<span class="title function_">bind</span>(bus)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useModel</span>(<span class="params">hook</span>) &#123;  <span class="comment">// 多个组件共享状态</span></span><br><span class="line">    <span class="keyword">if</span> (!map.<span class="title function_">get</span>(hook)) &#123;</span><br><span class="line">        <span class="keyword">let</span> ans = <span class="title function_">hook</span>()</span><br><span class="line">        map.<span class="title function_">set</span>(hook, ans)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map.<span class="title function_">get</span>(hook)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useReducer</span>(<span class="params">reducer, initialState = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> state = <span class="title function_">ref</span>(initialState)</span><br><span class="line">    <span class="comment">// 约定 action 格式为 &#123;type:string, payload: any&#125;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dispatch</span> = (<span class="params">action</span>) =&gt; &#123;</span><br><span class="line">        state.<span class="property">value</span> = <span class="title function_">reducer</span>(state.<span class="property">value</span>, action)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; state, dispatch &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;reset&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> initialState;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span>&#125;;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;decrement&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useStore</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useRedux</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">useModel</span>(useStore);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="二、组件开发"><a href="#二、组件开发" class="headerlink" title="二、组件开发"></a>二、组件开发</h1><h2 id="组件注册"><a href="#组件注册" class="headerlink" title="组件注册"></a>组件注册</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局注册：main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Swiper</span> <span class="keyword">from</span> <span class="string">&#x27;./components/MySwiper.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyCom</span> <span class="keyword">from</span> <span class="string">&#x27;./components/MyCom.vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;MyCom&#x27;</span>, <span class="title class_">Test</span>)</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;my-swiper&#x27;</span>, <span class="title class_">Swiper</span>)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 局部注册</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">IonApp</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ionic/vue&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">components</span>: &#123; <span class="title class_">IonApp</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 批量引用</span></span><br><span class="line"><span class="comment">// components/IonicBase.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">IonTitle</span>, <span class="title class_">IonContent</span>, <span class="title class_">IonButton</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ionic/vue&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">        app.<span class="title function_">component</span>(<span class="string">&#x27;IonTitle&#x27;</span>, <span class="title class_">IonTitle</span>);</span><br><span class="line">        app.<span class="title function_">component</span>(<span class="string">&#x27;IonContent&#x27;</span>, <span class="title class_">IonContent</span>);</span><br><span class="line">        app.<span class="title function_">component</span>(<span class="string">&#x27;IonButton&#x27;</span>, <span class="title class_">IonButton</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">IonicBase</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/IonicBase&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">IonicBase</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// vue3 批量注册</span></span><br><span class="line"><span class="keyword">const</span> components = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">globEager</span>(<span class="string">&#x27;./*/index.vue&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(components).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> component = components[key].<span class="property">default</span></span><br><span class="line">            app.<span class="title function_">component</span>(component.<span class="property">name</span>, component)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// vue2 批量注册</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> components = <span class="built_in">require</span>.<span class="title function_">context</span>(<span class="string">&#x27;./&#x27;</span>, <span class="literal">true</span>, <span class="regexp">/index\.vue$/</span>);</span><br><span class="line">components.<span class="title function_">keys</span>().<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> component = <span class="title function_">components</span>(key).<span class="property">default</span>;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(component.<span class="property">name</span>, component)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="三、组件通信"><a href="#三、组件通信" class="headerlink" title="三、组件通信"></a>三、组件通信</h1><blockquote>
<p>Pinia 实现跨组件通信的官方状态管理工具此处省略用法。</p>
</blockquote>
<h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Parent.vue：发送</span></span><br><span class="line">&lt;child :msg=<span class="string">&quot;msg&quot;</span>&gt;&lt;/child&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> child <span class="keyword">from</span> <span class="string">&quot;./child.vue&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> msg = <span class="title function_">ref</span>(<span class="string">&quot;信息&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> msg = <span class="title function_">reactive</span>([<span class="string">&quot;信息&quot;</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Child.vue：接收</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">msg</span>: <span class="title class_">String</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">msg</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">default</span>: <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// default: () =&gt; &quot;&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="emit"><a href="#emit" class="headerlink" title="$emit"></a>$emit</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Child.vue：发送</span></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&quot;onClick&quot;</span>])</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&#x27;onClick&#x27;</span>, <span class="string">&#x27;数据&#x27;</span>)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parent.vue：接收</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">child</span> @<span class="attr">on-click</span>=<span class="string">&quot;onClickTag&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> child <span class="keyword">from</span> <span class="string">&quot;./child.vue&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">onClickTag</span> = (<span class="params">msg: <span class="built_in">String</span></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(msg)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="attrs"><a href="#attrs" class="headerlink" title="$attrs"></a>$attrs</h2><blockquote>
<p>Vue2 可以通过 this.$attrs、this.$listeners 分别访问传递给组件的 props 未定义属性和事件监听器，Vue3 $attrs 包括了之前除外的属性 class、style 并合并移除了 $listeners。</p>
</blockquote>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// Parent.vue：发送</span><br><span class="line"><span class="tag">&lt;<span class="name">child</span> <span class="attr">:msg</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">title</span>=<span class="string">&quot;3333&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> child <span class="keyword">from</span> <span class="string">&quot;./child.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> msg = <span class="title function_">ref</span>(<span class="string">&quot;1111&quot;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// Child.vue：接收</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">inheritAttrs</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; useAttrs &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> attrs = <span class="title function_">useAttrs</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="slot"><a href="#slot" class="headerlink" title="slot"></a>slot</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Child</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>默认插槽<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:monkey</span>&gt;</span>具名插槽<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Child</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;monkey&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> Parent.vue：作用域插槽</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> <span class="variable">v</span>-slot：获取子组件的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> :list：给子组件传递数据 </span></span><br><span class="line"><span class="comment">**/</span> </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Child</span> <span class="attr">v-slot</span>=<span class="string">&quot;&#123;scope&#125;&quot;</span> <span class="attr">:list</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>名字：&#123;&#123; scope.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>职业：&#123;&#123; scope.occupation &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Child</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Child.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> list = <span class="title function_">ref</span>([</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#123; <span class="attr">name</span>: <span class="string">&#x27;雷猴&#x27;</span>, <span class="attr">occupation</span>: <span class="string">&#x27;打雷&#x27;</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#123; <span class="attr">name</span>: <span class="string">&#x27;鲨鱼辣椒&#x27;</span>, <span class="attr">occupation</span>: <span class="string">&#x27;游泳&#x27;</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#123; <span class="attr">name</span>: <span class="string">&#x27;蟑螂恶霸&#x27;</span>, <span class="attr">occupation</span>: <span class="string">&#x27;扫地&#x27;</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:scope</span>=<span class="string">&quot;item&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">list</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">default</span>: <span class="function">() =&gt;</span> []</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>


<h2 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">child</span> <span class="attr">v-model.a</span>=<span class="string">&quot;name&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;value&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> child <span class="keyword">from</span> <span class="string">&quot;./child.vue&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> name = <span class="title function_">ref</span>(<span class="string">&quot;input&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> value = <span class="title function_">ref</span>(<span class="string">&quot;select&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Child.vue：自定义组件时，v-model prop 和事件的默认名称已更改但可以自定义</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handlerClick&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 默认绑定的属性名为 modelValue，通过 : 自定义名称，通过 . 自定义修饰符</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> props = <span class="title function_">defineProps</span>(<span class="string">&quot;modelValue&quot;</span>, <span class="string">&quot;modelModifiers&quot;</span>, <span class="string">&quot;value&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&quot;update:modelValue&quot;</span>, <span class="string">&quot;update:value&quot;</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handlerClick</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">modelModifiers</span>.<span class="property">a</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">emit</span>(<span class="string">&quot;update:modelValue&quot;</span>, <span class="string">&quot;new name&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">emit</span>(<span class="string">&quot;update:value&quot;</span>, <span class="string">&quot;new value&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="expose-x2F-ref"><a href="#expose-x2F-ref" class="headerlink" title="expose&#x2F;ref"></a>expose&#x2F;ref</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    <span class="title function_">defineExpose</span>(&#123;</span><br><span class="line">        <span class="attr">childName</span>: <span class="string">&quot;子组件的属性&quot;</span>,</span><br><span class="line">        <span class="title function_">someMethod</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;子组件的方法&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parent.vue：调用子组件对外暴露的方法</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">ref</span>=<span class="string">&quot;comp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handlerClick&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> child <span class="keyword">from</span> <span class="string">&quot;./child.vue&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handlerClick</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">const</span> comp = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        comp.<span class="property">value</span>.<span class="title function_">someMethod</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="provide-x2F-inject"><a href="#provide-x2F-inject" class="headerlink" title="provide&#x2F;inject"></a>provide&#x2F;inject</h2><blockquote>
<p>实现树形组件的依赖注入功能，常用于层级嵌套较深的组件之间相互传递数据。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Parent.vue：所有后代组件的依赖提供者</span></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    <span class="keyword">import</span> &#123; provide &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;传给子孙的数据&quot;</span>)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Child.vue：依赖使用者</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> name = <span class="title function_">inject</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;默认值&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>


<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><p><a href="https://juejin.cn/post/7154579554034515982">https://juejin.cn/post/7154579554034515982</a></p>
]]></content>
      <categories>
        <category>JS 框架</category>
      </categories>
      <tags>
        <tag>JS 框架</tag>
      </tags>
  </entry>
  <entry>
    <title>H5 页面可视化编辑器</title>
    <url>/2023/02/22/21-%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0/</url>
    <content><![CDATA[<blockquote>
<p>实现拖拽式生成 H5 页面</p>
</blockquote>
<h1 id="一、Umi"><a href="#一、Umi" class="headerlink" title="一、Umi"></a>一、Umi</h1><h1 id="一、React-Koa"><a href="#一、React-Koa" class="headerlink" title="一、React + Koa"></a>一、React + Koa</h1>]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>跨平台文档开发</title>
    <url>/2023/01/17/20-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%96%87%E6%A1%A3%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="一、uniapp-在线预览"><a href="#一、uniapp-在线预览" class="headerlink" title="一、uniapp 在线预览"></a>一、uniapp 在线预览</h1><blockquote>
<p>业务系统开发时大多遇到 PDF、Word、Excel、PPT、图片等文件在线预览的需求，而在线预览不是下载后再用本地软件或浏览器打开预览，而是直接通过文件流的形式查看。</p>
</blockquote>
<h2 id="PDF-预览"><a href="#PDF-预览" class="headerlink" title="PDF 预览"></a>PDF 预览</h2><blockquote>
<p><a href="https://mozilla.github.io/pdf.js/getting_started/#download">pdf.js 下载</a>解压并后将 build、web 目录拷贝到项目 hybrid&#x2F;html。</p>
</blockquote>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line"> * @title file-preview.vue</span><br><span class="line"> * </span><br><span class="line"> * @desp  fileUrl：部署在服务器的文件流访问地址</span><br><span class="line"> * @desp  web/viewer.html：插件解压后包含的文件</span><br><span class="line"> * @desp  web/viewer.js：注释代码行 not match</span><br><span class="line"> throw new Error(&#x27;file origin does not match viewer\&#x27;s&#x27;)</span><br><span class="line">**/ </span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">web-view</span> <span class="attr">:src</span>=<span class="string">&quot;allUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">web-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;@/config&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">allUrl</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">viewUrl</span>: <span class="string">&#x27;/hybrid/html/web/viewer.html&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// fileUrl：文件流访问地址</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> fileUrl = <span class="built_in">encodeURIComponent</span>(options.<span class="property">url</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">allUrl</span> = <span class="variable language_">this</span>.<span class="property">viewUrl</span> + <span class="string">&#x27;?file=&#x27;</span> + fileUrl</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="office-预览"><a href="#office-预览" class="headerlink" title="office 预览"></a>office 预览</h2><blockquote>
<p>首先通过 <a href="https://sourceforge.net/projects/openofficeorg.mirror/files/">Apache_OpenOffice</a> 搭建 OpenOffice 服务，然后将 Doc、Word、Excel、PPT 等文件转换为 pdf 后通过 pdf.js 实现预览。</p>
</blockquote>
  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line">// 搭建 openOffice 服务</span><br><span class="line"></span><br><span class="line">// <span class="number">1</span>、Apache_OpenOffice 下载后解压</span><br><span class="line">tar xzvfm Apache_OpenOffice_xxx.tar.gz</span><br><span class="line">cd zh-CN/RPMS</span><br><span class="line">rpm -ivh *rpm</span><br><span class="line"></span><br><span class="line">// <span class="number">2</span>、运行服务</span><br><span class="line"><span class="comment"># 127.0.0.1 只能本机使用该</span></span><br><span class="line">/opt/openoffice4/program/soffice <span class="string">&quot;-accept=socket,host=127.0.0.1,</span></span><br><span class="line"><span class="string">port=8100;urp;&quot;</span> -headless -nofirststartwizard &amp;</span><br><span class="line"><span class="comment"># 0.0.0.0 远程 ip 能使用</span></span><br><span class="line">/opt/openoffice4/program/soffice <span class="string">&quot;-accept=socket,host=0.0.0.0,</span></span><br><span class="line"><span class="string">port=8100;urp;&quot;</span> -headless -nofirststartwizard &amp;</span><br></pre></td></tr></table></figure>

  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// 集成 java</span><br><span class="line"></span><br><span class="line">// 1、pom.xml 添加 jar 包</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openoffice<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>juh<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openoffice<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jurt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openoffice<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ridl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openoffice<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>unoil<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.artofsolving<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jodconverter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 2、jodconverter 2.2.2 下载后单独导入</span><br><span class="line">https://sourceforge.net/projects/jodconverter/files/) </span><br><span class="line"></span><br><span class="line">mvn install:install-file -Dfile=&quot;jodconverter-2.2.2.jar&quot; -DgroupId=com.</span><br><span class="line">artofsolving -DartifactId=jodconverter -Dversion=2.2.2 -Dpackaging=jar</span><br><span class="line"></span><br><span class="line">// 3、通过 openOffice 将文件转换为 pdf</span><br><span class="line">if (&quot;DOC&quot;.equals(ext) || &quot;DOCX&quot;.equals(ext) || &quot;XLS&quot;.equals(ext) || </span><br><span class="line">&quot;XLSX&quot;.equals(ext) || &quot;PPT&quot;.equals(ext) || &quot;PPTX&quot;.equals(ext)) &#123;</span><br><span class="line">    // 转换文件名：filePath 在数据库中不带文件后缀，jodConverter 必须识别后缀</span><br><span class="line">    String filePath = sourceFile.getPath();</span><br><span class="line">    File pdfFile;</span><br><span class="line">    if (filePath.contains(&quot;.&quot;)) &#123;</span><br><span class="line">        pdfFile = new File(filePath.substring(0, filePath.lastIndexOf(&quot;.&quot;)) + &quot;.pdf&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        pdfFile = new File(filePath + &quot;.pdf&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 不存在的文件直接报错</span><br><span class="line">    if (!sourceFile.exists()) &#123;</span><br><span class="line">        log.info(&quot;需要预览的文档在服务器中不存在!!!&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    // 如果文件已经转换过则直接预览</span><br><span class="line">    if (pdfFile.exists()) &#123;</span><br><span class="line">        sourceFile = pdfFile;</span><br><span class="line">        response.setContentType(&quot;application/pdf&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    // 打开 OpenOffice 连接开始转换</span><br><span class="line">    OpenOfficeConnection connection;</span><br><span class="line">    try &#123;</span><br><span class="line">        connection = new SocketOpenOfficeConnection(openofficeHost, openofficePort);</span><br><span class="line">        connection.connect();</span><br><span class="line"></span><br><span class="line">    &#125; catch (java.net.ConnectException e) &#123;</span><br><span class="line">        log.warn(&quot;openOffice未连接，正在重新连接...&quot;);</span><br><span class="line">        String command = openofficeInstallPath + &quot;program/soffice -headless -accept</span><br><span class="line">        =\&quot;socket,host=127.0.0.1,port=8100;urp;\&quot; -nofirststartwizard&quot;;</span><br><span class="line">        Runtime.getRuntime().exec(command);</span><br><span class="line"></span><br><span class="line">        Thread.sleep(1000);</span><br><span class="line">        connection = new SocketOpenOfficeConnection(8100);</span><br><span class="line">        connection.connect();</span><br><span class="line">        log.warn(&quot;openOffice 重新连接成功!!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        DocumentConverter converter = new StreamOpenOfficeDocumentConverter(connection);</span><br><span class="line">        converter.convert(sourceFile, pdfFile);</span><br><span class="line">        connection.disconnect();</span><br><span class="line"></span><br><span class="line">        sourceFile = pdfFile;</span><br><span class="line">        response.setContentType(&quot;application/pdf&quot;);</span><br><span class="line">    &#125; catch (OpenOfficeException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        log.info(&quot;读取转换文件失败!!!&quot;);</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            if (connection != null) &#123;</span><br><span class="line">                connection.disconnect();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="图片预览"><a href="#图片预览" class="headerlink" title="图片预览"></a>图片预览</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端预览</span></span><br><span class="line">uni.<span class="title function_">previewImage</span>(&#123;</span><br><span class="line">    <span class="attr">current</span>: <span class="number">0</span>,              <span class="comment">// 预览的图片索引</span></span><br><span class="line">    <span class="attr">urls</span>: [<span class="string">&#x27;文件流访问地址&#x27;</span>],  <span class="comment">// 预览的图片链接列表</span></span><br><span class="line">    <span class="attr">longPressActions</span>: &#123;      <span class="comment">// 长按图片显示操作菜单，默认为保存相册</span></span><br><span class="line">        <span class="attr">itemList</span>: [<span class="string">&#x27;发送给朋友&#x27;</span>, <span class="string">&#x27;保存图片&#x27;</span>, <span class="string">&#x27;收藏&#x27;</span>],   <span class="comment">// 按钮数组</span></span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;选中图片&#x27;</span>, data.<span class="property">index</span> + <span class="number">1</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;选中按钮&#x27;</span>, data.<span class="property">tapIndex</span> + <span class="number">1</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(err.<span class="property">errMsg</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后端文件流：根据文件后缀对应的不同类型进行预览 </span></span><br><span class="line"><span class="title class_">String</span> ext = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.<span class="title function_">equals</span>(url) &amp;&amp; url.<span class="title function_">contains</span>(<span class="string">&quot;.&quot;</span>)) &#123;</span><br><span class="line">    ext= url.<span class="title function_">substring</span>(url.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>,url.<span class="title function_">length</span>()).<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;PNG&quot;</span>.<span class="title function_">equals</span>(ext) || <span class="string">&quot;JPEG&quot;</span>.<span class="title function_">equals</span>(ext) || <span class="string">&quot;JPG&quot;</span>.<span class="title function_">equals</span>(ext)) &#123;</span><br><span class="line">    response.<span class="title function_">setContentType</span>(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;BMP&quot;</span>.<span class="title function_">equals</span>(ext)) &#123;</span><br><span class="line">    response.<span class="title function_">setContentType</span>(<span class="string">&quot;image/bmp&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;GIF&quot;</span>.<span class="title function_">equals</span>(ext)) &#123;</span><br><span class="line">    response.<span class="title function_">setContentType</span>(<span class="string">&quot;image/gif&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;PDF&quot;</span>.<span class="title function_">equals</span>(ext)) &#123;</span><br><span class="line">    response.<span class="title function_">setContentType</span>(<span class="string">&quot;application/pdf&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="文档云预览"><a href="#文档云预览" class="headerlink" title="文档云预览"></a>文档云预览</h2><blockquote>
<p>以上方案只能实现简单的文档预览，加水印、防复制、在线编辑等复杂需求则需要使用永中云服务平台、金山WPS开放平台、腾讯文档开放API等。准备工作有：<a href="https://open.yozocloud.cn/">永中云服务</a>注册、登录、根据文档进行开发者申请、管理中心申请云预览等应用、应用列表查看 APPID APPKEY。</p>
</blockquote>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// 开源项目</span><br><span class="line">https://gitee.com/twofloor/uniapp-admin</span><br><span class="line">https://gitee.com/twofloor/uniapp-file-upload</span><br><span class="line"></span><br><span class="line">// preview.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">web-view</span> <span class="attr">v-if</span>=<span class="string">&quot;yzPreviewUrl&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;yzPreviewUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">web-view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else</span>&gt;</span>文档地址无效，无法加载该文档<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;@/config&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123; <span class="attr">yzPreviewUrl</span>: <span class="string">&#x27;&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onLoad</span>(<span class="params">option</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 文档上传后跳转到当前预览页面</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (option.<span class="property">fileData</span>) &#123; <span class="keyword">return</span> &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> d = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="built_in">decodeURIComponent</span>(option.<span class="property">fileData</span>))</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">yzPreviewUrl</span> = <span class="string">&#x27;http://eic.yozocloud.cn/api/view/file&#x27;</span> + </span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;?fileVersionId=&#x27;</span> + d.<span class="property">fileVersionId</span> + <span class="string">&#x27;&amp;appId=&#x27;</span> + config.<span class="property">APPID</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>






<h1 id="二、minio-文件管理"><a href="#二、minio-文件管理" class="headerlink" title="二、minio 文件管理"></a>二、minio 文件管理</h1><blockquote>
<p>一个基于 Apache License v2.0 开源协议的对象存储服务，用来存放管理文件的文件服务器。它兼容亚马逊S3云存储服务接口并支持多种语言客户端集成开发，非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器&#x2F;虚拟机镜像等。</p>
</blockquote>
<h2 id="Node-项目集成"><a href="#Node-项目集成" class="headerlink" title="Node 项目集成"></a>Node 项目集成</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// minio.js：需要先安装 npm i minio --save-dev</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Minio</span> = <span class="built_in">require</span>(<span class="string">&#x27;minio&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;../../../config/config&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> entityFun = <span class="built_in">require</span>(<span class="string">&#x27;../../Base/server/EntityFunction&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">initBucket</span> = <span class="keyword">async</span> minioClient =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> exists</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">      exists = <span class="keyword">await</span> minioClient.<span class="title function_">bucketExists</span>(config.<span class="property">minio</span>.<span class="property">BUCKET</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">const</span> errMsg = <span class="string">`initBucket - bucketExists: <span class="subst">$&#123;err&#125;</span>`</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(errMsg)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!exists) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Bucket creatd&#x27;</span>)</span><br><span class="line">          <span class="keyword">await</span> minioClient.<span class="title function_">makeBucket</span>(</span><br><span class="line">              config.<span class="property">minio</span>.<span class="property">BUCKET</span>,</span><br><span class="line">              process.<span class="property">env</span>.<span class="property">MINIO_REGION</span> || <span class="string">&#x27;eu-west-2&#x27;</span></span><br><span class="line">          )</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="keyword">const</span> errMsg = <span class="string">`initBucket - makeBucket: <span class="subst">$&#123;err&#125;</span>`</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(errMsg)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getInstance</span> = <span class="keyword">async</span>(<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> minioClient;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getSqlData</span>()</span><br><span class="line">    minioClient = <span class="keyword">new</span> <span class="title class_">Minio</span>.<span class="title class_">Client</span>(config.<span class="property">minio</span>)</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">initBucket</span>(minioClient)</span><br><span class="line">    <span class="keyword">return</span> minioClient</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatDate</span>(<span class="params">fmt, date</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ret;</span><br><span class="line">    date = date || <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    <span class="keyword">const</span> opt = &#123;</span><br><span class="line">        <span class="string">&quot;Y+&quot;</span>: date.<span class="title function_">getFullYear</span>().<span class="title function_">toString</span>(), <span class="comment">// 年</span></span><br><span class="line">        <span class="string">&quot;m+&quot;</span>: (date.<span class="title function_">getMonth</span>() + <span class="number">1</span>).<span class="title function_">toString</span>(), <span class="comment">// 月</span></span><br><span class="line">        <span class="string">&quot;d+&quot;</span>: date.<span class="title function_">getDate</span>().<span class="title function_">toString</span>(), <span class="comment">// 日</span></span><br><span class="line">        <span class="string">&quot;H+&quot;</span>: date.<span class="title function_">getHours</span>().<span class="title function_">toString</span>(), <span class="comment">// 时</span></span><br><span class="line">        <span class="string">&quot;M+&quot;</span>: date.<span class="title function_">getMinutes</span>().<span class="title function_">toString</span>(), <span class="comment">// 分</span></span><br><span class="line">        <span class="string">&quot;S+&quot;</span>: date.<span class="title function_">getSeconds</span>().<span class="title function_">toString</span>() <span class="comment">// 秒</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> opt) &#123;</span><br><span class="line">        ret = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;(&quot;</span> + k + <span class="string">&quot;)&quot;</span>).<span class="title function_">exec</span>(fmt);</span><br><span class="line">        <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">          fmt = fmt.<span class="title function_">replace</span>(ret[<span class="number">1</span>], (ret[<span class="number">1</span>].<span class="property">length</span> == <span class="number">1</span>) ? (opt[k]) : </span><br><span class="line">                (opt[k].<span class="title function_">padStart</span>(ret[<span class="number">1</span>].<span class="property">length</span>, <span class="string">&quot;0&quot;</span>)))</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> fmt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getSqlData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> condition = &#123;</span><br><span class="line">      <span class="title class_">Classification</span>: <span class="string">&#x27;SystemManage&#x27;</span>,</span><br><span class="line">      <span class="title class_">Code</span>: &#123;</span><br><span class="line">          <span class="attr">$in</span>: [<span class="string">&#x27;FileServerMgtUser&#x27;</span>,<span class="string">&#x27;FileServerMgtPW&#x27;</span>, <span class="string">&#x27;FileServerURL&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> parameters = <span class="keyword">await</span> entityFun.<span class="title function_">find</span>(<span class="string">&#x27;Parameter&#x27;</span>, condition);</span><br><span class="line">    <span class="keyword">if</span> (parameters &amp;&amp; parameters.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = parameters.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">let</span> param = parameters[i];</span><br><span class="line">            <span class="keyword">if</span> (param.<span class="property">Code</span> == <span class="string">&#x27;FileServerMgtUser&#x27;</span>) &#123;</span><br><span class="line">                config.<span class="property">minio</span>.<span class="property">accessKey</span> = param.<span class="property">Value</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (param.<span class="property">Code</span> == <span class="string">&#x27;FileServerMgtPW&#x27;</span>) &#123;</span><br><span class="line">                config.<span class="property">minio</span>.<span class="property">secretKey</span> = param.<span class="property">Value</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (param.<span class="property">Code</span> == <span class="string">&#x27;FileServerURL&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> url = param.<span class="property">Value</span>;</span><br><span class="line">                <span class="keyword">let</span> str = url.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                config.<span class="property">minio</span>.<span class="property">endPoint</span> = str.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                config.<span class="property">minio</span>.<span class="property">port</span> = <span class="title class_">Number</span>(str.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]);</span><br><span class="line">                config.<span class="property">minio</span>.<span class="property">BUCKET</span> = url.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  getInstance,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">uploadFileSteam</span>(<span class="params">filename, file, fileType</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> fileStream = fs.<span class="title function_">createReadStream</span>(file)</span><br><span class="line">    <span class="keyword">const</span> filePath = <span class="title function_">formatDate</span>(<span class="string">&quot;YYYYmmdd&quot;</span>) + <span class="string">&quot;/&quot;</span> + filename;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> minioClient = <span class="keyword">await</span> <span class="title function_">getInstance</span>()</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">stat</span>(file, <span class="keyword">function</span>(<span class="params">err, stats</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123; <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err) &#125;</span><br><span class="line">      <span class="keyword">return</span> minioClient.<span class="title function_">putObject</span>(config.<span class="property">minio</span>.<span class="property">BUCKET</span>, filePath, </span><br><span class="line">            fileStream, stats.<span class="property">size</span>, &#123; <span class="string">&#x27;content-type&#x27;</span>: fileType &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">uploadBase64</span>(<span class="params">filename, baseData, fileType,filePath</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> dataBuffer = <span class="keyword">new</span> <span class="title class_">Buffer</span>(baseData, <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> minioClient = <span class="keyword">await</span> <span class="title function_">getInstance</span>()</span><br><span class="line">    <span class="keyword">if</span> (filePath &amp;&amp; filePath[filePath.<span class="property">length</span>-<span class="number">1</span>] != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        filePath = filePath+<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> minioClient.<span class="title function_">putObject</span>(config.<span class="property">minio</span>.<span class="property">BUCKET</span>, </span><br><span class="line">        filePath+filename, dataBuffer, &#123; <span class="string">&#x27;content-type&#x27;</span>: fileType &#125;)</span><br><span class="line">      <span class="keyword">let</span> obj = &#123;</span><br><span class="line">        <span class="attr">endPoint</span>: config.<span class="property">minio</span>.<span class="property">endPoint</span>,</span><br><span class="line">        <span class="attr">port</span>: config.<span class="property">minio</span>.<span class="property">port</span>,</span><br><span class="line">        <span class="attr">filePath</span>: filePath+filename,</span><br><span class="line">        <span class="attr">filename</span>: filename,</span><br><span class="line">        <span class="attr">bucket</span>: config.<span class="property">minio</span>.<span class="property">BUCKET</span>,</span><br><span class="line">        <span class="attr">bucketUrl</span>: <span class="string">&#x27;http://&#x27;</span> + config.<span class="property">minio</span>.<span class="property">endPoint</span> + <span class="string">&#x27;:&#x27;</span> + </span><br><span class="line">                config.<span class="property">minio</span>.<span class="property">port</span> + <span class="string">&#x27;/&#x27;</span> + config.<span class="property">minio</span>.<span class="property">BUCKET</span>,</span><br><span class="line">        <span class="attr">dataUrl</span>: <span class="string">&#x27;http://&#x27;</span> + config.<span class="property">minio</span>.<span class="property">endPoint</span> + <span class="string">&#x27;:&#x27;</span> + config.<span class="property">minio</span></span><br><span class="line">        .<span class="property">port</span> + <span class="string">&#x27;/&#x27;</span> + config.<span class="property">minio</span>.<span class="property">BUCKET</span> + <span class="string">&#x27;/&#x27;</span> +filePath+ filename</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (filePath) &#123;</span><br><span class="line">          obj.<span class="property">bucketUrl</span> += <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">          obj.<span class="property">bucketUrl</span> += filePath;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> obj;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">listFiles</span>(<span class="params">prefix, endPoint, port, bucket</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!prefix) prefix = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">getSqlData</span>()</span><br><span class="line">      <span class="keyword">let</span> minioObj = &#123;</span><br><span class="line">          <span class="attr">endPoint</span>: endPoint,</span><br><span class="line">          <span class="attr">port</span>: port,</span><br><span class="line">          <span class="attr">useSSL</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">accessKey</span>: config.<span class="property">minio</span>.<span class="property">accessKey</span>,</span><br><span class="line">          <span class="attr">secretKey</span>: config.<span class="property">minio</span>.<span class="property">secretKey</span>,</span><br><span class="line">          <span class="attr">BUCKET</span>: bucket</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> newClient = <span class="keyword">new</span> <span class="title class_">Minio</span>.<span class="title class_">Client</span>(minioObj)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> stream = newClient.<span class="title function_">listObjects</span>(bucket, prefix, <span class="literal">true</span>);</span><br><span class="line">      <span class="keyword">let</span> list = [];</span><br><span class="line">      stream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">obj</span> =&gt;</span> &#123;</span><br><span class="line">          list.<span class="title function_">push</span>(obj);</span><br><span class="line">      &#125;)</span><br><span class="line">      stream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err);</span><br><span class="line">      &#125;)</span><br><span class="line">      stream.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (list.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          list.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">              item.<span class="property">dataurl</span> = newClient.<span class="property">protocol</span> + <span class="string">&#x27;//&#x27;</span> + newClient.<span class="property">host</span> </span><br><span class="line">                + <span class="string">&#x27;:&#x27;</span> + newClient.<span class="property">port</span> + <span class="string">&#x27;/&#x27;</span> + bucket + <span class="string">&#x27;/&#x27;</span> + item.<span class="property">name</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">resolve</span>(list);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getFile</span>(<span class="params">objName, tmpFile</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> minioClient = <span class="keyword">await</span> <span class="title function_">getInstance</span>()</span><br><span class="line">    <span class="keyword">return</span> minioClient.<span class="title function_">fGetObject</span>(config.<span class="property">minio</span>.<span class="property">BUCKET</span>, objName, tmpFile)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getFileStream</span>(<span class="params">objName</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> minioClient = <span class="keyword">await</span> <span class="title function_">getInstance</span>()</span><br><span class="line">    <span class="keyword">return</span> minioClient.<span class="title function_">getObject</span>(config.<span class="property">minio</span>.<span class="property">BUCKET</span>, objName)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">deleteFile</span>(<span class="params">objName, endPoint, port, bucket</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">getSqlData</span>()</span><br><span class="line">      <span class="keyword">let</span> minioObj = &#123;</span><br><span class="line">          <span class="attr">endPoint</span>: endPoint,</span><br><span class="line">          <span class="attr">port</span>: port,</span><br><span class="line">          <span class="attr">useSSL</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">accessKey</span>: config.<span class="property">minio</span>.<span class="property">accessKey</span>,</span><br><span class="line">          <span class="attr">secretKey</span>: config.<span class="property">minio</span>.<span class="property">secretKey</span>,</span><br><span class="line">          <span class="attr">BUCKET</span>: bucket</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> newMinioClient = <span class="keyword">new</span> <span class="title class_">Minio</span>.<span class="title class_">Client</span>(minioObj)</span><br><span class="line">          <span class="keyword">await</span> newMinioClient.<span class="title function_">removeObject</span>(bucket, objName)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// config.js</span></span><br><span class="line"><span class="attr">minio</span>: &#123;</span><br><span class="line">    <span class="attr">endPoint</span>: <span class="string">&quot;172.20.45.333&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">    <span class="attr">useSSL</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">accessKey</span>: <span class="string">&#x27;minioadmin&#x27;</span>,</span><br><span class="line">    <span class="attr">secretKey</span>: <span class="string">&#x27;minioadmin&#x27;</span>,</span><br><span class="line">    <span class="attr">BUCKET</span>: <span class="string">&#x27;bucket&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JS-后台封装"><a href="#JS-后台封装" class="headerlink" title="JS 后台封装"></a>JS 后台封装</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MinioClient.js</span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> minio = <span class="built_in">require</span>(<span class="string">&#x27;../../../Utils/server/controllers/minio&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params">res, err</span>) &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: <span class="literal">null</span>, <span class="title class_">Error</span>: err &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleSuccess</span>(<span class="params">res, data</span>) &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: data, <span class="title class_">Error</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断桶是否存在</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">bucketExists</span> = <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">body</span>.<span class="property">bucketName</span>) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">end</span>();</span><br><span class="line">    minio.<span class="title function_">bucketExists</span>(req.<span class="property">body</span>.<span class="property">bucketName</span>, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">handleError</span>(res, err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleSuccess</span>(res, &#123; <span class="attr">message</span>: <span class="string">&quot;bucket exist&quot;</span> &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除桶</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">removeBucket</span> = <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">body</span>.<span class="property">bucketName</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, &#123; <span class="attr">message</span>: <span class="string">&quot;桶名称为空&quot;</span> &#125;);</span><br><span class="line">    &#125; </span><br><span class="line">    minio.<span class="title function_">removeBucket</span>(req.<span class="property">body</span>.<span class="property">bucketName</span>, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">handleError</span>(res, err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleSuccess</span>(res, &#123; <span class="attr">message</span>: <span class="string">&quot;removed successfully&quot;</span> &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列出存储桶中所有对象</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">listObjects</span> = <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> objects = <span class="keyword">await</span> minio.<span class="title function_">listFiles</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleSuccess</span>(res, objects);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">uploadFileSteam</span> = <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> fPath = req.<span class="property">body</span>.<span class="property">filePath</span></span><br><span class="line">        <span class="keyword">let</span> fName = req.<span class="property">body</span>.<span class="property">filename</span> || <span class="string">&#x27;123.png&#x27;</span></span><br><span class="line">        <span class="keyword">let</span> fType = req.<span class="property">body</span>.<span class="property">fileType</span> || <span class="string">&#x27;image/png&#x27;</span></span><br><span class="line">        <span class="keyword">let</span> objs = <span class="keyword">await</span> minio.<span class="title function_">uploadFileSteam</span>(fName, fPath, fType);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleSuccess</span>(res, objs);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">uploadBase64</span> = <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">body</span>.<span class="property">filename</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, &#123; <span class="attr">message</span>: <span class="string">&quot;请传入文件名&quot;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> dataurl = req.<span class="property">body</span>.<span class="property">dataurl</span></span><br><span class="line">    <span class="keyword">var</span> filename = req.<span class="property">body</span>.<span class="property">filename</span></span><br><span class="line">    <span class="keyword">var</span> arr = dataurl.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> fType = arr[<span class="number">0</span>].<span class="title function_">match</span>(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>] || <span class="string">&#x27;image/png&#x27;</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> objects = <span class="keyword">await</span> minio.<span class="title function_">uploadBase64</span>(filename, arr[<span class="number">1</span>], fType)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleSuccess</span>(res, objects)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">deleteFile</span> = <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">body</span>.<span class="property">url</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">handleError</span>(res, &#123; <span class="attr">message</span>: <span class="string">&quot;请传入文件路径&quot;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> str = req.<span class="property">body</span>.<span class="property">url</span>.<span class="title function_">split</span>(<span class="string">&#x27;//&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> arr = str.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> point = arr[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> port = <span class="title class_">Number</span>(arr[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">let</span> bucket = arr[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> fName = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            fName += (arr[i] + <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == (arr.<span class="property">length</span>-<span class="number">1</span>)) &#123;</span><br><span class="line">            fName += arr[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> objs = <span class="keyword">await</span> minio.<span class="title function_">deleteFile</span>(fName, point, port, bucket)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleSuccess</span>(res, objs)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一次上传多张图片</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">uploadImgs</span> = <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> newError;</span><br><span class="line">    <span class="keyword">let</span> imgs = req.<span class="property">body</span>.<span class="property">imgs</span>;</span><br><span class="line">    <span class="keyword">if</span> (!imgs) &#123;</span><br><span class="line">        newError = <span class="string">&#x27;imgs 字段缺失&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(imgs)) &#123;</span><br><span class="line">        newError = <span class="string">&#x27;imgs 数据格式错误&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (imgs.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        newError = <span class="string">&#x27;请上传图片&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newError) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, &#123; <span class="attr">message</span>: newError &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> promise = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;imgs.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> imgObj = imgs[i];</span><br><span class="line">        <span class="keyword">if</span> (imgObj.<span class="property">dataurl</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;,&#x27;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> filename = imgObj.<span class="property">filename</span>;</span><br><span class="line">        <span class="keyword">let</span> filePath = imgObj.<span class="property">filePath</span> || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">let</span> arr = imgObj.<span class="property">dataurl</span>.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        <span class="keyword">let</span> fileType = arr[<span class="number">0</span>].<span class="title function_">match</span>(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>] || <span class="string">&#x27;image/png&#x27;</span>;</span><br><span class="line">        promise.<span class="title function_">push</span>(<span class="keyword">await</span> minio.<span class="title function_">uploadBase64</span>(filename, arr[<span class="number">1</span>], </span><br><span class="line">        fileType, filePath))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">all</span>(promise).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleSuccess</span>(res, result)</span><br><span class="line">    &#125;).<span class="property">catch</span> (<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, &#123; <span class="attr">message</span>: err.<span class="property">message</span> &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">downloadImgsFunc</span> = <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">body</span>.<span class="property">folderName</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handleError</span>(res, &#123; <span class="attr">message</span>: <span class="string">&quot;请传入要下载的图片路径&quot;</span> &#125;)</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">let</span> url = req.<span class="property">body</span>.<span class="property">folderName</span>;</span><br><span class="line">    <span class="keyword">if</span> (url.<span class="title function_">charAt</span>(url.<span class="property">length</span>-<span class="number">1</span>) != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        url += <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> str = url.<span class="title function_">split</span>(<span class="string">&#x27;//&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> arr = str.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> point = arr[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> port = <span class="title class_">Number</span>(arr[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">let</span> bucket = arr[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> foldName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> foldArr = arr.<span class="title function_">slice</span>(<span class="number">2</span>, arr.<span class="property">length</span>-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i &lt; foldArr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        foldName += (foldArr[i] + <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    foldName = foldName.<span class="title function_">substring</span>(<span class="number">0</span>, foldName.<span class="property">length</span>-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 列出存储桶所有对象</span></span><br><span class="line">        <span class="keyword">let</span> objs = <span class="keyword">await</span> minio.<span class="title function_">listFiles</span>(foldName, point, port, bucket)   </span><br><span class="line">        <span class="keyword">return</span> objs</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JS-前台调用"><a href="#JS-前台调用" class="headerlink" title="JS 前台调用"></a>JS 前台调用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Http</span>.<span class="title function_">post</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/minio/downloadImgs&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123; <span class="attr">foldName</span>: <span class="string">&#x27;http://172.20.45.137:9000/bucket/chuang&#x27;</span> &#125;</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Http</span>.<span class="title function_">post</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/minio/uploadImgs&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123; <span class="attr">imgs</span>: [baseImg] &#125;</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> foldName = result[<span class="number">0</span>].<span class="property">bucketUrl</span> + <span class="string">&#x27;/chuang&#x27;</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="三、uniapp-文件上传"><a href="#三、uniapp-文件上传" class="headerlink" title="三、uniapp 文件上传"></a>三、uniapp 文件上传</h1><blockquote>
<p>uni-app 项目为例实现上传包括图片和视频的所有目录文件并同时支持 Android、IOS。主要实现思路如下：uni-app 没有提供文件上传组件并且不支持 input type&#x3D;”file”、uni-app App 内置 HTML5+ 引擎并提供 plus 接口，可以直接调用 Android 系统函数来打开系统目录，IOS 则没有找到方法但可以通过直接嵌入 H5 页面实现。</p>
</blockquote>
<h2 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">uploadImg</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">sizeType</span>: [<span class="string">&quot;original&quot;</span>, <span class="string">&quot;compressed&quot;</span>],</span><br><span class="line">        <span class="attr">sourceType</span>: [<span class="string">&quot;album&quot;</span>, <span class="string">&quot;camera&quot;</span>],</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// tempFilePaths：数组的元素是字符串，临时本地图片路径</span></span><br><span class="line">            <span class="comment">// tempFiles：数组元素是字典对象，临时路径 path 和图片大小 size。</span></span><br><span class="line">            <span class="keyword">let</span> tempFiles = res.<span class="property">tempFiles</span>;</span><br><span class="line">            <span class="keyword">if</span> (tempFiles.<span class="property">length</span> &gt; <span class="number">3</span>) &#123;</span><br><span class="line">                uni.<span class="title function_">showToast</span>(&#123; <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;最多上传 3 张图片&#x27;</span> &#125;)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> <span class="title class_">ImgList</span> = tempFiles.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;<span class="attr">name</span>:item.<span class="property">path</span>, <span class="attr">uri</span>:item&#125;)</span><br><span class="line">            uni.<span class="title function_">showLoading</span>(&#123; <span class="attr">mask</span>: <span class="literal">true</span>, <span class="attr">title</span>: <span class="string">&#x27;上传中...&#x27;</span> &#125;);</span><br><span class="line">            uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,        </span><br><span class="line">                <span class="attr">fileType</span>: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">                <span class="attr">files</span>: <span class="title class_">ImgList</span>,</span><br><span class="line">                <span class="attr">url</span>: that.<span class="property">base_url</span> + <span class="string">&#x27;api/imgUpload&#x27;</span>,</span><br><span class="line">                <span class="attr">header</span>: &#123; <span class="attr">token</span>: uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>) &#125;,</span><br><span class="line">                <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">                    uni.<span class="title function_">hideLoading</span>();</span><br><span class="line">                    <span class="keyword">let</span> result = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)</span><br><span class="line">                    that.<span class="property">ImgList</span> = result.<span class="property">data</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">newFile</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">fail</span>: <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!err) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">                    uni.<span class="title function_">showModal</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;失败&#x27;</span>, <span class="attr">showCancel</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">previewImg</span>(<span class="params">index</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">previewImage</span>(&#123; <span class="attr">current</span>: index, <span class="attr">urls</span>: <span class="variable language_">this</span>.<span class="property">ImgList</span>, <span class="attr">loop</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="视频上传"><a href="#视频上传" class="headerlink" title="视频上传"></a>视频上传</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">uploadVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    uni.<span class="title function_">chooseVideo</span>(&#123;</span><br><span class="line">        <span class="attr">maxDuration</span>: <span class="number">60</span>,   <span class="comment">// 最大 60s</span></span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">compressed</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">camera</span>: <span class="string">&#x27;front&#x27;</span>,   <span class="comment">// 默认 back</span></span><br><span class="line">        <span class="attr">sourceType</span>: [<span class="string">&quot;album&quot;</span>, <span class="string">&quot;camera&quot;</span>],</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            uni.<span class="title function_">showLoading</span>(&#123; <span class="attr">mask</span>: <span class="literal">true</span>, <span class="attr">title</span>: <span class="string">&quot;上传中...&quot;</span> &#125;);</span><br><span class="line">            uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">                <span class="attr">url</span>: that.<span class="property">base_url</span> + <span class="string">&#x27;api/videoUpload&#x27;</span>,</span><br><span class="line">                <span class="attr">filePath</span>: res.<span class="property">tempFilePaths</span>[<span class="number">0</span>],</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">                <span class="attr">fileType</span>: <span class="string">&quot;video&quot;</span>,</span><br><span class="line">                <span class="attr">header</span>: &#123; <span class="attr">token</span>: uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>) &#125;,</span><br><span class="line">                <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">                    uni.<span class="title function_">hideLoading</span>();</span><br><span class="line">                    <span class="keyword">let</span> result = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)</span><br><span class="line">                    that.<span class="title function_">videoCompress</span>(result.<span class="property">data</span>[<span class="number">0</span>].<span class="property">newFile</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">videoCompress (tempFilePath) &#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    uni.<span class="title function_">compressVideo</span>(&#123;</span><br><span class="line">        <span class="attr">quality</span>: <span class="string">&quot;low&quot;</span>,     <span class="comment">// medium、high</span></span><br><span class="line">        <span class="attr">src</span>: tempFilePath,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">size</span> &gt; <span class="number">1025</span> * <span class="number">1024</span> * <span class="number">10</span>) &#123;</span><br><span class="line">                that.<span class="title function_">videoCompress</span>(res.<span class="property">tempFilePath</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                that.<span class="property">videoSrc</span> = res.<span class="property">tempFilePath</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">            uni.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;压缩失败&quot;</span>, <span class="attr">icon</span>: <span class="string">&quot;none&quot;</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="文档上传"><a href="#文档上传" class="headerlink" title="文档上传"></a>文档上传</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 以七牛存储为例，将七牛上传地址和 token 配置后即可</span></span><br><span class="line">uni.<span class="title function_">chooseFile</span>(&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">extension</span>: [<span class="string">&#x27;doc&#x27;</span>, <span class="string">&#x27;xlsx&#x27;</span>, <span class="string">&#x27;ppt&#x27;</span>, <span class="string">&#x27;rar&#x27;</span>, <span class="string">&#x27;zip&#x27;</span>],</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">size</span> &gt; <span class="number">30</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">            uni.<span class="title function_">showToast</span>(&#123; <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;附件大小不能超过 30M&#x27;</span> &#125;)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;   </span><br><span class="line">        uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">            <span class="attr">filePath</span>: res.<span class="property">tempFilePaths</span>[<span class="number">0</span>], <span class="comment">// 临时地址</span></span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;七牛上传地址&#x27;</span>,</span><br><span class="line">            <span class="attr">formData</span>: &#123; <span class="attr">token</span>: <span class="string">&#x27;七牛 token&#x27;</span> &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                uni.<span class="title function_">showModal</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;成功&#x27;</span>, <span class="attr">showCancel</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!err) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">                uni.<span class="title function_">showModal</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;失败&#x27;</span>, <span class="attr">showCancel</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);      </span><br></pre></td></tr></table></figure>

<h2 id="目录文件上传"><a href="#目录文件上传" class="headerlink" title="目录文件上传"></a>目录文件上传</h2><blockquote>
<p>如果需要上传图片等系统目录文件并支持 Android&#x2F;IOS，uni-app 却没有提供文件上传组件而且不支持 <code>input type=&quot;file&quot;</code>，则可基于 WebView 模式内嵌 H5 页面进行二次开发，注意小程序平台 web-view url 需要在后台配置域名白名单。</p>
</blockquote>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// fileUpload.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">web-view</span> <span class="attr">:src</span>=<span class="string">&quot;&#x27;/hybrid/html/index.html?info=&#x27; + info&quot;</span> </span></span><br><span class="line"><span class="tag">        @<span class="attr">message</span>=<span class="string">&quot;handleMessage&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">web-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">info</span>: <span class="built_in">encodeURIComponent</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; </span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">appId</span>: <span class="string">&#x27;名称&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">appKey</span>: <span class="string">&#x27;密钥&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">dmc</span>: <span class="string">&#x27;http://dmc.yozocloud.cn&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;))</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleMessage</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> msg = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(event.<span class="property">detail</span>.<span class="property">data</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;h5 发送数据：&#x27;</span>, msg)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * @title index.html</span><br><span class="line"> * </span><br><span class="line"> * @desp  uni 组件通过 web-view 标签来实现内嵌页面</span><br><span class="line"> * @desp  使用时应放到不编译的项目目录 /hybrid/html/</span><br><span class="line"> * @desp  uni-sdk 必须引入，js-sdk 则在不需要兼容小程序时不需要</span><br><span class="line">**/</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://res.wx.qq.com/open/js/</span></span></span><br><span class="line"><span class="string"><span class="tag">jweixin-1.4.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://js.cdn.aliyun.dcloud.</span></span></span><br><span class="line"><span class="string"><span class="tag">net.cn/dev/uni-app/uni.webview.1.5.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/h5uploader.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/signclient.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">    var info = getQueryString(&#x27;info&#x27;);</span><br><span class="line">    info = JSON.parse(decodeURIComponent(info))</span><br><span class="line"></span><br><span class="line">    uni.getEnv(function(res) &#123;</span><br><span class="line">        console.log(&#x27;当前环境：&#x27;, JSON.stringify(res))</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    var btn = document.getElementById(&#x27;upload&#x27;);</span><br><span class="line">    btn.addEventListener(&quot;click&quot;, function(e) &#123;</span><br><span class="line">        H5Uploader.upload(&#123;</span><br><span class="line">            action: info.dmc + &#x27;/api/file/upload?appId=&#x27; + info.appId,</span><br><span class="line">            id: &#x27;fileBtn&#x27;,</span><br><span class="line">            size: &#123;</span><br><span class="line">                max: 50000, </span><br><span class="line">                valide: function(e)&#123; if(e)&#123; alert(e.name+&#x27;超过 5M&#x27;) &#125; &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            type: &#123;</span><br><span class="line">                name: &#x27;csv;doc;docx;xls;xltx;ppt;pptx;jpeg;jpg;png;gif;</span><br><span class="line">                bmp;tif;rar;zip;uof;uot;uos;uop;pdf;ofd;&#x27;,</span><br><span class="line">                valide: function(e)&#123; if(e)&#123; alert(e.name+&#x27;类型不支持&#x27;) &#125; &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            progress: function() &#123;</span><br><span class="line">                console.log(&#x27;上传中...&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            success: function(data) &#123;</span><br><span class="line">                var tmpJson = JSON.parse(data)</span><br><span class="line">                tmpJson.sign = generateSign(appKey, &#123;</span><br><span class="line">                    appId: [appId], </span><br><span class="line">                    fileVersionId: [tmpJson.fileVersionId]</span><br><span class="line">                &#125;);</span><br><span class="line">                uni.postMessage(&#123; data:&#123; action: tmpJson &#125; &#125;);</span><br><span class="line">                uni.navigateBack(&#123; delta: 1 &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: function(data) &#123;</span><br><span class="line">                alert(&#x27;上传失败&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, false);</span><br><span class="line"></span><br><span class="line">    function getQueryString(key) &#123;</span><br><span class="line">        var reg = new RegExp(&#x27;(^|&amp;)&#x27; + key + &#x27;=([^&amp;]*)(&amp;|$)&#x27;)</span><br><span class="line">        var r = window.location.search.substr(1).match(reg)</span><br><span class="line">        if (r != null) return unescape(r[2])</span><br><span class="line">        return null</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// signclient.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateSign</span>(<span class="params">secret, params</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> fullParamStr = <span class="title function_">uniqSortParams</span>(params);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">hmacSHA256</span>(fullParamStr, secret);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">uniqSortParams</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> params.<span class="property">sign</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> var5 = [];</span><br><span class="line">    <span class="keyword">var</span> var6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">        var5[var6] = key;</span><br><span class="line">        var6++;</span><br><span class="line">    &#125;</span><br><span class="line">    var5.<span class="title function_">sort</span>(<span class="keyword">function</span>(<span class="params">a, b</span>)&#123; <span class="keyword">return</span> a.<span class="title function_">localeCompare</span>(b, <span class="string">&#x27;zh-CN&#x27;</span>) &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> var7 = <span class="number">0</span>; var7 &lt; var5.<span class="property">length</span>; var7++) &#123;</span><br><span class="line">        <span class="keyword">var</span> key = var5[var7];</span><br><span class="line">        <span class="keyword">var</span> var8 = params[key];</span><br><span class="line">        var8.<span class="title function_">sort</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="title function_">localeCompare</span>(b, <span class="string">&#x27;zh-CN&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span> (var8 != <span class="literal">null</span> &amp;&amp; var8.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> var9 = <span class="number">0</span>; var9 &lt; var8.<span class="property">length</span>; var9++) &#123;</span><br><span class="line">                result += key + <span class="string">&quot;=&quot;</span> + var8[var9];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result += key + <span class="string">&quot;=&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hmacSHA256</span>(<span class="params">data, key</span>) &#123;</span><br><span class="line">    data != <span class="literal">null</span> ? data : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> var2 = <span class="title class_">CryptoJS</span>.<span class="title class_">HmacSHA256</span>(data, key);</span><br><span class="line">    <span class="keyword">var</span> var3 = var2.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Hex</span>);</span><br><span class="line">    <span class="keyword">return</span> var3.<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// h5uploader.js</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"><span class="variable language_">window</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">H5Uploader</span> = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createXhr</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">XMLHttpRequest</span> != <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">ActiveXObject</span> != <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">activeXString</span> != <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> versions = [<span class="string">&quot;MSXML2.XMLHttp.6.0&quot;</span>, <span class="string">&quot;MSXML2.XMLHttp.3.0&quot;</span>, </span><br><span class="line">          <span class="string">&quot;MSXML2.XMLHttp&quot;</span>];</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = versions.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(versions[i]);</span><br><span class="line">              <span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">activeXString</span> = versions[i];</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Create XHR ActiveXObject error.&#x27;</span> + e);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">activeXString</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;No XHR object avaliable.&#x27;</span> + e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">upload</span>: <span class="keyword">function</span>(<span class="params">literals</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(literals)!=<span class="string">&#x27;[object Array]&#x27;</span>)&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">handUpload</span>(literals);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; literals.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">handUpload</span>(literals[i]);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="attr">handUpload</span>: <span class="keyword">function</span>(<span class="params">literals</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (literals.<span class="property">action</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;upload action address option is undefined.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="title function_">createXhr</span>();</span><br><span class="line">        xhr.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, literals.<span class="property">action</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// xhr.setRequestHeader(&quot;Content-Type&quot;, &quot;multipart/form-data&quot;);</span></span><br><span class="line">        <span class="comment">// xhr.setRequestHeader(&quot;X-Requested-With&quot;, &quot;XMLHttpRequest&quot;);</span></span><br><span class="line">        xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (xhr.<span class="property">readyState</span> != <span class="number">4</span>) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">            <span class="keyword">var</span> body = xhr.<span class="property">responseText</span>;</span><br><span class="line">            <span class="keyword">if</span> ( xhr.<span class="property">status</span>==<span class="number">200</span> &amp;&amp; literals.<span class="property">success</span>) &#123;</span><br><span class="line">                literals.<span class="title function_">success</span>(body);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (literals) &#123;</span><br><span class="line">                literals.<span class="title function_">fail</span>(body);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!literals.<span class="property">id</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;The file id option is undefined.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> data = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">        <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(literals.<span class="property">id</span>);</span><br><span class="line">        <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;file element is undefined:&#x27;</span> + literals.<span class="property">id</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> name = file.<span class="title function_">getAttribute</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!name) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;file input name is undefined.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (literals.<span class="property">size</span>) &#123;   <span class="comment">// Check file Size</span></span><br><span class="line">          <span class="keyword">var</span> evt = <span class="variable language_">this</span>.<span class="title function_">checkSize</span>(file.<span class="property">files</span>, literals.<span class="property">size</span>.<span class="property">max</span>);</span><br><span class="line">          <span class="keyword">if</span> (evt) &#123;</span><br><span class="line">            <span class="keyword">if</span> (literals.<span class="property">size</span>.<span class="property">valide</span>) literals.<span class="property">size</span>.<span class="title function_">valide</span>(evt);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;file size exceed max value.&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (literals.<span class="property">type</span>) &#123;   <span class="comment">// Check file type</span></span><br><span class="line">          <span class="keyword">var</span> evt1 = <span class="variable language_">this</span>.<span class="title function_">checkType</span>(file.<span class="property">files</span>, literals.<span class="property">type</span>.<span class="property">name</span>);</span><br><span class="line">          <span class="keyword">if</span> (evt1) &#123;</span><br><span class="line">            <span class="keyword">if</span> (literals.<span class="property">type</span>.<span class="property">valide</span>) literals.<span class="property">type</span>.<span class="title function_">valide</span>(evt1);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;file type is error.&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (literals.<span class="property">progress</span>) &#123;   <span class="comment">// Progress</span></span><br><span class="line">          literals.<span class="title function_">progress</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; file.<span class="property">files</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          data.<span class="title function_">append</span>(name, file.<span class="property">files</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          xhr.<span class="title function_">send</span>(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Validate file size</span></span><br><span class="line">      <span class="attr">checkSize</span>: <span class="keyword">function</span>(<span class="params">file, size</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; file.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (file[i].<span class="property">size</span> &gt; size * <span class="number">1024</span>) &#123; <span class="comment">// bytes</span></span><br><span class="line">            <span class="keyword">return</span> file[i];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Validate file type</span></span><br><span class="line">      <span class="attr">checkType</span>: <span class="keyword">function</span>(<span class="params">file, type</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; file.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> arr = file[i].<span class="property">name</span>.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">          <span class="keyword">if</span> (type.<span class="title function_">indexOf</span>(arr[arr.<span class="property">length</span> - <span class="number">1</span>]) === -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> file[i];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)();</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="variable language_">window</span>);</span><br></pre></td></tr></table></figure>


<h1 id="四、补丁版本管理"><a href="#四、补丁版本管理" class="headerlink" title="四、补丁版本管理"></a>四、补丁版本管理</h1><h2 id="补丁下载"><a href="#补丁下载" class="headerlink" title="补丁下载"></a>补丁下载</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> $scope.<span class="property">downloadFile</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">let</span> record = $scope.<span class="property">Module</span>.<span class="property">SystemManager</span>.<span class="property">FocusedRecord</span>;</span><br><span class="line">     <span class="keyword">if</span> (<span class="title function_">toNum</span>(record.<span class="property">NewVersion</span>) == <span class="title function_">toNum</span>(record.<span class="property">Version</span> || <span class="string">&#x27;0.0.0&#x27;</span>)) &#123;</span><br><span class="line">         <span class="title class_">BaseFunction</span>.<span class="title function_">alert</span>(<span class="string">&#x27;该版本是最新补丁！&#x27;</span>, <span class="string">&#x27;补丁下载错误&#x27;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// 补丁备份</span></span><br><span class="line">     <span class="keyword">let</span> <span class="title class_">FilePaths</span> = [&#123;</span><br><span class="line">         <span class="title class_">OldPath</span>: <span class="string">&#x27;/downloads/umif-pc.zip&#x27;</span>,</span><br><span class="line">         <span class="title class_">NewPath</span>: <span class="string">&#x27;/downloads/umif-pc-back.zip&#x27;</span></span><br><span class="line">     &#125;];</span><br><span class="line">     <span class="keyword">let</span> appStoreUrl = <span class="string">&#x27;u9cmes.diwork.com&#x27;</span></span><br><span class="line">     <span class="keyword">let</span> ip = appStoreUrl.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">     <span class="keyword">let</span> prefix = <span class="title function_">verifyIp</span>(ip) ? <span class="string">&#x27;http://&#x27;</span> : <span class="string">&#x27;https://&#x27;</span>;</span><br><span class="line">     <span class="keyword">let</span> params = &#123;</span><br><span class="line">         <span class="title class_">ServerPath</span>: <span class="string">`<span class="subst">$&#123;prefix&#125;</span><span class="subst">$&#123;appStoreUrl&#125;</span>/api/App/getFileStream`</span>,</span><br><span class="line">         <span class="title class_">DownloadFileName</span>: <span class="string">&#x27;umif-pc.zip&#x27;</span>,  <span class="comment">// 文件全名</span></span><br><span class="line">         <span class="title class_">FileName</span>: <span class="literal">null</span>,                   <span class="comment">// 本地保存文件名，默认为源文件名称</span></span><br><span class="line">         <span class="title class_">DeleteFileName</span>: <span class="literal">null</span>,             <span class="comment">// 本地要删除的文件名，可空</span></span><br><span class="line">         <span class="title class_">SocketId</span>: <span class="literal">null</span>                    <span class="comment">// 通过 Socket 向前端通知过程</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="title class_">BaseFunction</span>.<span class="title function_">request</span>(<span class="string">&#x27;/api/base/fileRenames&#x27;</span>, &#123;<span class="title class_">FilePaths</span>&#125;)</span><br><span class="line">     .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="title class_">BaseFunction</span>.<span class="title function_">request</span>(<span class="string">&#x27;/api/base/downloadFile&#x27;</span>, params)</span><br><span class="line">     &#125;)</span><br><span class="line">     .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;下载成功&#x27;</span>);</span><br><span class="line">     &#125;)</span><br><span class="line">     .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;fileName&#125;</span>下载失败：<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">     &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 校验url是否是IP</span></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">verifyIp</span>(<span class="params">ip = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="regexp">/^(([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])(\.(?!$)|(?=$)))&#123;4&#125;$/</span>.<span class="title function_">test</span>(ip);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">toNum</span>(<span class="params">a</span>) &#123;</span><br><span class="line">     <span class="keyword">var</span> a = a.<span class="title function_">toString</span>();</span><br><span class="line">     <span class="keyword">var</span> c = a.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);     <span class="comment">// a.split(/\./);</span></span><br><span class="line">     <span class="keyword">var</span> num_place = [<span class="string">&quot;&quot;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;00&quot;</span>, <span class="string">&quot;000&quot;</span>, <span class="string">&quot;0000&quot;</span>],</span><br><span class="line">       r = num_place.<span class="title function_">reverse</span>();</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; c.<span class="property">length</span>; i++) &#123;</span><br><span class="line">       <span class="keyword">var</span> len = c[i].<span class="property">length</span>;</span><br><span class="line">       c[i] = r[len] + c[i];</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> c.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 文件重命名</span></span><br><span class="line"> <span class="built_in">exports</span>.<span class="property">fileRenames</span> = <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">     <span class="keyword">var</span> newErr = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">     newErr.<span class="property">leval</span> = <span class="number">5</span>;</span><br><span class="line">     newErr.<span class="property">title</span> = <span class="string">&#x27;文件重命名失败&#x27;</span>;</span><br><span class="line">     newErr.<span class="property">message</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> excuteCount = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">var</span> parameter = req.<span class="property">body</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; parameter.<span class="property">FilePaths</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">         <span class="keyword">let</span> oldPath = process.<span class="title function_">cwd</span>() + parameter.<span class="property">FilePaths</span>[i].<span class="property">OldPath</span>;</span><br><span class="line">         <span class="keyword">let</span> newPath = process.<span class="title function_">cwd</span>() + parameter.<span class="property">FilePaths</span>[i].<span class="property">NewPath</span>;</span><br><span class="line">         <span class="title function_">fileRename</span>(oldPath, newPath, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">             <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                 newErr.<span class="property">message</span> += (<span class="string">&quot;\r\n&quot;</span> + oldPath);</span><br><span class="line">             &#125;</span><br><span class="line">             excuteCount++;</span><br><span class="line">             <span class="keyword">if</span> (excuteCount == parameter.<span class="property">FilePaths</span>.<span class="property">length</span>) &#123;</span><br><span class="line">                 <span class="keyword">if</span> (newErr.<span class="property">message</span> != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                   newErr.<span class="property">message</span> = <span class="string">&quot;失败文件：&quot;</span> + newErr.<span class="property">message</span>;</span><br><span class="line">                   res.<span class="title function_">json</span>(&#123; <span class="title class_">Error</span>: newErr &#125;);</span><br><span class="line">                 &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: excuteCount &#125;);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">fileRename</span>(<span class="params">oldPath, newPath, completeFun</span>) &#123;</span><br><span class="line">     fs.<span class="title function_">exists</span>(oldPath, <span class="keyword">function</span>(<span class="params">isExists</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (isExists) &#123;</span><br><span class="line">             fs.<span class="title function_">rename</span>(oldPath, newPath, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                 completeFun &amp;&amp; <span class="title function_">completeFun</span>(err);</span><br><span class="line">             &#125;);</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">var</span> newErr = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">             newErr.<span class="property">leval</span> = <span class="number">0</span>;</span><br><span class="line">             newErr.<span class="property">title</span> = <span class="string">&#x27;重命名失败&#x27;</span>;</span><br><span class="line">             newErr.<span class="property">message</span> = <span class="string">&#x27;文件不存在&#x27;</span>;</span><br><span class="line">             completeFun &amp;&amp; <span class="title function_">completeFun</span>(newErr);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 下载文件，从别的服务器下载文件</span></span><br><span class="line"> <span class="built_in">exports</span>.<span class="property">downloadFile</span> = <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">     <span class="keyword">var</span> params = req.<span class="property">body</span>;</span><br><span class="line">     <span class="title function_">downloadFile</span>(params.<span class="property">ServerPath</span>, params.<span class="property">DownloadFileName</span>, </span><br><span class="line">     params.<span class="property">FileName</span>, params.<span class="property">DeleteFileName</span>, params.<span class="property">SocketId</span>, </span><br><span class="line">     <span class="keyword">function</span>(<span class="params">err, file</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">             res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: file &#125;);</span><br><span class="line">             <span class="keyword">return</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">var</span> newErr = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">         newErr.<span class="property">leval</span> = <span class="number">5</span>;</span><br><span class="line">         newErr.<span class="property">title</span> = <span class="string">&#x27;下载失败&#x27;</span>;</span><br><span class="line">         newErr.<span class="property">message</span> = <span class="string">&#x27;未能连接上下载服务器&#x27;</span>;</span><br><span class="line">         <span class="title class_">BaseFun</span>.<span class="title function_">errorLog</span>(<span class="string">&#x27;补丁下载失败：&#x27;</span>, err.<span class="property">message</span>);</span><br><span class="line">         res.<span class="title function_">json</span>(&#123; <span class="title class_">Error</span>: newErr &#125;);</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">downloadFile</span>(<span class="params">serverPath, downloadFileName, fileName, </span></span><br><span class="line"><span class="params"> deleteFileName, socketId, returnHandle</span>) &#123;</span><br><span class="line">     <span class="keyword">var</span> isHttps = serverPath.<span class="title function_">indexOf</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line">     serverPath = serverPath.<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">     fileName = fileName || downloadFileName;</span><br><span class="line">     <span class="keyword">if</span> (serverPath.<span class="title function_">indexOf</span>(<span class="string">&#x27;//&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">         serverPath = serverPath.<span class="title function_">split</span>(<span class="string">&#x27;//&#x27;</span>)[<span class="number">1</span>];   <span class="comment">// 去掉 http 头</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// 文件服务器信息</span></span><br><span class="line">     <span class="keyword">var</span> serverAddress = serverPath.<span class="title function_">substring</span>(<span class="number">0</span>, serverPath.<span class="title function_">indexOf</span>(<span class="string">&#x27;/&#x27;</span>)); </span><br><span class="line">     <span class="keyword">var</span> serverApiPath = serverPath.<span class="title function_">substring</span>(serverPath.<span class="title function_">indexOf</span>(<span class="string">&#x27;/&#x27;</span>), </span><br><span class="line">     serverPath.<span class="property">length</span>);</span><br><span class="line">     <span class="keyword">var</span> serverHostName = serverAddress;</span><br><span class="line">     <span class="keyword">var</span> serverPort = <span class="number">80</span>;</span><br><span class="line">     <span class="keyword">if</span> (serverAddress.<span class="title function_">indexOf</span>(<span class="string">&#x27;:&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         serverHostName = serverAddress.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">         serverPort = <span class="built_in">parseInt</span>(serverAddress.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">var</span> <span class="title class_">FilePath</span> = config.<span class="property">System</span>.<span class="property">FilePath</span> || <span class="string">&#x27;./downloads/&#x27;</span></span><br><span class="line">     <span class="keyword">var</span> fileFullPath = <span class="title class_">FilePath</span> + fileName;</span><br><span class="line">     <span class="keyword">var</span> fileWriteStream = fs.<span class="title function_">createWriteStream</span>(fileFullPath + <span class="string">&#x27;.temp&#x27;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> parameter = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="title class_">FileName</span>: fileName &#125;);</span><br><span class="line">     <span class="keyword">if</span> (isHttps &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">       <span class="keyword">var</span> options = &#123;</span><br><span class="line">           <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;hostname&#x27;</span>: serverHostName,</span><br><span class="line">           <span class="string">&#x27;path&#x27;</span>: serverApiPath,</span><br><span class="line">           <span class="string">&#x27;maxRedirects&#x27;</span>: <span class="number">20</span>,</span><br><span class="line">           <span class="string">&#x27;headers&#x27;</span>: &#123;</span><br><span class="line">             <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;acw_tc=2760827916413586286573778e6933772&#x27;</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">       <span class="comment">// let https = require(&#x27;https&#x27;);</span></span><br><span class="line">       <span class="keyword">var</span> req = https.<span class="title function_">request</span>(options, <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">           <span class="keyword">var</span> eventName;</span><br><span class="line"></span><br><span class="line">           res.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">               fileWriteStream.<span class="title function_">write</span>(data);</span><br><span class="line">               <span class="keyword">if</span> (!socketId) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">               eventName = downloadFileName + <span class="string">&quot;_DownloadSize&quot;</span></span><br><span class="line">               socket.<span class="title function_">emitBySocketId</span>(socketId, eventName, data.<span class="property">length</span>);</span><br><span class="line">           &#125;);</span><br><span class="line"></span><br><span class="line">           res.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">               fileWriteStream.<span class="title function_">end</span>();</span><br><span class="line">               <span class="keyword">if</span> (deleteFileName) &#123;</span><br><span class="line">                   fs.<span class="title function_">unlinkSync</span>(<span class="title class_">FilePath</span> + deleteFileName); <span class="comment">// 删除已有文件</span></span><br><span class="line">               &#125;</span><br><span class="line">               fs.<span class="title function_">renameSync</span>(fileFullPath + <span class="string">&#x27;.temp&#x27;</span>, fileFullPath);</span><br><span class="line">               <span class="keyword">if</span> (socketId) &#123;</span><br><span class="line">                   eventName = downloadFileName + <span class="string">&quot;_DownloadComplete&quot;</span></span><br><span class="line">                   socket.<span class="title function_">emitBySocketId</span>(socketId, eventName, <span class="literal">true</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="title function_">returnHandle</span>(<span class="literal">null</span>, &#123; <span class="title class_">FileName</span>: fileName &#125;);</span><br><span class="line">           &#125;);</span><br><span class="line"></span><br><span class="line">           res.<span class="title function_">on</span>(<span class="string">&quot;error&quot;</span>, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">           &#125;);</span><br><span class="line">         &#125;);</span><br><span class="line">         req.<span class="title function_">write</span>(parameter);</span><br><span class="line">         req.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">             <span class="title function_">returnHandle</span>(err);</span><br><span class="line">         &#125;);</span><br><span class="line">         req.<span class="title function_">end</span>();</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">var</span> options = &#123;</span><br><span class="line">             <span class="attr">hostname</span>: serverHostName,</span><br><span class="line">             <span class="attr">port</span>: serverPort,</span><br><span class="line">             <span class="attr">path</span>: serverApiPath,</span><br><span class="line">             <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">             <span class="attr">headers</span>: &#123;</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Length&quot;</span>: parameter.<span class="property">length</span>,</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;;</span><br><span class="line">         <span class="keyword">var</span> fileFullPath = <span class="title class_">FilePath</span> + fileName;</span><br><span class="line">         <span class="keyword">var</span> fileWriteStream = fs.<span class="title function_">createWriteStream</span>(fileFullPath + <span class="string">&#x27;.temp&#x27;</span>);</span><br><span class="line">         <span class="keyword">var</span> httpRequest = http.<span class="title function_">request</span>(options, <span class="keyword">function</span>(<span class="params">httpResponse</span>) &#123;</span><br><span class="line">             httpResponse.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">                 fileWriteStream.<span class="title function_">write</span>(data);</span><br><span class="line">                 <span class="keyword">if</span> (!socketId) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">                 eventName = downloadFileName + <span class="string">&quot;_DownloadSize&quot;</span></span><br><span class="line">                 socket.<span class="title function_">emitBySocketId</span>(socketId, eventName, data.<span class="property">length</span>);</span><br><span class="line">             &#125;);</span><br><span class="line">             httpResponse.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                 fileWriteStream.<span class="title function_">end</span>();</span><br><span class="line">                 <span class="keyword">if</span> (deleteFileName) &#123;</span><br><span class="line">                     fs.<span class="title function_">unlinkSync</span>(<span class="title class_">FilePath</span> + deleteFileName);</span><br><span class="line">                 &#125;</span><br><span class="line">                 fs.<span class="title function_">renameSync</span>(fileFullPath + <span class="string">&#x27;.temp&#x27;</span>, fileFullPath);</span><br><span class="line">                 <span class="keyword">if</span> (socketId) &#123;</span><br><span class="line">                     eventName = downloadFileName + <span class="string">&quot;_DownloadComplete&quot;</span></span><br><span class="line">                     socket.<span class="title function_">emitBySocketId</span>(socketId, eventName, <span class="literal">true</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="title function_">returnHandle</span>(<span class="literal">null</span>, &#123; <span class="title class_">FileName</span>: fileName &#125;);</span><br><span class="line">             &#125;);</span><br><span class="line">         &#125;);</span><br><span class="line">         httpRequest.<span class="title function_">write</span>(parameter);</span><br><span class="line">         httpRequest.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">             <span class="title function_">returnHandle</span>(err);</span><br><span class="line">         &#125;);</span><br><span class="line">         httpRequest.<span class="title function_">end</span>();</span><br><span class="line">       &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// socket.js</span></span><br><span class="line"> <span class="keyword">var</span> <span class="title class_">BaseConst</span> = <span class="built_in">require</span>(<span class="string">&#x27;./Const&#x27;</span>),</span><br><span class="line"><span class="title class_">BaseFun</span> = <span class="built_in">require</span>(<span class="string">&#x27;./Function&#x27;</span>),</span><br><span class="line">http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>),</span><br><span class="line">socketIo = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>)(http);</span><br><span class="line"> <span class="keyword">var</span> clientList = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 发送给指定连接</span></span><br><span class="line"> <span class="built_in">exports</span>.<span class="property">emitBySocketId</span> = <span class="keyword">function</span>(<span class="params">socketId, eventName, data</span>)&#123;</span><br><span class="line">     <span class="keyword">if</span> (clientList.<span class="title function_">hasOwnProperty</span>(socketId)) &#123;</span><br><span class="line">         clientList[socketId].<span class="title function_">emit</span>(eventName, data);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 广播给所有人</span></span><br><span class="line"> <span class="built_in">exports</span>.<span class="property">emit</span> = <span class="keyword">function</span>(<span class="params">eventName, data</span>)&#123;</span><br><span class="line">     socketIo.<span class="title function_">emit</span>(eventName, data);</span><br><span class="line"> &#125;;</span><br><span class="line"> <span class="comment">// 广播给该房间的所有人，包括自己</span></span><br><span class="line"> <span class="built_in">exports</span>.<span class="property">emitRoom</span> = <span class="keyword">function</span>(<span class="params">eventName, roomName, data</span>)&#123;</span><br><span class="line">     socketIo.<span class="title function_">in</span>(roomName).<span class="title function_">emit</span>(eventName, data);</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">exports</span>.<span class="property">create</span> = <span class="keyword">function</span>(<span class="params">socketPort</span>)&#123;</span><br><span class="line">     <span class="keyword">var</span> server = http.<span class="title function_">createServer</span>().<span class="title function_">listen</span>(socketPort);</span><br><span class="line">     socketIo.<span class="title function_">listen</span>(server);</span><br><span class="line"></span><br><span class="line">     socketIo.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="keyword">function</span>(<span class="params">socket</span>) &#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(!clientList.<span class="title function_">hasOwnProperty</span>(socket.<span class="property">id</span>))&#123;</span><br><span class="line">           clientList[socket.<span class="property">id</span>] = socket;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 发给自己</span></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;toSelf&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">           socket.<span class="title function_">emit</span>(data.<span class="property">EventName</span>, data.<span class="property">Data</span>);	</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="comment">// 发送除自己的其他所有人</span></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;toOther&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">           socket.<span class="property">broadcast</span>.<span class="title function_">emit</span>(data.<span class="property">EventName</span>, data.<span class="property">Data</span>);		</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="comment">// 发给所有人，包括自己</span></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;toAll&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">           socketIo.<span class="title function_">emit</span>(data.<span class="property">EventName</span>, data.<span class="property">Data</span>);	</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;joinRoom&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">           socket.<span class="title function_">join</span>(data.<span class="property">RoomName</span>);</span><br><span class="line">       &#125;);</span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;leaveRoom&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">           socket.<span class="title function_">leave</span>(data.<span class="property">RoomName</span>);</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="comment">// 向一个房间广播消息（发送者收不到消息)</span></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;toRoom&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">           socket.<span class="property">broadcast</span>.<span class="title function_">to</span>(data.<span class="property">RoomName</span>).<span class="title function_">emit</span>(data.<span class="property">EventName</span>, data.<span class="property">Data</span>);</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="comment">// 向一个房间广播消息（包括发送者都能收到消息)</span></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;inRoom&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">           socketIo.<span class="title function_">in</span>(data.<span class="property">RoomName</span>).<span class="title function_">emit</span>(data.<span class="property">EventName</span>, data.<span class="property">Data</span>);		</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;disconnect&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;disconnect&#x27;</span>);</span><br><span class="line">           <span class="keyword">if</span> (clientList.<span class="title function_">hasOwnProperty</span>(socket.<span class="property">id</span>)) &#123;</span><br><span class="line">               socket.<span class="title function_">disconnect</span>();</span><br><span class="line">               <span class="keyword">delete</span> clientList[socket.<span class="property">id</span>];</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="comment">// 程序调用，主动断开</span></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;clientDisconnect&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clientDisconnect&#x27;</span>);</span><br><span class="line">           socket.<span class="title function_">ondisconnect</span>();</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       socket.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (!err) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="title class_">BaseFun</span>.<span class="title function_">errorLog</span>(<span class="string">&quot;Scoket错误&quot;</span>, <span class="string">&quot;Socket异常关闭&quot;</span>);</span><br><span class="line">           &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (clientList.<span class="title function_">hasOwnProperty</span>(socket.<span class="property">id</span>)) &#123;</span><br><span class="line">               <span class="keyword">delete</span> clientList[socket.<span class="property">id</span>];</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;即时通信服务开启，端口号：&quot;</span> + socketPort);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<h2 id="补丁更新"><a href="#补丁更新" class="headerlink" title="补丁更新"></a>补丁更新</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$scope.<span class="property">updateFile</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">BaseService</span>.<span class="title function_">filesUnzip</span>(<span class="string">&#x27;/downloads/umif-pc.zip&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> record = $scope.<span class="property">Module</span>.<span class="property">SystemManager</span>.<span class="property">FocusedRecord</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">toNum</span>(record.<span class="property">NewVersion</span>) &gt; <span class="title function_">toNum</span>(record.<span class="property">Version</span> || <span class="string">&#x27;0.0.0&#x27;</span>))&#123;</span><br><span class="line">            record.<span class="property">OldVersion</span> = record.<span class="property">Version</span>;</span><br><span class="line">            record.<span class="property">OldRemark</span> = record.<span class="property">Remark</span></span><br><span class="line">            record.<span class="property">Version</span> = record.<span class="property">NewVersion</span>;</span><br><span class="line">            record.<span class="property">Remark</span> = record.<span class="property">NewRemark</span>;</span><br><span class="line">            record.<span class="property">UpdateTime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">            $scope.<span class="property">Module</span>.<span class="property">SystemManager</span>.<span class="title function_">save</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            record.<span class="property">OldVersion</span> = record.<span class="property">Version</span>;</span><br><span class="line">            record.<span class="property">OldRemark</span> = record.<span class="property">Remark</span></span><br><span class="line">            record.<span class="property">Version</span> = record.<span class="property">NewVersion</span>;</span><br><span class="line">            record.<span class="property">Remark</span> = record.<span class="property">NewRemark</span>;</span><br><span class="line">            record.<span class="property">UpdateTime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">            $scope.<span class="property">Module</span>.<span class="property">SystemManager</span>.<span class="title function_">save</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">SystemManagerService</span>.<span class="title function_">updateTenantAppVersion</span>(&#123;</span><br><span class="line">            <span class="attr">tenantCode</span>: <span class="string">&#x27;tenant&#x27;</span>,</span><br><span class="line">            <span class="attr">appId</span>: <span class="string">&#x27;umif-pc&#x27;</span>,</span><br><span class="line">            <span class="attr">version</span>: record.<span class="property">NewVersion</span>,</span><br><span class="line">            <span class="attr">remark</span>: record.<span class="property">NewRemark</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">        <span class="title class_">BaseFunction</span>.<span class="title function_">alert</span>(error, <span class="string">&#x27;补丁更新错误&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">filesUnzip</span> = <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> parameter = req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">var</span> zipPath = process.<span class="title function_">cwd</span>() + parameter.<span class="property">zip</span>;</span><br><span class="line">    <span class="keyword">var</span> unzipPath = process.<span class="title function_">cwd</span>() + parameter.<span class="property">unzip</span>;</span><br><span class="line">    <span class="keyword">var</span> unzipExtractor = unzip.<span class="title class_">Extract</span>(&#123; <span class="attr">path</span>: unzipPath &#125;);</span><br><span class="line">    fs.<span class="title function_">exists</span>(path, <span class="keyword">function</span>(<span class="params">isExists</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isExist) &#123;</span><br><span class="line">            fs.<span class="title function_">createReadStream</span>(zipPath).<span class="title function_">pipe</span>(unzipExtractor);</span><br><span class="line">            unzipExtractor.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                res.<span class="title function_">json</span>(&#123; <span class="title class_">Error</span>: err &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            unzipExtractor.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: <span class="string">&#x27;close&#x27;</span> &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: <span class="string">&#x27;close&#x27;</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新 AppStore 上的租户的补丁版本</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">updateTenantAppVersion</span> = <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> param = req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">let</span> port = req.<span class="property">headers</span>.<span class="property">host</span>.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data = <span class="keyword">await</span> <span class="title function_">updateTenantAppVersion</span>(param.<span class="property">tenantCode</span>, </span><br><span class="line">        param.<span class="property">appId</span>, param.<span class="property">version</span>, param.<span class="property">remark</span>, port);</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: data, <span class="title class_">Error</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: <span class="literal">null</span>, <span class="title class_">Error</span>: error &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 远程调用更新 TenantAppVersion</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateTenantAppVersion</span>(<span class="params">tenantCode, appId, version, </span></span><br><span class="line"><span class="params">    remark, port1</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> param = <span class="keyword">await</span> entityFun.<span class="title function_">findOne</span>(<span class="string">&#x27;Parameter&#x27;</span>, &#123;<span class="title class_">Code</span>: <span class="string">&#x27;AppStore&#x27;</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span> (!param) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> url = param.<span class="property">Value</span>;</span><br><span class="line">    <span class="keyword">let</span> ip = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> port = <span class="number">80</span>;</span><br><span class="line">    <span class="keyword">if</span> (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;:&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        ip = url.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        port = url.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ip = url;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> options = &#123;</span><br><span class="line">        <span class="attr">hostname</span>: ip,</span><br><span class="line">        <span class="attr">port</span>: port,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;Post&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/api/tenant/httpUpdateTenantAppVersion&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> data = &#123;</span><br><span class="line">        <span class="attr">tenantCode</span>: tenantCode,</span><br><span class="line">        <span class="attr">appId</span>: appId,</span><br><span class="line">        <span class="attr">version</span>: version,</span><br><span class="line">        <span class="attr">remark</span>: remark,</span><br><span class="line">        <span class="attr">envType</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">port</span>: port1</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">BaseFun</span>.<span class="title function_">verifyIp</span>(ip)) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title class_">BaseFun</span>.<span class="title function_">requestHttp</span>(options, data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> url = <span class="string">&#x27;https://&#x27;</span> + options.<span class="property">hostname</span> + options.<span class="property">path</span>;</span><br><span class="line">        <span class="keyword">await</span> <span class="title class_">BaseFun</span>.<span class="title function_">axios</span>(options.<span class="property">method</span>, url, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">requestHttp</span> = <span class="keyword">function</span>(<span class="params">options, parameter, isParse</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!options.<span class="property">path</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> newErr = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">            newErr.<span class="property">leval</span> = <span class="number">9</span>;</span><br><span class="line">            newErr.<span class="property">title</span> = <span class="string">&#x27;请求服务器错误&#x27;</span>;</span><br><span class="line">            newErr.<span class="property">message</span> = <span class="string">&#x27;没有传入路径参数&#x27;</span>;</span><br><span class="line">            <span class="title function_">reject</span>(newErr);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (parameter) &#123;</span><br><span class="line">            parameter = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(parameter);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!options.<span class="property">hostname</span>) &#123;</span><br><span class="line">            options.<span class="property">hostname</span> = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!options.<span class="property">port</span>) &#123;</span><br><span class="line">            options.<span class="property">port</span> = <span class="number">3000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!options.<span class="property">method</span>) &#123;</span><br><span class="line">            options.<span class="property">method</span> = <span class="string">&#x27;POST&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!options.<span class="property">headers</span>) &#123;</span><br><span class="line">            options.<span class="property">headers</span> = &#123; <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> req = http.<span class="title function_">request</span>(options, <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">                result += data;</span><br><span class="line">            &#125;).<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    result = isParse ? result : <span class="title class_">JSON</span>.<span class="title function_">parse</span>(result);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">                    result = &#123; <span class="title class_">Error</span>: result &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (result.<span class="property">Error</span>) &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(result.<span class="property">Error</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result.<span class="property">Data</span>) &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(result.<span class="property">Data</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (parameter) &#123;</span><br><span class="line">            req.<span class="title function_">write</span>(parameter);</span><br><span class="line">        &#125;</span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err);</span><br><span class="line">        &#125;);</span><br><span class="line">        req.<span class="title function_">end</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="补丁还原"><a href="#补丁还原" class="headerlink" title="补丁还原"></a>补丁还原</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$scope.<span class="property">reductionFile</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">BaseService</span>.<span class="title function_">filesUnzip</span>(<span class="string">&#x27;/downloads/umif-pc-back.zip&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, </span><br><span class="line">    <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> record = $scope.<span class="property">Module</span>.<span class="property">SystemManager</span>.<span class="property">FocusedRecord</span>;</span><br><span class="line">        record.<span class="property">Version</span> = record.<span class="property">OldVersion</span>;</span><br><span class="line">        record.<span class="property">Remark</span> = record.<span class="property">OldRemark</span>;</span><br><span class="line">        record.<span class="property">UpdateTime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        $scope.<span class="property">Module</span>.<span class="property">SystemManager</span>.<span class="title function_">save</span>();</span><br><span class="line">        <span class="keyword">let</span> param = &#123;</span><br><span class="line">            <span class="attr">tenantCode</span>: <span class="string">&#x27;tenant&#x27;</span>,</span><br><span class="line">            <span class="attr">appId</span>: <span class="string">&#x27;umif-pc&#x27;</span>,</span><br><span class="line">            <span class="attr">version</span>: record.<span class="property">OldVersion</span>,</span><br><span class="line">            <span class="attr">remark</span>: record.<span class="property">NewRemark</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">SystemManagerService</span>.<span class="title function_">updateTenantAppVersion</span>(param);</span><br><span class="line">    &#125;, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">        <span class="title class_">BaseFunction</span>.<span class="title function_">alert</span>(error, <span class="string">&#x27;补丁更新错误&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>百度智能云之在线识别</title>
    <url>/2023/01/10/19-%E7%99%BE%E5%BA%A6%E8%AF%86%E5%88%AB/</url>
    <content><![CDATA[<h1 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h1><ul>
<li><strong>Android、IOS 证书</strong><ul>
<li>Android 平台签名证书：打包发布 apk 时用来签名的数字证书（.keystore)。</li>
<li>IOS 开发证书：用于 APP 测试时安装到苹果手机真机的运行情况。</li>
<li>IOS 发布证书：用于 APP 上线时打包 ipa 并上传到 App Store。</li>
</ul>
</li>
<li><strong>百度智能云</strong><ul>
<li>获取密钥：<a href="https://ai.baidu.com/">百度AI开放平台</a>、注册&#x2F;登录、实名认证、人脸识别、创建应用。</li>
<li>领取额度：<a href="https://console.bce.baidu.com/ai/?_=1668753171812#/ai/face/overview/index">人脸识别</a>、<a href="https://console.bce.baidu.com/ai/?_=1668753171812#/ai/speech/overview/index">文字识别</a>、<a href="https://console.bce.baidu.com/ai/?_=1668753171812#/ai/ocr/overview/index">语音识别</a>。</li>
<li>查看文档：<a href="https://ai.baidu.com/ai-doc/FACE/yk37c1u4t">人脸识别</a>、<a href="https://cloud.baidu.com/doc/OCR/s/Ek3h7xypm">文字识别</a>、<a href="https://ai.baidu.com/ai-doc/SPEECH/Ek39uxgre">语音识别</a>。</li>
</ul>
</li>
<li><strong>引用插件和申请权限</strong><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 插件库：人脸检测库 tracking、脸部追踪 face</span></span><br><span class="line">&lt;script src=<span class="string">&quot;js/tracking/tracking.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/tracking/face.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 系统权限：联网、查看网络状态、录像、录音、音量修改、拍照</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECORD_VIDEO&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECORD_AUDIO&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.MODIFY_AUDIO_SETTINGS&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CAMERA&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用权限：每次安装后都需要重新设置</span></span><br><span class="line">智能工厂的权限设置、设置、应用和通知、权限管理器、允许麦克风/相机权限</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="二、接口封装"><a href="#二、接口封装" class="headerlink" title="二、接口封装"></a>二、接口封装</h1>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable constant_">APP_ID</span> = <span class="string">&quot;28095556&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">API_KEY</span> = <span class="string">&quot;Tdi9l1a4jl7U0V1DsFz7AWpj&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">SECRET_KEY</span> = <span class="string">&quot;v3I7gbR6PGxB978k8RsHzNQvyB2o7gbQ&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> baiduAipSdk = <span class="built_in">require</span>(<span class="string">&quot;baidu-aip-sdk&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">FaceClient</span> = <span class="keyword">new</span> baiduAipSdk.<span class="title function_">face</span>(<span class="variable constant_">APP_ID</span>, <span class="variable constant_">API_KEY</span>, <span class="variable constant_">SECRET_KEY</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">OcrClient</span> = <span class="keyword">new</span> baiduAipSdk.<span class="title function_">ocr</span>(<span class="variable constant_">APP_ID</span>, <span class="variable constant_">API_KEY</span>, <span class="variable constant_">SECRET_KEY</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">SpeechClient</span> = <span class="keyword">new</span> baiduAipSdk.<span class="title function_">speech</span>(<span class="variable constant_">APP_ID</span>, <span class="variable constant_">API_KEY</span>, <span class="variable constant_">SECRET_KEY</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 人脸检测</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> <span class="variable">method</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> <span class="variable">image</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> imageType：BASE64/URL/FACE_TOKEN，默认 base64</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> userId：最多注册 20 个人脸</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> groupId：对应多个 user_id 的用户组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> groupIdList：从指定的 group 查找，用逗号分隔 (上限十个)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> faceToken：人脸图片的唯一标识</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  请求体格式化：Content-Type: application/json</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  Base64 图片：去掉头部 data:image/png;base64,</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  图片格式：支持 png/jpg/bmp/jpeg，不支持 gif</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  每个 appid 对应一个人脸库，每个用户可以多次注册一个人脸</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">AipFaceClient</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">prames</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newErr = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">        newErr.<span class="property">leval</span> = <span class="number">9</span>;</span><br><span class="line">        newErr.<span class="property">title</span> = <span class="string">&quot;参数错误&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line">    <span class="keyword">let</span> method = prames.<span class="property">method</span> || <span class="string">&#x27;search&#x27;</span></span><br><span class="line">    <span class="keyword">let</span> imageType = prames.<span class="property">imageType</span> || <span class="string">&#x27;BASE64&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (method != <span class="string">&#x27;faceDelete&#x27;</span> &amp;&amp; !prames.<span class="property">image</span>) &#123;</span><br><span class="line">        newErr.<span class="property">message</span> = <span class="string">&#x27;请传入 image 参数&#x27;</span></span><br><span class="line">        <span class="keyword">throw</span> newErr</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="string">&#x27;addUser&#x27;</span>, <span class="string">&#x27;updateUser&#x27;</span>, <span class="string">&#x27;faceDelete&#x27;</span>].<span class="title function_">includes</span>(method) &amp;&amp; !prames.<span class="property">user</span>) &#123;</span><br><span class="line">        newErr.<span class="property">message</span> = <span class="string">&#x27;请传入 user 参数&#x27;</span></span><br><span class="line">        <span class="keyword">throw</span> newErr</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> user = prames.<span class="property">user</span></span><br><span class="line">    <span class="keyword">let</span> dept = prames.<span class="property">Department</span> || user.<span class="property">Department</span></span><br><span class="line">    <span class="keyword">let</span> image = prames.<span class="property">image</span>.<span class="title function_">replace</span>(<span class="string">&#x27;data:image/png;base64,&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;addUser&#x27;</span>:    <span class="comment">// 注册：每个用户组可注册多次</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">FaceClient</span>.<span class="title function_">addUser</span>(image, imageType, dept, user.<span class="property">_id</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;updateUser&#x27;</span>: <span class="comment">// 更新</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">FaceClient</span>.<span class="title function_">updateUser</span>(image, imageType, dept, user.<span class="property">_id</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;faceDelete&#x27;</span>: <span class="comment">// 删除</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">FaceClient</span>.<span class="title function_">faceDelete</span>(user.<span class="property">_id</span>, dept, prames.<span class="property">faceToken</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;detect&#x27;</span>:     <span class="comment">// 检测</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">FaceClient</span>.<span class="title function_">detect</span>(image, imageType)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search&#x27;</span>:</span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">FaceClient</span>.<span class="title function_">search</span>(image, imageType, prames.<span class="property">groupIdList</span>)</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">error_msg</span> &amp;&amp; result.<span class="property">error_msg</span> != <span class="string">&#x27;SUCCESS&#x27;</span>) &#123;</span><br><span class="line">        newErr.<span class="property">message</span> = result.<span class="property">error_msg</span></span><br><span class="line">        <span class="keyword">throw</span> newErr</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文字识别</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">AipOcrClient</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">prames</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newErr = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">        newErr.<span class="property">leval</span> = <span class="number">9</span>;</span><br><span class="line">        newErr.<span class="property">title</span> = <span class="string">&quot;参数错误&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> result, method = prames.<span class="property">method</span> || <span class="string">&#x27;accurateBasic&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!prames.<span class="property">image</span>) &#123;</span><br><span class="line">        newErr.<span class="property">message</span> = <span class="string">&#x27;请传入 image 参数&#x27;</span></span><br><span class="line">        <span class="keyword">throw</span> newErr</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> image = prames.<span class="property">image</span>.<span class="title function_">replace</span>(<span class="string">&#x27;data:image/png;base64,&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;accurateBasic&#x27;</span>:   <span class="comment">// 通用文字识别（高精度版）</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">OcrClient</span>.<span class="title function_">accurateBasic</span>(image, prames.<span class="property">options</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;licensePlate&#x27;</span>:    <span class="comment">// 车牌识别</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">OcrClient</span>.<span class="title function_">licensePlate</span>(image, prames.<span class="property">options</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;idcard&#x27;</span>:          <span class="comment">// 身份证</span></span><br><span class="line">            <span class="keyword">let</span> idCardSide = prames.<span class="property">idCardSide</span> || <span class="string">&#x27;front&#x27;</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">OcrClient</span>.<span class="title function_">idcard</span>(image, idCardSide, prames.<span class="property">options</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;docAnalysis&#x27;</span>:     <span class="comment">// 办公文档</span></span><br><span class="line">            <span class="keyword">let</span> lType = prames.<span class="property">languageType</span> || <span class="string">&#x27;CHN_ENG&#x27;</span></span><br><span class="line">            <span class="keyword">let</span> rType = prames.<span class="property">resultType</span> || <span class="string">&#x27;big&#x27;</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">OcrClient</span>.<span class="title function_">docAnalysis</span>(image, lType, rType, prames.<span class="property">options</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">error_msg</span>) &#123;</span><br><span class="line">        newErr.<span class="property">message</span> = result.<span class="property">error_msg</span></span><br><span class="line">        <span class="keyword">throw</span> newErr</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@title</span> 语音识别：语音转文字 </span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> method：请求方法 recognize</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> speech：包含语音内容的 Buffer 对象，默认单声道、8000 采样率、wav 格式。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  声道数：声音的通道的数目，单声道使用一个喇叭，立体声两个喇叭分左右声道。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  采样频率：取样频率，指每秒钟取得声音样本的次数，频率越高则声音质量越好。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  采样位数：将采样幅度量化的取样值，是用来衡量声音波动变化的分辨率，取值 8/16。</span></span><br><span class="line"><span class="comment">  *                8 位指将数据分为 2 的 8 次方即 256 份，16 则是 16 次方。</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> format：音频格式</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  pcm：不压缩不需要解码的原始格式，根据采样频率和位数对量化数据进行编码。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  wav：不压缩的无损格式，只是在 PCM 数据前加上 44 字节来描述采样率、声道数等。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  amr：压缩比大于 mp3 的自适应多速率编码格式，由于质量较差而常用于语音通话。</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> rate：采样频率，取值 8000 / 16000</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> options：主要包含 用户唯一标识 cuid、语言类型 dev_pid。</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@title</span> 语音合成：文字转语音</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> method：请求方法 text2audio</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> text：UTF-8 编码文本、长度小于 1024 字节</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> text2audio options：spd 语速 0-9、pit 音调 0-9、vol 音量 0-15、per 发音人</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@title</span> 数据转换</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  base64 编码：Buffer.from(&#x27;hello world&#x27;, &#x27;utf8&#x27;).toString(&#x27;base64&#x27;)</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  base64 解码：Buffer.from(&#x27;aGVsbG8gd29ybGQ=&#x27;, &#x27;base64&#x27;)</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">AipSpeechClient</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">prames</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newErr = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">        newErr.<span class="property">leval</span> = <span class="number">9</span>;</span><br><span class="line">        newErr.<span class="property">title</span> = <span class="string">&quot;参数错误&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> result;</span><br><span class="line">    <span class="keyword">switch</span> (prames.<span class="property">method</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;recognize&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> (!prames.<span class="property">speech</span>) &#123;</span><br><span class="line">                newErr.<span class="property">message</span> = <span class="string">&#x27;请传入参数 speech&#x27;</span></span><br><span class="line">                <span class="keyword">throw</span> newErr</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> speech = prames.<span class="property">speech</span>.<span class="title function_">replace</span>(<span class="string">&#x27;data:audio/wav;base64,&#x27;</span></span><br><span class="line">            <span class="keyword">let</span> buffer = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(speech, <span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>)</span><br><span class="line">            <span class="keyword">let</span> format = prames.<span class="property">format</span> || <span class="string">&#x27;wav&#x27;</span></span><br><span class="line">            <span class="keyword">let</span> rate = prames.<span class="property">rate</span> || <span class="number">8000</span></span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">SpeechClient</span>.<span class="title function_">recognize</span>(buffer, format, rate, prames.<span class="property">options</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;text2audio&#x27;</span>:</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">if</span> (!prames.<span class="property">text</span>) &#123;</span><br><span class="line">                newErr.<span class="property">message</span> = <span class="string">&#x27;请传入 text 参数&#x27;</span></span><br><span class="line">                <span class="keyword">throw</span> newErr</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> options = prames.<span class="property">options</span> || &#123; <span class="attr">spd</span>: <span class="number">5</span>, <span class="attr">pit</span>: <span class="number">5</span>, <span class="attr">per</span>: <span class="number">0</span> &#125;</span><br><span class="line">            result = <span class="keyword">await</span> <span class="title class_">SpeechClient</span>.<span class="title function_">text2audio</span>(prames.<span class="property">text</span>, options)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    newErr.<span class="property">message</span> = result.<span class="property">error_msg</span> || result.<span class="property">err_msg</span></span><br><span class="line">    <span class="keyword">if</span> (newErr.<span class="property">message</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;limit reached&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        newErr.<span class="property">message</span> =  <span class="string">&#x27;没有当前接口额度&#x27;</span></span><br><span class="line">        <span class="keyword">throw</span> newErr</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newErr.<span class="property">message</span> &amp;&amp; newErr.<span class="property">message</span> != <span class="string">&#x27;success.&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> newErr</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prames.<span class="property">method</span> == <span class="string">&#x27;recognize&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result.<span class="property">result</span>[<span class="number">0</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;data:audio/wav;base64,&#x27;</span> + <span class="title class_">Buffer</span>.<span class="title function_">from</span>(result.<span class="property">data</span>).<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、H5-识别"><a href="#三、H5-识别" class="headerlink" title="三、H5 识别"></a>三、H5 识别</h1><blockquote>
<p>人脸识别通过浏览器接口 navigator.mediaDevices.getUserMedia 实时获取视频流数据，然后通过第三方插件 face-api.js&#x2F;tracking.js 识别人脸，需要注意的是浏览器存在兼容问题和必须使用 https 网址。</p>
</blockquote>
<h2 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.<span class="property">input</span>-file-control &#123;</span><br><span class="line">    <span class="attr">display</span>: flex;</span><br><span class="line">    <span class="attr">position</span>: relative;</span><br><span class="line">    margin-<span class="attr">right</span>: 15px;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">input</span>-file-control input &#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">position</span>: absolute;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    z-<span class="attr">index</span>: <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> onchange：报错 function 未定义，内容改变并且失焦后触发</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> <span class="variable">ng</span>-change：必须配合 ng-model 使用，只要内容改变就会触发</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> angular.element(this).scope().fn：自定义 onchange 事件</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;input-file-control&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>图片上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">capture</span>=<span class="string">&quot;camera&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onchange</span>=<span class="string">&quot;angular.element(this).scope().changeImg(this.files[0])&quot;</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">$scope.<span class="property">changeImg</span> = <span class="keyword">function</span> (<span class="params">file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title function_">fileReader</span>(file).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">baseImg</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>, baseImg)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fileReader</span> (file, method) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        method = method || <span class="string">&#x27;readAsDataURL&#x27;</span></span><br><span class="line">        <span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">        reader[method](file);</span><br><span class="line">        reader.<span class="property">onloadend</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(reader.<span class="property">result</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        reader.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&#x27;图片读取失败&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compress</span> (baseImg) &#123;</span><br><span class="line">    <span class="keyword">let</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">src</span> = baseImg;</span><br><span class="line">    img.<span class="title function_">setAttribute</span>(<span class="string">&quot;crossOrigin&quot;</span>, <span class="string">&quot;Anonymous&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> </span><br><span class="line">        (img.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>),</span><br><span class="line">                ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>),</span><br><span class="line">                w = img.<span class="property">width</span>,</span><br><span class="line">                h = img.<span class="property">height</span>;</span><br><span class="line">            canvas.<span class="property">width</span> = w;</span><br><span class="line">            canvas.<span class="property">height</span> = h;</span><br><span class="line">            ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">            <span class="keyword">let</span> baseImg = canvas.<span class="title function_">toDataURL</span>(<span class="string">&quot;image/png&quot;</span>, <span class="number">0.6</span>)</span><br><span class="line">            <span class="title function_">resolve</span>(baseImg);</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="人脸拍照"><a href="#人脸拍照" class="headerlink" title="人脸拍照"></a>人脸拍照</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$scope.<span class="property">onShowFace</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    imanDialog.<span class="title function_">showFace</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">base64Img</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>, base64Img)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showFace</span> () &#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">var</span> defer = $q.<span class="title function_">defer</span>();</span><br><span class="line">    <span class="keyword">var</span> scope = $rootScope.$new(<span class="literal">true</span>);</span><br><span class="line">    scope.<span class="property">scanTip</span> = <span class="string">&#x27;正在调取摄像头&#x27;</span></span><br><span class="line">    scope.<span class="property">video</span> = <span class="literal">null</span></span><br><span class="line">    scope.<span class="property">canvas</span> = <span class="literal">null</span></span><br><span class="line">    scope.<span class="property">trackerTask</span> = <span class="literal">null</span></span><br><span class="line">    scope.<span class="property">tracker</span> = <span class="literal">null</span></span><br><span class="line">    scope.<span class="property">context</span> = <span class="literal">null</span></span><br><span class="line">    scope.<span class="property">stream</span> = <span class="literal">null</span></span><br><span class="line">    scope.<span class="property">isTokePhoto</span> = <span class="literal">false</span></span><br><span class="line">    scope.<span class="property">base64Img</span> = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> templateString = <span class="string">&#x27;&lt;ion-modal-view class=&quot;im-modal im-modal--face&quot;&gt;&#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;&lt;div class=&quot;scanTip&quot;&gt;&#123;&#123;scanTip&#125;&#125;&lt;/div&gt;&#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;&lt;video ng-if=&quot;!base64Img&quot; id=&quot;imVideo&quot; width=&quot;400&quot; height=&quot;300&quot; preload &#x27;</span> + </span><br><span class="line">        <span class="string">&#x27;autoplay loop muted&gt;&lt;/video&gt;&#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;&lt;canvas ng-if=&quot;!base64Img&quot; id=&quot;imCanvas&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;&#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;&lt;img ng-if=&quot;base64Img&quot; src=&quot;&#123;&#123;base64Img&#125;&#125;&quot; width=&quot;400&quot; height=&quot;300&quot; /&gt;&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;&lt;/ion-modal-view&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">var</span> modal = $ionicModal.<span class="title function_">fromTemplate</span>(templateString, &#123;</span><br><span class="line">        <span class="attr">scope</span>: scope,</span><br><span class="line">        <span class="attr">animation</span>: <span class="string">&#x27;im-slide-in-right&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    scope.$on(<span class="string">&#x27;modal.shown&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;</span><br><span class="line">            <span class="attr">video</span>: &#123; <span class="attr">width</span>: <span class="number">400</span>, <span class="attr">height</span>: <span class="number">300</span>, <span class="attr">facingMode</span>: <span class="string">&quot;user&quot;</span> &#125;</span><br><span class="line">        &#125;, <span class="keyword">function</span> (<span class="params">stream</span>) &#123;</span><br><span class="line">            scope.<span class="property">stream</span> = stream</span><br><span class="line">            scope.<span class="property">video</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;imVideo&#x27;</span>)</span><br><span class="line">            scope.<span class="property">canvas</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;imCanvas&#x27;</span>)</span><br><span class="line">            scope.<span class="property">context</span> = scope.<span class="property">canvas</span>.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>, &#123;<span class="attr">willReadFrequently</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;srcObject&quot;</span> <span class="keyword">in</span> scope.<span class="property">video</span>) &#123;</span><br><span class="line">                scope.<span class="property">video</span>.<span class="property">srcObject</span> = stream</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                scope.<span class="property">video</span>.<span class="property">src</span> = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(stream)</span><br><span class="line">            &#125;</span><br><span class="line">            scope.<span class="property">video</span>.<span class="property">onloadedmetadata</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; scope.<span class="property">video</span>.<span class="title function_">play</span>() &#125;</span><br><span class="line">            scope.<span class="property">tracker</span> = <span class="keyword">new</span> tracking.<span class="title class_">ObjectTracker</span>(<span class="string">&#x27;face&#x27;</span>)</span><br><span class="line">            scope.<span class="property">tracker</span>.<span class="title function_">setInitialScale</span>(<span class="number">4</span>)</span><br><span class="line">            scope.<span class="property">tracker</span>.<span class="title function_">setStepSize</span>(<span class="number">2</span>)</span><br><span class="line">            scope.<span class="property">tracker</span>.<span class="title function_">setEdgesDensity</span>(<span class="number">0.1</span>)</span><br><span class="line">            scope.<span class="property">trackerTask</span> = tracking.<span class="title function_">track</span>(<span class="string">&#x27;#imVideo&#x27;</span>, scope.<span class="property">tracker</span>, &#123;<span class="attr">camera</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">            scope.<span class="property">tracker</span>.<span class="title function_">on</span>(<span class="string">&#x27;track&#x27;</span>, handleTracked)</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">            _this.<span class="title function_">toastBottom</span>(<span class="string">&#x27;访问用户媒体失败：&#x27;</span> + error.<span class="property">message</span>)</span><br><span class="line">            modal.<span class="title function_">hide</span>();</span><br><span class="line">            defer.<span class="title function_">reject</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleTracked</span> (event) &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.<span class="property">data</span>.<span class="property">length</span> == <span class="number">0</span> &amp;&amp; !scope.<span class="property">isTokePhoto</span>) &#123;</span><br><span class="line">            scope.<span class="property">scanTip</span> = <span class="string">&#x27;未识别到人脸&#x27;</span></span><br><span class="line">            scope.$apply()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        scope.<span class="property">context</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>)</span><br><span class="line">        event.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">rect</span>) &#123;</span><br><span class="line">            scope.<span class="property">context</span>.<span class="property">strokeStyle</span> = <span class="string">&#x27;#eb652e&#x27;</span></span><br><span class="line">            scope.<span class="property">context</span>.<span class="title function_">strokeRect</span>(rect.<span class="property">x</span>, rect.<span class="property">y</span>, rect.<span class="property">width</span>, rect.<span class="property">height</span>)</span><br><span class="line">            scope.<span class="property">context</span>.<span class="property">font</span> = <span class="string">&#x27;11px Helvetica&#x27;</span></span><br><span class="line">            scope.<span class="property">context</span>.<span class="property">fillStyle</span> = <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">            <span class="keyword">let</span> rectWidth = rect.<span class="property">x</span> + rect.<span class="property">width</span> + <span class="number">5</span></span><br><span class="line">            scope.<span class="property">context</span>.<span class="title function_">fillText</span>(<span class="string">&#x27;x: &#x27;</span> + rect.<span class="property">x</span> + <span class="string">&#x27;px&#x27;</span>, rectWidth, rect.<span class="property">y</span> + <span class="number">11</span>)</span><br><span class="line">            scope.<span class="property">context</span>.<span class="title function_">fillText</span>(<span class="string">&#x27;y: &#x27;</span> + rect.<span class="property">y</span> + <span class="string">&#x27;px&#x27;</span>, rectWidth, rect.<span class="property">y</span> + <span class="number">22</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span> (!scope.<span class="property">isTokePhoto</span>) &#123;</span><br><span class="line">            scope.<span class="property">isTokePhoto</span> = <span class="literal">true</span></span><br><span class="line">            scope.<span class="property">scanTip</span> = <span class="string">&#x27;正在拍照，请保持当前姿势 2 秒&#x27;</span></span><br><span class="line">            scope.$apply()</span><br><span class="line">            <span class="keyword">var</span> timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">                scope.<span class="property">context</span>.<span class="title function_">drawImage</span>(scope.<span class="property">video</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>)</span><br><span class="line">                scope.<span class="property">base64Img</span> = scope.<span class="property">canvas</span>.<span class="title function_">toDataURL</span>(<span class="string">&#x27;image/png&#x27;</span>, <span class="number">0.6</span>)</span><br><span class="line">                modal.<span class="title function_">hide</span>()</span><br><span class="line">                defer.<span class="title function_">resolve</span>(scope.<span class="property">base64Img</span>);</span><br><span class="line">            &#125;, <span class="number">2000</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    scope.$on(<span class="string">&#x27;modal.hidden&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        scope.<span class="property">context</span> &amp;&amp; scope.<span class="property">context</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>)</span><br><span class="line">        scope.<span class="property">tracker</span> &amp;&amp; scope.<span class="property">tracker</span>.<span class="title function_">removeListener</span>(<span class="string">&#x27;track&#x27;</span>, handleTracked)</span><br><span class="line">        scope.<span class="property">trackerTask</span> &amp;&amp; scope.<span class="property">trackerTask</span>.<span class="title function_">stop</span>()  <span class="comment">// 停止侦测</span></span><br><span class="line">        <span class="keyword">if</span> (scope.<span class="property">stream</span>) &#123;</span><br><span class="line">            scope.<span class="property">stream</span>.<span class="property">enabled</span> = <span class="literal">false</span></span><br><span class="line">            scope.<span class="property">stream</span>.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>()</span><br><span class="line">            scope.<span class="property">stream</span>.<span class="title function_">getVideoTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (scope.<span class="property">video</span>.<span class="property">srcObject</span>) &#123;</span><br><span class="line">            scope.<span class="property">video</span>.<span class="property">srcObject</span>.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">revokeObjectURL</span>(scope.<span class="property">video</span>.<span class="property">src</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        $timeout(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            modal.<span class="property">scope</span>.$destroy();</span><br><span class="line">            modal.<span class="property">$el</span>.<span class="title function_">remove</span>();</span><br><span class="line">        &#125;, modal.<span class="property">hideDelay</span> || <span class="number">320</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    modal.<span class="title function_">show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> defer.<span class="property">promise</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="语音录制"><a href="#语音录制" class="headerlink" title="语音录制"></a>语音录制</h2>  <div align="center">
    <img src="/images/web/audio-view.png" alt="浏览器结构" width="50%">
  </div>

  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.im-toast-view</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">z-index</span>: <span class="number">10</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">top</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">max-width</span>: <span class="number">95%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">        -webkit-<span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">30px</span> <span class="number">15px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.6</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.im-toast-view</span> <span class="selector-class">.im-voice-wrap</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.im-toast-view</span> <span class="selector-tag">i</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">54px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">2px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-top</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: transparent;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> <span class="selector-tag">span</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: backgroundInfinite7 <span class="number">2s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> <span class="selector-tag">span</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">26px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: backgroundInfinite6 <span class="number">2s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> <span class="selector-tag">span</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">22px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: backgroundInfinite5 <span class="number">2s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> <span class="selector-tag">span</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: backgroundInfinite4 <span class="number">2s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> <span class="selector-tag">span</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">5</span>) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: backgroundInfinite3 <span class="number">2s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> <span class="selector-tag">span</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">6</span>) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: backgroundInfinite2 <span class="number">2s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.voice-animation</span> <span class="selector-tag">span</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">7</span>) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">6px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> backgroundInfinite2 &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">10%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">15%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> backgroundInfinite3 &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">25%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">30%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> backgroundInfinite4 &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">40%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">45%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> backgroundInfinite5 &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">55%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">60%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> backgroundInfinite6 &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">70%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">75%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> backgroundInfinite7 &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">85%</span> &#123; <span class="attribute">background</span>: transparent; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">90%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123; <span class="attribute">background</span>: <span class="number">#fff</span>; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.im-audio--item</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.im-audio-view</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#d5e5ff</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">4px</span> <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.im-item-view--text</span> <span class="selector-class">.label</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-right</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.audio-style</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.audio-style</span> <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#4c4c4c</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-top-color</span>: transparent;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-left-color</span>: transparent;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-bottom-color</span>: transparent;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.audio-style</span> <span class="selector-class">.small</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">4px</span> solid <span class="number">#4c4c4c</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-top-color</span>: transparent;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-left-color</span>: transparent;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-bottom-color</span>: transparent;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.audio-style</span> <span class="selector-class">.middle</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-left</span>: -<span class="number">11px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.audio-style</span> <span class="selector-class">.large</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-left</span>: -<span class="number">19px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.audio-playing</span> <span class="selector-class">.middle</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: audioPlaying <span class="number">1.2s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.audio-playing</span> <span class="selector-class">.large</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: audioPlaying2 <span class="number">1.2s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> audioPlaying &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">10%</span> &#123; <span class="attribute">opacity</span>: <span class="number">1</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> audioPlaying2 &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">50%</span> &#123; <span class="attribute">opacity</span>: <span class="number">1</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">60%</span> &#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">im-card</span> <span class="attr">linenumber</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;im-audio--item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>录制语音：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;im-audio-view&quot;</span> <span class="attr">ng-click</span>=<span class="string">&quot;playAudio()&quot;</span> <span class="attr">ng-if</span>=<span class="string">&quot;audio&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;audio-style&quot;</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">ng-class</span>=<span class="string">&quot;&#123;&#x27;audio-playing&#x27;: audioStatus == 2&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;small&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;large&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;seconds&quot;</span>&gt;</span>&#123;&#123;duration&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">im-item-view</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;im-item-view--text&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;识别结果：&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">value</span>=<span class="string">&quot;speechData.audioText&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">im-item-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">im-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;im-toast-view&quot;</span> <span class="attr">ng-if</span>=<span class="string">&quot;audioStatus == 1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;im-voice-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ion-ios-mic&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;voice-animation&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>手指上滑，取消录制<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;primary ion-ios-mic-outline&quot;</span> <span class="attr">on-hold</span>=<span class="string">&quot;onStartAudio()&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">on-release</span>=<span class="string">&quot;onStopAudio()&quot;</span> <span class="attr">on-swipe-up</span>=<span class="string">&quot;onStopAudio(true)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;audioStatus == 1 ? &#x27;录音中...&#x27; : &#x27;按住录音&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> createScript：存储用于语音识别的 PCM 音频、语音时长</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> MediaRecorder：存储用于网页回放的 audio/webm 音频</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> wav 格式：一般是在 pcm 文件前增加 44 个字节的文件头</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> createScript：存储单声道 PCM 数据</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">$scope.<span class="property">audioStatus</span> = <span class="number">0</span>    <span class="comment">// 0 初始、1 正在录制、2 正在播放</span></span><br><span class="line">$scope.<span class="property">audioCtx</span> = <span class="keyword">new</span> <span class="title class_">AudioContext</span>();</span><br><span class="line"></span><br><span class="line">$scope.<span class="property">onStartAudio</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!navigator.<span class="property">mediaDevices</span>) &#123; </span><br><span class="line">        imanDialog.<span class="title function_">toastBottom</span>(<span class="string">&#x27;当前浏览器不支持麦克风&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    &#125;</span><br><span class="line">    $scope.<span class="property">audio</span> = <span class="literal">null</span></span><br><span class="line">    $scope.<span class="property">mediaRecorder</span> = <span class="literal">null</span></span><br><span class="line">    $scope.<span class="property">duration</span> = <span class="number">0</span></span><br><span class="line">    $scope.<span class="property">bufferSize</span> = <span class="number">0</span></span><br><span class="line">    $scope.<span class="property">bufferArray</span> = []</span><br><span class="line">    navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;<span class="attr">audio</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">stream</span> =&gt;</span> &#123;</span><br><span class="line">        $scope.<span class="property">stream</span> = stream</span><br><span class="line">        $scope.<span class="property">audioStatus</span> = <span class="number">1</span></span><br><span class="line">        $scope.<span class="property">audioInput</span> = $scope.<span class="property">audioCtx</span>.<span class="title function_">createMediaStreamSource</span>(stream)</span><br><span class="line">        <span class="keyword">let</span> createScript = $scope.<span class="property">audioCtx</span>.<span class="property">createScriptProcessor</span> || </span><br><span class="line">                           $scope.<span class="property">audioCtx</span>.<span class="property">createJavaScriptNode</span>;</span><br><span class="line">        <span class="comment">// 采集 4096 就触发一次 onaudioprocess、声道数</span></span><br><span class="line">        $scope.<span class="property">recorder</span> = createScript.<span class="title function_">apply</span>($scope.<span class="property">audioCtx</span>, [<span class="number">4096</span>, <span class="number">1</span>]);  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开始录音</span></span><br><span class="line">        $scope.<span class="property">audioInput</span>.<span class="title function_">connect</span>($scope.<span class="property">recorder</span>);</span><br><span class="line">        $scope.<span class="property">recorder</span>.<span class="title function_">connect</span>($scope.<span class="property">audioCtx</span>.<span class="property">destination</span>)</span><br><span class="line">        $scope.<span class="property">recorder</span>.<span class="property">onaudioprocess</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="comment">// 返回一个 Float32Array 的 PCM 数据</span></span><br><span class="line">            <span class="keyword">let</span> channelData = e.<span class="property">inputBuffer</span>.<span class="title function_">getChannelData</span>(<span class="number">0</span>) </span><br><span class="line">            $scope.<span class="property">bufferArray</span>.<span class="title function_">push</span>(channelData.<span class="title function_">slice</span>(<span class="number">0</span>));</span><br><span class="line">            $scope.<span class="property">bufferSize</span> += channelData.<span class="property">length</span></span><br><span class="line">        &#125;; </span><br><span class="line">        <span class="keyword">let</span> chunks = []</span><br><span class="line">        $scope.<span class="property">mediaRecorder</span> = <span class="keyword">new</span> <span class="title class_">MediaRecorder</span>(stream);</span><br><span class="line">        $scope.<span class="property">mediaRecorder</span>.<span class="title function_">start</span>();</span><br><span class="line">        $scope.<span class="property">mediaRecorder</span>.<span class="property">ondataavailable</span> = <span class="function">(<span class="params">e</span>) =&gt;</span>&#123;</span><br><span class="line">            chunks.<span class="title function_">push</span>(e.<span class="property">data</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        $scope.<span class="property">mediaRecorder</span>.<span class="property">onstop</span> = <span class="function">() =&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>(chunks, &#123;<span class="attr">type</span>:<span class="string">&quot;audio/webm;codecs=opus&quot;</span>&#125;); </span><br><span class="line">            <span class="keyword">let</span> audioUrl = (<span class="variable language_">window</span>.<span class="property">URL</span> || webkitURL).<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">            $scope.<span class="property">audio</span> = <span class="keyword">new</span> <span class="title class_">Audio</span>(audioUrl)</span><br><span class="line">        &#125;</span><br><span class="line">        $scope.$apply()</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        imanDialog.<span class="title function_">toastBottom</span>((err &amp;&amp; err.<span class="property">message</span> || err))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$scope.<span class="property">onStopAudio</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!$scope.<span class="property">recorder</span>) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    $scope.<span class="property">recorder</span>.<span class="title function_">disconnect</span>();</span><br><span class="line">    $scope.<span class="property">audioInput</span>.<span class="title function_">disconnect</span>();</span><br><span class="line">    $scope.<span class="property">stream</span>.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>();</span><br><span class="line">    $scope.<span class="property">duration</span> = <span class="title function_">getDuration</span>();</span><br><span class="line">    $scope.<span class="property">audioStatus</span> = <span class="number">0</span></span><br><span class="line">    $scope.<span class="property">mediaRecorder</span>.<span class="title function_">stop</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$scope.<span class="property">playAudio</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 播放：createBufferSource 方式、audio 方式</span></span><br><span class="line">    <span class="keyword">if</span> ($scope.<span class="property">audioStatus</span> == <span class="number">2</span>) &#123;</span><br><span class="line">        $scope.<span class="property">audioStatus</span> = <span class="number">0</span></span><br><span class="line">        $scope.<span class="property">audio</span>.<span class="title function_">pause</span>()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    $scope.<span class="property">audioStatus</span> = <span class="number">2</span></span><br><span class="line">    $scope.<span class="property">audio</span>.<span class="title function_">play</span>();</span><br><span class="line">    $scope.<span class="property">audio</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;ended&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $scope.<span class="property">audioStatus</span> = <span class="number">0</span></span><br><span class="line">        $scope.$apply()</span><br><span class="line">    &#125;, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDuration</span> () &#123;</span><br><span class="line">    <span class="keyword">let</span> duration = (<span class="number">4096</span>*$scope.<span class="property">bufferArray</span>.<span class="property">length</span>) / $scope.<span class="property">audioCtx</span>.<span class="property">sampleRate</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">RoundNum</span>(duration, &#123; <span class="title class_">RoundType</span>: <span class="number">3</span>, <span class="title class_">RoundValue</span>: <span class="number">5</span>, <span class="title class_">Precision</span>: <span class="number">2</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">RoundNum</span> (val, round) &#123;</span><br><span class="line">    <span class="keyword">var</span> returnValue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (val == <span class="literal">undefined</span> || val == <span class="literal">null</span> || val.<span class="title function_">toString</span>().<span class="title function_">trim</span>() == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (round &amp;&amp; angular.<span class="title function_">isObject</span>(round)) &#123;</span><br><span class="line">        round.<span class="property">Precision</span> = round.<span class="property">Precision</span> || <span class="number">0</span>;   <span class="comment">// 精度</span></span><br><span class="line">        round.<span class="property">RoundType</span> = round.<span class="property">RoundType</span> || <span class="number">3</span>;   <span class="comment">// 舍入类型</span></span><br><span class="line">        round.<span class="property">RoundValue</span> = round.<span class="property">RoundValue</span> || <span class="number">5</span>; <span class="comment">// 舍入值</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (round.<span class="property">RoundType</span> == <span class="number">1</span>) &#123;               <span class="comment">// 1 全部进位</span></span><br><span class="line">            returnValue = <span class="built_in">parseInt</span>(val * <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, round.<span class="property">Precision</span> + <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">if</span> (returnValue % <span class="number">10</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                returnValue = <span class="built_in">parseInt</span>(val * <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, round.<span class="property">Precision</span>)) + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                returnValue = <span class="built_in">parseInt</span>(val * <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, round.<span class="property">Precision</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            returnValue = returnValue / <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, round.<span class="property">Precision</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (round.<span class="property">RoundType</span> == <span class="number">2</span>) &#123;       <span class="comment">// 2 全部舍位</span></span><br><span class="line">            <span class="keyword">var</span> _Precision = <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, round.<span class="property">Precision</span>)</span><br><span class="line">            returnValue = <span class="built_in">parseInt</span>(val * _Precision) / _Precision;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;                                 <span class="comment">// 3 按值舍入</span></span><br><span class="line">            returnValue = <span class="built_in">parseInt</span>(val * <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, round.<span class="property">Precision</span> + <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">if</span> (returnValue % <span class="number">10</span> &gt;= round.<span class="property">RoundValue</span>) &#123;</span><br><span class="line">                returnValue = <span class="built_in">parseInt</span>(val * <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, round.<span class="property">Precision</span>)) + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                returnValue = <span class="built_in">parseInt</span>(returnValue / <span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            returnValue = returnValue / <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, round.<span class="property">Precision</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">parseFloat</span>(returnValue).<span class="title function_">toFixed</span>(round.<span class="property">Precision</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="语音处理"><a href="#语音处理" class="headerlink" title="语音处理"></a>语音处理</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$scope.<span class="property">onSpeechRecognize</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// speech 语音对象：单声道、8000 采样率、wav 格式</span></span><br><span class="line">    <span class="keyword">let</span> bufferData = <span class="title function_">mergeBuffers</span>($scope.<span class="property">bufferArray</span>, $scope.<span class="property">bufferSize</span>);</span><br><span class="line">    <span class="keyword">let</span> bufferWav = <span class="title function_">encodeToWAV</span>(bufferData)</span><br><span class="line">    <span class="title class_">DataService</span>.<span class="title function_">fileReader</span>(bufferWav).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">baseAudio</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">AipSpeechClient</span>(&#123; <span class="attr">method</span>: <span class="string">&#x27;recognize&#x27;</span>, <span class="attr">speech</span>: baseAudio &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">text</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(text)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据合并压缩：将多个 Float32Array 数组合并为一个 Float32Array</span></span><br><span class="line"><span class="comment"> * 根据采样率压缩，比如输入 48k 输出 16k，则输入数据中每隔 3 取 1 位</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">float32array</span>&#125; data        [-1, 1]的 pcm 数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; inputSampleRate   输入采样率</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; outputSampleRate  输出采样率</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span>  &#123;<span class="type">float32array</span>&#125;          压缩处理后的二进制数据</span></span><br><span class="line"><span class="comment">**/</span>     </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeBuffers</span> (bufferList, length, inputSampleRate, outputSampleRate) &#123;</span><br><span class="line">    <span class="comment">// 默认</span></span><br><span class="line">    inputSampleRate = inputSampleRate || (<span class="keyword">new</span> <span class="title class_">AudioContext</span>().<span class="property">sampleRate</span>)</span><br><span class="line">    outputSampleRate = outputSampleRate || <span class="number">8000</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 合并</span></span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> data = <span class="keyword">new</span> <span class="title class_">Float32Array</span>(length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bufferList.<span class="property">length</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">        data.<span class="title function_">set</span>(bufferList[i], offset);</span><br><span class="line">        offset += bufferList[i].<span class="property">length</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="comment">// 压缩</span></span><br><span class="line">    <span class="keyword">var</span> compression = <span class="built_in">parseInt</span> (inputSampleRate / outputSampleRate);</span><br><span class="line">    <span class="keyword">var</span> outLength = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(data.<span class="property">length</span> / compression);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="title class_">Float32Array</span>(outLength);</span><br><span class="line">    <span class="keyword">var</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; outLength; i += <span class="number">1</span>) &#123;</span><br><span class="line">        result[i] = data[<span class="title class_">Math</span>.<span class="title function_">floor</span>(s)];</span><br><span class="line">        s += compression;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wav 格式一般是在 pcm 文件前增加 44 个字节的文件头</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">DataView</span>&#125; bytes           pcm 二进制数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125;  SampleRate       输入采样率，输出为 8000</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125;  sampleBits       输出采样位数，取值 8、16</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">DataView</span>&#125;               wav 二进制数据</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encodeToWAV</span> (bytes, sampleRate, sampleBits=<span class="number">16</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> dataLength = bytes.<span class="property">length</span> * (sampleBits / <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">44</span> + dataLength);</span><br><span class="line">    <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="title class_">DataView</span>(buffer);</span><br><span class="line">    <span class="keyword">var</span> channelCount = <span class="number">1</span>;  <span class="comment">// 百度只支持单声道</span></span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> writeString = <span class="keyword">function</span> (<span class="params">str</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.<span class="property">length</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">            view.<span class="title function_">setUint8</span>(offset + i, str.<span class="title function_">charCodeAt</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// write PCM</span></span><br><span class="line">    <span class="comment">// 资源交换文件标识符</span></span><br><span class="line">    <span class="title function_">writeString</span>(<span class="string">&#x27;RIFF&#x27;</span>); offset += <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 下个地址开始到文件尾总字节数,即文件大小-8</span></span><br><span class="line">    view.<span class="title function_">setUint32</span>(offset, <span class="number">36</span> + dataLength, <span class="literal">true</span>); offset += <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// WAV文件标志</span></span><br><span class="line">    <span class="title function_">writeString</span>(<span class="string">&#x27;WAVE&#x27;</span>); offset += <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 波形格式标志</span></span><br><span class="line">    <span class="title function_">writeString</span>(<span class="string">&#x27;fmt &#x27;</span>); offset += <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 过滤字节,一般为 0x10 = 16</span></span><br><span class="line">    view.<span class="title function_">setUint32</span>(offset, <span class="number">16</span>, <span class="literal">true</span>); offset += <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 格式类别 (PCM形式采样数据)</span></span><br><span class="line">    view.<span class="title function_">setUint16</span>(offset, <span class="number">1</span>, <span class="literal">true</span>); offset += <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 通道数</span></span><br><span class="line">    view.<span class="title function_">setUint16</span>(offset, channelCount, <span class="literal">true</span>); offset += <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 采样率，每秒样本数，表示每个通道的播放速度</span></span><br><span class="line">    view.<span class="title function_">setUint32</span>(offset, sampleRate, <span class="literal">true</span>); offset += <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 波形数据传输率 (每秒平均字节数) 单声道 × 每秒数据位数 × 每样本数据位 / 8</span></span><br><span class="line">    view.<span class="title function_">setUint32</span>(offset, channelCount * sampleRate * (sampleBits / <span class="number">8</span>), <span class="literal">true</span>); </span><br><span class="line">    offset += <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 快数据调整数 采样一次占用字节数 单声道 × 每样本的数据位数 / 8</span></span><br><span class="line">    view.<span class="title function_">setUint16</span>(offset, channelCount * (sampleBits / <span class="number">8</span>), <span class="literal">true</span>); offset += <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 每样本数据位数</span></span><br><span class="line">    view.<span class="title function_">setUint16</span>(offset, sampleBits, <span class="literal">true</span>); offset += <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 数据标识符</span></span><br><span class="line">    <span class="title function_">writeString</span>(<span class="string">&#x27;data&#x27;</span>); offset += <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 采样数据总数，即数据总大小-44</span></span><br><span class="line">    view.<span class="title function_">setUint32</span>(offset, dataLength, <span class="literal">true</span>); offset += <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入采样数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bytes.<span class="property">length</span>; i += <span class="number">1</span>, offset += sampleBits / <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> s = <span class="title class_">Math</span>.<span class="title function_">max</span>(-<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="number">1</span>, bytes[i]));</span><br><span class="line">        <span class="keyword">var</span> val = s &lt; <span class="number">0</span> ? s * <span class="number">0x8000</span> : s * <span class="number">0x7fff</span>;</span><br><span class="line">        <span class="keyword">if</span> (sampleBits == <span class="number">8</span>) &#123;</span><br><span class="line">            view.<span class="title function_">setInt8</span>(offset, <span class="built_in">parseInt</span>(<span class="number">255</span> / (<span class="number">65535</span>/(val+<span class="number">32768</span>)), <span class="number">10</span>), <span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view.<span class="title function_">setInt16</span>(offset, val, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Blob</span>([view], &#123; <span class="attr">type</span>: <span class="string">&#x27;audio/wav&#x27;</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encodeToPCM</span> (bytes, sampleBits=<span class="number">16</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> dataLength = bytes.<span class="property">length</span> * (sampleBits / <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(dataLength);</span><br><span class="line">    <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="title class_">DataView</span>(buffer);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>, offset=<span class="number">0</span>; i &lt; bytes.<span class="property">length</span>; i += <span class="number">1</span>, offset += sampleBits/<span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> s = <span class="title class_">Math</span>.<span class="title function_">max</span>(-<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="number">1</span>, bytes[i]));</span><br><span class="line">        <span class="keyword">var</span> val = s &lt; <span class="number">0</span> ? s * <span class="number">0x8000</span> : s * <span class="number">0x7fff</span>;</span><br><span class="line">        <span class="keyword">if</span> (sampleBits === <span class="number">8</span>) &#123;</span><br><span class="line">            view.<span class="title function_">setInt8</span>(offset, <span class="built_in">parseInt</span>(<span class="number">255</span> / (<span class="number">65535</span>/(val+<span class="number">32768</span>)), <span class="number">10</span>), <span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view.<span class="title function_">setInt16</span>(offset, val, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> view.<span class="property">buffer</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="四、微信识别"><a href="#四、微信识别" class="headerlink" title="四、微信识别"></a>四、微信识别</h1><blockquote>
<p>微信浏览器无法调用 getUserMedia，而且必须使用微信的人脸识别而不能使用第三方插件。</p>
</blockquote>
<h2 id="拍照上传"><a href="#拍照上传" class="headerlink" title="拍照上传"></a>拍照上传</h2>  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// 小程序</span><br><span class="line"><span class="tag">&lt;<span class="name">van-image</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">round</span> <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;imgSrc&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-button</span> @<span class="attr">click</span>=<span class="string">&quot;toCam(&#x27;camera&#x27;)&quot;</span>&gt;</span>拍照认证<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;toCam(&#x27;album&#x27;)&quot;</span>&gt;</span>上传照片认证<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;fileChange&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">ref</span>=<span class="string">&quot;avatarCamera&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">toCam(type) &#123;</span><br><span class="line">    let cameraInput = this.$refs[&#x27;avatarCamera&#x27;];</span><br><span class="line">    if (type === &#x27;camera&#x27;) &#123;</span><br><span class="line">      // 调起前置摄像头</span><br><span class="line">      cameraInput.setAttribute(&#x27;capture&#x27;, &#x27;user&#x27;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      cameraInput.removeAttribute(&#x27;capture&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    cameraInput.click();</span><br><span class="line">&#125;,</span><br><span class="line">async fileChange(e) &#123;</span><br><span class="line">    let files = e.target.files;</span><br><span class="line">    if (!files || files.length === 0) return;</span><br><span class="line">    let file = files[0];</span><br><span class="line">    const res = await this.$wxUtils.compressImg(file);</span><br><span class="line">    this.imgSrc = res.afterSrc;</span><br><span class="line">    // 调用后端接口验证身份</span><br><span class="line">    this.fetchfaceDetect(file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// 公众号</span><br><span class="line"><span class="tag">&lt;<span class="name">van-image</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">round</span> <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;imgSrc&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-button</span> @<span class="attr">click</span>=<span class="string">&quot;takePhoto(&#x27;camera&#x27;)&quot;</span>&gt;</span>拍照认证<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;takePhoto(&#x27;album&#x27;)&quot;</span>&gt;</span>上传图片认证<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">created() &#123;</span><br><span class="line">    this.checkWxConfig();</span><br><span class="line">&#125;,</span><br><span class="line">async checkWxConfig() &#123;</span><br><span class="line">    const res = await getWxJsApiconfig();</span><br><span class="line">    const &#123; appId, timestamp, nonceStr, signature &#125; = res || &#123;&#125;;</span><br><span class="line">    window.wx.config(&#123;</span><br><span class="line">        debug: false,</span><br><span class="line">        appId,</span><br><span class="line">        timestamp,</span><br><span class="line">        nonceStr,</span><br><span class="line">        signature,</span><br><span class="line">        jsApiList: [&#x27;checkJsApi&#x27;, &#x27;chooseImage&#x27;, &#x27;getLocalImgData&#x27;],</span><br><span class="line">    &#125;);</span><br><span class="line">    window.wx.ready(() =&gt; &#123;</span><br><span class="line">        window.wx.checkJsApi(&#123;</span><br><span class="line">            jsApiList: [&#x27;checkJsApi&#x27;, &#x27;chooseImage&#x27;, &#x27;getLocalImgData&#x27;],</span><br><span class="line">            success: data =&gt; &#123;</span><br><span class="line">              console.log(&#x27;配置检查结果成功&#x27;, data);</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: data =&gt; &#123;</span><br><span class="line">              console.log(&#x27;配置检查结果失败&#x27;, data);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    window.wx.error(err =&gt; &#123;</span><br><span class="line">        console.log(&#x27;微信配置错误~~~&#x27;, err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">takePhoto(sourceType) &#123;</span><br><span class="line">    if (!this.$wxUtils.isWeiXin()) &#123;</span><br><span class="line">        this.$toast(&#x27;请在微信公众号或微信小程序环境下使用该服务&#x27;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    window.wx.chooseImage(&#123;</span><br><span class="line">        count: 1, // 默认9</span><br><span class="line">        sizeType: [&#x27;original&#x27;, &#x27;compressed&#x27;],</span><br><span class="line">        sourceType: [sourceType], // &#x27;album&#x27; 相册, &#x27;camera&#x27; 相机</span><br><span class="line">        success: data =&gt; &#123;</span><br><span class="line">            window.wx.getLocalImgData(&#123;</span><br><span class="line">                localId: data.localIds[0],</span><br><span class="line">                success: res =&gt; &#123;</span><br><span class="line">                    let localData = res.localData;</span><br><span class="line">                    // 兼容处理：安卓获取的图片 base64 码没有前缀，而苹果有</span><br><span class="line">                    if (localData.indexOf(&#x27;data:image&#x27;) === -1) &#123;</span><br><span class="line">                        localData = &#x27;data:image/png;base64,&#x27; + localData;</span><br><span class="line">                    &#125;</span><br><span class="line">                    localData = localData.replace(/\r|\n/g, &#x27;&#x27;).replace</span><br><span class="line">                    (&#x27;data:image/jgp&#x27;, &#x27;data:image/jpeg&#x27;);</span><br><span class="line">                    this.imgSrc = localData;</span><br><span class="line">                    this.fetchfaceDetect();</span><br><span class="line">                &#125;,</span><br><span class="line">                fail: error =&gt; &#123;</span><br><span class="line">                    console.log(&#x27;转换图片为 base64 失败&#x27;, error);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        fail: error =&gt; &#123;</span><br><span class="line">            console.log(&#x27;调起相机失败&#x27;, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line">fetchfaceDetect(file) &#123;</span><br><span class="line">    const toast = this.$toast.loading(&#123;</span><br><span class="line">        mask: true,</span><br><span class="line">        duration: 0,</span><br><span class="line">        loadingType: &#x27;spinner&#x27;,</span><br><span class="line">        message: &#x27;识别中...&#x27;,</span><br><span class="line">    &#125;);</span><br><span class="line">    const &#123; name, idCard &#125; = this.$route.query;</span><br><span class="line">    const url = &#x27;/ehCard/healthCard/faceDetect&#x27;;</span><br><span class="line">    let params = new FormData();</span><br><span class="line">    params.append(&#x27;file&#x27;, file);</span><br><span class="line">    params.append(&#x27;name&#x27;, name);</span><br><span class="line">    params.append(&#x27;idCard&#x27;, idCard);</span><br><span class="line"></span><br><span class="line">    this.$postRequest(url, params, false, &#123;</span><br><span class="line">        &#x27;Content-Type&#x27;: &#x27;multipart/form-data&#x27;,</span><br><span class="line">        showError: false,</span><br><span class="line">    &#125;)</span><br><span class="line">    .then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        toast.clear();</span><br><span class="line">        if (data.success) &#123;  &#125; </span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(() =&gt; &#123;  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小程序人脸"><a href="#小程序人脸" class="headerlink" title="小程序人脸"></a>小程序人脸</h2><blockquote>
<p>由于功能涉及到用户的隐私信息，因此调用人脸核身接口的小程序需要在<a href="https://mp.weixin.qq.com/">微信公众平台-功能-人脸核身</a>申请权限并满足<a href="https://developers.weixin.qq.com/community/business/doc/000442d352c1202bd498ecb105c00d">一定条件</a>。微信会在触发接口后跳转到人脸识别界面，然后将用户人脸信息与人脸库对比后返回认证信息。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、检测设备是否支持</span></span><br><span class="line"><span class="title function_">checkIsSupportFacialRecognition</span>(&#123;</span><br><span class="line">    <span class="attr">checkAliveType</span>: <span class="number">2</span>,</span><br><span class="line">　　 <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">  　　   <span class="keyword">if</span> (res.<span class="property">errCode</span> == <span class="number">0</span> || </span><br><span class="line">        res.<span class="property">errMsg</span> == <span class="string">&quot;checkIsSupportFacialRecognition:ok&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">// 2、调用人脸识别</span></span><br><span class="line">          　wx.<span class="title function_">startFacialRecognitionVerify</span>(&#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;姓名&quot;</span>,</span><br><span class="line">                <span class="attr">idCardNumber</span>: <span class="string">&quot;身份证号&quot;</span>,</span><br><span class="line">                success (res) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">verifyResult</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">fail</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                    wx.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">                        <span class="attr">showCancel</span>: <span class="literal">false</span>,</span><br><span class="line">                        <span class="attr">content</span>: <span class="string">&quot;人脸识别失败！&quot;</span> + res.<span class="property">errMsg</span>,</span><br><span class="line">                        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                            wx.<span class="title function_">navigateTo</span>()</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">　　　　 &#125;</span><br><span class="line">        wx.<span class="title function_">showToast</span>(<span class="string">&#x27;微信版本过低，暂时无法使用此功能，请升级最新版本&#x27;</span>)</span><br><span class="line">　  &#125;,</span><br><span class="line">　　<span class="attr">fail</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">　　　　wx.<span class="title function_">showToast</span>(<span class="string">&#x27;微信版本过低，暂时无法使用此功能，请升级最新版本&#x27;</span>)</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="小程序语音"><a href="#小程序语音" class="headerlink" title="小程序语音"></a>小程序语音</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.wxml</span></span><br><span class="line">&lt;button type=<span class="string">&#x27;default&#x27;</span> bindtouchstart=<span class="string">&#x27;startRecord&#x27;</span> </span><br><span class="line">bindtouchend=<span class="string">&quot;StopRecord&quot;</span>&gt;录音&lt;/button&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> recorderManager = wx.<span class="title function_">getRecorderManager</span>();</span><br><span class="line">recorder.<span class="title function_">onStop</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    wx.<span class="title function_">getFileSystemManager</span>().<span class="title function_">readFile</span>(&#123;</span><br><span class="line">        <span class="attr">filePath</span>: result.<span class="property">tempFilePath</span>,</span><br><span class="line">        <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">            wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;https://vop.baidu.com/server_api&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>: &#123;</span><br><span class="line">                    <span class="attr">format</span>: <span class="string">&#x27;pcm&#x27;</span>,</span><br><span class="line">                    <span class="attr">rate</span>: <span class="number">16000</span>,</span><br><span class="line">                    <span class="attr">channel</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="attr">cuid</span>: <span class="string">&#x27;sdfdfdfsfs&#x27;</span>,</span><br><span class="line">                    <span class="attr">token</span>: wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;token&quot;</span>),</span><br><span class="line">                    <span class="attr">speech</span>: wx.<span class="title function_">arrayBufferToBase64</span>(res.<span class="property">data</span>),</span><br><span class="line">                    <span class="attr">len</span>: res.<span class="property">data</span>.<span class="property">byteLength</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">header</span>: &#123; <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;,</span><br><span class="line">                <span class="title function_">success</span>(<span class="params">res</span>) &#123; &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    startRecord () &#123;</span><br><span class="line">        wx.<span class="title function_">showLoading</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;正在录音中...&#x27;</span> &#125;)</span><br><span class="line">        recorder.<span class="title function_">start</span>(&#123;</span><br><span class="line">            <span class="attr">format</span>: <span class="string">&#x27;PCM&#x27;</span>,</span><br><span class="line">            <span class="attr">duration</span>: <span class="number">5000</span>,</span><br><span class="line">            <span class="attr">sampleRate</span>: <span class="number">16000</span>,</span><br><span class="line">            <span class="attr">numberOfChannels</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">encodeBitRate</span>: <span class="number">48000</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    stopRecord () &#123;</span><br><span class="line">        recorder.<span class="title function_">stop</span>();</span><br><span class="line">        wx.<span class="title function_">hideLoading</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>微服务相关技术栈</title>
    <url>/2022/11/10/18-%E5%BE%AE%E6%9C%8D%E5%8A%A1/</url>
    <content><![CDATA[<h1 id="一、微服务架构"><a href="#一、微服务架构" class="headerlink" title="一、微服务架构"></a>一、微服务架构</h1><h2 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h2><blockquote>
<p><code>分布式</code>通过服务拆分解耦的方式实现了性能优化和按需更新但不能解决并发性和高可用性问题，<code>集群</code>则解决了系统的并发问题还可以在服务器宕机时正常运转，但是集群通过一台主机接收请求然后分发请求到部署相同服务的不同服务器实现负载均衡，本质上还是一个<code>单体应用架构</code>。具体设计时一般会结合分布式和集群的特点，即对拆分的子模块进行集群部署。</p>
</blockquote>
<ul>
<li><strong>单体应用</strong>：所有模块部署在一个服务器。优点是开发成本低、小型项目的首选，缺点是复杂项目不易开发和维护、性能扩展只能通过扩展集群结点但是有瓶颈和较高成本。<code>集群</code>可以提升性能但也有用户访问哪个服务器和数据共享的问题，<code>Niginx</code> 可用来反向代理用户请求地址并负载均衡完成用户请求的转发，<code>Redis + Tomcat</code> 则是实现数据共享的集群方案，但是这样的高并发问题导致数据库的压力过大，<code>数据库优化方案</code>主要有主从复制、Redis 缓存等。</li>
<li><strong>垂直应用</strong>：前后端分离的 MVC 分层架构，比如<code>水平拆分</code>根据层次拆分为工具库、数据持久、业务逻辑、后台管理、web 访问等模块并根据访问量合理部署，<code>垂直拆分</code>则根据功能拆分为商品、支付、购物车等独立模块。优点是前后端可以采用不同的技术开发、减轻了服务器的压力，缺点是某个模块更新时需要重新部署整个应用、不同服务器部署的模块之间无法交互。</li>
<li><strong>分布式架构</strong>：根据业务拆分为多个独立模块并通过 <code>RPC、Http、HttpClient</code> 等底层技术解决模块之间的调用问题。但是当服务越来越多，容量评估、小服务浪费资源等问题逐渐显现，此时需增加一个调度中心 SOA 基于访问压力实时管理集群容量并提高集群利用率。</li>
<li><strong>SOA 面向服务的架构</strong>：一种以粗粒度(表示类别)、松耦合的服务为中心的架构。实现方式主要有<code>中心化的 ESB、去中心化的微服务</code>。ESB 总线通过协议转换、消息路由、事务控制等底层技术对不同技术栈开发的<code>异构系统</code>实现连接通信和统一管理，将所有服务集成为一个松耦合的分布式系统，但是这种<code>单体架构模式</code>也带来了环境搭建困难和性能瓶颈等问题。 </li>
<li><strong>微服务架构</strong>：基于 SOA 理念针对业务实现细粒度(表示对象类别的实例)的组件化和服务化，通过<code>RPC/REST</code>协议对松耦合的微服务实现管理和整合，ESB 则是为各自为政的微服务们创造了一个中心化的政府。这种架构支持跨语言开发和独立部署，极大提升了复用性和可扩展性，但也有跨服务更改、调用链追踪、配置管理等问题，适用于长期迭代更新的项目。</li>
</ul>
<h2 id="开发技术"><a href="#开发技术" class="headerlink" title="开发技术"></a>开发技术</h2><blockquote>
<p>单体应用拆分出的独立服务就是微服务，这些微服务相互调用会形成一个中心的<code>服务集群</code>，不同中心则是<code>分布式</code>，为了统一管理和配置多个服务而有了<code>注册中心与配置中心</code>，用户访问服务时需要在服务集群中处理负载均衡和请求路由的 <code>API 网关</code>，服务之间的通信机制则基于 <code>对内的 REST、对外的 RPC、异步的消息队列</code>，为了数据库高并发查询数据时更安全快速而产生了<code>分布式缓存和分布式搜索</code>，为了在服务调用链某一环节出错时不影响整体而提出的方案有<code>重试机制、限流、熔断机制、负载均衡、降级</code>，为了排查服务故障而引入<code>分布式日志服务</code>来记录请求信息并通过<code>系统监控、链路追踪</code>来监控整个系统运行并在异常时快速反应，最后通过 <code>Jenkins + docker + kubernetes/rancher</code> 实现整体的自动化部署。一个微服务项目的架构和主要技术栈如下：</p>
</blockquote>
  <div align="center">
      <img src="/images/web/Microservice.png" alt="相关配置" width="100%">
  </div>

<ul>
<li><strong>架构方案</strong>：<code>聚合器</code>(将多个服务合并处理为一个新服务)、<code>代理</code>(服务转发和数据转换)、<code>链式</code>(同步调用的微服务链条)、<code>分步式</code>(支持同时调用多个微服务链)、<code>数据共享</code>(支持部分微服务共享数据库和缓存而存在强耦合)、<code>异步消息</code>(通过消息队列中间件实现异构系统的连接通信)。</li>
<li><strong>远程调用</strong>：同步消息通过基于 HTTP 对接第三方服务的接口规范 <code>REST</code>(对外暴露接口)、基于 TCP&#x2F;UDP 内部高效通信的远程调用协议 <code>RPC</code>(对内直接调用)，异步通信则通过<code>消息队列</code>。</li>
<li><strong>RPC 框架</strong>：Java 语言的 <code>Dubbo、Motan、SpringBoot、SpringCloud</code>，NodeJS 语言的 <code>Seneca、Hapi、Restify、LoopBack</code>，支持跨语言平台开发的 <code>gRPC、Thrift</code>。</li>
<li><strong>主要技术栈及其常用中间件</strong>：<code>配置管理</code> SpringCloudConfig Nacos、<code>注册发现</code> Nacos Eureka Zookeeper Consul、<code>API网关</code> SpringCloudGateway Zuul、<code>熔断限流</code> Hystrix Envoy Sentinel、<code>服务监控</code> Zabbix Nagios Metrics Specatator、<code>负载均衡</code> Ribbon Nginx、<code>消息队列</code> Kafka RabbitMQ ActiveMQ、<code>链路追踪</code> Zipkin Brave Dapper、<code>自动化部署</code> Jenkins Docker Rancher Kubernetes。</li>
</ul>
<h1 id="二、中间件服务"><a href="#二、中间件服务" class="headerlink" title="二、中间件服务"></a>二、中间件服务</h1><blockquote>
<p>一种用于连接操作系统、数据库等系统软件与应用软件，并管理计算资源和网络通信的中间软件。它为应用提供了开箱即用的业务服务和标准的通信接口，屏蔽了底层实现逻辑而让开发者专注于业务，解决了异构网络环境下分布式应用的通信问题，常作为服务器或插件被部署到应用开发工具。应用可以直接和用户交互但必须通过中间件和底层系统实现交互。</p>
</blockquote>
<h2 id="主要分类"><a href="#主要分类" class="headerlink" title="主要分类"></a>主要分类</h2><ul>
<li><strong>基础中间件</strong>：用于应用通信、请求处理、web 应用构建等。主要有<strong>交易中间件</strong> (用于银行业务等需要处理大量并发进程的联机交易系统)、<strong>消息中间件</strong> (用于应用之间的异步网络通信)、<strong>应用服务器中间件</strong> (用于浏览器和数据库之间业务处理的开发工具和运行平台)。</li>
<li><strong>集成中间件</strong>：用于数据库和应用等异构系统之间进行资源整合，构建一个分布式企业应用。</li>
<li><strong>行业领域应用平台</strong>：基于以上中间件针对特定行业开发文件管理、数据共享、云计算等功能。</li>
</ul>
<h2 id="常用实例"><a href="#常用实例" class="headerlink" title="常用实例"></a>常用实例</h2><ul>
<li><strong>路由与web服务器</strong>：处理和转发其他服务器数据的服务器。Nginx、Tengine、VipServer。</li>
<li><strong>RPC 框架</strong>：微服务时代的远程服务调用框架。grpc、Thrift、HSF、Dubbo、SOFA-RPC。</li>
<li><strong>消息中间件</strong>：分布式应用之间发送和接收消息的软件。Kafka、RabbitMQ、RocketMQ。</li>
<li><strong>缓存服务</strong>：分布式的高速数据存储层，一般是内存存储。Tair、Redis、Memcached。</li>
<li><strong>配置中心</strong>：统一管理各个项目中所有配置。阿里 Nacos、携程 Apollo、百度 Disconf。</li>
<li><strong>分布式事务</strong>：事务的参与者、支持事务的服务器、资源服务器以及事务管理器，分别位于不同的分布式系统的不同节点。阿里 seata、腾讯 DTF。</li>
<li><strong>任务调度</strong>：分布式环境下提供定时、任务编排、分布式跑批等功能的系统。阿里 SchedulerX、业界 xxl-job、当当 elastic-job、有赞 TSP。</li>
<li><strong>数据库层</strong>：支持弹性扩容和分库分表的 TDDL、数据库连接池 Driud、Binlog 同步的 Canal。</li>
</ul>
<h2 id="消息中间件"><a href="#消息中间件" class="headerlink" title="消息中间件"></a>消息中间件</h2><blockquote>
<p>缺点：系统可用性降低、系统稳定性降低、分布式一致性问题</p>
</blockquote>
<ul>
<li><strong>复杂链路的异步调用</strong>：如果大量并发请求不需要服务器及时响应时则可将消息缓存后按顺序处理，比如用户注册(发布)、数据入库、消息队列、异步发送注册短信。</li>
<li><strong>复杂系统的解耦</strong>：将服务拆分，比如用户下单(发布)、消息队列、库存系统(订阅)处理业务。</li>
<li><strong>瞬时高峰的削峰处理</strong>：商品秒杀活动时过滤掉大多数无效请求后转发，比如用户下单(发送)、消息队列(根据实际情况限制人数等)、订阅消息根据秒杀规则处理业务。</li>
<li><strong>分布式应用的通信</strong>：根据应用使用的开发语言选择合适接口实现通信并对数据进行处理和转发，比如服务 A (发送消息)、消息队列、服务 B (订阅消息)。</li>
</ul>
<h2 id="JS-实现"><a href="#JS-实现" class="headerlink" title="JS 实现"></a>JS 实现</h2><blockquote>
<p>每一个中间件执行结果传递给下一个中间件并等待其结束以后又回到当前执行逻辑，缺点主要有系统可用性降低、系统稳定性降低、分布式一致性问题。</p>
</blockquote>
<ul>
<li><strong>axios</strong>：最简单，直接 promise 链式调用。</li>
<li><strong>redux</strong>：通过 reduce 静态生成，将中间件的执行结果作为上一个中间件的 next 参数。</li>
<li><strong>express、Redux</strong>：next 通过 redux 静态生成并已确定执行顺序，express 则是动态执行。</li>
<li><strong>express、koa</strong>：通过递归动态执行，区别在于 koa 通过 return promise 形成洋葱模型，expres 则在调用时没有 return，最终执行的是 await undefind 而不是 await promise。</li>
<li><strong>compose 为什么必须返回 promise.resolve</strong>：防止只有请求中间件且为同步函数时报错。</li>
<li><strong>redux 中间件必须返回函数</strong>：redux 多了一个组合的过程，组合时需要将中间件的执行结果而不是函数来作为上一个中间件的 next 参数，否则传给中间件就会报错。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数处理前执行 fn</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">before</span> = <span class="keyword">function</span>(<span class="params">fn</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> res = fn.<span class="title function_">call</span>(<span class="variable language_">this</span>)</span><br><span class="line">        <span class="keyword">if</span> (!res) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        self.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数处理后执行 fn</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">after</span> = <span class="keyword">function</span>(<span class="params">fn</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        self.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">        fn.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交前上报数据、验证数据</span></span><br><span class="line">submit.<span class="title function_">before</span>(report).<span class="title function_">before</span>(validate)()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">submit</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;提交数据&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Axios</span></span><br><span class="line"><span class="comment">// 使用中间件：成功回调、失败回调、是否同步执行中间件 request、运行时是否添加中间件</span></span><br><span class="line"><span class="title class_">InterceptorManager</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">use</span> = <span class="keyword">function</span> (<span class="params">fulfilled, rejected, options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">fulfilled</span>: fulfilled,</span><br><span class="line">        <span class="attr">rejected</span>: rejected,</span><br><span class="line">        <span class="attr">runWhen</span>: options ? options.<span class="property">runWhen</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">synchronous</span>: options ? options.<span class="property">synchronous</span> : <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加中间件：adapter 是 node/browser 请求的适配器</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> <span class="title function_">dispatchRequest</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> adapter = config.<span class="property">adapter</span> || defaults.<span class="property">adapter</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">adapter</span>(config).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">onAdapterResolution</span>(<span class="params">response</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;, <span class="keyword">function</span> <span class="title function_">onAdapterRejection</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(reason);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、定义 request、response 拦截器并插在 dispatchRequest 前后</span></span><br><span class="line"><span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span> = <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> requestInterceptorChain = [];</span><br><span class="line">  <span class="keyword">var</span> synchronousRequestInterceptors = <span class="literal">true</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> <span class="title function_">unshiftRequestInterceptors</span>(<span class="params">interceptor</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> interceptor.<span class="property">runWhen</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; </span><br><span class="line">      interceptor.<span class="title function_">runWhen</span>(config) === <span class="literal">false</span>) &#123; </span><br><span class="line">          <span class="keyword">return</span>; </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      synchronousRequestInterceptors = synchronousRequestInterceptors &amp;&amp; </span><br><span class="line">      interceptor.<span class="property">synchronous</span>;</span><br><span class="line">      requestInterceptorChain.<span class="title function_">unshift</span>(interceptor.<span class="property">fulfilled</span>, interceptor.<span class="property">rejected</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> responseInterceptorChain = [];</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> <span class="title function_">pushResponseInterceptors</span>(<span class="params">interceptor</span>) &#123;</span><br><span class="line">      responseInterceptorChain.<span class="title function_">push</span>(interceptor.<span class="property">fulfilled</span>, interceptor.<span class="property">rejected</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> promise;</span><br><span class="line">  <span class="comment">// 2、request 都是异步，构建链式调用 then(fulfilled, rejected).then(fulfilled, rejected)</span></span><br><span class="line">  <span class="keyword">if</span> (!synchronousRequestInterceptors) &#123;</span><br><span class="line">      <span class="keyword">var</span> chain = [dispatchRequest, <span class="literal">undefined</span>];</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unshift</span>.<span class="title function_">apply</span>(chain, requestInterceptorChain);</span><br><span class="line">      chain.<span class="title function_">concat</span>(responseInterceptorChain);</span><br><span class="line"></span><br><span class="line">      promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config);</span><br><span class="line">      <span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">          promise = promise.<span class="title function_">then</span>(chain.<span class="title function_">shift</span>(), chain.<span class="title function_">shift</span>());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> promise;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3、如果存在 request 同步拦截器则先执行并获取新配置，然后构建链式调用 promise.then.then</span></span><br><span class="line">  <span class="keyword">var</span> newConfig = config;</span><br><span class="line">  <span class="keyword">while</span> (requestInterceptorChain.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> onFulfilled = requestInterceptorChain.<span class="title function_">shift</span>();</span><br><span class="line">      <span class="keyword">var</span> onRejected = requestInterceptorChain.<span class="title function_">shift</span>();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          newConfig = <span class="title function_">onFulfilled</span>(newConfig);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="title function_">onRejected</span>(error);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">      promise = <span class="title function_">dispatchRequest</span>(newConfig);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (responseInterceptorChain.<span class="property">length</span>) &#123;</span><br><span class="line">      promise = promise.<span class="title function_">then</span>(responseInterceptorChain.<span class="title function_">shift</span>(), </span><br><span class="line">      responseInterceptorChain.<span class="title function_">shift</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Redux：将中间件执行结果作为上一个中间件的 next 参数，类似 pipe 反向装载和正向执行</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">...funcs</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (funcs.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params">arg</span>) =&gt;</span> arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (funcs.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> funcs[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> funcs.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="title function_">a</span>(<span class="title function_">b</span>(...args)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 举例实现：依次执行中间件 add multiple、目标函数 print</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">next</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">num</span>) =&gt;</span> &#123; <span class="title function_">next</span>(num + <span class="number">1</span>) &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">multiple</span>(<span class="params">next</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="title function_">next</span>(num * <span class="number">2</span>) &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">print</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> compute = <span class="title function_">compose</span>(add, multiple)(print) = <span class="title function_">add</span>(<span class="title function_">mulitple</span>(print))</span><br><span class="line"><span class="title function_">compute</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> <span class="variable">Express</span></span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> app：管理多个中间件的实例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> funcs：存储待执行的函数数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@preme</span> app.use：将函数添加到函数数组的全局中间件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@preme</span> next：递归执行到最后一个任务 task[0]()、task[1]()</span></span><br><span class="line"><span class="comment">**/</span> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">express</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> funcs = [];</span><br><span class="line">    <span class="keyword">var</span> app = <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> task = funcs[i++]; <span class="comment">// 取出函数数组里的下一个函数</span></span><br><span class="line">            <span class="keyword">if</span> (!task) &#123; <span class="keyword">return</span> &#125;  <span class="comment">// 如果函数不存在则执行 return</span></span><br><span class="line">            <span class="title function_">task</span>(req, res, next);  <span class="comment">// 否则执行下个函数，没有 return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    app.<span class="property">use</span> = <span class="keyword">function</span> (<span class="params">task</span>) &#123;</span><br><span class="line">        funcs.<span class="title function_">push</span>(task);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> app;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据统计&#x27;</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;日志统计&#x27;</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Hello World!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// koa-compose</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span> (middleware) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(middleware)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Middleware stack must be an array!&#x27;</span>)</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> middleware) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Middleware must be composed!&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">cxt, next</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> index = -<span class="number">1</span></span><br><span class="line">        <span class="keyword">let</span> newError = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;next() called multiple times&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">dispatch</span>(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">dispatch</span> (i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &lt;= index) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(newError)</span><br><span class="line">            index = i</span><br><span class="line">            <span class="keyword">let</span> fn = middleware[i]</span><br><span class="line">            <span class="comment">// 洋葱类型：中间件正常执行完则赋值为外部传入的目标函数</span></span><br><span class="line">            <span class="keyword">if</span> (i === middleware.<span class="property">length</span>) fn = next</span><br><span class="line">            <span class="comment">// 终止条件，返回 promise</span></span><br><span class="line">            <span class="keyword">if</span> (!fn) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// 递归返回：确保 fn() 返回 promise，并修改中间件的 next 参数</span></span><br><span class="line">              <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>(cxt, dispatch.<span class="title function_">bind</span>(<span class="literal">null</span>, i+<span class="number">1</span>)))</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果：1、2、3、4、5</span></span><br><span class="line"><span class="keyword">import</span> compose <span class="keyword">from</span> <span class="string">&#x27;koa-compose&#x27;</span>;</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">m1</span>(<span class="params">ctx, next</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">m2</span>(<span class="params">ctx , next</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> c = <span class="title function_">compose</span>([m1, m2])</span><br><span class="line"><span class="title function_">c</span>(<span class="literal">null</span>, <span class="function">()=&gt;</span>&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>) &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码转换</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">m1</span>(context, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">m2</span>(ctx, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">next</span>(ctx, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;))</span><br><span class="line">&#125;))</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>((<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(</span><br><span class="line">        (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>((<span class="function">() =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>) &#125;)())</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">        &#125;)()</span><br><span class="line">    )</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br><span class="line">&#125;)())</span><br></pre></td></tr></table></figure>


<h1 id="三、微前端应用"><a href="#三、微前端应用" class="headerlink" title="三、微前端应用"></a>三、微前端应用</h1>]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>前端成长技能栈</title>
    <url>/2022/10/21/17-%E5%89%8D%E7%AB%AF%E6%8A%80%E8%83%BD/</url>
    <content><![CDATA[<h1 id="一、组件库在线文档"><a href="#一、组件库在线文档" class="headerlink" title="一、组件库在线文档"></a>一、组件库在线文档</h1><h2 id="Dumi-开发组件库"><a href="#Dumi-开发组件库" class="headerlink" title="Dumi 开发组件库"></a>Dumi 开发组件库</h2><blockquote>
<p>静态站点框架主要有：Dumi、Storybook、Gitbook、VuePress、VitePress、Docsify。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 1、初始化目录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  npx：npm5.2 新增的执行包，依赖包不存在时自动下载</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  dumi 开发组件，father-build 将源码 md/ts 解析为 React</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">npx @umijs/create-dumi-lib         <span class="comment">// 文档模式：只包含组件文档</span></span><br><span class="line">npx @umijs/create-dumi-lib --site  <span class="comment">// 站点模式：完整的组件库网站</span></span><br><span class="line">npx @umijs/create-dumi-app         <span class="comment">// 纯静态站点：不包含组件源码</span></span><br><span class="line"></span><br><span class="line">npx @umijs/create-dumi-lib --site</span><br><span class="line">npm install、npm start、npm run build</span><br><span class="line"></span><br><span class="line">├── <span class="variable constant_">README</span>.<span class="property">md</span></span><br><span class="line">├── docs                 <span class="comment">// 文档目录</span></span><br><span class="line">│   ├── index.<span class="property">md</span>         <span class="comment">// 文档首页</span></span><br><span class="line">│   └── otherDir         <span class="comment">// 文档其它路由</span></span><br><span class="line">│   		├── index.<span class="property">md</span></span><br><span class="line">│   		├── sample.<span class="property">md</span></span><br><span class="line">│   		└── help.<span class="property">md</span></span><br><span class="line">├── src                  <span class="comment">// 源码目录</span></span><br><span class="line">│   ├── index.<span class="property">ts</span>         <span class="comment">// 入口文件</span></span><br><span class="line">│   └── <span class="title class_">Foo</span>              <span class="comment">// 组件源码</span></span><br><span class="line">│       ├── index.<span class="property">md</span> </span><br><span class="line">│   		└── index.<span class="property">ts</span></span><br><span class="line">├── .<span class="property">umirc</span>.<span class="property">ts</span>            <span class="comment">// dumi 配置文件</span></span><br><span class="line">└── .<span class="property">fatherrc</span>.<span class="property">ts</span>         <span class="comment">// father-build 打包配置文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、新建组件 /src/MyButton/index.md：npm install antd -D</span></span><br><span class="line">---</span><br><span class="line"><span class="attr">title</span>: 页面名称</span><br><span class="line"><span class="attr">nav</span>:</span><br><span class="line">  <span class="attr">title</span>: <span class="title class_">Components</span>   <span class="comment">// 导航名称</span></span><br><span class="line">  <span class="attr">path</span>: <span class="regexp">/components   /</span><span class="regexp">/ 导航路由</span></span><br><span class="line"><span class="regexp">  order: 0            /</span><span class="regexp">/ 导航顺序，数字越小越靠前</span></span><br><span class="line"><span class="regexp">group:</span></span><br><span class="line"><span class="regexp">  title: MyButton</span></span><br><span class="line"><span class="regexp">  path: /</span>btn          <span class="comment">// 分组路由 = 导航路由+自己</span></span><br><span class="line">  <span class="attr">order</span>: <span class="number">1</span>            <span class="comment">// 分组顺序，默认以路径长度和字典序排序</span></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## <span class="title class_">MyButton</span></span><br><span class="line"><span class="comment">// ```tsx    使用时不注释</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyButton</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;my-dumi-doc&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">MyButton</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>click me!<span class="tag">&lt;/<span class="name">MyButton</span>&gt;</span></span>;</span><br><span class="line"><span class="comment">// ```</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// /src/index.ts：暴露组件</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> <span class="title class_">MyButton</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MyButton&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MyButton/index.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span>, <span class="title class_">ButtonProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;antd/dist/antd.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">MyButtonProps</span> <span class="keyword">extends</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line">    isMy?: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyButton</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">MyButtonProps</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; children, ...restProps &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> &#123;<span class="attr">...restProps</span>&#125;&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MyButton</span>;</span><br></pre></td></tr></table></figure>


<h2 id="lerna-管理多个包"><a href="#lerna-管理多个包" class="headerlink" title="lerna 管理多个包"></a>lerna 管理多个包</h2><blockquote>
<p>用来优化托管在 git&#x2F;npm 上的多包代码库的工作流的一个管理工具，可以让你在主项目下管理多个子项目，从而解决了多个包互相依赖并且发布时需要手动维护多个包的问题。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根目录初始化：自动生成 lerna.json、packages</span></span><br><span class="line">npm install -g lerna、lerna init</span><br><span class="line">lerna create @keith/button packages/button --yes</span><br><span class="line"></span><br><span class="line">lerna init       <span class="comment">// 初始化配置</span></span><br><span class="line">lerna create     <span class="comment">// 创建包</span></span><br><span class="line">lerna link       <span class="comment">// 链接包</span></span><br><span class="line">lerna add        <span class="comment">// 安装单个依赖</span></span><br><span class="line">lerna bootstrap  <span class="comment">// 安装全局依赖并链接到所有子包</span></span><br><span class="line">lerna clean      <span class="comment">// 清除 node_modules</span></span><br><span class="line">lerna list       <span class="comment">// 列出子包</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;declaration&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;  <span class="comment">// 此处新增组件目录</span></span><br><span class="line">      <span class="string">&quot;@keith/button&quot;</span>: [<span class="string">&quot;./packages/button/src/index.tsx&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .fatherrc.ts：添加 button</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">headPkgs</span>: string[] = [<span class="string">&#x27;button&#x27;</span>]; </span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json：添加 workspaces</span></span><br><span class="line"> <span class="string">&quot;workspaces&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;packages/*&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;dumi dev&quot;</span>,</span><br><span class="line">  <span class="string">&quot;docs:build&quot;</span>: <span class="string">&quot;dumi build&quot;</span>,</span><br><span class="line">  <span class="string">&quot;docs:deploy&quot;</span>: <span class="string">&quot;gh-pages -d docs-dist&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;father-build&quot;</span>,</span><br><span class="line">  <span class="string">&quot;deploy&quot;</span>: <span class="string">&quot;npm run docs:build &amp;&amp; npm run docs:deploy&quot;</span>,</span><br><span class="line">  <span class="string">&quot;prettier&quot;</span>: <span class="string">&quot;prettier --write \&quot;**/*.&#123;js,jsx,tsx,ts,less,md,json&#125;\&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;test&quot;</span>: <span class="string">&quot;umi-test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;test:coverage&quot;</span>: <span class="string">&quot;umi-test --coverage&quot;</span>,</span><br><span class="line">  <span class="string">&quot;prepublishOnly&quot;</span>: <span class="string">&quot;npm run build&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除多余目录：组件目录 lib/_test_、根目录 src</span></span><br></pre></td></tr></table></figure>

<h2 id="Prettier-Eslint-代码风格"><a href="#Prettier-Eslint-代码风格" class="headerlink" title="Prettier Eslint 代码风格"></a>Prettier Eslint 代码风格</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install @umijs/fabric -D</span><br><span class="line"></span><br><span class="line"><span class="comment">// .prettierrc.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="built_in">require</span>(<span class="string">&#x27;@umijs/fabric&#x27;</span>).<span class="property">prettier</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .eslintrc.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">extends</span>: [<span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;@umijs/fabric/dist/eslint&#x27;</span>)],</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<h2 id="GitHooks-Commitlin-提交规范"><a href="#GitHooks-Commitlin-提交规范" class="headerlink" title="GitHooks Commitlin 提交规范"></a>GitHooks Commitlin 提交规范</h2><blockquote>
<p><code>GitHooks</code> 是指在 git 操作时触发运行 .git&#x2F;hooks 目录下的钩子脚本，自定义钩子操作时如果直接修改 hooks 脚本并去掉 sample 后缀即可生效但是不能提交修改代码，所以一般通过引入工具 husky&#x2F;yorkie 来配置。<code>Commitlin</code> 是用来配置提交信息校验规则的工具。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install @umijs/yorkie -D</span><br><span class="line">npm install @commitlint/cli @commitlint/config-conventional -D</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;gitHooks&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;pre-commit&quot;</span>: <span class="string">&quot;lint-staged&quot;</span>,</span><br><span class="line">    <span class="string">&quot;commit-msg&quot;</span>: <span class="string">&quot;commitlint -E GIT_PARAMS&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;packages/**/*.&#123;js, ts, jsx, tsx, md, json&#125;&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;eslint --fix&quot;</span>,</span><br><span class="line">      <span class="string">&quot;prettier --write&quot;</span>,</span><br><span class="line">      <span class="string">&quot;git add .&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .commitlintrc.js / commitlint.config.js </span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&#x27;@commitlint/config-conventional&#x27;</span>],</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;type-enum&#x27;</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      <span class="string">&#x27;always&#x27;</span>,</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&#x27;feature&#x27;</span>,    <span class="comment">// 开发新功能</span></span><br><span class="line">        <span class="string">&#x27;fix&#x27;</span>,        <span class="comment">// 修补 bug</span></span><br><span class="line">        <span class="string">&#x27;refactor&#x27;</span>,   <span class="comment">// 代码重构</span></span><br><span class="line">        <span class="string">&#x27;docs&#x27;</span>,       <span class="comment">// 文档</span></span><br><span class="line">        <span class="string">&#x27;style&#x27;</span>,      <span class="comment">// 格式（不影响代码运行的变动）</span></span><br><span class="line">        <span class="string">&#x27;test&#x27;</span>,       <span class="comment">// 增加测试</span></span><br><span class="line">        <span class="string">&#x27;build&#x27;</span>,      <span class="comment">// 变更项目构建或外部依赖（webpack、package等）</span></span><br><span class="line">        <span class="string">&#x27;revert&#x27;</span>,     <span class="comment">// 回滚</span></span><br><span class="line">        <span class="string">&#x27;perf&#x27;</span>,       <span class="comment">// 改善性能</span></span><br><span class="line">      ],</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;type-empty&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],       <span class="comment">// 不符合规范时，可提交但有警告</span></span><br><span class="line">    <span class="string">&#x27;subject-empty&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],    <span class="comment">// 不符合规范时，可提交但有警告</span></span><br><span class="line">    <span class="string">&#x27;subject-full-stop&#x27;</span>: [<span class="number">0</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;subject-case&#x27;</span>: [<span class="number">0</span>, <span class="string">&#x27;never&#x27;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="二、前端智能化"><a href="#二、前端智能化" class="headerlink" title="二、前端智能化"></a>二、前端智能化</h1><blockquote>
<p>AI 在前端领域基于设计稿生成源代码的一系列落地方案。<a href="https://code.fun/docs">CodeFun</a> 就是一款可以将 Figma、Sketch、Photoshop 等设计稿智能转换为前端源代码的工具。</p>
</blockquote>
<h1 id="渐进式应用-PWA"><a href="#渐进式应用-PWA" class="headerlink" title="渐进式应用 PWA"></a>渐进式应用 PWA</h1>]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx 基础使用</title>
    <url>/2022/08/26/16-Nginx/</url>
    <content><![CDATA[<h1 id="一、基础概述"><a href="#一、基础概述" class="headerlink" title="一、基础概述"></a>一、基础概述</h1><blockquote>
<p>Nginx 是开源、高性能、高可靠的 Web 和反向代理服务器，而且支持热部署，几乎可以做到几个月不间断运行，而且可以在不间断服务的情况下对软件版本进行热更新。性能是 Nginx 最重要的考量，其占用内存少、并发能力强、能支持高达 5w 个并发连接数，最重要的是免费的并可以商业化，配置使用也比较简单。</p>
</blockquote>
<h2 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h2><ul>
<li>高并发和高性能。</li>
<li>模块化架构而具有高扩展性。</li>
<li>异步非阻塞的事件驱动模型相似于 Node.js。</li>
<li>可以几个月不需要重启服务器而具有高可靠性。</li>
<li>热部署和平滑升级。</li>
<li>完全开源和生态繁荣。</li>
</ul>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><blockquote>
<p>Nginx 擅长于静态资源处理转发、反向代理、负载均衡等对底层服务器端资源的处理，NodeJS 更擅长上层具体业务逻辑的处理，两者可以完美组合。</p>
</blockquote>
<ul>
<li>静态资源服务，通过本地文件系统提供服务。</li>
<li>反向代理服务，延伸出包括缓存、负载均衡等。</li>
<li>API 服务：基于 Nginx 扩展开发的 Web 应用平台 OpenResty。</li>
</ul>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><ul>
<li><strong>代理</strong>：客户端和服务器之间假设的一层服务器，代理将接收客户端的请求并将它转发给服务器，然后将服务端的响应转发给客户端。</li>
<li><strong>简单请求</strong>：满足的两个条件为 请求方法 HEAD&#x2F;GET&#x2F;POST、HTTP 头信息不超过以下字段：Accept、Accept-Language、Content-Language、Last-Event-ID、Content-Type 只限于三个值 application&#x2F;x-www-form-urlencoded、multipart&#x2F;form-data、text&#x2F;plain。浏览器处理时会在头信息增加用来说明请求来源(协议+域名+端口)的 Origin 字段后直接发出，服务器如果发现 Origin 指定的域名在许可范围内就返回包含 Access-Control- 头信息字段的数据，否则就抛出错误。</li>
<li><strong>非简单请求</strong>：指那种对服务器有特殊要求的请求，比如请求方法 PUT&#x2F;DELETE，或 Content-Type 值为 application&#x2F;json。浏览器会在正式通信之前，发送一次 HTTP 预检 OPTIONS 请求，先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些 HTTP 请求方法和头信息字段。只有得到肯定答复，浏览器才会发出正式的 XHR 请求，否则报错。</li>
<li><strong>正向代理</strong>：客户端向代理发送一个请求并指定目标服务器，然后代理向目标服务器转交请求并将结果返回。正向代理可以让客户端访问到它本身无法访问到的服务器资源，但对服务端是不透明的，它并不知道请求是来自代理还是真实客户端。</li>
<li><strong>反向代理</strong>：代理接受客户端请求，然后转发给内部网络的服务器并将结果返回。反向代理可以帮助服务器接收或转发请求，但对对客户端是不透明的，主要优势有隐藏真实服务器、负载均衡而便于扩充后端动态服务、动静分离而提升系统健壮性。</li>
<li><strong>动静分离</strong>：将静态资源和动态资源分为不同系统访问的架构设计方法，可提升整个服务的访问性和可维护性。一般将静态资源部署在 Nginx 并利用反向代理的原理将动态资源的请求转发给对应后台处理，从而实现动静分离并提升静态资源的访问速度。</li>
<li><strong>负载均衡</strong>：将客户端请求转发给服务器集群然后分发给不同服务器，解决单个服务器处理多个复杂并发请求容易崩溃的问题。<strong>Nginx 实现策略</strong>有：请求轮询策略(将所有请求轮询分配而解决单个服务器影响所有)、最小连接数策略(优先分配给压力较小的服务器)、最快响应时间策略(优先分配给响应时间最短的服务器)、客户端 IP 绑定策略(同一个 IP 的请求只分配一台服务器而解决 session 共享问题)。</li>
</ul>
<h2 id="架构机制"><a href="#架构机制" class="headerlink" title="架构机制"></a>架构机制</h2><ul>
<li><strong>多进程架构</strong><ul>
<li><strong>主进程</strong>：用于接收外部信息和管理多个工作进程但本身并不真正处理用户请求。监听到子进程异常退出时重启新进程，监听到配置文件被修改时重新加载实现热部署。</li>
<li><strong>work 工作进程</strong>：用于执行处理网络连接、读取并写入内容到磁盘、与服务器通信等所有实际任务。每个工作进程都是以非阻塞的方式处理多个连接的独立单线程，但可以通过共享内存的方式进行通信。</li>
<li><strong>Cache Loader 缓存加载进程</strong>：启动时运行并把基于磁盘的缓存加载到内存后退出，调度很谨慎导致其资源需求很低。</li>
<li><strong>Cache Manager 缓存管理进程</strong>：周期性运行并削减磁盘缓存来使缓存保持在配置的大小范围内。</li>
</ul>
</li>
<li><strong>模块化架构</strong><ul>
<li><strong>核心模块</strong>：Nginx 服务器正常运行必不可少的模块，提供错误日志记录、配置文件解析、事件驱动、进程管理等核心功能。比如 ngx_core、ngx_errlog、ngx_conf、ngx_events、ngx_event、ngx_epoll、ngx_regex。</li>
<li><strong>标准 HTTP 模块</strong>：提供端口配置、网页编码设置、响应头设置等 HTTP 协议解析相关的功能，比如 ngx_http_core、ngx_http_charset。</li>
<li><strong>可选 HTTP 模块</strong>：用于实现压缩网络数据、支持安全协议 SSL 等标准 HTTP 扩展功能，比如 ngx_http_gzip、支持ssl协议ngx_http_ssl。</li>
<li><strong>邮件服务模块</strong>：主要用于支持邮件服务，比如 ngx_mail_core、ngx_mail_pop3。</li>
<li><strong>第三方模块</strong>：用于实现 Nginx 应用的扩展功能，比如 rds-json-nginx lua-nginx。</li>
</ul>
</li>
<li><strong>配置文件重载流程</strong><ol>
<li>reload 命令执行后向主进程发送 HUP 信号。</li>
<li>主进程检查配置语法是否正确，然后打开监听端口。</li>
<li>主进程使用新的配置文件启动新的 worker 子进程。</li>
<li>主进程向老的 worker 子进程发送 QUIT 信号。</li>
<li>老的 worker 进程关闭监听句柄，处理完当前连接后关闭进程。</li>
<li>整个过程 Nginx 始终平稳运行，实现了平滑更新而用户无感知。</li>
</ol>
</li>
</ul>
<h2 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> mac 安装</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 命令：安装、查看配置、brew 方式启动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 路径：安装、配置文件、服务器默认路径</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">brew install nginx</span><br><span class="line">brew info nginx</span><br><span class="line">brew services start/restart nginx</span><br><span class="line"></span><br><span class="line">/usr/local/<span class="title class_">Cellar</span>/nginx/<span class="number">1.15</span><span class="number">.5</span></span><br><span class="line">/usr/local/etc/nginx/nginx.<span class="property">conf</span></span><br><span class="line">/usr/local/<span class="keyword">var</span>/www</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> Linux 安装</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 命令：安装、查看安装信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 路径：子配置项、主配置文件、静态文件</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">yum install nginx -y</span><br><span class="line">rpm -ql nginx</span><br><span class="line"></span><br><span class="line">/etc/nginx/conf.<span class="property">d</span>/ </span><br><span class="line"><span class="regexp">/etc/</span>nginx/nginx.<span class="property">conf</span></span><br><span class="line">/usr/share/nginx/html/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 系统操作</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 防火墙：系统开启时则需要设置在防火墙加入需要开放的端口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> systemctl：Linux 系统应用管理工具 systemd 的主命令</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">systemctl start firewalld     <span class="comment">// 开启防火墙</span></span><br><span class="line">systemctl stop firewalld      <span class="comment">// 关闭防火墙</span></span><br><span class="line">systemctl status firewalld    <span class="comment">// 查看防火墙开启状态</span></span><br><span class="line">systemctl enable nginx        <span class="comment">// 开机自动启动</span></span><br><span class="line">systemctl disable nginx       <span class="comment">// 关闭开机自动启动</span></span><br><span class="line">systemctl start nginx         <span class="comment">// 启动 Nginx</span></span><br><span class="line">systemctl stop nginx          <span class="comment">// 停止 Nginx</span></span><br><span class="line">systemctl restart nginx       <span class="comment">// 重启 Nginx</span></span><br><span class="line">systemctl reload nginx        <span class="comment">// 重新加载 Nginx</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// nginx 应用命令</span></span><br><span class="line">nginx               <span class="comment">// 启动：http://localhost:8080</span></span><br><span class="line">nginx -s stop       <span class="comment">// 停止</span></span><br><span class="line">nginx -s reopen     <span class="comment">// 重启</span></span><br><span class="line">nginx -s reload     <span class="comment">// 重新加载</span></span><br><span class="line">nginx -s quit       <span class="comment">// 退出</span></span><br><span class="line">nginx -v            <span class="comment">// 查看版本</span></span><br><span class="line">nginx -c filename   <span class="comment">// 指定配置文件</span></span><br><span class="line">cat -n nginx.<span class="property">conf</span>   <span class="comment">// 查看配置</span></span><br></pre></td></tr></table></figure>


<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、主配置文件 /etc/nginx/nginx.conf，结构图如下：</span></span><br><span class="line">main                  <span class="comment"># 全局配置，对全局生效</span></span><br><span class="line">├── events            <span class="comment"># 配置 Nginx 服务器与用户的网络连接</span></span><br><span class="line">├── http              <span class="comment"># 配置代理、缓存、日志等大多数功能和第三方模块</span></span><br><span class="line">│   ├── upstream      <span class="comment"># 配置后端服务器具体地址，负载均衡配置不可或缺</span></span><br><span class="line">│   ├── server        <span class="comment"># 配置虚拟主机的相关参数，一个 http 可有多个 server</span></span><br><span class="line">│   ├── server        </span><br><span class="line">│   │   ├── location  <span class="comment"># 一个 server 块可以包含多个用于匹配路径的 location</span></span><br><span class="line">│   │   ├── location</span><br><span class="line">│   │   └── ...</span><br><span class="line">│   └── ...</span><br><span class="line">└── ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、配置文件的语法规则</span></span><br><span class="line">配置文件由指令与指令块构成；</span><br><span class="line">每条指令以 ; 分号结尾，指令与参数间以空格符号分隔；</span><br><span class="line">指令块以 &#123;&#125; 大括号将多条指令组织在一起；</span><br><span class="line">include 语句允许组合多个配置文件以提升可维护性；</span><br><span class="line">使用 <span class="comment"># 符号添加注释，提高可读性；</span></span><br><span class="line">使用 $ 符号使用变量；</span><br><span class="line">部分指令的参数支持正则表达式；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、典型配置如下</span></span><br><span class="line"><span class="comment"># main：全局配置</span></span><br><span class="line">user nginx lion;                           <span class="comment"># 用户 nginx、组 lion (可空)</span></span><br><span class="line">worker_processes  auto;                    <span class="comment"># 进程数，一般设置为同 CPU 核数</span></span><br><span class="line">error_log  /var/log/nginx/error.log warn;  <span class="comment"># 错误日志存放目录</span></span><br><span class="line">pid        /var/run/nginx.pid;             <span class="comment"># 运行服务的主进程 pid 存放位置</span></span><br><span class="line">worker_rlimit_nofile <span class="number">20480</span>;                <span class="comment"># 每个子进程的最大连接数量</span></span><br><span class="line">worker_rlimit_core 50M;                    <span class="comment"># 子进程异常终止后的 core 大小限制</span></span><br><span class="line">working_directory /opt/nginx/tmp;          <span class="comment"># 用于记录分析的 core 文件存放目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># events：Nginx 服务器与用户的网络连接</span></span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;                             <span class="comment"># epoll I/O 轮询：默认最适合系统的</span></span><br><span class="line">    worker_connections <span class="number">1024</span>;               <span class="comment"># 每个子进程允许最大并发数</span></span><br><span class="line">    accept_mutex on                        <span class="comment"># 打开负载均衡互斥锁，默认 off 关闭</span></span><br><span class="line">    server_name www.nginx.com;             <span class="comment"># 指定虚拟主机域名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 域名匹配的四种写法：精确 &gt; 左侧通配符 &gt; 右侧通配符 &gt; 正则表达式</span></span><br><span class="line">    server_name www.nginx.com;             <span class="comment"># 精确匹配</span></span><br><span class="line">    server_name *.nginx.com;               <span class="comment"># 左侧通配</span></span><br><span class="line">    server_name www.nginx.*;               <span class="comment"># 右侧通配</span></span><br><span class="line">    server_name ~^www\.nginx\.*$;          <span class="comment"># 正则匹配</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># http：代理、缓存、日志定义等大多数功能和第三方模块</span></span><br><span class="line">http &#123; </span><br><span class="line">    <span class="comment"># 设置日志模式</span></span><br><span class="line">    log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    root /opt/nginx/static;       <span class="comment"># 静态资源目录，可用于 http、server、location</span></span><br><span class="line">    access_log /var/log/nginx/access.log main;   <span class="comment"># 访问日志存放位置</span></span><br><span class="line"></span><br><span class="line">    sendfile            on;       <span class="comment"># 开启高效传输模式</span></span><br><span class="line">    tcp_nopush          on;       <span class="comment"># 减少网络报文段的数量</span></span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   <span class="number">65</span>;       <span class="comment"># 保持连接的时间，也叫超时时间，单位秒</span></span><br><span class="line">    types_hash_max_size <span class="number">2048</span>;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;      <span class="comment"># 文件扩展名与类型映射表</span></span><br><span class="line">    default_type        application/octet-stream;   <span class="comment"># 默认文件类型</span></span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;               <span class="comment"># 加载子配置项</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># server：配置虚拟主机的相关参数，一个 http 块中可以有多个 server</span></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       <span class="number">80</span>;            <span class="comment"># 监听端口</span></span><br><span class="line">        server_name  localhost;     <span class="comment"># 域名</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># location：配置路径 </span></span><br><span class="line">        <span class="comment"># 不带 / 时会在找不到 index 文件时查找 test 文件，带 / 则不会查找</span></span><br><span class="line">        <span class="comment"># = 精确匹配 &gt; ^~ 匹配即停止 &gt; ~ 区分大小写的正则 &gt; ~* 不区分的正则 &gt; 无字符</span></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /usr/share/nginx/html;   <span class="comment"># 静态资源目录</span></span><br><span class="line">            index  index.html index.htm;    <span class="comment"># 默认首页文件</span></span><br><span class="line">            deny <span class="number">172.168</span><span class="number">.22</span><span class="number">.11</span>;             <span class="comment"># 禁止访问的 ip 地址，allow 允许</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span> <span class="string">&#x27;No Page&#x27;</span>;           <span class="comment"># 返回响应码或重定向地址</span></span><br><span class="line">            <span class="keyword">return</span> https://www.baidu.com;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location = /match_all/ &#123; &#125;</span><br><span class="line">        location ~ \.(jpeg|jpg|png|svg)$ &#123; &#125;</span><br><span class="line">        location ^~ /b/ &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># rewrite：根据指定正则表达式匹配规则，正则/替换内容/flag</span></span><br><span class="line">        location /search &#123;</span><br><span class="line">            <span class="comment"># flag 可选值：last、break、redirect、permanent</span></span><br><span class="line">            rewrite ^/(.*) https://www.baidu.com redirect;</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        location /images &#123;</span><br><span class="line">            rewrite /images/(.*) /pics/$<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;   <span class="comment"># 默认 50x 对应的访问页面</span></span><br><span class="line">        error_page <span class="number">400</span> <span class="number">404</span> error.html;          <span class="comment"># 同上</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># upstream 配置后端服务器的具体地址，负载均衡配置时不可或缺</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nginx 配置文件中可以直接使用的内置预定义变量主要如下：</span></span><br><span class="line">remote_addr           <span class="comment"># 客户端 IP 地址</span></span><br><span class="line">remote_port           <span class="comment"># 客户端端口</span></span><br><span class="line">server_addr           <span class="comment"># 服务端 IP 地址</span></span><br><span class="line">server_port           <span class="comment"># 服务端端口</span></span><br><span class="line">server_protocol       <span class="comment"># 服务端协议</span></span><br><span class="line">binary_remote_addr    <span class="comment"># 二进制格式的客户端 IP 地址</span></span><br><span class="line">connection            <span class="comment"># TCP 连接的序号，递增</span></span><br><span class="line">connection_request    <span class="comment"># TCP 连接当前的请求数量</span></span><br><span class="line">uri                   <span class="comment"># 请求的 URL，不包含参数</span></span><br><span class="line">request_uri           <span class="comment"># 请求的 URL，包含参数</span></span><br><span class="line">scheme                <span class="comment"># http/https 协议名</span></span><br><span class="line">request_method        <span class="comment"># 请求方法</span></span><br><span class="line">request_length        <span class="comment"># 请求长度，包含请求行、请求头、请求体</span></span><br><span class="line">args                  <span class="comment"># 全部参数字符串</span></span><br><span class="line">arg_参数名             <span class="comment"># 获取特定参数值</span></span><br><span class="line">is_args               <span class="comment"># URL 是否有参数</span></span><br><span class="line">query_string          <span class="comment"># 同 args </span></span><br><span class="line">host                  <span class="comment"># 请求信息 Host</span></span><br><span class="line">http_user_agent       <span class="comment"># 用户浏览器</span></span><br><span class="line">http_referer          <span class="comment"># 从哪些链接过来的请求</span></span><br><span class="line">http_via              <span class="comment"># 每经过一层代理服务器都会添加相应信息</span></span><br><span class="line">http_cookie           <span class="comment"># 获取用户 cookie </span></span><br><span class="line">request_time          <span class="comment"># 处理请求已消耗的时间</span></span><br><span class="line">https                 <span class="comment"># 是否开启了 https</span></span><br><span class="line">request_filename      <span class="comment"># 磁盘文件系统待访问文件的完整路径</span></span><br><span class="line">document_root         <span class="comment"># URI、root/alias 规则生成的文件夹路径</span></span><br><span class="line">limit_rate            <span class="comment"># 返回响应时的速度上限值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">8081</span>;</span><br><span class="line">    server_name var.lion-test.club;</span><br><span class="line">    root /usr/share/nginx/html;</span><br><span class="line">    location / &#123;</span><br><span class="line">        <span class="comment"># Nginx 写了 return 方法，浏览器会默下载文件，下面是下载的文件内容</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            remote_addr: $remote_addr</span></span><br><span class="line"><span class="string">            remote_port: $remote_port</span></span><br><span class="line"><span class="string">            server_addr: $server_addr</span></span><br><span class="line"><span class="string">            server_port: $server_port</span></span><br><span class="line"><span class="string">            server_protocol: $server_protocol</span></span><br><span class="line"><span class="string">            binary_remote_addr: $binary_remote_addr</span></span><br><span class="line"><span class="string">            connection: $connection</span></span><br><span class="line"><span class="string">            uri: $uri</span></span><br><span class="line"><span class="string">            request_uri: $request_uri</span></span><br><span class="line"><span class="string">            scheme: $scheme</span></span><br><span class="line"><span class="string">            request_method: $request_method</span></span><br><span class="line"><span class="string">            request_length: $request_length</span></span><br><span class="line"><span class="string">            args: $args</span></span><br><span class="line"><span class="string">            arg_pid: $arg_pid</span></span><br><span class="line"><span class="string">            is_args: $is_args</span></span><br><span class="line"><span class="string">            query_string: $query_string</span></span><br><span class="line"><span class="string">            host: $host</span></span><br><span class="line"><span class="string">            http_user_agent: $http_user_agent</span></span><br><span class="line"><span class="string">            http_referer: $http_referer</span></span><br><span class="line"><span class="string">            http_via: $http_via</span></span><br><span class="line"><span class="string">            request_time: $request_time</span></span><br><span class="line"><span class="string">            https: $https</span></span><br><span class="line"><span class="string">            request_filename: $request_filename</span></span><br><span class="line"><span class="string">            document_root: $document_root</span></span><br><span class="line"><span class="string">        &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="二、实战配置"><a href="#二、实战配置" class="headerlink" title="二、实战配置"></a>二、实战配置</h1><h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 定义上游服务器(指后台提供的应用服务器) upstream</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> server    定义上游服务器地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> zone      定义共享内存，用于跨 worker 子进程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> keepalive 对上游服务启用长连接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> keepalive_requests  一个长连接最多请求 HTTP 个数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> keepalive_timeout   空闲时一个长连接的超时时长</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> random    随机负载均衡算法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> hash      哈希负载均衡算法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> ip_hash   根据 IP 进行哈希计算的负载均衡算法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> least_conn    最少连接数负载均衡算法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> least_time    最短响应时间负载均衡算法</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">upstream back_end &#123;</span><br><span class="line">    <span class="comment">// max_conns=1000</span></span><br><span class="line">    server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8081</span> weight=<span class="number">3</span> max_conns=<span class="number">1</span> fail_timeout=5s max_fails=<span class="number">2</span>;</span><br><span class="line">    keepalive <span class="number">32</span>;</span><br><span class="line">    keepalive_requests <span class="number">50</span>;</span><br><span class="line">    keepalive_timeout 30s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 配置代理服务器 proxy_pass</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> URL 参数原则     http/https 开头、可带变量、URI 影响上游地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 不带 /          Nginx 直接将用户地址转发给上游的应用服务器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 携带 /          Nginx 会删掉用户地址中的 location URL  </span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">location /b/ &#123;</span><br><span class="line">    proxy_pass <span class="attr">http</span>:<span class="comment">//127:8080;   // 用户 /b/test.html，服务器相同</span></span><br><span class="line">    proxy_pass <span class="attr">http</span>:<span class="comment">//127:8080/;  // 用户 /b/test.html，服务器 /test.html</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 配置反向代理 server</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 上游服务器   121.42.11.34   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 代理服务器   121.5.180.193  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 本机 hosts：vim /etc/hosts、121.5.180.193 proxy.lion.club</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  1、访问 proxy.lion.club/proxy 通过 upstream 配置找到 121.42.11.34:8080</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  2、地址变为 http://121.42.11.34:8080/proxy，然后连接 121.42.11.34 服务器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  3、通过 8080 端口的 server 找到 /usr/share/nginx/html/proxy/index.html</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// /etc/nginx/conf.d/proxy.conf：重新加载 nginx -s reload </span></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">8080</span>;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    </span><br><span class="line">    location /proxy/ &#123;</span><br><span class="line">        root /usr/share/nginx/html/proxy;</span><br><span class="line">        index index.<span class="property">html</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /etc/nginx/conf.d/proxy.conf：max_conns=1000</span></span><br><span class="line">upstream back_end &#123;</span><br><span class="line">    server <span class="number">121.42</span><span class="number">.11</span><span class="number">.34</span>:<span class="number">8080</span> weight=<span class="number">2</span> max_conns=<span class="number">1</span> fail_timeout=5s max_fails=<span class="number">3</span>;</span><br><span class="line">    keepalive <span class="number">32</span>;</span><br><span class="line">    keepalive_requests <span class="number">80</span>;</span><br><span class="line">    keepalive_timeout 20s;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name proxy.<span class="property">lion</span>.<span class="property">club</span>;</span><br><span class="line">    location /proxy &#123;</span><br><span class="line">        proxy_pass <span class="attr">http</span>:<span class="comment">//back_end/proxy;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 配置负载均衡 upstream</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 上游服务器  121.42.11.34   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 代理服务器  121.5.180.193 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 本机 hosts：vim /etc/hosts、121.5.180.193 balance.lion.club</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 命令运行：nginx -t 检测配置正确、nginx -s reload 重启、ss -nlt 查看端口占用</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  客户端运行：curl http://balance.lion.club/balance/</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// /etc/nginx/conf.d/balance.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">8020</span>;</span><br><span class="line">    location / &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span> <span class="string">&#x27;return 8020 \n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">8030</span>;</span><br><span class="line">    location / &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span> <span class="string">&#x27;return 8030 \n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// /etc/nginx/conf.d/balance.conf</span></span><br><span class="line">upstream demo_server &#123;</span><br><span class="line">    ip_hash;                    <span class="comment">// 基于 IP 分配到对应主机</span></span><br><span class="line">    hash $request_uri;          <span class="comment">// 基于 hash 算法映射到特定的上游服务器</span></span><br><span class="line">    zone test 10M;              <span class="comment">// 设置共享内存空间的名字和大小</span></span><br><span class="line">    least_conn;                 <span class="comment">// 最少连接数算法</span></span><br><span class="line"></span><br><span class="line">    server <span class="number">121.42</span><span class="number">.11</span><span class="number">.34</span>:<span class="number">8020</span>;</span><br><span class="line">    server <span class="number">121.42</span><span class="number">.11</span><span class="number">.34</span>:<span class="number">8030</span>;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name balance.<span class="property">lion</span>.<span class="property">club</span>;</span><br><span class="line">    </span><br><span class="line">    location /balance/ &#123;</span><br><span class="line">        proxy_pass <span class="attr">http</span>:<span class="comment">//demo_server;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="缓存信息"><a href="#缓存信息" class="headerlink" title="缓存信息"></a>缓存信息</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 配置缓存 upstream</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 上游服务器  121.42.11.34   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 代理服务器  121.5.180.193</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> proxy_cache         缓存共享内存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> proxy_cache_path    缓存路径 (level 层级、keys_zone 共享、inactive 过期)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> proxy_cache_key     缓存文件的 key 为请求 URI</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> proxy_cache_valid   配置什么状态码可以被缓存，以及缓存时长</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> proxy_no_cache         定义保存到缓存的条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> proxy_cache_bypass     定义不会从缓存中获取响应的条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> upstream_cache_status  缓存信息并设置为头信息响应给客户端</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  缓存地址：/etc/nginx/cache_temp</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// /etc/nginx/conf.d/cache.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">1010</span>;</span><br><span class="line">    root /usr/share/nginx/html/<span class="number">1010</span>;</span><br><span class="line">    location / &#123;</span><br><span class="line">        index index.<span class="property">html</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">1020</span>;</span><br><span class="line">    root /usr/share/nginx/html/<span class="number">1020</span>;</span><br><span class="line">    location / &#123;</span><br><span class="line">        index index.<span class="property">html</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /etc/nginx/conf.d/cache.conf</span></span><br><span class="line">proxy_cache_path /etc/nginx/cache_temp levels=<span class="number">2</span>:<span class="number">2</span> keys_zone=<span class="attr">cache_zone</span>:30m </span><br><span class="line">max_size=2g inactive=60m use_temp_path=off;</span><br><span class="line">upstream cache_server &#123;</span><br><span class="line">    server <span class="number">121.42</span><span class="number">.11</span><span class="number">.34</span>:<span class="number">1010</span>;</span><br><span class="line">    server <span class="number">121.42</span><span class="number">.11</span><span class="number">.34</span>:<span class="number">1020</span>;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name cache.<span class="property">lion</span>.<span class="property">club</span>;</span><br><span class="line">    location / &#123;</span><br><span class="line">      proxy_cache cache_zone;      </span><br><span class="line">      proxy_cache_valid <span class="number">200</span> 5m;</span><br><span class="line">      proxy_cache_key $request_uri;</span><br><span class="line">      proxy_no_cache $http_pragma $http_authorization;</span><br><span class="line">      add_header <span class="title class_">Nginx</span>-<span class="title class_">Cache</span>-<span class="title class_">Status</span> $upstream_cache_status;</span><br><span class="line">      proxy_pass <span class="attr">http</span>:<span class="comment">//cache_server;   // 代理转发</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="HTTPS-证书"><a href="#HTTPS-证书" class="headerlink" title="HTTPS 证书"></a>HTTPS 证书</h2><ol>
<li>浏览器访问百度网址，百度服务器返回 HTTPS 使用的 CA 证书。</li>
<li>浏览器验证 CA 证书为合法后生成一串随机数，使用证书的公钥加密后发给服务器。</li>
<li>百度服务器通过私钥对密文进行解密，获取到随机数 (私钥加密公钥解密也可以)。</li>
<li>百度服务器将要响应的内容加密后传输给浏览器，浏览器解密后展示到页面。</li>
<li>通过对称加密和非对称机密的配合使用，保证了传输内容的安全性。</li>
</ol>
  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下载证书的压缩文件，Nginx/xx.crt、Nginx/xx.key 文件拷贝到服务器目录后配置如下</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">443</span> ssl http2 default_server;          <span class="comment"># SSL 访问端口号为 443</span></span><br><span class="line">    server_name lion.club;                                   <span class="comment"># 证书域名</span></span><br><span class="line">    ssl_certificate /etc/nginx/https/lion.club_bundle.crt;   <span class="comment"># 证书地址</span></span><br><span class="line">    ssl_certificate_key /etc/nginx/https/lion.club.key;      <span class="comment"># 私钥地址</span></span><br><span class="line">    ssl_session_timeout 10m;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1<span class="number">.1</span> TLSv1<span class="number">.2</span>;    <span class="comment"># 支持 ssl 协议版本，主流 1.2</span></span><br><span class="line">  </span><br><span class="line">    location / &#123;</span><br><span class="line">        root      /usr/share/nginx/html;</span><br><span class="line">        index     index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CORS-跨域"><a href="#CORS-跨域" class="headerlink" title="CORS 跨域"></a>CORS 跨域</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># fe.server.com 访问 Nginx 的 fe.server.com 属于同源访问</span></span><br><span class="line"><span class="comment"># Nginx 对服务端 dev.server.com 转发的请求不会触发浏览器的同源策略</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen   		 <span class="number">80</span>;</span><br><span class="line">    server_name  fe.server.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass dev.server.com;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Gzip-压缩"><a href="#Gzip-压缩" class="headerlink" title="Gzip 压缩"></a>Gzip 压缩</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 配置服务器支持压缩 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  通过前端构建工具 webpack 等在打包代码时开启压缩并放到 Nginx 服务器。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  浏览器通过请求头 Accept-Encoding 来标识是否支持压缩。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  服务端通过 res content-encoding:gzip 标识开启了压缩。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  配置文件为：/etc/nginx/conf.d/gzip.conf</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="comment">// gzip on、gzip_types：开启后就可以支持 Gzip 压缩了</span></span><br><span class="line">gzip on; </span><br><span class="line">gzip_types text/plain text/css application/json application/x-javascript </span><br><span class="line">text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Nginx 检验请求静态文件的 gz 结尾的文件，有则直接返回文件内容</span></span><br><span class="line">gzip_static on;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Nginx 作为反向代理时启用或禁用从代理服务器上接收内容并压缩</span></span><br><span class="line">gzip_proxied any;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在响应消息头中添加 Vary：Accept-Encoding 标识是否压缩</span></span><br><span class="line">gzip_vary on;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩级别 1-9，级别越高压缩率越大、压缩时间越长，建议 4-6</span></span><br><span class="line">gzip_comp_level <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取多少内存用于缓存压缩结果，16 8k 表示以 8k*16 为单位</span></span><br><span class="line">gzip_buffers <span class="number">16</span> 8k;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许压缩的页面最小字节数，页面字节数从 header Content-Length 获取。</span></span><br><span class="line">gzip_min_length 1k;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认 1.1，启用 gzip 所需的 HTTP 最低版本；</span></span><br><span class="line">gzip_http_version <span class="number">1.1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Webpack Gzip 配置：vue-cli3 vue.config.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;compression-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">CompressionWebpackPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.js$|\.html$|\.css/</span>,  <span class="comment">// 匹配文件名</span></span><br><span class="line">          <span class="attr">threshold</span>: <span class="number">10240</span>,             <span class="comment">// 文件压缩阈值，对超过10k的进行压缩</span></span><br><span class="line">          <span class="attr">deleteOriginalAssets</span>: <span class="literal">false</span>   <span class="comment">// 是否删除源文件</span></span><br><span class="line">        &#125;)]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、常用技巧"><a href="#三、常用技巧" class="headerlink" title="三、常用技巧"></a>三、常用技巧</h1><h2 id="静态服务"><a href="#静态服务" class="headerlink" title="静态服务"></a>静态服务</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  static.sherlocked93.club;</span><br><span class="line">    charset utf-<span class="number">8</span>;      <span class="comment"># 防止中文文件名乱码</span></span><br><span class="line"></span><br><span class="line">    location /download &#123;</span><br><span class="line">        alias	          /usr/share/nginx/html/static;  <span class="comment"># 静态资源目录</span></span><br><span class="line">        </span><br><span class="line">        autoindex               on;    <span class="comment"># 开启静态资源列目录</span></span><br><span class="line">        <span class="comment"># 默认 on 显示文件真实大小，单位 byte；off 则大概大小，单位 KB、MB、GB</span></span><br><span class="line">        autoindex_exact_size    off;   </span><br><span class="line">        <span class="comment"># 默认 off 时显示的文件时间为 GMT 时间，on 则为服务器时间</span></span><br><span class="line">        autoindex_localtime     off; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="图片防盗链"><a href="#图片防盗链" class="headerlink" title="图片防盗链"></a>图片防盗链</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  *.sherlocked93.club;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 图片防盗链</span></span><br><span class="line">    location ~* \.(gif|jpg|jpeg|png|bmp|swf)$ &#123;</span><br><span class="line">        valid_referers none blocked <span class="number">192.168</span><span class="number">.0</span><span class="number">.2</span>;  <span class="comment"># 只允许本机 IP 外链引用</span></span><br><span class="line">        <span class="keyword">if</span> ($invalid_referer)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">403</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="请求过滤"><a href="#请求过滤" class="headerlink" title="请求过滤"></a>请求过滤</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 非指定请求全返回 403</span></span><br><span class="line"><span class="keyword">if</span> ( $request_method !~ ^(GET|POST|HEAD)$ ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">403</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">    <span class="comment"># IP访问限制（只允许 IP: 192.168.0.2 机器访问）</span></span><br><span class="line">    allow <span class="number">192.168</span><span class="number">.0</span><span class="number">.2</span>;</span><br><span class="line">    deny <span class="built_in">all</span>;</span><br><span class="line">    </span><br><span class="line">    root   html;</span><br><span class="line">    index  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="静态文件缓存"><a href="#静态文件缓存" class="headerlink" title="静态文件缓存"></a>静态文件缓存</h2><blockquote>
<p>由于图片、字体、音频、视频等静态文件在打包的时候通常会增加了 hash，所以缓存可以设置的长一点，先设置强制缓存，再设置协商缓存；如果存在没有 hash 值的静态文件，建议不设置强制缓存，仅通过协商缓存判断是否需要使用缓存。</p>
</blockquote>
  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line">location ~ .*\.(css|js|gif|jpg|png|bmp|swf|jpeg|ttf|ico|woff|txt)$ &#123;</span><br><span class="line">    expires 10d;                        <span class="comment"># 缓存时间，不缓存则赋值 -1</span></span><br><span class="line">    rewrite  ^(.*)/syzz(.*)$  $<span class="number">1</span>$<span class="number">2</span>;     <span class="comment"># 静态文件的路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="单页面项目-history-路由"><a href="#单页面项目-history-路由" class="headerlink" title="单页面项目 history 路由"></a>单页面项目 history 路由</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  fe.sherlocked93.club;</span><br><span class="line">    </span><br><span class="line">    location / &#123;</span><br><span class="line">        root       /usr/share/nginx/html/dist;  <span class="comment"># vue 打包后的文件夹</span></span><br><span class="line">        index      index.html index.htm;</span><br><span class="line">        try_files  $uri$uri/ /index.html @rewrites;</span><br><span class="line">        </span><br><span class="line">        expires -<span class="number">1</span>;                            <span class="comment"># 首页一般没有强制缓存</span></span><br><span class="line">        add_header Cache-Control no-cache;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 接口转发，有需要则配置</span></span><br><span class="line">    location ~ ^/api &#123;</span><br><span class="line">        proxy_pass http://be.sherlocked93.club;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    location @rewrites &#123;</span><br><span class="line">        rewrite ^(.+)$ /index.html <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="HTTP-请求转发到-HTTPS"><a href="#HTTP-请求转发到-HTTPS" class="headerlink" title="HTTP 请求转发到 HTTPS"></a>HTTP 请求转发到 HTTPS</h2><blockquote>
<p>配置完 HTTPS 后浏览器也可以访问 <code>http://sherlocked93.club/</code>，可以做一个 301 跳转而将对应域名的 HTTP 请求重定向到 HTTPS。</p>
</blockquote>
  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line">server &#123;</span><br><span class="line">    listen      <span class="number">80</span>;</span><br><span class="line">    server_name www.sherlocked93.club;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 单域名重定向</span></span><br><span class="line">    <span class="keyword">if</span> ($host = <span class="string">&#x27;www.sherlocked93.club&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">301</span> https://www.sherlocked93.club$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 全局非 https 协议时重定向</span></span><br><span class="line">    <span class="keyword">if</span> ($scheme != <span class="string">&#x27;https&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">301</span> https://$server_name$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 或者全部重定向</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">301</span> https://$server_name$request_uri;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 以上配置选择自己需要的即可，不用全部加</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="泛域名路径分离"><a href="#泛域名路径分离" class="headerlink" title="泛域名路径分离"></a>泛域名路径分离</h2><blockquote>
<p>有时需要配置一些二级或者三级域名，希望通过 Nginx 自动指向对应目录，比如让 test1.doc.sherlocked93.club 自动指向 &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;doc&#x2F;test1 服务器地址。</p>
</blockquote>
  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  ~^([\w-]+)\.doc\.sherlocked93\.club$;</span><br><span class="line"></span><br><span class="line">    root /usr/share/nginx/html/doc/$<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="泛域名转发"><a href="#泛域名转发" class="headerlink" title="泛域名转发"></a>泛域名转发</h2><blockquote>
<p>有时需要二级或三级域名链接重写到我们希望的路径，让后端就可以根据路由解析不同的规则，比如让 test1.serv.sherlocked93.club&#x2F;api?name&#x3D;a 自动转发到 127.0.0.1:8080&#x2F;test1&#x2F;api?name&#x3D;a。</p>
</blockquote>
  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name ~^([\w-]+)\.serv\.sherlocked93\.club$;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header     X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header     Host $http_host;</span><br><span class="line">        proxy_set_header     X-NginX-Proxy true;</span><br><span class="line">        proxy_pass           http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span>/$<span class="number">1</span>$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ul>
<li>为了使 Nginx 配置更易于维护，建议为每个服务创建一个单独的配置文件，存储在 &#x2F;etc&#x2F;nginx&#x2F;conf.d 目录，根据需求可以创建任意多个独立的配置文件。</li>
<li>独立的配置文件，建议遵循以下命名约定 &lt;服务&gt;.conf，比如域名是 sherlocked93.club，那么你的配置文件的应该是这样的 &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;sherlocked93.club.conf，如果部署多个服务，也可以在文件名中加上 Nginx 转发的端口号，比如 sherlocked93.club.8080.conf，如果是二级域名，建议也都加上 fe.sherlocked93.club.conf。</li>
<li>常用配置可以放到 &#x2F;etc&#x2F;nginx&#x2F;snippets 文件夹，在 Nginx 配置文件中需要用到的位置 include 进去，以功能来命名，并在每个 snippet 配置文件的开头注释标明主要功能和引入位置，方便管理。比如将 gzip、cors 等常用配置都设置 snippet。</li>
<li>Nginx 日志目录内以 域名.type.log 命名的 be.sherlocked93.club.access.[error].log 等文件位于目录 &#x2F;var&#x2F;log&#x2F;nginx&#x2F;，并为每个独立的服务都配置不同的访问权限和错误日志文件，这样查找错误时会更加方便快捷。</li>
</ul>
<h1 id="四、项目集成"><a href="#四、项目集成" class="headerlink" title="四、项目集成"></a>四、项目集成</h1><h2 id="za-insureflow-h5"><a href="#za-insureflow-h5" class="headerlink" title="za-insureflow-h5"></a>za-insureflow-h5</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nginx.default.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen       <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># server_name  devops.zhonganinfo.com;</span></span><br><span class="line">  index        index.html;</span><br><span class="line">  root         /root/app/dist;</span><br><span class="line">  client_max_body_size 20m;</span><br><span class="line">  gzip on;</span><br><span class="line"></span><br><span class="line">  location /health &#123;</span><br><span class="line">    add_header Content-<span class="type">Type</span> text/plain;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /api/order/ &#123;</span><br><span class="line">    <span class="comment"># rewrite ^/(.*)$ /$1 break;</span></span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_pass &lt;urlA&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /api/template/ &#123;</span><br><span class="line">    rewrite ^/api/(.*)$ /$<span class="number">1</span> <span class="keyword">break</span>;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_pass &lt;urlB&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /api/ops/goods/ &#123;</span><br><span class="line">    rewrite ^/api/(.*)$ /$<span class="number">1</span> <span class="keyword">break</span>;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_pass &lt;urlC&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 微前端</span></span><br><span class="line">  location ~ \.(html|js|css)$ &#123;</span><br><span class="line">    add_header Access-Control-Allow-Origin *;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="video-claim-web"><a href="#video-claim-web" class="headerlink" title="video-claim-web"></a>video-claim-web</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nginx.default.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen       <span class="number">8080</span>;</span><br><span class="line">  root         /root/app/dist;</span><br><span class="line"></span><br><span class="line">  location /health &#123;</span><br><span class="line">    add_header Content-<span class="type">Type</span> text/plain;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /videoclaim &#123;</span><br><span class="line">      add_header Cache-Control no-cache;</span><br><span class="line">      alias    /root/app/dist/;</span><br><span class="line">      index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">      add_header Cache-Control no-cache;</span><br><span class="line">      alias    /root/app/dist/;</span><br><span class="line">      index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  location /oss/ &#123;</span><br><span class="line">      add_header Cache-Control public,<span class="built_in">max</span>-age=<span class="number">7200</span>;</span><br><span class="line">      proxy_pass  http://wujieshan-new.oss-internal.aliyuncs.com/;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nginx.prd.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen       <span class="number">8080</span>;</span><br><span class="line">  root         /root/app/dist;</span><br><span class="line"></span><br><span class="line">  location /health &#123;</span><br><span class="line">    add_header Content-<span class="type">Type</span> text/plain;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  location /videoclaim &#123;</span><br><span class="line">      add_header Cache-Control no-cache;</span><br><span class="line">      alias    /root/app/dist/;</span><br><span class="line">      index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">      add_header Cache-Control no-cache;</span><br><span class="line">      alias    /root/app/dist/;</span><br><span class="line">      index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  location /oss/ &#123;</span><br><span class="line">      add_header Cache-Control public,<span class="built_in">max</span>-age=<span class="number">7200</span>;</span><br><span class="line">      proxy_pass  http://wjsprd.oss-internal.aliyuncs.com/;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nginx.test.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen       <span class="number">8080</span>;</span><br><span class="line">  root         /root/app/dist;</span><br><span class="line"></span><br><span class="line">  location /health &#123;</span><br><span class="line">    add_header Content-<span class="type">Type</span> text/plain;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /videoclaim &#123;</span><br><span class="line">      add_header Cache-Control no-cache;</span><br><span class="line">      alias    /root/app/dist/;</span><br><span class="line">      index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">      add_header Cache-Control no-cache;</span><br><span class="line">      alias    /root/app/dist/;</span><br><span class="line">      index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  location /oss/ &#123;</span><br><span class="line">      add_header Cache-Control public,<span class="built_in">max</span>-age=<span class="number">7200</span>;</span><br><span class="line">      proxy_pass  http://wujieshan-new.oss-internal.aliyuncs.com/;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="video-claim-cdt"><a href="#video-claim-cdt" class="headerlink" title="video-claim-cdt"></a>video-claim-cdt</h2>  <figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nginx.default.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen       <span class="number">8080</span>;</span><br><span class="line">  root         /root/app/dist;</span><br><span class="line"></span><br><span class="line">  location /health &#123;</span><br><span class="line">    add_header Content-<span class="type">Type</span> text/plain;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /claim &#123;</span><br><span class="line">      add_header Cache-Control no-cache;</span><br><span class="line">      alias    /root/app/dist/;</span><br><span class="line">      index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx.prd.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen       <span class="number">8080</span>;</span><br><span class="line">  root         /root/app/dist;</span><br><span class="line"></span><br><span class="line">  location /health &#123;</span><br><span class="line">    add_header Content-<span class="type">Type</span> text/plain;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  location /claim &#123;</span><br><span class="line">    add_header Cache-Control no-cache;</span><br><span class="line">    alias    /root/app/dist/;</span><br><span class="line">    index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /claim/castle/ &#123;</span><br><span class="line">    proxy_pass http://videoclaim-zhongan.prd.za-tech.net/castle/;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx.test.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen       <span class="number">8080</span>;</span><br><span class="line">  root         /root/app/dist;</span><br><span class="line"></span><br><span class="line">  location /health &#123;</span><br><span class="line">    add_header Content-<span class="type">Type</span> text/plain;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /claim &#123;</span><br><span class="line">    add_header Cache-Control no-cache;</span><br><span class="line">    alias    /root/app/dist/;</span><br><span class="line">    index    index.html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /claim/castle/ &#123;</span><br><span class="line">    proxy_pass http://videoclaim-zhongan.test.za-tech.net/castle/;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>智能工厂</title>
    <url>/2020/12/10/15-%E6%99%BA%E8%83%BD%E5%B7%A5%E5%8E%82/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="this is an invalid password. Check and try again" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="944a136d1beca7655931ef0a379785491f38b0e91018c92f7a2d9837546300b2">4ab3e98d62a1d9d8a9351b6babbacda32c1e8ea4f55b45528e07a69472c3828893891eb8cf5f0c49e81797e415af58259bb83a4d0177361a3d9b773a989839ce8ec622aa7296d750bd1db3e256de861e9374debe29014ac8c58a1e6b2e5c1fb5fed725b465c2899a835c9cd0c28c3e085684c5ea59ebcbd1bb9c00d7e3522e96d1f587289f6dfe5c54463bbc3cec3c2f4f9efb7ec624708e7c3642f94a464717f07b0177c5968afc270ecf065418d6c773e986bbc4197e2bbbd5ebc536bcb4cc8e966969637fddea9e9f9e7916c5dd28a5493f9045d22d7ca9e33c361d6260f06cb06a24773b08152cf5737e15e4d7e41d2600da26a9dc0a22616d07de82af042a50da15a71ae56dd6a6615bfd36789191fb9025fd98ae21fa2c9131eb94466565e3bd6ff4b13b42540d4a57afa1a0c89973ab37e004184f9c3e03b577decb4456d4ac63b6aea7a5f1b2662bcab3c5a84dc3ec00f72591c94e62e803c65eab667c9851586a83bea3ebd5e51303435c91695ef9bfdfb1b0e63ec1169b4dfec52192db69cc50c1490e36aca23f5edc9d8582d30ee87925dfff886c25ecdbf3e83b588417e3267dfb917ae8c0f6769fdb320144a4c2055d467fcb74607239d2906d10d3cadc15bb3a2cd87527b6d95ec12f3c6a71679c9ee6a230c4eaf01d0683b3e194baf5805d82cd4e82a09127879101ba0f54af824ca8bf470ea64916cfb2806cef340ca2a06ba6952784c8014f828e9f5f137ec3072d3b90151957ba101010e971618acd1b5540dc32be5d7b9f13e499ac5226dbf0ca6443bd134bdafb4f4fb4b81d8fa1af168564d72a97df24470d639b14d9b47fbd5dff63500affeeb400cae87c620ccf666151eb69aa2f3e7d08cfcd7fb8f163b9e72ad846575fd103525d948a73e523776555d1679bb3eda632c04d933207ff0c7a1b05913bdecfa825880bcbca08201fdfd4fc6ed06599ebb18d989948031efb2c84f69fd9691396ae45fc37c33cc8c0c842d7c31b99bf72e665bd99858589a18c9740d3a4f8ec44497713a2bc7133ccc7778b0f67896d62c15c8b5c3c32cb9b6a78edf8cedb49196ad07123f8423963e92470c16805008aa020c24459cf8571f5182774dd774a099642b609a554313d823bad4e928339e09f1bdd89c230ad471ea4f16b3781e112523247a561d9cc37c077147fbfca0efd014bd3835c2835c8d8453ab7ff04ee26aff289a85b2983ee74e446f4de0e83d08d7b1a7bdeaf1bb406c43c555fc607d1fb43c0c92740836b406512cabff26804228e5d649daba7600a1380c0702570b2b57c11f51beee80bc54bb81cc8368757648cb8f6202e0cf14152551d35714fe50bd122106bc6fa500b33152cb46361facfca15e46b619091fb2f071670966fbc81afcffb37128d63dd45edb3233f9963fff81cb375f928ece377c8a311fcf81bc410ad2d275e2bc34c5b92d7519ff5310a196ec3803cd4d360fda3e898b6426e99949d040ea4cd126ea27f751b2a33f14cbd0bde52ae85d33a159d31add603030b02a39c35f351bc5d63483a5b0ac371ab60019dad655c5ce8a4e3754e2034fb2edf012b9d94174cc1fe4b6a60c42a4a8aeecee87360f47a453c98fdf16ab21b66316904c619a0bc646346f082ece4b0aa20560c80af6356403db7844f09ee859253f8f2d34dd0394bd540d4617bf2cb193bd2f7754d1fa2eb2ce5a222ffb76ba3870a797bca48059217c04fc766a2156f1950291eba5733a335a369436d53b6d35d11c2728a0927b2d41680c2fdca158280ecb40d89afb3f0adfd087cc65b93d311b1dd065b1d2e86f8de36b637e0bdd4ac48bb8d139ee094fe4d6f1f4db4586ad7e48bbcee254a62b730857144cb853ea8eb476819356e64fc9b88fe4501835f13a98ab8abb1c10563f49db6034a42b641825fdbce8597823b089d57c3c2bef34e318f874956b2ffe9d381c79115c4824adb08a8db3d84d277b5f7105f26dabc480c52117a460fbabc2c68f9d7d19eb143eb6aa36a34a53bcbb657c2216c9b334c0b6df01526a457ebadaa7642bcbd4d980f83ca43c10e00677d862afd54769a1a65bb2bee3ed7c65bb031b1853e2ec42331faf487f7cb47d593e0d6b57f5640b65fe2dc0098e4c0c5712fda60219a58c2f33849fdafa3752a6247ba37069dcc477040ecf8ef832dde707fc45228c87f122123ab46ea984064f4ab65eb614fc2c5eb1a27abc967dd96fce1cb9171714ac3b4f55fdad07dc1a18fec115fbdccef671730df7ff8be71c21c233807bc8c95626ecba4c97d5691fa48fc7ee8eb543160f28e2561186f79ce246b9174e5ff457d5813daba2cf596cc1ab477c9f4df086d719c1d48672f33be0b17a82c50550596e3647f25a362a80d0eeda42a4345211e166ab879f1ca55b0f40f7e90fe3da49b7283b9944d0fc501172bc73f612391d0f00d7996839be2230e75211930488742e37b2a076bf7eb7f61ab8d24e0bb08b656bf94976b8445fa66856e7c984908574ee6bc9b8edc6d87021711417f92098da67af211da57331f40f167ab081db8b46d2c5ded433ab8e59e6cc1c41fe047cf870d2b67d172cd3936b8cdc940c74602ce90e36f9b99dbb82daafd15331636edae51ec774744956d6b463e4247788aab044b15b024f3b60c83b2abd1f2790e1ac81b1c36136d3613a556b8e3e3c07ba8a82e81a306c98ede5ec02df78eb1d841549ddc03a601e486223b1cdbf10dc810da2658da31f7762e99be6f302db8e0b6d2002aba6d6fa205c4e7464490c35d399472d3ba61c0cb18ac11d4f9731ff8a21da42ec736ff74b54be1f34e99afab1906763e37f84919b0b23d2a07e59f095526b17cabb02228960d0227e14f50dab96c2cd9196fc55aeecc6e8a83e8a69984b8af69a1efc1eba1aaa7312c7cf012439e19557c13f29fed4b6e06a18b3e94ad6bd13655d4d610e9ead1d51b83a256fac806058bbbf5c3dd930ed177a653874231c7c670eecaa016b6738c8b6b8ec0bac8031f6aa754a8352c752e3388f163ddccd35e19dcb3f1d0a0862d81062a54594c30d57d52eea174cfa7f174930f8cee1fe78b4568cd8fe1fcbef6e85fcc631f5f67edc75b6da4a13645d0d88874e1ec509844c64cd3997571e56fd1c97ee5f59ed85368c4d499a3b9c6faece02af6431a272bcc51d15083dcc52adc0b25edcc36d09cd7b572902266884705da23d2377ea74c9dbe0e5484ddfd556721e8ddc5cc67925990c43f7c44313c88336a47172bf893d323f9dc5ac8874e74991ba78a1210fe40a7734bf964eb73ae5d4618a38f4207d57cb57d122472447ad14d016f914433ff93a9a48ba3b69f05343375ea4ad1476bd61ca10b6a1fe83f9c7c6d684388edd549679c8c36b3d4ee53dc256f83a915266a9545bae992a40032406322e8a77746be445c54f16b00b7da6b6cabe84ffade6ea3062bb6cc75dcd769b5cc4e3987b0f932606f510552fca30f7b7bd93418855f310ed5afef541dcee579e7828bd82284d2aa7ff79c056d4ad57b8a56b62ea593091980a259891908a5c27d8d212b8c2d756a99c67b09dfc93509907cdd7ab2f487fe91cde6dea20aa8304c127607df85d18fff051e35e7be40dd4cc7a003dd0d59462f2ab478940a0a5cd0e76b424955d6a8a0901ea95b61fecab379feeb916e452278909c7a9952537efce5b8f47e968b29498692ad77653f1f787117c5717978037f751870dbfc6d34deafdac59d501dd7a21adc0773203dab362f5d846556d505d3aa2683195e8f38af0521ddb2aac4916ca5d6f0d275bd3a40f5446acf1245a2ff7fcf91f94cb9d999f2aeafe69391bc612035e59b18899e0b108372fea8ecdd2dfb73917680f2859f7317add2f88063c5debcb1b6e3f2d5546287022185ddedd49b9e2371fd4dff6c5fe8ca579d6f2679571df942271b48baff857f0d97d893d9ac068aa0bacf9bc94cbddc75c78278abc710ef92a6b2623f4e0c487f192d831a45e5699601f3428e5e4caac0fc4db653d1f7dbb683e0f2f068dfc88138ae9f842cfe99e31fb49542830a119dd4ff6a205586f77e7bdbdaa84d0a5208b57d4ffdda54ca18c86b93dab91ef7c30e893b3233406a16a4f5912bf16154311374ebb098980dbc6503838a54c4c01a909fe659bc18c8a20763ddeb4e12df62bd2b8f1199ee275f76523c63aff4f16fd7bcbd62accf3603ba31f49cb0f09d5c651859916b57d30938616bbce70a726c57ecfbc87f9364341cfc10045c391e8d69577773dc2cb81f51a68d10be6b1802701cc26d13e39271358992586869cb5304341680b1908576e11cb5f7c94d745eea6afac5c84c8774418bf55e39f17850b92870aa7c6aff4e8548aba1820a0954fe246c687905b28bcef9733d09139bdc93f142ca39bbd6e4f1714d787e987294a2a497f5aabc63dea524feb3f5628b28a579ac9fa00a4cba5871edd2eab5b015d899ab6d5b360a1b569f0fd646d19e23502b2c97a59602f93c7e767af24ccc7fffd29983922e38e0bf01054fa3e0b42beb35a229e0f5ca5cc96dbe733e00fa05a7132edc423bf147bff00fce3abd87ba93f2aabf2c26dbdc4a4f5f6d7948292024fd39d36d60017a0f45d139908003b855872b90822423c201665f7b7d3a5f8c293e0522d94bd0d376997d37a27bc4a6a16f6cd6b77eec206a51e60cdfc39fbd9d24540a3b7f2813dda204870a0642a2e7fa3d86cdc08cafc93a152b55bb46f12ea3328a4f06fa2cdfef8ee2f9ae2bd3900997f1fc87570ac153cfb38fcd1ffdfc4a9db3ad6aa49c390afa0f80d93d3e60a05104304258ce5f40d84beded65d4f626fa83164e0ea1d61dadd35de8b161eb43d79e99c4d02703188d2db750f5f0130da64d0c84ab365bc87856f3f5a8f7acd1e222fb1402148d2707ae4b8dbef8564527a4063fc906265564ba83fa2855a1996c981a99a6fdd912856a6906de35f0b3a9fbc50f120092a8429abdc682351ec7be980f1803a35257db726b0b9bc2c6db6258bbe44e69574ce3dfc55dce6c32d941d3bcdf52fbdabea62d6ccf7d05698daa9c0e0c74158100a330a39ca2966369a9c99ac33cee684e423dc210e3370d2699c8f14429c0305267eab92d44a86ebb44376d1d1d76ed561a1210936a1089a2d849ed6637cab472f33b9ebd145d56e63a5eee4aac3b74373f806422c15acf9e930f544148b711a169ad9e0dbdbb690c3403326af2240cb29b092de0f622ea56a6a857a219ad88509f393d76c8325746c78f76509e607ed86db9fa73351c4878f8cdce74c99219f89cf8272835c3046ab85543a8ad0172d7ca0f4d8f160bc1c2929e37f88e271dc3167efa2f29d29a1cca75ae7e4b8db4ffae160229178f9e391b11af8db49603ea720b2b287fe944942bf447d95c7b1f2c86095c1c96ca391110743c9a5a623ef606a12bdedd38814a898752587a73091f4e4859b5976565a8a6d71c43f2b4c2b073882f25d5cabd36c46fda621a2dd1e35d5dca27b48d61bc44bde3498597d185d54756e813c67e15460340cc63beec3508a67c090ffce37d83a262f403954d9fdef4779051e0459894a98d24d272c1cf7b2166c1c3f78f07fbdb341398be6c291f8a9e71cc23034652183938f448275a508193e4d010e9733eea8f15d8029b5ab683addb3511269f8736bcfe8209bbd91ef4231def4af2f8fa961a4d2e3b7d41bf75652a7e4a46b5c44229bc4aa34b10451a4c95562c337217cb0dc7a45da586cd21142b3348104733cf4f9066888f0b9c7590278a848e45ae3978c95011c05b73ba498126d2294adb09f4b64b92682c231854c03f6a885ad8ba956560b2b1f2b8e6958acbbca078d0ef0f58c6d788e3f705263789084ffd3bcfd568d8f0d7198e4825402e6fb5452d434ae7cde5c937c73a3e159129eea7738c8a7e1617a864e0ced00223a5733c32fa4ac0e46c9412f10aa3e4473d6922b21cf1abf9637b518ff8e207286c830c4206696581414996e321cb3f439edb47cb1df57cd9e4f18a940be577ff3ebc7263cbf68ea2b495dbaf60fbb50c7f66d1b3e69d417a792fe7937bfcf0c284dcfe885e0672a83b8f715f914ca8fbeb46441aa4b0aacc1393bfe6aa3564fd9325ac40601cea7fe4188b6b51202e917e9be230fa82eae682b67b4ebc51d4e3a5a4c01bb62a9bff5803b6e04bcb080506680a30cd7f9607639895a9ce88fe148c2b025cb8ef13ae3dbebd6b2c5b44bcb6674d66ce0c706b759bc0ba666fd288f27d66e49e6d4a3ac4b39e7ce967502ed1c9ea5c2a02c6f612185630e2eb9307886dffba712e578ef150cd6e56b44a1463e078b4aad6dadd82d65f0265537bb2bf99375a0fb921684e7d949534b92bff86a83c370838fe3022229957a3a2b310e214402261ecbe07e26c370df77d5254e92984f831bfb9239b2fa91d436a72c091fea817363417cbb0d51f50d2b3002701cad01aa68a0b3a98ed202cfd1b2a5f3fb18f4d1a66faf876f5578ae7b403fe268517fe2b9de0ffd28e95e8507519b3903c58da21f5dc41e3e6c992561b1a028a803400b84a6bf6dcd435e8c4a39e9ac9e5b600d48e838c3bba3a6c89665b0a5f5fad7e65c84d30a7a48b537468512d3d44aadba6215ad62e9f954332c65b485614c184ff54d527a3b6f7f1b2a74c12580fc587506300451abd6ca9cf2a91fecbd6bd6228f9614333f9756498e7a0e03e6c07f7391b4cca499bb0f10880b5eba825d6edec04929b6643c65d2de688449c6b27c569726f162f1ab8e0323661f762caa09295ae95d7603ee761e583dae90a2c1a2e0608d2195bfceec31d645beb5dbcbe924324f9954cabdc949acbe33cf610b22842aec392c75113739db8432cfbf58f93ec52bd9258a5d71f2bd0da346b3545d68dcefc8d5ed7842e3c0f3acccb6ff7b576cfe48f29b3368711876845f0984ced37dd365426b0ea9a45cc866d21c2d370a402da3cf30966ac9f3db6b0c97abc0bb2985daea7cb198fafe410caa8f400ed8bf7af5d5854d0483cbf6c3706a5f5897a6d682455d0e5e477e2abcc659bb75c6eb492b9661820f7d13fdf1675d6ae5a9dd1db0e3a0534b2bb7260c8d652943d15e345390dda5d356186f872a0a4fca8147f308305a1715d7f04d33b1706c27ad80046aee3c922347088b2624fd012bd3bed5049112cacdf93ecdb296c0a75f0349ae0d7ddfa78b83560e873f64458fd90e1586666399d867f2a46b92ff5a2078ab97f34ed975cd48821fb2c9b8f7d90b9cc2e19e5c704aa2a44db3527609e880297b77fd464e893c864410406805963baf8fca3f696366edd5f5d1942758aafd3d3f8acccb95db5803c3861ecd0c5967ff33f573a54345466d778fae94b9c013058c78f559797e7bf300cac5d91706cef2fb94aa387612514d07f8d53fd4b47919f8c6a4419f548311c83c4a90231f09a842445c0ab79f8d4f74fc2f33f2953fdd0e7850fab16796fd8ea5b20851ce8584305a279217fc2af36107559899f90ba5e41ede41f692a6f7f5f9e9e546054f5788aa39cf39d889b5cd2236c2775763578528301855add5c815724d52ab932bc8658f778917b50df3e3c12b592f7cdf945abd1654d40f5f773ab3ee48111be4dc82cde969aa619af5eccc8cec6e39c92f8fe0e6db61ea333400914e1dad4605670e5f168e59045f9e4b30d07804892ab039ba34ed4a80a92085120947c0c39de213eed6c5ece33ce1cfab97e1daa7ea09794f55a8ee3a06d5835a1fc4f2d794d7753ea54fb1a0052c08dde984de7f156e289c759cf85e81f185ca0fcfe978f740ada4d75483e49bff8cb1a148628d1bf45fdc8131f88b83003822c0505c53021b467baef448b17d61218d9ac1f014f3b7699bc5a616a1f1fdc48e501aebbf04e31138030d4407e2dc41356310c1442c7cddd22fe26c748b1132e8520589c8f4709af94d3b0759d573c1e5d35496cdcc2f1e4191b27b6a5290d32beee08085deab69cabcb18334e013c3ea165f8bfac81d9ae8f82619a521910e350825152f29a6312de4ae75f0031e963a07c4cbcf7f261d1653eaa02a2b26f20b67cf5451891eed0971d1c8ff1d726024833300c40d7130b8bf6ea8f28555d85324c623cdf066d3c956810048c73838591e2149f4b0b573e4825b73c5d0c2dc6a0bf7bdacbf23890203910cb5cf89c1a46ccd624ead68727d32d26f7e0c56157fee37cdbd5fc06415537e15c7607187af793ed099bd7639852870150a1cf01cff23d3b0746776f5a246aab826bf6227db180249c1e0cf6a50c8e885dd92ba2cbd2b65a987964d859440997823ad1476605627c76317909b6d9a8dc06c1b3a4c89e7dc59f00abaf426d9b857189dc1d1636a9d9c72b5106139f3a9183a57d7822703565551ea26ae8f417044cc9d2220502a39767a51dd5c75eda1c0afe8dd174a7eefaf2d6dfd43aca1603028db3f95609b550718e34755d122d3b7e62bef3c37d2ed236dad6addfdbe17162bf1d85ed0cbc59d33e70e00947ce8f34ea85a1fe484925f87e156c1c696dd97b14e622964a9b0883d55914f307dc6b531704dd14d3882eef2f57e4378771a2e4816261203888ce9edc80ab0fa486a347b64f44cbf61a275f705da64819dbfdafc1e516972454ae1416e934a39170513e069742c67155395dc1063da9fe9ee296681886d15e5f26c8b2a49464bf7bf660455c330b88222179e078e7a4f1417073a41367c0390a9a559c616d0ffc3f83d1d8c79456e8a5604baab54af12e0a73360988c507b5b53166b17ff10c54d134332bbea7cfbfaada4cf7556115ba36310141811a84b8504ef2e59865e865974f04daeddd469850ed7e948e18ecb2e1f17bcba090be79adcb635f8d618f70081729d7968325cc0f7c2f9235ea6b4fa6c30d0a81337a0a7e9257136b812c8f7f8c6b507b60cd099b33d86e7d426c73eea0338c40a7e67dd62bdf22773fccf8e8b7dbc8d10bdc0e199ff5218c8f2d5fd9acc0b2a11f67c15eb98dccfbfaa5858564668db049264baa467053aa574a9da1704d2214a07627c9880c86a17be954785aefcb8a005a10362d74b0b1ab149d050008f63ac01ba03c52f2a14e0c96a8bf61d0a4a8e6babb95496d0d73f9bcb70b518a38ff7658dedac3c55219868611109606dd510f0e2798977cc8b44ecfc668919fab02a19e144960831047f1898b633b1c146d67c67f4c41c0c3635fe1dce936d3de998de3d9f5a8a1da5847e718559f7fb63facdaa6da35fe3fc423061058d8b68c611818c528f8e37653429914a44dc5056522233ff9e1f34ab1a73aba25736ea0879793f82ccebdb0cbdee7bac9c167fa57d86d208779d1230ce54f0a63ed12d526a00de42314d7055badb6056fdb41d4dd41bbfc0a46ab44789d7b8f015a0df64a55f5a5903be565c6c9044a53d498ff15771b0c6b53469e3ccb53a2b1c59326d306e255b98704089dc59fe8f5b63dc30608d2c34c154caf89ab0618d38ecfd8ef7049885161bf37d64c87326143b914ffddfd59e215b5b700a2da89b8b77198aecef9316b9881fa64308b21b7a84969ee3bd5f47e1885ddddc561d5c6a9b0d0cbce60cb0f45ec15f28e56d1ae0e01e7bab114a8bf6ae506c43547e571cf7a2735f6fb2e9472a407e87206d5b7fc68c4e8815467652a9a5f7d8d00b096cc87dc2af470f26ecdea1b9e33b583fd092f5ed32bacea6ac4d8125964a7d5a432c1e0297cfacd7c86a4224ea8ec370960d0bc95466948dfa49b8cc75f38a5b02702854000f6a786054b23631c13b69232a9bcd619cbc601315e3f3897a577daf6dcecce102c60517f11b18daaa04cf4e0490dc771d7bfa7fb04098b75df7e55aff39127c177d661a59dabc4763fd883fb1fd6a10698f4a932d79af642b13190e90c7ead2ed9d5bc66f395667ce0140c90f07dda0048808819528b4b488cfd3995c213c7a3b4a740f39d252093ff13f7a114f266704be64fd1980226d2a334820f85e20370dc6e402f37dadf3924b2041a88161cae7be6a47505be720853eee9fa869614e0715c43f121b69ed753b8dbcf8d0c0d42a28f4f85239154fad5d9741f5cc50e043fd43f62c498d8000a51a0ba9e8170ee1e734802f7ebe138675575d7691e854b88865dad27abae8f03b9e155e41aec300a1b03e9cf4ac7174694accc4fc2e9342b4cc21779d372e6f7b9da9e7ca4a6e057955916ffb9481808ab73c11590c4cb84cdd34c04fe1596e69543e9611a0001826fd660724b791734031ad52f9b6696ffd9e669408b2d34d217e4e94d01ec49a54bf714c5c3711b88c6d12f433812fb0a5c206fd71a5f9c374353ca8478ce35db23f33758573f2066464dc7b15ccfbe08c345c8e82eca67399e9e6d9421af49ae37376673bb697bad4983cedb83822e93c6d09397d27efdf5e5285bf2d41d043fda954a36bdbe8c01b12012dec57dde528eb5ee7e43d4f2223d95fe5f6a2a363f3fc977f41c5e9d75305296f0334ffffb0a87180557156365e31ef020cd862c2aecc36668fc94a1d466cbc45ebde9a8710522713464809a1e23a9654b4e45eb8efe573015f8adbd741adb6f18219a64e32d8668d50fb57a3dd60d2764485d961272937804622dce65877397922a448fa7376fca66325900b6c04c48ea103966fe427e76fa355517247b1ab9a96bdf7c55cf9e0895f90cbd033c2ba04751b491a41c9f36ad4d7e87b1de335d0a3bfe948b8f3938c89495974ce2b9a1f65f7c248ea1ab0d6f27a7d089afaa99fc73d4d66810787c1b2305b7304147691eb825e8b358b82ab1786d1b86344333eb683490a223d19571d0a8fc017b2cbeaec9c3eb6c5b53edf6a33b840a153f2ac9be53ffaa03b98ef8a38e6b51edc03f7dd907fb1a533f84916912b3d5205b53c7d0148e2c93a139676971fcc1201e3dfd40a9e4de87fa489118090315f76cbd55aee93d7a0ab41b8982a537197459ace3fcac37118dce93f5eadd4137b6caf367ba2cfe56460e7fec62494db56e18299f147967beed58eaa380b51764f80563b7ec2dc2a4837d1f062e41660ddfc15a9982d22a11ba6390bbbf9ba4bba8b19960ee9ecdcdb6231b7a92a8d207d29f214adcf2a4c124761f01ef1c3e036b788525040be040d17a97ee9cb5cd6aa0675b6120d32190d0d86bb87f9cdcd848f07fcf7dccdb1703c31cd719dadc0d470510eb07393a619dbe2e7136590fe64d696f9d1f453529f15983283ccaedb8f9296187a27ab52b0d9efc392f8fdfb12a1f03c33ca8244b61b7193573de5eb27da256c35e301f76e6954b66944cb3cf9cb029d30e032d74eb670355dc8a1d7a65b4e6e0d3d67e1e35f41f1be368d4f5c81d357069661e7c590791597ed71e95c0038330aace11c53aab9490571162cf980ab51531c40a800930e9a5343e99aa325b8eb02f5e0645e4b48c5cffd8595ea9ce285060f1cba6aca0dffe79da07f16b21c896f9590e903718164a9074862279b17050bfb8496a129a712daff0f6ae7f6477fdc3cba04f72ddb2de0dbd752390d11a6384c520da37a0a7b7615089c4aa7ecf1c237ec0bc80dda1b90387ba0b9aff050e21efc650da5e81c7bca5c10ed5c4d2ca7e596e3006ea1c6528c8d630222d2587a91e4fa41fef289071e36357c7a7e0d76a6801056e541bb17714790413efb41353a0ec6f32cec976a4d635b04bb72403b00f5992254fb1f41344fdb0a4a937c92e80f8d1bf428c2a79089325269a92e32e149c7f2a60ff21665a95e4fd086b32c362f6e5d07f67d7a7b537eb7351dcfdf9c879109c48e8115b7b52ccc0e02290d4c5180d5019776dc7a4bdd5d93963a069af16f68e15a4686ced96daadc3bf6e9a645233455b9897710bacdfe3f1e5826b18f811c041190c9610853348f27da035e7ba28688984d7af4b5e536ccabb5c9bc46e48b107ea7b4625469b3af89f430f227cec2159c85575b0172771dfb184fa3e7bbff6424b68898521c3fe688d9f3019fef53f66bbff89eab4b8377e68eb05f394b9a113a6284ab817282dd24d76872bb305938f11c0cf676138305c3b6b9e4fefb983a4ce575cd4d4b3d0def54fa9c98661305a28e60748fe7262b6c5512af0454d3290e33e5dc547967765bfcbab14c157eec660d6b30d4f047fa37247ccc78381f8aadb8600ad212f1c203b651f8aa0d3f2be60bcf9ea161eda8d1514b83f59568185e53a9a3c93a5429136808ff9266a314d030c3989b009f92e691fc46bfb97dae52532d6d81b0a4ea1a4b48173b2ffb3e75183266c44ab1f20e33fc0ef38cfadc8b556697d211a212b4cb281204d7f8cde9df62d4f6bfbcc4d9c6a2d6b7b25853a9b9e53e1ad46cdbf6eb593a98c8e9db65e815a158d4a2b0a404585ef4a230877bb7695cc6ac268c5ffae3a6eb24b1893c1a23200143cc812dd24decee0a804a439fb555896f8b2daa50aad205be61080a23c03a5511a5f842ab8c40befcc6269940ab8dd72969dac08c0599556b348d5ddb69644afc54a72d7fdfa1955b20766d1e7e0006490e08c89a91faf6f3f37f5f8939012842d36c0c2af5da80230ca380fc675dee81b8274949b3addd0c6ecefb58dda807dfc13b749b1368f7ffd9883166d24b83bb710a5a17f6d4557a302d76b629f47802438e96590b8467e2f00f158de3ee4f627ac69b82ba3d1f38488293fa6857025a6b13d18c80620962ef5a877bbc4593dec3716af26e6f4f9b8c7b5036118554ba6d020a9d20ead78a6e558b7d42443bebb91bc2492b4447d76ca070c6ddb908a6a4a53fe44374015c97bea7d26babe33b5f40789d24466c52ec1ad5baf92d8851de29e82366fcf9371be5ea0a549b451b00f40a2120b53d986cf4cb55a67dca984c10a5c32eaf0a1e90f22b9f75d9d5cc5e73b0b4cd381156cf824cb8a373bd6e2ad892706ad0bc2597014b1dac5a07069da69eb40925ae005dac992221d5dc378e266602adcce45d08ac9478c5996c380ea35500066e0dfe51df49894d0063dda6405a93dd69581a6f26b0e25284a761f06ace1109ad5d1c9bd996d125b96b6f04b9ee46b842456dea0215a561afb430830b10c3e960c52acc11d6516a7911c97e33c8b48975af6e545f7ef14cbe0122244698bd2843a72cfb86c22f14cb9cc748d5628c0db8f265f80a673ba8b76129ef0e30f02940062e85499a6f9bf581da61fdec182344e1ef9c4445c94523d098d878477f45071b9c4ea53796eed35c94fb2b165387c8c77e02270235e94599dbdc7b66af0461c6a57133dbb7d1663879a1b0b0506a71f2a04bfde6220061e673a1dbeaa2ac824a2bc9c5043d586b7aac2cabff66df92aa13c3ecfaea3da566c7a220c5e38b1f51ae7f779bdbbf7edf0ca3361c6d5841457796006ca819809e157d016dd3b393d1266e5b890a154be64414e45dc58f1f4921b599243941d6840efa5ae32c1139a9b87e477f539c1d851c68be34869c064139c3a36858eb1434f754fa66ab0e24cb9610a482ea39d9d1744f8fe751877c576bfd068e34b2795ce9c5a66cf97158f282e388da09751fe37a3d0eb75f433af597739117c9c98a5b61b77843d32a9f6b28aec764d7239af01f8871170cdaf51e15db99e2847b993d53b76559176394dce190176ba4741b9452f1f612a8451344fd0376ff14e84c1f2cf38109941fd0cf68ad91712f4ee27f6275eb61708bdeff805d3b7ddfcc4c7296f25355caf62830ca721137a3673685c735c596d765067b4f5b33f551d692e43279a10421d37d3a0a7c1c4efb6db5fd1788aaa50c7e39757b5b9c2df4bd37321e2eda48c47467dc51f119f73a81680e0a12ff860d1fd37a5b9394272981642d1dc49cf1120c1565acab69b7d3cf7d1c73a2ebd427726a5b07946dd0d0be093d5795933c0c0458f344c83d737928a2c69fdb30e7425502a295b8bf851adae6113403bf2f765bd10a447d601e5d339c721c195dc498fe9712c95d91f3962db4a19785b7058014e4b63f64adb17043099c7d311824c6fe22746b8b83d13e98d8eb45a38c0a101969a11290af104097f359400e44a7f83d772cd5b8b402084946cf8a0f4ccf9fdf04a586cb076662de1b532af3239f5b4469b6c47d866abe5b16aa6f534a488c22d54e9f19bd3ed3c24d8f483298e111398db3cc85120aefc7c49c49c9fa21b57d817a49ea2ca144a60aa54d1d2653ba869595abd61a9eb8d8af492b891b313c37b2cc2e57f919e969b87084292890e68f383be4007da9ea5be66b27df6c94812f591dd6ab92ae5b9d3d691397795e4c399359ad9f8d47ea2ea98b6a237a2319f1b23fc1a36b44ac45d490a354fce9435e5145f2b660dcb06b560e810c756bd8b9ec7f72711422a4c4b837a99c5324c84b11061a663cfce68de62abc2e9bb44930fb6884213fd2e59810963966fa37f969080d4eb0aab662563f249fa6f3408db771bc619565ed60c0c60018e368f7e0cd96b43c096c2ad4a20ae6187baa9feeb5df81a828d1740763273fb306bdf88b150be7a59516d9d3740f79d941bb6719b499a64ac3318eb31c679d05aa8d06804291fab68c6b340e4c22ac7c118ab9b2e330209490d166d72ffdc47ce8478d46cbb212636828f671ca09d59a8b52490e052609179081714a7d19f401f6822d246c50ff618d01e647990fd918eb86c4de151f95f3e84611795a05ed82a30281528df299fe7b5bd6996a7818eae399be07a08f37f4ee51a3e29e49e6cc697984a885b8c0d7b39c6cfad312f1c7ab97b45ce688747aa97d280784291332aaa0baf498fe96bec6e9902964dfa955f965fe44d512b30d366340a38d6a4046c6a10aec8bc4f19b3fc1e9076a0ba4557e85a125a17b429bf00517f3c263a59188843b851b44b1de2fd765506654068e9059c466b9382f360ee114205add1e0f4e83eff7c799da582d35ce802b3a6b6b31bc5ba5856a392cefd6d9859b15a3baf0d4d3d51eba10d97465df251545bf168c329ba5f698f78ba1ab75caf6cd60acaba94bc76e50e949ded642ee0dfcd44f4def751f3c6e670020de2709b25049b3083894cb68056da9039308a9288614b9d96a4989f2392000dbda153efd952cc83a6fb71149e799dbadfcc17d4d919eda921f35da07195934ab379031758634ff5bb0672b67a43ceba17d3fd85f3f2529b583eb6ee2800f50a8cb259ac5f4d809cf792b191c7cf8297bd9c6d06fd6931e1707e6bcea28fd32e4f695a996b5a106edf412087ac15a74bcc298e30c3b86f3d8851eb1b074df0f28c5a095a3bff63f832c29fa77f9fc79a78c8f4f46818e0ef31ae3433b3af0866a5085ec14a1cd090c1965347b837934761a5f00fb67503215213ee62fb7b790e16dc63aa4de3e73823c868ae623edde3eb06b3db30afc8e7442a5e4c4d54e34ffbf726c9e7fa9e36d2b8adda73d759b5b4921e75972bd14fbb3a424e7648681ab527cf9038fa5ce2b4a82d382f8f475c361dd4d7e83a74d4b480024223738239a32ac7073a34f09478f426f7850545ffffee1fd5f02b4e6180b4ec4c40c4db1f4c6e9d3fe98b1a42b08cd7d3c0e1d0d0deb400635e19efaafc71b107d7d8b1a1cd321f3c64ad0232b04200ddb6ed2ddc9ba26f34db149663ad750d3f2f497d776a596a09230dd02d0479f9b05dfa19d3984902d26287568f623e13fb1b0cced37d4ac6ad82c1877bfcff51007072ef97ddaf885c9069d7a539859054d10163f06636bff8850a86d3708357d50d6cc620aa81502579200ac507836306dff8a89b236bb85561b9c60fb54bb1f18eb6847518ef0cbb2a406c35d7114c4afc1529c638ef40934e3b3f9c5c055bb0a7411ee1cdf97798758e591d7c9722b5a69824459d32dfab50ac7bdcbb0870325065646da21444f4106c49016dc0d3ab16f28aa31601391ffdc0184ba8dcf09d6871294e40c274606f7576661b5932fd41eb2c207576ca354d93989dac0ca784289fc90188eeebd7cac8afe60b01eb11db54a1ee66f8be0476e73ed486877ce76c78e334cf4057026e3fcb296b8d65f82446a59a87ef69228e2abeb6607b8337c0fe3d9383f8c0ac5de5beb5768773c651efab31df73b633980144cc78dc8c2b8509d92ca736a4e14cec46f64a4177a1add4cab7818b792d9be70497d00f0c9676bf5da792ac55cf15e22a3559d724be8773a52c58b49a5fc4f2e31c5439dec34de13227e15f2b4817f4d24a9d53d1231d8fb72da1c0a0330d13a754453805e56acf893f10443a7d755458a9dde44ba60b6c76ea07d9e2257a6654a0efd02e960c10d174dad2e2537865c02e63138f6be9cee6735e80772063f1653a380c97ca7e5f3163479b781caf16df8e17f1056fa839aa8d8adc0b41d6e82b4ab63bc91b585e0623a0b7d95a7dd3a5ecb69a0852b641d0f58adf7e1a9c43cb8d8e21e0134b84a96e54f6392ef4a81fe0d4d50d4e53ee016a00f4ea27cab277fe40b1dee84e12e53ca2bdc308fdb44d5763563678193d30e8170d19b4305596b0fd6ffadf77dcbd3c17ff619f2e3256a2fa029ba85b6170cf261e38dd50aa808e95761bb61cfb2f1465999ad6d7dc5991a58543e34697679d7522cc3d936da987b8a4d9329cce29fc4c95cdfec1d14323fe2a6cfef23384bfff5321540639cf5e478ea014d672118b4a6fd356158483bd08e15c3260bc57acea15abb52f962516340b3f8d59b2c386e0ade19048bf85e0da3987e6af96fe8a31ebd6af9c3c2f5a214f6b9e76d287aea623fff180169f2970e3658c1ba49701d0cf205d1faee60e66b576674d4b29592780f4a4c670b4b5b3c5e815d20b49cdd2426cb568293c078c24b802ce92827925f0515efd4475e9a0b6b66f492db3becba30989c28a472f5d4c5c96739463aff24bfbb298b397a0ab7dd4d8d690ee55da2111ced67e7c90093a99a0f8e730ac74dfb2e459c9917c63f1e2d95fd90f0e067739a976c0dd819816ce45ab17983aa8455769a7e67f5c33169436cd0851a596e37c3e61626d1963a7e02f5ee6ced68bdf22cc472158d1805356d15c226b45ddb5883dc62b4f5d4d57290dfcdc62bdae2e2d7f0daf33b0b47c20a4578082021681103dc075e0f96f7b948a930489b1f2e52c801dd9f7a997e9c2225b610b1a4f420576a858353de699fa2ec333c755153ca90aae9d34567bde01dfd95335c68d6cd1c0814d5a6b0f692c05a7a7ebb0c61a945f2d87016f7814b74c7cb910e95c75f4ad2a0dc0b2c915141d83e9c91629f05fe11bcd50a044aebe924b7c73c12fb483bb44a9c49a72080b46dfe5baf87ff52ca2be0ca7c6cf211068596848607d96da271ba4d799e4c634351def7d2aad610343d93a3100c70bb8e19a1ece47bb576ffd873aec1241eb53184c066afa8abe9def20c168b1cba7fb1edccd6a8a9e1545cfaf1a9d25d557d058c647c3d21e6cb6317d09e35ec58eb6fd879b64a5a15cb48b9bb8019877295ea61b030ea7e66be0a8d5a8cc734c8a4447713604dbc4d5520649f3315a604d74cc322a295db7f685c3ec9490042ebc8f22f521ec8449a90c3f37121bbf52a46a86a0804227c31805b99dd8773cfe1b1c8ab73a5f185b6b76f30a8b6f35ec20eee30c8279d634789d6464034c36552d5bc7545ffe579e3734a5a190bd9c2032b5989a8b876c6af5c47509e86c688f780167f48014188ff559ab6795c7462f5d517f07ae9a0aa800a0be3246575c23f0ca2d7600c90db0687be7aabfd998f257380f4bb914439bdfcd90b6faf3414afc5e7a896a0721d58aa8bba5050865b700984390844b9e504cac1864d81fdbd87d409ea60d0cf4fcdc250150ee5f5f73f5adbe088c80955b900f0749206304f41f430188110c9635d4b2bb3ff819c12e7c4156a08a2dc8632e4c26c319184c26679633b5ae372c7c9bb64ef69877d8371907e5db0e790c93b7398de28408d2bb750403daf78565fd6b2988cf3bf1894dd3238a7d196a091c776d970b47320f684dc1132364476842b3daaa7d376e626a998a3fbfdff9238cd9c39e68530800151a2cbb46c66ce29c2238d50066462e3c1c88c40c697c3bf85c71495233b0e1e0b482e731a5e7a8c40a660ebef908196c2ee13d7072ff55666e959ec4d3d67e7b7ae35bc95f5d75f18376e0dd4a4863b6c6840546066f34c82e1fd1c5431226ff9cb307253b4acf1dd111495768daca1ed0424157718ed17695132b07882f3a102a5d287942ad502867706a20706f384ebacbf7ca298c2322894485c01d284426dfc927524682f2e4c59a3dced46c6eb6bebb2709e2517c8eefc5e1e6ef9fd68f4d817d881fabb2aa3b230433498722cda35f7dbc8d695421b9c690d2af781f9da2399012771576ad7ddefe4eb87806ec5458dac1c21c201ae22d4e75ad0957c7a138cd64d721f3561e97f0d2bd3880b59d2dfcbf906b8494634be50b0952e4537e97d5601c0709aea52fdd4d5dcc5a19bf730ef6071aa936d85cfe811c6573ab1a26b775e5a013a8d5d9870b76c1d7acdfcfc805758096faacadb84355c152ec2013c0ca03c41b4475831ba6e8b474cae3bcb67270497d38ab9975f91eee9b747fd38d0407e17bccc180c062979154e5e6d080ad1af577a9dde9cc107cd6932808b90b69b4d96c00f3795e3587635335b73d538f7ba19c8a3b534f1120e2a686c0f4fe08af8bcd34ec22834e092f61a80632941749b20cf85b10c9cc862479277679117fd627fa4fbd17b1c0bf64f09a1258e2416eec6a93e21b99f0534c8ab998b9ab3cc698db1888ec9715e6a6e5270a039bac13a5b9a5f77f84cd22cda878a71003f2f070e9f62f1b547b473cb3317743e26f83617ff3b463ebe448c78acbd9159acae1958d506f61e4a67adee76a51d317b056884e67f8c1ef806a3b1548723a7070754d244675b3558d87ff4e656ef34b5911d6a2ece597d6905e3a6176a545ae955e3aafc0ad9f99e22ef723dbcae23e3091b5c0c7c81a290f733ac7d8098e3988b08dd5225e5ad11f0e451ffb0d44577dcd16ef16589a3879836bb9cd19e6adfff9bb745bef1d80cc08d10042f1683fc2a2da7f27ff14c2a30b85b2d969134c08fad1e5bcf282311a299d6361629afbe9c3b1a8612bc2cce6d75daa5057176c2760d801ad8c96cfcaaff7b412e91bfd2ccb5960a59e23a208f637e0a4276e7ae720f7200b63794f1fab7b5469c1184c7ceb6ab88f6ea3cc1ef4b9b8a9394c14ffba5f0a04e607446a0a50acd62a4e39b29cd52b3a10b9eb85588ac4ff7434b7672b45f0a2a86cafe55400c97c0328bb06ea66aa6ff7e62c25243f46556c7fb2f5ce6b1ce85e987a6d95cd8011104e88a75b8ff62909c26b0675d974f0ef06170bf36034be0051c84f67c74b90acc5cc4394743f1622cbe4d9a2c43bd82f8d2474955b649b0174ee48438e99ac573befbcbdea1e65d7f793b9748428d48c11b6f7f9b71ea25006c8ac7e660189cc2dd9e95140768d082d6dc00be826468482c7d211ad14f7e9e00227e3043566b12093c081ab1a76d0febe400acddb671aecabaa121f1c45a0917d6b2921c5bc155d5f61a92a9a6ed737549ee80591632f315e0bed06f40b441c501564d83d83cc4358d38d3c5cfe9b4953731143a7dd97bc5d54564d8ba26b18b14bf259ae106f0cd6b6ae0e4c8f6189caf5ba6f78ccf9911b31bcb6c7876c062b6cc0896e88c47b56b117e742ada7eba21225ed8ad5f54a8c93b79c6bb767d5cba4c778aba01f44712fcf83aa55b285b97f3b5764b832945313a13b267d32231b501292618a1fd0276e4b476b0e2961cbf0113eec8ccdd04c76a0b624d6d1213eeb7069ad9f172fe311f425e4d846fe520320e29a671ac3347853eebfbf8d1be5aeb8af6b3a3732c50f45d8659a67a708a5acb35099f09c202a5be3035dd05b2bcea15f926cf4a0f1cdd374aea0bd5542da108872162896bbe23643b2d0f90ef78ebf92d65c4f79d9313027cf081e78110841b93f11d16db1586e6f500838a3ebf8fa807809bf3de75a0621590d0f1852de5d3d85b49bc7f96569034feed85eb3160df86ec81dc9eb4d7e0cb9e14b8cba781d2e38de4a84532099d3240d1cd6f105100c1075f266abbeb670d6c9a52043bdd703168e145d48baa200914b722b9b911bd8c13332ad3ed2820750b4b121d93ca77e634207a09ac7ec2524fabc009118f60430a416f86d79a8d16a4bac32ae77c376a0f053516ad1d70d10f6ca393656274569444e7107ab59b0d83e3645fb9191ca68171c3f6989ce4bb802c45463e3b1b22530cee042a6f1322020464d13265cdcef064c84d03f3c1110e5c1dfab90040b4c4b98d0abfbb97d756c4675e9946e92123d6d8236b4bf91c096fe7d3029c567db55d301ad9236efbdecee3918e8256626d76447213c70cf5e75e09a3365d56a21774acd96134680a36e045abdc5c709c4bf669d6cfd29ba129d780b7a21cebabb1df9640b2c3c591513cbde665298c6fa31dbd8ed00f2bb5daffc3496d76c76d97d8624bddd293a83f0a8d8cd3569cc947f3ed7db656e677829b309cf2e35b4fbb312a54ab53e5a5301ce602d64907c5684cc334ce5889a916afb049fc1b79fbb161b2f8cc990a5a796bce2c9662e22fee821115136030527a77a518e7ec80f4c5eb3b3c5bd00f561f28562bb23c4e273e4d621371d0560426b0a3846718d23e87cff69bda35b557bab2adcaab24fbf2c2a5ca927683a670fb95eaa98d696e927d742db0960d56f471c197a295bdbccd86114c5af38c81719b5c715e638bb02d87b252d9acff778f4eb4e63b2a252599411f9a073dda1dcbc0f19a55379243469e2ea8a4b2173f1844474dc79f03e80cd5e629daae42432f616063ae13fa548c81ebffc92dd9623baa4741d65a45b38faf8c373dfe3a1da9587850dce5e34a871ba11e41fe2d58b4d8f40bdcbc096724e24a9f7f27ef1c53531f6b17ebaeb239c164296cab507dda1ee24277d612cc3e9ac3eb7431b453bb6c91ade13e088ce454b9d7890822faa8688b2cc57b1d9bf9485d81135477e35c9ab5fd9bcc9be8ede818ce7c50bd49a1c20f90395b55b0ccbbfcb1ea2d75e9e8b1a6e02c8a5177587615c1408d09d40f2b6cb08c48c2def4af9c756dece79613a99aaa509249caf2a83d5dfb0a40f2e1c6bc1ad89a9473367d4fe69ec449023da3c6d7c010dad9cfc34ea34a0edaea57d53cba9a998cd663cab551de3c4502133c41cda10ea33f8b88bca447d2856c18e43cb8d01ad0248f76bf8817e4c57c26a3dc7303d633c2a0ce611e42c10d54dc946e16d000426425dd752b3be891bf2ab4c2bc86a37edd41b3b5317826f48c2cb911dff6b2d81b1b9f22c7f386523b2ce1beb3b0f7560b8b1b8146699e3a3535eb4b983a5eb0d5b1c90f6f57c986dc7c1ee0e26c2fc7efa8a4036df46138421f051c72c7ea310e2de9ff7378c2619e34560928d87acd41202d27b9d20114fa51cdab25de6924e3591383c570eab60f71030a0027365765253db5e920984ecb69bd91b93492833d2c765b5b697697fd64caef1ebb2b3fa1db0a41776cd0d411e4792c115371555e989e4241d53362aaf624da8efb200550f0f058983b374304a21a2087ad805a99f890820dce3beb9fd32396221ec7f544961abd2cc34fa4efb5d850612874342375de2ac7f00d705f06afcad5dbecdfd923e99010fd0ea1012ac95195b8e434500e60043e94a83e6aba4684db56ec5eaa3f1b4f75b89c82629204482c691e2fab5c0ce446cf7bd4475d7b400bb2494d706cca862501b9ff129980aa154d8ce6b6e44b3b93878d3c56a2ee81da13f3690cf82f090d3ee271bf4676825bbd9683dee337fb568bc3084de1b311ca427d57395f1b900374b3e2a6959109157dfd41c6c2c4fa047d4975b915462081a600ab22548dda6846952eaa3b4a34d32ebe5383ef233cd35a7fe5d54aba5fd8bd1b1be43c3e0e9bee8816ca83226994293b1776004ca110eb23cb18848cab8d6e8444d900417f135bec61a707138a01b87e0884a898d2aa6df7a958800a4519e2372caa09cf5b8c809250c4922399cf53530af3ced7da7fd0f408e720b38fc296159ea2f415ecb527a4c2f116bccdfa578887467a654b8285814ff294abd6b2eb6e0590b5cb4f8a7febe0cb3095b3db88e0c6972512388884a8995b582a8ff9822c1afa27d97fb59705be10e1e0993c408b4e61fafb8840f99642f3e7056a8255332ce37b329f8616800eb1b7be8e5378fa8d8b3dd399b108648c22a5501ac30b362ba1d3b65b5625861a713fb2611d87041a61b698dcabfc162165b106356ac27b92e559abaebee77c08c42156166264ba2c12273b972e703e725227d09303942f6fbd9fbef9d84152e9f3d0ea973bdd03ec872b3293c4c053837247d06154757daf09e975b529a3f064922229dc8b0429c120f45789a9b6e89120d21c9521cb16f605f68b03ac119b951ca6d06f57279c22dfddd1a43033cd088837f5317efe7690cf1d86cf055cfa3578ffae8658d4e4568b93d91df755bfcee4cc8677fec0207b8b647e69b845ae47a176271b43616a1e8bf61ad30c79462def4e64d1425a25ed1c195f5231867f213d74a3c53d3b0410053a29a50ac36117f3565f295e4fe8867c895e962a96f7e28e65ca82af49b6d92d0924e197ae74c5d1e2e9082eec8ed0c1b0c990ddae6edf33ae3dec7351033a28afa76cb60c0f278b9233fa0af7859f7d0035c348c0882259c82c9b06d684a35912be0ed85e393688e637084c3c295a0b357bb2b99b053efb290041b8b2fefd5d6ab70c4491bc6569ab66c848b49d9354f6f819311be598cc2e66befcad2aa7ee3941e3980791c935ee392e66812cefc87f0352f24a5d7f76bae16abb049cc3ee6c4f45d3d18a62cc2d0cec07e7056ac382ce705ed0f532e8d699a3d1ed5d26f5b49950bfd171e3a55863bbcdd6af370d85ef0a92abb824d71ac7237ba03040482c9e3727c859f621218878188c7770dcf452c7fdf8aba096f4004c9778db7498630d0d285fddd82110438bbf7b2b1d295e036786faac06f33ff47d995bc748a1317ff657605d23bdc68be2e49f0a43b7be27ca5e3c3855a409842369fb38a424bced0c552a95e422dbd0a9a2c9a85be380ca02e973424ae5124985fe1da96f64ccd386c4bb2a8301fba05b9cd95c746ddd02ad54166cd774716b6412f1f8ae4f30320ba227a0d0b81fedecb9fd5feb38ed842e2c4c934e45fdbab181e0f58a6ebdfe920f56dacdebb37e62dbd4beeebd228b7c245904a7a958605a347c231a1901334bdfc24a016d9d175b2c19cb066d019cd860d0ecd92636d0f68f1a23014710c2be1ef33a99c131e56cf0f7e71ef604121f830c7ac099f7d07037b5e07af335d63645b49bc74e98fd3f2c70d35512d264dc8ee9482f2fd6a21e94777954e0e0c08bf8ef0bb44fe91c64c1a6ee6a77a2169c5b2bdddcfd697924373640d1f29a03821171fa23d31a5e908fe74ada905dad5fda2bf326398c8fd58d3031430958494aee5d213749ef314f0d05ccf538168aad44bde796d80eeea48f16fc42a2d70e1345dc57ffd5edde25ca703a9b45f81bd741bad739a006cf17a2de3c55bd281ec03ea51ea47e67cb3c019688a0902f76a4730fee07cebf4e697d81cb0aa1f951836dc725c71a2a906c8f20ac8e8cee446390884fefef778330df16cc84aae4a461f148f68170fd08fcec476f115eac9db0e6c4a3a5c863b1c2ae5bd54ae9bdee2e5275ccdf047f83945fc61dde061df73c425bb4185a32b2686377c27e7c926fd293e9183d05164bca213ba674a5e5be64ce03ebe91ce340b10ba85c56c5158f3114e24fed54822a44640753a95d0e613251f820e40ceef74e1f47cdb8508a2480679b33aaeb74f0c55aa09e90ff07e419c3de7bd9fd904c9c3028b1ffbe6ff6928dd31c16864e953b084fa5384a094e2930ba24b633380fefd8e27fadb338842301958b1dd26663cda987bb92f0f92afa14e94c2c62960b1c4b191649273a8c88e5a441e76677d4f047a366f26532af25ae121ae3704c086233cc3980ab15762ad3166c31c1e3be1167eadc5f37502364a11011076eac28132d47c40138ea113129da4f68682a1db6e0b1d6a26f9e02e607dccb69b3035d1ca9221e8d09e04534ce677a6b338e555887279cabda478bfc6c1a36f5a0b5c2025d6a2397f157dfbe585a537abd1791419299835485698e5e11c6d4fb2349515c7b5af980bf960ddfdaac140d3f3182a687aa493760804f07990f8e07daac53996a10de83867aca848372672d39d7e1e80075e1a26298211db62d308d2e75a97c0ff7f44d8938ba81d01ae918858511e2732420b37b43f76d0035a6f6ef2b0d29e45868bb3a43330e025a3500487bd8162cbdedf2982e7f4fa8cc2b23910d2dcfcfede6ee0f2da302ab5a5ef52000c8a70fd4fb303f24996b53454165268bae745dffca784434b3e089af695184a1ea5297cd5c7f2a6ade736c60eed94c840887a993f6fd8822bf5acba0e0f450a87b5215ead1ce479af71ad349c69bef61e1022560d71b4d394930988488b3dbc7bc261128455eda02d69b3feaa1a7404a54887c119f6613f2c412b7f8c0c6767abad95e9d04502437fa65e544141fb1bf4c70cf1b489d305fc62ec289e01e76e93d2204428ee40264cc84ba8142f0ef8b9cfcd5f5f855d20ccde57cb4acc44ea8294a14d0248618aba10226ecde858aa85a336ef5f5b296d79ceae1de7e71c02d3f30fc7739515fe08c32caa597e7484ed8f541cf5d30b8c9f585c16dc048d0a69597531be2413d4f05c6664584d00293992e06ada3071747f61f8c3f854a84bbcac1f051974c0510b7a938a096e9a8b4f65124bca04650453030d3aaaa225b0b938df21be9d4dbecd6371f7f531b8a92f779927550752b501182e3116a24e4a9c37c9cc35b52dfdb83cdf9c523db96c8d0bf496ffbc6c79a7f86f07a1abf867dab29b37d6bfe12e5dde64c6f6a3f465a14db4ea41eacc1c02c5fb225a141cc88c55ad2afb3ddd5b7eacf647bfec4dff692d4bc482c7d4d2a9c2b1f4c4c01e413ee007744dacd0ab50d16d130f6eb660b62cab34960445bd2c92fc736bc9d0fcf4405046e926d80b29a6c4ce08a50dff0bb86dd71a62501f205eb3da16b95f8f3ee86261a97ccae0858073adaf4158c0214c68fdc9f2854fa6761df5ddb98b2aeb5f180a7f871cdbe04373fed742c9c7c2fc306c18e4bf012a981892314d04e4eaecf2b5d369f364c08f1f3ea6fa1108d3011299ad284ea3f111f2aa14c52901fdf7271af642756b0ca7319e0e2c60c507c2d414abef182f039392f7beadd47f407415285e06f550fd05803b55055dd4f454209499356ee1a5376191867410796c0390ebe92559b36489402017375763db5e25396f532fa89542fa9a4f3ce385745262c34c20b1e4f1cfb65d6926a69df016406dce1035503164042fb270ca51eebe7ab770683eee9f5fc09058c927fb2c7e21be1e1ed87a01b2b86ad6c113e33ce50bc056536a638db4d0e39e34b956b2edeaba0aa5b318fb07ac1b04c64ea56e4e114af434859e77ddebfbde4291a77f093b0835114d858ef51943d3398e091793ac8ca2cb1373030dde5ad15c34c57b2a7c46463918bb7857089e8c1f3be820a5ebdc2c0e9c6fc99f635ddca5f761b5a47471e1c3acfb8f3a5fd0a431662760c29ed6aa4729fe3c418bfaba1c22b6e8c731f13e774d8c4990c422cbc0fdab6eb0f721712ebc70497884d83c874541d5f21657f392f792ebe220eb4b760b502864666caa693a5235e7135dd19d2773c3c6ada3ca91b4baf0d96f821eb89b693231fb2ab91e0bd509be68e58598e909e8c057e7704357715a96b5e727af6024a15abb3b600f900ad21c5e05803cb0d8ae65cd6994e96d1ede2744bf4f12647fdc7cb2a6e0a07c4cd6ac30c93a81b2f7e432e8c5cf9330e670e782679a222d980da8f89cb360ceff0a8964639e989a80fd23563784411c4a1c5e974924e0647a8ef3c8894d73bd0a9e2bf181fa03dca25043e279d57dd781d8a73675fac86caa9091fd62f73e0b4892c156689d7c417e58a4973d6c414bfd5f32b4cc031b0aac37fc7ef7d6c81f1254f16b0f31ae34062fed792f01ab43f0f0dfc4d4f4069f9428d16450c82b62c0a209b0b5a3a78d5f6b983579d2325b3a83af78c7459286405777162303ca4a0f34790baee6023aaa5a05d5b41c16c932cad27b351bad5197b7c36a6ae827803e81e3c8c126dbaab19fea197cee6d06ed33a5ab89bfb7d67907745a6edf37217ba089f67d065d56710bc77f9eed24df860cfcb44d3028a5057d370ce7e4833e6a7e7844fb964101e5a67addb2014f580dbe57bd7e10c6f47ec3da12a80a50d31d965664f1f1bc22bf68ecda7ddc8d001537dd897a0b71696543562346f43c1c3820b0106abebc375fd355412445f28852847895ebceac90f0e0fbb1a315c2d86f17f8a4e384ec6daa6184d78f002339dd946640b6e99ee8cf888336b34664c59ddc4f0a75121c288f7309f0d3d9d6007bb592ffb6bb624e9b18e3a3a2549bb65be8b4716565ba76e96814f97dbc030509bce6944691e4cdb36ba691687a11aeb5699999fa4e79e170947c8e3a469b43deb4c9dde47220cbffceb23ce73574d0e20a6203b6a2bd7f62fc86d2a5025bde6b76542cb6614f957be034040d8dea03e9d0419c5b9d8385f8cb209d29c24957f1b6657224ea48428fb69be854de95bb7300e536ec387842478d208f8fca5841a8e91a5450824790af41c8f96ac1950aab22ceb670c41d55ee311c517ce6c53d5e00c4b501bf7856d2334613585a8920e3b93905042bfc4a880d4ae6219a4c78a6b0a1054bcffa5b7fdbb7c610d7e0cb004cf5bd50b755de1b9bb04c9aa2fb97f5d6617ba6dc3705f1075e79a5c246b848d5985e8c49c11f64aa841c6ed653b3bd479bae6c00de9b434a774bf97f78a524774e2dbc3cdd2322882638984b857686f4a2cf7820b8587b4ac1b098e58ceccd83662b8d81c6399a95915075adfaef82c5ab510d30ea95bf5f8e60b0957c310ca1a9de73106e0b2f02519ee31a8cd130c66681aff18b8b8a13c1f5c0349aaf88bb15e7a02041d077fcf8738652c16e1d1619d3883001f91022b1e798130ac0fe9d6e533e93a248c41bcba788006a20bfe7bcb926f84d6a49c914b63c65c85ddd54e2dec298a93a9a921e9a04fcd2e3ab31782e7f6b9556f6dd1c35f5ee4263fccde5eccb35c9e4fb486a6231ad4656d7bf759e80227dfd81e43b38bf214279c93a99a0261a7dcde482502100f98aa609c7c270df2124103c1c54cbf0413afb3ae90b14c92e6376e2910de18f6f1d63071ad446501056c8af7be5f8a4e316bc8586bb10c4ce015029e329b44871056c6eec652cb6399e8d86eb3ddfd05dee3b341be7299b5d60d7876aa4e316b5fdedd9182092b46d49cfbf48c57e0c9411fc85d7afde6acb44259c3a81f43a77062e45a637554d7748581dce3638b4988cb913bdcece9bc0e8ce590a14518648c2294cf84f87f122b0b96953958c14eef75dd81122d7a3e14b8e4c0cab15cbdd5b185becfce606225b735fbaec8036d927d02838e47259c04987b4b1e3c24bc8d15b11c0e9b9d8d8f09bf3e710983f4607f81898bafb5da5441b074af973149b6145a6f4cf263572d315f5b843a8710b878b41206700911aea3eb8818ee4e99fe22ec0f60196d725454b10b04d15344e9350abd968f8bf70fc8adb4427efaf45ae5a0476bcb86fa2f05be4b1ac731905cf8244bf228dece4a4be11f8156ba32a1c7e956526b5187448068fe5d9d8807020ff948c66ade6b87b0fcdd22417774cdf796371c8e91dace7cd0c67ac440ae5d4c14f8fd2767fb47be29b9301531b550cd9c673b9eb046f3f0ffb6f97f25f549d321f2cbb403aa6ab80f4a649d789f6e3f4a783c55873d894476a924fcd0eff570fb5d237aec1f417c837af252bd5c0fba7b34223c8c5f9acbd8f41518b80b0b93d32476e0d50d9d15fbcb7a42f9fa932e637ada6326e57a80e93141fb807cb1bc1212002f395f5e6daa4cbad46d6d972d2cc897ed7cc74bc620962cb481cc6d76679d1512df406d64bf89954a1781f016d4fcf8e35865cfe7815cdb9d850e24b9185f4f84208d8ddcddfb1eae3b579ec44dfebd0c5f8b56181168f505dd5ac015ee0ee3157f5675496d2825edb2ab951102d982718a1dccc5f65721b9d9121bd2d2602cf28cb22e17c155c59875ad10252557230947f59c59843a0ec6b11cbd02518169175b689ab889f6d60289f4404ae3edeb2340225f5bebdb2f971fd2693019fc8a50a6a1f6e228c6db23580a63f55e3ac7ef911cc56bc3d7f68902663838a48682d79ad3ad14229404fd00c98ed52428f370209f349cbbbfa27206c025903c3c3275b5bfebcf66f31d9f91da0305eee9fa3efb12dda3f486c12d2b8fc09e48bd4ece7322e64de7c6f38718d24f6b941393cb8fe2f4debc981cb21b642735ce35162ed6c131baf5f52714536c5dfa8ee4d14ff54c27fcca56f145ff1a4bcb0e28d07f90d314ce6acda188e70cbd06bdd14cd77fdd20e03b2c98bd86272b224db591516e51cf195af73ad429cdd74eddda7f9ece5b5b44286866f01818d4623b64963d0310bbf46ae93371da512a444765cd2288dd60aa0d3c84e3aa9f77bb420c3b9ac9983f01e959bc637204fe60844f14a2f8a8dea87acac7ae63a3ea6c197484b9e10077c32c6e1648ff613e902ce894aff7a373dc1ecca6c3db92f6630f28a0772260f18be03edd101b72cabddbda8f5c7fe22e84a1b37e8a5ec575616025c3f300bf93b364920acf00c5308939a6340ae7bc4dca5b6d90e7de5004fbe930fc49d1c2b241107af3a24e6d4834728a440b9cb35aab2b1e0cb90bf80fd07589a18192aeaa1732f0c33b26e92f9d3f9f1e7ac2b96634155d495ba486df073d84361a95755b811ff5e635fa7fc3e04dd2c2f1cc79b30ee6b57727da5b0063c6655564ba67a9a5fdb18d290b50f6874b857bceb775f35fce149a6ff2d9d8619a94a447796ca00d00d4fe0d5528a109e0422a0a7d05b6c8192809c360739b73aafc3561105b83bc0d5709e9dfee3346cb4da9da8540c2814a297109ac47000af6d9c31dfe22fe2da46a1ca07979a432286923f94942112dcf26a9da0a902c839ae2f5fc3c53137eb3f3051c4ad21f3a3f5071ad082825530d1fe49a5ce4defcc3b92179943da4002b7a46e963f927ec9cf3b8993018b569472f830470da1f39fe3b07b8a9135876f490e51abb7c230a10a49513b8001fc96e5b1437628cef97e5fbb363336d78c34797665e014588ec60b15174d4064bb9f3fd974495e15db5c2b4f616d921eaa58f6235b62c2599e1d899114b683796926ff4a369c3f836a22a7258f4f35fd4a465ce07fd759b2fcd3c622d9618ae3e2320531adcc2843696977582be30918b2a857d6f748c831640484c3b9a67612a3861f972f4a89b34cc26e9565176b17271b2fd6c2d160bbe8a5dd7782f473c21042c98b68decfb00515b2de11453a9657bc569473089ef926f050f37db0bde8565ed6a03e3d62a314366500b87255c8de563d5a12fa3c9ce37fa39a28bcd9581fe8ace59af1afe32813a606b21501c16ef3d134099ae8f15d9a2309dd81572363b683e04d982812a2aa661c31aa5cf5c770aecde0154237070c9fa5ac355805504da5302dfaab45726d4d7ab23d5e358577d8d1672b9e5caa5da3431adbc626e60b0ffcba98b215a320a7bb7234ae2d116b23e8cf6b42531552d136b6af32d7e40ce1dcfcc01acdbed3151349f77323d62ca05de7354a85b1321fc689c34ec69069b40d9938bb0906695da5b2c8c1fb6049ddb45ada0f2b97ecd5936fac7f35b3c114e61bac6183bd914f05f0aa8977adc3d7a0049b5c95bd47ee152ddd73001490544719667eaef1ced428243fb64939c398c79fa48a59c47b31837201b980388acf50b9d9943ff8a73cebb24fa79c79a094c31a127e71a8825f0307b0edb91de36d6437751954b89258b53c4b1ccdf8da29a6bdffb2bac59e6332d0aa03c56b2af304cc06ee5dd0b08c8d1532b0d16043ebb32dbc59aac5daa9721eac688b3c73f04ee69836c807ed1bbe052d824a4fe4bcd3fd7b4db8fb1831dc78cc58e2576fe9b7746737fea34ffca3f9d97c8d394a1d06d177ec7d26962059d1e2bd4302086fefc9420a26ded2cf833b19b9367f5c8c936d381e324e5178a8745c6a854286dd7518159a9c3829389d316d5d2d751da0effb2971a68f464abfbe38ca6cd89850102612a626b39343e1457447964d6442e2e150e91985b2d135d5985d00de97aa334b666a5c65be7cc450455214020a6d55595b8028cbbf72e8e412a07b1fcffae6043ef6775021275c588507c9fa7b20f598f6df2280883bdd814264fbbbc71e02564303a0409dcd5159b7c919ffb198bac95148b7b8f4c9af12b8e5b0e8422b17b65dcc296f94d3ccf1e5264d9678af4e664e6d9925a7389cbabf1e218af058a947b23dd70dbe7108532be333e2ba7185302ef7e39d400c77a24dea7ed136ad1c531aa6172d3d496cff085c4e83709e12169e0a115fcfaa9460aec5131651429fb028f7eadd17817c738d6d6704f8420e968c31fbe7570de4ecb3d18a034d6496610ac98dcde7b003a129f130622c4caf2294f92c2f3982ba1b1cad5412853a94a3e26e5a8fd27ac58f010444e30e277ff8e425a7b8fde7a355cebbe02cf1ca892216c2db3c8e2d2ceab71b05c529be460c3d2b192f064c592a8192637918c00fe88c6b26c244f3062fb8267900ca74152eb4d9541f55346e2ab7a374cdf2944a091a8855e4a6e844a7847e8a75a8ef1c4b707bbca948a6683d9fc910377fbd153866f32cd9ea149c85b7b3f9fd489253ee343fb3aef66f836e6be35fdd5e00a397db2d8220479beb93c84e117b3b1eaea1dd40ee200e86ea14991eb92a8719b9df426c953d29d4fdfef620f8f68e6a63a1d2661950c509705d99ff1cc9b14fed991250dcb6ea0a59115a309f811c8df9b56dcd0426fa1b9d6cca920e2e9f6ea8c6641cf84ab63e2ddc61865c7f4c7499108500ee614bde172c08e40f7a1f41a4e88183fe7b0726996f10966373e6020b29b07d0438a43f9dafbb8adcc514cbda96ab8c2d4c8c275d5e52a2ba785536a4aab59df4bb669ef7003cce8834ecaa848b4a0a292d6986da2c6705855c9241320c107a0804b49b9acce52311423ab20fb123a54b11d652a2a4ef8b1bc670dc16dac0b508f22f65a01dc2a6c3eb896dbdc488aaf6e0006069af0c4295d5dcf0243b88e5de899e101784c27ac8371aca83ff721a5559dac6589ddc2dc72951888cc95e56dfd815adc35d966dc176ad41a194ee959c78b1520378e86805c8756978f820fe89641c7a9742073683ecf49513cd8f8a25bce4ba14c9c020b5ef0ae02f619da840ae5c38faadec666153384420c3bb900b8876d68d63a7022d271602f1971f8315eb03ce915249fc20f0d7e82fda5f8b8a1ec21312a69b3ba80e7793c56c29e54463ba929f6a7c15e51066438a11b5ed538c8d5457fc608231bd5c03078d300cbb9fc139c9ebd7235a945e4b2ae013fda2ff4b35006e7a8366dca5f5cd4d384607aff0b3fc8276307c31e57f2290323414d886c6b9d0eb44611edb4afc7daeb876afcd0b691bdb67f10adcf990d408bce7c75741bebbaf39c651401ed27fc6d5a765d46b6e7c8653b36481a2d26bb835dad695f67dc1cb773a05c4829a972f87589a401e8275cd8f710f02ac716c689001df38586e19321ca9e1b01df0448558534b677d43c09979764b6e3a34170e1e91bde8d2e20b568a92929a6c38d62aa855c5f13647135a5be52f3f2778d6a9edcb90ca196367c212822550c22080bfe4ce16c96cf3d5bfbc728202d2031f069a92bbf7dedb3b658872bcc9675952a8a9314bb0d885b0762d0cba18bf28a55ddd8508c348d7b4822f3450c82542ab6b3dfd46c332077d90994eb2c685cc95621f6f0398609ecd0eae337819a6a8eec0f40337f4dbb02008d814d4015a25570d98d0bfcae26c28faf6680c99b3604c747dd18ea8e05827f29d200f18cc36bfd153e33796bbcdecfe6cecb36078d59124fc1382635263385ca4eef2f4e9a88fe70eacca233e4ea847c46ed3f65ac42d85afb1d51a3484cb885277fd9a3233a163a6db093c2c6b1d44b9850c265f0ad79e3d2e33da6bb613585a4036d6ea61770bd2167f8676fff0530750c9c540c5f5d809a3c12efecd13ab95eacbb9e0118d93ef908d4f77359161e910af0025cd18b9c18b7ab46ee563b682e5e5358853cd5a7ec24a5d4ce7acb7ee61ed29398b816ed2f798587b07a4a8f2441fb4e0c8b40ceb3c3d89acf84adacb4cac67b0a3a8f35b5e7e91f88b5e6316a44732f0996ec95e562df141a2605a50936b2378b55fcedca549f1ff27f4d578e72df6a1d00a43f7d1e6c1520536f49f3ca04ac5f01b1e7bac0963f5796b762d15c2dde497a0f6160827f1a71293730dcdbf157fd23a0736f34edd149dd696da16f6a05dcaa46615f8ec01b37ea4ddabb86da2ed92f913c54c465bf73fdede5d9f5506f8facd41fbbf0c41beabedae14e03ee0a52a989cc69b776d6c8b7a7fefe043336dc27dba5e78016e801878facc0bbbd4d7fbac177cb7cddda1dc81ea0f49b5fd099c05965768d4b7191ae84301c9a29cf04ab762192f61282bd32656d5a117d85b93a55c4a0340069e2ddb6d2a1ccdb77225cc9f7a2fa5766d2ba9fcdc5c3249494e526479b58f52c3bc4aecd11ce427086882f9b63a5645fe39e207c2e76a6ab6722e1a4775b342d00e319bbec11621d0c1ab344f5ea183a208c60c7d226591544aa2f5af9031533b1ac2e548d82bfd21bce9563652c87ae79a8216d334ff0ed1302a233b11b524b2587a671a8ff2c383dcc6c071e96c952040b0a506bf7e1b603efdfc0f126bf96dec85abf70c0897f96bd3c94929349860b55961d7243eb805f9c1f4368eecc00b01b82f7ea3e8728ec78c5389af8c88ac5fc093a656e9c6e953569e585b01ed448ea0a750de96c4fdbe214ef0aca43d7a33ef4e5a8c2c4c4f2aea29375f8d93274cfa0fdfe9bb8f3294a781b2fd3d21c787ec77118e0e2684ed1b72a9c258b555df4bad601dd60327903d6eead5eade89a1ee69579f0657f261b1ed1f4102240cd59d6e2e8390dcaab91a4ea21fb7fbbeb2ac30673dbbb228e6c5aecc2842d9fc16a03b667face2fd54507a7c42839b8a266451c93b16adbb0d2c8bcb6f650f99489be5d2b62b79648f97f79fb0359274a522e28bff3d9a9222e53d032926837668f2c359f1fbe89d86caff4e957f956b5d5107cbc6f69c6fcc001e2dcec765d84faaeb73a3b683d72f8220639f6000f151a23e404a52a208912bd6c994dd513d4a810e01fd019ae3d79f3877d8fbdd4bed25aa0e61390f048a341b5b8e67607eeb70fa25d326679f6dc437857331e2cda0c2097763c6f9bec5424ec8ffcd8ecfd059d8006c3183e5f776fbe277bc1818f3473be36719706cf6818e0fc5995adffdd07f9c6cca2289ebd6c0436d36fa50e1516d289136ae5cfdc57c5f026b36af0aaa56062c04830e06dee59aefa6696500830e2eaa20674ed0a4546213ce4daa493d2617cbf6b71d0566e8674f14e233806ba4b5264ce52b2b53ea592d347bbdba701238fb231db7310eb66fb4be0c390d96ef5f9205b4cc59fe050b8a8d0a2ccb794fd0c4b69dbfde5ca87e2c1c06a16a84d5ff1923fb05a0e25416a9653d43a9bc8551ca63b1f8c30b2cb03b6d70febaf5ce09d2977c76f390a3a978918ca944cb4e6e0e5092cb84ddb21ae2976ce7f03b291226963498b4f104d2debdd2ffb1fe059e4c16ecc7631518146b17a6c993446ad664b38f240774c6cd5263aacbd8a99a4d34f94f37be8f4bbd1e9194ac2bb462e4b3cbe4eceb2a33e5f705810e7c0d085bdc581ce3d018c4830279556953c52047daf216057fa0f0982d23a8acb91e55030a3503247d6967fced51640d8f2769203d3f1fe550a5c2ea568e6bafabba0459fb8ac6938d4b134122d7ceb6a606357f635e15550ae2479e0b2ffbd5f8f48b823f006daeec86e3b000a4c966ead16ff26b0a0fd7f2232ef4faa89938ae6d538acff6a47ab4e353350f432ae419e84617cd4258d9d96ea835a6646a7802d730aae8db74a5e1fcc812ffe5b68c370c2183c491221e27f6089fccfafc38fc3e3e295bac32c84e9870be60560a1037a14850afda0d569f4cb8f01612072a34122a81f32b8ed3b4c826a267652e784956f9a91d1d85855736351c29ea9bd0b41f61efbe20a49f62edd2d73510f692b82f5797513cb06a0818d9fdad30917eef0f2f5f139625623d5b24fa4e3d197e6919c59d769dc561e44e54e0ae7df49e184fac61d84e60d7dd03a8c86d19a695715fd3c043ea4e68c83c8f9e5a786dfaabf738e989fa0aed40e6c30ee82a7f653f856abebebdb6cdde539a488652ce2144664984bbdf87459615bab1a78434112632807d839665d5e38aa8e15e1b724e74315f7c0f8c4dbe481db93b81f2dccada5860f47b326bec4d55a41039bf5c04d7e4f6513d830fac066be8ece86952927cd6903f2225a3408ff68e288ab025c9d64bec32219323f9b77e32d9c3167a049c13f4325205c5c3aedb5cff5e0bdd0e6f236e0ecb36766faf5d3454122f2b24c4d5a513995301f50939948b0eca993d3bce77d1515dac50556d67f9b0e4ff71816e6b640114828b31a44287ae11b34df31d65d45a997f2876a8527f8b815ecd9b4b437f7b91e0e91bba968598260eee3ddb35a227e3ac507218f9815f24ac93f186bf0ad5988c5b66e663157d901555ae4315bc299202cb8a35f5e48dcb67ce993e93d03793c368cccc3f0f8e77f6f2c8f4eea4ed3dfc11be794e10bb54b1eac2ff67766b7894fc64c77b0ba7743b348bd5de3f8b523b9212225404ecd49fe05382081a20a4e1df2a8854b1c42797ed70d3420ef60bd762e1fd092b29c8f8ec25c5179bd155353e9df4925e9b0b51a44ba74d44c6caa1c3f126234e95479b60193ea82aba008d7e32802a6349720b1d445f37e887735d67cbb5a0b04383bf498a466d534f6a2ebb200a57949654be7eb9641bdcfe772dcc0ce2be9e6e474ea0e1b91f696a9433dd31a8c8d2ec23f613d87fa9875552c51297c0da8647f005e42cec82f8fb40a03240afedca8c71e279e1fa6a78501ccf17179492c0b77c7ba16fa5ed8a1fdc99f8aecf92abaa49cfa18a51aa48ccbecc94433b2a140b21beb1a551c1a7784e7c7c6ce75fb99b623d47dc7d9684e7a58bc98d34eb9cb48625000d14b321ee5e44a512fc169aea0c599cbd89fc4075eff112322c32454ac7444cf4137376d0be23e9db9d8d755190311d59930e9ebd680653f1dd5fc7b65bf56af0569abdaa623e33faa16a6d413502188f2e6115b4b8abada4bf2e6235be1f903baa258ee01c7bfbbff91dbc8a76298a792fbb79cc342536eb7215229a8fa4ef096ad3244c4d6469f67831af0312011ad848f41d5c72b0d17c1c73b2ca1e55bee328b32e77aed1026dfffa57c7981c61bde8020eb7e21381dc42fe3bf4078a6ec54240377000433d0a14a5523b6287ba6f9ce3945b04eec71539487fa26605cfe17f115958335954f0187c316d89ae2f2b929fe67364c2ac494bf5a62d6094615883886deb7abde877e7fa07b58a48c19bfc1ed886447f2a6fb9dcd98388c9812cf21c815eaea8a324d30c34c6a31c228f506f0b7f64e892b3ef73e779d64325c5c45f8056ac9e15e4c03cabdae76b4ec61301911dd8f7348959cfe3f86cdd3c316c4cf988e2f519e76b5bf2ec7ec669254eb28efef2716e04c99b31528226cf7bc8df50c00fdf4705705d9d3a54afb3575c0a1a046b05f802b554e26a5343a68cd1e8d31212f079509b17544725f8a1d003d870d5a8ae8207cc855d5f994cf08890ac65ec1b4ad9288652764c0c56ce4ffbb381f5f21442007f0be55569a445180642dd0a77e702365c964f90785dce1f709e12c1758e1239bf8fb687928da357c24be3d86a078ee5344a83062e315ad05a84d3db80a518e481e07002a323ae5375bba11b92a9731c4c79f73c2043467b4f9206caddad58656d316b55e0423fc22950449fef8bacb9a0f1a13872e15f7e3d6ad48ebcc4097b552956951f985b4d182125d70173e713e82d4e0d151e0045cd1d28be8432f3b3336a7dc4e8ef75ea31db6cff3705c21660071a3eb2afc08049d5ffd307434ad6f03901cc035f9d4d91eea545336e8c3a0e2b6fddbed30a27d67126fde8a7c69f8385da09860580cc9eb4a64cef21f065d744f8625b46861674ca17bd8d5e0f4a9b1ac2c5c4cb24a8927706cff74cae8bd32cf9f4c36439a7f967d601040ec2c8778a513a5d515d5c6a1b92e03da1e8a990a6c00a3ccbdb46ec9f96b6417de1822da8f2cb5f54f4a53e3268c0a09728c1300a2b08e917a042c8998bce58abe1da4d69b6c773a96cdb097db76f88b08e4584769f4fa5a0df69029a5d899605666e6252276ddbe07ade24099d9b259e49f4d901dfe5e124fae4415a92348b85b321691146bd65822983510794e220851f6c61bdcbbbe453b9feaa78a85a8e6508acc47adf7ec3385539d4e2c1b0daba6c4d0087836147f36f0e39e784b454d1f55c391b9ebbe14b46fc175d63c091e2e7510e0d7e702148868fb6cd186db867dff870df0355b6a767eebf5043d44b30f8aa7f01364043e8deb6f099f143833f04e4d7623e532e9067af7de9b5e185956eb7ba001747293ef21ea83322c92e5d84813beb030de0122332e695a73fb23c4581743d67c3c1c919b02dad690559023a2595aeb0e86e5a30cdbb5e0f55f0e5ccae30470d841724dbd6bf292cac12c031679fea14f7873b31bd8b2a1c2cf15f639449e798cfd4bfdcb2759693f97d163fa5112e431cc52e8d64e406daa0ab31b5e8a6ab75995e27f28b5dcb7e012a0a73141fcf15c8476e44e415ed305dba65a442c240bb81b987b48d8bd310af9801a53f9ba7d5d4f639d503b20b3a6da5927db35736363b8ede355caa663ebdf1dff9ba0b78ff177ef7e50c9988ecec030e081ab38748ff3bfa9db6d1d957109f01f2746c4a26916841c3e450b0bf6ca43575edbb1679fa784b1534f3a9659748c052ef03db7da28f8d55a647710314c8ea941699ab8375c4470349c4b6b24a3871c5ef16936537d510851aac756b830accfcbcd55d197f0134c97df459383cf2f0d9bce1c40899aaa42918b829268418805506f3a647e78c9654b747e5b31d1cf102b519b7b605e845a748c756c63699519b4244fbee288c2b918a75e3cf7bc362391793a8f8baa8a9ab1c70104cea860f4b69d27c8ae1ea7d79d090ae1340f134c9a84d74325035adccc041367e27ade88c0b3627b4498fbd14d80a5e4079af8cb5b66476b7f4b08b0b33ad53196e2ec22af3c84632ce50953b183d2e3d73e6357c994542e33874646f645249151556932c6cca6221b5fbe00b1388cde4cb21459d0768b4b25d6be1621097954e722244dd39ce712f45194e96ac667f9be67eb74a5c1a9b5bd27a8e08d39cdfd7075174cd7740ac4b0b2c7b291153e07a3972f47e2b67a55395275153ab93eec0d9d470546bca59e89451cd66e7060f4dd6c1471a95a8d81c3d04b9a3a44196b1d15bf900871ee44802a867452ed3e566447f4bc295580e7fef418efa87c7d8b371dfef0e11ccb4a1565c8b555499b8ca05e92c3284da160980e4a36f898af1520f4999d18208f1460efaa1844e9874f9e32a8e45f9f418c0d8f1001730a24d58f88670387820037424ccf0527c558e3f4f497616e5a9c4973e34cd696f030a62c9e0dd5ffe1bcb79900ca6f9423807598ee3b78cd616edeb5de41d1f7297e16eb55c79f42b5842d166a4bdd6d048e6ada70de31c94276dd305c02726063013e8641595b49676bfc20a410f6a85943c1362b8ea3711bc44853022e84d6d86a2dcb9b29f86ff1693ef6cae93cb783282621c5888d6c3e022e8cc0a83a3cbeb9de1c4d392c3e257760f7b6171b2acbecdccec2bb8a58074f6c90384d9968d3b2925782aa9605df63de094123ea32880f366a6a1309dd4dd3819e2b27254413862a6c1b75aacedb5d83e656063b05e9ac18ed66c1e2f87860fd4356816dd902d9daca8fb4e86ee1a2c2d93f8ce5ed1215bce2e8546efe522aa0d96341875248535ad886292714a14f2fc5e2935c2a2a6bedb0d032ad093d67e1cba36ce8dadcf37ccd1fe8934a524418e546cf456dcd97cabb06cac9342492e15a96e7e3e17db23692c70321417107429c31f48643db756df06dd7ebc9dab5d9b1eef21d75b62b2ab882e44e5961e2ad4f6238cded8265c55a7c19976e51879d02da7c0970972742ea221df22fd66c1eaaffba181a5f969446172a411a4a420e2b497210558ecea30144641fe49f6662cfc9206032c2f7b06b419b2c3159faae50c41c5b664f709e7edd054e4ae969121d8a75db233f40f57409082b4056f4fb5d9086e71d6330250413ef279cd6554297a1eb9905acc23acdf6e778a3014123162feca7bd785634aee3a5112cfc066b26fd42eeb1164b7232ed974a5bd834f42bbf09ce3ac87662a262ee060ffd45984d1b48b65250ecbe1b84ed850919e3c807f11fe3c6639a9b165a44ecb69543768aec72d6ae09bbbca35379907c32b13e2adb9706f696222244eed3786cfd074d9d0ae8eacc0866f60aa19107378dde7d5be0d05f4d5f89a27361278f056f6a89305b75201c5c82ba6b6e493e7b4bdafe4d6dbad359e6116e9592e3b28d41351a331d2a993456d9b574033b819f816e56965fa70e5765fe9d84f9578194c19fd69a7ddc7965c314e870a4bba3dfbf8081738c2bd31f8dbb3db5afc957926129bf96aae52c0355d896b68169ef192a35d9492e49f27b74972fd396c158366c5d744b2dbc8bb1104abf678636b2d83ed4c730a62d7f454b405c7178448210175a00c4a8bda3dfcc50045da3e627cffbfb51983a9b3c0cc3b9fe07e6fb05d293e8c80cc2cfa44af0efa15355c6bf937c1fbfbd239403eb65dbab696cd74f31f8648286273e3ee6fa3cbf559180f99daf38ab68db3da88390156a74e1890669a4e3102cf6f694400a805a25f88749a5613395b7056b7e302c21abea3fcab6cea542d9fb8853dfba6f70a1ae7114a51525ddab01855c19ab6931cbaa7a3122db2d04f2e33d04aef73d32824680f3361752e2da5c8d3e4bf88b6a0489090723f23deb81fef6c3e077d00418b5ecd02e22a4085a807f8aeda498d2395f354b8b20cbc7f00ec5f6a1331ed95ba47ace4aed220d07c4913d407df8b7daf6d1637d55055643e2c67b01ec8c87a29519ccc64f945ee1a1cdaa7be397ef435a665b843238b1d7669636770111d9aa56303a6678f23c5602b619a9232c6d9a34bc542f795f75966c31b782e22f7dc9e7e00a7187f8675eeda2ae5c1083e8308e5fff3e41dafcced942103df5b070ed8f709ad7d4926517927c79539361ea5dfb43c0bfbe35ccc0e394708acd21d68acf527830cf2cc8115b22f5dec6c401eca08f1eef2e7e718d45d2ceb0b5dc94d1277e442a3db9c0b3008f0d66a3851700d9648ca538586ce8325d507ca56dd57926474aff96cb224259f1b80b6f2710701f28f054c3671428dadfeb126944785dd6c38f8bfb06610a8529f6570da4a636c9c342eb416ed9574c2f8dd9ff9d34799ee6ee807cfd77f4b627517c0eb97b86810a00642197371204769dc47d7bd50204315a5911c365ccb5de1207885ef4e6f0908198317624a6cbfca653354a77efa30f08e579dc016697ba4ce50c40d965809c33b331114698bf0738aff0267cbe7454d897a2339a7d7270ae3295488ba5a9df224ff0923c4144e8dc3902c507f52da4e371a30290b06053f278a884849a9babb96276253a4a1a0edacf5f9284c2ffc2b3fe225c658864b17d7554ab60a4b7ae77144664355a50abe1c887bc13219f7777bf81cee2be596c445e90ea73d3e5aa7b0b4ffab1ae30b74c40e0c618351bab1f6599d9a088dfa0de335f41457e5263c6ca096177914c704a528fcb00ba1acc17b9691ce74236d81e12b028416f2d97145629a677960e6949cc41be4213a09e1185b872ea91cc615fff8cdb66132d23e464a61152075b00ed4f060eb34f9007a5383444a5a3442137c2a3e0593cb3cca89ef9a4d7e5ccf724c8c4615760fd422646d2655648d0e532b95b61927da59e356d026936a195c331d146da3baa640c45e69388cbc820c6deccaa7a98d2c16623c63569ebf06723c7d3e0d01dbdf7fe41623878bc0b54c28eb3f8d2b32f96ed98ae812a0fd2a47af8ecb654a86d9df7eef4a87052c2cd768a4d76d1c7e5539ba0528ac1a7a7a937c5085e385d9841b85a8e9f9a3ddae4ef2ee6a636352640ba0d7673916208d5cc4f80ec110196d251c86d580fbfab03c8d261268ccf25d0ff5c17f5c8c9c39cc4940d810f54ac2d7ee158d79dda6de82c2dd16eb110094d770e92dd2289e6ce54ed332bc46c24fa6a4c65731de5e13dacfeaf1b24f4af19b0fca75172caf3026724365a7b097267027f401755442cd8496e2a88fc703844506545022ac1c662e6f9669fb18339bef046227a252c4eb2e6bc2b5883a714045d3ca8f3c6c8cf7ed439a8433c36acf0c80aee54a937b5563b07b2be8b2b1e2d5f145b1dfd55a99ba940a3742706c0a2f3b7c36ad8ad3352b6ee42306f9ed3345345581fdff1d60458acb03c7c6353cfb26fda05e6d513618ebc3a31c2dd7712254ff67d96390510f6d1856e3f7154af59c63a088b2f930de91f796df33792d1b9ac1053a0ba740dbae845170f3ccc73b648a7169f75531ba7dbb0998e4d7700748fe4a93c2f9f98f50ca0e2321297a9b54e374d1ecfdd3873599a699f85e5f9a35296a24d7ca16c2017b0978c310b8123f3cea1c9f9f9dddbe88e2fbe285d795b4f6613fba21effd920137e2806eb1f915a06a5a52854a7b50762323171c52c735691a2e1c904ca91efacd8aca5702bec51b7dd70e54a8eb61a3289471c4ec62b0659d06986f02b62e075220dec69ba3ba14cfd27f0243cd76ded13c0422c6ebac79ece478ac917c23b2cc0371379d6c25b9786049377d327be7c3e0252053e292245999a7864e434843798059fc517b49494f75a844fe7922426901dd93bd791350829d5d3b850aa5fcb92426a59ee6816702c2d4281c3598883b0988ad7197f0385af08e3b2755abd261105f957609d7db07248f6e16b094dceefff161c656ebcd680bd4835359328bdcbb46ef3446082a1a7bb0075434f2ec279d0ad1e29e026773572771dd50efdbc0ad341fb3e8fe486be8accab01afd018c29008d06d984703b9f2ea915e967807465ddc4c490b9e9bccd834cb82ca8d940438ed441ba5c6c490bca78c1ae9e7e627bf554c53345ad1f1e0fae244e95c90791bde7584d9402ecbd3c74369ff4734975bbf2cde5e41810d9a06281c28ca200a901604d33143ff41c11bb8a7b08ec46144c60f3dff86d901239c896932d85b36419c4409b90d624add1aa677a4ba2ebe03424775762775f492b34cffbc44b29187b8e791f1d059572cded17d69eb65c769d53fe21cb7c7ecc70dd68e129cd756138905a50c6361c6993cae1b15d6299c50f382f5833ea72c3f60be836650c576e8b42d35527302483a4882526b23e05d880aa6f030f39e289bcd155da2ccbba178563dbdaa4809b0c1bb513584242ecea1e7db2dd389c77413816f6b05dcab675b96013174067775941ce8a95d91b6442fd753e0fa2e14cab7c795523cae56f159f8fafc553b4d118273244aabaa9f43a5b1c2e2b796a564c4d014b4ccc2603a5e3a4b525123fb47b485383e720615c19f6d603440e19340f1294ed72ab7fab32003c08bc13ff5f7add9f5d50ee4488e568071f06e8d8e1146e0f50247c6930a2f6723b22c892911426ab32bdaff94605ee411090b769e487d6828db39e86baad15ef364cfda42c4b7ef3134c9e713375b7ce53419ce51e613dff24f9c8e98fab52859f72402537826f20f9abd8d3f9a38ef1b8e764914cb8a335745bd4f9030899e8da40f4fe4c091b90035b1c8b7a939c60bfd2238bebf00b99ebee3d2d66992a3eff6d3428b5603a678b372043978192687150a99220dc7c5a38ba13a4abacb31b103eea179cdddbc54514ccec7fa6951242068c8d0aad083196b9422a925666f56bb09f5ac9c484b6635649c860a10863466478f7aaf11568c7bb4a93736b086cd8b7157830f4b3244f8be125f037f85d971e159f57b350c77a6135cbbe7020c0539d4439ade903c79b37495d1d43407899384010edafd9ed2f54fe739880cacb4450e7a57bc9716745dab3f4152f529ffac25caeb865f5a3c1cdf36aae5b77379e55fcf8748a74cfbe1b80ae829a6a634b8faacfba91b4523440fc833ee5981d9e82f9f08a49160b366a7fb2ced050183b193fd906917b5eb19d03358f5136ff1322821d68193e02f8d7d00460503e945c2fa30fb381d16ab5dc21195313b2e8884ba78cd0bd12079ffb486e2b0516010b758af2315ca1ebebc18b50d2b62d970329bf84634e5ddacdb120c0855715d66c0fce998336fe7dddcb4d1a15462a086910f9b9def875d5861f09eb7c5a9175a0a0dc2c0a9f883cbed91a499c45e770d9ebfeb7f8821f97eb65692d58c33dcdfe59df72f2133879f87e9d798e52ff268f5bb108c9fcf4b90ffe9599bb8430fc9515a799fdf6533d6709651201811014c516731d55c987201714b5793d22bcc5eef790dae24edd06d97b46e8eff6910498b0390e625b81c121e6804ab4cbb066b6fcad0de692de01f6d9759742e7c837116df35c56554bbb060388ca56333d86f29b136096dc62eccac5ea089c6e59f7306ef11a81d0803afbef95e01bf45d120fae3f83fc63b27814d1d542a4d580fbe52a9e728a6e512605c05057d618bda7afa543204e1b1727aab71729349873fe1fda9e6167f4ef516b5da874b6b5b2a7e97d2283dce40a1322dc309da36a98465d3ca1155c9fc71c5fdb3482351c677702172374a5d32103560d1130a0f73d957efce7a58d0f9bbe2bf1f63ecf214cbfff2516217e759eb3ea118a6cd12a061e79e52ac6a1cf1f9899a9d28bded7c2c5ad0bd5a78b923a09e146aff712cafd5b056195c9ee9c1578b720d5442ae66099a52f8058043620860da3cb8ff3168da017b05ff31bc0405355b2b65ebb42733a5035f8205e593fe87f9a11407bdac6a94167503d0eef8e10031433d2cd2647ee729da06da26ceb359a662cef0dfceebf4ae88b6bc1f058ff5bf2de3aeb2ff76949d94b5cca31575f31654d9926d29bc638eced67e0e722d7972f372088f2573d1d561dfa0dc8c3f3b3510989287bc7ed83a0f0f0ba3ce0a85eaed4aab82e78a87ed516aabd9c5c9446214191778362dbc622f4009f2048977430f79cdee97527cd9938370278378093196ffde4e48ccc86f93fa6ae3236b03d780c69a33cea9fc45d633e1c673c5c220eaf8ca8d02b2a4c0305f56fd7efe87dffd8b59c2f22f949fa590a1b35b3f805468b059a44aba72bb431dfe2e980d227fa3d4b16a81064426e777fbbec5a55f9cb8e0716067f744c2c9ae9e5c3ef378abbe6bd2b6d9da45d12ff61379ea7b762f1a99cbd44150e819586f9572fc983ce3ea2628e12b3f26593867197e8c87230a111650cc162b77d4b954a429085a50868cee5eb538ccc4d7d8d922ec1493afcc51b26f9550cbb1d853b2b21ec6b5076218199d914b34596a36e742fe5fb3788716dcee320aefb7167b50c4b322c7650f7f0786d4868ec91d8bca9098c92d7f30d91e0ae9a26989ea92888274fc192361177aea343731da5ded9b05aa9afda3bd2414913af8ca321d92d2cc2dda45276ea33184fe602aa312b41b57e3375fa80b1da96c7359b7e15dea0bd25d8f3e1597ca3c63bc24d5fdb6a7542992dda1ebf436adc81086d3695a9d98b26003847f1473c13f25121e0e15828d4e2e1af59fbe5d55f3455b4b0bf717790a08160b7192e49d732baf0f7e4bd4df997bad8a1d09283c153f1af63eb29aa50012f07bc16256d5a743b30c74ba5f661866d5f5cda16494bcc2dc1b4b7f8ec1a67bf8ff44ce353e951f20bc311eb69b75aaae74940bf01e0ecfa6225a4189b39068ff022d0fffb35e1c7672171995f383f9c0a385df9f1355017bab3393e275550c0d2e3c0a422e74a7a9e69d39ab5195f7aa694cd4a978222eb4de3be36b5f0325e74e91668e9169b8af99c88940e8f5c1f1dbb87d3cd3ae0754fc378c9b67b24305727c4725360268782746c8087d08ba54f657651b8136091055a6eb549f2277929a94a2c5954058608ad9c7688115055299cea52c2969ff2e08a8b1073904f705994b7b44f09a3561340f492aac84a9bc1ea34340d6248de2b23462c8cc851798de0656c87c66bb4807d7e3cfb89d0e0da81c647f36652b292551430b23073bdff8b0c6c24bc1dc803418e19b093f295ee56b5bf001dad2cfe27885b53aad1e373eb370286503fef0adb68cd2dace31535b30ef9252eebcd9d4ee22090445976be669bb080ba203b96bdd3f5ee83659c6b3aaf48b47ef3adcacb2c9d0811c640b94a6ef85ef7279d20365e540e7d7576e0c4dc268f8785ea52bfe9969524cd81b7ea893f1043db49fa3d9a7c4d093c3bb7e380e550911c62cd2bf6889a19d21218e8c7ce381ed1b70858e81b7786ef28aa6eb5d2f3c7888b38f0fd47c4bddc79f33d50e20cbba12c5c040bf6802a88236e3b96519de8b29dbd9de37f85b22f551cad024ac3e883a817e00a20762367c6cb1ae1001f5c054c2dd5da89b4bec768e634fb49cf03f0a67625ffeb0227832b0cce1b2443d618239fb457220489b71051cdb2cdbe094fe4d39c63fd695036e4da1f94be727d1d102dd09cf7bf90c3d7642b4da876c4d77bdde254cd0e81be81a7749c1197cd15be5e09f01a7dac60bb7b63b7260ce765443db2f72cc56ef76c4168132b71fed276e4ca1559683b559338b9dca42de55dbbe6108ef1909c01caf9281262a8fc0d58e4cdb9584143c3125a55b0036f0da14525e782b361b34ee07f82624acd444cdb4fc006e21ffefed4fb6482e000bfbfd8728a7ab69c604873725c023600cf84f2edebf536ab7b3cbf2e05424fabee2d56a3d180abc8ecc88c5816ffff2e4fbabe864d22470880e311a78ee831ecf4b4055feb9af3b76271bfe4208c882eca449aa10324c8daee505c09902f0e21fc7ba357d25d145132849b658d02d456bf11d47119884d1be57a2091955ae1e8944af86cfe3a5a3b6ab1ea25d8ac7ef432b4d51f4eaa17a4b0077c84060ddb8163c871e7697a912da18a1dbb702b2eb1f3f662e72c51a9efcaeabf71675c44bde7e9fadac542b56e481548c6abded779a79d0dee0fd0389610f20fdee548903950166bc12dfc8590d1affe2ed0966273f0692795bd3ccf53a0d91ee6d0ed09dca9b43d31880fd6714a0a3909f4d021c18e0a013bf2d4103119a293145673189a387a7df3a443c2e05fb36aa30e0afd4187fb83922508f0cb3c3a4d07890f5b866cdc7ff1a40ebb26a08a451c17a177abe888cff9d542f87c78f187f59e054e5d1bf745e753085a3c0f9e5fee33954680a3762419dc7b3b9b7e642b5c397dc489520d72a646eb53336c0158caa3979bebc76f3d35bdcfb2b0d9807f4ac2ff13a8a0872c552e86fec54b44b22ba3a993345dc84803e35dc8285550ddafe98231fa5c5cddb76f1356301b80ae7688c38b6bc0c83f3e6d7efa7824c0e3d036a0bf691d0e0b4130c9488592f6e44f60b0a4453cb9b3adcf9010d9b8f5c106a232aee7490b05864379afee442d65bd84822b3f7b02082ff37868d5b17441d7fce6c88bd15d27acc5a08639dabe2123ff73a655c71ed4a6a5a533c2ba886f5541a6f3823761021a64be3a53aee25118acc298aa807691e127d253ba5d1a0de02725c2701f7eedada3394f63251a809674a64567f9bce6233b4f248b033dd4b071f716176676953d18a0e39fb02ef5047bf80277e3d2094d9ad4e46933af7c20e8ef7fd0307bb33bcc3bae33462c0fe2aa8e05f2a723b7c95faa1c099e2bd0f3d34820549cb578a44bd97676e542afd72d3aa38ab9803706a0a3dd9c11d6adc4859f717369d109d2e8507e84d8f98f5a21aa2d3c166258d4fe1ad43aa114681f5806b49bc667acb57a379c027a772bd4ec900da61c5499aed992aa9a0d3fb83cf59df1e2882ed3ee7fb852383ab4e4e6e1e9d2356419d4345038ddf95514e96df55759f7bb884e60c25d1aeca6ac9248ba0a705c16fdd32b1c35addfd170c409cf2667e1b1a69efe0987ab506ad6b5cb05c9a0507b2820e648592d6d84dcf8e486e36bf364e5842e14cc713e59bd8d446e07c1f0a109a394b740d9489160c4d7c9513a86e43f5e0e2ba78663e71e5f0965db4898b7b908bd75562cec547676dfcb65e8b68d31034d0e252d5f96138329562c0b9b3bb583b5f44d03341aa7e5a2bb4136fcb69510ce4e2992d66c5246fb1c822a5d996e8b881e6da1e1a3d6186cbf1dbd41d760fd6636b2ea1a0c1e0fc7e792f1165dc23068ec1561d88f363a74e10fd80b2450d783c834f08f1397b79fa5da5181222dc6529f4f45086d59c0ff990fbe0c8b8db8c82ae0c00ae1517bbcd74154ca09608309c2f854e9b6dcaefa2e75d5cad23a254df5395294b0d97e52b2f9c5701303c76a89723e08967e8a99cf63a28ea9370de9f3c7683a30fa75342d02686e665bc05e0af519483f505b3da0e6b8df3d9d5f64105a0f230c0e93ce62624ead19efb76e508c681aec43ae672f9eec8923920825ce4f8fd31f92d158c338927cfbef5818675688dff52713701cb7a7ca84e3a90aa26990d441f2c2151258346a6f4bbdee53e28b1699c76183b682abcfcddaf6aec3fd51f7948ce0ce19899aee6e31ef967a7910fa3fe093d01547ce5e348a2bfd7f7d108d16ef5697e1239938cb0fcb6b4bf207e16003f3c6d399af3b512b85d0f62a75ae2a0074a5d5e496eddc4d503254643b50c780d686e683f95a329ca8099fa8a60e6691ccfd6f33d06de7591d066c10fbbb8bbc283b10ca2a49952c4596d9cd77562ed2e509148f97150da337f03a18e86f6d34e85d63fef62244e4a7b2e3f6c3e52b61ed8cfcb68c30ad3aaa089d9e5c3a7c49fc4919e96851def34adec37b734b069b40afdcb80d8f2b652fb4d296f19afedbaa7cec157cca11d584af0924e10ba44a82bc345a3a58bd43615ea0401467913e8b900f933a2ba197c215983215fc7b528ccefebee650ad7186895873e6811b63026d1e81e4d3c5ef402d88337100d306fc9cc4b529c817dcfcd7437e5a8b611f0cc42f9fc5a222bc5446be74efb3d7b5467f3a8463fa5ecd05fcdc07d11fe1d15c1d2e029840ee7ff17ec3e022bca08c6fdae502273d643181142cd0cc6bccc853471507a8895f8f7c4b091c63a950ce67cf5f0cfc27cee28c8f0cb6c9802bfdcec9c63c2ed5d386eccdb8f832ea932b0ca3a6f8728dd09031d7197f7eae8bac9c744c4bd9ec4aeac042945c9b06b00f49bbf27242630633671c022b56bd556d3bd0fb641599fcab8f6befc847ce78d5dc0927b59c968178fb6f18b787adcb62aee000698fac8f25ea1c10976cae8d454adb29d15f0f9a025a8a6f1c67f6a5ea6f47ca08b2a7ac7a1ea50e14b4802a621f2975936f787bde8fc8d8d7d1ce7b5d14edbdf91f42b01f3da2958895f7eb22a17e87425ae2ac290b334a8f6e0cc5249d96f6a7e1bdcc9a4adeaae8db55c0622dbbda6d4ee9b424e455a0a69a1a11a569c59d25c7fefa8c779444b0beb1929cda2d1679451e4d59943f336233c131d02cc65f2ba6fa9129f8d4260e41d24fbc3a6a2edf491fe6e8430fd18135ed906c28d1863ad0725c8060f344cf5e9e1263f5a9441ce6cac4fbec8a6314167d013bf0975719370946caa06e3b2d22e102ff08540f8a456af4d937a977e87df6cd07ce13daa45d87bbbbda4753cc43458fefb6f743ac4f03c5e4a4e99b3b308025b1d7ffd36d56b317b872fc42434e9dff6300a8349f23a0b1a4239c058d26dfbadb16317cf17968a66a97ee12011d6d7df9ea975e051db9bd95cf9684a1fe81674c322622110867248a17b442dd92f129dd19100bdf195c2cb95a443039761b84766f03c852e10cb92a589e9cc6447f7955ab9aa83fa3237356ef452a88d37feea0832c06d48d2f7bd4712598d1234646bb02ec5ec95dbe5456c303e0bdbcbfcd951375d6a2b95986f434b03f84679e9aeed06fdbbb1ebaf963a5ee7721994373746b70639aad1d24ef639be463fc70e62b735eaff23bd76c50e3c85e74b468eb5346ffc77f15270ba05cd05b48989db1056c124503990114787a0760e5cfcf64d100b767ce0feb457ae5264d8f4c165618d8cb4525c69155381807962fa06ffa188a970d8db3e09f36cbe797130153b95d5489a7fc2a6613b6097a263c29c9f268690ff3f604ceee879bf65fe2eca33a9fdfc2be97d19be0d6a0b50e1d805f3e6e07274587a26be2390e580de60ec3f7239d403e3205b7a87163c866d6a16ea7d07621363781acf4ae556f341dde776542498cc522c6594217d0e8f258155d81105f7163c43f31c5dc5fbda8cffc7222f2d3c4dc05bfbb985b329357b1d531ec426dd433d9677341f6d6061039029f3a4a8de38d7d5414377c9027966c90ca778195229fd29b64f27ae288984d9f942e9338698a58f47229b4002e028a8086fbc935819bbf7cdf8a9dde4909445c33c870ffa7c529039372fdd69193c2d673ceb0185d5468e461cd89437cc36bcce2ed5018e61cf7a67274a59b7b27b43f7308de447398e77b4c1a4eb13d8fc12486c5b5c0f8bfccb70d6c096cf82f7a58d8829e3d474d2b100da49612e246052622895310403efd857c491aa9f463bc9566351b69370afeecd9f796251393a40f6bc5a50c84390669522997f9df302978ebdffb3f770c56e9638acc37f03ee10b64f2676b27d51020ae53f35bf19bc8327efa3ede6392a628d130625bd094b2040e01ce512cf861a5a5c59608f99c547d96845a7c703e9f6fb2c8737ef3a4b3188a833802babe55fda927d5f8d5ae6499d398c18ba2dce5f93b27804b7f7363b52206e5264a154b79ce368bb155da2cb07feb073962bd413cbb230daa0adf0ff1305a9415aa8446983139581542d8cf6922b658314b43afa62b6cb92439b23e108036779aab7d618afed6620b0a9fb533c874675feee3c2706cb484f142307b8a7288e488dcb8b4c6c6cae3785879e28f44584ec892579e8f5cea404e2aa9c6cae2473911214d6429bbefcd173f4527d739888aeaa52ef384d0939182a72eaf8b508c7c6a96251a53019048836e1c0c4cd6412be08b6267d3f7ee90c6cc5ee3551e0f1a976779d3b2048c9b59d4c6ff95291a28929b19ec65338e16223f784c784e71024e9af19b4e23db731478f0e1fe2aaba2398148118a39a9c71cfa70021ca022c7d3ac1968a37dc135945a5c3abc031a8eb4d807a351047069f536ca7e2db039fcb97cad9762df00d7f0b9a932409f7dd1cb0e6f7aeb7fda5f95a7b02722bc7c7488abe0703866eb5d72499cc776c0b4e031e7682dddfb4748516a720034bb43fe16acfca27df3c62a14479cf9f95b746db87acf1bb1223815d783a0f372b34c484eb2c37427f7835ec1df7210dcea399fb024ea559b97ecf98b2ca9d99a0273de3adcaae6d9703b35ca71ec6bfae2b937d0e3b911d8d26504962a5d1f3979746420e525222a6e4134a6abc94da86def4e95264d87140532fcb92ba10d63eb45128aaf77937761a0a6a4bd867be45d266a03b5e5660cca814db5538edc3b48338e3c79c7f3e819f2253481bb8481ce10d10f61e33540075a3e0febf85d0a0de119009578bdb10ee57886ec73c091358e3857dc2c3b55961c27aabd7392dfb28883c2e4dec743ef2c74cdaef6690fe187e67db5e20d12c058f0040b15b2d4d336fbde2d2cc07e48fce80e017e520f5435747beaa1a8f66d3fab4ee48b9806a8b5003fb3293857a5a0305c87628680dc8033436d836ff5ca2be6abb7441f92a6ca864c76c53592fdb355eb06399b0ff202dd051650c18f3d358ef2535acac086d3e9f18c8e257099308e87ca45b9fc4d980fd1d4f31c96ea5f92fceedf0a097c55b3ec05fe1fb7d36687b280951445306f6f56e7de258b317e704185d658efb7fd7fc49b8fbc5e97f97da0e67baaf514ef8a62e34f21284b5678b62f8298c46093c73a7f8c28f1f6632173834694b385529fc11a0569413c8a95385f4bf89b79919bd4499eee02875317fae5dcbaa73ca0218122bb3c3c282d52a4635bfa2cc9404a9e5899b76fbf5854ed61422ea5be56d8452a0c5be72cc6b68224d2805fdf239bdb00e8ce0380046d40a1a12df870a30311198268e4e81a2214064a88b18008836e47c2e5601e8b0a54d2920c54b3a30b323c5eafdf7a135d1b15af5ab00fe974368d694838eb6a3ffd7c946b4f17a5d43c1cb3eb88f0c2bf36fdb40e0a5e398239ebcacc59e0fb8ce9e721187495497d0bf5b568fb06e48304b5b9980c87d4c68b8afb56f85c1030e5f9d39c66ef539488a81854b936f1e75c76e9abba1dd0a1a91a5099e5229d48d394e7d6330fbd64dab2875f1932abfcbd39e74e389c0ee3e5defa9b41eea91fd38d93678237199d661487f1e5e084bf0484d8f9610c789b0fa6f10610ff0f2eac0f59da20c8b481f34c7bf0afa0d8d57bac93a75caf414e662fa42f61e26c7a5d98e021a30e3965d4a4ed1fabd1aee27e74020750f66f24e7496bef381f2ebf329dfb061a8771eccce3596f6827b62bd10fa60eadea2782ae5b7c6224e515f6787a0b828aeeee34e2221f002550d7a44c292352614f01b3a9bd7f3df03cb1c5597ebc644890db1b1a8a71437eb2077adc9fd330e2e310967909d7c030bdab6b4cd8f05207f3af4ce25ffb005604eb286ae9a46f36727d8ed987d96808af2bda7467ba45f952205c28b5217525fb932456f1b64ea4958c15147977a1b85671a3f72d042295347a2f4ef3d095cbeb2deb23b015f1da006f060dc1afa5087f6e9f7c794f97b1c3dd6c101509a4594afebc7cb0809d5597d9b5f44cf3cb35ae955f31b6362d83ac7c453a7e0aeade5f9265212083dfcca95c1f28a762afbe63b308a7033d1ff9d1c77d9a18f84a787d2ab2d9cb2e09d37b5011121f66bd1d8c7f5f60724a65a2675c6b2cee7df93162860b6a2beca436fa862c44094e5710ebd2fc8b99a25fb9a387fe4ef0be94637f95b3616a05e41fc8c5ce0a30192f0ecfef0627c3061c0fad01d72d74885f2c15c6f307d99043431062fcebb4a0f47d80e4d520d859f461dc92dc063b6b545e3aa20f87e8ba502b54e1a26126b02e37b779a4ff49f6d0f3a09037dabfb4451fd5ae943c2721ffa3aaffd7415039a54057f4586dc8529bb1ced601505c5aed80b56fc6a649de8d122ffb762b0131e12612accf006a5031a4a1c5e9d145d45248da7e04729401a51585b5a884dee5f16a74dd2687c59511d9ac31ace378f1232c30cda46cbe825045b5845107597ad59bd8eac0ee27f75791add0b4bb23c88a8e0d85cc6fe22d83d5f005a005697b0d91ee07fbb6bd2763fead5873d973667fb71555f3287716d15590f8e07b2e03b690211fa483925976a3b96d6e7666b4505e4efd10f373e32bd92b2ad33cdd1fc84dc6710930ec744911407a5174379d64492ff4731c422a100fec29df69d464f8d5a096d944ab1de4f02f8b134a7c6f0382af75f75d00fd33d9a00cef6d519ca6ad67af0731bd7a04c25cfa813930fcdd197dd1ab4bb94704419e2be7dda8acf631b125624954065aed766b86f358db8647141af688a028771eabe6baa2b3672dd9998a486b85618359bfbcbe29dc81c50608e9471ebad5c19946157e59454a5633d025e5a965c13a28cd428c06e9ba38ea55a27bdeab19fd75287ad4a7a97fce40462138335490ef68ed6ee348a9ce4e886c33c7eb3296fb8a236a367c28c12ba49e1a6a18dc50ec1b86bdb79d2b03c08ff5304b93816cbe309272b21e5f544779e15171ab64c6f39448930b29b2ba5bee5aa68d03bae2a2e22c749bd10f73c789dd8b27a913c2b5519db3f3a264e9363417696ce311eb8755e2caaba8873ed6f9155ec3556db14bc144ad38960f1a7023e63c5c1dd73b6c34103ce247ca94e80eab40a0e85a6c83cee1b4654aa71570941e9a4add00b4b42e80348f220fba2724a8ef0436e664d71a921c843e43f0860858097ebc727c082f961d31875c27404b7a1e4eac246df6ec510727704ef9bd920102227d7d7da82629e997dc1049c5de43a094273149b09576e4fc6882e2e79949322a62ebcf5e75fe5cbbdc6722501304caf04bc3e64c033f1dd222185ae582761f590d473425891243452a9b52ebf54fd9d431b63d4cf1ddc78c7017acc2be7421d1b00643a4543041f05956ccdc81b0095790daf76a371436cd3b1a0e591451885483e2291c98f24e2422e23f9fd29f920a9e125392b9e8e4467773c10724f1be19bbbffc9dec46746b0e1f0469ddc33480f16328526a7a4f15f83ad1994d013bcdf5d9d2d0ab086a007beb827c79631d3527b4d855d6b2c04d3a588dcdc60ba65194c5332c5d572c0633635f440787dc200212a020f3c7738f82242897d851a4c471a5ee6559e6868057cd7e18eed79e507a88aa84db7707905a2bca1cea736585e11543dcbefb3e7911573ea3a31c9aafac9a127c6041041a93d2fd50e8324a583dfb022d96708f8420ae93f29e38534f04f70f07866c0e2fcd0d61813930f436d84ba6df060bdfb0e6d9c0d03ced2fc2aec6414cb2ed739538f9528e5ad260349cec4b14bd4c60375e72355a59c8ce7abd652f2104e26967303c83007c559c67e4f5777a8f734fd4c2024127bb6fbb2a1e81c4bb0c8d06857cb7dd63256f10a359ea3ab278ef2ce45b73a4bda1118b5a55ac9d5a74e9df1243835de2c1422e8763632e3cb1bcf8199450e8d686e7aaef8df93a1b30cfd54bc8868562fe6e069c0aa5525855c39ff683b8be06ad0d1875b826892d2a6a8d7a3334268dc565762fb4b95fd07c8922e812b3866b05cf0461efded0ff43cc856a020ac83b8db18eeaf0b84270c3186f598e64df716206e743e62c3d03afe79caf610764dcf8e22d677049e9db6675d8417146c498a58bf7d5ca4b760016f92951c1e29fef01ad6a68389ca1cd40dec00e5040954f93cf38251a2087eddef60e9e0fea560177b1d1b9868531b7f2810a18f1f90905ac045b362f0e586daa46cda4d02f6161cf21461059dad67b29682a4528cc67b6f50d6069b9cce2f9c56c27402b4edc23ad72b027398c226ad7474102de7813732b3fa680f434f78078814f8731b8bcb4c3a75c3d6190be673e832aca71580490639c4d242422ebbb43374ff6de02bdd021371c705f93aaf2a73a3c3a8c9bf57baa0fce0adf72a202098c260fa4de16b7be3f4c197dc797dda3efb292a3a51987ff54e5f06fc1087680d5bf6dfbf565beeaf15e670c4746174fd1ffbc8510cf910855ee6720fbfa601d731f26af9f0943a3064487d073e6de6598942d3fbf3d714911f0f5cc5bbdb21d3266e34f0911a8e1e61a23f8a66bb9964de7aa895c4ce7b7726def66e9d7ae71779a3e6892eba8af32909c1017591e866f1713694f480250d8fe0e760cea282b1aaa0d13323dd19ae6194c458cb818e334d87234c4e38459aede38f2b3f6aee5b4206b4a17a52967bb9580731cfa102421395b45697e4445edf10f5084352ba0e8651fdd244762e610a15a49cddd23041d7384fb5c934d749779fefecff90604c59c38f5c60bde8f64a6436fa71edcc0a34b8a94f240deab32a23f4253a6d765d20b762ca65796f258ce71525e8c3694667ecbb1b189d6c74d1ffcb1d59f2d12ef315b7183d82727b2f359a623ccd75ef221e30b8e63465d9e9e384e2b63d48a38d1864661cf8d9f93ce1283be3030dfc69036567b2ab3c0408bdb987c754a62e43a4f66691a335c7d4e4b757d4214a8c25311380f5661c940f3cdeecda00d8d65359d6a5e4d30a194d36d2a67a26baba66de6f9d55af17efc65b4b5db528575b105bb629989f2cf4db989899e1ea96b77d0104c959a939e57afdd733190cf0f06b03ef7b601cbb06cb5b6ec34ba822bcb51ee8186f25d8784ee81b09a0f4bb1e25a9f9f888e0df4440d24843a9d8d3781db07ff5674a3b87153fba69c5efb0f9469f7bd96589b48779bf6afe05358ddbf0e099b1b790da24537645ef50368b72ae75722b2214db896c460601e67863639adf7fcbf238c512cba4dc80d333bef6db4be6163a322f67f83750e8d438e406e9b9df8448d6a4020b353f6f09952c32549e4819aa37f36ddd775826287fb7dd08b30b3d36dc80650877faf02dcf603a9a44ea9002de61e6b3fb340c40ea5e4db26f80037e0a2347bd43fa8ce7d7f4f7828bcb9b28a5737a4a1031f580ad1bb0779975fcc0f8ff7b21c4434c7fb7fd857eeedbe47076db1d141b02c597dac98334f8d086f81be5d5840d405365d2ac888397b86506d1a975c8d761313a1baac1457741353b311bdb18acb48cdbcc1c2ade23e583502ca844dd027a0f88ac831cc4711556c1839efebbf87875980ac5cce807ee4c6139fc0e2a67b5e1c62e218ed2c7afbb7d78b2300cf9a1f1049ccefd66928ff0a8c235c5ce740b92c83547f63df342a366c1521f994b097d5ea94abc5b4841c8a5218dd3335344831b9c2362bb8d7fbc2d128bb7bc1a95ee155f8ebd4061d1153e47efd5c67587669345e29dffb550ee423c617460cc17a4ca2cf3d3fee18cc285de8a8d47889be065a992a9de8d2629b95585104b3acbe03bf9557ce1732d08498e7528b466e29b5e4e6a6313ee4bbd95cbb866e4d473b06eda5830136ebb9415d3736137f49903c4fccf81ac5a9732f4b83fab57c564a9788998bf3952cb58db1dfd28c0e110c0711b4b197345a941e8c588132e010a2b367f59206fd9402ffbe300729672c28d97b4930078b09e23a30a8c766caa949977480f8d8cb6f223b6522c251d9e778a8683f71b536342fee24d90a70d8be04335b7e6b6c52195d9654475ce35cd466f0bd99da5b9fd11c00903d10f6eb0026a954c8c264ab93a80f2c1f4a5dba449d2bf7de71f11deef033daf93fc5d559443c82e94ddfe522d4b21c649330d00cf78955d0607068fdfb8cd62a2b727f5df67f44745b87967668f5d269ce770c53c424105c5f8f636622ace3376dae11c8ea440024e2530d49419d1fd348c4c803f35f8399d4bc701d40203218992f7d91b489e7354ce873cb202dcb60c4766b22e8d3f3677fbdd8eabb4e963d55841776ca05409744ca8d6a12a1f9e8b1fa170e1154ef291152c4f5ab68262282ddfcbf17e5bc04d2b4d68860a37b631bd78cbfa40ea5b7be9876530675b5d341f41bafeb4c76591ecc1d28064ca33af2491911a8e46e4271cc1f9510f18374b137cf05c85f0aa93185ceaf041343e3b4c1eddb55d3942a09573c604154f307a9d3c13a95baf4641cce063668700c0d715e8df782f2c296f6da77f1a4dff5e3c5b5dc8c4587442a7869dbf1e8db27277f478e8f46dc41ed6192a46ed9057b551c63fd95dc26ef74ad3f5273f11037cd51b4e74053419aace96439a25e0245697c91998f2736ccd1457123b471e4f48d363fab0099480d933a8de17c8b8d7d65f1826c8c8a2cf97a961d8e95cc62df08deda66d89cbf185363d8f978344481e0a2fb489ffd84225f29394e72ea5bf378dc09f59d7db8799abe6a921ebc76538f1e94c00a2191a8711ccd772c47121e193ac354288df8020fe29ae229f28c55139cfde5157ca83663b4af09762fd414d7d62a594dd7913c8dec5a13db0a6bb525a702912f3f0a79b4c12217f76e351183ebe48d6c0a08d2ee7967b17eb5103234f780f12f1bee2f39dee0277b473a3d3a70d2c1ffbab293448447eda8e7f7dd69a63887ca1b7f67205340dd985db6071b2485fe2ec8e4e18e0a47b10ede8dfd8d2e013f6343f4d5d628d44bd72daef76e89b60cd7b0201822ed44824b9b0fcf6d2e8bb671425b2bbcacc72d9cfcadafec05ed3331dca4195cd4c7a72d30eab4fb4032afa33e865bf86c2bd3772ec686f558021a11d5b0eee62d17d85c5fea1a86d91befbc4c4bc03da5606a5f50709c40eb042290b7db836140c6aeef54060e091c9101fea623e953f19fe1b59908013e2291d4b6aede9d9aec3ed43612303c26f4083b8d9237a53c2548c7e411cbcddd0c2c03adfb6210896dc8b9c1ae843cbcc6acb1ba81aa14aa2c9791856a84eb379709febfab27937d18e556d30276c9f4b388905d456ccb649478302a71a2dfd6bb856affe92670942335076abef113371005d7d46565306f7592456689ee504b44809fcd1bf06ee0141dffdb46d6dcc256e048104c56d1677c9f13e5c008a7972e3b70f0f028912e5c044cee1f8c0bab06ff9eaff7f834f386687861fb1b41db2a1e87ce4c6e34897422e5209669e27ed442a99f31bddb92de25c8d7139dc27596150e06552c933f4dcffacb557fad360e652c2f15269135f4d34bd8ac2695d63755391799caf4e8a538232c287d5c80821b75cb3879aa9d4b700ab2fd31a5fb695f2ae7fae8ff68e73afd7b0b84d8eab96fc52886ea51c3590c40c01acc3f1828fbbba7970ea96fd1377673ab80f974719d80284954ee19cc6966d86d43977d37899325a2ffa81aa2530aeb2290a7461ad78cb933e37bc08e52510a4fae960ec47c0087fe8c6a7cbe62dc91a825d2f8eef3c8c80d7becdaff24ca7e3d4ed405dd386058e2cf95055bff93981cf877c16bb2cfe5ee1c796548299a788d4a5c56e1a963e26c92063b7cc86fd2c7fb8791e5a35461cdae64bc26e9cd732dd9c381a88b517c42ac8628c04ef5fdb1b4449cdb18aa7c0afe657a2a8df2593acf908060843f9f6113000b4b36265a7d919906acd29f819590c6594a6ff23e51106e970961ebb41f5feeaa24a40dd2ce59e0b668030e08d471ccdfb1331b6c13609718c644821bb9d72f3711a564e2dcd9b666a81aa94a9599fb64ade8fddf6a15de3fc44672355fc7894d1cca36a827f64d35b2ed4ca02d17730d0604e8dcb95a0bd6d15880d200ade9216e091fecca5c5df45e32170c2e708ef0ad78f76b8a2c425c64caf77dbc90e152b3e6f44663c1b71e2703db20446a78c21cf2fc9c621380c13c6fcc6e49c0bafe96ab4bcb60e1df897a106c22b30591544ac6badc52382e7ff36b00213f976784fb9f6f5553c43045ac6f22042678b80c04b1904e27bfb3d0d6d87554a0ec899556e6c1f461339507ca71c6c68173bf88c6422044696c7fc30bdb8a1ff949cc5274cc1da844245bc4cb24375201340835d98ba48e31c62fe981099980e6b90e539562115488f298acdad004f0f8492e2dd2fd39056df756305441397964fd814795d954d9a6498de6c03d189a8d67f479890a79aee2539084f53fb24cce4d23094bb493547592e99505cad9dc1948ecb43d4ef18731f97b0ff3d38116adde022f2c2bfdacf649f2b6833ff883b55518c984de3a39bad24107bcca0dc5366e4e862027603259c233504b9fdaacb986a34faab6fa163700ad1da6a987e1a334cd5142f52e5d3ae1b8b00e0aecd36d0dbd188a15a12e947c638638918e19a82b2f6f5008df6f3e5136a296a6d1d0551f97e3291da53cabf7ba41f80f5045f9c6a295d91757460445073001a8a6210018aafcdb3f299aeacb03938069db32ec0d1367b10d9c7058ca61e11eb7bc083a01dcf67c6a13192613b51df33eeeba3a50a3f412d2187a84c62068dbc15fd10055e5985b48f619c68ebd9bf43e96f0fb8211416d7b3aaf8c8825329afaa919032d8ebc9bb336573c1da0823f1a945563bb1a2661fa100adc21c3abe9478b4cd2a7654416306165dd805cfba052ae66c1e6978afae57c2aff72b6e195c90da1ddadd9abfe753f276aa1093c13aa2f46847b5013ad00bea68b1f3fc77934bda8397248dabbdc81540f83727007a8bbad109ecbb993244dce00e0d6d3a3d60f33d7c8f03e62933d585f08974e92180e1d0e6fefbf578e3408177bd736afe1b9a9c2f3fba86188af3a56ba7f08fc4eef0762005983528f6fdad400863f698b439e817ac52810aca4ca9cdcb48d754a950659faec9b833ce4560a19f9d000994180ae34712eb6eaa6cf04e443af109b3b62b941f6ffdde6d00dee7eb28f03498f014fb2be3338aaa98214c64c0102be098dea7cc5c39e484b0a069d09ba58895fe9b79f94a69e36655963c22b9d6c5bc5249bb00ce42bafea0404fac9c2f988bb7cae55214f424cb35b971c08a6f0164c88fcdb28755c3eb6f6e0a50d3f864d6ffa848511a037d2aaf2985798e67eaa01297031e86b05cc0e595c62bfd85d587de45600107d4d3f9027ddc3ae8bc8b87ac875956e18e8b9ac8fbbc9750cc90c5f69d9f2b2360cca86903a01245ba922f996113d9681c43df5f0b43dca07bfb11bf4f71d897ba06f9d729ee942bbef3d8e4ed481e37a1396f4077af1aee0ee515918fb3231228e811b2763b6838a88d687a004f6eb49caef8017175aa10dc1a68f3e66319829d1b50c2a958f4aac4be53709d324f40b1bc46f5a728e4f60ebcb36ad2d006f814bc76df2b303e7298dc5e74add8f904be1cbca737ce5625528336ee1c873a507748bd913700a983e2795aeda10acb25bc38138e4969a414c9f1a55b572a1345e70dbcdd8db24374b91b802cf5e4cc864412dc455b75b7d31bd5e5cb7821394eb97922f46067feffab78ae8997d82b585d533cd8d48fd351cd458017b917e5e34912d839cdd87856157585cc5a4a7697e315d6077c62d7714140718cb58ac8e0c8e492e9b4b8544b8ddddbcdb46043335fd6d93c0a1a79980d892af73de7139f2385c78164913d41e5d63fd5754962e156e340cd40a0ad58a6d4f251b56e1cb819fac46378fb5fe692a1c75affdc873adb8e1ed2da4b39f7ab9b7bffd63394392138434696b0a1de37a6cfb6e192d2c906a79b6e0d8fc5e37119520620407073864f788df45234bb1c5ec941d6905b86349472f831ae796cba012ef9f59492482b2ef39b4fe11aa530414ab07c55f7ffa47a99f7dc35e957bbbe3faeffaac083dc481049d659d5d5a7920052c64b36a051a3295f586b5ae0b881b414902074810f30fa182e155eefd933c2dc9ca06fae5fb3af21ec8070ac4ea3d441de1f19276d7d1d6d0e03f2bb6f7d03067578f88368250d85a975947bb26d2f4441e492cf002c95ff5a8a4f445e7b63d86e96771d08af5398a9e6bc07e3ec2ef8d9f9dd19a7905275058836f131384633b80d87e3ccb0007ebd75a3971abd428011aefac2359ea22768dde5713b2c26ed76594329f906f36614c9542a93234c2c281b6362ae71c97bbaf4e6baf0deefdfe7d484846f63a6434f999916390bf87d8c3f704f8b5150303193ceb50c2f0ba46024828c037f4c519b49936c4d4bf3ed84ad07a393cbcb0ea81d6a85b0709cd196f384d6b616ef2785afdacb558922b63b37bec775e57b79be5e4e96a6465a4109512d9c3bbb5b8bb90cfffc9b8bb270de1a277ea02872e658670e6149522c25d189cfff65149dc58d0a9f367c4b3d43c38740dd98b0703491fc4cff13f5e83730d9728e15a8e747fa18bdd448b612382c897d14d860042ca13218c5e1dcf0752a01b18da69b2eee6516329074a4f9af8d3e8bfd5a2eb122bf9755fce50de49e483a527e9075379e230588760d727bc2e110df2b29bd40c1b981b38df3a15379fa1fd4c00f85a6531e250222c81961ae91a5eb2972384242ab25da9b2e4c8ccdd4878256a2db51af9c5201017e93a0aab9f7d671aa52ec26d460a7ae63c9c7b07a9433ff1070e06d370c68634bc1262191fa169284f17e2df89fb83c7a0d4ea2dedfc279e90c7856e3e5ef2567929def869e86a9b1b7262deb406364f7c7da64f036e535018f26da5442ee25d9961d0da985c74d60f40e580181d806a344e341ff9cbfae0889299d0a493d36392c90e1a3a530d621858c4883e5b97b802de401698bc45857f1a4a9b69dbbb8384ba469118835c9e2547ffb8b37d4ab7c52503dfa2da4f81a2fd0a590de568d1c6d5315d567fdf33cdaa22701f1e330b97db303e3627bbbda42e6b30a8921d0547064e04357c4863de945b7cd71bb711fccf44ebc5e6ba0d0a1db503e9cdc9ef3be296f423e6d067f3538897fec167ae2a6e12161d20b92de4de62f4b29ed41f43339b70f98fc1e037efe57169b87bd2a59760073250e6295f2df9c294fc1d0cd69bfbecdcc1e5dc28ea782dbd9fa94fe94a129680718feeacdb1f07b5db978de2c5f07f310061c28391ec44bf724461c2fc54bb56ccc8bc188dc632bbe6bb47a6396f9147243437974ee4d1d5a2ef025363bd91be8f2fdb1541197534a5b879c0f0f144d6f7b33de9386551daa4a36996292f49541b7313b634ed233e09296e5f150d5c0db7eea026908a58eab7705cf70204f41014cedc281a69a229d0399df7133802e904f369557b6124ecd98fb2b48f6e5aa4e34851705a66fe34c6a8baf542ab5fc795c9c37d10479053192cdb3a0578d6e7193998fd7aa77757d888f3725bfe4da9b4429bdbf0513138efe42a0f28e592d01f226f0066ec1d64b856180513e869f0a2516477a34b2e28c984b9a31e0854c6484c8eddb9e8c08dceecd051739b265002412414f5db14a32e2bd5f53b6a7090c9a8c4c9b4ea07f2919958a22a16697408885502c4a38252ad8bedce65f267088e045ad4aaecb18cb254ba27eca465847922d278d5919e437c0439b3c7741b488e0c9fff8198e0e86463dba74d3f034c4472497020bbd156a78dacd66c318a4f159d51003a8805a26524d71854bc9800f526e0b2f17d2481874f36c659969ac15c3ebe39d19ca59205915b72fc158cd0c5b1a278990da866ae12838e880fc7358efd6058bd5373e7f3d17908b6075ff415090fa44b86fd81ec32498ee941f8f052f0d016d6d2f6eccbcd8c9596748a251f152043a5e0c378a54ced50d7005ccd7c9ad0307f8bd7c9c8dfcf4b063111fb003eaa9a41fd4e0e96069bdaf4f3b4b882ec0f2785470c66c07fee2c8c8e121ee2f958ea5b573b3b2c7c44cd6c2c5fe6cb520c976add4c2bfd86fa6bc2d70f3afc9359fe1ed241d2c7c891c7ec90a50c32e76b81fcaabcf93605deb4ae59235965b9408010a37fbca3765afcfb55d6c672a760625527bb0ed45a5a439b7a43d365a2e6141e7cf097dc3475ea74a990eb4779da72b2454e0a1d680e2da9bda61f669ee128f72c684c6e2642bf3a94102c309c28075af02d4a9b68195136e4e29a2bb192afd4ccf41404a5350f41f4b670fa5200550583cd248d0a29d615ffc4f367b5dff8771e5af477f3e97613430767538218ae070943b33d8735ef7f6bf13e7ac4c47a7afbd1ca12beb0d8397197779d25db4a9dedba6c7065df17c36c521f9c586d856cc4061f204549d4da94e3249a93af472fbbc0e8ac646e8cd0280d7696404ddc2166213daeb5142341942bc101cadf52f88b4b26bbc3c148e510a1c63026be9a271ef2b7cfcf99c5a7dcef873f4aec23ccb5189cb348193f7e0fe9d7415b19e24c5ff6199a0287b053ecda12cb4733bca6406ae684f0ada6e670c1ba29d6530f12623eb03d3efe5ddba7ba58fe4f8ce250c63ed4bb511c0b7de8e524d64a7e942a90b97ad78092f1d14902e5f963567d858ae6326933c479cb94d234df9b3e99b27beae5edfee9a92fab1861215a6575d0f3bd44240c4c6b5965b8e70d3aa4ac3cccd8b7f9fd319c9e15b2ed377c14332965b1d64e29d11a93aef6a52ea3bdbfad9496b0c87f6a0f7f74027c9cfea6f43d6518ef7eb377f823929b2bf1e6987c24bac71d056dcf2bf3006ae71e2a70c7431f6941c329a3e9a61c49e4a60af3aa83e52daf8f72a3a2ea522cde541057d429d5823470b211ef96e0dd78fbd21dbf32a1c1bad979f1520488e3d41b5960496dbe9bd6e17e7c8eff4d7572867c9c08eb35ec2369418bd9bae16a134f3394b1db6ffc41934b62d96423a4ffebdb729b71310f1971e5ebad7f3572c5ce4c1738b49981f2503cc2b606143c0f5d9554ece220417abf21a17be04428a4fc34375fa3ad33902edb95a6e196df93cd8c91129e01f02de1dfc54527bd05d9110aba2222d4a71dc3daf99c22d47d72920a63533a6054361aa5307f266613939c8876c5cf34f8e386dfedb5f68478a9ca17199ed5f58a3924c160ba74a079d3f6e0d4dfbb45b598027a1af3dc762c0c9380bcf200448fe154ef2c8fd2bde6f06c97efa5d6670cae1aeb3344fb2940b75be9092e1630f532289bb013c094552d210e02cfb26f55b4af058feb3b0c5bb0b40dce3c3e33cc8b4053b01eab4f11981040ccd46d1ce08b845b8da8b01fc170dd4a348b8c80c4d9864b73f44dffacdbf1cfa379daacf07fa0d04e36f67f556e63de1040ade49acc7b9e47f7a3b3f69d93bc9b723f79971d4c12b27973a975cd9c44814299e703a3e05af958ccd61ffafde696252cdb8d0c04c926bbb8558ec67cf1ddafbd65cd9e94477384f12edbd26ac24d989c85d6337dab250fa06eefb26b769ac6a167c4b5e67305e926cbf9024c152c0ec6e0c3cb8118af7a5e01808acceb3deef8ad2b3bdfecaba4bd0f638e55e6562c2ba358f1f4259145c4dbbfea476768326071ed85ed868f3780f2ee97222ff3077ae23478941a9564f05d300170b38b59baf2d89c0ffbee22fed57414437a5f7b4ca49c17f488eee8b2ef035a58c93bfc352f346f2c79c8f50988515b8fa21a026c97ac054d6c0d562371e7ba98496e1850bdf5b8a949d57091bd757c31ad51b1756aa9466f0a9c37a7a5248f2a789ea1314cf477678343c97bc150b4306b7e97d9843703314bffd746bd2bce43eea8f350ea8d944fcbc12092fcedef6d54220bde0e4bd785cf33dd0f80663575a2068f01141dd2868619b8d1e3ab883c6e2444f68ae2256a154bc9d1be3926296a2a78c692cf9e607ecdef84d253f93bc46b2c1f3f41af92a4a5417eabb200f808a4003ea8c9e02d60c0b750d6537fcf91aae82ea16c4f7dfd5fb10b1c8bdc86fb86094b3f563cd9dedff00536484ab9724223c83d67d80410aeefe216f713d2b8f4d15944756f947deac80d0972737a73e7151e27945789220669df500d45c33347ab76ab201b8307579da4a9a2c2f57fdfe655fe94755df55248d9dc347181da743076308c82cbfdeb348d352ed28e9b553c2e86b93a49220dcf5f8fe6dd55b51991ca0363990b282ed6362bc4829fea074cd1714520f68a95699dc3f337096ab62b8596ba02749b89cd8d163fd12729e31175e70b59ae838165a138820fcb551810958b518c520c7c2d77f595ad53e45a0fb9bf5e99a8951b2ffe5eb2ca42c28482024a94157b4268866e5051fc46f887ce11c488f03183050b80b82863a1e900ed785a352dd6106f6547fb66cd5c7bed8aba04d5dc315e169f9f9923ce818c4dcfeee8db7cb9e43e1b8878798082764d6b65567898b2eef87c282b737c89f6bc669c150e9bf01679c94d210dbec0a588fb3c051156f31e96f7e5fba0c033fff1d5f39cf13b68f8f8cf336804ca7f0722bcb94415197ea3212b137ed6cd2b55ff7a34bbeca40af0361f5f4fa028902647eaccf50780c4598638abbf449958f680c2efff1506e73b8073ca96b3b78b6048266601adce9fc6a15b4c83f90abcb3aa1583436ed25845daa7e521af2fe9b0db88f895274baa21314c9a194df7cf0b23bfce824673cefad5833d2060ec290a25c6bc6e2c0c2c8c93d0165030cd0a4ef060c8e6395e994d4f52dbda8b4c08ebecd9dd1bf1d61b6378e5a9bb8a705861f793670c6b4dea245326ddb9859b1deeab48e56b5973f6f1aca5689824c1f04ad458dd1cc18ed627473ae6ea78c673b7b6ad580d0df84f3c83cd56c07b88c0ae8483532d7f35b87bc939f5f67bbe55a64d9027076a802412f77d83afafd8c251a103d4c867e013e4b952ecea78b0daa48b61c357907e02f711efcc1189b5de8ea6355f214d2682c2647ecb56ce5ea39bf72e87aba4c7269fc80aa2ad1602d073f2568b05e17acb10a5792a7e454363050b3c2cdc71b6eea826443c93b385a91f5161491dcc500c17da291c11c7af86eb48e3e569d220d9c9879524f364692e57bea51fb364350048e778e69183d9fe6ff682889e1a845fe6ab8afcab964c0fa1521dc25181cdab372b93d2a9a13b341619ddc608ced02f8dee07bcb6e974cdef5cbc96cc4723dfd032188560019a1bee592139be6971aa922078a79303f829aabddb6e41c0fda899eb44edf8c3bdbdba23c7ec1e9d569f3b83a7e10434b8eeef1609990d6ace3455e062652432322d7160ad4d766077b7609eb8e99a89bfc2929dc76b7d74cbd59b758649b4321ed3e03bb4e727be77de50cf4d600b91095c75262890d81e955bcd1449631c1a4ed27403c465458103ab6467d418cd815664163a80a16bf0574b2dbb80e5b64a1e3228a8db925dc7c1851f05e2c70ccaf57a6dd70594b43dab8c5f12cab811cb415a8cedf6c4d6ed6c8fb3b7988d8ef57d0c24337fc01c0592dfc6e2816c9c184eda51ac134b4b89925e6bbb01f6c2b0ffd5b5985ce62b0e337986e3bb0d79540fcf43d98f5eb9419e6099bf4260844c30f9279e7b08da49e0488d21d61de26f2c1bc1ec2d142212977a948cc89ae8a63c6d61560d79a73a0083e0e0c83d32419897f83b5e6763fbd0d1c2e40ac8684bb95f60ac01e0a5ef9762d7ad7d48f8d650befcb190371048ba2b893472d5ca7461ded9a36435e9966473a2b25705762a0b28a70e3548a89f9c4964ba19b8e4a8fd05da7ec352b9f1b806c7e559952d6c0dd5d7d3c5033c8e5c72a7fca1aae295e1b9b96234fbf5dfd2497beb8413900b3b0d27fe62295787ea79f3b200a3e84c1069810bdbe89b746631587559d6595e7c7609f8468fc3b2a0f7926e70d2aa6bc23b939c47700337f786fefd27079286a0b9699e933be41ddba40c342a845302dd2ba534a7c5c247c3b1b3f75b84069b752b51d907443ff065cec9d8ebf5b693f0605726f58250df7c9a847fdd4c6b5ae296e4e49ae13a67b12ce1318d991d0c6464e14ad62b59f946d5a3104a891c731640acdb5d6be1fbc8b6f5cf9128a1abc7cd0352185de9f389ab99a6dc4db8b5cea7cd0edf6fbd7ca1f2b588a98f8061196e34af5b3b7ae39023977c412f1c365ad410acc55562fa5c11b9024bb0d3b335bd06dc188e8015aef8700fe2b4bc727d100c1405b4fa6f25e027a84d2037f24bcad77338bae5873ac1c4eb507baa0031934b4b8394c30313ef4503d55ffbe2ade66a69f6d5cdcd22d606a9f64b009bef9fda12646063a3682aa570e917d9cdc6fccb599a5958b7d2c577ec4fcf77e7f9355b8051af8915ef556bf0c9bc6db28dcf86a9c22a090e6b0cddb443919830cabac605623232eadf6af7a09571975442ddc74293ec81183f3c6eb14fdae23be63e17920067160e078e03f36038ab4260638d0639071f25b3bfe6fda27a50b58c18e973f56372f6b7d16b7652d5c6ab0c1a430e64a5a4f2a1582bfa8e8e8ddfa3f0506dcae86052f73169759b85a257a853df96a147a48cc8e03626e3d638743e2c54ce392f91e6365d0e61e22846b8d80cf26e28bfbc066bf8981aa05ddb1f2ca72c4599718d35d4ad61343a519f781a40d41cf46592c63e44a526ac2acbbd9ba2395b604d7d51660f7ee7745d00ac6d6e791c2dc0118f4e4a620fe853927069754b17cdddfb13011ef9c48298974740338bc7b2460a420cf984f0b9402ab2ddcbdd68682f48107c679c3b30b9564e3b65d3ecb99bd97e2a9a6ae03c746af891d6c7ff9b16f27477492b07c215efef762553fcab8f5164148608b642649f8d3f767cbea56af0646b08546e27dc92a292d3597adf757f9c3df56697067c9197710c579db65f18c1d39f4771b69518e2149fdb657e9ab3efa335b62a0b51f749d202c65d6ba8aaa7b951fdf8947bc041fac33501474e0b5cd725eed2b962f24e3baa99fd9fd6b77c0c576fdfbb30ff3a01002834f3fa18a3e4985a64b28cb62ed5677264ef9d85e7510d62ae6003138f8ca6b03b24c971ed8b7a4265e10658b3088728efda2a699a54f77b18dc25c4c2f3a8173de8774496d7507a3e928872c9f0a6c8092994202093ddcfe80b48a73e99d9689d95fae835be6c0b7047e04bfbc7c983f66ae4140266e389a9ee345943ba59733fb3708b3f59ddd6161e162bb39c29e68400eae1fa3f6d4fc820791824a00fdd5ee4d57905268ed8dcb6bb93f758bbd29257eabd01805d0b453012a1675c971442d73772b5b57812744a5f43c0577f68356d8a2191661775129bd8667996696a264f48f3279c4c28eb696756514601b0f0ad9450dfb51d91a581bddcf0e8ab90c3073cd28eaa33cde0c082256301e888c05ce58ef16ad9b43123132cb75b7125f113001d6ec549960269599bb7cd1a29934dded6731699b16149d77fea029c4edda9064bb540f59437d695f28945738baf3adbafd02e25224f80eb2427da7f440c97e7b4be1be2e28c2b9ce18790de826eea976cfd5bc1843bec60da2db61a6409701a3c1d630dc0c711ecdf82b81de2f99c715649490c4e515ba48a6804a5ce45991d6e4140a1990911bc4ed948fa73921d0423529de8c5af24f3a45b4c57d131b8cc996c7df30e57247fd8fcb96549b6696ccdce6a1b8b62b1a5f9655904ae5aee1df765b2d1ddc53e732f0ad743bdbc9446be8b6ac9f95bc90060dc16609efb8ca6e98c368adbe69219969319de7311e3d10e69f3d1fec4e0f0b8a2d2375fe1822e569d843d26685831ea7c16c1996b8138c7edf11d6d0000889c74abe52b37a03866d3ba156de3cdb186d5a5823ebd2f52d85ae918bf06d29c294ab85ebf81c6ff22e6ecf947f3d168e92746b143c90a7121772dee77497496b520dd24c7e16da9fdc9d3aea3d6af6aec6c53e870db31f75f7006598b12af22c78054e6d0a55504216f1ef68640e47a4951661c795c993387fd5e39a9aaadb65c79c790513cfce1147b4838a1724aaa9bf5865a0bc9c6b3d697e6eb211ea07a76cc394375ecd08fcd20b918b9a02560798b9285c057039ce2e79706ebf62160490353fa44e2ff87cefc5d1d8d640a85db95eb1410909ed5f429d4f0a271eb4e87f174336d25413ad96e92e4ab47d8743baa506ef27a07893a1d6547fb713e3809aaac736c6208ed606ed90a3ec2727c1c0509dacc55d78034669045869d18aa710fb049aa24ae28fc15ce574aa56141240c1d46c267943162fb0e34deeb2d5f17f635c3dacba0ddf55a796ed993477d8fb2e7252d2f62b47cbd7a2ebb33a1db1129a716710e363e71d134ade2c117fb5915d6afe62c8b06e6ebd0be71ba6ff4eecb6f756fecb6c5b8e5739e2c8c953aa273cd792212cc041ec1ddae30005e2056d397fa2f3e8190526a537159bfd0c907893659ae4e7a72bf8df1c9e622d3bc550e7ab47eb0145fd701d31186d3a00a82114371cf2c1aa53eb11ce373f62afe33aeaafe3c2359ebc3b356af5199efe3ecf8ef03517101a1a8073705643a810dd56154edf379fe436c19bf3839c7cfb9a93ccb4fc6f7d92f7916d1d2bbe561da9ac7d82d8b47ba8f35313f29e89b53a805b4e5a937d47d2523e58614f308893e64d7b2377deff83d116f936c7c4d42d7e08ab4658800dcfc30b557574d10bd69ae9e643b339b4d9a80f372dff685f1b40332caa4ad8b691d434dd69855e92178cfa7a600f4afec99f3a2bd92fd0a6d23c4c4d4af1c9770c6382b22f11c8f77f7bbbc94838fcdd9b166014ddbab526d11b95598f7be11d839cfab859f69d74eefd4d85168933db28870efcc5368ab0414d9f1ea718249c3f873ca1ff1bac7ee09fab9ab58b5469453cd97abcb5a237dacccf393af7a65a4a5878304fb83f833b3499ff069c7d886914d66c1c8966e1dbfe273bb083291ff8637518fad3f161a55d2074d2be1ae55a8393f8133f7ffaf01eb331d20e679d08196f9e14fa26abe3af0155839c3ae21120a16c5ddce4271e9ec9e84c9851836b3e95dfd57a40469ae4750a31f87cd7eb4952d90dc5ea70f77091346dd90536b0ca857dcdf2987074bbfc75326237f3d101f48e8dcd65534d1621a2f601e64db90a94f2fd2d56cc80e85f351841e0194004b294e87b78b36f1af7b0a97a747a0546189080a9e325d58f790131402e834558744a65fced197e27f8617967aae2fd0529dba8bae066a657e3a1da712ead47d68d67158668b29bf56e1800cebd1e3777ad3b8ee04bde08f2827e92bee03485c8849f71e6b67f563aac6db5be8251b4e1e359fe9873a64cb1143682087683fb923d8fb1f5e6c999aa5a6a14df61e14f85a84ee22b01a3766c7694cb2146729a2c1d964dce0db742fb5b06e75705cf57204fc178c3debd99376fe6ce46e32465ae921b7a0c45a603d98fad5ea333202c217e6103a0deff10024c1d2bb7165e0a9e804c36e1336f019b44b1f53444cb9d6301016ecd93d9d494c26ec7c08906b451ff29963e7be5c06a614dc72a2a3f2f05d2d4104b8f7b38cc8f6b8dcf8bb59dc24fa541e66984d7eb5786e4ddb4671a709a0eede183f578f42fa9c7526fd9a5d2524c9954c960731b4e862ff9363cce6bc4d92b01e24e2f2890a18ad0411e324b0b5893d1455e3cd1264f650ef66ccca3b9361caa92d312b54635c1b3f9f4fd6135e7dff272c87a059c96dc85fa70e0aa4b31ebe82858a9a8ad94762701f9949b009bf8a0c9479c8d5bb15468ac8fd53b484197de07d141f1336c60d22c5505fa6931c88ac5a23640b13395dafe8e08e3c7d8673b1a6746365a9261db6720ba839cf2b508738dcccb3fdba342408897f6b507a3305ed2370f7fed460151cb921b94da02509abc1ef4abc87902d09aa256708c8f7c9de521fcfcc40b2dac346c2b929fab3ee28d414413a683a7604b86102380a570eb5a878ee3e055b8e71fc7b0424938216c4f31cfe7110049acfcc2aafce17abc33dc5ec683bc5fd29b50341528b1f60a9339edc686fd032407d99253c4b7c64a46c988fd10753ea29851ca12ab238c1a7b88562f0a2304e0a51f9ad41e6f998f5cf50c90ef52d6e089ad3e3c19acfdc40959b89341349ae4a10d32ae8f1d3032b915df006f8837e0fdd0ce3f1263eeae1df404ab00f48aa72fc0be671f7544413ebbf46180fccfb35ec47699fc62623d851aeac223664bee0e6f76568b9e537981b2a2d8f34d7657c0b7dba49c3c18475a1272f0c90b07ad677c7880e917777eed727c7dbba80abbd7ad476cd19c060748cbd33dabf28bd703adc4b24e90022afafdbe977552d9da1885177f565db6481358d2eda3959775aa03e03e176f606b4aa1984ccfc6d23d9fea31ca12ac4d76840909b698c0c4906f2a44cfa2d352c3c91c92aab60138de88d78df5cc03ce2c752490f17828bd3c1de756bd3907b7bae8ffb24db071d7edfdc43b2e0326159effe17da10b59da29b79d0469f1cf3d02b611b3bcba2285da8940b11f3a1633010aaf28398610f513499c029cd8ec2b33f85294819a32c947f2a27b8c28c22e53c3099ee7b3303602256ff15c99523ca4421c5ac128edaff92b8143d686a402311260b267c4fc9ef167005d82da4f3c532e2268be661d30ba637f915431def4766ba841b388a49c63dc14507001bde493c02312263862b00d1d8bf912056122e69bb10371ce22d33ecd8e0a966c7c40a622e82bdd0156bca7db68760e6fde2efc6f79585f0eda465bda0ab6a8ddf98551289ea4fc7291d339f81caf15067d650200cc54a4b3bc3a367caaa930cf3a2734ba963111a3c99028bcda6c1185d2c922bf72313b7ba23e6be388ec31fd79edb635957789a581a8a14a4dd911089adb4e86e72fb9820fa9e1f2885981a6b229b0f1bb7a20b2863d1ea1d3fdf6b2729b91c8bee5e70f762ef0dbe6560e0a4462fb748a5918a4c3ac66715e83d1c2a9f55534862262c005fa90733815b2a1058408bd7e4180e5ccf0d7206386f508d0ed92489227d9378377985f6d1ee3243740fc89b1ff8809e529a8850a0ab3119457d32cc6c69d4b70705fd883ff03b4183fd2972ceaa2f25b9b82b82c5fe3d38a8152e3875c1499f272a0b0ef13098de96e466f2aa254c0bbe8fe99ae2649ca736b5ef0c78ef4f7c5d8bf040b63ef34a71ffba5a01f48fa8b2e294a05811443a8fa468e6f9978441418e503d5b7cb1445e265cd350f1c5ef70eea0a47e88c8cf8b7ae6730e525da6e1cbe01b4e04624454a538882539711827eb608b7008271ba623ccbd5c00c6575bd6af5e1bdb78d9eed37773ceb4e8f1e3e7825a187cbc07b042c8472647f7bd3b1daa99edc673494689faf1ca4865d1afec30ded8929eb499eac448249e070b78ebe7d631a98a33f5c98b994ec6c76d1842ab42059b42c4b3a4f1b2f91f1ebf33bd48b5f9c1d8bd12d544fb84271d2df343e5f90b085a7790c80c9eefaaa3c6574ccf63e5ff1dc7a92f6018c7aaa9796e4704aeff3653846ca7987cdf6788aa1a8c4bd0a7fbfd416882124347bcfa90a7c81becf675e796ffbf49c3a3d939d872705ac682b55bb5342f2a47d6d2a55b56f8999a41464e602e2232ca34c21cd01c3f43c7d3a770ec56d43f027be6eaa50a019dfd758f3e7cc0187013794d9f3870e6bf1132c4310b395501d2aecfa2c8a9ea2c71193f67f7fe586dace54440595426b2235e6366c77d9000f076de2841b0fac27d6770e5779d023bc2f8f63a0fec6e2eb17cfab3d8424941b6e740958f38f5c2580bef2df4c7a39183657f89ebb90ffd44c3c669afc14b29dfab57a6f8b430a18f9f69da98de9656869d17a5243aaf751b8adad67bdaa5060373396847c1f0be205ae85bc65a2edaece4f7729855ebe6432bb04e00f75ee9800bab7b521117d5cba2674f74148ebf406fd41cec280819a0497aa9a9e36a81dc7b587e94ce2d607a9e8ab77f1bc77b858010d6b4f931c035294bd9bbe119e102ab86866f629796f70185e447a617d807c9f0e7a568487032ce12a698cae247d2a4a8e3f3a9e082bcf61eef5ad4e8e1cb693907460a85bcc7f4b5f973d88f2d78b1a1ea5e08a0a5c3190ebcefd6d44b5ad3eb7271fa0a789f8d1460f865cfa529155d0c98ce6953c116574e73442d3a99d2093a7e439072c616a2e32383bee6ce37210f1c2546e4026ee8299d59de729881b7166ea6c831d2232328fedd4bb92d2a44154c2377ee4251184f8c98049b660882f31a2e88fad0ba79e8ebca8ab3674d63d750d9058462b2fde1e7d1fa3eceab406be72ecb11fc9ad3b05566b89706481f68b754f3a98444269cfde8f1a8b97055005a81ddfe2679bc82dade741af15dbde6a659694c125eaa43418011267b270ff95d38bf26eb62c48061ccc256520e01c8b373918f8212248e9e11b8efb64d052582930fe7ae92f2dd080074679d751848873ec5425a5a538c1ea2ad9e6e0c83528ab2a7839de87ecd6d9f840b718e0259b6e04e7099f8ef96b09189beed221984d98ca2da49397db51a83548e1ddc415b35c6e300988ab5bec4609dc8c413981bf47863004e5d5afe74f69da4c8d9b268537c06ed23635e3fe79a79f05e6f7c736d9ac461b5b2780893b0878caa9c3a78cfba2ad2b21c5a6f451635f76a3d48ac0432b6c8ed1d7371dc54b9568fe42460d3c2175c66a7505e3b1d520b47ad0b201e0e8828f56eb29020cf5866a85efe378867a92c46ea7f6e90c83d8e52f15cef14750881194de924f027e2b7c3d8cf1ef044146b38d51d8bed2ca1487ffb2e6272db6fc711791329e111066940efbd9cd7e47a671e27e6eff3e96e9da4e0e4b8cc28d4e9ad35007da103bc56d1559fa2a02f324d009dac8208e60f6b6318085c67a3aefc3eaeeecc133f8c01a3f9c9265fbc18b83dbc2e5c44489f11ee865845ccd9769c99493ada2c19c012ab63f1241cb185c0631237519d25265b5731df7c41b856c42c732419ef27a251139a65c7500a840a42a44a0c340dbe34323e159612a878e97bfa3aa5f5d80a8df055d986ead9c9535cd6be95718a23f6d5df913470ef3b94786ec4c2bb4953aadbb4bb85d20450b2a064d2d2c9373878d67a90715edc7649d60beb68c0802be07bb7b1cac0546202b20e820428828e3fc705fd77a8218db2122d616c38e2227a147579a06c6705207964c508aad402250d863cd9c107e9d311d135ed32b08e8f25d3a894daf59b56aa335876adb57b7cc600ef8d512bce289ca605bc4caa5d6eaaf9dfa2d5c04915524cbb483419d7d4e35ece65addee7e094b3393ea22893180b8440127fadeb14f0892a4868285f319a00d4ab4ab5566ed77a4d9f0d9277c3920633dd1be2abbba533588aec3b4ca8fe0a694543616365cacdd406c627d4dc166bb8ebb728ae663935625c306d8cd071764c5a4aa3142859d60e683b454d70336a0b58b70467db887c8c2230f146d6427deac5657163f5cc824d688ebca8936bc2b412469077539da7790bd462219fb1137ad8591ec672709cbd949a2da0fe2bfebd4d673a18be5a4b3a91e74a3fc77448954c86772f814fba41e393608fc72b58a2218347e6ff2949d8c1a6c42105ce0f7c8b2b3457ad1356864aef1d5f673c5dec67c49bddf0542ced55601a7c3d4f5683fb00a6758ba22c934562d17f78f608d1a5ce3e170fa8a1a69e0c28c86c0a0a4ad06a25e5cecd5827ee0c643177144ff9ace30b4f1f455e844d4d747a69c946f644e7e907fa05be24cd44f5d298a19e589ffa1c11d3c63b9a3eaec561dc1d0e26cc8cc07a0b9ac50affbf0dee4dec12f7bc58163caa78ba03c92f5cd92e9a3b2881ad3d21aa5adb0ebcf122e7e3363d65de188967b8b3a035c44cd67df948e4f1110d868b5e9ee2676820c7e0477b36e1dcbd87318b7c4ac6ec61d05a7ea8dcbcf03bcc28b55ed325955e5fb988aa7817ca391d587444ddd7dce241a5a7b6b17764796ec58fa01ba11feefff6a85f8f9648d7a253b493c217a0738ab8576d4bbb6718151dbb0e3ac53c27d4ac5a788bc4c3d3399b61e1075fd3e61ed69f00a5c61c942fd9141237463910f6b0feaf139aa98206e1bb9022864edd4829e3091610207ce529d0ec7fcf4db11c98dd0a4fc7158ef62b1c31b148362806770d232c8f6a0fd00bfc69f3d822b130730a27207b95f2b9a211d30a57a352f09bd3b62640ce3aee14493b377285c623d8935f399bb198dc6c34fa0d9f3a562aef4b46ae57d4515dc4e1b2f529f5229d08106bb60f55f4960d9dacbc8e1942dfb6dbb329dc8a1d516a0c24054a395a6706599a2656667a3d52896bf7a79c5de5bcd32d742fffed31d527f1ed369ac08600b0bd2d6409a80d08b01ceaa4858eb4de1a0771a63ef6fdae7ddc6cde8b742d9b6a7eed4389680a3721d6276085c721ba97e0269379ea79bde320d2f70f52ba2ecf20bec849195735fda6d19eee29fe2a659e84861e92501ef8c8d94f6dd9153def5e44b965d8a5b38f7cb6f1f4ec9056244af30d5183a3354ceedd84a413378388c1954669a4175da70da008cebaa7df4f60320c34df976f7ec0dfd1e583eff5e983c93d94d30d67fd803b5e7815ecba1f79d9abf79c8e303ba5f86d3be93bb1c613cc38f1ec767672e53f50c6a79ceb83bfbd7744f28b63872c07f5c624e3c542ebc50f1f84af8b2d14e8c4b00bfc344d153abffe2eb97cfbf99fd8e64ef340623ca5ea776244d4d1c0854e22dfed996e68a82a2666e393aed168957864102e54f91368a9a1ba671c2bc46c3489121bb1cbdfcb9f27517f25e56a20c08e1a7ff1a2578efa24dcf9d32f99f474c157c65c456337f25ddf766852718546676d39500e587b24b93d3cf0895b7159ea3aee5126d6379d3c831876b1467bada0e9a445895e13bfe2f167dd6345990f97542c452b3fd7e9f88cacf2d33b3b5e824e9a575de406e108bf827bb6b3f9a0f553444e5b12705e2c619168304e0158e0b8ed6697633cd7825d0b5a9475fd5183be4e5543bd0251c8425c1d5afdeeffcb1199e52fb7ce4fcdb7d26ee17ae0eb271660d3594b12c2a891a36bbf20c0153c6a82c23c0173d1f2019651ccc07402fe8dfeecdc663cae75203dcce7504e23e6137b5170787efa357efef13f138949ac2e1a76128a24caa9203b1e1d0a303b1104791c572f60c1e4c24255f76ba10750adf3ae5d267051f35081c2161ddc42f5fd6544402f7b500abe2f9bd67709be2cfe0ad949be596c67142635358e295bff576c5048427efe1f5c0b2d1f2fdf13e66c6b00c542b91047fe5d6eb7ea8c78f74d9fb99fd67ddbd87f4bd482f825aafc5284f1cbf403a5188c57eea16e9b36e2673a3353203d3f04af7a7fb2306480c2fd653ec07cc2b93f0f4ee9403bc844f8a9110d6a8287a31e99dce711970179f1d73aad0130e7645d76b9f4df19292c54c1ba075733b7f979824a5e5ecbbd009ed41a74636ee29b22ece6002bd7272f314799e516ab41ed25a4d06c74609ed9ccb0d5b24cfcfaceabad0b662a4a826aba12ffae3c63c88c9a9f65cb7e416ea4d9002988807bd3582f144c849b522ac46f1eaa8a5a4e06f95aa0ba835df5aacd7672f00d08892c7ae79d29b38585b70dec2df61123aeeb221ce1c6bbf7664ba8684bcbda6c9ce321bef780d0fdeb63b4dc906ccca02291bf00fd683adbe8fb458f6e2bee0e8b4a0e2bc8cacdd020ac506cfb192881ceeedbf0103763d37fb80850f1810c38d9d06f7d7a8b30af89ddff2ce7c5a474c984d3d283e5f178f08114b6f4a1fbf517739a00f7a96909bb8c33db714517acbb2a5b69a3e527d58ff72b37220202c2e202a614d0dad2111db1682a8619f43d596189d15da1ec4f5c759243458b5ad9bb15fec136d778fa209378d6b6e7c828ad899c1370952db014ec53bbb547703911a0e007db552c44e44758866715e1e264d5c4af523dbef219a548ce8a1c1654d6548ceb9151a7cefa62eaf9297e82115f7538aeaf91fee09b2803acf5a1005f999a25b24d864a483ff0b344a51d101d9faea33083778cbb4f7babb18e8ec9802b9f7471be339f5df1a87e9de5f8fcdbb903ba013247825cb910591a4877163b6fcecfadf6223032812572ccf0cc8e3624ff7dc82c6231ae6e4ae207680f6165dbb659800d5cad539c121bc67741559ab04f7575e8369823b65207a963140428804f08cbd88ebdb072ad796e463e1e0cab5b1cee5ca3a32377674d5f3b14fa433ee5567e952b8b2859b9db91509a5a21488a6e2a9dc7d9957d60c48ed2dd20bd854ec2caaa571c92dd927480a10a644efd1470c4b0d70d37f75a7c7e551dea394a9b4de700cbf367c16bd9e8962a9f6dc526850df95d250a4fdce4803dbda0ce1a020e65d04fb67af649add53960e5ad97a4655ae8e7a83b355d7ee25d38dc6161b219ec0970861d316aa19c0a67ae9dddf9a058dca3af1dea8ad50e096672503117c1cb4d644b6fc374a4645e4cb405ce22533de8f5d0ab8265dae07d19001a7c28de14202d5d2f8cd96456516606cf1ea727a5103ab4de749c0f7b5ea44df8227b004b9e1cefadb157b0f7659efccaff0394117e5c83462a38c62d65c899da44095330ce17b4ca5f156531733254aa14e5e150a9237f41da091263c02b6fceceb27d5eeaf9f655c75e86b291ff9a9095a699b2b83053cc32e52cf078ab2682525eff18fa472a99aa6a57faee2b9c3ce0bf9aee58c1eef0ee46ceee1d2f1e1ccc0592a973aaebea3bf4cc6e5b131380f8c6179d657254858128a2b7c95c56c0d2b7f99a27374d4084a82a6375e41731c9fb392e278b787dc458f7dd653327665ee020c3e0a82b036eb06bf7c7a6a0be2701e322b6dcc0dff0ec3d1ec8a3c596c25a93dcdabec2029b9437e8549e6680369e260981ceffaafa00504a5b84548c7afd641c17f93d7f447b367f5a9b5340108c560550d2975db9e9f509f1d85491a76776144f0d7289613b5240fe5f442e179fc9bc8e336d3d847e39196d23f540b55e929f0ff37a4194c4a84ad7f06a782ec4dd48050dfceddc19a3994a2336849b763b00a93912e56691a621ad1d32f23a19bf025dc7707ab6ad951968898c1a1603d42e3d06fc4399e57fe0ad83158636f4b905f4f4bd24347d2a588815c3192b8b02f36d4805f3fa5684fef68d8d58e748247f6d71047af76ab5296aff81df96984b1ee17c33436d694ab4802c8cf879eabcb7ed9b8cc0342ce1e721419c4fc7d236eb904a1d4c930159c5154d9c56e866befb86ab540811eea52aada0a1f3fe155a83c249f77429c0ba36bf861c52acfede884556586a92a5703866593136f9d3612be28c053e0e2b12c1921223c39573e3b45ac2afbe6ef4075d587f5aceafb1320cb5ce8899a33b8e4f2edc059ba419f6e2538d13170432b6aafd51be33caa22d8cf2eb0c35ceb39f65f747c5c5f98ed70f1641f8b58ef439ec373040b86e061b7295c61d0deb6543a66b7c823460d4000b5446e50798918a3f8b5b5840941101a8e1f5a39e5e32fcb065e0e818638e729e660a9df5983ca60ef8747fd2fe850938584ffd9ef92f29fcedb5fe2e3313e07f3d021674f738fb76b955666e76dfa012892313e2155c1934bb482bf56fa69fc6f4dec8782abfbbba6f1d1fb1e154c8dd47797520bebb5757c7a1c2ea95446ae36407a3a6f87b22ef2c5097cf8c5f33c03971e0de07c1542d97ce2637527df0ae229586c936f9b9b29ad72f66106c2301e3ac60d5efcba71ee9a6cb79ec2595dd170504379e8f4f838f5d3cd56117af218f89ecf0265f09ed94092cf204a6d319a8fa0ea98a8005f41c28bb696b60621746cabcf09ca5194d1d5c222c177afc00333f03071600ca73589b3179ab0b2e505b529239cbe04f4c8df71eebf7a1e123a76c0c14fa05156b783d502af1fc038ec3f306ea226f6f60dd4ebbb9c35144656b580c7cff1c814ad5515e54a0901fd21fd8abe186e8456899124d2c36675f6fe06ef1d5ab1f772363cef80d0ff75c23970a8280f35b16e5b245625921123f85c03f5f6eb3600d8cba95e0e8aa55c461e6e950e2faf89c4c082516957e60b9a3e0e7012ff20ce6004e58d209af2ddbdc89f7cbb6a54898ccdd16d6f6bf5580abb7524d9b81609d9406adf9a84060674469f352fbd19ce9b77eed54e72cdb6c3a9a6e967793c5ce2b7be4131ad9ffc845cefbe439eae4917ddc65b66fb049ba59885e695bf90cc78a9b162e689a4046add118582e31eec0e3922ab8d00e942e2f9328492a34cff6ca86a24fbd642857a10ebec2ca4f4a7d9accdf898869265ea531b164bd3e159f71f1fff8b46976abe46d49db8076ed61cacebd8f721221326f8f641c9ea39a36d27f04a9eba4a520fefef71ffb46cbaa46fc3bab2789b4acebcd3dbd9713a06955f9626baf8d09dbbbcc3cd25108abd1ccbf609294f4011a7ae937d643933234d7df00d36653210b26ba71f22b607902f0122b9b62633426d55778237eeb10361b360c7efb10ce12fdf873698164476b533713cebbf8d7c4da9a45433a32a250353e7bcfb894eeb91b394594587ce470ac927875aa9ba5676a2dae36959028ba9d14b14a479dcab6d03f5617e781fb5a342bf64da0a35ea3e635d93225371612e94e72b2889254b02ada861ffd1112a8f9dbcb1974da35d30fd3399e69406fce60c09abbecdb1fd2ff243bb0b6a0cdb413d954e3e5c8e7f784f8753c3f57768211c0707e4f39c88d136cb440c99bbbc69943c3538bfb078c14ddb7413450df7bb32bc816a550ed7e7a5ac4dd45f4858c8524a6951138dd5dd698a3891e7457ade15830838607cd763592b1ae2484f459ae19afdf408462d6991509cfafeb4df2975bcc184a624b658715d6d82f53d8bc262e5ce9dc9e43577c06a127d99801dd48abd3c2ab452798b50406704b03d930149420beb571bd94fc77706ec5eaad87aa8612fa97e9f616c015cc9472acbf22ed775481b919f40969319ceca0bedc022c0e09585133fad4a223eb1135bfa9797b134ea67965fa9021556f99f8705fcc2347d7ba560ff793bf5c1b0f5529b8674c4b328cb03d5d85f1ba4b4499f7ad973a962772f030621ef178de3f2e21d9ec083889479c511de8e1d807943590bf8381343e1fcfccd9e23f68c51280a89066695c8beb7abe1ecc47931e001d07c9b6683f5618a8ac98515c1c3c31e9c1dacd8f91e59f8429d8f125caaf1d580240c919918fd10d490bd95ccf000aa26723e5ed16fd764781771f2eb0861c07efc804a4f9c0bc91240014a065dc578509776cc9da3f94bb31911f20b5662968e717c16f59b564c0d4697852adf3812ebf873030eec7ae3d95885054bcbb758aa751957a8e21f0b9a89d922c0f14a88ea5081132fb4480f4a779b1a361370d19e61a7af61e4940d84304a3135cfe08a5dde9f39ee84adf0c0068d09cb175e3d637ab61d993c0383b49f5affd935af10f66fb86ce8c73977ff3a60e40786a99dfbad422adae7109e82c11d98482f25e8ce2988bd8c3ec0de4c69303b7db6920623fcd9193349c54a7ffc3c5078c436148e96264103e4028a47cbc855899a62413e473944cd12c267a576d73d6deb0e3ec2c00192349438a4b4b418ab22c2553405a1a0f4ee0de40e97992c237bb269bdf8097435879d3b39c555d43d2d1dc8f6b79adf7369437ee960f82a8f394629399d9ea4d3cb9cea248c38a2f6b8b6106177dafa2e2da3d17cfbe973cda49869a4f3ed72a76147968e2c1373885b5ede7bd7c691c88ba0777f9fd0c33e9bfc6ff2db12ebcef65e58192ae9cf8ce22a4521cb1ae76040d54d2219cf060804b81ca99832fe8e6244f3044aad5795c7d2d6cb6fc01a77dd503a27f5a7f7dd959f5bbc22c694a775f4b5479e8b539b6328cb29c8b736730ee7b96ee3e296885f86b3ae49b21b65168830b5ee2b0254d790cdb2b1357e7b3c6eace646281145e418887b760de481ac761b0a0ce7c9f766e9c918386e09864525c6a9d92d9ff3a6a34b14de5a7404e44551627b3633c1d72304e9a703c42d4e9314e15298197a8d1922fb61ff773f00814d120127bcce65d7a68dfe67d15f7c58dcc344692da550b12bdd61f9d4c0e83f2d917bf7b3d200013c4a377c5384bd498d2ed653989aa5b7ee24fb1379a4ca0912ce39489680064606e6fb0379ac8faee963daed885352a6142e3b3907090395642495cefd06dd94052a9da8d42f39b4b5f703543585660edee016156b6733800f3eca483705e4395500c5a3f5dc6ed388ffdd6fc30a92761d3eccc7e19cf3948052cea9515120461dc0d3488f46d190d744943c0a2f07c0b55d34727088b971dba9e1ffbfe894dba4c63539427c7944fab810e1a51d08a1e6a5fc62e495e472fee20091d903e84c67b77186a4c9e6c0b80c816c660deeddbc28f08587619cbc5fc548f83b5719418790bcfb49729c6da9b6f299a6ad70cf25709355d49a1b1f66dbad32db365d73ea0cd0fb0e995294cbd030a097df12ee1c18198cbcdce2e8d6e86813ddb93f7b2a7de12e93d8c6b8933a82191418945183b46a05e3dac0843b2175ce75e9710bc2832a0f7ab9b85b063f790dfe87a1dac5a935812317c5b13d493109169c15525b3e4e644d958f688abafb7bb69066edb4997bbc3db7a59c6ef2009791f6ab6c091b0dbffdfcee71bd8a1d7949ae1f568e63ce6a640d789c2aa642d9129032d0efc1a87b4967b7cad8ea936c304b4566c866877cb7837a4adabbca801cd95fa215af5d7a548a2fbc3d8ec4b7385ff2b9c7b63ce243b461dcbb1694b0ae040d7c20aa49c2e63f9e7406e8a5d67d44a1703ad62d4f87fd65da151ef9bfaa19adadc6f137d02cde8fceb6016f9a659cd12a656647169e252c2278bcc05bd4bbc264f49e41ce3248b84a44077c8ab945b31b5cb62d0ea7596802f594ffac76ae97c823ae221d622f78c18b889e237d7c9a804cf29aa9b2ea99c2fda808505482c15b737e6521a7d02112b67d1afdeec0f2b3ac01effce12698a2148ba6568101e9dcc04266d0b0a599af27b304599da50a971b45dfa74ca634a34baf4317385f52e2a2d2f6ca5cb4186b3bf473a7ad891aeafe3fea8a029ae8dc68edf6b61e508a2803ed0e8776fc7c1370eead2c762196c32ef8e197dcbd2cc11e596dbcec903e77d566826b5b8b8e1cdc0039e047dd718a2dd298c2944580e76b9d2b8d6af5de8da32b17485dffca7c5a0d5a2b00baecb518e27bfc414090689bb2df709d0e8f4e2cea3feb7041fcd940d71f30b67a735c3f6bc0d1fb30043e62c9cdc707124d5d71a086cec65e790e62788bc2eb8a2f7a4823531d484b230e6618646966c36b768bf9b9a2c73fd9bd7d196af71b012a09d1a8b032c47ad31960a96dfdf74404cf144a6f9b91cc4c72fb95f88887e8b014de73092aa22019bef64ccf25b84dfe16d239ad58ef9807d46830a12f7e09be2133f4ea43f136d81ff489a3628a6f1530265413e932377230689ab32a963245619bb5c95469e2889102eab3d162ef66bf49d9f2c368e2b40a467111f1a97c239a60fec35230312786a57c56f3545dbfef6c8a73f3bfa6559a4955ec24469670a19899ed613cad3a7d831b6acb97ad5f756e8ab292a51caf512a93c2db66830a3d4112a62d405a20688f8c3da9717224353763b8c3544b725dbc2cdf5089eb8b61170bdf8a86fa61ed1453fb3b760d05c66f77a398fb5905a663f4c1b8828ccf2d7180e321a655d6d1e4077fa14e1edc5f2d8e2a91a7f7b386b5377dd9b695b279a9afd69620eae695ecd9b8ac70c5e9002519bbfd2341e3ba7fd8af394865386f1dbef2af98b541098eed8e0d2b9c087c918b9b7526ec581cd0bdccacf8db304beb2e3173ef880a2470543b15e0126a84e9218c827e065624efffef678528f0867edf36538954dc0036a127ab063a2de797d997fd2cb45f917a1fe77316be7d80b5402e1dfcb32af7080aca3333c220647a644b5169601881b2354add49fdeede6728e444e6337feeb77140f5da9fc041b3b17c4a4e1c065125d9742187899ef9295ded21db5208656e6f0c36789501f992690532d19ea881146bd647113f9f08fc32611fa16969470d947d4b62fc960282899eca3919330be9449b81da8f2ffb974af8c1a45ba5dd87cf0aeded2a7386fdaaa895331b95fdf99632c78f457f10e862dfbb46c8b650fabb331d5b5e8cf216d0b81ec28bc526ed597dd43727136df2c4f61fa5d10d5d4aa33db72adeba647534e5881a0a9f33fbe62ca8b9c199677950015425ab41de2d7328a553f2637e64122aaa3dffffb1b7606203a5ffae19226f57f157ca0a85d145c8d3d3be40333eb6e47bc777da14c20170f4fadeda592dc48dabf045de7e6b1446aa69b4f69fe1a53388fc8694a318a5555964563a632ef83b77eb27107f5069773d9836ecc8e994f438d6a55999f1ca5f4bb1407a826406a15d28c39ca6617e333140ecba89c393a3b17180339ec775582821bd446363d86fa143217d8f41af911e66c1f4385ec433fa0daea4e8a5fb8aadfbc56f5df175acccc1f4a5ffd77cf2b648333ee269fc4a3c19eaa4816dd05d3eae7237c5461ceb9e7b198895e5abe8fd19c3333ffae4d39c7acc4732e833332e0a70573d38740f919f1e76b144ff1070d71315ca1b1a519d1bcd3ac5555c293336ff2dc86a9b63c225e71062eb98329b34ba7a5c5a707765b763d112efb9669bd20142b3e7dae75e0431f7c27ec919d0870be804d9d98a4a283c52960e7d7ed26c58f50437438c6288008f3fcf42601413d42526098e30d56cc823e67cc2af7c1d6620b92e387b373d3ca5ee1c4e6ef8807682017f7fbcff7d4106268074dc92ba2d1ce2bead380a6f72608d2340bef9d55cbe9b3b91c7b009b85b562966add493fbe1a75f5aeafc6fbe3fee91752e51e925dbe56d45c789d2407bae72fd7cbd93c8d91bde4fbb10c2b134e3c9e27e9b5accaa7795dd9953ea1d02d7e7667ee9480fb874ccb29d7261fa8a4645b575ac7573098ce36359c45ad305164b6909591464f72d8c2a93fa164ef3a913ab3312228349e8f6e6fd2fe0e5700d4c515399e8a87cf9665b75d51969b4e70fff4058f35b778627d817ec2c9ae778b194283fe64ed10bd3fe067cd4440d508679ce9da1456dbc2978bacf87aceaa0d6efe03b776470a1b65b27ecaa1d44281337c13d625032dfe142287976328b919432fbecae3362606b0f81002f4f2908564d75d1259a5a3c138fe5baa043cdf8d7354c3d1a5b7904b59ae142c88d650d338a348c67dbf897b0fb7158771b3a39bd8577f8d20fd7459444a4da0b584830fe6ddccb8d0e2bfa2d1825c7359a4044a5b347b52ebfa3694d664be68fad879a173741a4674c1b7b49b428a3d6decfb9408eb7f2d46e2992e2e6ca3ec2e333c22c321d4732fc87e0fea4fa4a7fa0b9f7a1f85249f3d9364a787c7563e8c3b8a241389f9fe2776d40fff07b49fee534ef5cc8a316d5912190b48a252110ff0a2ab947bc527271918164cc6603ac689fa3728cdc4ece1ed4c8604d3dcba0fe2dbef864d89e6a3e6d89965ce4f577f22043d65d495910c1f23cf9e2d64a11599e1a20c8f8de0d4e63fff1bf45ca8b0d225cf279ccdf2d143c5b28f07c5f4908551e3aafe714450c5adfb44e2502cc0dcdea10e11d484de16869f152f75b5e93133acacf872a2d166b740b1133200db963de15fd439fab865e47779b2a9c21127f729e7463803ca4ab7632a33848ce28c8a8789d0670053067aaad3e1e03959f505604cc4df0e1e6b8ed87eff912a6adf72d2489f3f05bb36b4be135d13264f78d7f2e056766cac60cc42ba7694c2431fd80462418d6f2f72ad2758d1c82844e9a1ad6bfa15de752e648936dbe2b77a48b7989be2e2bb5639c52c07d4a17ccf3c1cc663b4dc2d5a39e2cbc52547c93d9aa0caa43eb255d46a45038531fcff14bbfb0e9362f15902fcf9e2654243e3bdd83cd546e1ee5785e54838cb28220bd4114a783ca15674ea2c6c98af27c5e846253d644f8f09ae4eb46de2887d61e3fa28d934e5293882a73ef085dbbd1ea28217a047b749fb782b3e0e0a5092aa14f049d8b9b900bdcbc551b680be9e703e1c11dacd8e2455b1ed0cbbf62043482f187ef087e1abb03363e44052878ecd10086b80515e4a4c9878c843c33e569a657acaf2969de2b6542c02e69dc1da215e131731501bcd3f72f8949bb11e1aed028fb3036d841762267c035bac3d274f44ae259a8385f18109e9dbeb996c84f6b202858f34fd2e3fbc5c3e552e9c71bdcc38d4cfc7dc1c899ebd0352f22af383deb3473ae04cc98b534774e42fe3b44b6d3d76e128c63309465561ab28e3c47fe255a6140c6b7c3752d21e3842b3109089094c08d0a66c538423e273234a468ca75915988223c86c15a1ea22ad20f8ead31a4b4b157b4452cc1896819b2b8e2ef0c87d051d65373ae15be99df4ba051b62fd917cc6c8cb8c64d8389db156880aad8094fe8746e42e9f32f109de26fa94ee0d802f8c3a3cf4be7977f06b88c5300f09f842b07bcd3412e7503054f82fd01f9d141dd67719d985b1b3d946de65a8372cdd4ca0e2a94dedb26edc94f6d540b50e40317bce33fcdf2d923c7635f0087ad3ea340cefb9518afbfafba829fbadba675605fd670dc67f67042ccdbb06a88a8c1a41d408445046d7b13da40906bbb4bd27d7c0cc0fd48df8af25ebb9eb5ad77af512efaf895a5075071271862c3e3a9ac2768504709baff9fbfef36aade12b0557fe0026b8ec82164adb7463bd727f0bc59dd994ccb8c0206939afddc7bf4eb52865bcc8703b9b7770c143799e9ca49ffc07c883ca8689c5691fe0beb371456601336c572069f0471ad0417936b05fe6f812b03f8dd47aacbdd1faa992d7c8871b02297db1a80caced2330df1e6f412943fbb62654c1525e9a92f2cf1f175ee4e2722be73e5473255bd968a6729ca627f3044c91b266b156025a986907549b861f9c3ec61362e1785f78c102f28179d20bab938f827c25b6a3bb0eff80144181ad52454d35bc3872a5eaf670d744a3743fa9cd320f92f68cdb7848e58335e739ebee597c2c3111be02ca7fc79491e7221793eb72b79f05a73993a67ac7432c3da25571f0507f5a598d1b1fca8c6cd22ec863f6cc531608fb4874ebdf1d841b0e5b44e85d89c569fb4933c94cc5217dbc6bb5be7b6bc69abf94b82a98038d37e4d35b0cd8593cda228d038e880776fcdd0d9eae6defcc5ece5860daa7a286900b84fbe89ab2cbc4a3e43f7297ba3bbe3ac80afdf49d904019aceb98a19f79d3657010fcaf349a676a41c8908899ce7246b94b21b7ecc554d35db62b588a7060cc7e3261492707e99d6bf91b684f047c3c4803807a9c0450681477e12187f19673fa5321b32f367fe678b4f4bd8688cbf412f580604b6bde25fb28789e58060606a9cea7f2a4a1722393720cc4a90f479b08a9e5b3ae0fa4fa4ae4c51cdab598bbd1185b805add95a7d2e07df00b6616c807f59514ea25b1149ae8ca562378dc7bfd55d846d7af67561634e57a99b03a6d165c064f561c45f4c5ef55ec4fd1d739bfc9792f54f236763d350fa3e72f526e1528f3b0a0ca265041039dd8c59dbbec13c56f5a2ac5d673c5da4926bbcb5c2dd4aa72c0dd09f072ab8d18965b43b9b30e3ec8d6ab16b9eb8cc6d2f442bd626175cf44c51b477c4314a0124921a698db6a7a0193e561cf7c36ca30632002f85fcc5c83fb52c5ea59516d822dd3eadd6e0778949b7929ba8d9897b93e08a625618d5d4d8c8228d6831fd910580e1f5e99783c72bef9b13561a27e8fc0321f53584c7918d77b198e1183014c582c547f9b48734394017259658d76cf25ae24876b50bacee6513ec502a20d52215526f5f78e4d86c665fff88d52cc3c59119cddea8f74baa6c260748a32d3f30d68e992251dffc752f719c8a5ab04769bbba40510a34f61cc9e8faeba3f81ef3bf26f79a007e652cdbbbdd52c13a4398103f202fc892155216ef25e661123dcee7e6531be8f3414faed9e9580e4b8c609c6d52664f185da65e46db7d2ad9a50eedcc423ef85cdf9850b1493adf33f4086bc7b0a3f1abc915207938c51bbff62c2da9c629aae6d088e4e5c23020f7e2c859bdb7c6d23fff94f72c56464c9e76ededb9f8b808c3221f66156cc97ee7718720e9c28bf3e1e0a5bfd8449e352db1c862c430399bd6085198e9ec66e24f0e05ba7e3d039322afc4dd8f670fe47cc77225b90f73eb3118e314c92eb99a2b806405227e08989a3747ddd7f090877b4452518639001ac9e55d8f62ae67f9a17c672a4beccc2991d2aaf292b11e6abb1b2c79df730017225521bfd0874075bec6de11b5b3d1dd82c232f2d1405c90e754a8be7bc602d78b3e77e4d6aae78b5cb130cb2c6842b9420ab751dacf082f0b227b4d88763c0ccb310c576ca737bf10f629d566a121f6805a471534d8d316867264d4ec7155cbc8b25645b0431f141e707e856158cf6d29db7c95eb44c178f6178fd66232c14e9202803461ee8370d046f2d3e8ec73d21fc312e130f6badf39fed583478bd8f7af4e7b7e8d375141e916d416e7d444a7a644fcc9d0ba0d65f732b7a7371743652b2cdeb44648aef65cac3fd1a686ad01f0b6198d58b717628558ec21564128b54876a625710ea858b6f2e2f17db46273e1280052fc10bb18550bc8229cf2745386573a120fa51294a7cd22b13018d247c84beb51f17a05bae48bbfc71cfa6983dc69a3ddb672346f15314b9b49fef7e31e59473c7dbd3065df5d0ef8c088fabd40f374ae8657f26c8638fa62cde183294b9bba31434f5ad767d5137bf0a204dbdc2aa12bebab248cc7e979c409c3325ac2b22bc45dc9756b278e41a20e4ca8aaf3ee152b3252a993957825309a874f204035f8635d4e6dd2a67315912214bf27a097ab54aa7f715b4664338f183ba8cc552a0ac4bbbe799229165ce0cd71dcad4d1198308a3d73054f6522a296b906f60038e679a137fd1f8ddbf6221bf7ffc10768b2d627530a836870666c6adb009427dced31fc98bcb8152e91336d739e9df82dbd08c7eea7c73c88e2162badca9201ad43ad36773e0cd921cb57cbfe9d8c74d411603ad72368ccfcefea7ccc7de853cc1af3b9dfcddd0cd45efd9d10dab70ba29dd0486982d9d50278eb5288af7ce234be31ac8b8165a22551716f5f4301213e566fe6c1569347777bc6d1ad281532cec194a182b627a7da3ba4d91d6a7f891608262e40ad7eac1348162daad4716997e3a045d6ec9e314181cc601c93e6eec7f167ca9013ea814eef96a8fc6e8c22a396783e9c85bc247d65082401aeda9054197c96b54f1383ced8105e1a790ab44a7aacdfc5b05f95ce8084e3c40d372d67e964eedde6f9f732424ad986f029b6bab5eb949943f42149ef29d8550b65c33c35b4b144e169c05a08e2a6f412e4908a3951e473722bdd50291cd9ca7e7b8e3443e150ea3619ffc1930915f1e882cced3367b6bc969012ac0fd1cf79f757832a23f0a9401fe6747915c472d33b2e6aa370a147199b7a75e90b15545473836d31c1fbdcef407c1cacd38747458595c842893ca07ccb9c990432cbce43612f9abb314b4bd2092ed5eebd0cbf7c18e649678e41260e7315f8c982863d06987d6d2e2f62f6a7d2ad78a43b382d013bd9b6c2dda8116fe27b3fca5085225a2478d9c4e8e9bb2090441ff4c39fadd354aaba830d60fcda0e2ce75943769340556d366f58b2a1882015f0016390abadbc1946c429ffc549250d966016f7a7fd58e2492e47e11ebe4209c124e90af7b6f3fcee4794e3ae0fd914753e48fef0db11848b195e5f07017a7911e6c8237ed7a55d5b575a363dbe85f471a4d2541f7cfb336216db77673d97a2ecf93947cd4063811812cbbb2c07455082d467e911eec2e772c0aa6b2c5b6cc5c94989837da4037a1ecb67d024b7f9aa07c32db18854d7dbdd12eaca92b1e3a17357a5b6289be811fd12651bf62a1e2af51cdb5238bf5c5922eac09a1e5d45ed3bf00d249b8a735d7597a8c4d87b7a038c5bad237e80d44fdc4dc4d72cc838830c4fb8dcc3415d52a1910ad159a1a4cde34f887baf923b7f24155c4d141725c6d18f30a62241c1cdd0690d7bdb96b26442af009031b15a8aeceb533746c3c51611a671174e857d80bb5b0e6413001e2e1d8a1cbeb07ac01ee3bd0444fc563d134465e3b976371aa5f871214a18ddbd0a27ec1177ee7c0117c00a809ddd7c62c224b390a6d8978d486ecd484aa8ed883b1be2b9924f84f363d9e8c17d7499222aa662aae956600af7d0840f2e1df2e855a76a53a2497d36f00eca4918bacb8f585c1ebdc1b51ab50fe3cf7a5e498cc192ff0e02f5a433053433365370efd2bf0732905d5836fb15b9c1e0a7e2ebc72310a9c9c41df220cfec17c9097fc853abffe0ffdadceb693e5647d525d6957e7843c4be367b3fde08db152753edf869b090063d912c0f6e7d5b049fae4c70834ec1a4f751395b96c12d0ef02e83d58627bf1f4e90a77c6e65d0a8d8051c2a3d31409883159fdc0bfb6a0b388ed3755b0f11a76a43fd19730078ac452f8008e9b779a1ae8ad74d77304e69428b50de4b0a39888165ad8730e61482aaee81e46d08f63567c0eaaae0e96a515d2c45bd301e7ff569f3a9efd63dbbe270b67202738c5af1dd2d3311934b7b2d82dd5baf46f54990ab9cbda33b0002da84171e0d150ae769228a3bb617d201edf53d08448bd62ee78ff519b32dbdf65f928ec18004c83b7499a0b1cf4c4173398976095c8bd2b112f864d74bc24be58391740488ecefd2a84ad0ab3df0b88317f447eb7b015732ceac5eb372c9d1bd9c7747d7045a07dd4b8007743e477c9dac5416c1a58e96a42254b1d04471debdb6be1befcddbc0db7587b33690eb7cd5c09e9ef575496e594b50803d0a45ca84d29b97f1cb5409951d6e576d6a18746d5fe53028be812eb73e67f64f36e9d3e9065871b8de6b1378fa036a3f5d3ae477f87e3d177dfaa1bdf68a841177b0cf5b1f648a897be0c583ebf239ab4820c9ad64bc0cf0d2240acb3fdf8875daa9e09d57d72f5c7395e1c24e09018fe36b85c0a8f776154b74a43b4addda0f40970db6f931051a153f277dbdee91a4c47edc7d479f03d398ce5030a0cc9a15a47aa090160b631873dc7a69916aa5b4149da1ce7f6e03832beee8384c19f917c5854cb65418d50a1b581cf1dc4850038b8da79c697e1b18492ce9d5374abeae4e73de14dcbc3b30971ab30dd72fec6134361db9845eb16df8c65e75440c321952cda29fb6b56b6adc50c50fb40e0d433216e9f20e3810a7af5be4a709009066a9ff62dbc746ffe63443ca6776e2b17a985560b602566d9128856f46c8d93e176b9d8be2c0cdb03e8fb7aa460bbb8282bd38563c3cc4a97f444e3bb2e828dc2deadd8a5acf6ed2d53ae70a3fbddc54c1b158653a20bcb2316f4e758396fb61702ba1c0c55490bb6d5d079f59834b6816eadff9121f6c01960dbf8d2704544613daa6e95fcc5173659efd669ee14936369b8598563d95b70f09d5321f71aa796137cac348c33f1a366e70594ea1d88bd3a8b825e059a24edae5aaa421fa88db4fdd385e4561df6f88650936f10a87741af8da2030dfa8395e443646bd0804afdd9b2232e6aff5c2d0107eea1065f372a97e758b4872d514562bf1279cdb8b0c3d6e412975ca81ce4ed5640dc52a2a6b502ef460bbd6383a65c138ec2e6c88f3385f916db155a2be6b2ce5a9c1ff07befb77badff88821544bcc71fe3837322b8348dc2b33beb6328f52053b50f80bb00cd2c9983b7c0a18e72815b1c71ec9596e24abd6c510021a2a7660524d03f0e272cd7b59005335b7b6bdcebc7788034eda906201de70e170b13d33c9553c82c9d56f39fe89817b5f1fd2d40a523a0f9855ffb23fb89e213dd15754828cf6f33551a069666352e82610f0f68c7dca5c8c5e34a74c42a38ba2c178e84014403bfd26d571d40cdc87d7536f4126cff2db835e57b891f4cc068a5e01fcf3ad7a7a878cd95b3a5cefe42b781a35eebb622e92b38d41074f503c71c96cbe52eb54ee9f7f3e76b29ca047d1a3029c526530692535cc46488dba909e66e4b6d516265853ae15df37a51b236e4c96782e0efd81deeb1c4448787da65a332a4011f56d2db9eeb5854207a86a7f950f4bb7839783ef8557b864cfb9e1ca98c33366e67764113939f95f1254b55fb24b07840c99d3e38daa6688649d59200719fa15c6cc6f7d7cc241304125bfb69e90461fe95d94caeb8e54c08b28070053e666235698b68375bd4f6c7dbbb7a83dfbeacfd0b5ccae3b95d7477346976ddcb19bb0afdff1501d8a696a240b9ebd0ae8eaedf3b4ecd87046de533cff7eafc97cab7238f5e6f1181c5f6714b22a84ab25757c27ae06a134260b50f8835d28e728ed0475ee7416aaae42439821154451ef77179979cefb08fcec34e591f2818de572c9f27a3372d76ffab54f2b17ae696fbba7953c87217baee321ffdc68e6ee220fbe9361441f997675c09f624d0a60d777d28109e6905d1dc5fe72b68c4f871f192cf7ff37ed24084463e47f6187cff4ce23e9a07ad93aeddc6648e9a54d0997bd06457eb6c45bef14e8dd5893ad5c979d4bfe841f89fc35546a57fbc5348fca64a01cfa179013a1442b6b431a21c1ec2e02b2022c0c9b6abd501ed3ee5755c0a0739a9f51fa1477be139cada05800a34c16bf9e4640ae7fd68c26ee5fab5dafcd360c9191dfa9ffbb7fc0729ec2555f7c0cd43353bd3a393fa1bc375cf583ebe1b7bea6ae1713cfccc2ffebaa1f8cac7cf9601a9a7d15b75741073521c523ef86fcb6b334b46835c8854f0c66dac44cddc14221822162402808cbb5996c9ec3d5d4cb3b744a5b41826b3db636cf6c3acc05415f5fe33045af2d4b814f6b7d903eaa47930a92bdaaef6b3dbe3840ea12e907507f5da639bff59ced8bfdcaf6c2fb54924e69ca792d3b277f67d3d511356ca3c8ce189170ef70c079cf9c9ad8446f24dceb61a54a1b69f18f813d6dadc34a0a744c085015ab9b296a610cfd2c471016e299fce1449e11e9666f6eaca9b86d914c4498c6169fd8bf28c05012c44c9333e1b8c07a98fbea7487d3112877dfbdd614f05ad80ba92dd56fec34c5e54e2da7cca7e9065daae3552a4052755ec25c9b72c6e46639bcbea7998406173d139fa386d17e176c1fb425a42a61a8d9964449be23738e7f3527086fa28ad3d7ff2bf8849d7ed2c2770c6395a2af9b1c43ff5abacfba188838dac9489899e085a05c4e37e63d44e9ffc979d815f1b9dfd0d44a0c5d2214f8cd999abe8ce534c743d04af33b98dbbd1fc3e641ad1ab2990b0234792ed0a870ce46c89af72fdd76dbbede4e447ed62bbf77aa11c0fb57840ac88910a04f53c63cf22e40888d03515a32dcd9beeb9151737aa15abd01b39e77b3734f2aabb68aa58143228724b0f143bfa858f719a27727707394dc8a7ca4b42f8b3a6bca9a22d76eac2fb54c0f9ed079cd3686931f6e95aeb1b43740cec7ea85e0985fedd2242e954d888851bef45af139a59231415fd0a60ca3fc0a955933354f2207d84c32c092c1acabf06ce340d1f19e887bdfb9aa5c8038f35b62dca072fa3c837f30e9059eabf5b58f3553e5ba6d5228324deef2adade201685f6d09c00bb1717c6de4331ad9c0420c314987990b3931324837e0fc877172bc32a2488ae23271fab0646d27672c9a3a511a4cb454a283a52bcd796a1408ccdc42e9f12119ff2c3ea1283a3e0114c9f6eb07b94f0fe811e1fbddf290184ebaf5a4fbbf7f1ac9b98d9416aebfc65670a7e8e0949d96886afc131618e760b0f4a1c18aad6a18fae6643978d588f3ff3c3a55c5c58d63cb03bdf76f0928cf82fd96371fc2416bb0007e10fd4984973d74bab82fe72319ef71af1bfec373ff9d624a0df7e49e489748498343d088264e78c59530b8ba9b9257da0765335bb07e795c42554d844a0e0e4c488d6914c11a3262b68fb73f9269547874f0bdc30bb9745e35d0a83d6315fbd309f3f103f34ab39eeb777c25551c769fe590d04cb26724112375ddad901bb5e1c4a50277a1b7ea2033826cd34f2702f7dee0913813b606e0d5f1819b2696e3a624f587ee83fe259a4534a34008d40445483d078a6d05dc15c824a663880fd91ca0dac19191098f2910c47cb57d4922e9e6ee7a20ca30d2a054ea524e001ad8bb126ee541be503ca73630fa5776c65b8426a8682d463a3d14fec1206bd6c82eb3cc479050a411660d3f4450706d305766e39fda8ed82ab5ac36a64c1a305d8528d72ecc1addc62f4fae124eea0d5d64309623f2a7ac4444a4b39d1f2efb8537341224a8b7e665426b73e68b585e04d2e772624f71b7ba157e84f9d9dabd2c5ce8eaedfb12e5a49043c57b377895d9c72152a6541607290fc14f4c9b3c430b4a485f3595741da7309afc9d81b539ac8ee04676046e2da2935f1f339371599bf38061468298bec189c566687adb89f8bc11ba9a8d5d9554d6cae4d5ded617734e75fab6a1887af60bec1af2f0a9c6fb3321911563076be2630f2c57fa639e8deefcfcd541088a81246af334881eef54d31f00022a7b268f72a88c4da217de569c0a2a0e17b66de986df98ff61ed0ab7d1881354c99bd50c84eeb0041ba5b230a0833b4a20fe8b4d7e248d4341ae00b1d9f00c6988f8560b46cef6a1b952797f425a81ff11130ff347288c29c63846fb5ef01c2fad08aabcc3b4f0dbe44cc3088a353e96b79645efd41e338fa6ec637e80cce8c59b4d0fd281039dca4b3409f889ad45f4dd9cb03edf7f90dce1a0b10fa21c7e9ea13decf41001e851db2f20c3ae8dee2e246033ce263bc54178de75dc76608a51bb2c840156bc5be67c3669604c7efe43caad3cc4885fcfe7444269bd5acec10a760f8a04516511f4435e58f4b298ac2945f55f5a8f6d1e92c644b05112ffed0ae437ec88a4085e54b44924ce92d0439d460b6ccce843be77573dba7b46745de91b5c8bee2482c74d46d066e7c4c75ab475fbec162c0034e0c4789a6e53cb1484d1464944cb9f072ef2abfac88ab35c5c23b93667d96f6868f38266b98ffb34e32ac0456dd8c7bf47e22cfd083d3d4a5992f750a5ed52afbfbc1d5fb70e525e9dd25bf772950dd6653566b72e2dfe01ffdf70704ae2fcb252e4de8398ea9d53b8a9d0fd6e54f4211878ce8e6cb06ed86e872b7a168161d7be1b4ad37cb8bd3ddd8bdf67258f4dced115fc8def4b2fc33b0cc02ce198e55572d155ebdee9ffa393dd139347f1393ea15c7da253b9a5910f287d7a917053259c37ea21d6f42e219b988dbc2cd7887bd12226487654a96893f2eeffa91876507453e18e6cf4d2ec8720ba3159379b7e7438ad45e442d44b08322f5761421eab7b8ee36245730b81c84ee013880a8be6467b090bbb10459686e64b81784d6ea36e3e16bdff676eb2e84081a53b84965a5178aba43293058e859f7773762608adeb5c3dd05b52bf9b6a510b570a392efd3cc4105aa62193847356f315e9804363662698616aaddac54c20cb47ed2e60c08caa300a42ec37fb4cc488a3e72840a2dd0e5a0b79cb4bc27da23527f83e0647f5a5603848ff5e983e74b68e42f8537ca8e0fe5927548d4f4b15104473c0235629ebe002e7e387f9d270d09c6287e411f4da0c68f6cc29a1d3ddb3e9d42356deecf4fed0edd3c4eaaf94dbaa6233b3eb8e39d807551fd0db35e0e459138841821ef53403b5f4ec55d5780bd097202bb255b3cd0d854bdc838e117d3764f85d15722f2aa8143fdd0557a76ad43458b8e021a9306fe0064908ba0ba7b789f19448a967894c1a509585a1e7c22b16daf5305c060cbc43d0527d222a9d6a5e2451bdb96d709deaaf6c7aa7a8e3c752c1e9cfc854c2e70b480d215bd80820d035304346d2c81e32233a6836f11ff8bcc37eaed145858ac2787f8aba7ac93043b17c9337e4991ec315485422396fdb00ef5d82991b001233a31e4eb98e281a0c901aef22917ca611396e7b6bb802f0dfc15ec6c9117d5d7837899c1392bb3d95349b9ce9336b3a5dd7c1c28188d6abd21a405568cc75dbc82d436c63376308c342d4b7761c5b586a849e8c6f44f053e03c519089e4dcc9abba49b0be6f05c4431cbeb74ae3c3e95b785fc306e4a81e621d9ba2357c590e14fe8efd8a37343e5d01985b7327915b24ed1cdf84930b4685a1aaad8d25e1d26b00ec2799018bde5772e9db9e6bd864a87f521bea45477348ee6fe0500e892049bfd839cd1acf1b9f91bfe1bd7ad33cead059ed1f0e8fb0e411f177e283e0db021101a33cdbbf85438432c7e98a574d2aafeab13115f0056b977e3c172c91c178f877826068aa15a446c89c0c9069212b5ff62b4042491ee5263c71bfb2450bc0d25910e310c87e00e056578545f7af05a4f28472d91e86a37eb3636dea6815b96a48185feda5ee1de505165145957e58b434ce199894e5bef4607e8c1602d092654838c8c069385914a91a8825989a9664c6c339d9730c8d10e7914baaa37fa20d7a8cee4c6b116164229dc6ac98a9fe0993f7515add0bb3fa005100e11f2393ab433749009c9b28b6d8d73fe2fca8f0078c011a14f39da51f1018f75071e86a4c7989a6579412e504163eaefcb6a8eae7e95e355812b23867d4a3d4c443d0bd3220e8cf4e48cf8ecfd5b1e05f6da56c9c82efa50de383fba654a0d9e3dd6c52f485c36f798d95b94150e2e253e149f191c5dd58857468882fe89fb4d058610373ef11207a18ac5bafe249e8d2c098ba7dbcbfbca052a4fd5f7059d84ee61a063dd70e9f62ff7e970381a0744a60034205570fc006a425939d07f63c7f6ee278f5b1933f198f749a6e4ca8f0a4da04c64dad69248e9739e08e41d8e5d653ebb2c8905e5c5eb7f1029de1e16bafe53997325cb6f5ef0e9e4bb3da4d8e9a00f811727306b5f70f011b93b63776fba3d0ac318fd249fb95634322f6eec48c9f99d360ce77ac399efbf444c89f6636cc31c71fd517539331aaeeec2b86513b4e6aa4f258dcd55aa3f03334431b81cc303286c1f74f083cb2499ae45510082912261f6ff271cb7c6b785584cb39189a2fc87d44782f943f00401520fc6ca7fe6dc249b59e691b840a89c86a7a6b9e2a6298c606dcd7c30300faa2b8947be640fbd9b046b86cfe9edde436a1a1f7f564871c853b9a050c71d80e32bade84d37542144394256a8ddd840105f663e3ff79d8a777580c27c72528752afee713ed11ac152b4993b99c2e7a679c71b85a5956dfb5e3eadbf60ae8c533e980728384287010dad301d27c0c691205c6caddc73f76d64f9a53bf263aa37853bdb98497df52f736a0d9756bd4a4b78d9eedb3fb3302a9e36b2688143569573df7a047aa40f5e59d4f69f212d8b896a7805521c04c1f80b5aebd4e9a8619d927a00acd2527e8c808c1651e6efe4cc4d53354556d9f4aca43691cd9cc8727f764f7ed95e30be3f6ba464ea155fbcd0efe6b9c7d4000a76e39be82533dcd4e797283a0fe9d168dacd3609708eab54ccda4970639fd23f67b0e90eae6a165db01da2fe2703b019e4afd727c8087a45c83e6ff469ed916765d1e9394bb6c253358726aee8ea9984f954dd96bc4fbda343e47d7ffcf91f0e0f23360d05f97ca11b68dfa25d817f4be5b5240acd8c46d1c6f33b5df82f50215701d7e909ee6cb5e4fa6951508d8a2cf31966a061f9e6009c84447dbbe5a0205335b4343ab456646199f1fd19cc9b2e17c75250624bf79628743fd463c356db9c75de5ed77aea65cb07ce5b542fd25669103a75bf3a6b351c319003a90cd96669ad66ebf65a58115130ef09caa9ec0dfbcb99ef588e491ff2af79be1aef5c9a1653143bda0c9597f86fa702dc42c2ddde2ff10c76c3caaf715a767ce4fcb3d6492de7d556520e8428af5d6df5ca5b0cc481ecc9c13498c2b543016e95052bf94a73a093007b610f979d6240cd4974ed79acc97f415a50af27dd4e576183dde0b007c3c752cffd4aab8079b4612a2e86e28d706c5bf6f6f1211fd587ae7b7c5caee5e459a7d30b4b26615a2024cca1d778928f0d89b2b136597d8a986f9593e85d700cdf0d8eb8aa8b51c23deecd2b04fcc9b8b42d30173736d3596d9f60c77747a327e7223a96b4881d33fd0d349ce70f7adc4009ebae8c6027d9c2a5cc9c59218a421d5274dd59a5be60dd87c57bd82cde7a730ca72b9831806a8783d91c33d4b790b5de273361842a8216588f97c87e67e23f06ce4ffcffa80a83dfbfe12d045c277ccaa841bed32790f76b3701738e7050e16eef7e4a18f052cca44c6da82a8d25b119e7e0e2f6e5ce389ae98f116670e4bbb117ff32c1ca9944068ab660301be8d7b8929a598f032e5d1754eef5b28311cae7c5b553145088fa6ca574ccf0ec97da51c3bf750e7a412828e1d9b3e8337255f5463385b7fd26b726d2390651010d921d87adf603356ec30a708e58909a6058c5dc6f6e41e4d2f14460d92542e1504766e28d1b4c95374e0d51b3099fd1141e0f36e4b05c3e6858c6109879fdb77271731199ef5123e11f52719263b27cab237e4292f1f4f3011df7fb782319679d118ee5dd1ea414d2c0cd3e3787026e4385ca9103370eef48c38544df0925c8767910d07813e792167c42f3d80b2b36c955e92e1a6bf45ed13fe48ef28167d28a123c5a2eaf135ec759ed95328032809cbf0545717f3728d45ecb3976cf6b8baff1c54b8fcdeb4d17428590d9b9a239d84a676f7182dccd92ec811eeff83eda28c5398955e3f91f595c376396152ed3030d5c45427421d948ba275350303928b071e5cb466834871c9bb2a8dcacc993c9dca84403a784cc91d97a7a4bfdc22400058416fe2582daac6e96acd529fe4ffeb93972780b3e5f6d35d4fbff2dcecb4d3958bf74ba1e4cedbfd166b888dbd74258c56a22af33bb8020a762a88b981f1566ed8db921d2d2ff72c3e2108345913c47b9711fdd41e82cbb130b9305871c06810634de85a3abd651f3cec6e53df2b86b3396d2ac0c9c0330264f9febecb63986547a85d99f45bdc106e7c9efd7c4f7933cd24ca11bb8e0dd4dce8c14e2f9cbe6ee572de8dc972be59eb73f218d745c48b61830d2e05b2223e4c123086489bf3c81c1e158a9accad086c32318f31b94ab6922769a639cf93c30af7515013fb1109507c2a84265fcffd900a28acb67c5178a91be073054b4da0a4f52f1e50bb1123439ba858df262ece7eaa8fc99c48dd514ad59e8b709943dd6b1c9186f0d4a79b004df76e28496cf8ad687e0f7aefde5059ba3fa35d1a469bc222134c7544f75c555f319299664ecd82685e88809f2b6c6194ca9d51745cbf4011894d4368668c6c83e81060cce869a66028e035ca566c18a1e6824cd8d1518b02817acf27190eea556a61fd0cc7600fd831f6ed70cf3b2c0e24f0d9760357848f122f99eb366ffb87e08d6ab587a2bc384946c8581915c1ac74c23e6906512b8ecba5f1e6efeceb2bcafdb32ae0a3597f178499a1749afbc667d2e45da7beaadad0ef62330fad680d4187400b26bda1f40510a2581c717888d5c436ed1377f9613f42b7a64b19638af0b810218417571fd0ef295d9fbffeb6291dff363679a6c652541fd904db983d9cdec9c669ec3fcefb68418e4da63f9705af4297c1a5cacc01746c838d7efa13397dbc8c9f326ba5a20fb333f92d0b9a7e86297142a2270cef3c7d49d273535dce77615c6f3b3f8e9bad2555c3a9f73f97d5886245ad66ad8a2adb72a795633bbe0af6bdc309309e49f97b660282fd0a37f630b502a421340d18e3abec57b9475605dd13d773a3745cef4568796c5ef285fbbc0c6926ee5b788642a997dacdf585cf50039fd2d52c1cf5853bcdf8a64f8542750f5bcc4704c92064f345c5ea6dd87297c5af30306b781aad05885fc2d3ff5686e9075a49a2808bf3191bb30a430ffbc5baf011cd57295629586cd45d528d5712f38f0b3a2538914799fe14829a8847c38bb53fcf8214dcdad53f69d0482e26fd4661e7435d14e43ace8de4d201d822ec8a29d901d3c171b84ff1942dcfdb39b3cab5af54b0ce5b0df77fd13a2984e1eb38811c46b1e28b60c7a2257328ab9d1f64028becba6a27f3081a31ea2e87e07eb6b36e280fb02d81458b16067c5d1aa75cbcf3a89cabf3181a26ce43951e384764ad7ae5ccaf415a7620038ed31bc8e1875b1e5bfd6c0d9bd247de0cdfa34e3c15851e4f56284e45b6d2f9d657d46452d5725cee6de432f73dc91a34da50a3cc296b6fd3748fa44b48c90fd5c0a3b6b41f5b2aae780448711edf98883dc1837a5237a38a594d57cd603dfa391b67da443ab59d1077b33bca720527cc7a6809fba726ce64b323c04875955f3b12d6828101a0373e03effd108dc241e65bcfeb59c5119b65b5d44dad46a43833c63f5c5c58c00d9872b2ceb7de413d755cc44163a80a3223e7e73ee2ae137e9199cee0fc10566e27a79ba4d0e3f03944a4d112d3f3165b2be3347fa4c81ea174e9d7c19b2b6edd3c36b2f60c046afcc7f8a0cfd635f34b270e1e98def046f6f41d3694d04759e833fbf03bf71c76ef398d1e55f6782484abb18c66658c8a3bd213c4f0f63868977d8ca7ffda1c2a0f4c9b56f7023362504cbc79fbab9b402a58f380d0541930a79b2a45b7a3f95b6ec9978372f515bc702427aeec2ab16fa248d19823f4671f9e5ecedfecb311ebcf9c562f32626da8a94a190c033bdb10c7c3b2551b4d3fac3077589784a284d9d265dcf3f7aef625f0615a9967519f8fd10bfe13ad0d7c38df52aa15f0546f2255aec9ea4f95449896fe24d66528cd1147cb4ce186fe5c4d549e475dc83e55002016735996c415c3d5983af9dadf8c2b35356819febd5e881f229e84d883079d0ce2dc9aec221ee4d3e8815107de79ae78959ece97dd9792c5be1d0654981e022bf70b42cecec68dfb1d0a4e1ed2fc8c60ea0a4a576bf1718f91c182a28accb34e38983d910600e652d9d949418cd5353c725eff05cc2d840c365e0e6dae3d70586a11c82fda13e6df6c98b7628ed57e4e8cda6f64ee39fc72e026be05400a8170c8bf9041f71e20490cbf5e3c0ad2c00eae70a79d90cc67e0f18a7abed21bc754ff38d0db38686820e7f6f5563e2d0d190eb0aec581a53bb69728b76f71b1165d80b8f437a1987de05532a7dce7048c86e68486166835c33274bc0eb0009c0a939a92ba4d177acc3f3cce9f5e06e5296e9f866f95e56df0a2aed5e9716e3bfa9b196057496c58afc063a07e54eab917f900f11fe6423f04a2ff66e9854b7207b4ccb32251d3e5757fe07625843622bcd9d43c59de9777b6d0edb5b416547d8358a9719c9edac1a68828223b0e3aaec6761a711e9ccd1a1d35b808454f274759c3157e5db5eca9801e27599ebab46e20b3f43a8d2d303aa2305ccf0870b1ed70807f559d60fb7748bdb3080451f630a0f7ed596a669fcebba312ef85a52ed8bf244bc5db0b65939187cd0eae5ce464db05052089a3ba7760e43bc6f229e4bcf10d192f7e0a67db190bb79aa4f57e3732249d2cc5e619dc54442584a0f91596e93eb1b392c9ba9462072d9ca08532290364c8a161d1e164f3fee30ea0eb4eff73abb01d2e7b4675fc7b94928bbccfeb80e7c9294edbd9c428c280b4f40d35eada7f5dd18574e47031a48fe4819c62609c2208477070118070bb0b9e8e6a10784bbc38599591f57a33651e1a5cd86520c3d63c572112ef510951e5b3b044a5747b6525c8db55422b8bc24ba9f45142cec7d4f2b451e578216fc291fd27f81940978ff5f89689a916464ecf29a9b88ea051c534c72da5155b2907bb8b09fb914fcccf5194a37fd39f4053863a2ab302cc803e5c05ae443f2a1dca2becd21fae8d9ad58c725d5d49c9f591502075ffc8610bb8e8e2305853551a6dba9327eb6e56bfa13b2e653e6e3ee6012d65ad3064b02de3a91feb3d0dbd2f9bc10664addddde7512c6fcdcb8ff8c504e8475c2d1177a6cf19107df51aef12552d027321c509bb4a840a78e09b1215ae1bd15f106e83814872412f3e7bb2e82aae4b65f6739ad4401cfaa5abbfa97478ab1738ce18ec89e19b1c964acc39543854aa5abeb590c5136c68afe0f98392be7b9b5b881a6292d7441aa7518b368e7baf4ddfa35ff5f155d1caf5f9db6730383f99cb5d2a5aaa81421a5e42566110937a6ea6cae7b742dc79307e1f7dbff384848bcfbd6889af3cf43f58004706669d30c032ce3d4be1da75725d87da8de9480b34de4b4b86676a89c6ae1a2a2191dd93718119d07e6d30661d7f2287eb000255919170dde4a70ec244757d250c6d9e0d34ea7364d7445500781ce6cd48964d768a1b83c0eb86de3f0de5d539b242def6cb26e6bcf432a9bb8ff1726d79376e55c54281b25e5bbae61dfc380055e898693df92384aab3bf625ea06cf17a88be363019401ff35485c516ff391a10d4aa372a53b97d4917dcc00ceb121a4d07675ffd2b775d0e2378430a4ac1e8ed593da634aeba5461b18a036bace2573ea0acd1613ffa40efdb820a35c902e14c0b7d5395541f5e70efd9033ade21771f7c892842898b6f99cd88a32b8fb2163b1072c355f2fd76ee08faab0777be1f87c10a81674c9ad8d79e72faaa2c36b67400a0e83ced821b513507cc8672e952a3cc541b950ac06dcff004fd999da0f430e79549c762cc724b89607d3894964df569b25268a889579d7e38883ce563fc01a9cf192a0cc5e59d92b797861f200dcd6c622008e7c3cb5485aab2b9748ddd86819a281265b59a07b6746bf14c6a55f7947b8a918403487f39dda1155154f7832fa0c58cb6c40a95d6ddc1ea55c66c5a0c89018c3533b66ca42c654049726ac34a3b65d95d5cc1aeb905552ef9185f5b57df298490fb78a300811e3d0f427c59a92e7231891f50e55d5598305e7c4cf36133f2d0a112a03c9ad09c0dcd61e82d466a564b230816775ed119da0db1352c21570af443bd33ad1218449bd8bf1633b16e2149957a126e679a0884d1095fc7a2dbb83838aba5e57f3430df223d66cb2c634d7f72d5097eb6d91f4b3f6df15969b5f745b7d0d11d6146a8ae37d6fae43536ecab80e8d88ba0a0161be94f822698679411377cd6f8e5bdd56aec020ac40cce97d11937834004b9f5ae77d56a096958205c3fb7e3c890ea718f84283c95f2fefa515e806d125d93f11d0e0e8ef407eca35744c0af71b66d32414938834ec16b59a28cf0992fed03a54e9c45ace80ebc1dba191041eab16b9a0367bb3d5fdd2aa85136143cdb01a2bcd90a05c86c81db737b925a9144af6aa7fcf445d3694cd7b2dd58207b12cd78b68172820b881d505643d1e56714b00fc569c4a084a9b1819775ab675a26848c33e306f7bbf47964fe64a703b79a38e144ce6b234b07bbd600fcfa101862cd0c4a2e24e9568029aca81d17d23bc7bb4ae58b38410494341398204d8e692fcf84a2f76d25f9c6b60c74c84198fa4ae1444410d8cc3c6a0622f1c38a39d9288eb3e0977ae9da43ce677e336c9e10e5efa08f4f39b312526bc15d87b7668565a4d5cb419e320f083585fe006c59e3222f0a0ad72b0c2fcf97e2d4c4e569d592b4dd69fb38a31de38c3c8379b209708391eec1f46c582f484b1524301117c2606a883790bc1a3829535755c79a1fd4c58628d22a5b7fc587c39a60141fc7096368b5fad1ce804c62958dd01e61a75edbbfcccea6416bec18c5e6a08c241407a4b765ff66efd467b24ddfafec60ae959d32840c00a409bff65b3e69618df78717c1b6bfab3e1f639b4e60da301850e3aa005349637969dae366794bb919993d115b70d7054a54881dc0bab2013db7b1027a1c2f57020dafe55d6a6492b12f6b4f70a0948fabcaf0bb476f3bdd86a95c676039886557a5cf9ac3b389db495ea60366eff2944f2419197dc407f47f5f2c88e3f03970c8b2a13095ba80e520c1a139bb95bdd2e012a56d4155ad1e3c8fa6340045f4de4eea2e8d6785b88ea1d70b12d0118f37d44d7ed3fa85d357c8c03b1a2894c5b9ca620a3c23d448462c630faa20b0a75e00764b8aabd35579b11f59017bcff05a94bcb5d770122ee9a33351e1b0a1a0509a83be2ffa02ec76f642cc8a741f63adc30e8ab1b2e0285cc7ad7a4a96d77d38a7df6e2f63e4d3993f54cfa10200483dddb8599790e70aadf718b85b428c8e2d89b0eae651f31ccc0c2f3b4b6b11d5a4377300c93cbc601b986043603a8bc0532255870b1529135da3ca405f6f44b2770319490b99d5f0da76bc985e327554ac4e3bd3d0378c5a46a95fd8539176c6f7ffd80c1735952534f82d7c7abc5394906283492c938eb107dcdf73aec8da49668e6592a3297feeed2890e209256a810e9f68cdfc0ad0e4b28822221448dc7bf2e8e179945f78bcaa885929967a28ed84c3554ea7281e4f59ed89f7bd2af016fcb2a75a73dec1965cae0ba7cbc31933856ddf5d7c1e40f3e5394a75420a6c1d09874219c71b4e390024aeb456a27ed45b5955669bb776abaecfcb564774059ff4e29c1128903a1b1389bc7f628a6a52f357151266ab110676baa8418088191927becdf18e530477880c01197f0453fe0a03799da5decb4fcd90333b375bf0c5b90504f46a78efde4f60d9bab6ae87cec18dd2a264655fe8d9ead3a102181b66a41558606c0b12d7d16e991df102202e76a488a1553e4d837a0da4fde8bba2c6cc1225e6274cbab847d5d5fd37ebbe96101ed3a74ee99dab28293e44878f4f26721a550ce18920b539c5bea310033814e0140dab908e24dd52f6a62ad36792d1899c76fe9020f65ad5c314e912f05ad292480c4c88809dbcd5a0c9ae76d2c73bcc9063476832ae0b77fc1fd272c2756f7df4be8477bfa75b41cd4c84b77c0c0e5954d1d6a5d33ece6851f59129331c64373ab89ba8573b0e58af38a849ff18e5fad6472e63abb9ed184da20f76053532ee617a4cd7c3805d250a0882d889447e2dd5cb9e2e7e91ea5ed9dfe83ad563ef4d0cd4ecca28571bbe53b02ba24a732feefac10eec93b4cb07d52d79eaa2c971f6a4530c7b8b58a8d5d39ef269ec29d4488295500331b690a622dd921ff65315dc03c6efa9ba9acb7b0249586fda5928bd8b49c59db4cddbf79602d24d1c09865bb878a826721621a8ad5325f5bd26f111dfd3a719644869b8eee19a34c28eb8891ac0886d5b21a225114e1f1ee13b0125f8f1eecda00df53cfdfcd2525c4f52f1877e772bd989be7e8f87568cd468d990ddc34a74200643f70fae637f5547e3b5a02360d58445b63e6fec2834affd1417b5b8f33c59d3901f6e6c4c28bfa257ecdc8b34477ee4a490bb9c92058748ddeaf25d09c1139a5ae2e9e720de27ae3703df8300565b8c533358d675db59b3c81537276424cbafb312bb4caa8234a6ef0487adc531df480190eeb7a6c1866906fcd901400f9883c0c0c65d63c8416134cd2c3c8d71e12eacedd2f30dbdc7900ef18acab57a00e9614847966eb5c00046f40f7e4e86553503b9c38b0d6652f90b0a3e3879fd210836b64526659b9978c9a3ae03835f92f68dadaf6f0b7684b401f0fdf6b4729b44d0ff98ca3385dc87a485e23e5579629554c6605571712717405886597311b282be3b712747452250f560b27ea7b186a53edb7d844237a683af4c5486d17f176defa92014ab0015f82c9de52df269ad2267c14af6ce4ea6e83e445b751b0c1c09a150d679be9dbfe0fe7e9787a014a525b3da92240a7761096e5e08040cd59b6e11432d71452d0456121abe1d6bfedc24fc373e1a96fa82140706d3fb172d82c7cb5df6f248e7fb7e823da82600ef5de655eea160a6387bb41a8754629ea09d4c6268a1de402531633f3e79dbcc582e3c0ecfd9eb6c167eb756de7d32aa40753ab8fb14143e23b114cdf55598a064d5da85ac5c9e8cbb32132250356ae0516cf5b843cc1c870a219b963dc3cddbe4e886329461903ae9566fc0f6d94d4edca931923e5f958718130b26c7aa022ab1b5b82d6d13b5aec25b5b5587679b3253f02fffc7c338c21745922c97030f5098d13144734e4936b86333ce9ba42bda3d97f04254e46d922c311b530b9ddbc988887dfcfc3242baa860d6322ca820d664b6b21d3dbe6ddb86e2cfd813f477932d3ba080b0a15e96054c7df0f3bc410686d0c45eff308c32716180b9099e853eb4e495ca90307b2fcc77eacc7a7ec5e8fc2f640df70d7ac81621f7d957d9357994b7e0a7cee5c423efa2ce379e54420ac9e09641767ac7043c70844861cf037310e5a65dbdc2274a6bf766d6c38aa4a3c25a4f56cce23b00e3d92a7db1bf0c696e93e5dc092c1e94e23dfde391bae381b1b5c277c738b4e47c28ab0fa847e5eb3a0492f304d0a606e2a3636d3769648dc98d154873309107981bc07a028dacd807549e1e8779a7998a8d59d7de634cf7bd2794882283330374c6ece64bc1466d65a5b1776b9cf1524fb3c0ff1ab9d4f51fa4b256c0361c5beb03f63381876b8ddeb66487d57e884d866c49e4b5bdaac384c9b28f210be201d3b4fde244587aae7e70ff47165393d3781ed77641c121c88b386f44413d6094d0d29ca3c7524304af787639d6bfebccd6803be7d90e2b9f38ab058cf8a38ad8c9de565f2ae110c7ad1e469d42eaf0930bb752fd19d84f088915eb9e9cd8b2bc9f53496c5059f817376d8c71b12aaae2a8740d7b30a25d5f9947f62942a2cc0568b3dc4c2138468755c14ad2408739930f35d3dbebfb92635409f96af1665d924dc07f0e4911aa6c68f7cd3bd6dc2035fba02b1e65309a21768a204cc9ecd7067f4a1aa53e10cbbc6a0b479ed9284c79b486a2b63552e28d5fe6377405195f8c294e360c730eb5dd60917a27ec921ae36dcc6c36b9a925e99beaa38d75d76508bf1c6800b1dbc371be19669bfb62c2572c343fdacc35eccbaca3db5f92db3c99dffa263f7ac854164530b52035eab424f8ae7699975afa1f99f9ad0de9f12ea86f166e1c9f41f1d43c81758441fb426d7864f7e7f3fcfaf8afd9a1f8ff73e3d90cf2651ed2ecd00589527e60f2fdccd8e5b041ced5c30e15e24b4bd2afba1529f8ac9fd9479512610257ce9d05d5c232818f7a289feaea8e734a89f2741f3935ca29d51380aebd208e0df0c200f029ebf6080a986f02e1f370586e80088ce79dfacdafe0b8f6748c87887aa2dbd96bbaf674ae26848132fe1a692c80d27fd7e2084da41d2f1932443ee0fef5a0d9b40003c11f7657c1d553de342d2e3777b7b8066b92658d5377db33e368b8a550d4f84d515acb9faab1f06c593ea171276ac94f261ffdc2f3051f32ee00c7902f28700a71a7572cad20f6a6bcf7aa9a02404ef84beabaac34066b2e77a49cfeabaa9c01ac61c7055c89a36dfcfb51c4551fe2333790c6f5770eb3c402f00a8600c6e3b316d5d836e35f30fb8d74b512dcd9b80de414451e05480d826fb64310c73acbe23b5ab5ff6b12cd41bb3250950816b51d9511a0ed4c43dd8d2b4eac14c2627c2d34146dabb68872b9078df3c06ff921cb0cccabccd02fc2565dabfccbc78a9d6d0f284f959895b87366ab828e68476f100dbc8773a26db00bfea23ed56122f66ee336b155c3165ab5a54904301e27c9eeff14ba9838be0b2e98302c0d165f73f0cd303a8cc10d7ad9214591b0d09a15ae414097f8fa1199003bff1ee3c18350a6af0a1252972298fae4bac968d787f7ed944600ff2559d2addc92dd97f23a2026a385b999ca6a8d383f1289aa48d2ab6b2b25f02efcf9ef079e352f6c9f11062e833726d2fe470318e5fb4e99d783bdbd04950014c96d27950a28d7ebd6aad5ba1f66a18afbefd833c107d6f80ba14172ab9b660327c8b0d62ac6f76e20839eec0c628e737664550ceea95ee9b373f50f428dc65e6b063d548f8114bc3ba6a47de26ad8beb040dcc9201ad486190967b08ccf22494d0d6edb98ebb7a057342506b54cc4c01d843285d4b8394dfdea6ed1d88941ad3899aa1590b1b2adc426d7994a0befe250dcdebfcebe60f88275789b46e7d9636c1f70bad1d3c5ec02a8e87dd17bb529f11b86d1485e41206285984ea5820801eb2037119926c71f9e8a13caeadf203e3ca1025afff2999fcc2a2d41e7c127eadfee81f761f2024c4bb9bf12417a04f40b2cabc8db497997a2f60fad6d086045fe2851cdb55fe44902d2152612218bd82f1a2bbd0522c2c405efd77078be857773606c4a5f92b075eb08420e8826792cbad40ce90ab0e2ceed0524401d1cfcac8d8151c81420139cfc3610f34583625276624b585e5ad80ec72487108f3eedc05509caac30c14c0d8ba92cd2a17bab2aed43382802ac3df87df4c7aea3b481582bb9f7217d3cdcbcdde7db0aacf25349bf7fe178fee3ff553250c326d1d06e260efee5cb83b9d7fa03e11a6f60a5d94c345ded2f3cad5fb1f8ccfeee1eed170092cf801fe33fc0258e73b35eae93787146a29235a58b5cdd6a49a77a028f62bd7b9ab2c5256937fc229370b98fadcd06ebc7e8839b08cafb9833b4a4d8318a6d2a362d2b742d980d17b0a53c497fac29d6730f96160d6ed4067a7d8a487b448b0a3d99fcd729769d9e9d8ff8ed024abbd2c3e1fba9fe0d1e2b2c567cc9d218b01508ffff4529444cfe0176c748d098031a57d02987c2b8638b71a1acff407b77b6d83f9a4cdd86f78635e194da721adf4af6014db5c2197665e8ec122d48db74036605d2b9a6dd111ed15024089bbcad4533ed45bbd6f32cdc494165a07860d80aa195e23088f4b7aba8d626707353e2aec4d4e83896c61d8df913939e8e8f8ad8d22a340b1dae9878b8de86b269ea16c8fd4037bed0a74b51ebc618145aad39f5ec81a4287f9425f51f8141654086d412c3856f050a64be10858cb7f73aa2e9686778eb621c4318d44f12555b3e21d223da822bfb024772f9675a87b2d3ccb72e3866ba96075ff51ab21c1b9db71ba682b3aa0aeb36e45f000ce6c3a9c88c7bd38a5bc7e0ace74dc36f0e8c881b5a5ba17828fa71cec258ec4345dfe7e92d9ec305e6c8f1dd485da77622b07773e4b636e437183bb9f39ad0efa8f17f3f09e928e5996b05d33ec02ab8b923d2a312e95d8f61ae9161c60809bb6966f5342246b53657c6661cb4551a64c7d50df4448b0650dc6dab6949722a52475279d4b829879ba9506e857eae8ea50a6ab84e38adaca0b0829a917bc6bb2d46a5a970486568d032820778fe7facfff0a18aaf2db57de3954cfe7f37caf88df30bc1964e730909c045ee93293682b812276987122b3d7d35fb281e4854252713c4fe840e780ddaf31354a9eb254721c08f5d058bc9c671f30da53af717f510c0c60736cedc190bca76049e15c3326018a8caa3935d9e3f0b9bb2aade2139e3cd9a552709528c81508c2106efcb39fcba83189823444126673e5367f0032d96d13f08988cd0fab620f26404af72c8db8e5a3347c8b8c83ad862367524f78bfe2933f9e18a714b3b69b0c7f61a4ad21afa598d755d6dfa595a49a1e0a4f93fefdb1e35855d51aa222a756cd61c4b22fd587c65865930ec7dcfabbf59e55d5fae9be23104df74ce5f65adfd8e375d1a348b15b757d37daeda2485395f00d4420574482e5a075e5e929928d7dee62e160ff48c99531c086d86a8675705428cf47e48da9cb477a579d272db95ee80b2c53217ea9164360d6363e8ec5df8c812ca764d5caa035491a12cf7519d1aa54bd2bf08f9c1366f67d9e40c28732cca152cacc342159c33cfa9505dd7390ced5cce7a4b5c285eec2bb229d679f108ae398f183f1111c0f5c2336d4a838bf3352fea188e38004c7b243b1f4ff8a69782660f66cfccb8899196e2b4bb5a0abd6dfed1b75460e67075ca720cc48651241a4abe3015dde73b8e8f00ab1b846c539025603e26be5237881b3186cdbb1250a32072d646cb4d3c5606b0423691d8f3195e41475046144123a8c75c09bab715d38cc9eddfeaedcea9f65b552a709c1ea5c7bdcb59dc6ecb25169f0cfada2778778fa917058fc5562cd52dc88a786c76ec22678f226f212e737205f44ee702f07623d97fe936d44dfc792e8a202463b9afb111a9cbcb9d0214c224b771f9ca1d9ea8efb78ed3e9da2a5919756a19b5a02d403a2c6b9f6470518cbb258508e34f0536bceda56f341e59ce47041510989605a20dc21914ad968b7516b7fd5353269b2193597f17354dcb596d93cb3726ab5817b26a99e69810547fdab3236f679c515b418acae97f8983e75a84aecc5ef78d4ee1d4f9b0aa643129966d9dc8d510a95223120cee0700095c0aebcbcaaf7e19b9b0fd682f26687ab97f7822080c0746b48341857b9ff8e25b49eedad58b6cc3b36c8e10f43f31e4b2c58598e825ca6212963b811d0af8eae4398fac802ec439c8b4c8317d46f76a01a8c470e75b8758a5476eba1868f7b0b087cf6468034cbbc89e8536dc1bd62b047c107bb35b66c4e4b12ae862f56c78c8acc56e2146c81a669a0d38c5c8c723ca03461991db6c9239f7d8007cda580ea849bba8ec0521e187f7729393674969647a51409176c99f74d030579bfb803893eba530082160029eb3c7e8a7b0926c26183ab53de35ad5654019cf1b31a4231c6f5fb233485dfbe80305026b3cde09878671ab15a12d11b925e14a7b5b78b2133de6ebcf06e637f2b7d01e2188fe607f7e4c513f1a20b4dae9c9d8a1839fe5123c6efbcd23dafbe1e7d2741b8e187338ad7dd222d8670f5db82b516a34add1f0f0b75cbbcf659ab7d432ea3e6ed761af0dbc527d20c7dcc22cd513ab14ed65a6d6b2111a35eb44395c5ecfca2fdb2f0f04558f4ae94d12fdf44909782ad486a3e84eac559a5cd753c7dae1afa4c44d8d71384fc4eee0f524111574d33a4a56f3962464a131788dd253e6feebb213e4d94eae6257fbeb3c7fbe1a0e72cff3fbceca8c5f4397d3d38eb2c4d0fcac028d80c9722d7f7a8404ee459539111b8932aad033194090413ac87338f53edd093c1a1d2425e7b2e843ead91cd1d05836a45cf3196994fce90ddc15b01293710b7ba4963fb6d03f5ee293e144e96b3e1435c0bc9e1b303e9d46adb4b8b30ede47a97c0c75eed7a30f4d2bf77ad75d2cd394b477e78dad0dd374806bc857ff65c6c4e78704e5882323b3e8f200c19831acd0f7c8406b60360ecc28e3ec775a24598e3c1ecda8a48d953ca17b7efa2d946c3429c41ef197e31a216fce5675e25c66ba21c60a78b06b922f7ef00c97df477bedfdb2799eb2bb894710351e4e7876f756c4599945eb4352ae12348d854a8c784103afe2fa079678babea69aeb64315874c2e25b228557a21c075dbe9810dcbd4f914c6ca9e91283965cd02a2675ae5ddf88ceac1f16bef9ebae83a6c54fb0ee8c22a78119bdacc24acd148577eb08ccd653c708f0379cf1357af2962e0a33af72935900520ce769744beba16581b47d4f3e369ac1f8e4fb313acf5470779c33c9115ca37a615d07b29580e17248eec46f4f9df8735a5e0b78d4d3243ce3d64c221c450b2dd673895d0d3f11c62026630fca46ec960d8269fb3c2f9e3a082bcba81369b958612992b5abb83d5ce3874f12465b21aa3c741be2e473222bea271f5572d3c862998207bf9423df2079d8bc1ffea9101a6fbbfee7626954f13d74364fdf5ed69f41faeb02d57e428edb45cf1e5951fed196f623ec8b687529b456cea4197694322161f1e64f3cecdc41b08800d3638fe017f8d5a1af25c59507e30985c349724718e1f328f7d6b1f0b9b71607fe9362cd6870f13ddc408435c387ff877e7ecac95fd4efb9f66dbcc93efd4b673aa0279e0cc78d5d0ee4ba903d15d65948955fb879833adc5ca5cfbc87bba965e3938a3d582fa97d7ba3b273f64e0c17b7dad4f6764bf0741384b5727400741831805588ff27da9a68e3001c83d7f330c990d59e058886e716b51561cc54d9314f826d6750951445c7c1575dd6f9de6943c96f67bdd4e0bfc834e5dd8cec89e3ca1e70e515261aed0d8a72c726bf8cdd800c85168921338268b7d3a6cdc7adb35a563d40d970e47803b0b7636db0dda05d0afb9f371e616773e57b8d20de507a1d601660955cb3140259fc0bef3f4f7d004d3c5a1d5c0de5847e45b6cdcf5760c4d19e76ea28863116feda7573b9611626b8adaf1cc2e7fd3388cf07f4ca202e3a884e772a929055d466c5916053083b454e20df6e95503020c14c4dcaa6a05d086bcaa98a13182c0d532195deb59fd2ba519138c18f8f42c681570053fd3311edbb41c8edeebead5cbe8a005f00bc36a55b8bc5ba68414113e7e0ded289769f6ae950b933836b4cefd5d45817aaa41587bdfe6b602dda188a11d0863d8d1b19ef3f5e6490b091583c373351c267a49c68ceec69553c026402d30df8969160e5a74fffa172a6640c4837cc1dde577c3823b4e916a2720538c24f6d2f4cfaccfd6dec08136f7bdbf993f09a1dfe890d78ae803caadb1e138601f1d45cb831ead9e31b31efd68838d38960457d27833c7bef4e94cd7eb3906793f5ae6b21b734c9a1c6dbd150c066aaa068125064192f783032039c2943ea321392fb2adbf95f6da973301e01003a301b4665f6eb3186c38be5a153469ac1d164af4213bb884acbece9181feed676f9f1e01dfd27398365ab1020705c7844caf66a01e79885ab8e395135f5b62772cb95b0e092fe2ed0132567c844325fc6e725376b65a4c3acd5cef1a9883336afb2b1db19edc8a6a43dcf6b968daa89091d9d41ec32d046b4a324dd4cd964ac7ddbf6a529949dd1d29e8ca6250350c85a2ddb233dd738fae530d642eeddeb24ce6c5cc6a99a9a65f6550f859e35495f59269764447183404b9336149988e02f789c10a89ca15eca96e5b67eca2c438d48952ae4adc44bc166448ed0b0a488c1191449c86cc811a329b92bb4eec86721cb7d95933456a0099e1f9e5225c45a6bde9c84ed9d8687201bae43809d295751144c21f54ce5c2dc0bb9f15646cff1c3fe309f86fa0282328f4a684bb20c65dee5d56f710a14b98175fd94e0d2a4e4c7bc40a6d826be301ec32dcb2b37043de2c1bc943b444e5aaef556846b44b1de347fc538ebb10d7b22ed2da667080ab1f02fee31bb05cb4cd821df181dc38535fb82ebf2e285c64e9015fef43baf63f36332bce10037af948ea789d0af04a81cb99e2c7d50611c5fbd485580353e7f63f6b847dc564b3c0d92e1a059d5f4fbec05762ea4fd1454a2c4f547540b736c0eb7e409358382b22dc4fb5d2dc7e6aac89e01d556a850c6412fc40a5149573d95b65d1a7580e49f7c68c2ef2c59723a5ee7629d336919b1e32ed2601319eb1819ee4a5e956116c62983e4c1f4ed017f79e7f97fb511a588f407155b12a4717997e4770a4f0d0e94885dae9db03ed133adc1b3409fa51deacd68972807e207014b66d8e67fc393d253af0bf56dae913d2be12ce9ada9e50afa263ccd5b6ec24c00b39890c6c840509fe1b217f480f426154bb1e43b6815658d91f26e5cc6b23c31d4bcfb0ef95cad470c806390ce7447555f09e534cb77b4e1eb412a9ecaa561d75c3e24c9a2522141f27858cc547878d8285b9600616763afb62f8bf68deef195874ffff861de8b85c92db635318d69589afb149338fa3444c4741d0a40e72c1cd048f036a053248797adc938cd0930b4a1483d146902baef39b1de68168909c77a0e4069028c1c4a7465bd5fb3f2538a8b26ee0cede7e17f54d3c7ae1e67033387834b1c878fad594a8f698dde83e8deeb3132129cfeb9ada80c81d7174cd33ac1f6a0d66ea5c36efb3cd360a6a8d8a703ae47921d92df2b5cea4a7e16ad3c5045796c6756a84b71bda76a4118b6bbf894ed63caa4934e891c542976fcf08403799f0f00b0bc264c54002805426e3e83ce1a0a2e60bcbc79977ccd712ab592d515a0c2fceecf24057b63467e8c1d98826775bbe8fd0b3120e59380cbaf4b5a8f1761b20c3cb23808399019ae42cb1282eacb14e4f6a52f34013903a009d2b48a66ca6490c78e86caa13dfc6125ca3ea1d4933bcaafb7ebe789c24312c87166df3b611db4dea0c3ac7f9d1ce44cb701f58f2739abc23457e80e43433b588c26a80387869f392fe523ee67b3f1a39d53b1cb2b740c34e24485dea2e069e1e15329610f868bedf7b60496e7e06fdd3796cb9bf9932328da26bfb0ac3f85542c469d9a74ea7efd8f7440069bfff014a53f056b14f8ee30af8aa705b8120dbd63dc00c14ba3a2704ee9bca847d2adef00ed97456db96c424192c037c2582086bc779eb9316deb84ac4ce225508859b0560d1ef126cc03f0670668c6e1223546a9c3b93f2b32c5a66055d035a025a053c43201c9684b7a3dbde504ab3ac6f9077fc8fbb1a32ba035242cfb5b9a4ea2d931e07b59e1d622307cc742474ffb7ccec3f0c4f0d9314fda53a74943aea33c4580fd22011c4dfcc8a7346ed3e8db205585a076da9f8be13d1134c34daa4ca5d749e54c8b8e2d47f21a6e2a27debcdee2ed414f4971854353aee08ad4c69747e46458e0a3e8c6ed9775746ec3341939125c3330a304d33ba87ebdc30c534ad14962c237247783b1b1e979a76c2e3a8dbedde2af9e8bdec00f4264014d479cb161015e5da6e6690cb6b26d16f34a95f19abbc350b9aa04a29cb4f5ba2fa0f12d8b02457eac1437c176f2b6c9e25056832909af5026189224e1d9d9ced1e4e8ffe4dd9dad013d7085185b3383251a6bd8a3208c88e7476d03cb66e253ad526cb3f3d53b27eb90c61aa6b21b3f1626dffbdda4a8f97a143570ca8b81484b1d9777a43d363f88e79eb93912de608ae553cf83aa60a4539c961a6f7addb475e5411f2bd3940f1181be5bd3863ed1a60e58793e3bf4b67c05a6a366d8cb73ad7be2beb9b302575d2b60ed20da86b14c24a1c1c1a5b963ca94d817651df6c7621f911e2bd1ee0801783e6ef92fc9a5225d0c3dd042aa3af4600210b344b24a3b71d7cf82d4ab6a69d0c97a38bbd2e31bc791e7cf8ca4a809ba308af6aef57dd1a6974bd0c2359e611ca2daf9a87082cdd918392d11dc571f0df0b45b3d1e3cd191dfc7a2f3cefa67f60c987170a954683e3369d1295339f1e3b6469c1b1c366df46cb9a60bfed01442ffcf8dcb8d43ea151be69b8ff6102e09db0b62e8ecf5dcc3ab5f567e00c9e6cd258619289e0a8be78958b80fa41c82ae49787e412e4f1fbce2e2de15fbb5cd5efd566f0091feb56ac4bec2a74654c708c65b9f2508ebb2e29c87c23381102f6f1593570fe9270f17362681a2657b1c02c716f18f456ef20a0dd95483d494574f68c93858b61720d5f9b4f95d8c90e36ccbaa85e696e9435fab2a6a199825723b1f50df8f7a9f979bf945efe31fb4a28cf50bed9853db956411c709506909332fac0c1196b39aeb3aee9b1cba47bbee77324e778aa0c47ad442a26f3c75835b6f9a40f4b37b9de7bc24b7cfcea5ddf2fa29a56ea0170e3ca9203bde4dd2f14d0b9eb9bf1bc839ae311af25da05ce5bacbe4871f7a11982c59817a9e1744f0705aebc30f5511e2478ae5bc764af87a51f3cc16d5ea159bdf078cd26ef396889a91eee8f536dfce377d0a215d4a0fb55bd8993b0e093297239f51bcfa1cf760129150b2f8602d6386014f57ed5189cf8189125177eb91b8a02cbe84a3e6c50770e3304d96a8c09951c06fd6f96f76821be07b6acd69adac4b814a7ce93378c5c1553b6d0c47dbcd0fda1f912fdb5eaabb2611f929751f483bed0757e9a5fda686097e6b24445634c4aabaff2cad2424c3ca52c059acba8369c4b343816e50227d2ee61ec19fb5704466c21dde377abe96bb2efa124b22be724c5965111fed2799a00e6b20027c7fcb104ac9e3be4eee24c47db6acb41ff697f48aa9fa760a852b2d2097ae5d5bb29e8961caa0bafdc276a86cae319d6aa581935706f09bca6b93d93546b80e1a28a12ccafc7db9f4dd1bc41cbeb581bb2add49bef3425ee3227c078c7b76f9e296b3259c034224a69d2d453fd80843ff909c61c68b27cb370d720feabe47501a9f4f1e0e1d8a0ef72dca0c71feaf37e29e335842585b17b9e9e55466b01cff87cfbaa5e2427c6334667ba6404186b526d1870f2b46e8f2935027704735f7af19b7ce828e1e69862137b81e30f2c38985e11e343e3ee2ec31d4bba95616ee750fd5df80d4a5f9c86ee169b5ec56e9eeaa875e1084cf9b16f80db13e633d3241e324af95bd0486b12b4542b2c214369d888818ab53737dc0b537447519c2ed0cd9e4e8a7e514232312bd2b88bd4b9a99d8c6045276338e9f155338edc8fd3d266d9d2f7a791820f87da13bdea229278e8b5ca416bdfd8c93caf0d52c6d2ab19c27648a6acdbe98151416895bd713d92a3806632a629396ee55e4a1a989984e3cdc1bc5ffe3805e3357ebb8e77196a014dfd0a728f3b318f3b7ef759b6e4d30ca3651ec2ae22c85aafa3da64fa3d7fb33b9b77b0a4ae3fc7ee5050c7fd8fd614a4b4a311840c238d125fd6b48483ac5a2cbd6a63cbd21385ed43d5f1477dd80947ef1715ba3ab4a6fc307289fa811c5d86ae50a7d9d4c24917654539122226880b8c262d215ca4e3b54e575375ddad21145f8ca0b0f948aa70e31dba90806547204e603531dc5636cbf0007181cd66c0f80311cf7ab50825ca5ebbd8599c59caebe59093f130b03dbc304f481888f32c7fa1293fbd3b96180176c1b7f457e1ebef6dd9dbc02863bb483a40d8c4ad053659e0ac1b0be6ab9f1aea887de5dfaaaffe895381fbefcefbdece9e1128082ff6ccc53ca16fbfbe3f999ebabc03dc9f57e0bd5ee0debdb80033a804fd6949c349374194e3e79b0b0b0c9bdf451bb31c7804dbcdc1a6bbbb400385c5b0c5bdf02a71ce1b5d0f92d49f00b6c71b30653ac0e134cfa38108054ecdfdf343d7b142d5e56882bf160caf003ee168d2181fa17702b61d1918c3c6c09d2a274b3df28adf3fea207c316eae9b7619d7d799fb2f0ed6d633b8f1a86367d52501aae364e34c38947eb8ca7751588e3e44adddca4f45bf6f02b0068300c1884744b2faaeed98a61aaf99665f2b2fe9538ada3ba1b165254c7ff23dcef7d3140594ddacfa0f5edabb860f71236aa98bfa1b665e172b47a097c5fb8817cee17117c426b6f9a5777d4b309b4314de597357dc6bc34adf9fb0f1ad87fa08f20e33bb1dd8bddf45286c5d616482996b7abaafbdc50c5e23dfea5f63986f978325be5734c5e1e3805ee39404a29abd1e4f631dc9786ebef7e79d4f2ad87f5ea86ff6be4dbf7195c0bf434695b21a8dbd38b3a593fdce989a4c05b64a0e24c8ac9c20911ab069a44df1a553182fb38f3dd365fd9b4eccd40b1681cf1a747f7a59a013ac37c093c95061e7a4863968639e91546f1892d1c3387d4a4f5ad7f6f28d779f2c943eddd98f2267779e0003e9dbb3141f3240253837b67206d2ce32a6189322e49ce5e8489525559697f15b4d33b77fd9daa448839ced89b0e6a981cd9df8bda6c05682a664ee1767401ea72d552900412951c52a9378869ef4dfcad53a20ca79147f441ddd802f2f7e00207df115649b3704744a84dff54dd7b803ee03a2f1705b1e93b9a4a29b17cf990b8b06e5f832195b5cbb8e93f2248308bc9ca3e419e48edc76db1116bb95eacbf478a35d79d731a55985948890e54f09eb82385e290da2acb2d5b95438f984e07883bc1ba66be0ad0f617940abdf0477fb8a19f0dcc0badc9f43136ba463d9f1471d947cf78ee5d39bd8882b71cab99de442b600b7a7c6d621465d0ecab5f239d634010d3848cea9439f4d7ef2299812a6c307998fbe0f5d986098bcd874a169a6534983e03b123416a5c770825d7ce31446adadad6825f3aa88d5d079054294d3854cbceb16189e42ff513bef952f7ec0ba913c9b69a64f8bf1a64fbcb4cc256fedd5ff400e8c2e3f7fd8b6de32f60219a737bfa39bc78e06721a6cb6fd499d6252aad2190558c0fd1531f280c12cb036420f98f260e019e9c0264c309250e98da56f5285e4bc91bdebcaccc11be7818b491bda280ddc1f35381396d2d14dc8ca7e0a1f280fe90f4ec74980fbd9dc719a9e67a11bec63a707dcc744727aa8978696f8c3d98d1c58a29fac7f1cd6edfdd280ccc39d37227a8aab9db947077e8310a9c528ac8937cc582c3c936ef686ef819546cc969a6e89471e473e8df857fad7d5d188972c98bedd1a6b7e3fbb06eb544aec201b5993413c8b81047cab7befc882fbe1fc951747b748f4f3079a4066f6f2efe6774909ac26255f5090c0321267ab69e9bd4f05a41ccbd0281bec41c17d24163259a01e3c432ffff2994715dce15494a399dd6d887a406368eae42483e0bed79b059422ab16eb9436a91e0bc6243e5e5cdc9c2e3526df5168b17961a86383c314792e491e7e68cbe0955ae4f0964258a43d21f6e7e829ef2a855f8d5753d86b8b742f33fca46893bcca33b031e7afae980374ca677dac7f8d4447f5869a634205b7b5f36ccb87f452aaead58c02c3601c4aacbc0b1104d76b35cadf1e0756891ced573bfe88f8ad4ebbd790f147ff3b2bc9bf3428bb74e04c525fc3e33c1fd655a292a9ef56e8f742b4106b443a83f14d943d563792b6507f87532c725eb4b16c7bdef387c43196bd887d65ec39e6acdd247a8b0285a98f3936c2c2da9f955975636e8c47b22b62d682efa721a26ff5b147b11b5d4a67b8734f73c89420f2ae339dbcf78422867737bd70c3bb993b46c3c1b5b213d8e961e5bb22a6e7b28b07b859d10a3a2a5af7137648bc11f0150089f188cbf28f8b42095a757159d976481d778e215c2e0703992a7e3d807d5d2fe6f1cc45b8d508521d785f6e4f7949dc3d64de5d39ef8ad7a897418a6c8a4b6097ea810cb49204e835a8df356d9034251eafaeae82fff8043253c2e06068baa48015e0396ef2ec7afba575ae0d37fc9b961a6340b83366eab51cefeb22ca5b3ef7c1915cdd49f09b07ea407be734e8135dd5ed3ce809e9dbb812e7a184b6488022f452258bb38547da32fcb4dc8f77bf897d8f7651b034a519669840fc3a314dd15d388f7489256c852f68967e6e56a1911f5b15a923c40a42d9e7ad13a500b6a834d387f475bdb45c0310a4bd0acdd1ca34508b5226d95296079270224f100146a3d7fb57aec01260f4c5fb44e506b71485b7096488080412c99f1ba77b7128553c3dbbb57bf5c48f766a19b128b052f2913bcbfd0e8d8e32c3bb22b32a90e5ddd26d5c488bae73384d3c5185332459867fbd2ace60b27def8286afb205b2807fbabfcbc7999685579313b1f105ec9d325a346ac3afd4bc16527258f9013df90c714623eb729b681e732ba7a473c5ee5f3f476587defab698d6a61131b82c36de4ebac8a8745eb2623625b75d847fc5c62d9c201e467b22c9d959127cfb5dc429f7999964ca3dddb83261e867eeb0bb4899bcc5e5745ceb9d7a7d5f9bfac7f14aa69ab907c0dd68883766a5f5805efb768e1acc8fbed68b7039e4ed0055fb0d37cfa0187b83adcf85eeaa63bb416adba43ebae2506148f20ee12f6f19b12d5f3716a07ec8a1c07b282b1876835b24d43a3b6de764603d916de8ce158c3873c6add6098bd21716f617ff22ff1f92649e464b266e0ac47d3bf97d46363a45de2ce3b907e5ded163068199e9a7eabf0a5d745832cf854477d42d8d8779bd5d544407709ba51f4ad5e3abf9699c8f87efdabc537f68a4cd0b04b81bdd43328dc0d0f3b26adb099fcb45351d5d49c5966db287631f1e8fdb1fdb3f1cd709b4e6262596206a7ac8f0aa80a10387b61edfc1aafdb4be2957acc58378156920d1f7aff83aa11a13568ca60724469287eb05dac8022c6feb1e62680bb699f45610eba3d42a7a89105680b31fafc3bd15d3c507caa6e791d6f85b162cab0d614d5a5a633a2250b1db975ac5f3e0a89a10a598ca7fd0df92e09cbac4695500a5590d976fc8ca1f2d96ea92dd6e32d90a774d49bff8ff09a60f08ba83d11d23b10829515fba6aec3c3035bc66926d9a6dda7ff7e7bec13c15696d1ba62504f860392596b33fd7edf8413c34c4c1ef2824ce237981571f46827373dee3b33ca9665b1dc509db9666ed71c1c412faa1edd3da4f49b186c6b716403dc6083bf9e00ade7053db0eeac9427675fe5cc408d23ca9e75961ca152d38ed369d5c1b9afdfb86babb7e1ba47dc94ec51a6f816ee06e7c3bcefeb8ee1879689960668b3132a1eb3e10b9921f5b86726e739eefc8da389a318317130c3c1256cbb8331288a05f56a2a58556fb87d56b214f7d586df0f818d36896108486d20cf1d9a1e030727fcb9afb13f90b203aa7c089853e53652bfd9066cf803b7af41f56c7e19cecfd7f28019dbc18e93148313fec0d9bc6c6aba833de1b0de086a1c19f55f6c0bd2d5942c60455e7372697c136b0ec0813f29100766fd2c3b430891f2657e5a20a224482a570d14b23f06f985c2d8061aa1a417736ac128957a24da43995e6baae5d06a67ddb17d1d659bb428de26791d414990cd5e63dd80d6bc33016fce9470034890852b9407df8be333ac734accc8fe76ac5c25fe15e6265e770b74cc65f1089dad5e5fe13cce1ad07cb0215af17dba8ce42557bc06ffbe5cc913455e2cdbf0968f817c94a1a4f929f4a86a3f48f8f226edfcb1c72c1fd0858777aaf116d3ca42fedc54889e68eb1547236650ae1add6182ea182fb149f7cbc030796ee4020d358c86b2249e3ceb073cf0a33f22713249db21917526cc9721677788c39a001fe16427baa7008423e457f3e3dc6d6e384fc49a73772b3cee916c59ff8cd32846fe2f6eaa09bcf0991eab90b0a01b546859e5877dc72c98996e308a1c8e8ff0586eb1ae9b881840751bbdcba3fc75828a93bee86cf64cc8a5e64944a3da8fb969f6cab33c40d49e9d5abb260fb07f58b44249fec513e58c40832580ad2d081428843d821d512ee15b20292926f3b5841fdc2dbb6e3c9496a0a0d36adceaecd150a624817efbcf125e62a56375dd55ee376fd901ad20f05738b892ccee5d7e66764dac0a24dbdd226edcd865257df7751dc376762b4d10c595f6d06da3011c6300a67aa9b79a53eb2bbd9e204cfdb0dff6d0a02b07a9124105b2c3167b6460c00dcdb8821612473f817c7faf3dd18bfbb26f7be7c34eee67492dd11ca338cc19ec7ee81dc245b7c6db4d7d3e8cf78c91b804bae66ecb2a610bb8c8b8d501a438fd51f85032f00b6fefb301419b7a37cdf5463320ecfefe06bd3dfdca76d91d60b09d7d57cb6a6989e7fda3c5983c3a92d49dde22c549e59a26b02ba2ce464f389c9a95e726682dda9390658f04d6098048d50b7dd391e88450da09e66e48bcf2b171668aba10c24e12326c534238a4599273781fd5fd299b5b0ea18c61eb6ef0e0f8adb7b9c2498e753a7c1d4cef9ac761bf3ec80fae0c6b85cabba938e64bfe0c7f46a2a0e2d7b40e6c43cdeb980ae745a200aaba32b2299707727e5a3d40c37402f5dde424776402cf543ca7376f9d74d5a2ff1a0fb980b68f353c375865925764a96c3388f16454a3f0fd4d8cd1b9f4af41d1abae49e257abbb0263738bea01bfa71699a8d8a62051af59f7fd94cc97e80f05355169baede68226ac1ba948b7fad2f40f52e0b6f5f391864c75a277c541b10bf087e8cf5e3a7c3700d6994b2f24f8a4a54657fbf4ee823eb9e411d1e9b82076604049caf1ca04f8386530d60f05c8ab6ee232a4afb255701463d10673f5d7562866a735d5fd133b5bee227f5260292bba28d227bd4052a4426aeb437c5b001c197fcc3530fad269251f8530dd8af834c7bbaf3d90bef0d68a49613b439ef8d0e2106562727dd2f69f69e8f3e6f01bce60717643d4b5e6dccd2b110bef84a41b964340c79bc06af73b13d8367e07316b2310db75617b7823484634769be29e86e762117a964661fe20309e93f3e4f6e033362e0dd32d1755db7147cc3f71f65626de307366a04a32b347e009896df5216aeb0e56ab78cd1350e7a7f55ce06dd7547c2db44ae866f97bc833b51ebea960068a309885659ef9c67067617e8244ff1b52fd00ea7e410d5bb479e031de1f0a912f4ecf3c0d48b21805ee01e1fa95260d5a4a7ff9782487afed5468b409dbf0ba82671bee584c8148227afb59e3d0d8cd64dc044287b3ee85c5f11a7bf81028a7b7db1137ed284ad180df5d86f66db277a13657f271df3d40e7a0e6669a8b21b6b7d8100c4b92c96e65793e3e19c949f3f24afff0e7a0198e2ef0c51ebe493c2f1afdf7602fc1094c6ac97f5e423ea5769faabfc042feaeaef5646d135ee83479495466017310ec7cec4471189524edce3b5a87262857617c349d6868d4edc3584a57bb5477a7efd7f3caac96e9eee3c15678655377b68f772dd3caeb7a0febc4d4b6cb891494deb9e38a0530fbd271e0a0374be8b39c94b8eeaec9d899fe1cff7c67fd310db7513e53752eb8b4118a3a661ba960cd55e642ac70dd3669341740c52cfd3de1feaf67254a815624b88aa55163e2036f5c7e699fb4b035a91db95fbeccb41c2067b33d58d1fa020ba9b1fd40d81218c19a58228e85c702e94c04675c8a2d54660d032d7491ee578efd067d23fe83b2e87310085126b9281ef75512de02f3543cdd211ba7768a48897726303a76e0831d125b2e51bfa6eb18b3af5a3b0659036da36467a4b108b2450f6f3e0c84c8e5f081191a39078320c4afb8d062f841109eb60a821f65119325787d0c1f7975201befca1c03fbee974b3688292b3b4f5ccae9281971c13ccb3931ea5594dab018e49b9b7ddd4ef2c6c2e7e769432e0e56d88ccacafacb3b93bec6d28f900591f54871fa1a1c72a0f90ed4ec23451c8da68bf19860e0a59503a299e83672fe87441e8839d08a58e2c4fa20e2fff6eac80c17cd8f3ff7417797fd7a6b97df0ffde639ce488b3a1f1f4ed8450795cf79c7770d740270346e5ff2901b792f5492b0b1b8ac4b79cd192d0e4a8cce8a5844a355d8e6f16ca6dead2d73e70663b99413e0a22ac03bbb425d36ca2c5bfa7814b7f2463b604793f79e376bac7d5da5c7ad7f8471e28122dbf9e31fcc51de08ad0f37cbf35dea13ef00b4a7b25d7ae1eecadd2606af46e625c0d1e17cf3053d1d9acd16c7ff748ebd0fad38976d1bdceb1e3a8cdd7511784764a9d563998a41a4519f6cddef2ddb9679803ea77d8b08d6151c1c25221c73f61cb332c6d4e1127a381cc625236399e705fa828797507570ed1dfdf54987380cd5dcab8a99a7201e73760f9500c2713b4323711587b4c39c4bc16f8978471cfcd1bc0224d771532215305426843c33ac6f53e8680456758ae2c7f972c54172aac4cb982b23f675fe28a92acf363d3732d75204b9e1590ba2719ea086b123ca09bb497f9efcc6a73f0f4b9707266a3db3391c032a78d5203e8a58bebe3f1b6e94367dfec89addb8f22155b005da527b9a7ac83d47f69b125e87ccfa0fe42f2451f6dd1340e9d753c51c762724f9f645b6911e05f287b0f0e40ce690a66d56d0188cb89e79c227eadeb00e3be8c0f25be736cc08b6685a249185b21e1118ade7ee1a54af6d179630f6985de657da16a543b6d72e83221de1958f1d88d62a29c981ed230c09f7b0c61e138ae06fae8e9f3b570e7e6a617e3ef3bb770c3d885992b6dbc6feb07d765a8f763f14b56dc1569f5e6dab1a00d927e7d59c084428ff204d42782f24d65943f4808e813da5bcb23f40d9c8ff114443c3fe1f7a9453a6632f6bfb117c1b9949c601404656618948aacedc9199a8b66343232863583d993915be7b04a74ac6b4f89cc67756a9ba59caf281215fbdb0d31840a6471f62e7c05166e4fa26405c6f119562f6a5c131d98affb6addc8a9806b04adbc8090652a84953d290c9f2db97eb2598a5938dfbd8fd3cf26d9e14a412c61d53a1542dd04c32ef6d659c2ca4ba65ada2f6e5490aeba1384c984366715c99fdd328d636129edc19a912bc63e405ce3a2f320a381360af7010f77f1739be877dee0eb32eef3f49102d4d041ede20563b18df991039320511db86523eed0ee8ca89595ab88be7d1cbf04d2ca2d91ece297f9cc5304313d9515a24a0aba12e3c8d521fdcd1a4a4e01a5272e7be9b4d0b63318b32f5a06db1026141266628b3ff683c0e6d12aba734a4eb63b784997aa1bf51b6e30660f01b05e359991a94aca2721d4eaa61a6da656f40bd6c46a361da1512b4f4c2168b64ece1d19ba370efc3ba1920a1e5b2f2daf3126da2e2fc9b36a9049ffa2599f7c852058a4840674908489059e631125b41580950c14f47f35b11b2606c9c6e37954f549a9468f9889ecd965f9c503baeb447a5a9f0493b540c0b44735e4fda19ea44ccbfc0826331fab2e1b29e624d60650cb7acd830fb17efcabb8a7520b01b55fe1b9a65bd9693fd101e35dc20b1c71c6097c1ce0874e758bfde4bbf3ff5266aa484be687e9676abdae3fcf71f69777c3d7635e929fd0519cff7c9f2a788fbbcec63c83bc50ca3d2e20ef96d60c7d2e04ea585daea58cf0b75d984724459be8954213083dc4a4f4c8b03f688901c059ee6700f0964fb9514a800b066f875c0c364b84ee5a2ad74d29056bc23fe412ea34baaee1a0a1648e7d38f46da96260705e8965063b4f7a5faa5cb5ced7f939e5b3b315854429407f25b6e96ed1d02c59fbeb59ad6f451a22267061ebf67f8b58f328140f09d8b922e90e563cc521bb1245bf8c918c479237ba30e07fef9bc338f9917e18b13bbd8f822bbea93f320be98f79b73df41484bab900b3061bc265c4ba80dcdd9bbbef82a0602fab8b193454eecfc43aeb11ade3253dd5030173eb8a767d270a1fe828ea8529415287cca1423c764efa0a8e85e3dff2a1aef5c7fc10767673d7f5e5a6066e61d1cee0ee85e0cd5294f88e93405d5c5043c69ebfbf8711f9617750a1c22d08dce0230c2ee4786854d95ce8c06109e292ee4d43feda31b5311a19c56c7fbf6af026eb2850c50aac57ff6c51339e6cda4c2b3854aa36f615fbd4b7d883668397965ab0702f12229381a3b4d07dc755dbdc8fce937d6048372f8a78c58ec60de4a3a1c57189aa35fa93f061b371d96dffa63bf46a44326e8154ce5ce8d5a14fb1523001e2115b39749ed748c7624c4bebf28fb259f3bb13581744d6f48995bfd974bdd127b80efd755a89c1c8418d6e4e893546dac26def91e4af04eb693d821d8938cb285ee3d9f1f66d8babf7eeb15825e499df458cbd0f8da436db961896cded04a8719c13cdc863574c1aae73f2c6f29a9c09288cd45401195cf8ca45d3c7e1b34aec5bd7c993e1a90318ee6055b62178effd6c49f3f112d2c6ae58cc5c8e650a40ed9b136d9aea53e54caf2faefb931ad4300a31afcfc1f7db256ee8a7ede3d947e34fc90f6c6675a69ecf40be5d7f68c54e3a2135de8db486f7f033c9455870e7dcd589b42cbff6654b19aa6e058665dcc97c0f5e3f2187cdb1552e0497533af3e412a46d63eef62ed9b97f7457394f14b01f14a6bcbcac6aac6c58c966fb5a07b8449bc3b6d070d6cc6f62ffd52ff2d9c8029d3be024c506c75600cb3115627689b7b749c8f0d482f9de573f11e5930f10c9536a34a23e2c2fdb38f599a935f2db5bbf8f327f5c12a6193916df3642f15eed36800352062aca2da82b4956cc27505f06b164e72c380749e08d16f357e8ef9ccb775cf3cd33870ebcd5abfb85ec31700867d2d50c7cff3a146d432d7e7867561242c0d17a7dc546150105179ec0340aaf767352b4077918573336b56848fd435183c4977b20861607abef83008a546e860020feb2af4ad0080e042ee25d8be6357f27e5e33fb49d3668e3589509480042a7bcd60446adf58dd632de2a1b60c8793d919c5501bd330691bd41329df6fcfb1ed40d551f91900b53b9d63f37308ce1d1ef1af30dcb1b56dab995613f08b593ef77e016b51fe5c595a6598c328f68ab64a96979647368caefd76c007c885b6cd4660dd597ba4c491756e8bc331e218dbf83106b6f782c46a1a46983b74006f4d0ba10a25bbc793c8b8ba46788f1b88aac9dec3585cae3294430fa96c6d4c01b3697e78cc1be55112ce651bf09cef1925cfbf2fd3eaa632d06101e2f8bc29a920137d3ddd23d4fcf26b2f6916eff3aba8bf838d22cef532cfbfebcea0aac32de7f943130a0f4d9ae560714eab0d8f00dba6c8911b4893660219386a9c86e0d328e44ee3294b9b46f54d804fcccd15d9532cf237295358cf2666fd7d767210db0b2ead169ca2070870f7fffe533029115553ea15f528bf5da0488993bcbbf6334b0e14e513d0084b9fc2186e880fa7f585260229da77de38b4809f3fff00cbada00181e64b1123bf6f660e469be8952b27ccb36a21b95b14356fdb16f01a58e8c07e306f77a51e6dfe9e5cd596553fb5fa3c7dac490f9b5fdd145d9fcb2ec7159f9ec00b96fd9ef6b31235fa20a0c193d08c152e9f314a6e0ad9869790a211d515cfbb12da1394601a32546d3d30c774d7c281955b35b2bc789bd5aa45bbaed98789442f0fad3c259264adf7ad3f058ea448eadaf73c81a50189555255d55f1c5682f8f70a94f9c4532d141a79eb33ebab9016f3087ca26d3be19620d7efe9250a9b9cc97916bc6d4cdf1b53aa636d0297bf49adff8e20bdf289a7f30ad6ae3d0e80e0f0e3f03bb3771e65b665815d9be8075230cfe5a9a51229af080d4920b6cf9668279b46eaf1a9d86f28eb8cb1e9244b12426f3a6aca5194a954ca9db7b04e68fdf5c05e1a9cc3e3786d246754ca88b12758e0ecebb2ff3f5da1dca0949646e19f6fcd1e99e7f589d22892f3018186cefae312f9484083d1dd6d2fa50198736dd1d137909d86f712a24fd828524d4642b4da4496cad6e3ec99ec2709e5d03e179fdb4ff66f7294518c10c56b43f95c679264700cb863e2a1fbb5569c8422f33843f8d32814a5c4d51a3489e655c4aa42c8726878a21299fd5407c36e9c64555bfa31e2ebbf859810b603786db82ffb417c03abcddbeaa49b692fa413853fcd99957d02d2aad486ee22ff017392cf51e3be600349bfc1f41f7f0f1da316a484364dbd4a8da426fe19382f64075c3e2f22e7256f3b5f1c171458291f83c5f0ed5ad4d43c131badd303fb89f1f35dff1002f9e182239453cacf6705adea69e5922f63e8ed87c88e7e73381ec5dbdd81ba528c0aa4a27bc36d3849384a8802fd21d645c13e0fcb308da5f12a88298d018ad61deec4004ab06f2ce4a0d25f6303f36f33f505d0f91f7a6423d0cdce9e3a700cdf34378d1bcd2ecf99b6ac4097f6f25011b5e1ba6af79b657a80695354c2a9ff134fe97013892758a7d1c0f3f2763bc1f969369e901a6d04f8f718c7972b2a53312ca5f6b16c19dd05c727ea4c7200824184731f8f72cefc6127745721363886beb5d66d5e4da985c3e0e4118d13490185731a876130f80487e7ccdd5751852311c3c84d49e5dcd9589fb8cfc1743ded287491ae998fcdaed79dfce6c04913c90abdb93098dc709e353dbbc17f03995ce7215e8ec4e29d15c9abbcc45e8b73c04b0903c3e4f65e1b3ceb974e5708188c877d98fa911489b6071a49c999ac2d4cc791ce3cc3126e6073646e65edbad880f505365ad1f45ab229c93725ff9ccfac71a24293ee9886edf84bd226fd53988ab4f867889d9f1fe336d9019dc0be4156b4d1e30830acb78c95c2ef8201ebbf510b5e7a5789c7a6177335b06ec9bc771a967557c2196a20753e6569b91e671491c9d658b40d0683dede7f5733bab0cc506efa1ff401e7c2385912539fc7ad0f3ceef3527e1b27ce7bf885532b3198a294fb9e0e6d76750f3e7c37130f5c265450f9648caf9a18cc61b880d17b36c64a65e0803a806060f6194aa83bb56d4f9b5c328f1b9d5a3f76e5a5e0abcce86d697078f5d489b3a5c2adf53800ee9cfc04f9eec0c04f1c8e3c37e662a130dd1376a61694d821295d15efdece641e8a1724be5401a3bafc05d797a30e0794332b122562d1d8e6cc4519f1c27eb8bc2fcf7330ad617bded1bbce8e3fd42b30dd281fd78e3771f82df617e9d6b5403a6ef025b53e66f1a7e4bdbe9d26474f9ef8c0051056a4b0006785f6bedb165112264b8e75e1df52bdf38e4a19380835570d69f162ea64bf6712de1361bd7dffad2c76aed567399dc3c3066295bb18679f4f7abda438a25361c3d44a4847db98e00a0d7d3039e5005854861e6b4f7d0ee38a2abd3b51a0f1e19ef57f0d272c5cf6390f68f2887f23cd273545a0ef188ed0a6a3030df5e86e10fb5c9ab85a3f1e6e06b2c22a306c767b366e0239aff0f9203051e018206efe24f18256590fcaccce4215ee78c103c12ecf71aad32599ca0cf3c629696dd3e5d6a043de31d7c6e4a0f4b1a4db7e95b4071a78b416908adab424aa099fe8537a3ed71f4cb19f7826f0cf825c0f86fa551b6da50b3465b50e11b4136d04dc53e814979b685439277817fecc3647af6dff5df7c9b36d6f9969145fcb45a0d8d35bada3fcb3a832bc80a6a87789834aacf8d2b9a415fa944e967fba7c4a49f0cd6b0c20ee57eccb09cec974148332c853e3c1ab574a7de3a7cfc560a1659771c21e5657161d2ef6b4b9db42f1a6c634f223307cb29205c42f07fce1f762ec7d333d54422e71ddf756e45445db758589c98a04484fec67502dcadd7a26c063b9767311c2189107dccd7a3b109c0698538712f3eec4881507ca8bef16cfde634add8bbf6575dfd84e6f8c17d4f8094a6d8b502e70be4b87a9d8a759da710e69ea04560480bae86b4e2f07981aca1284126cdadf105e72e28a5e2eca3a40db5c2aff9a278ed489717594647cbb964b5a9f7d6195df6bd0f98a49997845847226740668bbaa163668cb6d1fab4bb18fb4eb50ec84f623a5266780500bdbd27a0ca5de0f9726d37ae525d4d98807a750e4419d94db9f792df2b5e40f47dddb79343be4126a3b091516d1c817d68b72f1c8b4a496f07b80cb39e830d2ef9a0a264bc853f9699357bbb28b971517c8c416ecd29b5135b804125d780b0a621cc8b984fa725e08c057ffbf76e39b6f78edbb00db2b7c08491448e97910195bd36638253684e93660b64d22cec17c2537eeaf9e2bd6158061ed3a5f83bef755127f3f33f8681a9e747f8f97b8b984f0c049999bcf3fe375a49271a0da3bd5f5a6cd07e941dc0b700fd25751daf35059050ef70407b4f322f469d274159827b9ecf3645fb57bfdd81df126e460c2e208627a920e1b2a3d7fdcfec90195e18d3198ae862865895e43980691597bd7f504c02977aa0df0e9f0c1e9bd180d8f7f60a0f158abb3c56448de4fa931cf6579e1b799b97a73c5e3e901fd91697de69d60343e9d753b701b3959f640cf804013ec245374722c008fe23d7f2fbae5a5358aa545ed150134d5f9524b56681c338ce6d22f9773c9a3e98a4f1c0c5e286110c8c44c8113cc9ac19388aa4ef4464570cb854eb68af53ae032e03bdbbc305c71570809fc398ce3005ec59a55336feb5b114738389318d920963f17fb03ed9236e0f852e2cb53038025584f18988da5e7484625c4d5c635d50f88a22012debcd56e75716eeb80dec04e16a4eeb32857e42ad4358635668dcdb756853c36621b47ab12ce3037c1d6a6009bf612179eefe42d6d03c84e58fc67f543b22e682a6c7aaf5ba609bc7d056c40da0b8f6ecffe8cfd3508a1b410c26ec31071ce753a22b46475ce63cc55a4cd3d672dfa63aa537ea56996a07ce5ce2a5168294df91b1e2ce0defead0d9190cca3ce86c74701e3d778400850febdb48bd2b8150195ada9f52d9c8378ba9b8ecfe9c3a9bad43e7c3bb3eda9dd9e4dcc11be5f99ba3d89f45d28f79383875d01ece2cebfb508e3ec96d8576766ac7efc2bd8c635f068e79727e60124a37e71eb946b7a64a4b56cbdeaecb52ca9badb97da32b0f37d27302dcc2b40ac1bfff90d33e9f0bb2af2dc9c0e10350902239bc9a8022866b862d58aa47a0b4c38b70779c68fb0bc6237d4996a6fa39566c2bfc8b2739f3f5e7d918eb2df705f9f3a0d50dd4fcc841061e8a360c7fe1d69f559c8a038124025e850da0da0a07c1331d3417bbc5a96aa6afdcc73a7a76fd524adcdfb170a980c386f0b995418386b87f581efdba8e457ee95e12753c46e7eec555224124148b81617c865630bcfdc127775bba9df394b6b9d66b1beed74b46975112a1e8a63d8a1204de61bd5e1ac35ebcf3a19f9073f41950c75df4218362d443d11ab8d5eb6797faa7209a30ecca9b283aa8f302d6fd0ee995b3a9b53186290b6aef0cbd58c475b6843f692c42be71f865c2c942b71839ab6d8378c54975cb07d31e04475e8593fc6b67c8509aa270426f916c516f5dfce35657350ef8e5aab1e97cb49e53d24a76d8aea470e374bc1e87f6b28f9878360530706b687a10d29bfc4b9a43c9b712ab2a6845689cd127e301de246a50cec9fe397d8852b44134a287be90b687b9750cfba381dbab6ee01c00b67f13aea4d3ec5a3169a657fa199ae069d9c490b5d9c19f9ab129bb39256bd41e5a72dbe2974c52bf6d5b0cfd1c58ff95aba7925d96d81a6c0557723ff4bc3613f83785ed374f62fc38242e065b4d34cc5ad1f9b7e5ac8903eea2124a8dd79a43d8160cb9bfb79e5fd6055d275b33e4bcc73d7f94a65f43fba4d45d170e4a648e108ef316c1caa2891858668d997a9096bb76b1ac1b3662bda641dc408730ef1d74720525148aafd8b3cc63dda615af3a19bd7af82b744d6794067eca10188a0e88cd0b72645753cdd98c9e646e3f735ab05e01fe79862d99f9e08256450cfa45756ff2728a903bc76e11b69a910ff743e0354aa88989b579e97a3f11936b7db94cdbebdc504cfd0900b7d9efa6a4486be6676362a46a15eb77bd40b5b9bda1810959faa37b0d0d57475136411d8f45f542ba705edd7b2b5d94cfcb3dedbbd079c5a5236487f0c0c464e00992e10b3a328624a9f51af8688482854aca9d73f5741e252b953f6f775ac59c111b9e97d8680040058c5b9c9466787e98339fa386378262d8f5c86bbbca7c2bfefbdbd0b9476e596cdf7f4b86206154d25557b74efc6c5eae1fe1fbe952aa99005e40aa2a7a2f23ec343d8ae431a1687c44e3c2ba250942eb8fcd562d9dae6ee781863eb7ae987e651e378909a1c6e64c6fdb7ebe910396a2177e40c48de98e1cc7d0b4b986b40a9c9d57334106e56f9fbf1c12bc49af70d24a277ec245a02c31e847163da79fe7f1b4758da3af21a9279d6ad345559e277861b89479e17a4af651176f6a3bde6486f657dbb11f4c09f7a38c9af36a088f130685264b2c17c44c994d6fa789ee6f2730f542a47d751eada06f64667d055ee9682f2b2f6c3fa1cc0053787cb1d28bd63e50c9243b2ed6da0a29f871876b6099c7f8b306110034fa75101785c407991c1e8024ab5b579c8fa96182a922b94b4ea48559bb624439de3bda23c771080c51481fe09879f5c968c2899068398f9ee98013c22b894c5e9f179465d2d4d3aebbaa2b3f2dd26a0babc9de9cca19df29fda76d6a084286eff59e338040853876e867459d3c3dee678a3276da6a320c7fd3a3a819d8b697ef088fcf983602bcf711e9577fa8169cbaf852aaece0572bede2620ac60244c6cfe291125e91d10852b0b161019810092ece0329167db55eb8f33f9cd031d2edd872739fef464856b5da045eb9aba9d409d5dd1fa8068434c30ae6cfb7d9d4bf8c5bd9ea3ba4d7cfba9ac30fbedc527bc846be463043faa461fb5f8461289078a8f371a607261715ce33150496a7641e8fcf3e73b3fbb8a689bf55cf85b3bfbe780b1e53592edf7e36e8ac181d082533bb7be12174a10c94f506ed31b9c12225c727815128e6a22cc4bb4a6b696e1647bf3108499e6fcd16daee6e40cba3f44b4918a2fa3e432311805298bf2d7b38b82161a60005c0cf316680f0403742f0613fbe537ce340c8b50ba668e228dbd3d485af3fe7d11aa842a5ab3d324a2c905926541e6e0f4f8cc016af0a0af9d61be42669c3c368620bc3a9cebc3f6446e5d9abd696458d07279dbf5aeb2969ea662e3dfb292b6267004cb9c13fdd8b57ef8f69b1a2f27bf027eca099dffb2e8fea4c1b619fe4a198026c420e7dc8c28997087fd013e211c13049455f0fd727e98a0dfe1d054ef8ddd56d76c64741678b2d76864578a9cd6325c13de1ed05b6e4887a477cd0bc8271b9132bb846b59d68d0074542b3b51659c9342f62d5cd2f8bd6841caf933f12ab06b936541f37b3174344843cf7873f71b36cc8d4b61f6aa7219460cb4bcd77720c15f6d0ecfa5c33d4449f3ea574da19f540a3d59b96775b0528db129816e28b9616e1244eddf4a89adcc36b7fcf33993570de380e3b55c88549fedfb189f60d1cbd56ae3d354b196d6bf4526bef962678cdd0570f110a50e5aae76138c5c9535fc4a8e7d35d86e9e71b9d060f6b00e288679d258598e904ca3bac44c899fe7792e23ce8bf074b55c8a5598fec8346c040b8fdbbc62bd60cfe5c8678bedcaec131d37d858144ec89d4f16fbde581e7fdc7470600f20fbd0500ed8778db2cd6a84fe5f7e2515968f5e5d2d8f6d82d5c91cfa9fe0418601168413b632a8210e2b67584f4a00d34df98616de368ada9f386c84f1ede09f6d80f829c655a172705b7597559050d81054f9a3925529e0e686aa83710f69234a29d978f027532c4194966d7c90fcbf26b2bf63951d269f2b000e63155691f7e00c5df11e3f60b08e2ccc5c6b9fb485083a700777da513fdcb361d7d420ef803c7aa350edab4eedc624fac97557927c834d4a0ce9a784c9499ff029e8a7042ad0aa83ea88df2b7d720bf0b577edb24e0f9bbabb349ddf8227adb94df87ed774c17dfbe7581407d35e70e086bbe93f8ffee948d55c30cebb6c5b72f673badd3f10bfda168b2f8da9d70365c8cc055013f600771b578cddd97fb9d534347cda93c899c497ba17ac5f39e8bd7f714759a7f3a4a1af075586b7330fe56b0d931fc42a2438dc1da6674ec5a0bae2bca54d10ac4d80f6355783de8a9218d8d42c4a037a293759529b6144e2a050cddcacada21b0b3e706e78719c4adebeb9c4a8fdc2b883100c7852569c3b859397d087493355ce09634375574bbca38f71bd11518fd22f941e9ea2ae80e46d4549d4f24dfbac529cce3703421953e24fd5e42d12140fa7f269daed8e78b4560abdba87fce470037d9a410eca57268d9421e99fcd9a0b692e62d6fa75950ad84feb8a2dc6f4f0cc50c033362907910a88ccd5e54e2e69650d2adfcc205dff43a8cad8780d2e6bbfd6f3049840d686d1d3e703dccf17f1b9edcf2bdfe23560315dc182a23bf1822f4f58eafd5a0f315be92c4a38f14a1e3e0994487d3c32a70d173b91d99232ef267c697ab361a8e11aeaa4873a4e581567d26367e904d27c7efe1d649daef17c8d3646f70f08873bf8d80912e4bdc2a6b111901fa64a45af2e60cd154b2824f61374280d1bb65d398a800dac4b427ff5be4acb95f68d5509d45bc8940dfa0290919c38b167ec0fa3f23b09306597ac8844013fce4a6924af0b45c3c0c4276de6ee2357191917bc9298eb410eb5ae7795471dab76d0061d6341cb25e798be079c27353ce65d22e0aa77d5c0d09adb4451c1b2753f4a9ba802f0864b4862b98e7233ad6263a5b80ad8263adb38c00d7bedb1c49e7b8aef249885655e560c1832f7bd7f0fdf5b87163a2da3c6f594e06f5b868613352e3b8c7b2c636d535d4fe7cb2afd47811ce4986259c96cdeb10dc69da71ecffb9d57ae67af1cfc9b54bd969497a7b04e539b0b6207cfd297c084d0bfdc29565a9a25d8571f89ac7ce8a29da975d6e22ede9a3654cd545f78cb4e0077c6f35c12dcc6829cbdeaa486ded8d7ef90e49aee35da96830fa04cd499683c215122b21ccce2c4d939b35f0ff30a2daba08cc05eb599bf37feed09a1997ba02392bbaa12cbed2041d7154f98747faa52596ac47b84ac57d1ca3060d5b01c1fdd3038a539ca03946d60d581376609321f0c438dd7a1b984520a235a82611406a052c71979117d15e4e920b80aeb2096df62af4d7ad5334c8179b00ae0c4a71a80f0f1e6be071e28c0ba1762c6a275356eb4981e0662146f1707b6410cf2471c7dac1cc33d4f47bf5fa85ca6806bfe0a197846330ff4e39ad044a6cecb311506668543e539c6f91673ff4d8549dcb06dc8646614ef34b58a4c3a3dfc614c43173b29f55d19e03f021c9a82ff47b5a16b65b276821cdf6ed647c9597c408bd28315c7a99b100fa061b4e5437bab8d465e8ed6b63599c42bfdc46930f44b0cadd511329b1d82611bbb3ef0c316a957664c26c195a99739c864c0979b47f39ee0e6eb93ce1310b1e5b40747ef674782c0a3517737a4008d73516142d34b5c2d954b2758b658a050f09c6492367577b146562040a1daa57b6d8346b18ac6fa90e16f2b2811f163600452f9f9088ecc2565de1ec099a7489c46977f533bf20d297f1fb81ee99fbbcfe5ff4fbb139ac2acbc134546f0d95a18fce728cfe6d488c9500a655d12a3889665215ff213810f49a6eecca04240c2664dabc882a032ec3bdfbd2ed31bc242c6bd27c481b81875c366e094bf0c95d30dd5613843237cfa3d6c598b8510421534f9d4e1d6a7101be651484d317a36cee769a92d532b73ef9fc1a1c3fc85984833fee616842f90f845bb151421bafdcb28e4c86a55bbfd95c15f1d2c8b1f46bcd4c3d2ecc7a0872654ef57aed030dd9455b3b3745ed5fc30fbe71f3ba24cacfaf0e9eb3208c6244af5f8b6d03619f13349755560bce6830a46ff670416ab99bf6e7143e8ef3a5322d09fbec8d1cc3949e9e961b9c21c765a4601c2e56dc100329468e25c8f69bf741f59a83246cfdc429385e93d3932574b89edd7a3e3e31ded87fe77d79bae38c4af9dbae8e8a226e59d7d5f890d866e21c746fd0b0f880ca837e4212e3eb03d4d5a58d2357a5bb75ba9cdb415b360a80754870484b9fe3b064853f828096a6859282c5ad13689e2f3feec4511d31abfc619d5778329ce794725ead87b4548ab3fd2c72b7e377882849b4f17118d30fd8c838e93a1f880cb92befe2e60cf5797ff5ee1a5df4e7889acbb374799540f3d3b9bb7127d8c9343a5309702be320ec45d8694e9e2de37180e8f89ef7f08964084cbb908fb6efb3635b32abc4ec6fb58ae67c30ebfee751030806ffdc8e2b3d41fd69ba18f039454f5282797568501ad61b836abf72860c01409f96bd5829c4fe5f8279bfec743c95384bd6b04ec6faad25a76b860e9bbe1f94dbc7fdb5b2dc9183c5a74ca30c2ed57f23545b5187faacc71ce4d8eeeb50086f265aaac326dce6989f2dd9bb8f67c5daa6fbe67aab1a0d33c12789c420ee8786dcc311c2fba35d63b16c5105e16737743e2d229abf212cf26532e0bb5f7c756872743845b24126d03249a83484328c23311b06445d8df88d07784e65dca5a2ac95a8fe04e03ebaf6e75868a05af06d6eb031518590b2d47bedf6ab42ecef9f330ae159f3217d783133889de4b6b4068da5c5e373f4e68973762dac17b67b91bb1ffce8e3b4b4cb44386d32617e48725f5ad2f55b79801e39af2971d19126f93ef85ec330e29599c44ad544734bdceba5b70c8be8cfc4ebdf9cde5bc767bd78cf9e8e31898a6fbe1b0b90d5a535582118c4e486bd35a13760aa9fe849eaedb8ed24ba75a084cbfda767c9892fc2b6239e5ef7ffadcc187d5b70e4ac29ca0e3e9e4ce0f737944490014faa4617fa0d993968117510d7ba2adf95465d7c56db24c91a4e29e2a581a57e07ef61a28a4770bbfe71e3ac4d77fa13a0e1e32582ebb02abb7b4ae5c9a2f4acf9bfe978aeaee540eb673433528c605e70aa78808b9b90edbad8c50008721efa456e3d1b5f69d02b071bb042ce5c9de68dd54eac8d3c38d1e0eead61f4afcebf6416672120b7ce1591610e5874382de17ad98218b72c745b2f5ac4bd32cf1e157d77015a8c2fd5fbabc449d7d9f8234812ec9df90fe434038389694b5cf991a7a63c84eb04f6fe3e2e29a284634a761169a600510574c188a86720196bf9eb100d8fbef6fb449a277870dcc1d980e98641ab567e8bfa06b4d38fcc794e7c62f0cfbd88aa671e7d8cae928908cccdf91d6f6eaf117b44293d329580a33df6fbf17a0e46c95edb5712058cac61067b42b10a7c7c4c374d5b056638aae66dc8bd07092010dab3f31eedec37f16fd7f30e35abeb7ce7def25a11f9c612c4ccc35874cddad15d098b6f75df02483062f2735cfa28cb68de30e960a7ad83376854ddec3e99a4c2b54987c2fc7e9f94580cee1c5a3964056fa22b9f15b9158c889401ca87696371355973555a11d395af7d1e65c93d365f3628bbf43e78047a4ead99f226a836de486c971b00928663d9d4a8c9b3105383e8da36be2d45626bbc43a9ca85b084f9b0eb882928f38b68285e91ad455b53e54206317d9233fd79d7a9d3db408eab440b983064f662606449ec6c743305507dd11eb7d9c7470f8cb7a28f4b0a90d4f60be3f14f5d7f8ec2168d3f4844893e79475cef7548d86d5a38afcae3d852807445468bbb647d00a35cdb0c43f2e8d7de51fbe05721eab9ec7259e51322645131fc97ea21daf5a6378c6679126ac65da0ab95d9d447268e315d1aeeb52a37b9023b97d74cd6e842448759a042e9901ac6f8609f823cacae8fcce29c76738b200946bfc7222320f4c86f9df37999dae5ccaa99e69be25d6d85b2bfa40e56f2d0a76354910b271083bf21f546360e46400887c86c02402712d7a19e979e17f7f1d4f9e538cf503a9aacd6374a6d572cd6c951e925ea1a4c09ab9b4d233a03c8c30a43b496f883427088cc9d63f1755a6cc74c7c40ae51679988adbcfc4f1ded6269ba4f80ec298ea9cb157017e9f1e9ca642d24b28b6be99d9b98a422bfa331b08c9a6de25e60e4e144a0afbb5a335c5a3647bfeb64a8f94fbe2e6275415e3e5e001508c9ebf41e8c438034226014ed0910b8610fba4900896d0683365f21e9d35bbab041e8643e9188070be8b2ca02e399b5dbe1a59d12ea47e7b5fdd28cec74b8f77cf9bc019101731c2f361cb36030f6f49990632baaeff2ef78a8d0dbbc13bad24cf3c86c59d7d7d05f31efc3e3f3deb3f926e41b9b2ca5148aac18c5c853ff7420b9c7ee7fbe100a870abdd4e0c266a89caf400f68ead9135a32a4ca5033ec02d2dbcd1a1abff552e5a2c5d3768707d3694b10199bdb15adcb3178836924ef981a59e811dc1c85e9783b53f3e492772e72ccdf5c82f22b478ad15acb6818dfdae7cb708f07b2752f29ebe3903e65dcc5399f8d643c245844bd258e97da8ba944f2bc9676dedd2d3d444e0a2cad63b946e53dda38df727607b4ab037468ac12b24e364cc1c83b83be2fd31db680e9f1f19c73dc9f5ebf0b9fdbbdea347300044f5c9881b5705192ad8e26cd96605c892b91a22bdf858f651450fb08993e53335115de51e380dd8bc14f98b9739786c8e046d2d0c44d74cc14d2ca5a2e6a4951546240159191a1b0cbb1377116a336d758349adcb18f83a845c2b2b18733fa3c72e5ea44313bc8a62ce219f2abc395fe5f987adb1e17c1674b693a91eac43ea4383dfae98ebe16ba49e0f1bdb0d24e7083ff5836defdedb2bc8ddb2427ce6d5edd1a30a00b75d3de83c3f39662cf100652115c0c6b75f4c49189448f3e44d69ac799e03a96590228bbb7ecd4bef61d1294c10136f8ee6843847faf03c88f2ce9d02f498d4cdfbad616df298db8f216e3323ef52a96f71875da1be5eb5141221f4f666e82f2c124cca2f098da73d45f2eb3157205de2de1ebf180b5a5e3355ae390a0692b8a0246b47f3e0a5eca599ebcb5964826d41c86c0f604227ab907215ce36decfe302a09295dc069d7c3970010625edeacda2305e35ccb2c95d7a8a3d71290900087c16dbd5b99c7b871bf8be0b90f8693a15097c43947eb5dd8ba8268beb4bc77bc6e4edbf5c6d56525b3ebda3cb5ebee45eecc2b01c332400ccc810d1489c91414bdf8b476919c6cc6a93a1d82475f14b0891974d098952c79daa7cbc37df35b68be22e48891a9835408cf53e9a7a96c24f01b33d3c299dfc105085326e4dc611fc13f88b9f53c6cec4aa7ae92cdaa7bcfe6f083a0874adaafa16d1cf90b28135669677fbefb583f205635f4ff10ba8076d336019fa66b8cf27cebd32e569c45b4aa5e25401e58ccb9d494cddd55d8a7de728abea13a36035c3da9f277a9195f29b3015dd00ef3a88c1ccb1b841067018294dee229dbcd8ffe265dadc124d0246f3b5b9fd60222038605618424fdb72e061f042cd58176b751df3b1138233add7663cad1957df9140ed1418c06d81e194d1f3cb8dcf3102c4e996dd6fc0eca37e349189a9a5063532bcdcc438ad7c84664bdfd99aea306d46e315d7ed0467f0e35c48b3279f8b813778160143ea05289979e9f8518cb3595f6bbc3eca44803d145c57f1ee6cf19409e301d671b74c3084b752880305be165175f1f6e988accc470fd3cb5dc707961701276c2cf5f28f399b61a6ec707bb5eb6f9a218451aaaa06a9df69020e4cdee3409ef0ea54858f5122d3eac3dc5091b9b432eecb7137ab22dbf0b117928dd4177fb5f0a00ddf3890df7e6da076fb56ac690969e708fef131ec3622f7842f28672ca638601e3779503da3a1ac9b28ce4fa245cc54432de3854d5d68c6bbcb0bf1d2bf2f804fe1a156170e0967dff7b0bda21b3da001692dcfc19616dfdc5eaaf11b9390e83342a3a32c1e94bf9d3f962bbd58b7e8c70cc6dd43f0f1f45f1ddcbd4d1c8e576b8646e9fdbde3fbbf6eb8253f129e63b1971b332865da1b67872e2f56bbee00588bbefb62689d62dcdb197bf31ff7012d6526e594693f3f5e1a042ab18505a7b7efe4caf7eb58fe898a3dfb20796bb822a759ee632a84f925ca56403f08cd40cdd4c150014ee5641d57fe329c0dba13f3c0f07f0a38bb58bcf8a6ef7fcb08fc7a95ab56a1b7f9d7b290a78fc77c5d227611369f90ec7ba3e623fd65506055708ae8044d24737f7aba419843d4844781f37462bf1063d671ac6945121f8c899accfec5491c2b746ba4420811b1133188947c3e4f0983efcb8c506e6fe3482a31fdaa98fe5256635913c6fbd2c3725599ad76ebd2deef0d8ae3597e4454ef60a2158f5ea49c412a5e22f96209ee919b9dae4879a2d1740afcbe4b58ac5ec4efdfe574c28e472095ec7aaba0e8e42f79215824744afb13f7c7001e3531d7cea9d91611e95eb0873ec6b8e28dd107012f4cc0a218804a0a363959006b1b1c031ee735da9c6e7dc570f179cbe98e0d6e4de6e0281899caed5957e1c8bdf1bcb99d50c1dae5cd33400f676ea86696de5b2a487647e64adb09d2ac5406d2bd550112f9576517564943737fc32c7ea54f028b0c27b0a61ff196a2809f4d8720cabf2f254673d1c5f280d7475f547494fa05333d814f3dba197224e0a57c6c51308f3bc756050ebdfb86e03c4419628815b40a23032268d5d69fc8bb070c662730530f753963c791c6c53e1f6069653f24b6e5c1f3b3e8c8aed5398e83e53a723de361799d4b6ae91a32b3c10cd47cc9d4f190bfac5949c1737915d0524a0d114a5356a39ce67603dcb7f9f120a3bbf992a56aa78c2a38bb2522a27aa60fc95b41f563a851a066a7c4bb12330705ce4895a8d0e1ee67a4e683377873aa309cbfc5d835b3ec0a198d07b1f3f202945f737d2584aa910c86e32d9950059547636e585ad037649a658df69537c325be1aa3723a3696d499092f8592bdebafd353ac0131d60216d0399640b17c8b54d80c08e5c0ad9c08d2f6ed3e822840d5359ee7d9d6c1f64335ac10b940e39bad08b19614e3e1d8a6fe095017cd4b079b2cf5bdca6b7877b7f4ac92c2ef227ae0da8f259277f6050b4ac6582b342ab5936798ec069368e796f72f18eecb44d1f7466edbac9a97d7a8a65ae03992ca595ee7b3e4eb6593281f419ace35a6a5ee47b840db90484df1a80336290b5ac32557c22d89ed6e388e81fb6dac44f1c3304302088d6323d5308c1ee9cbfd43bf672e42b5407efb01ce73c22672ca0c73a4a5cc3cc5152065a4ef30a899030cfa117733e25197bbf0560adc7bb9ac4178474478d4236309918eef18532ae6713cf664ff05d1dd8ef8133146bc84a3543c57983a84496a50d597e7a5f1fb2328e4a0770eea159cfd515f94d95fe7c72d46f45babb94c7d758af6033e069ee9809b5025fbebd8e2870b1af5ff9af5e10a8f66f0ae3805931cd0f67f27cb543350b9afb757de13417731f368faa0023c2dd423ac377fc14b92bf04a856e5346a054ab781de95659aeea39a40e009b3b792b77aae73de4da604e203a5bb5277824fc46e3aa730726f0fcd135386da7955399ec5c2c566ade56f216c305799abd9bf92d933d7442bbb0f3e27a3fbb2963b5b7e9d568dad5da8c50db434922a4916c0c3a095cd89c4a3ce57118ab6af17547af5aad4353ed702fe1dbab8a8d0260e3578f32248ccdf210a68e24f7a836487990c8fd1bc0c1ebccd8a4af49c05b10ce1387a1f910fd17db9169d454919d8c1d29b68d25021af3519cdd5beda2ec33e324c887f16c53fb9d7b81b7651fb5970d09ac511053f21c7f4ae0ab4114cbc4ed7c3011242d5ca8981dadf24e64a9706fee2dda8e4062c80eeaca68e7c719aa048e12f39e1c5b04e81e04a4332368846734f55186f6ca64484aaf2b386a9c56908094d6c07e9acb6a822ce835d3ef18d3087c5b492a647721b87aa0cc9079117c614de97affb15e666efa46e6f111cfbf59a18763b4da0c4a3f114c738f0ca46cd6a06057745080616689b89fb45244aeaaf53cfcb4383b883cb2a3ddc6433c857e0ee31d163bce2d06413f1270974ca17774d2a44e1729e4bc960716ff373e02e26e09cc542267681077b5074f924f5c062a6c20abbb1b2448aa461adb310ec532cb432f94c3a90ad1364e5910e1c1e6eced94bc4b9b27691cb0b5275246dfaab7f8e2589e28fa912343d304419597dd9bccb8fb32325c0ab6bd3c48794bf577413842dad4e2494b39ec9fe6f0fd18cf9166baab58fe9ea6ae52680a4003f975487513039d8a8d7665182d351327ad179f8b8010104d90494eb5c9af68d6338162e91114506e8f0ac8e8ac1ca5afefc4dc6b75bf2b9a993a01bd5ff2b41036fad5b3ae291f33c0212b37a6d32d939336e5a186b92b8b3e05861d755b7d8cbd45d34862105bb9ba08deedc8855760f3098c02b976be7e767f8a108cc702470a1adc62daa932949f8e4f9371b0419a0446e11e5bb038e343d22c3913434e84cdeb37d7da7b9850638cc18a4cf10be37c1d254db08855782f773c59fb03bad5f54fa01fa71800c6470dc2472a6c655c78e71de345aaadc464ef197a3efd1606bbb50b1e3d40540cc1611dac4e349c2895d1c7fc389b48a49bb7e40f3e1a7549005649a7571b98074122e7e0145489cdb18892b368ff3befda6e065dfc23e2863dd53559bd3eca02b9e955bd0fafa75feb5274666b83e15198b94ead33b4ec20c828a0decda6985ace0cb86c0d0b44710ce14de214468997ce4f0f2b693fb07023ef4ffbe916dcbd340133e382324c56fa7d766390acb5fea824c15610c687ed65c19941b10c61d608723ae8a49478ad2f266b4a043bae23ba414a3cdc41b98d96c988cbbc06a107423bdc28d71ad7a01d8a3021bcf57d7e1d671ae6ae5195ddbadaf02b1ca4229451c24665d87671987cdd96e59358e5073d8e70845f062c6e8f79c567c64bc78fc49e3f9bccaf9a7e4f0f242a231bc639ecde315adb9fa9eba52be0fb4aefe466a89fadda9fee4d8cbe0998056dcee7212c01c5aa66f8599a290774613ae93979ebc359cc42d751b73aba4a135763cfa1e79b6ff67b28cdcf660c2e9b5b3c1148deb7ef7f191f1bbbb5f8a46501a84db25e3414644c58439460b800962d08e324d2d9eb0aeeebf743e885a79ab99036b9f7fb9bee739c83d0295a3102f2c147126cf5d6e4764e6402bdffb069f43d3334a42f02d8fde06f9823a2043851f36900ea74038937887254cc13ac09efa5251d4a04f48664239ea1382fb11251f2d86875db4457eef9afa7be7f7110db459edfe607ed565a50b08a6b32cffe4a8d9b826cb69df3531e0cbf014147ce565422942e785ded1b934e499aaba28602a1719a62b044b784f83e9eef7a18d6032631cebacf2f1a9ffb5d921284e963094ac98330dda732c063b7421b8f34541a152f87f051fe5c49dd7a77fa5715963d926ec0476738509afae0bd43d7c647086cd046481b648a5672a69800e576b2bdaf85619a48b92dfe35c83336afe09d9dfa4a6bf6b870d9fd9818d833c7851536d91639e46358ef03f5082b5377c0d3631e2e71f9c2059b4b4db4c3e66a9273e90ba53030d9d6a07cdcf4eadd3873c8ef62f2f454073ee47eb1742593a4c6e99e59ed0193a5212720607487cba3b6dd5e21fc5b22abe7d126acd23eae9cae4462a4acc6165173f21218bef6273f7c15625201c6e368fdf58c102b40b72849310bfb62d21f2c6ae0aca661375a708fd02ef6b710f48534f1d449394173606f0c5a0d506f4fc3510ec0afb564f4de3085ff2e14049aab8be72b6ceb76672b403d02455eb80ce275fcb455e25520cd4310360caf80f40e31d5ba2b8d227c0023c4db5f8aa3c813ae5b0834db705216625943f063790ec7b4df2049543c1e658ef9f2995387e596f0d335b2fe04fcb3aa5708de784eb3549184fbef545167f641204224312d28f11bd21ca91ae8a0fbb831219a77050fdc62512d393247706baa29ec717efb8c22661e2248a50313b9757583546c0ebad80970ed76540fdd4b0019aab16e6d0d0b83680b3704c7a9aa16a75f79483f719ab28c438aa0a7f8515120b06ebc747c3803d4a2f64a6b2619875f4d5bcf968238406ff61b541c53245319e742e6aedac97299ae5b66cab746855137918766b95fa01408915fff9cb8422222129797d50ac84bf84867fac588cbc0c3546a0fd37fae51492b20434b9d4aec598604a9a6a9ddef1a38f33184294936a26506ea3271f893c27399e9ff3e13e4b3ea60bc8e75b15b2c33e3c37d5caea5dc37f32c99cbdfbba2242edadc98d2d183b1bbe8fed00180c16afd77ac0bcde80a77306e1f56db908c3b4ace18076cdbb19af9eb3974f66c99d5a3feaf99c370f712c156ed14971df3f09048d39c89517af8190be1cddcfd5ba3bae22b6ccacb27c5ae0db4380e636513b647ddb49832e8a876257fb83df2a014422945148529f224ce73734b59d1369f240005189f0034014be3f9721617f3dfe27f2648718f968884fd07806a35d9fe51789c46b08e004f8cc5e6283aab9cf536ab5c11f7093e7fb1f4654594d8c4de3b42d9c812f6c7474441cb5f2fa4482e9971ef01f7975eed947a4dab8603171cdfa3552aeaee8c9115a01b332037dc7f82610b9f383cbb3f37f592b1b4f1c28b471c4607763dd1b0c289e48227af4acd25981dc010981eb74e8e3369798a22184aeafbf191ee223c120a3f0f7a6c8956772eb835c36a966de22a6d7ddd667326dae0b4bdbee20dc009951a03cc0944463638b88f851c96c1fbbf10e2d626919ed5eb6a1e432ff958074dddc38900367051bd2c444f736eb918b351d3afc8f75726ca9c26461475925953622744c0780949b12707ddc5236f874434140d390d6569bb9905e001892b67543cde8e0489696eb7190beeec217a7de092e7ca5c2412a9acbb0c5f0c55f8e7a251f3fad696bd6a50d433a8f629dad821446b7110f1457f13780bb1fdf016857f316166287c2a4b0003b47a5983aeceb082b444fd0850e7af0e7704ef1b1ed9e4d68342b2c172761ab69d0f16e37ef8b9bb534deb3319592e68f9d2014bd81e6951816709de9198a893b9274447130587496ca2158e64dd8073272bfa3154589b59f244a8120f0c30a36f6b1c2b92b5e1bab89a04465d50a806e78e1fcf95ce6d197d791bf0ad65a1ecb4fe212029abc940d7aac2496be794828d4e78d50f2a8dd84e3ffb1211987e12cd058416cf3053f25bd3c9ebf1fba9e30c3663bdf8c8b2b14ddbeba8a73ca935e4f7273028dce29ed2061ccbe8a7352aec13aa632ca8788653a87ee78b60352f928d5f1b7edbcb44e9604f381189a3c8ad136d9b7fdf86fcf0959804070c49cdca82ad538764923f21f356319eca7c6bb8c8d29123ab7fd6432d85a8fddf6dcd61449f82a498b71b92898872f36f5bc67aa47dbf242c39f4c2ca37b5274b0ee082ea8e99fc60381861c065cdc0ff66ed0439cda524cff0cc627dc9340ff131821b9e42f0d6b9caf0c717503cdcdffdaaaa4022a4a843e1322e09699f189a361a172e8e5eff0c6624d2a4580848528e5da6ad9d4c198d7c3891a3938411afe1866b61566dbc66aa997d1f05a944c4909cf69aa4643f27f5142905597c4c7d9d2f08ed2a239d6c5270e294a71106e523c187be6fe70d8541aadcb386e6412605f9cb1dfd4c17ca263ee83aad89e4882a97bad23a8841e4d15519aa354f0dabdeb3be6dd028de88571090abd0c31237f3b25eb6515ce550d58793f1e62b7e2a545e4215b2ab7ee0fb38ce394e2c9a7998c96dda2b86ceb00536149896801176cf077027723f0f196c0d601a53716377829bff5710ea414a874218ac66bd1e94b0fcbceca0780a9dfe86f0e32594bc91b27e91dfa05f3739213a93a013be1b7c18ebe2b6d1f270415c974fbc5a7a5b1ebbc57881b3dfbbfa89a97a34bfa8fb59a8301e38927c457f3c9876973482168f12770a19483cd7eb13a418d3182b873fb50a4e8d71a2fcba7a4a04cf2cf8791fd31fc0e1c21cea108f88f2daca360bb6ca96033472215b8be19e6164c6f185917cd8adb8b940e64864dde7890c8c874723d150a0918f6e0b111d89975841b8cabe3c2a23512d002966c95f5cbe8c81be14fbb75d36de59df224b63d9bcd5fb378af81950946f6213041bdee59902ab2e9b977679ac5fbdd62d6b76db8886ec53ddfdf5af2de8bff05589a589da5c2f13b1f0a2ff8518761cc8557293aecef695216078b3a8d289fb11f21a108ec6c2ae527cef921cf0d06b48d6ac88fde6d3caa13e2b6c86764b9353795ff3060bfa5cc988aeb39fb18d601ef126086b30560d25c38a60c53cfafc75e2bd3a3a60a7c64decf29d09beea09ddcbc426aa6c6cfa81500d8f56f641aa6b0a07ba4b7e8e008a03b88fd74517c6fe9c39f8f0411e1d3cc38dacfe51d2d25a937879d0d8876314cf79af1b0c56d55662286e0f1f93caa8376557885d732747012aaf12251e34a0e564089e45727286e1f13e0db45aa29fcb3138131ff8ef1d5c5f39059431d4d2647d3a15a6fb13cd42425ed2de609f25c6f44d071b0a87aa2796e1d223731a1f12a2def73276227853fa4344c562149febb5ffd9b32756e717636aecec095053d9c13d36c3df20c205d0b2b561fb11d77efad196545a200cdd09a08ae9bb5437e9fb8e02196191efbf7acbe671aa238df625b84407e0969f699805f3f7ad6fd0e64fa68bf6f45977fa92e2688ed23b34aaf09bbe1d3a73b0126b914dcab4227a7317743c8a779333ec5306c8f94c219dbb41bed03fb6a6faa1539c507f131a5052e84133e6cb0b310b60bc6efd001c53c45c71f0ffe04d61ee39924134b8ee2d9464aa54c7ffc4bd94e06d74552486b79550bb148f00afc0e8f9088460da6bbc67cc303f080cd8707fdfaeee3f15c1623e4c87351a89be6001c7537150162726b4ff5f2f0d8974989e6749b090c00dac17806b0c7f6c7199a00a6124a19426fc53beaafb5d4bfb5a2b16187d5fa5e1c728cc306dc8d5edfa87b0c370f2f4483c91981d8856a051bf45077428187b6505ea8cdd08caf4207b22037befef51eb712e55a00d5e08196b6ea9862036c901b6b834b575296c733c8a26da3a47e4bcbc3e218552af62ff35333277cc00cb0fc601886fe317bcf5bd9f62f1e35a49b070ea160b113b7fb8d5c1dfe08797828e45891305748cb094436c33991a9f0b14b729c14e753e81787cefca88814d501b3d0e19883f525375b19e9d35d32f51bd4dfd831c08f5a18caa6f855dec21dc116aced57c6dd19424380e95b8ae7d06d66c36f91703d83375ca89ae4649b7c218db36aff4060bad0b5913fb3d2ad93430c436a419c37c213f41a29aacacc711512a0c147a4a2f1f37dac9bd0f2b4026497cd1d4a0d582b8941b53ea7b5a653e206b1be5d1d44a18c129d7494e5ac2ebf8bc265efbe8a5ffa6b188c44b4decd88b436fa60a792232aa6e2fa7832e61b6b6706f7708c0437fb91286022c5268fb896c26cce4732befcedd8c39536ae6117c9543ce0855f9b88544635eb361cd0627d5a130218368bd285e1aeb6c22cf80499f66b9ce00fd3dac74d70728a0f19ef48a17ee0c9160d1568406037d5519f8f5f8c9cc88e4f5e03294b531908ee82bd2a4e1f0d1b22ef3cde5d4a8e603fef5ce8904bfbfd28a47f9a1f9bdb8363761c1c6e8cddeacc8424fed587c6376be2823757c349edc448181464e312b2bed55a0dd5b041448cbd97495b0cf336496beaad2cf8ba8cebea27736888cfde665e73f4f4030055830f6742be29bcade16ca48cf70267a598a93ae67d446d94b318a981d437504fc05ef2c0decc4bd28dac19b1f5ef233db41ac5f1d887a181dcecc6f137e0fd0b99a8499c051f3ac9be8c8b297ecb5ca81f29a39010184b67b999a6d9f0298e4483ca69baedc51a76283130e0ada5a63daab839a579aaa52e698626eb8bb932fcbe73ff40010752a5cd5d0ccbbc4f39e0b67e63223d6297a3a8c404b4ee41df513259408c71ed692f1ddf9f7eb8220c054fbf40f771ec0b24fa7b466a75e70a1dc025b123313a6261e1cd90f1a29a40ec4d40bf9455a215750dd82d95f6de9af0a0a4c8e8fa62f14a27b461437987b601182f1bbdb61d9182ad6c0344af7569eca41bf4124ab49c9e3ddb7a1d05f192d2285313de394091993af085e588939aec5769ba1f2bef92cd362aef5f4c5aa3a3630036b19fe63fa98fa205b6bb944d5fceb9b5d1b0bcdffaf1949d77e4de4bfadfa3ca25638a49c5ab46c733155937c49f26ce884b70799454945a2a0fa9314ffd22b1b3a470602a899559aea5404d22ff94a49c2fa4c47cb9f20fada0e3c30703f7c7c128da82dd302a5913c412ed96fe2b055c948a918a4943710d64aad8b2127b5a63c607e3b839cb32ce3eb281ce58858648399f2ba79624dd14f890303f07e70f9f8bd903028e9b2d800d1c47e72351f4f1c9f1c4ffc6765156bf206900c499e679192ce56195d416cef6e51cdfbd7b930dd2682993f22fe96089e9c3f10cc3f96131cfdd60a158a98d847ed858c7784d3897baad317809557a7a039981afd220c9fe9b6f77cc60915a57855d55d3f2fb28a91e44d4f99aa04e3ef58c20305902bf59c6c2c3ff3ff4b773e31326dde97e82c58f129cbbb2740e5eff7b074ea8d3860efa37097eb1f2c023b84bcc122b01ba59759c831fa1e5b437137c5d3e17fdf7e6142baa61fc7deae8170852e9de1fbe43063f20b79ee65dc298cc00404eeb60832b9e27e1bc52a1f567e962ffd843c15a96d84a93828910c871d48fe10bdd59bec255f12ad61f3acaeaddd1a39bf268013ec180354adf03881981451040696b3e036719ef9793f530e71413cf22d1ad2d3228602f42f8f785c7a407f6bf65fce0a653d7c55222014b5b7290661dd3efae2c92025b1fdc976ed13954cb04cbfa5ed90ff55798eb3fe61d7f5749211025dd69a3ca27c8285acad99c2f7c4ed438b6822304b5e30327d4972fdd2358716a41ca9f8a835a4dd3636e27919f391f06786613f27a7d8922a50ccb375bb1235509c19634ee4c8a9ca71d97a506ffbd60d24489ca0bbb1ae284636acc47daa7dbeff60c0308d8b35e6a0fa38c5d054a36c98ea53098b75be270aef608270569afdef3cbf2de49e3eba8de850062dd2d3e851f042cfb174f0f0f9afa84b0a19ed270d5cf12c73a2d2ebd8c43f23cb39c1504a390cf63afacd785d22f4b0d0180b51acafd74a55b495d6e738fe210f045e2e0b0114e7a5ea71c0c6fb2456b7acc506e221d1fae49969d802c5ea0adda15a1faaf0faab768253511cacbd534498512d17f2b0345cafee89f4bd5929ff5507cfb16f7f33138ad62c0e9cf90a48a9741e030ab4951324e78ac7701fe2eb2b049e61cbbfd29fadfe8f4be289174066179be69441e1b55f43320d1e3b09fc40ace5a752067f9cf1566d79f3d7eb1d40563d8dd947d801770af4677cfcf24f611c5fd76fd2e504e7970935daf658d11289fbeec7b588f196a1aa2823eaeeb91bc390463f54bdd636b3efbc5c21d408a1b908755d1f5f833e7809700b225323db56438148fe856312e2571b8fd28d44204bcf805e22cfd7b4829d3a15a1a71bac69bd48aa2c99018e4ec06c84581f55d62be5ff01a1db5b566471082e05d3923e3a7fb55a2bf45a5fe6ed99e3a783aae13422f3d6b9ed5fcb9a910f0f8bfa97bcc17525941e575da60a52b3b2dff691ee57c416fb0dff6c8dfb9a17726e3c06eb7d081fab9780057a27d840858ff239e954cf9718f6ee08e10949e1ec4f7ebf0d1aa2098665db86fc6782f91b8db94e9e5506375626037495cd892fdfb89137749638d02361a5b07227858163154383f12ae879647145f01e281dd3d22edac0e08fc2237470553dac6ff5d2789fe9f49a3068f753ad4d1083416c5d535c1e2da9dfc750f2bd35df4b00d9e3f88749f3c1684ee4606747a0ad36ac12991832f0877f2260c3926ea23937317df62c97ee2b2b95888e0879276d12da3cce9dca09b27b3e9214b6b914b9c9fa75260aa963e1ab49d8e67a1fb66173e5eb1897f031394cf0c6f80bbbcbd47bbf49199acff36198fa71044282d258d30036c93b4b9686b11cf60679fc3b3852ba72a50c67904c86a97b0f184d041c117f1a99f9614e32a1e229c00ff2cd857b9960ef1efbaabca016e6189e61315dbce4f95d165417eb941ef8a8cd69f2a11af6f5837405ebc03e8e21b6ffdbdea0672ceb1e1d9382e5e8b7921b29bb0613155808e953533950a50c51a088fdf8736bc8cd32b1b7228f07f791701e3cfbceb06262b1bf1cbd73730d9f92714c7666e2f4b23bd3018cfa56511bed0157072b262c003fc11bb90859eb649a668e4d5ace599f5403b1a112a44968e0bd13e0e04a4438bbeb9d3d4acb942ee0633572e7997ad36a27361a4bed9030d425386a1a2419f64ac2b781cab6a200c4d2a91a89cf7f9260da0751a8a96783e1309e68fde57bf22e8aeeb98be2e366ef98754b141c3d73ce78149f624b4fd62a63d86e2296c62a4b72c726030d4a08860a6ffe94d4fed7f15e834919b4f400dc06b83d5cae951289057c9dcb5b3b5b6583ee755d3be735f312f0cd638391c0d0c893d42c1bcdc85a2538dcda2d21e8a89317fa1a07891f84d25ea42643b1e8f2b0be0cecb6024d7473c42be758238166a6c667cbbad06327573316917f976cee666f5ced962558bc53b20ad9dce6c37b3b783aeaa0e6c8f72249881f79d6871c0ae7b90234a58742671df309dd0616abe9c77dc29f0d843f43d483a546ff9be7389b7f0985e9690be43a2141dd885184a43b93f0f98b568a40b18cb6ed7b7bae73e747dafaa7f3ff5c1267d831b84ab8e69bfecdf05d2a198849f3c10a15bcf86bc77ecc3a928505667a01111d9a6c27ac95a5b3d8c6ab7a55049f19ae4f6880e064a4104e93120796085f8c308186a17c8dbeacb0bd96e282350da0bb92451a23eca5a148b14bfbb13bf8bc3a6ed0507b6106b2e0882f7c94fb8238d818839f19e343ac00232fa4a6ff5928714cc47a9fe1cf6fe87714ab138895f8201f5db0368fa8d13c6270fedb13feea0cd72ec297ec350c4d3b4c22cc0d635c007f1bc59dfe0d85106a0122051a7d557981d3380e2082d001ff64e8e4d6725f9c856aab191c80310571d21e1acf69aa60a25e4ec1ab5d99ada9540700e3da30be8a4fbed8f802e3468db6062eff2f9dc5de765bec0cc203959ae1ea8b5f8d27a00811aad117cac067aae6590a61fd2f90ff1a80cd6a0d084284b54535acc6d5239c1d248879cdbb5a02c0452fed3daa7dda620e6a007482f7e776ed6cf79dc852c926424725e5470d69e184b1dc3187a9a0c9c0c2f538198bf0afec8857de07cfc5c8f958948f38c1ab7ac7d7db85558684323851a7b096a7048846cff72d4b65382a265c49ce33b1a64f57924db275ea69a8b006acd084031c9e902493591dff27ba1012eab208df3a6e9f76bdd67e4cf0f1f2b7dc2c768d9703e92aa1c8278526b036b43695878523aebe21b8077c6bf009affec9565479817f599a2b5f6e068dac3b56419f751bf2176416ba529a4572a3e99f195597129d0a330fdfdf0eefa4c3e214092ffd8100e7e1c446166f17e66c6494a7cec3e42400104df4637086ea3f94a02389049f4a5fa223ea310ec5bbe8a1668b20129d44e531b17fe7cae16d35c4080637bd5863776acf1c113cfcd0785b6f108ae62afb471880817e45fbe192480231d7fb60351f9cff4ff5c16f50a115af0a131427226f64b4ca2310fbc36d2bbf3eafd8a9303b51b64eb7e2edad5a0f2b10789ff86cbf2c61dee2d8416c0c1e9a509a6aabc6b0744e8331f337f7422afee5a7c2b1f7805b286c679b9fab195523709f0f74bb0a94dd8bc6f9379766d83333625bb531229792935aba1ad202cc9b08952c568aff31d25641f2e79da86fa8bb9fdafdfa79b3ec57f79585502e632956359008f6f4473abbc79e048364d39fa9bac3109d183140e355f9b560c1333f265fc4fbc538d9908110b0720a30a8a8ed39c1a32e49d54272a9325c5e367741316d160a9fbc0d04a6a1b8887670fcfc2d0c0459e575f04122f3a446efbff7d31cbd9fdf0466a9bd009b35e1514a80fb696c8ac7e7d1cb4c2514b57b5eccde82165df2c95620073661a94250cce7c6caf5fcfc828bf66717101c142fe40efd831d1f329e806e2c1baf16bf96aa78d49e6ab3d4b566e63ea8c33010c08bba2593626074b21687da108feeb8b7037909e8d4116f8547951bc8581027bcdbecfe17d3af3cb69541d7186bb141994768601dc70cb3389637ede85de4462e88ce5854eb9ddac20cb678ea2a4a654b95b2a06d83427d6eabd0f00f64af5bdb348e3516187ee4311cf94f56ded3c7c7118c3ed80171be98642b64c5117fbfaf06462f720c757eec44f017cf4dd514d9a0e02b6e2c89686521b60e43b91de4a471447e69e9d251478497bd5d7d66ff9363cee3e4b4e9e0ef127b7b5b521c59e28309a0631c04ca4a6b316299df5c180bcaee49d089d433d5069386874ea077b90a88912eff819aa7ee65893ca2fee334ca1486f99b37dbec2b3a32c1028ecc380280deb20a691bdc2bde75f95352da475b48c81d9f0a964659b4bd65faa5762d7d30da002fd0763711e72fd67bd35806cd936e3148eb4e6d6408d046d9e30c0c32256bfeade495aa7ebd2e246b30c5da13db9135edf9cea7bc854142c4a4c0fb84ff054145923e937f764f3b6b69805cceb64b9a3d3ab048a4a76a8da37194e6740246d64fe076ade541a684e349b86a21b8709ece51e8a566bd21e5b377f92a93d5cccdbbee6aaa1da50a693d1c4862154bc9680e831dab2680b6b68405d491c4fc75c438aa994affd48a2f735d4afcc1594130bc1f3f20a43a2bf5ede47664bb0a546cda1990d226a9c9e7f23e1558d3e4c7636120044ce4a16ab5f81a73414616f302769b6c76d044a82214c18e40bd3efb3bc9ec802e7a89ea9718c39adabfc57f6a0867e8d488129bff11f4cda430d71abe1c768467a319089f3480c6de34eb1da975a2916565db49d7ca9f52c6d203c8041043180ee8a79b9e1fed4f1f5abcd952de6b110c2ebb26a03a61ef503edec2c67abef7833a0c180bdfd55b6bf4d309844119bfa82fe847241d02a7a7bbaa16b7e2d00ef64c7f0aa3743718ffd76a582479ab30c89c008da6ea8cb85bfafb43fa5a223455c935fbfc408c893d7baa83d53058eed973cb5b69ead6fdcf243aae583f81cba3acb8a405856cf6dc2529785e892dcc1c0a325c0efe76558c9efbfa0fea915424e91069499174f248cce88697b1db5893015616c5a4311f292250b43b846b7338ec0860d2da1d9c1dd80008a997268a81ae57843e4591251356701f81ac2d684edecedeaabc2b017a90d5e153a47adf402328c718999f7c944fe31756cd7b8fd385a4f142ae7f61e209f61ce9ef1554845ff507208e245bdce901da15560b963a3fbf166520cfd68dd44139ef4f988aaa6cdd8b9c4bcf17e43ae637b7d5711fd855b348144a5e7e2d71e713d6e84e1d261128ce88cbe50c7a2ce862674c428fb6dc508ce351ac5fb7289072f11ee6282efb69f2772618024fdb101650f557975a2588ee2ae80c457bd6d09ff8f4cea9a933de600e1806d0d9b40a9c1e2b0d26aa9e06c28e40d069155e800030ff34ed3e4bb95a4b1149961e2f35cd0b1753140e3a6ba068cdf9f939ac5d6fa3b85ab99be9a55636ccf74de6ff89357e207e26e0aefebd2d5f48c75216d1cc0ad2ae517956c6ab01a886ff73ee2f3c3ef422479f940839fbef21819a11282a447d0983109d758fcccca5e02f315f1071071cb6b72bc2819f249027d2a3b0680bff0a49111ee3c01f31360273e32c044780a55a84bf41afabfcd06f938c3ae12678dffe25c49c96f7d085e5c880364db324797d736469c62dee490d975b7333f8d585a261a292da9e73a5da048008ecd65596852a2878ac6d81f17d730da6ce3ad095e9bc691815d0eef346f691398f47fb3fdb493023c0496b2d49c7cc51876fa72c0bed63810c0c8c8620543eb11b48e112d84b51f54c7e089fd5118eb38b41bbf0c33266a2e083d6672dbac7e625a9a331a59b01c42898826410f58223abe6811b58f697b79869c116715bc8082b86e5aac61f60de9c7f1cca00fa48e512a9ce6880f62c5d2e0cfa63d0684c39d3962254f3ea368b0ad4ad2d72f55bfbcb069e4382184a0d85301bcdbb35d7a88c3fbf6e91ef7a48822ea91f0e53656dfb84a19b6d565f3fd1bf9ff9ba9f94d7a7bc0c249a3c61cf0a8c01504d70530a90b3ad6235b6302307721d72f32aa04be36d5b3742038e6df7627925a160657ee32fb739af62f9c92301d2b62dd4119224043290438dccbe93e1cfe8bf2dd729d8798ebf34b84baafb75155a2e5c699f353ac3e8cee62665b027fcc9e9932a7df0a9f3a224d56a21afebe716a755d73bb7026f253b9584e4f2507a5bb04c57ae84b24bd28077d8ebe4e9ec0b8455423b0eb54f4e5bb8a99288d05e253f893b69aad2cbcd92fbfecf835063a97bb7509f9cc86dca62314ae2570196948ed7c4ca1ab4265ddce019a114a02b112c03075527ee6d04fdace051c5d7b4c663196d34bc3a326796883651bbbcc38b3f90c47c1f96e449f33577d66294b4637cf99a6b7cd690eae454a84c749d6acc5ba459ff44f1b95eb0a129dfef17f7af0f8f05cca635d68846fcc294b9d4860f6ab821343402fc30ee0ff900630ad8cdf57ff6b59e9cb5df56752890e9e8b991b43b8495744a6457c6fa7b5d42b3b76f0caf47d70cb7aa31c5a0cfa659c86e7d2a17b0724359317e6ce82f075abc44921dd6baa0a1f043eec7e978c45c8099ea8bf355ef0dd918d4b286eeb30ae61ac3e127a4b2937d4702fb340ceb26fb8f392d6346e446cfa0eebaafa3564f8b8e57b3db2b2bf16b90788d1900442d83ce45bf4e72505086e6fd0d36f94f84635b3c6f72f7b5f92eb6aecbec6fcf563e76e15c7d01271c6fbf45192d65fad70f3ffe4b0100a885222372c3b1f7750659e613847badcd3162e57919e1e800c0e953868ba234eae00aaf7f2dd29583e968f81df1f30f180e3297911aea0f5c3b222dba29588c7187e8bfa217d986c713d95e908a5b5312b5876a0214e34509893167fc00bdee2f9df3e2dc0c705820193d04672c3e920d1e06b18a5cd799db42db4eff99abb891fb8cdf7adb76f746874e3784d14527ad713f23b4bd4722fe07a4287f15dc93eba58f1780fc2a2b9638d1804a4d83cf56e63fcb98fc3c5708591c34da2ad8bf288cce4ac3fac419ab4de113648a8c51e832785e03ded5588d087d64de4049c79c3a7de127cfbcc3a1bc1ba02e0b36930eed54ea3eba0d3f914c6cdb9d8b747dbbd640c1da7fff29ded62af8048adb9b6ca1e0efcbf0333ae7288711a1753d143906c54003c22e06486d29cc86d313a04687c4e919c277e1bddda15c0230560de04b4c235e304a0c173f8fe619e04b29b1b156ad070ae5b830c767bf9195ec56850bdfa6900ffea8ab308735846b9193206a5d2edc93ed25702724c793d35a465318c8008767bdfea7d1d14ba8c5c9f5ffddf71eb5b2b680ea75e9488f60139e6b5026ef161d15677814d6f0c2df7902c9d4e09807e359d8774f057fd8d137c4aa48c9d65ce999e1c5f697c92ea4f019060153fd29d15ce95a402968dfd36ced4f685b69468ea4a9c361f93cadc462e8afc350054e7f984be953c5ddc111bd8de2173b9ebcf8ac7bb900d9992cf1e237c5e8390fadf8e48c7aa8f3916ffe5fe9ef2a0c1e5e1cdaf0b2af04f3896535786eed589b5d5346d4b1f168d629dc5c4ed6a50adc58cbb5d592641a8cd9a39d978215199ddf250c9f577a6f4b0ab663d738395d23f348a995a124561eddccca7d29dbe09c5e6985855c2c5b0d1f3b0d0e04036f97fe7ef64bb49aa05b3d9ae6e7976bd8b885a9bc4e8d26cb9dc20b70cae289e68f35d3a4fd19db72ad3c21888449153f7bfd5d495b2ef54e3b62e0b7ac2a5a92c697ee49c7d0055c7cbd4558674047310a05bac9b6165818185bef83f82a0b46506ccd5667008e1c0cbf2226574938a9d85a3d7775eee450585b81fcd5d104978c4e55a5df182d01ec03ce97ea04c7336db520e098d63d031b7932a84aad297629b9f79910bf87d4664bd415e3fe60c84531d3c113c276340232021d59b2ec05813a788a5b16aba9309981cde3d31bec4a824a38822ac414689ed92d3e9c5e115ffdec62cb40bdec5fe0fd51a1b7e6a3afd7079061e9d683cbf7e4d32cf247dcf6a7f10f67d8b61169edf5ef6d0703928efad6f88cc94c1604bf070b0617b93ceb7bdc402f4e4fa8c373f67af7918d207fa12df5a9466b81b14fed861bfa9ecf7311f5f66e5da1410739376c22e63ffc8de10d8a817fa747c696f576607eb8c0affe0f79af4e82bd6122120f16fda54969283cc5686ce92fa370b334f115b175fc0d7bbba71fc108ec9aa2bd86d577b66f3726247ae48a85d2183f79b33eecaa3acb745abdade5d69b2690edcabcbd400e370b86defaf04a605d40c83b4f90411d7f8fdac2caf0d9eadb9cf22b7a17ad91aa843de58bffd2d7e5026b2f142892330a3afaa6829993f5dfcb3ee2f5981082a4bffadba2eb209b0fcd330d4c3e364dab9613440517800c7f230f62a9aa3302563077ca35563b8dcb7fecb06e3de9abe808b374f3bf8ad0e12863a7e4a5eb0ba170939d9be72158b011a974f33852f1cc96928301325bbdcf7829fc78810c565b3583160b0614f81a016aeb74100f975c12e1cfdcce032fac62686eccdf9fff64a6f102fa7585d9c5d48ca94f249a5503c9e5183af46b3cc605eb9b556956fa3e2b8f9b9bd377cc2792c9f39a01764766f8e3d5a4f052646c51c57dd6df3cdb479260a0f7d782e6a521b1e854418a3d7ff6be4292ed88c52af73b56022f727d6d3b26d9b92946025c3a35d0058f8707773ad32965cfb9650b337db1d30938df1b249c6db0c95fe2898d42de99a342df06b10a2339ff2989f76baab9e41d4c143d99b248568ed6f80d575c5e230046b7b30205f6751edc2c80410cf2d4cbfe8a857a72c76b6edccd0fb44ccfa94cd5b927445df9547f9eb2ad73ae78ffd1b1e8781656479f2513474c1e5aa0856147faa43e143c778e2bc4ed8a025c7be57047a414c6b1c62d226a7f00ccb27e2f42cbb2b27a3219b0baf93b23a125377acae185c8c94415c2298146eb0ae3d62e695563f3fe36b79366b764f9d88d61ed691b83eb490c5339a95987bf2b51713ecfd652a7c39c3b484ba65fa53803d0c42a8037178d24b6014d80e6db7d0d7de6a1163dbf7d7bbcd0b764da6ed61f4ea518be7d81c1c3e4c679306d02b1193ca7505de3422380fa417d782a77a338de720f5b5ebcbeae10113cf344c80201f22abb82fa0f945128bd2327ee40751a7e5b6d48f8aa6501b64b95b60bbe945546de8c2f0bc308e92270475a2b621c5763de4aa4aaf4e041e2d902e4094392cb2442adc2bb15c6f23fea146f736ed8c4df66d0526e1861a4615d9cae2f31c35bc9afd307e2fe0304bc8bca6bfb244466fc1c0408595a37539c6ac68a0131fdf6aa1e6e33a5762cde9b581b2ae6152b63f79a199521180ba1d97778ffaba2753311f722dccf543b946ba5ec2568a7590becd0842b50db85c0daec55b70c4a23708f0b95d458d19373fa76c7380ddbc3a1bdd3e612d6dc3f7a7c41ab47b392ea154039f1043fbe89bfc10b55c415c5f41371888817e14d41818523cfd88d7486fa823ea34c2fa29a8ea9be5139f46e5c88169f00f5be17d019efa1174a3f98440634bcd3e95771e7f563670e3440c094386be49d488c162fd1068b80d111ad20d4fa1c4adcdad556e3935120344be758ce8f51200ff63a1408575e04191ac38539624b2e1b36909ed05955f18ba2e238c4065a5b3f65e53f685410864241da5f55ee304e4fe20b281ab6a867189827a20ae9e605fc6f1f179a3a9cbf68a455e67eccb708bcb24aaa254c84d1109e24cad281b5cefd2437cd5d685311fcded84e3f3d24a847303e1645e523892986d52d8a38716053a92271a0371d2cc79f4659173152cc4175ed6896ba23b85e0bfa17ff0750d28737b2081ab9a515e3636b9f058b088c238e50d00f490b8463a89ca5eba5b11b8d6ef711bfceb31a725e21e1f15d72fc8830b91bbcdd2f4888f530f0b6c3d670a1fc8130f15acfeddcc50926a5981f1db7bd537a3484a6fb7e03c8b01552fe314a4d1a365e0b117a98b2dc012184c99a41d4729e320d4c467519b5456aa29310aa86afc2070d9e613a65b53b28aa27efcee4f8b6844c93af1811c3298d743d2d73bee0c344dfdb09b12c7c8249985914a663df13f668e0181219da616f55058f795d1d8aa4bb7aeeb2f1c8ad57fc0a2e78fb202e59cc3392be7e3380046279a8d5256692036e69ccf2e794ec77ce4b22123cc49522d687d2a59663b7ce6827506319a1973ff7b710a38c70442c8b6b81c217737373d6e093eb81a762f7636afa1e8296127c3d82262ca6ee28d68fa9cbbeff129d98b12357f9dbd7b161b66b0901ae2ef520324bdedcfd6423d2945eeac4a1b08c8c6079c6dac12a186a98cb26acc63afcd36baa2de283ff14db753406db1abb51dd379edc2cc18ed0b71cf0e5fc266599cd56372f216aa4a144d12d946acf0fec7878edc58b2175aeb4bc732bd58f9b459970b292175825aa5be865ee63fc4095972d9024c78150b28fe91fcfa4cd678cb4c0d2e9b5a84e76168ba8706a4025c77c7a60f513776bd78bfa1f9f5fe116c48bc8c9e2ab4eb09b99c2c25f66ed268d0da39393d4eacb2bc58aaeb220101388a0cc8494520b9bf953ee15f3c08f6936feb902ccdde7b812ecac32814bf383e9cbc2504854c01d35fe715efb47300b9523ff9ceffaf5191c77f590fc791ff26d8afe721fb0c9b2d29c453f00a9a0f6616bf96b7e159aba928eeaf4c80e78b7bfa64084059d1f492f892040a1d1615b2e8bbd6a2b4f0317c0df31f97d83fdfdb1fb4e23ad1a9eeed5a7de88d61eacde74b43ed28913e9d702e9e7d62cdb47095fdcd8f04035826ad912a4b15b9395485cf8a3a30daa5e6dcf240cdd375d3360993848e333dccd0f15be04e02190145c1555d4f7f044e62b8a157b7aaad1e1190e31213469c746b409f5faf5088778f8d0862783d5b8d4e864e7175b1ac863af781a6dc028fe4980e493253a8d543eac510e628e2cf1c6c78ed2ca82d1736d17e445a0daa78877c2a97eeb767f8dab37e23fa80cdb3a331667932ccc40dd2ca6f62b912715ddb114e1990627074711cf188122b0400189d9e19e104d7ca9e1eab0703349101d75391c7e17a525b2a76573739dd16963e9f0bfebe71a15279e26fe87dd145351e805b4c0da1a9b1957d579c8c85ba7eb8eb4e06d2c29981df5bbb7c81ab9fe26c342f3808de92e4b8e3982df41e25c4c1d08310f7d09e2a562caea984bde31496b4153a04ab9cd7ab39816a3f36591cfe50ad555babda7e594cf5617c361e28225d96e6d37165bd77af21fd7c5d19eeda59b6917a9e080fbced6b87aad8f6a13d295df4ad8e7accb51d36a8a3313e1cc2d997361954f065e24c77667cc19c2d1431bed0754a1673fcc363958cc94a08a7152e5d92bde38a0673b2ebccb42d60a4cf633ca963bc3d9f0810209a4e94287053b42fc95216646343592b53bd9aa1c88b1871d9f62da20161ad54e7670e89fea846ecc7b7fa663836add3f03744f4d5b71bdc40e9a8fc2d897d3903f4eb1099ba9be4ed9f6d39aaf931c730f5a978a57bbf495fc5f831c04bd672fc58080a9e5316fe8b9d7cdfabe8f3e443d0b0bf5f5d4864b6bd8d9082e47a386334a9a8c1872520bb5c43c48b77f73d07ff91aa47ca4abf3091fa7055464d290ab0c753f8dfc25558562531698f111a3a1f3de74d9aab8283ba9844227f1c50ad63e0ee4370fe47ba7821c0d209817003eb51f679ba3a6e21fd3c22b2ca6697a9010b064e8c6b1fd66d428927bdf862a4eba89ef91c6b26e10ec2c50ee064b83a5593bb9781931aeec856166d38d7b1be9e996d9e3973a7bbe27d462840489ceb4a92cb44a137fc7cdd340f6aef008fc4995277df1db57e3593bca0ddfffcae44c75e577e0dd666184ebfe58f694ca756437bcec22d062d80d0b92c5b383100ef5a9e9a2e61f86c4f8a44620f3a6e55e6f52ee894813d2849ffea1967ee723903991010a5afe07504a8e19520ba26cb30a14bcf214b0a6a64041e46ed8833bac16345d25ce1cb1c2f8581d1f2dae2a1f91cb9c7868c21571f09e09370740af6c743c1aa15517a1eaff22035e2e3c37909698315c0e1ca8859f7ef635720c38bc5faa48d0eeb72956f5f09d072d68ff9d80f1d39c3d6dd50c9c66de3c3a8766a3cc2d7903ad434031198d06efacf1bd973004df535169453af88c1fa54ea60bdb542bc28c859a07a4f8d94188666cad50c9e7a47ce961cb07f047f0832f661520be130c31b9b4592a5bb4fb9a5489b67d87878392197fea0ca3d078debff44e9ffa2e4849dca43108c63e4ba327cad2809a22f88eeafe10b2b2ca0d8b2c154fa3faf8946acebdcc5e5ca38901fbdba95409a6b4913fcd19de2097b0c99514f4d1db60fc649124cb5e03e10113abf833b9859a19787b34a7e6e69fc1c466be75bd4a4197211650c5b43b146ed8912462af6d2ef9d778f8079f694a893950400735004a42b87acf9052cbe32cfd6a4dcef9f16030889e120551fe6f7ef36aa17e12f78cc881a98ad4f0f444630915037d15e3b918cdbbe0490d07d832b4d0fd9689d62b8a0009ceaff897535c95791560a3ca4f6c36493c573270092d8e6be4a6e60c9a33f627d20f822be3d335e0b5355413702c53d0712968f5bbc3a7c80f59aeed0c999f3a0efe60fc8ac08498b5f0ccda508eec1eb55481f761cfc891280d5e17ccd855f5a24a59258a32feac2a5b540939ff2f12eafc814fcb808f6fcebf8dbc2f2b23e5883cc36cc528a2da432b3b1d5616dfd1bb49d68cae35a65429431f1332664f89d7967a72e0df83b8e32822a8a02a22449c57ee004b134689d7ffc8ab8ff6329bc2a8b797ccc37e97bfa2dc8755c25e8cec7f8687a5cf3fb0701d3d03e8c9a7def64858cdf86ee5d9d349c689cd3c1764311b77ca6a712fb94e7cf8bd98775a6cf24f166a76ce6f55654b26585807c0f24671684bd1c1478c93ffb9cf494fefd4341703ac60c34e649c5d55a821e5f78922e2f349d3c60d7ea5bb89fbd4cce43c174a6330b3acc952559e2f7a01b87fd6959db1ae7717b66264558dc321ce4eadf9b202f28d37fb0583d30306b4c66beaa6e7c4e98bd6eacd36bcdc757e99ac2a8aa76a9a0fc6a3ba2802952cd0e5883e42b1fe9dbc97bddc78c2cb23c674ded1db6edb7cc9259d1ca07274cbce79f6ecf399c6a1fb68871b69cb1fb23131e86c2f4ae874fd973d5e4cad68708562f606fff628ebfb5db427dd81a1dd4db4468a6cbaf54fb627e46c9a1ffddd73a25474fe49daaa8b4237e2e4031678ac8cad6c0f34dd41cfbf2af9ad415941fe026597087457ce43f1d3d03b0d4001663e82b752f254e599cfb6ee8e98d0bd66cc8efb0e6562d9b0fc616b4bcd7a3f4b8637c2f1f1b0aa55c7f98c854c73056a223be3d572acf59bc833444ed44e58c57978d5cd50edabb8aba3b382348f8c2894600425145ed2689d99d098ba913c5ee95d914438d8661c2292b6cb71abbd18a0a74555a40917310db200d77a83541f48617227b3744c31a8680f7ed2235a1886a00bb68ceff790f9cbbbe9bff4e3d3ffc113e52fabf20dfa8b0d0a11ff2ce292a3e819d16694bc0dae1bb9362163f63410cc142217b42134f4aab5522b2146f1129753fb21e199d0b733ab6cacc541309589854c923fc1fc28c13a70927d199519eda16f585c540842275327d6cb85503c350e44cda4293576013e596d08e245d1f91340c4f8006377658d458e3114247ff636c7a9e7e19217e0a2af7e7a19b48e9699222951424e29c32d33ad62642efa72a3e9a641544480f02e5a31edb7ae80445626d2c20fffd674e34dbddfc0fcf43a05059d7ac5c1117e000dd31d565dfa4721a858818a35d3a48f771b7392257a3b4e52a8fbfd8b51ac221c76237cd257e41c63dad09a788b36d01999de23cdce5cb7edc335238a61b50b853cd8e1d29b137f8fc0212ba66e62ced17c9edfd0952e3669d8c71a2af3fea2db1cecf7055465a9c96e9e103c8d8f423d8c523cc142faddbf99eeb68d0e1c4391154bf15fa6ec11cc456357856a8efb7a4034c66725d787ebc108f7b84f97ee54937e48f35821c55a7dab6a7835b00fb31b27fe0a56c11a442b6dc4035748199662dfb7df2a37d1edc12d988c9fe75c13c5a5f8c28105c13ee2f16b4d992036ee40a57775262c587cb067f765cb2c7e86f66534451fbabe3208acd9194a3d4071a8bbb3358841d8422a22f8fbd01aa44a411d2ba10a30b6c6687a1774eaa7791df9f9502a8bcfb1e54c630294b572f36ec0460227aef3c0d3eff1bc1935f7cfbcb7aab44540c0d25c490a2cb1aca87efc47d68e6373792493f8f7fc2ef557d21eea525f72d12489f0db86009c70515f7250991cd924329d6e355925d7dc1e1058996e25eff2a34ffe1d62934b0f0c529fa3b67dea61f9298fac8f3247c5aa00f4979cb23cb25acfe8130e60ba246e6d551f9cfc5590ad591f4eb48bef8cf0ae159dc0571786ff0ec5110990d8c5176b0a2540fb2cb38fda629bf8b0ff5d29d5ed7fc3e38324a8099bb70391dc95aecb6b1ddaaa1998491310e83f495c210f0744e11bc543029072fedad18f97bbd28765a32902d39627ef4cdfff6658bfe6761d3c62ec4357b6028076d4c78cbf3c9b2da54e2e53056cddaeb148fda813bfe6120e7dde1026388abd87a98e77926f4270c44a42dde34789f1dce20f7600914690e9c3ca803d271b996ef9f29a50356a6c1f04892654b4117d6873f3ce282e555b09a8d7ac643ae9e4f031d0996324120d789a48cca57391226dbd9bfeb9542278b44c627eb786341bed158a285140104b2ce909b53a2e3b2ed0f64b2e953164fe3992637087368fbc1e0e2d36e10315f2ab59f66a79883087eafb178a530ce11129da1a9f83dec0d28452e2d35bb3c3f1998a6422255d633fc78c4e58a8d4e5e56cd6820c86ce5ca5bd215d6756f4f3efacc2c844b71041bdff2d94272d5d9724e82f28be1c02e8eb317c7ec36da968538f800569a35b83063a0ce7325c136051aadbe31e0619a4d83ac7ec1a97ecd41378f94367d5312e2ce095f08c954aa0965e17188a9ebedf86c0e5da2bcd44b831a96d02f3cb96b609134e63787e667366eedbeb347b4638087f5af3f38c06866c0b7284075762249bcc334d8e782c33757801efaf12a2de20a2ee93701213cb43adc9239545e8f078237f2a67706eeed890bc69d2e56ccf1745fd23c7f030134ed016deac2c84a2ebfdc5bfde5225669ae85b993eafa26fca7b6910dacca12428b55a0322821b411b2eb46648f8f1714265241c7374ff876c016920b27e5683a0812ab93d5ab7b56da631b29518615e6692b5a97f74ca14c93fd8ceae8c409adbeae14da2e72df42ef00d95d33d5e00835b3bef09f0a5bc5902c4b274e2c4202d15fa6759fa6e6bedc74cdba985ca57d79325fe14d106a39e87e313dbad454ced445159bb914e91b617ba95a9d59ea5cc8bc6a7fa8d2e0b3b0992217790417646639cefe35e69c14ef3a23fa9afa85d4b8b7180e03e4be23d84d14704b4a61b26a73ce7e784101a141787cc21962ef02223f6e1780321c00116ad61c4a14c960bba4a6d25db0c76632397a29ed621bf1a647bde1bb5c7e6770588cc5bd6eb8be948ad2dba35405f1d6d7af01e2968ff8a77d7f8f124f305f98e3a99812238ab600954e8da0ebefe432f9eb4a64c2d612bc112b8bcb105fb3351e0a2a7ecadcc9097b2b9d7f0db8f0565f1c9665ba922f09af649fa4496ef624a4a80d2e8a1bee98a018812e90adc1256ba4e56ec43cbc524cd6d9458d1fd41794fd367a326a2d81e5e5f82c8196b3b19485b71f4783ec1e5f82a7aa3b6a47f10a8b196c68b9c5644a5f9c5e2d401048517d5b3625eadb41f741fd6f5f01bf3d03f1b63a59b4a7468b5cf8af1587728c3afb59217a73456bff30e70da0a7c0ae904c88578a5dc969b7b81c5b631e920e1b908b37047851cd2e1c48b3202507360431351418c91a41959f76e68415781bf89179a66a814267ecc84c54e38ec7e9c462f279a4da6a1e41e002ca425c1edac0a6a8754027110e4b383e4113b5c5e89e0cb1efd942929e81e6647666077fe6287e9eee4dd29a1a930e3aa8e12653deb6bc255b24540318c0e8fdd69d8cd25d7b3134d5117c04a31a6c0959aa433f2c8893a3cccda03eb5075554f958b3f3a875baee08933c0255b626475832dbb0700a69b08b4b97565698a1bb63113b30b5c02f85e361371a48fb42a542e9116686527ec9b9727a5b6a6ad4cf446ddaaa54b3e3621c4b1b2c939ef8ff480fc580be668d17464a3fc595f26c177756dc084eec265b81edd40758b7cc34d154577a5f41c692ce63d4a5fd291748504b07f818a1d75c3a3aac6b0dce758f791f778c362b13ddedad2020651e391d5aa4adebd67e96a0630d4fe67765f30e0ce2950bb1eb1927ecc3b90c8fdecf9b5599b7969694560e08f68653a0c61855f5d934ccca27c1e06dae4ee91411de64029a61b44b25f6495459663b75bd819dbbcf8e511a5fbbd54052e78774d7a2187e27ac0c72f678bfb2cdcff1c6a218a603800d3c98a6cc550cb2bd3fdf2afa3c59c75dc9b1a08bac18d51fd926144be80d44d8d9c31203fd14425898d927391aefd63288817f8278dd03f05f7072e1220c88d45efd45342298ede865e1cd3eea02ba02a14b5f8dfd8c7c44062b6b1675a587197501f528c7d8a8c167646aaa6c9c37710cc34f4e962c495f02b5e9a43ad13cb17d55230ad40230f59ca4ed388639a2a545a53d6488bcdb52a765e26e5299c250842807c775b7279ea5c1119ada8825bf15c3444e907c3c13de5f1edabd5750e20c883cd6fd5b1dc0b6af4fe6063887e2a33cdd19b4659a8204245653c149bc11a3a44aefb644058795484d0d581a52bee4bea00f146b0068a9c9fd9f48825e263f8da10a590be470159670597bd37d0669c2efcca182751cf8d059b72031ce9a4026baa321e241b9c32a0a394be00afdae1e7bb45781f8ac639526566fec95a3befb857863b1f024f4e6c1c78ed23d7120258514ab565d1f1674ef8933fb31ef3f69c1f6770ab6f0a2121ec386f06822223544efeb74deedf83e9b34550c1b6894da2a1284b78cf4b498952ee6077495c720199300b080106baae37a95cad1533cd33e69f9f4995e653556e1a21d37f23b28670a9e3fd63263d2bafd8af2d0df8085d6aac519dbf6e4c6be4025470f259e1f0249f52d2d50e772e2677cbeaf6e9c1ee681f8b6bb25b35ca84d6371068dfd54aeb50463f9ed4dded5e5f16bfdd257ff1ae7ef17954cc827200f8e5ea816d1f420cc4004650e3f2087031cde9429daa4c5bee95294a05ec10770ba684e179df953b6fa956e27b0c88a1a4d6a1b303f44da988d5dbedb5ec272b22407fa5f61af32af2cdf4a3f661001ac4d845ac162af485b89cb51393946de70ab8884ad8eb6bf22c9d01a74d17b88bee150106ba6f5873d6c9c93592f30a9469ea80fabeb4ea15dd339188124caea7e0c4e7a42411f6c1dfe14937b9fb7a18436161b9d320ef31bc7a6b8c014325d542f7ccc76708d6659e05028a112a8b7f4e74bb8a1ddc86feab0efaa09e8f3571baea292c8bc1f23b9a892c93f8adc0224baf7d5841c136618662818b42a90c4e065171ba0760574fc5ee0de71f6fa3ff32ae573b8f59e67bbbe0b395ab5bb068ebc9175f4caf27576e5c8bd90a8349b5b7d653754775a48bbd80ac42e360d49153036c149293d2cf01c740daa18c87a66b74d996be253237e39e0bbfee5d0e7db93089dbc5bd64e5bf03dfa26989b41b3d8f6f23cf0f134385ebd9ae28895d0861d7785cd200c774577337acd5f6d21dce72d107833f02730e4032a8c1ee983b9b6e3d57b22dc7ae85fded4113db2b96e317ac626a161ca4e9ad2df52f75cf2c97cf012cb496c8c37c85d2c6199936d33f383c8560ac51ee808e460f842b06bbf8bf0ecad5e7e97854b5df374097ee7c45a63b4a07de0e2a22c42b6a59bde24f9cc9ba315085714612d3ca2cf7e64d013ebcd6df5cf9ff7c5f5e6236572f48fb0fd6473c342306043eeac0cbf5e9ce149165c2f6a7803a09bedb612f76b52a593e86d8aa436ad38c907c0d69f658cea35e367db68081de30e92c328fe2f671500a21562f10344376c66a336eb402193fb59994162bd487b9ad50ff3f674a1be7f1554a4ebcd48542152ef0a75411963c328705a4bc2ab56abad9544633f15ef2d49003abd392d08e78d39c565bd60c219576d69afd3fef2e88521ed3026571db978678fecf740957cee6cfb21e642d280ca1b1b6823c112bceb7508c893db371ce96c76e871afd95c21de1e5cd1d391056dc08ae3532bbd69ec5c7ea8dafc9f45c6bddb3ac2dd8f31bfd7c513c47eb11339c0b68901c8ab8df084baa8dfc624ac7fc66d34943dac2caf573214fca92c08e96d5629d261f912074a22e5c3b63252d8dcf70312a7208d3fc823374bd4d19db58590d57ba60334a2bdace025480c65de635e8b2b27493ab1065fceb8812f8596d9c6b11996752ab092c0989db192eb1a424643cdc2ec887bed6285eb493c39a1d473eb2b14a796a8d0ef2ee87742cdb132523d8e13d9d0f70b373e852e9eab1afdb89d4f4235b99e94dcea34c2a0e8cd00851dbddec5e535caaa86f718e03aac184c6d429dc158104a7748fc44499fc1f369dc6dd9609aae776b4c33f7270900d8af8ada18f09b8a9510df036015135da86cc755e980ff1bd111ff1ae5c5ad16cd07e24cb923f7c4d7c85ac825daa04c3b4cfcf089607c812a81d284301ca2835f0896ea42b0efdbe3e4879c8efec5edd76c5609c4a903551346dcb679b009496705f8b05e2ebd5e10dffd94a54f4f18bc9f47bf50fb2a7031e632b088ec0dc1d928eb183050f12c9f11135595fecb505ea9765339f13519cb132f8f9e446fda5c1a86a789a800751b8dac1c3f16584a9742a7a9913dc8161018add0dca66a74306a37862d599a46e26e22deee90c3e442609f53b6996db11866fa6163e4398dd2653a717ea258fb7d548afe1e466ce90fe779cf0953579daac09458db3d016004b4607fd0d26ab9abcbd59c311c57b16bd6943580b1af1060121a8740262f0528a3a9fdce7a939bc851f1a4026479a5ba16900fe9f82b7302c612cb77a51261d40b992e81f3c43342c707cc5469ea665de00a5467d6706c9dca8e583f76d43517118c423d66aba6583c5f864bd9736e7065dc9aec8eaa034f8c5ef5fddb2dec90b211e05257aa83b97a87b8a0deecf66966fe412aa05107f32d4792a6ca209db3bee78d8f7f19db9da10218bfc8455163441f8955a928c2d45a68401c0ec7b3c2507e5da963f835f35dc526802c2965510bdf5a8195927d5e437635ac77b64a16d25628647537e4267c3cf0a422e865db9e6bcfdbff5e2f108a57c6f2f06bcd268972e141170293e6c03ed79f4b8def269b146043c660d880b74d0ee387ca40b498a977571f395396ab9fb68372881d151acf702747dc6f9dec2109099cc67a695b1883db0c87f1ecb6d7893d70e33b1f939b1d3d4bddd73961258baa2cf934a30d875bec9b0015b911c220998e152fd190ec7d1a5834b1199ee0f2fc032b8e67d2bac120114c3fcef0391ad57725719d96d549dc1b528a01db7282a9a16dcc4e89784f4504c9e49042d0c43667b764103e6b3b10499d0cbc50c9b92f1a13543da2f2ec3a6847ea3134fa34740cfc87eb09d7ac515077d0a62ea11d0a5f661648fbdf02268ed64656ceabdbd4ee5a68c5abe62ba3b54e0f32c2356586eb900b521d98178e2b5ff3d8fc7b6e063fcb8b8d88a6519ac34097fec45f0a2ebb13f06b4b8ba3712eae0d3435ce0cf3721f095e6e58d70a65512a7474fb8da62bf8d7ff100442440ddc4e8ad1acfc4b12389fcfbfd34841e5a134b3ce075104767812ec20768ae1fd1edd5d9d62ce963df403e51ee2ec2dc2be67bb8aef42eaf61fc70fee82c99344b03fbc8c5ff55c80a23eb17cdf090692be8193382b0ddb404e7c314a7d4f18b88ed4a43c6600c250d123e2b0aa38648aeaa3097e763ea7fc3daa927bc9af5beb0164699319879cf2caadaa0b14fd8517f6f389be54a5d67cef327bf2b69e073b17a4313fe6f857e5078b9fd21ef413325ac6e638778c0e371e1db02211a2a3fcdd5f509ca9a794964368a03dbe538733c19ececc13c63a0a2629cac50c3120edb37ce47720581d34a92aef880c15023626eb29beef55f2682a709f43db7c5cfebfbc98776016e13ff516cf46e7ceeab190ea28f30a6aa512fe58d39a4c138bf0ce68b97fbea2948bb6ab2efc1cbb1e5bca6de9a6f38340780e937864b25f05b36a71a7a69f848e29e3316039e58296c07cdc5a437f41d60e05a9cf4e60cd67c07c3274d9a6b435debd15e1d41a522a32d05fed427f5181dddff367c54bba12eb776e376757742e701815d20e2419590bf33e0943c9d198b4f41e148973eaa9304523c791bf732202d67361e81da1788d21af99a5afc18d1f6bc5e8ffadbb302738ba087528bf9da0f566ab68efb6fdb54798a4d01b9f539dbb706be358ee7e3caf31c6f1eb71d10782a323165257cb850e9d8140d3ac474d729883b20238deb03fffc2dc0882fdea6807f618314107f0ac94d5e68fbd6735cb3ec159f98eefe32563e82a9b5bd34f0ec96040cc4a33c17a399f987c42962fbbd6c3f5b5378ebeac2599d776038982cfbe87c3279052bf23a106bb5115d5785d2393297a79f9511171e5c7efee8484735595e38b449561d944a36d599b1f5dbebe322f01b6e35be2174bf36c3b7e8aa2dfc4e9bb6acc6469aa9c38c2ad25c5445fbd7ff86050bcb065f9cb21654b85fb7b4cfe106f5935dc273d0918fe62bfb17724cb32063fb40200c508fbac9dc823f08b6f05dbd4cf36c14b8a7779dda26c7db2450003dd6d0608ab897077bdf792cdae342c6f092c3919eb663a52157dfb266af6bc784c2c04d94c08ff3a00f40eea4d9868410413745567db7e8639392b21e3d7ee14995754c5224f88ef3eb15639efb31d5442bbaa852e79835678890049594d43604dcfc10630542bce05d77318d556f4f77205c643143471d571438afb0265f4a1e4ac4d5d3095d0fd2e9203d221ad87e360b0304c0258d015052cd49cc24e64fe4d6d64d7681299dd434a03c3c71936fef99ecf22b87fe00fa5fbf4c90c62b89dfd3b7cefef9900d1dc070178aac799e51b80563e44400c900901ee529a3513a486f3a17bce6b13b0d2a94007db120e11cb49c81ae3dc1b662728a573a9a78f76feb0d00ed7f973743f5a4a5f6bf1f56f9238b0315202450c471d96d63c22bc9cf9128a2563e027870d75d3ea2853c2b95be25f86258c3b19f00bd4a1ba51144e6c07579d667d09f967f5a73eed52204055af0aadd51308fe6eda338367665238345e1f4ff8bd58a482725251d066d4eb26ddab68cff52b8c6e87226f9d2fa0d5d392901f50e4a6791358ebac0e61cb578097ef907be6be3f6acfc202c9e8954827ff6aac8b008782ba98592a0d5f2756ee8767a8b9c0e286618f8a7e724fdedeec91f71115f2bfbf08b673ac9ecffaf5016830bc8c5b6d19b800576c511fc2528c9f68855453abe285fe340b8229dfa4f10de3507d2d71ed190d3d5191e539d4ed6da50de88db5c7eab912e2e2b562b8ae6cddb3e003b71f3135c0ca2bccdf8ac9d3c5ebb4d360ec138cfa7a74a245279c2baa0df61a87afbc2e8d15f1da862e10dc145d89863d1f8a0859c783a9801a8196c5d27010d863f3baa45e576c95a7f4b15d40e53f2340bd0d9994e084129871375edc286f5e7ceae74d830876a7f06e58768ab684da61426ae1f345aa6832ec6a1709072dabd15cf6425a5f051cfa053202d74368eeb0921ee5c51650c8ad5a25596983501a95c6550eb0c2f6d6b84cb60f74a8e4c2997775663696c0079abd5bbc61e6cc3dc103c55ae598a9313e004cfef34d13bf2be20db6a3c7ad5e428350f369b643081d5e16b482d5bd5b795ec1a033506d2d155df92cf9a1dffda12c6f13fd4c268e499dee906b003f4e36209e535afcccdebdb08642d14ffa949fea1e4a3a809bcc01d33ab94fb82be1629379f442a3c5fa012193c0d0f07b7d1ee316067361f900a8c93a6ce7a6a4ae5333355731c7ff06dc0de23bfd0fe915a677c354d308fb508595290b1b58dc8f84f5fe1977bdda95c0ef7faac30d03ddba48c279b9bf0c56cd5e79a6fb813d42557378a14e43c521069024e22c114f0f1b2810ea4af06040b50edf02c5e64f9e5a3fe658a80753f4becf7a76313abb0dd21d8a42436d8f0949580cf2d17e179fdbc313faa7063bdf19309d5250bd41e30d05c5c9da9c0c191220e7bbe0cd604d39e275fd2a37c081b50ad91757bae1d06ea3c8fb68c7ce344e93c87b26ba65596c19195fdb786f59642ee8c6995d7db671fb010a64df1ca9484c13de53dbc29f2f9d493e9e9f8c48b7969cdba351e6413e9f0117bdeff5051abad22f56caf767a39619ebf88192cbb284d32dbfd53f6f500cba75f6d8fb2bf77bd042927bc838606130020d514257c9f38d3e178298e6878fdf7bd9caf6eafa612bc67f26d8f94f0f5e26f6b8a65be72ce2639fe75a994557173b5d2db8eeae567457a06e3ea8fdcb57f96ce0fae1dd6c90081a884e6d5bf9039acfddfbb5f6b4c3aeee422f8eb5a34c5a3ce4eb109a08a43e6de6080d68701bf293881b6be7ff05f44947b5b9b825a1b90740a9131ad6dd236aa73b7a9f1fdeff14ee0f7d3607bf5677b4830426e1789a05cd9145c12ffb97e60887b889bf740f6fec6554783cbdcc16fc70f9097d147b686a042e7098768f6b453974e3388d9ddd545a2b489dfdc12c0019738e2732a7096672b11ef952d92f29f4ee9891101c8d781955d97011944e80027a0e84bf37e691d1c751985795706afe6935ea807169dccbd5d089e7583b95b69f878450320d1817d349cc4973e3a6164eec70ac4eba2cd0967937a04722bc273526793b753507657b8c212413bf239fab81fe9530bd45ff171516116fbf4aae5bf5bd4ee0eafe7c0c16d977935289790d9236ba8d8fff519f62850cdbc73903bcadcc42615be844e686cb51b9cde04705be7595e3048835f6f7da588e2d4a14976d6ccadd9a7b74e2258f0cb16f86c89821c277f5b86ac161d8bb0a983a1f58b967095fee7d88587baa160536a7c114c13cdf714ba6d348199ffce608d2823cd5a3d7d75bbfe8a4c2ea358ae2176d83b864023423f0d8409d622ec447a78554e29704473e7c5e7c39497412134f44a11ffdb554585f22b7e239b86aba7af682e39ec4cf2666e6c9b79aafa1289a00c2489ab3ebd13e404215a422c6ec284c3f3642f3aa9ea5b42fe3aea2e59c739aee7c401118b3b93733f15ac1b3e3617bb6e241dad313bcd08b2b8540c1ac42a03ba8f940c1108c03ca66fe7a618a783140e7ccb0344185cd967278b384ed0647478e29df2a5c43040484c5175ef66f70b5a33481295f4adcbedd89beb8e51fffd29f83d45858d333a7489dbc7af2302f6907d2eb8fb11a81a66ab8c0e7992e09ccbe3141b74a2fe28779f2bb319b4f93b0b90fbe4ba5b072d54f6e718ba17ae99a857c752a97f1f77246827ae94fbb27e150bc341d194cfb06017e00411daa5d5af946448b5e2efd9540e3083ea0c0278f2a81228193f2ba76ff2766b440c1fb1cebfcd30a1f98f8ff654790d336fbe0136f0c2deb5243eab780017e11d42c3772864baa8ad13027e0b7fad8136067f214138fd4a8d2e0fcfb70e759c132f379aa934892263d5607956e5d33c715dfab35fac15abdde78d49f446617a12084a24e3ea0f14e5611cf53506e70860cfca984e3b9d98f5d9aaad0fcc68a886232372d18e4b6fe82183097aedd8f0b25aa5c0e27810c65237d15bb2cceae0e79c007a66dd3d9f6d93b070347a769dbec1fa98314762a7b831ae683ebdad16426a82419d9ed881ba2bbb2b895ada1998d4dd8d08950558b822f764aa0035edc30e3ccbe4b6752ba5d6ed52c611f0f2e6465760eec4d33bb9ddd4b0569c603c4a5f5c9485bd5040ec68724b0b1d765e41b3ad07e587b1caf0003f400588142c99f012e29de307c1fb0e4b64ea7eb098408ebbe45489e01d1aa07a8eab72d9f180cdee671372ae088511020134c65d4b276ac013e49a6387d373c172e46073808868d462df722c9907b3dd906c226b34590d9ea6a220d840243a83c8431a1babc8459d9cf8a421937e859e5043ee148c8db06826b3545f242c0d97a12cae3c2343d2d91a151804913ad4c603776c1f9695f3395477338948e50a4ec51ccc6b426e43ecb3a462e0cb4fb0dd93a807fcad8ca97625d27d487ce0ac88fb8da8406f34a3999b6fe6db721197bd680196d1b7fe987af16ccfb9c3fde0509052908fc024ba1bb08a7c1ca399a8e076d9a4ca442a59b895adcab2105d2a57f0534c4fb255ae08ff7fc70b1e0c12dbb8fed178e0ad5fa0f26f1aebc5778d6d2828e7b8494101f6de7a8c707ca8885f2eefc683bf583c26b805132a8703066506ded38a2175f02f256c4c5554915b06ec89bb6a709a961ccce6d6e3c001ce10929d6dfece8f2b9b35f78200993fc20abad41a59b3911dd6571a91d12ba672c7079d0ee41ad0d729438afbeafff5fc33384f1fcf5ea2c5f77a4688780f80fa225f18549e6795d97843756d140a8f65f4d7da46e2cf294600dced1b3de9049225779bab08a152f2d6b6ccb0f050b04313d9736653e19cd9be0ee0c13d56bb8a6b210754c19c33d2daac01f827eff44b2a8c09f00e5ca2771e44ee0a904c9e3b86679327e32f028c975785dc763c74fb4409f2c922cb25c33525c63c4067807cdc1a8c462e9880b3ef8f2e50b1704b963d1a39c1e04fcc0c8b44e84025eb804ec1996b76f434ad42fb872219bd1c11e8b3caed2dcada4d03960f4d12effa67d7d789169ef17f7ef50f0d0ba4fc8ed92295f4ebeb0de42df4ece9f8198c82aea3fa6316ef6ac74d51eaca981a49888020691093bd028c19edecbe30cd79afea0244541f02532df1434d139e7325ae4fef411c379a77a6fd9962f7b5d967a13a041b70b4dd22b9424d1a71588c5fa8d3788d4229c514944cfad607471e3611d1b9ba02b4ef43c6598cc8c3c092b484a09f4084c27fc5d3d29f717fbfae4c46952fae38893e361dabc51001f9309dea6b9e10f80fc89b19c040e70a1052ea6ee32ced77c93a8297badaff236c0a4029c14ae5fd4cade7e3ba817e562bf96997b7e8fcefa3d87cd5cf3348f720585e25cc5ddd0a1e4c90f44507f766b9833fb463b815b21c7969313f4e789707590596f99456837af38c906e7730b37fdca60550da64f3d3338991028b726be211095106595e0b05c9cfd0dce80a2baa35c9604fc4cb8283d40614470c18fc33f13dab043cb9033be734cb506c4fbb80dd5f2dbf88fe1fff25b6ac639ef64f7bbfc374bcaa8479de69387ccdb632dc404b7156e1d6c129e5c481061977f88269da288f6c68a84815739e4805228fbb59efc50820a1bcbe0114a8a8350e84eee26b7c04811aabfbf38a212bef8e856ddad09314ddd1260ac284207ffd57c697f244427f612309d880c8e6651e1fa07e5b49fbaf89f823ab54c78cc816327892af95f93d4c06351da2724bd5f01ebab637af9e62fa09aac39126aa60f534460447ee16b0370228a5937519250d6cfb173c0e86c5cba6a52276076c00a15df39f3b7aebc90af065220b2c465fa2cca30d79a4d2775be479dc36ab0d3bd8d3bdf24dceb9a8065b36d64e2e2607fc44f1365bb26d8b7cb2c693dfdf3e00c9f0c747b18d886441f47b6fa1eba38d01c5b0e0ac33633e99760e1a5beb475ca47baa07a9536f51ae65f1c4cf9762699735d4c4e23768c0aa5cb48681313364d5b46c37a728035cfa00440e6ba8a387c7fa12b52daede912a6fb6c2e7f4e8c59d0f65512bba4b1aa25f896d522bb5355158f88b5a8d051bb63c1c9f1f5c225e3c9188e975306fd6b3797efbd7fb97a4b319dd7c8ce7c5567200f27290bbc926d3141f7840bfca1772b12b9a27d91ccef2f4825ab09dedb226fd9dafae2616cbb161995f2f1252f957b0bce58642046cc41872118d5547919b05d229ddbcca30da9e226f26ad9d80d9e0b0a5554e7da99ea9dab75362dd29f5a5148b76440db881742f14ef4342f11ef75980345ca3dc37d3cc0c201f1107fd286e83f8cf043448802c9f63bbb9ac5867c59cc19fd5e48d5955b0ad82004888fb2edd1aed1e05b732bd8aae48c06ceb471975793210f298faecebfee86508c3d5f5fb1c9bfa756572fb26751dd9632bf902edfaa621066b3063495d2f05ba50b2bef5654b173ff3bffe5896920bf0b9b9a01642eec0f5d6c2af7101d2fcd36e930575746149a0a8fc57d8b68d5ae56a6b799346c70ee1ac0850f609aa44ec3fb7fcbf5c95e6ac352f86c13bd0afe3e8547656c2b197a1abdea06bc1c9e02049cf0445f5ea23a07dec85f69776ce5950fc19fccead6bff208383f8fb7732b44d746c17edfb638019883a730b7658b977aa84d871239010569b66795cb010776ef6168ef56f5665b18a6ed3e6e2b045b9ee944da5fb0a9f855cf4075d12c49dc78bc24e5932ae9ecad3d3eed88d340aee0b6bf27eeffaea3c29c664fe497fbb3f632e4db65e76c72b74fc8da3326f83f4a2051c16584907599c66989db10bb66dd1ab6a6bc59cedf07e9deed1a1662d06b801103f431873fc8e095fe2646081928f92e5049ccbb1632136230f1cf436660930f2f444a349b66ce69060ad5777341190937d6ab72b562da7495864b5abc8d7bd462eb8b2551d87cdedc550c804e7e2f0cc8476ceaf40ec6689c83d9c4ffe9bb902b32a3b74d289c02e64cc3639f64d6c9061c9cce2fc37280c2211d336424b76ca50196e311f6a8c3e4b0d4662d8243c51268ae3dbec677350f9c4ffe1b3b7052d09355720ff1ec8d98ee97290db4d18c1e1a4537399e321799626346892ef2ccfc41fcd1eb7898f03a1e6a880ee3172990ad1326f0cafe3a6cb8eeff4a98be6377308f6ea51ebf62bdfbff01f4097fb1b9f63772f9254d8d45ab0ac6bde37c6383cb37af62479e813fa5427c2a41f0a71a67df44e9566a2031f1cc7202eab066a639c25cc4082f756346824ed75754ef34a0992a530e0f0f62ff7a456c766839d346a2a14b33065427ffc214489f897f481bd5a7dc2bea5e5443f8d3b2966e40784e859ee77a4d7861305ff22e2d7ef9f5ab0647521be4d4837c9d7c27bc6c102118a9d274c6cce4b163e2b133beea8103fa2c78fa7f651ae1af6aa3d5849211bb47acfe41262239b34810008b80b6c08111a13b60c90f76b19e34b969bde2254125c31272c2dc337df317da945f2d5893dc090a95cd18d4288005d416e20a79b737f8eaf2602dff47ae1effef3561d0a8c75548902d25faaf0fd728d9df5d623c914c3be0bfb9dd65ba750f6288b6084c0364d8e3e1c742b2ba132740c72d45e3b1f5ee0d93873796f1507323f2cb0478bd513dc42dbf550f28739e4f739371c104773e44ec0b54b541d34ee292c49c816e0bcbad6659d3fadd892d1071a677a1dac2325b09527d69c6a2129c2b8b29b8d93344a1a96b4bcd5af13a880466de287f7e49bc74cd13099e8fbfd95a13b8cbd0605479bff12bea1012cc920613701b937e234586568d014b6232c54d8ddd2a1a5089a66a976b9e8c85e753f100dba7d8a8aa6b047954b70b664cbf533145eec9dd1882e6c81c19915d2d819df81b207f5f8007dc3e7705f86bb8f20d5cf42cb071370cdc9fc1994f14a62c33649a4117981b602af0b807fc49c37488e10ca78ecfa3fb3e445d060ca73e47d76748b13e123232d203f0100bdf2a30e9fe4d0e3d6c17e5170db644e0fea55490b235409395dd0582715cc2388aa6575385101167dde47383ebda9d48ccbc9e13ecca8b01662ca34ce0de99f9a1dd7536c8cbffaf1ce67945d43755fbdab2dad49ed342c045d9aa48909d99f9fc3dc81209c04a652cb01bcd4c5c7d28359a923600d9dcc26811f3384b9c931c01a0f7b3e7d82e55aa0721769c02ae43aa2d268769019d4140d77fbc5e39d110e708b9fd1066566ba48fcd0942b7069e70c02031debaf35c00734ed89803854f905c262c18ec5b01b81464409ddfdce4679f7480179178c611b1d5e69dfe80b19330929baf57a699ea458a8791a3c278f1b4cbd1656cab4143e4d8aba925f4e1b4b4a5d30aeb2762e258ef9416d7720160e3d3d1e85a0628b16a53607b59c014fa3f8e255a905fb5466565388dbc2803101fa5193a032fc42638de9061347ce268061b4c4a176a93f9a6bbb37314e8489ba90bf497e4b2c8339dcdbb73a63bd4107b474ed9f2184147907203da4941100670fac7ed561f6740a2c397db96932ab8ffa530fab7e74e646b13c52a23a78aaed241e020026c2a7f719587f7f9e199039664dd6e3c9dffa577904a006e9c79e88803a7210629de38e81bb6971617ad5fa318c10f4b441c53d290aafe96b4e8a2118ca4ce865f678d4e6842accf5ccbf163fde5a950c1d6332a34954422748db32602705c176ec562d6e970598f56844977091a9e2714849eab849dbac1b188e952ff1f6dcac0ec64b3ee9ddd6433bf33d645d82824f67f4a3dc143d2e8afddb71cc07aa10b64059254a5d303b13dfe30d0b92bdc44686467a53851d819fe0d6276bf5c443b8d523834124334b096177695d376de637cabd9e2ee12205ea6faff7764be78d4dfba024ebea773b396b23890e4e922f43a14cabf80cab95843eb31bf707d57eb22b69d2e59aad201a582fa5fef29c230a13912635933f8780cc57b77a2eb67ed4df73cc831596f8489972cd2be0b0c7d016dddbce9f2e0505aa937880349296dd3d84c6016daf42e60a194c57f3fd0a3d0a0ce45fdc8fc1ef8b1fed74e62c42bee5a069e1f8ab1020181ebaedbbb77996a8143ed62702d22470adbbecafbdc0d0aee3621f3a2950ff05dc23a444908624013bc103dd19471165e3d9e85a72dac0262f9cd02b84a1714f121202b5a87fe442ac5cc11577507798eb8b3784263cf0b901d1f3e2a56f1b8f8c67b3bfce5884b412d96ad1fb4eab0deb3ba0ef09410d9d8cae7817c1424d857e576b3c92079935ec653841e0197d308a398bf1c904563cf4d095432c14467aba78e786e02bcb602362553b5719f52e8e7734abec7c20413ee8ee9ca7e825cb2b5e37717988996964c8c986b4fe60f71bfb7c1f196f174b74eff68ad02f853ca62faa998cf30dee1d429003b8630e97d945ad40578a8e9ff12615cc6d4f63541ff39da3d945107bf99450e1c3bb541f9aeb4fe9de8334df33d513108e3fa630e6c70292ddf40c02be5dc27b218856234cd7274ae4fe1b1542c24afd19c5144c67f7ad3ad1a890160fbaa70cd05c3b2a0c586ab8a0678e67f1536c565945da4484f814e7e0872ec3351a04059c01d65e092ba0ffc637c33f53daf0e0a21d728262ce23c329ec4ef1ea49f77423522f4e2384bea533589706f0d4254d81dba49cdd0640a40b6a40e8bcb8c175453d63d3006228bec3d608af172c249049af84076c9b33e802b0fb295e55725191d9e37e6c6d35f51ba5d307ef98c390f3d69b668634451bdcf52096fd8c36dde871945ace7f9054d025e2a22597d9b50387faea32916ab25678baad1d88c1c3187f7460b82b7eb9334cd07977c1baa319eff043e673d9dcbfc9ace18c0015d533fd2da21375ba7f4b6d0bd388c04b201e2a394b30d2c7d6b0e3253ed72fdb4c29cc4f49ea1ead7c4b965a9aa9cbf3d757c1b9155ed6405459b29887641fdbf42ea01628f1e01a84523569f121444263e1124f2ffe653fe75bff244ea709cfcedd0a19677b1a826ee66c13bc26580f7621a922797e341ac338d4d1d61b1b6de6e53d2441e760d1b988b06380982ed86c7bc491d1c3cc2e024a0bdcda7bbc2749fb3109d6c028fa45b45080b298f89c5003f8dcd07597a4262e1c53b967b78773e15ab0c0a8a10bb3602b815056514806fd9c495899b657eab6ea0989b3e41f95a323ede4ebfdf3ebb03d5008021addb684ff7ba0bcf622c6514ba196e3834ba14fa48861fb5f839217027ad09537032ff420d3efa7041aa0530f813060fe6b32ed8a02132e4cb715e3bc7fde20b0b42608976fc332a8ab64eb69b81cd4ba14257c3613a59916a1f6e95fa5533c6acb40c4fbb8b907def07fcaf92f8b6b15fe2a6bd35570e122d89dc185a625dd65bb7195e484c7c9ae45031f9e7e5f53808fb91ced19d3661021bf68acdfb9a91d50317fd326e13010a910b17bca04605deea289dc78d91bef155dc4a9d38f95557ddf451a59932bafcbf9bc7a3428f7792385d95dcc8cc27e55ca953d2e55407a7b9646cddabdc8910bcabca98f4babc7184d629348b35115d1116554a3920630afbfaa1cf7890149b44237e27d403a194bca0c091214ee41946df27b136b668e420a819e98ada859c45afc4fa0b4744a9fcddbc20c49c912dc62527ef63bc44b814433a86abab05766c706ca74edf2acf30c32b58143563b2091ae497d8a11d476e67256e3a94e5a2a88967cd2aad645041fd637f1b5f3e4d0abe8315c8400f270c5e22040fd77c35f5109788dc87e1d4a329d14c6221b48c8a14ab3d0b23c38dd758f0080352881ba1732756b877d209047f7e6046a47b3e5bfaf11720759a3a868691a052eb433b7e1842d0eddde6b089560c770595494ff3e872990755cf284cbef4b5e24cb8519f7e93ba9b2ceed5c9bbc69f7dbf526573de132db04ae24f8e0fc0e8b1f333c27cd3fbcb1463bc82798d04f461cf3ede1b2942625f179a71cffcb3777592bea27453ce2731a9381a89121aaa6c4c075bd24d62537e6270a1fc4344fe26ccfdd6a36f8f91edb57ccba2ec40f84709c5b00a70dfa259df1adf8b245a4acbde550d5875c30dc63a36819486347fe4335384d47c9f23a5d9f762d924e33677b43cfbb1c17141254da0463edb2d9c0e129e73a68d65e82ee55b58204206c963445f42e4bffc9c59e4081ec7d8073c21138b53e113a09eaf38c3c75550111750fd7497f5b1d97c913c7e176d9cf216e93fae9ff066088726276c235cf25ad0d5ece17b2072b50eaa1bedce0bf6a306282b6a4e6f3a3376cb41f1a26d9460080f18a714c401afd7e8f6233e8fedf813a32dfb2a0f89cc65a386a06850218640733bc7c24bc8603a4ca7ead193f28723fa6ca83ff85895e6df867df74dee44c0506661915f9397bb04f0b7dfc437fa74e03979ac17d4cedc1c54557131741bdc2caa54cf15079d3a32d340327864190495dc6a15b79432331757367034172bae407b91cbc1edfbc6efe8a2eb58d904d03edc582524bdd41ece1a3ba73b0d662dcccec53955f2629e17f16bf9b36f5e876225be36c5b32664cdda8ff7a2016a5117cf5281953c285877f11aa817ae4507a1e533552599772c15e2e5dd2bfdd332ba43e26a072adf35e679d5755a3d0b6f6c0552741dc7432a6938d630d70210e00e0495d4ea6967c34182f03e6de5cfe8104163d20a6dab4e63bed03f1f8055da539fab1ba296e2292645a4b9345f74a06ee522f659c850bc8cde61bf70e2d6a5003569be8d6162b74776ba1f3cba973ec75cab9ebd59511ac51e80b522663c5bbb17f77c2b8906b959c8608f077c2ee883efd786d979a23c648c583d5775e01015e5acf3e8e848c7178a4f521d5ee41e8cdf941e8bfd2ce70984783c0bc465a2dfd9b2351c4ed02d51136e54a71db8b6a63830260187f9c0830f5da1b50e6a3a94c37639d7cf1643f73ade7ff3fb718453c75c6918cb662abeb0f9145a8377cb22efccadf60051d1b8e82493df996e980d4550ed795e49846c8b2e39cf3240bc2ec6365a874e569b11bfff33f29948b1f5a6d1cacad9d80fbcd0a59dbdf334f6c9a7a76f37a0deebfbd446d7256d9089ababa532dbb72458376db1a4c8c6a8a8a0f97ddef0a9b979a85917ce14ad6233b588f7a93db10dabca24685c78f6909ff8136181370ceeab052ae1959ac36cfa2092d9c889c2b1feef9c92ec43879421853b4d8c24fa7f6f85533ea5a8a1eae59a4ed1fe23c87e8796194580922540b1aa199fb67301e14a8e9759bd807f4993041667843824e4827e89329725af4cd7525660363e005476f896cfe978a04318b227f910902355a10e8e48df8d7558c7e5a4883abccf6a85a31c7a1623731e0bad7e9ff5f8fcc3f48fb665585dea285840ac1fead983b687a44b3912633d2d5042b2914adfbe3698a6278ceef7ae35515ef18f4031edb244d088d80b07344f102c4b0005fdc0154f78b10ac6687800a65abe1921cb2a6b50f17654144455efb251d347e5520b7ac702f6f2279a4796e512454e65c5d47c01ce5ed55b9e495620de78df88b3bd9827512fcfeb0fa1f4061578eadc475da259927d7d083be719c4fbedfb03a5d8a4fb9f62bb06c46b62b1bacc54c0ab732ac073ed5cd43e7b70139ce88aa64b467eb8b486da854d3eb0c7101a18eb7883f3880c91f985772b49a21884f0b879f8d1238d7680be22fa67c3f64b3c9af20a965dcff9f76d139d334f05dcc5a1301f5d8c0ac5797d9425a5f5eb9729cb1e14f4b979fa746458ae001bdd61d0e477c2046d7753c2a8cd0186d3e11fc07021b6765ea52984222308498ab924c51784b94822a60c62bb1a865b96b7d525a61df61c820c5c2c73a6a50ec76c284704d25772a78e8756627915365dbe2e7b1ce73df2bad5ad0050e6d824041395dce5d478dfc7adb4d04eb0d136f3f79a8635050d24853d2fa9c043f5bb1294bb6ed6072f8580245c4425082349c55e52492901bb2b26e25fec0e0751915037d93c72a771af0f2250fd2e3dbc1a051405d94f39cb998f662491b42b1b6a82d7ca3198f4250dc8622589c9c7ed51f2b232cbf11ecf79d75312c18b4b12141658617a73777225de47a913f9eb6733e3a60c79d134e64900bf058c8356022024b0d6fb82890b70a87259b5af82d883c4bb0c706152c0d8ce7e4876e7c81abaca439771cdcf4b5dd406e8a67106db92ae28d0ff3ae6c553c923678af7d945e5643076d16a125d8ba43a00c3e314a714514b850b423b212f9ed9c4c896bf341786623e2ccd49ee0f6772140bdb4facf6586baa63c46a31019a483efdcf3ce9d3bf77e820017171a072bbc54d668e04887113a17ef7a2309703d1c056ca5345cd29f5520876ca04e3658f3bd4f00afb45464f9c3d77ed0f23f410ed3eab88a77eefd5d433fab089c0961ebc5c8e44174a4a58fd84e5cce612d1c2c99f1588a009796b8ba1fdfdd2908431aa76398ca99c64cc286fc3a59d4f4554cd0b058d45900cb3e09e0bb43f2e496a6069d15a7d2939470a27e6387faa602dedf0ec4fe811eb98380fb1d8e46f6686539efa432ddfc5effc0321f8ad5036a7ba3c8337b0e59e83cc6eefd113d753b38c95addf1b3c45ba5439f3f26376ad64f171f8792d151f2910a0611528018ebc0a15450c508b8df4ed8b277a9a7e49a4d4e1833da9951c71ee8db1cc9fec1e527a3ea7b4242ac65620a351b098ec5633b3d41af6cb35676f69a39809102e7d5f3a59308d9e74fda681f8af12062d867be0e1e9cfcb8f1514ff6308097eee7a25ca8d96bb1eb04ef08824a7f36dcad4414c19f2a6a655772aad271b9cece7076293942e5a74afc1f31f60ef8ccd066f4daaf83f03e7f46851d021220713df49152c19b0aa5c5bfcc1f3e481fa274856c9fa2d4bb3a0bbbd10078a1901ee46494ec92e592e9675634c8fce1d8d4560dfd79fecde8084a22700af635509f6acfe6be3652392bef67c7416c625801f6e1a8be13251b5a978571e956ae5c0e6caf614806f345e2f17674109a2964fb8291aeab35871a41e868b545bf3d98f8ddbac601d868ec95a58e11497dd7efa4ec9135c70a2eee6560df47ef6e5258c54152f1f84c0f8a2bf6d4bd72597193b1f19f39d6c817332ae4bdd0dd99b40be5696368e7adda9c687e7455b6edce9e9d4e820746a4e9471fba8ac7426f134db900f64b11a9e0fc6949ea8d31dd32e086b78b96e314a0c244735445f898852b7fc0688bbf76d9fe1c3cdead3d62c37f87e4a6cb9e88831b3c809ac69446783573cc250fde560c4bcec7b862324f4b376a2cb484d6aa8c1d7810018d0b1169b3853ce7222f0f04e2e54fa09a1d33b705ea7ac1bc8387b653c92179e3008431397864fafbb97795f5bf5585c50ee2b479efd355b020aea427ecfb3449f89475fc629b4afa885be1d8f70fc6fb09ae21f593b15f8a90fa1c3f38b366c5f4a4dd293d66a35a7f873ba60195e175acdbd4a8cfdc1c9f05bcdc62d749701076caa75c2181da7276486f724a14fd011409729bcd945a67ec9dea7c268014474c6b7724ebbc38fb70e8715666be362aa7a0fc61f8efc5863bec6f6fbc8984c8246cf3d49fbe27facadda9126c9cb0dc3cae2a346171bedfc98a6ac9ecc2298f23a9d4b65639f396fe5d1a9166fc39405e9d71b47ba6baaa3d7487261d90bec282f5845aee359027a2e20ccc979062880103a0996348148a63d814b7ffa83186fc13543111aca4c14f33ae67b8ec3651ed59919b7300576ed95aba6615e6c80bf463b13e30a5c644dc680aff4aaadf72baefcf3415ed9f3e37cbf90c539231d38ceba4de0ae2e2f1277faec8e95e9eaa21d440f503ab02e262f28657187edbeef62bc10f3e26781df919273b95b6a39c10cc66ab1208e42494d2951259f9b01b8135452fccd440a433f69fb2e77a47c8d612cf096a125c3b6fae3c40400cc712a96bfbc0fd8d327f8e64bf7fd774416b30a3daa30334144dd1fe2afde4e1bef37abdb3deb73b508fc3c7153ed2d190e9f9645723f40351c9b49a87a68df78c3a5081e81350029c7dbe47684342546ad075520a1eea673d6da174dfb38019f6fe1200659410e5fcd70b16099940b1bf910675d2c6f53c55320875b86d3a62b3e1a92fb7100eab6e5ea55c71b058364be5aa69e2bb658ad1d2ae0c8e3c115f1d3e458d49f0227e41d7a824b6dac1d08b010e94c48b9b98b7a137c15edebea83466eac96d3fb78dc98dab5ccef0c2aa1bd4e21d9a04a67908c950ed08d817f43140f8829071cd8e786183bdde361e2ff445c5ea103df1de907bb74378bf953947002a3ee4a81aaf434dd58bd5e1fc57c30e20ce18e78469ac84ae9713a022363f2cc8b5feddfd3b69303bedecef2923a7bb07a1c448d812a60cfff7863e1679f34596227b84a197d2dfba42f740ecee6a4a3f8e59fb7bef8ea0106bf75cbe6bf3b3068e2b30ec3f8f041a43ccf1b8e6610eff1a86e1bb2071b7cc547d1c4af5062e81bc2861a248861d17594b05dc9912dfba0057bcbe68da6df0ba3e78b2eb293e61b08acf125c5ed56f9e09923f4b4f832b0c1f7fc2ac3022716ce2b8eaabd71493c27bba5155cf5fdf34666eed1d216eb81596a07f5e015fc82b7d4b8c1953f4e11153d5f005b76607e39ccac2a2519ed7f518fdbcea3a1ee380dc1014f99f38cdf95860e7d4633c8beefd206c6982943e39635705c115895d1a91baf6cbf7e4f73efb4619d8ffe25c71b8478a10c43b5c964147b212c7c75a274fdc3c56c4838758681bc36bf73bc628fdaf2663addc72ee0c5aafe150510b512a71b4569a6e29b56b3acb9c7b5b21273dfd59f1e7671bf765a7162b81f93c0bec53992bc21329e5717ad5c1699c3fef5b5b6b5c0458d779b7426a009673d3d3cb902cd91ce51295ba23b24694a63b9a763bc7c62d1c0fd597a010e2a5c6afe92ef23067719d3e8e2bf8bf60497eb43d982feafc2380d7e96e99b6059f8872c1eec24d63367c66ce3833264d90cedf2fd0376467fe8a85c795516249e1257bd317ea915fa9be0cb1882f8ed73f1f6aa1d33945c49c1174e48536255a0885ed9878d940c92b08bdf34306450f240e4e007ec0367ca5736f045765f08fd24a65230e460e06ac2dff099b4ec1956dc15292a575985ade96ef078bdd8800a09b66e1eb88cbb4e2f59318cb6b1c5060de2b070cae5d120ceb9ba2e7db94bbddb34d531694691ac008e0c760963083c197511a28f7a71cb4d12ef5927ab78487a55684576123a23920889ba76d4570c5d16bcdd7ba51d9438613d6530c085583b68857b86237a8f0bece6870d6c5378915cd9d0e1c09c9b964e66f1765b6ce0e54c1158aac10a729158014de466822d6c85dd5f95a83eae5d5fe94816f1779fa3846e46e8547db9a893c43869760112b11fd67e00b18f0d4b5613df7c8a66030ef491992c4a8abbea71c93c38d11499ad2941e1e9074b0d1958848197ea56e9ec9fd94b2ed667914d588591f67bd88805e0fde6ac41ed8db86acfa224d02acb5b3deadd2603bd20c50a78ec3cceac27a0d90c97f286a1ea62e3f1f8f056c799fe0727997ea7b25468511003d7cc4b8f4394574c81adfce2e15fe45655dd5e3a3ef4db99e40f1af14ab5c103391d96b452751f5f71d7e7aecb5d6fc565d7af8125b6a20f829604df17b0d5867f6acae2f2019bbc99194c118403886d2171d49d7414c733d88fcbbb40535a5267627271736e24297979dd8fa9cffd25517044a11977ee726a24566829c2a6c8b17202823342f85c9703fc980216fb5abbc3e0b26be912acf33b81fd1d4c7342aefc367f58a61c2c643c87494bc232851a95e3d140bbec94fe2e02c0ea376cb6b7c1efca0a96b9b9267a8d95b21bfaea2e54834a0453a8fcb353e5400911b1c9d111980783bbd98fce6b0594214b0f5b9fdcc2f0a0465779133360eefb79a1a70649d3fe48479d55d1c2455ece4749da8fac603ae5194256e3f0cde9e28323f76a96ab6cb66996cb4aa075dceae51ff3c7354f9437822c149eeb6e24157b0bf07d7412f4e8acbd19c1d1055bbee5a388acef12975c8a9b673eb88c9ce4a1f980e3904008036ae7531066c1cd8502d6ce236e05d8f35ce2040fd40d178391b59ac176e6a84c621521579b415b09adb0ca4cfd2df629160838e2592cd3cde82495211ae6e3314e7e38866da550d676bf2e2d1b369234db6e19cbe32a05ec3a7ef78181affd9471ab53a7b00dcaebb830ee38a38ae609e50ac4eb20c0e365ba4fbbc473fce864d02b418556440154f1e0c1e177c4be63d285f789a7f6a45c3d4481c984cdbadef904157f9e5ba35855d383a39a893f878e8295528d207630bdb728e4827cb3b7f1e38840868e9a2b4bc2f7a8e5fba27c193929e7d31e7469cf09835094943510039c74336a0bc4d36f0078a454865544358d95cd36eaf3e419603a0751adce017ad32d454e141e63f1cdcc9da79d2b976fcd8ae1d7ef174adbd371ffbe93df5096775f5683e8ca8cb6eb5260b16b074705746536c65fe2825f727e6709883fab694b5a6678886ae9d9f06f4859dc5e47656dedca27709f4c0edb0da0b32e72ee8a26b1d776e36cc2ab2373055508030a20359746e7f6d47b84edfe4b195ebd641b0627796cee3bc1272657b5de9d8042038887cdedd05e301e66366e6db35c352bbdaf01039aab20aae6214192132aca59f1c9a29ca16ae757fe7b5e8b93dcbf53c0818a802c7479fe5906c0352510c6335a9318061c89096aa94ca2d72c8f417f7ed025846e5fa8a09f35db962a062d447f56d5b2e9280ce1e90b453be56121dcbea1095d2ce1d9ce0e2fc096e12fe1d29c42552612b3ea6afd7ad0ff8df350bd98bce2954e8e63ab734e06b7a6223336c461e892c666103018925db08370949cbea8a3eda1ddae8d40cd7916315702ffe13ec9805edb49ffa05d9a192152c56258eb2b6d87f296be7fb896bb2b6972ae253d43f930e7fc79aeaa41a82ba9300eb9e242d57368b60617a5ec7387eb07459ae4da4c8580e73cd597ffeb6f38a8d9803b226f9d32beae2787012670f4531b936fa79c07e59dbe8a0ce1aa3ab0f20c8fff725112cf2eddc21391816218f65d9ef7ccdb940dd97947fcfff2614d8d8212d043c7328f8715b8ce25a503760c4b9437114632c27728173a9b16affa66474575d6644c2e9b2e6f847f30db653186d34d382e34f9cc46fda21c0b036a1da2fdb1e99f6eb7f54e1b7cfc6b00b76e61be70b50f6274847e57dd2ff4d416d0196d5b512f113feb3f015494ff0d3d35471d1a763dab8f77f84f0761220178c52a84bfa85d1d0a46c89258295638f9388ba47a6cda287fb9c30bcad43407fc6b43e0ecc6838499f62f954dcf2b5adfa24494314f6d0df63d465387bf2a3d619dc66710eab72921dab99bcb93ceb14ff9db761fa7d08c2322f4db2c57e5627173135aa00de8c028d76abf91c1d04f03cb00040884fcc534818c3952474e9de533168c3d661d5cb577162b36d4804a0854d4aff8a86136cf6884827fe0d25b9933645faadbcfdf6838b62ce870ac82e26c050f16d6544e285d584fb06b96defa107fadc33eb7b3cde7037fb0018a9f4ce4bbd749e8e8d8733b7242a5dabc56da401897f7a29d224811d6929a0af0bb40040671a04b79adb9519ad0e5e7bc270af3d99907149761febebd58b643eeddac1f9427d5efa6ac4ae4c67597d0b55fb6054b4189f0d805817f713a8827077c3b02823372ff1668d1f8d5b5b23371fb4328a065965ce808f5fb361be1e8b2c6da9d095d1606fbbec1c683d1f78e4efca7c9fd97bd2775c2f17697266b3f4b5506959e5879aa3688207dda4accee46368459a2921de038c0e9434909cdd4a33d84f487a8c7edec2d2b15e41cd9ff04789948b90e6903ef924439bae7b645e1f151ed0cf933dddc9491cd8f87059d9bbaaabbfbe580928241fabaab500ca7a0bf5db79f8559647ae57eb43b4d43e969ca099b2efafd764fb31e8732c28617c0a214515415e6b337689a65e26d0b0d93331d3244f8f98da475986426977e8cb3735c1d235e62f8f6ecf304742149c8ef3edbacbc2bfca8753c130d90335fee03154d105b299391c5697e0446b6ddc20619a35b5b3bdbeb266b5f75fae99ea78c4a095cecf1e5c525dc8aedcc1a10b043ede1cd217e85d84e6305b2482fb81f290d9961dc18f8a9f6ec8f30fefdfcc5856d35769e3a4018612c423f47e6f35e89d38b9b7160d7562c298f07592e31f2e9ebfdcdcff283fa3ad634699172778869713d810c036f92af7304ae5d9d3dd7e7640cc522a81b15d62cd90616ce4612dd32a66fb574b7add72c727320f6c5c54363dd0b1abd3490839ba11d44fc1cd56e805ab7295c333c4fb2c82ee82aaa07a104039e1fee0615fea33dd370c998ca1411b44b7a284e9c11e65471cdb2152590744fb8a4f0687eb2b4bb8fea4624458d402bb75434d5ac2a00c88a3a0ad5cc77f56d0063df8bca1d056783a957e8a48e2fd98f5df152514bf196d465c14bb6e7c0a70db57a29c664839f5e8425eb7f0abbc143e7604057da65b589aedc93c3641fc2be95f64a9d68f74f40e0573196965a582ac03a4155b27015bc418ea3ab97bc405e91c929a7532c18681574cf64672ad107619b3557950be6939a2752e9a3d8a61bff6b0b3f635476ab12cd9495ebdeb84f1322a42b1dafdf1f15df492c6632d3aafc11b67df72815c593e4ecd1965c8820c488e73737210e9a1014d3dd2080f0b2d04168322c8f0236345df65e9306c4bdc605c77487bcd82552791210228c7783003d279ea1f13f16606a8a30d2c05d10b237a05996c882bce29db2930eaeecb69e91a9ae8f34372abe6f55a47bec59e4bf92fe80640d7dd37d0dc39d00917bfa0f98403c04db051d0af8531b6cb476b81ff6d4b5df8c1ad418708c43f4a7bc395d083e775de7a8dd718eaf61ad287e48acab1b18c03fbe10b9af2942119ead2c76dcb02f6aed74836067e10e035be92f1c3e15c3c1f10c00305bd00ea87973f076dd229197963e3707da48379c6cde9326c24db4b8aff14f87e72f922b12690b4f3bdef4e3b2a326c679fe02475d778bb956de9ba600ea1a93b30ad2dfc482d47ae60b7cdfcbc1a72bfdc0cf1611d73165b6631389b9821d620ebf15f2cbf9094f2d9c656d09358dd901e2cbb2ec77c09fc3b9f5b11d56d737e551961a9b10797ae43b55bff0382c64e98d8883a60974536b04f75d06c7aa34072625cdcd2a98c490c7ec27959d66af8709af6bfadc98884ab097d4c492ba4e506edd6f7846a3e70fe721c043740a14f278301fbc72828d4ef6cb4aa3d576346f3fafe20463fd96756a7569cdbc3c200dde8854abc799a1ec42990a31ff5dc69ff23b8e643d7d3e8b2fed5b03783612526f2bffb83edef6a3e9f15be1089b65e47d45b4cda4c93c5571e2b80534ffcbc9add2906f309e84964b1ae17325621e93b6a606bf2e5519cbb25dd33c5a5b1d2d709816a802b14876d727ddbab4eff498b01de29a959dd8899492ce2a3d5a69c22a4b7e093a411303f98ff2fdc71cb8f10e595dccc63d6962613d3576fe218e591461352d22c20a16ba4b7c1f67d29ec87551eefad5c675eb6dfdc7d5f5feffb37846792a815203e23ca5a6fb08bf5e90ffee694bf72679da1a1c46281bffa7569c3016fe9f894b7ecfb130491347f079001705e6764dbf82387336fae6e417ce8e8e1e126c398b7da0ef0ca3bb0dc3b271880678ff9d6d4a7f739dd83a02960c4f4ef23e38ea855bb2bfbc9d9b9557145601fa9827ed2f8be1da39690497eac2659011c396f288f1ecedc98832479fd27a321558ee102745533bdd94e8a705aed50726d6e9cc956bcbcb6d12fe1685e5c8114e84b6bf76045bc8c3cc6b5e96166c201787003ea1724a07b463d204a4abe8f14cabe28ed8f37338c8a010776b933f6ba903cfb6b7033ee44d9367e8890183dcb372bc1cbc1ca2d4ca3b0b0610e9bdc0ec976e173da684174cc595163c0dd60b5476a46c52f0b23c2fcd0beee432c26a0d7c844a3a89cbc748409afdbe3d738a523680826e484fa19b675fbea09a429a52a911684143e7119c66475f3ed7f2e6f49557e51ccf2a1034150f5b0e8aeefeb65bc73223ef073d149a25394b915869baf9c9c9a8d1de2e9ec37020ab811d46f4fe85b5f3ddf50598dc5bbfe83bc67db4dbb697555cb1d0d453bed9e733f59f78a442e5282f8a77425aabc92a3891f81c71c1153fb1851f1d02ad4cbba22f350d4ffa19aa40c01327bdb7567f7135a1ce47599fe6d991dc135db814c8091567e79b1899e4dd51d497d672e587c95bea785faccd110db35d685bdc47f02a1ec9fff9b051ad8f1bd469183d70c4d958041c424e282d3c90c6a0042f8bd1fd95fc94b69f791035235f5c63550a388db71912244e741ed43927c726070b8f5653af867af0b0aad3e5358f2342d4024d52afe2fb012edc67bb0ba5e50bc91fd0c3dd1e0584fa2d02eb7d9bafc9ebfd125eb4ba5736c58badcfec83df838ae00b81cb1592bdc2349d20e85df381111c7bb2a2db7421ae37d380db353538939ac2a22982f513f28597b9d21b96590adc9ccb14208df5ca43b778ac55e5de0e96870b1fa292b5c1734a6a9e5b948147ee6d77d7da97993b6e8cb06f4f5e932105fbd546bcb016e2a0e4c32a574e36e83fd695c3ed831b9e4c4d0238883cfde55e6df5b9398f951790021f4b717ccb24ee30e6a6920c0bd6cda87ae1b87336218600284bd40a9c33a9e2bcc14f1b643b06511dabef7b262df4e734401f3e6869687d01cae01ac0d7365fccdc94d36ed02773d9e17eb95f152ddb09692ec74bfc30e4c7ced52c4310cf95ee155f2ba18f405983b309ab4163fe0c298ce1f87d8d660b909ff8625ef96992e852bab6826f79d31bac6370616e24ab6adeb002f5ad7755cc52780cc3a655a20655fc1190e5717ac727d30917e2fd3028609cf90930a91a49ac5d613a62eaf296fe2bd0c90f7275c884038e5fbea2db50203ede83be66d76cb4d4762696d0507e8801c7dcf07d763a4e592dc844884ea315491fa607c331d551d0177bf6c7c7c739f921de25c314eeffe70212b64e4e4930c031180d6b362b488c798a4717b203d9171506c989b0e827337bbc4993a1dc77aa165028bda8170918f52faa0263cf2bf2adce04d6060e6483ad5da51aaf1be566f1c9e972d2fa282fd8219bf71de6e5cb051d4a1ac257eb4c939d687031d1730e98acdbfd999c332c8903d8b85470e8e150392625b755eaee890991ce563b8912d72f58d0b246e4426f88b71af1deb68224036c3b0b1a2d210ff68755f236904693cccf56b0f21aea19cb2bde9cbbb6cc0e31f9d8836f284ef85e1f35ee67512a0a421816d49eed7989a96eb99d514fadab4744eb7b39cab0d200c840df7c04abcc26c57f33e6d989df9c9a4393e855a7dc6a3673ebc1f6114d9fe7eb8d52c3bfe45ed243e6913d46b55fd2892ac7092d35cd16663bb35e92b061b8d4436670b14b6cbe89ad15001c7e24a9a60c501e75fc7fc530f879956f7bd90437a6482c294f2023606ae0710c5ce2b7a15b22d734b32e2bd56c2eb668dbe51bc9e4c327f1166a1515fb0730825ab9a96143d8cba31c10575b8ea3a045723e05715ca13ad38262391b1dc4956debe87a994702c83cf245db36b6aba7c6ac7481561142f06dd7c54761657b21241abb14c96f948ea883c4d28f7b8a39413d34ed2a9f6e1615823caf4827d780d7375f49540e852791529f6fe87ea03d7132b22beb5c9d665471889268c134038a3647f3cd9e406fe36c2d66e895b27ccf70df9f33cf3ad81303119352e89fef4773b5d9e74ad6f279b9c9aa8c64a6d0ff68c947818b085ed7f1c300fda2b23857934686c0f25bfc4ac0da94ac9feec73923abdc5759ceaf5190c0f8a27218b4be9ac04852f0a3bd17cf1e31360a2e1fe2a5bb610b3b90c601b068e16e5455cd4766a76a5bda0ed2dea77348c889e6e5967a87aae3741280465671b1d26a6425b7a6bbeee9ec02cf9dca2f054d2cdb76e633d325aebbdaab8deb02d0d6832c78f10350b370243f738076d3c541a958d8d365f4ef6e4a0b9935133074166395a62a2873dd0a3026cf4a06c4dcea60ccbacbdf0f2b2142c903eb3fea461cf59dac3cde1660174aa775b0d1fe277389a824ae03d1d3221dd9d1ee9eb395a8219142d90c7483fac39e61da2edba33b5c3bb6f3b512805d589b750f2a426d6e5e8ec534160537ac26d8f848ab5dd7362acc3157a8132c47ca003e81829822fdef48d329b12595e16681e2bd4f03a954c815d7e5eb647bf138bb3dc3f1e5cb9e962c9509499b7d67fd2ceddbfe7ae9f5dfbecacc23b729ebfb03d90b045e19a843659f49724824b2c87cf6dbcf29114bdfcbc0cb2ae5c844df9e7f931094c6046f306690712ea1ec17fad523cd3bcef26fa927f6c32ac3f8a736c79837661169f7965c0b5b4924cf885bc1f9bff127afe0c78083e7971829790bda2a15ba42ee085933e732072589d4c45a1d4225d59f2416a2a5cc26c34fde1c25e67ab42db1ce4d462f57f8dcda9b199b3a8df8e3cfe88e0be45e4a1b0df55162e72f62500ca5a505bbbdee8300f9324c8e17ea198a7d8b8c4d9a280b3bf5e55485c2bdc0bb60dfaf878e7ce8c65b01dcef9775759460c02af1c79157203b61e0c955c181f06c3cca5263963111ccb692350ab969dad8ca3ff51ed31409fd7e2631361f909201c481550c25269e8af036b963c2f63d5aa95373cc137a676270945086bec01c1ca6e9508e8e481dfc1e8c614997697e77d591e4a54096b3afd448f6891be1f6d250ce98480798bfb7070b91ef24bc1f7e184358863df0a17929eb4ac7b22ba73c6ed07f1b35e2cd86a39270494cb7bc2754c17e46192841cdb585744ded0a62bfd510626b78490b40a0dc2964cba0c2e469a17903c79fc6730b09797f77dffbcb58f50a54ae0389fbcee2398054996b909fb7470da7c89be86112a0365780f9ebd7be5362c99cb29ce387307c2d7be6080cba1a14c1099783e36aa610e7ceaa14e8be02d81252f4e34fc41ce93415ffa08b6cd6215dda37b7f1f17811071bfe663eade40a24ea622257c4b369c0a6b9a41ef0f29eabf2e67494044ac6514150b8a332fdbce672b037650ab4557c5c1c456314c37d20a03d5fa36d8a9a99d74c18a6f01f2cfb3efaea1c6329d700cebf11eb02b1f58f84475bb0209d5c6b8f3027e99a451047ae506272ef67b114595e5919284980a455d28763594ff31b2187ac98833d23d87548521e5e2e48fa10ec062e06b953654cc5695c64b13a175df385afad299636fde8ff82de8ae9398daacebecb24be09c90bbb9319473e4c3f738ae9d6ae0cea5c8a5068eae61d27f094a635a1bd2656a2f8e12188dd87c0b74020ca7d54b4a859cf3e43d06b81e7ac6abf2a7f9a79838608e968c949bc81c92b04e9720a9438b6f4e6aff4abfa7d5363c54f3a8f7721d369eefacadd33a8d388008b94a8ae6d0654be6a53025bbab98e041220f4b04592b186fd616eedf6668ece63c248782f3f6aae45044a7e41d1bce79e2072352193d1a744b58a3ed057bceb73e3a35dc6aed0af056dfad1f84155981a707af52278318972f6e4e2d09719807b382be79ace9932a8c3197599638b38985b50c55268642837b2654a26a0bef3bafe7a51a9671ef5732698e6b49fb6a9f9b2f6535a3431ccdbbaf58298afdf40543ce9a5cb9364937916a2ae02a1cf3339241bf25ec3151886eae8bd4a35bb79af2020bfe230691c91b63e8a5b1d521ef9a8b2c1b7bb2685e76de6ccb2556101a1cfc8f792f5635dcff1ede2321a0c6f60bca0c84ab120197ecdf5865f22bbe270d2ba8c54cb2abbdeffb2676457493e9653b4c4520694723827b1f757326b517b4f223f5db4d343b962699d46bab57a6d00b413478cd6e54232c690755118145250b55ed5517dd96c2b905d6e6df49965f193fc706571c022c7822a6310f315bc97b2adea2645a860cbe379f6ea0214b86ba8b08280be81479cd71ca0117b8154a1716606022dbfb0a564649a4ef14ca27d7f7423ba3c16af34d0d8f82101b9a9a7d6351eb76385195fbfb8a116b97fef7f8d24bbaabe1647d0e076ff319dba316325f84d2b74832546d1e209fad2fb8dbeb9068a83c759ab181e46058014bdd11c00a4e42c26da8af4e6da36d9abf77c1ca0ce5c36580f6b039ebcba3b5dc6f58ce9a7f2286b8cdadab2607a07895de6ecc8c53487cd76f7def709f50bb6df5917be39d9e2934769b1fc184d107125ec66a713314352be8867d3c032994c67c7a9d779a87fa0a32d5278002cfdc88c9ab4ffc3b5395b78a5eb54f06ecd85e3dbccdbb35f124bd56a2313d0e9ca0451d98b8bd0c2fed287c04953b9b353aa221f21e5bea8c9f09c99f39b5f4c90cbd19175d860c42c6f8cd03c7c8c268f7548bce2610b736c3360622e9e7da925108250291d6c59001d77667d5c5b5796491280baa25fbfa8400040581a5844e9a60e85d18c0e6672060c9870090df69bd8ff50083fca310849112a56bcee0c415e663d9ffa88d635d8c87e7de0a6711081290f73e7734106ce80f4c1c4498833852b187a1852fce10d8a14fe3f331e7dfa2a710457d2bed698ed49a1a03211b7520876000ee5d77c08bbcf88ac7ff00f41a830773867e1bb6026773cdc16c04d6f232c87456b9d1658125d3c40bc1f23c6cc29c31d68f84f9ae42fc6bf1e8903edeff1c49d6eaed6e3dc5a53c1eab57a2efa2229823b02e88b4a895802f9c578875548d5f6f3ff4ea575f487649c8628545d50474e6e7b731132426a64fa4f9a13bc464e421b1e58a8dab50bd6615613e609798fa319bc53823a96709838229f1dc24d854dd47a994eaf64d2de40a44a196d08e0857ad63574013ea9af379a478006d8258bce6a4f3fa0a5366db81fc18dbeda6e5f644e9e7c6b5e205680232583f88cee8fc9c5bd40c73fd54a8bf2afef5abd7513b7ce1864d0ce685630140a86cda620ea74d49661a3d254aaf8594bbb3569746180122bb56f161bea7a73dff8ab3fc203c2b92649317e9735ebf992d5313b7642bb671b60de47625c89755224996c08200c98c061b378ea1349e87a228b826544920a75061f0b80ea76527c952a84b164afa6a00b52471c8714ce02dfbd88aec48f72ab7b39a22fa3a9c846f9090371b0067824c51a5469aac9bc6f8e542efb481a02fc59f6deb8b0bbc15104e89d5942a8e748bd750616abba5285d5eae7e400ddfdc71c3602ff130cdd226f26d8b0b649ab0b4bdd213e88df249708d844a69208f93e290f23f19caca6f70237201c247ad2afac15b5f75277551b83ce5ae190019f540baf55e7af504a663080b2c6777510eecd1c1f9bf8f570d4b2c4613f13181f7667713cd72c96a789770fdf2a30831f1716687637146239010b629ad58903e6e29c84b658e1986e2429698b5afe98e9cc0b0e058ffc827e27c5ef97f666610b3fcf6f72461480c2ad1900158575393b9eec7f68d05dcbb2c756dbc86f903df0f3868c742f47fc0ae29861219a802633577ab7f068e0e5c2729ff60f4327aa689e47efc76cf62150ee297d5c85bf2633b3dc1fce114ec3d7fc84470e8c72790f9561b97d350821ea058854dbd15fd166356f70bacac3cbcee76714bdd0fc3918c51c8ce875a2042e6e5be45a1447114162c44333c23ccfbd174eb38accfadf30d7fc24fac0844c5ef1492439432c8a1c15af5dd270abaad2507fff797fe956179f4828a9d1922bd9b77daea86e84921efb13b154930eb50778a4173d49e94de69ce420338dc0b0a76287148cb552aa9a0afcc8f4bf693a79c58bebc87e48748c7dfd9ade58c19b7b33c40be48cf27456cc1611b130246f51478871761044007924fab67503ff5eb05d6b55148cf5a7f5c09d64b15975b05a73ce1dd1a573251084d60af441b2687d220c65998fb59ab17324cc7b8f687f7def97426bc793ab8621c53bf381110501d7b00692b026bcc6dccdf826ffb4ff372040bee31650f1cfdb52163574860bc79c51aa60f573d6a977cae84102025891bc4b2a7d7fa2aec8fa2362e993da3c2bd58550eaafd7254a96d3d4d53042e8468914806b8c529edad5bb8220e12282c8b365b6712700f99c67e6d53aa79e757220eb592140a79d2e676dcf1c9941c9c2c61eeb31ab83c95e39dcda77015226744cea68220283c0983e0c4e868e95cb804ff0920b185e9734dd16e31aa3324ee3d86b4427a37a2336972d69250837434c2d570a8139a3a0b35c0a7478406df90484efb199da11450ecedd12ccb6f6aff902158e8fd9403bfd6e7733b054010d235256df5f43183b48ed5f72bf840df055f981ad8d0ef833a4016df610bc55c5eaf396bc5be5993ad195a229c71df30113e54591375ff90bba7ad3b9328d85a5d490c4b536de5c0171e6e72f2df11decf7928c3e2b53b00e9f0b7d9075c8c7ec228c2df100ea2424465656dcb5de1fe02fdf498eade82d5b1a9cfa7d0c475c532e5d90cfb2e7dfe9bbf71e314e3a096fdcb94678923bf71478b58724c22b27589f106664a681feef6e901ca817a47fbc6707d7709dc6e5f71452338150f030f576f195dfa4d38223f064c858e310bd528caa49e92f1c82b8dfd8cd761cf871541fdbbb101f8341a89a1074297355eee1bd06c3094e5ad0bc25caa4791d25672d329ad5d82fcda7387620082310c6f4d2b8f71f30915cab35ce986b6232604b9a21a2cbb336ca47ed252750ad20bd5c30a4f02aaa21901cdc6e1d0e5b178a3359f7be8ece477e0556febbef321795f595ed7cca06deb0058ea68e6de699f9ca869c3ca2ce47bfbcc9450ef38f8ce0fbb93e91e6d127a4d7268b2d475ad5d35cbc965e008afe5e92235a66f16139b67de40c7baa674eb0b96f06aef47271efd22a2ef38445b8c8179c58ff729c6150f1bf9d01650a8136276807f7408b1cc6610f7e329aa26df75af34d005f68a19c1f04a063309eddbd9e19c91c2b95a53541a9359696a107c6ebe10cf81d6d42b22761d57548121e1b6b202bc4ce5e51bbd209b5388efe1300ceace8bb2cd16394a9fdb7ecbd449012b4d7b7f08862bfeefe410fae2c0a05feb8afd5a67f8cca68f531df7d13c3c3e6594a8dccdd56d03e17fa7b36ced3831e64b3aaf8aadd4aa6ceb706be0bb53eeaeca5e2dface6bf2de72395ecdd63cb5d4561e1150f6eba5bef6dfe0edd0241e4017b90008516a6c29ba57db43dc35c2c94932101a785bfaf77d9151ff6f4d5e2679e1681b96b5b17d51cf83a27784e15228ee6b2bf8d90624c4cce815c68eebbe81d47f034cfef12e0afa68ba1c1257953b50507cae679822f1a08564b06c44c998ab544e484f921b573a55df796679fb257c066465cd30bd6b83aef73179ef50d17adb9ee9361565402df516d75bd8ae762d8883d5808533ac8bcd3f168b25ac74e6643708f62c4e87f326aeeb0de3da237ad00212dae866ff1ce14478988cc21a0c31e56cca9076e7dbed6b3a1d320377c0aef6539bd34aa3bcadd28befe6161dfa7b5fa09c6016734db115378f5efc14ff05e2ca856771e0090f512012c06d88d1045031d968d7f5d23dfcaf3f9b25aeac0f7be9f3514fc190bad803ec2cf9af14c36576d3c511b7a5ceb96eaad16d0e20b13bc54ce81b1202cfd344d26087b14586a726f03973c4fc0f0ef026d7b473bd0a15d2535fa7d606c09a21cfc24fedf0b5d195877ab969689328c263ac071e0eedd1f2b24d39036978376ba291fa0b559734d120bbd1318a21417066f544a6a49bbba8cbcff74ffae6d6866bc3720157a26760727d1986b0db9a7d041529607c5db7e7ddfe99cec69bc427e6ef3a4a40008706ca3f0fc55b8777caab768f5cf3293b54f4844a8fd02fb2951f4f5ee97b8cc88ecb132f9f51941d5363ae39b1f84dd61d2f7ce90e4a23b91939d9bf63e9f7981978a5170b27fd7b2369e821b60a16cc527ba4246f657fc1408da6ecdb9249825c881189cf353245cd121e24b82e862c85e9271babe70300cea978151b9a1fabb85a369f724d432111e386bc154cc45c30e3041f4d76e5f733a6b33e24189e28215b8f10cb37ed2a514763c64ec4614a8d2d783525aacdbd514bd706d0466402f9c32a8e6fc2c9f3df35de5e8965fb93b2caeddfd63b4b0aae6dda9951900b92671097d8d4fdd4e6497765fbeb4eb0b7896474c82befd519ad0b3961f6a85134f707e5276da6bc9c7df3291deb5fdb064072b257778b6bc6b1831d96971f34536a7317c6c06e5968891e69d1f9b39db0e4c952ed1a4058838678ac93aa4eb2569a4ec80f1a5721df5e7c275aa3ddc9ff1cd38474685bbe7ae4a5b2071d086921bc1233f51e022c5ef2df1a4c29c1665fa1a25ce09a8199ae2d02c43f5e8d1f2204ee0be23ff5b6b604baf5deebb8cbbb9d63aee14bdebbd538f8351652c9fe3d7c7a4ed4fa64d7d995661207985bf1b99edeeaf078832d99d685257a26c052af2746e4b52881c1f46194b0aebf6f832fe48f856d8d72548e0cf75273976728c92f2ad37685361f26cd8a13609e6b52bd951801a424c7590de4c9018ee2b8a1a18a1719196a0725ab7b817bc4944dec06b05ab4808067d14a6d66c2aab13f7c5317f0b2fafe1790353a5112ee8e1425fa03d1ab402895728b431d3427b30ade3d9460ac7441b7e9a0add62930cb879d7a28630eb16bb8252cac2066115da2f1e1a9bef3217e0b667057836ba1b1ebf915527050bb001ec085de97577f240273868334f1a3a1a970ab4b0c6a4e40874f2a9170257192894d532c6887ad4ee9328d152f33ebad4c27bc5339cdc0baf4a69fd7b101b1a6f42e9790eade27586a6fec3e51e6cb146206efb71fc29182df977f6db51862766f8b7f4e0399fe5694798ef1100b96483c22db318b0072657f76f0dbcecbc94db799b4d54569522d35f68075a801bf9765ae0e3badb41546bf78c45a9ecd22f374aa7e5353c5e9b7e2d1d3000fff09746d675f1f88dbd4388ce8038cf248f8d6bf9feb721abe7473d8c6ff6ce07e337c307851ab8e7292b0a605fea2b1abb47e9a1a8ec9c53c80a399fb6beb75d0d39285d6892d5d8a9f9bc4587aeb303be783f3b7550d8ae86c17a80135c9526429a4b9acf29136bb8840b077d7e8b52bee5f7d910e30096a1e0062668fce4f3d80a08e9f79ae344b49e33b4ae19a1f8e79164f01f64c2bf6a34515389ca572c886355d18c364c6ed3e91ab93ee5b1d5e56c0d134f421967a4fc7bed7db4b09aae6fa1ff9a05230a304244d918bf72fcdc340ab17034665d1c6c77f378bd5e63e7295c9a802c28365c027d2f62d5b571f75b5946d73a779161a12ff67636642e28cfb4b7061629fbcea669c995bc118623a946f79c42cfb5623a8d34447ac665234a741fd3a0a06d146e1a3f2bb3a18da145df91a9b9ff1b00c34615e3cae507c2ad854ce6c9e135c8e93b928356835d2c8e6878dcf2096134984d9b1c2e19d906d055122aa4005ad26266d15abcb46e2ed8ebeaef869177ee425449a01a516d7064b7b854837e7e4f2770bea72862220d8606dda6a4a5b4fa33cd0208684aa0957090547210441567aa8a45d369ef6a0cf9a511dd96a55889aa36321a2e76623d33fe9cd310860c42915dca8a30080011d66fed20877f9ee7407e06bc5df28522768b3372ca8ac99c180d8588b5323dd036b4b1321111759127ddfa512e30f7b12b88cd96207e61046b4af7db6fbf0456622e9a675be9318cf398a0532b8721ba1e7a6104d6e13569b47d7636236965c907c5075898c22b6c939f7ef26688ddf27fb63bab24bff0672b0632b5d47c189851dcf69b4b3ba61847ae3e2d806c7fab090c2736ef5cdb3abba3f89ad75bc44cf27c1adc51048350cddd4509c6185814c9f09c2a6e5e0a8c41b47cd157d9ebb5f58e3f6446d80918f25b0cba8e1960fd629aeea18d931fdcdf2170080ca36bbe502f2bdb4822fa7505a449e2d79933482ad3434841b87debce8a531377f275699b446393ad5b082610e87db09b90d68df8cc1c49dfb44e50f95a7a3f83a4eadb1873c7d11ed1de9e6f87bfa42dae0997c46a58788660b6e324a26c821fb47124b10b92d3dd32231d16a4a005741f3c2b8f2d0ee4fdf5c2439a3a1fbe6351da69e29e22986c9ed56834724e71644d8d4e2a8c89e5e2f28e0bc28903fd7719a047e0717b3882a799d49f810a3d43c96bbd6500e0adffe3b8b17b60192d902e6137a92f66668e6380e28b1eba472d449ecbdaff45e13b1826240ec4e10288b6788729a37bc721e5f8d97eaa85574b66c4ab7fb167a84646b6224c3fad175075638cc13b5453e296f2a5664e8a4928d9e0738c73385659452f9450b13d7c3def8b89e6e0ea0facc741fef2e70767f0ccfbcbf568773ae74f9653fc15723898d8f15e22bdd6b6f596f60270145c987b81d24798cc54cf678444efcccf7ab8b1ba93ef680aead6b24b242b4d0d8ce3f5dd1188608b398e79e8a47f4039925570bc94e8aa4b898ac114428ce2b1dcdafbf7f889b617971e60411000c84837a8d68f88b39ad6c17556012fc9037c82527a926bcc59f763a77a09893b2e9819736755d7cad35266339d7209c71f785e831089b83e761ee1fae12c23b9d793752b2915db5979ba67deae3c0d78137e2429675c97fdeced73ec2eff62eba88380def38e3f195779ab9a9c43b66ad31d880797956dcac6000843be38092ee924bcf4ecc3c0c1f71fb4653fa542841c4da189c0054ce81cdc54a7ceef2f202d7d60e0f30d7091a0e5d00044c3d05226d8afb5d555eddadf5f3beb250bd9b4296b26c9997f06c089c1217042fa51c8dbe30d0088e738319dd3a2fbc515c5216ae43e539140cb7a2cc8b778807964a95ae923195bc0f7b1f95e27844b2da0e1729ec2d1c8b26a2771997c036311853d06d4a9471dc92a19749bfd5c3a6c9e6b82d7fbb69fb731ce6d243b5829ddeed0093c9fe158e511c87ccb73ded0d40dac54d34a1a8553a49fee15f4733bfb1870cf95d6b069a69f524232886489d56673cdd59eac1c88411e2d483df1a2f28818895f874d18d8b60aa72988b5a43277a74b2c643301197bbdb60a9ac35851e8dff5a0f8d8a1764310f4628350459a81f61e30916c61770af8a0031c5d2e4aad3b58e40d5103852d857d22c16b51759accef2e2e55b67013df853826d11501c1174cddf8299bb3bf555e73c4bb3e0440b44a2b629ea91fba3c17c3926a5555a5c095e111196f57bd449d86846cc3dc6f5e9e7777f06824e10bc11c81a631dbed432572cd46a90e2d81eddcaddf3f93f98034278b9da741e375925b1f072318ef12829c0655372ca97938940d2587fd9814f1c156a7f87bf30046f1146edb99b49a22be46c9777730f77bf645b77217b1093e785ddbe4045fe7283253156596ec21ed71e2669a6b7cc0e69b295e60519e08dd595b0526b583874d8fc92a2c4746e5d6bb14f5bb07fc2359db6115c23071b7bdd64d07a6c3d547e56da0d43343a0a5397c0e5bc6faf0ea3f2931690730e949e7d4fada151f9f0367b9a25d4bef19b010da1837c439ed8c26a5abe1cd86c81e840de7e72e96bf3697c0ffccc8eff26f33007dba0d7b727536e593f9b4a0a28c378f802562d4f2fcf44376f6d61d5bbff9de3b35140e6c0777ea00dc904ab53f7f456414378b37cc7e22d7bab5851d8838634e58831c5538d73271ba22fad097663dd9d05fdf8ff959f67b14d43e48c42acaabfe6f5b789ced71f4d99a14ef30bc862af63d256489a7143692f8960f31eecef0e1dc95341a9a69845f9cfaef37d4d0745a95bac0e98aac3367e1a1caae823689ddcb5ae1da31347dae7638a694f10f5e3da9489cf3c908e6f11927da90d6ae9e254cd55cd3b3cf119389b98cc331dfb18737b4570845ee5913f15f628a5d0511a35d22ce424b1a75a13aafa85ef361b4d8c12684974b8d581325f7dba125e500d886cf546baf8bde5ed05a1c9190b6bb51048712982756999222363c2c355dba2dbc33f91e7ae2fa5d4c667b111cad524dff08e3f980eefa112b8e572a6173e447282331e206298771ba15f8c750052cfa57095479fc9a2d545fcc40ccaef40431252fce6adac3220ddd0076e1dd7cfcb1120287167ccad11ac0e300e237a97bb8894f6c20ae99e518c22e7793d7673230f5377b8710e901d38df216362521d710f5e887602545e47e60221466f75bd19e468da0c150e8feac4d3b406aa1611684374ef0a7764844a34b980754c2ce4d7a6dd73590da570a618eec6d1ea60b2016f634b4bf600d02fd6a705d3b03885c989529bcbb36d52700ed3cad6205fe2dbee889d2012571124bb6161e140ed2b5b23cdd97d81eb95cf2b11378147fcf3f4b6064aca02186a69a7b31fd4cefb7e6165648895e3673b4abfaddcbdf8e85282a42b5bb0eeecd9ef58690a26e30330926f7efb5f590958ee4c0cbac3c48588d6a6ef4990c01f4733e73feac2a7963518f314bf22cfa2753b74524eff18a5a179001fa7129a822a06e7ad0388e3a46e0b5baf9fee9281705e2229c69e7347ae3c5f7af292eb32c6f3f29fcec9f15ea472fed818c5670d511827f0dd8935dc070a4270931c228bb67102e147e6f93e0f5165917e04a1e3c56d87d0df270a36e053f72849c6b8ea9a28ae7e129a9419e0c093e01975c1a37c620640d74e2e3ee0efba55983ae095cf9badd431de4c342860de4baa263d83960d310ec7ff06d1bb7848e27155567abcbae01539794c5b50e326bf271a2498ad4fcd480b996752fb62b7ded174935a9ebfcf3da7df9b26ee87ac7b2c6a00fd669a8b7e881a32048df73d141a7f7a45dd5c144930533e7daee5d272990c64471d7a86504b3c7aa412ff9d521e6bd743128cd4bf0253d104e9218ff7ba12f756736ff92385b09d9f1fee1fa3885d23926d1cc742d382f2e04666d37f02f2a0f9619103089be9e5da9f6448047ebd48ac79fe4a25a0b5c117d8a1e116c6035af08bb068fde6d78c29eb69e718be79ed4112c2a6386cf9d80231dba88cab9202bcc35585e2c87b643d0cdee285e9f4f19c7ad316d4cb303b3901d38325e1c68334c827f6c18a419e9a1744bf12f849c5a4313719e2d8e13388d6d3cdd72eb99e9d79cd9c93891fbced8a2ff4e95d9f16d03773e9762c1eae8ebc18fd6d9c4323f9de038a83217a3b4292e9081e2973ce1b74e4badce0a4cf74fcbc521959a7ef51a845dce90c14a1aa4a2a2bec56b6466f54ff3da62fcbea44d883e4f84fb069ab4104f4783ed06af62bf827f15a8d984c61fa08fbaece246b7884e2e14514a711e61ad29d4b2ad8359778588c0b00602612492bc82a73d93e653dd18762d7dfdba5c60c344092a2d6f60271137695ba48d1713aacc39fe525e7b5cf033234ba536cce34eeb027f1cb5876c94424949bb6497049276f96390554b40d007f78959feb958b8b8279bac03a3d1d6f4fe18af45bc35e8cb25919811c17f6a21539444989c42b7f55176fe2a708aba2c15d0e29917c05fb365735bcaa690686f7211f695366f0adccd9b4c378adac9100647aff7da8e308bdc07e18ef9278651c53f41bafe657ccd411508ba75d757df92c00fc7db555af094c9216f4ff2281355093e44c0af0f49c01b60e87bd0d9c48069d4350564c75834695d5a3b5a7b24f5e32ca2ba789c73764804fbd5d8577821e7f03cd039aedcc3c59234a2e4a42449bb723dbc67b5bac5decdfcb5f54afd40af52962e48a7a577367dac77338a88b215f486b2bb9505a3e722122bbea3c70ae7160d1ab28a4ae7fffbb13dd511cfbf2c38bc57a4cc1f15cc96a5907cbf0bef45f4f3bd2212947026d85b2c5bb6fef2f1cdbd0a79efe9095bf54484bdb914a74691fc447b93ad0c4452ba0db7f52e6e3371c4185b8e2cf828a1cd3313d88181ddbe9ba7bdc9ca11393e00ca48d020b9fb623c2dd8488a959a9fb8099a9ca51669037803dd0fef41ec57542db45e0e45853fa9a27b905d60a9c2cd421e672d006e1a3f9f02908f1dd7b7675f283c68898c0e18334e9f0d5e1d867cfc5fa6b96a47b9f0124deff6556839362bcfc8331670bf5e41f89331dfa6cbfbbb71ab6385f0fd8e780a73629f62c5f46b1aebcdf75122cb5bdf34970a5450ab8fac200467a95eaa5b77274fc0327e7382927eb76960bb3e0e36b0a06e48448a0040c714432df66f551572911183b334a69aec48ab17beab1db60f2237237e8326a9387f982b6562c0bb040df04ecf1d044dec0072e7d2b4586b4d0de59f0ee7c9a86805bc72950e1a7180aa0ba055acb10707c7a97b63ce283d6c6b0cf8cc0dac219e8af56f1993afd23ce34c84c275b0b77b0d5ac345af797c0ff2dd21619022f2824db2eee07deb3683af359668205bd192e2ccb609590e5d97780a0f60d730e162ed376b71974ca278d7f75787567794ed5fdf79f84eb97e3bf1fe34eb53632f3d560b74dc12f20e6b347b7ed30f95b1ceb26cd9c215486809d983cf4344205bfc8ce1fdd8aca9c0e2938eb17f03a0d0a1914665ae6d5060112699088ba4d19ad4970f38a0dffbfd211ecc7039db5e148c1de7ed2b3813f4467503493d7c07290b248c47dfe778b7ad9e67d57e92d1f4776115efadba72fc51ce00052cfbbc6c3453c6317cf58f54afce46cf097646afc4942524a249486573758043f57d417a30dfd20651397ed0adbdbdcac8fba112b1bf31ac04fa3ff75c6caa868085bf7a0859b5515aa6155b67bea5b3d463f524fbac6ae5515b096e2f456662a689b566ad80b6812279d1fce65fa1b29690e62dd20f62d8cfa8ee89a88420fa38b7b5b70c06c17b1e4a39c90d47e1f0a4470f572f5d2422468977f41d0fd26ab09f648c399cffa93e73e606449fe6a0a35c4591f3f59a04c2d659f9c36223504afb36f447d733fa56dee61de1f6680b134595be0a2def95452117cfbf248a839dc6fb58ef8b10efd45f87e1992fd55c62f5dc46aa360cb25fc01040b2f8ab039fbc815d02c8c048794c742b6ca5791efdbef1b0c45aceb12cd3dd3fc841de249b3fc8852c83628559ae8a5263a79d5a68256a475bcdda125b63b238ceed43aec6262edf33df0d596f50885fa1999c63cb1960b669a4200a10ea2202d48aa5d65d8a0170469a7dd5a6d0ac97623f0ba5978433bd8e62a2fe3f2b1ffd35702ec9c0b1c40e0f6ef8c7f369e9b6b45bdd50df3b3aa501f2d459f6f3df1dd7bff64a5044a7e86aefa54293d6cf6237c8f5ecc060794c8992bc226ac8e821f72473cf637cfb83745f04003eeb050ec9895d8fbe511c2e6f8818c569f03192b70346ecf9aa24b270a62439904f1a091d3592421bb4bfae4b63cf7bbffd4fa20390ddfd068ad8eacad2dd2d637e2d4497f949adea40dd833c0bce588e89fc3cec31f18a918afe61bcc037f976933ec96d938dbeb20f2107eacf0f31b614206d76e797295586187dd5c2d362d6afdbdf75f1e591cb7b5988bf0e28d13bcd9b2759defc93d8eea1b3f29b93f43a0824880c59e6ffcf0e2d3697c44c034b5e193ae78eccfa78d3cf82d330fb9e8ffa5cc8a1b8e79ddba8a8c7f412e2d7be95ed6686d63d7658bcbe2ee4453e5529b9d5fd1341e98e7e96ff1545b425e201a119a824f5a7ca47126d1bd95d23638b822c38c837a883a9f01996ae3e552fd0af0afc73687570ce31d05daffa662899edbb5ac5fcb1fe4ee48866defc1d8b27a2d37cfd4868db9fdf8b02150c4de855c810288929dc7a44104f6b7c8be280642d3325d6805e8d130215e4fcd4ab07aff7943d1aba3a976268df56c20f7792674154ea8d4f6e29d90f45805aa55700c6455f5ac9d71a81c68bdefe5ae4e60d6c273e25c347c923b41929adb385990abdca1e35866b3022514deccb0b8b3032575ce135f184b9e931c8269e2eb47bca089b1484813e6336bedc876195706456bd6a8d9f6eecd11ccc3178ef2aea85d1adda1d9ad6baf8ec48561cffd7a1bd320a426ba722307fa6ad946b2bc6b1c5fd595b367ae0bfe3b979f74491b8357b05ace83182ee22742f4bd237118d7ce65141a3ec94cb668193807a7df6b89f27032f9591694cacba8bc99ce04a44151df94726e17f4b13e3c4610303385df966f43146a9dc8568057dee902916b52085b04d22e33108cdbf8814d1abbec9ca80de40e88d94ce90a00859e75f5e6ca3049a2a31419c603f0135e43087026fb14bd24d95cfe5ec89b622308852faa48be7f100acc69fdfdbc765104588612b4d2bb30c40461e830308231abf185774444137c95f4c25fee646314a0e14a67932aa82c0da49451228e50326a28b86aa9c826851b9c1a020990e14d8d7d6b17f9b7035768542aa4ff5b5395c98be1b19c2a2e778a101f7b143a85a80a4a9537b3fcbdec72fb31192c5cd986540361a9971daf33dd66800b9092eb8bf97ee09596119d708c4e8a8fe404fc52fe73299f17198640eec61b41b8526fc75f8b05b01a0cf23b3edc721185276195228c1e7188755860615a600c02bb2d283ed525968641f23147a6623b039d99bb242deb15f006ad778273f7a3d964499a3fd9f12149c7f9e4877c3cb6005fd2fc593596e0a300322fc77454314a1cb282c72c8340940c85fa11c8f10073677f875dcb3d3264a93e867baa31038fbc0a431aba5d0cebe965bfaed0a8bdf91e0314b98d41b28b6cb024ceafbce0b3e95181ab35e2a4ea7fc86f0dc24fe99af902e86a39658202da326a7ff586e69e8991c4fc55e2a303aa80a6be02fd590ab2d8920759825ba8cad950c1ad65d545fbf0d38b7e3c8fbeacf543b763d4890a778e68a07ae7a9d5ede80c9214070664d808c26fbadb56a0498e327a4c539cae1e872e187b189bd505ec6353a9d9871d73829813d23fdc9c4e9f1ddbd6eb507127b8265f58bd74f3517c367a94d50a858612ea3aafd26d0ef27b796faaee6a8d5fcefdc5b1d5d0b22f7bc93554cddb191a71ca7063165595b2473007c602d07cf99cea14f23aac74ef4a922b51464e02008f6f640ffe6e8682b6fc2d9c75f4746f0e8df1a1f3b58b20984944fd97adc3a387779a84097599a40f83640c53670585b05f47c88d75c3613d5ddb6f054c1930ddcc336bfdb8189afc012635eb393d86604b8f717548988309d014b08dc06ea97513c7ef318d201de82c28c516bb173759d092f62d4a58cb9f7f156e9f151e873e2bdbf952de7f11e3caf3d33785472a5311b1babd8427d85e1f8c2afc2b7cf7d80fe50f6f74d8830dffa3288739ecd294ff9e9829f7dfaa847b2fa007cd8f6d9fbfd700bec1539c1112efc4ae6abc5f40be3eff5ed90c54f6fb4ded1324b3ea21fbf56619752b3c79505f8741e19bda3df6137a4d392ee1458b4010d18d11e0981b2378f59231ef5b8b101fa70c4dd7b0d786090d78c60751c9a7fbe8741e59b1769e526d1ca2302c14b6bcb72ab0a40ac0c8ba4aae3c8f69a957bd644cfd159c910db41127332b31f80aadf52c3ccf69d78915acba29bbacb9006788599cf1e35465d5b11c69a8c9c2da0c32d4f37be1f2b2a6f512ccbe36dc25ed565ff2e21ce6288fc84d79c29f81c4bf88999cb2fd229aae41a55afdc4306281a62b6fc3e6264506df5137c134f2162b0e2ed47a9aeb07d026d0e68078d395ff5ace7c81ea570b5d9fa1dc4441668d280341616873364009e6e38f7d87890bec6970067447c18ad229a61cff3ccdeac2c5fe617cf0b1dc5b75abeb79cb50d9dd8c4f511d26ae52efd66ef68706d62a8d6a77a10324e96b6b0b5ee72fd1c27431fba141b5f888d1e9cdc51840b5904fed1a55c91dac409393835c1fcfffa4ea06c3462385e9aa688eee136d7b489c819db462e0e76a749eac0b259d05b9f769cf12e9290fb7adea60c9b65b5df4ffff7e4a3638dd779e377750974679e61d44fb0aa40b8a7ad3af087148a7004559ffe9b2f859e958418b5f11ef0fcf2ca7b07fb05cccb3c622c348efd7b99f0370bd6ac12ba001144b126b0ba0d7b6665d6e6fd45734cc8da6e9fbb789810cee1af4661ad1b8b5e6de26f2d894f6e76e7c5932904dbb7baf83cffd84b2a871473b5e0928cd3be44f4a38bb5ae7199b813570be60132328db32b99452e0d2b243ed87a1efcc35e73e731c84a2d2395620ce5febb556355e4d8f9e43de840610b33dffa1503c4014abff8a016aaf51266994a393ffc47d64665a219aa339e480644ae86731c3ca56481cdfccc5be3b3318ba90a8d6c6ed87c8b43036ca348f0468225eedb1be264541742a7f6b17125a7e99e13d2aefe0b59264410b2666aa5512e6e689983620863feb345346e534530c604171d01e2e45102c08f2bfe53ad78e7b82c4045efa5938887d5294e99a6de34eb927b3efe01f8b9faba7ff2a50a1d53b24dd3ab561d7f5a8be6813d4ea669c00f0e49f31f66656a101d5e27827bb1c90a9689726d95ecd05aa1974673d66b9b44cc6c29b3a87d3c4d449dd08a89207026af40fc41ccc9e12600a2ed4b97b7c4aa3c6a6d510073b1b2388db60492cc7021ce8fa53ee29fb2cdd9b4593d8d82f4c7a86da6d29c31dda7da078a591b34ee5693bdb16a0471382afa77b16a7c1770e534e36320e93d69db19f2d8f966264a994b4881abae4754487d2e4e0c1025fca397df824e337d23f2be8f60db38bdd0d35b4443ef8d542ab7a0d51b1e3eead7fd6e899822dc13266bd07c2eaa3ffce53fc77e65f8c81b641fec5343984a5b52cbb966a210ea752a78e5a74deea5f024ff74b342f5b80420cb1f9b6c6eade153299708f6ec4afb88a01199825a3f7038bb08561e6d1ae398c8696cca448abd4ab80744cb7b665939c12a29956fc20140bc3727ea94661202fa3bc9ff5f7443c9aa2e0d0eeb6dad5efcedd7384ee822af9fa468cb2e34a950c8646d370132c00fcca1a62904f32b5c09f909326ee8ce80e3089c082b5ca218c84a9415cc60abd05c9e7d23c2d491b5c8035fba90a44fa17781cac3c178ca3f01bc0fbe58eed7c423a0c5248f2a8ac957be1d2e46a9132639c53753faa1019a2ad81e278cd0efb55461a26680610230df072fde3e4ca874a60eccb83918bbee45385f2a4d6e9c61a9922cb96cbc1d371504857647ea73c9f50fbf9b0c8c0961ead8622757b2216e2bfad10a21ebcef4e217e3f96065876bfe801bba8878ea8f6c85b597c097049a08021407bd4a360b1972822915aada715c3409040144e33df9eb31a57858f5a4af5bd5c2e2b7eae7f83911fd90c889a7e4a5cdae53891a43c7d5320baa3e91d7342fc664e09aaef72b1d44f630b02db91969f7a69a21de9acc12a997f8f82eb1846747639ccf1fe71eaeaada9459af2c1320af74c5f4badca395b3f5393ecb7dd8bb1c6dc3a88a5f68fc9ec387630150fe7c84a12c3ea4f6668a5fd15b07ef00d826ad39bd3ffbbd19823ad843ee7525058e01a19f79611f98ebeec65b585863d1a9101a8b3200160c30139bbe4a2710404da07dc22a6171f24a54f0b6030acdc771fe510c2cfae183768c711c6aea9a2ebbfbaa0c91be7aadcb006da12544e1075b2adb1ac05eacf9eec3b740cb854d25d72a554d42e82d836fbdce9153860bc849d93751d265338d0cde23badd98fa7f69ead0438193fb4a1941bf33304234af89c332a41d50e1e2890417974872237e623517791d7478fbe6d6dacd94e36ba15b78097624a7120ea24b4a5ff39d2414c6f4054947fa22268d511b4a1aa636843c154a17e553d6933c5697526c9d834c8d6114827c1673f9bd1babfbf21deaf8f5021d7dfb6379505f7ee64b1ec9173ff150545d8823071184a29c3e45716ac298fd5ac31273df1cda43171b8a9debd28e0d99d54c2c3df353afaed06b87a872e108a05c21873df879df28d668599af1d6d43cc0a75c8030d71cbdce73792e11dc46c28ecfc00132f10eadd7733b8cfcd90cb659d5c5eda6383d99914f0aa54da279d661fc92774af49c9fbea06d33a49c286ca8a25de4abe9d90061b3255006ad9990466332beb14fd209223ebc4b3f70f55b9edad4c8239133b47322ff7bae37345007ec5d4e09aed5f4e433d7439109cdcac6b2ec3c8a315460f11b47c30583689c4f2744e20059288f94ff37b59a7414e545c6f25333e42f6d687d13c754d0b6233184226fa6c9d44fc9a6965b7db7e50692977bb742a3b469127bbc710242ee657e83e3330a8d72c955d3023273f80345565e3f8b89afe28eb63bb96a8510e288194ff3027bbd9d2b6205ac5d66d5075905779ef4e8f4fc583f87812db7ee811fa3ae52046de447ca0e55877db69e061a936ec29a796fb94588f2fd20134d545e403bfd74786974ddaef384c063c88c5d01ef59697f721d67b744c6b601513300e9f769c72d2f3d07ac0b9e73d9b4f0cf35163548442b3e71b4baf4f226323ebcdc5978e734fef0b8d8736cfa90e6288de621cb92e67076c836b7e0f14028f825d61dc0a5039be038484d6785fab9588fbfeca4de51d728c28a966e76521313f8a4c80f8c79f82f0e63695b86f186210f7ec7580644169400eec4a43739c55277e2346f57cd96479400a3ad2da5360743debb33efea325f2d5cb4ad1b4a4b4c64ee8f2dac0f3009a8daea8fbf53569d52e809fbe3c9e6267eb7208191014aa191d6fbad43ad4fb4ffad38832019aa5a5e715bbd159bb55646b805f95ddbe173229e8a277fdd28820b492b45ec9b93147d6db6f9cd3716cebe826948d705569e650f3035a9b8505eb44cdf7122fe7d33676c2005419928f28c5ef885911af394e025f0b97bb4955b6e129096610162eb8c8867f126e349ec6f65f3d791de0813f97383606b6809805f65e60a5a69fc4aad734814b415a56c2d58516687b3fc7e72310750aec7fa1fde13ecc8550bfbfd26d14cab3bd2353e18777c22b8a85eaf695b8212a07a65ddb1e2b1737af7962f4d7208cbc60aad95a505be71fb935af78be9a3bea6d2d3b06a5bce5fc2fa81236ed83f4e5b258f224d62f4c185049fc69aef0d07c518a5e49b29d3bc0e745ea4d999720e14981c46cf6b19415746c9ed60a66a7b2f5dc425e305bccd9a3f2cb45fcf1240052539d605c9769cbdc6aa187a51f1134231c7dccc6f6956e52130bacb503508d7c880ed8f7c5f2522f1d1ad016389319246cfe83e3cbf2d11140827eb64af3e944ef17ddb1fab935951c3f4e17c0b35f0a0785ca088fc782b8489cfe424486b2304b1f83ad483cb06d9f3956128c75126d8fa0875c59063a71402f8e8cab0690f8f2d71aacf738e44eb0bac2b4dd87e62f8e2aec84e23c9d3acdb62941272a7092793bc8d74b8c0cd6e3864adea1f8bb87df1fd6f578f291d5f05f599c8070d189a4bc90cf167e35ffe9fd4b8bd3f6b477ba3da80d39cc3dcb0fc6c7ead34853c671ccb411f10102daeba512d436d456729684c4d9fc1dd4a1b47c7b9aa062929ef796e6a9f9283a4da5c7e19d01a63aa82f888254b73ec60e4c3df8574db6483ea03544afb4139766131dc885084814c0959933471699f8d315238eaaa3dcaec0254d71fcdad76911b3026431af2124849b4efbefe956ec943c8c99f0062e2270ed989e9d5b473792c8979d8ad04828218076e3d5cb7d058499025c42ca774bbe0f775cb4c1185180676b9204846d299e8574e72e838f3694fbf3e16db771a9b748e172273715b713a3103aa9042b981da3bb1cbf1a61a2ec79d6c3795cc8413887dc6cf41c6a60b8467b4b1153b6b0ffc1ee6b9a3c5506c59da8438c8d806026617612e717ac690c5a0e636b174990824d92d4e39445cac0936c9a0ddc60ee25b3f2b8e053de607d91a9b3800b8ae2d7e188435b3e394ad26ba6b1b46d87bcb5bb35173eead1879f494555829a761f1d32d48e94bc68b3d86423783bd4f200dde2aa499c5d28892d0e8e42c223b65f8f00a76b110a8fa6f4bcc231a18b3ef5190c839e0513f43bae787b148ed5bd5ee65e2d66b402cc7e66de73ff13d0cd1b79bcb37183378736ba9eefc3edfb4a7ce593839e16bd5ce7b52a26a1bc8704ec2deb0b1fc9e0502984f78286d6521a0f474c15971b0431eeee0c9d0b2f75b6902fcc5781f5445035d1402c327c89eb97ff94753202d8ca38d8685ee057a581bd25539cf55547dbfaab9473a06869ea11dee589bfeb8e97c9301247364074f632b08ef42fb3dd9d26f9c6badfa728a2dfaa9e51c7b5b5680f1574fffa18396c4acbec75b801e4fe133b9125006dc3afcbd69c57d338d0ee6ac4801f749857a54d2c3d10b33140337df9298acd17fe85e745f71662d00be2ad108eee388feba9a491aa042f6689494ccc3caa1fea899a78a8572159322404c91552c73046c6ec75c24ef23375dff5e9c1ec7689f626ff61b2f7043624b33d652ceb9f1043e120beb1d3e885426976d5305eb763fad937e359f65d009589d70a2ddc25d538b70cfba0a37e9e10c6a065d64a4b156e162d5c97094f4182d01fdbc09437772005da106d31710ef218e08994bd893759761867ea899c61e80d47e372a69b5892e87be64e6a11986377b14ea0aab9470d962d1c84d8e41206765df30a5428cb732ba4fe9de498c30e53a6ee561297d1f81c2761099c93c6de29b1195ebbf76b707ed168149281e84bd59f4afd9c6fea242657c36f9015d0597258261f16041829d7f9824e0028ad46d12178222f6efa86cf42f7e47d32cc542cfa67bcc230618df796526c36ab33db9e75dac81f52f962969469b2fefa8fe002918e70111a458a4d8006bab3b3e310fbeb7326ea2383e388a50abff5da873fe798ae13c764d321812cd43b0c565f6a57e9156fb988fcc6e16c9bce7f6e303aad3be3a446c76989fc8443003cb4e7531281f3b97add8fcec6bf45657de6d581974485bb27b35225e086c694aaf00218c68bb6bf9535635de5297ac81feb3d937656814c563de02f75cf8695bc3638fd58dfa2465781f7ddfe23389b27a4941aee61d619078e1cce84b3358f3ac4185408147792a3517fc23834d0aeb0ec6ccced5c3870fd10ee8d88c80b85d67e0b3b3f08684b9e899d1e39f020dff1e7f36d83c60cd91bb64367473aab577e25e76fc548d1af8e562810ff692e9a88950eab255ba9bedc93e28802b1d27aae3590db16a58e7833b06b01f9559e6891d2635511405a630c2f29ed3dfb5391e90c6102c39454378fa35de4b81bf5732fc361a640fc73cce3cb74241d5d8f0a7e2507048b30691cfa52ba103db3d506380b58ee3b84ca1d60430e863a217a85c628f3ed8a25585e565fa709488a2ea054fa9cab6a8da3c42e7607f009c599e02f66b6f41bcf73744a248b8622b664265f7520600481d5ee2c204735df811d510dd908db6e3df75d4b18d240a4fed6be0de7a6470bcc3349f8525eee0c56d1ab0467341220ffdc0a1c599a873a982a2bfdf1b0196ac015dc769b4a187a5f0f232b7a709310297d3825a56c8377f6ee647790b236d62f412f63b71893c1a6a351c6993f4818099691d45bc3ac7b71bc564db8d243851f9d2d277dc0ee650824f64a787de246de78de69ffee74f4efd24486626b30c7ca6531e0ed5f3ada90f5f6cf3729e9139d01fd1b8c3af27cbf21be99544dbc600c72f5a2c77be9397a86d8670a779c6d95610fe1e337ec702b60d4d006ed69f29dcc7835f8e4e45a4ec970bb8b4e8dd3251ca47668769fe94cc52e4030bb05d38322c3eb391fbda7a07ab180886fe4a347520c11382c878e1c066b437db674c7c8ade2c5ce8c2a3dedc39c2f1b3c3538a50b8e1c8b16ba53c4324cb8af0bb50c9bd4dade4ac508324347100e6fc63dab9dd7526c05eb2ffd69c4c9a6e57f52c3ee7eac3e6345f6702c5a79e7e7d91f8a695d2c953011aba107623a30a7e601c74dca6fbf6f0895946242628506c8279e298e2f805dd587f9cd3d8ca6dd6227de8eaeced77e0846a93983ed4c5df949f92c18ec2939a34bb6cc3b09ea0ce14b26097502d6c1d83bb09f7fc886b00bf5eef431fe1b680cdf97f7d2abfe849cab73aeb7a34cdd33fb64e9353952e3e1476b677a8cc89192a018106c1dd7c122261aea108fcd55a1ea31c90329a015c339011759cc3ac8bf1a95110944a86bcd18c944685674fe46e3798aa115a4c5d912d4c8f6ba95f03e8198115f7db5f7d68482f14f3cbddc9787cf1877b36b8282359844ed9e48d1404201c3ec6f8ceba1cdc463661df536807e51dc3e11d06daea404283a9a485b98b107112680b29c18b5ccd17de221b5cde0659cb7454bf6f972b5754e4b4ecda672cec4712a2fbffd0acdab34f5e8ccd377b3c06e83f4869f2de92aebc0259333f76366478b1921d8b3ee35b9b0c99d18ad8d28f993579d12354b69b48e00dc5fd95ce07fa1ccfa604d08fb320184e3b940e4fb664205d1f198266d60f368c3a87e0874658ae837a1bb01a1607677697eea0a6c5d928b580921d9b609560e603557070cfc55b2b363c75bc9f623cdd4cdbb3d0466be0e71c91ffd2f79419c7392abe676072d4f1421302e03e8ff7fe6c2f41dda386ed6935c24cc3b5ed73111fbd7dbd4281bfc9e4148f9b6789ab5918f76957cd5827b51529d21f27801ab94694bb57e86581eb2512e98e2fac77b1238645bfe4a8fa74f9c6f768fbe608f07c73e48df56609f3827f6f4cd2ad5cddf73a90d6849ba109230ceeec718512d9e1d6a450bc8070b0b4866e2334227731dce81b9d0394bba2208a64ad9e4e71b82ac8b40955cc08f872a94e1a16aaab905c7916ec00032a7d2914d399b0606406d8585600812db40087316347186c6fd142e7cb879f8045ead2015b76b1e7cf8813fdfd572ae250f9fba7a34183c09c8c2cf9a6a192422bfea3f3f208d2d31b622943e4bd496f0992e488ea931bdba7362a88714c445abcc38f81fb965e68b1d1e6fe32727c14fcd2c1623dc0ba988be5a7c8a98f2810eeb05faf07fe2fcf495058d6ec4680f15f322e61b493980bad7f4b6b9b32880e91b7071122568ffa8acd0aadbe65d51d33835e05787933b4c68994037138e7d9feca5d367f134264a8b51f9914a2ecc3b9835cedb96bab32372146fcc5f8907cdb88a9606447ef0aad13252814840b4af38e9879f0785ff53ac6b8ebe33c7b361eb99de75a37bd277e92d6c2c9238ae73d1ddb2d81b2e676334c7536134460967827e1f08d0df16c40616c95a591d15f8fd15f231857613e3059d528f02be107c606fae912b22afe65805e267b12ba775597a7e2f412f808da50c0f0cff4462c2344918d607e6e8d265321097f1dccb4033f1a286cec7ffe8c1f21ab4df8bdf1af7448a3afe9b7471c792625821d6e00abdb31b53fa3a41b826be61985de651fd00a8a8858ce515e3d80921fe3a98092ad86899dcc3008cb57d6f93e4cecc971f385881a7e5f57e99b15290a08b8a39be22489967d07880cfb5a013c0abc98fd53e967745681d14eff793bd2c2469dc392fb53bad589043565fc4d880fbf779b74a6bf70a80ed720b16117d36d19eadab6ae02319bbbf49d847eb8ae087c23787a02d4341d151e5c541a34d7ef5815c69bab045e2374e9861ca38acdd5e392ab23b9f15aa4831da621b3b616fa1be1cab3abd9b10099271cc3cd4a179d2e5ecc4a0aec096420653e9a1c0cd43fcb9d69b9b2feeed88fb571f55851b746b5cd5feea5fbb480480c8b72bd89d42431d8369593a05f412f3210bf906bb0ca8fe90663891d91a9cd3f4d1b8beaae265129bd929a8b4c2454f55d3f172e283a9be0683f4e40634a1147ed4b857552779fcad04e924a7c745d8704a67c98eb00783b1da84c0a2345dde8fbafb2c3516b0302f28f39ce8d523c689d1b105521b4e279d5c51f5187457ffef7b312e3482e6de168a418748c3a52791d76c9c90b375a498d9a5fcb2f3891377ed50aa1f8121579e4fed3ea76c37c1cf8c3873e9a96b8c310f702613fa26aea4720e62c77067aad2f2b3bddcef11ed77c22f442ad189e9477204da506c6c55cca388eaaf255558cef68d8773185710c77e281068198d6af7ccd237440f0fbd19d73df1ea55c693d691d56517a9d2d286a6f7842f9f3d6762e46e488893505dbedbb787e1bf6ac7afa187f969c5d0fcb6c2bb599b1ea998d6bcc38acb4d803991d0809eaeec71cfc340ea264413a77f1eb644fe6b2a447d958b3827aaea60d492ca289a3f7d8b34447802c89399f5a3d3337319da59162ab2fbef81eaa65a494c7d2190cf7303a50538c717ac64fd61797d18faee1555a7cad596581f65fce2f793b50036225da83d200406e5bb49ba97fcc608bb4a91eb37b10013fe462c1f279e50c2fc24a18f9d75edb68279f6d5afe54219df47cd40157cf025533e9e2860caf080c40fc243718f6779b01b568b5b940d00462268efb5fd224c41fb3a4a2ebd82d63780a358ce26391e0863798bd64ac811d2199c512b58a8ed0d64892e5a4494413692743a54799c2b9801c7258b27b765966d27f3ed2ea7d30b2a3f371e2e15f88c9271a469702f8962698c49b0184fa40dddc457b8b0dffeceeedd7e3cd003e3862ffb9afa353a08cfa1158ea7c497aff5032dd2f7e7c0a158c623d456205a0e416e7a6033c872386f97666e8aaba0097040edb1a0d2e2dc7270f832b3a458556b06dca7ec6abf0219838d97dd8a219af8a2e5a50138580ea6f3c273d746da925f77bfa864b9c43785d3b1454085d064de6d67d5d3164cdbfbe382e0a5e5295007715ac0081a3be8bde3e54e4d483c2d434abd2b0162bdb61d110ef97f58e2e40b2bbfb3669bc0f6a7ba6300d25cd9394cfa4adb8ff503cd5fbb661d0e8946012ae8c3c7d69be2243b7bbafa6ee3655230e63780fc9bad7e23429f96f999143a8a5979c834941f51c9b21a14491533280165708323c08baa2ca98a17ee9731d26dd6822467c255e5e931ed80801719a31dd3919acaba8d51dfd8a72c020e46e1e970651e891bed138d8b7495a19168ce809d86da9084a2bd5345bc75c0a5d3954ab639752760f80b5187eec01fc3cbb2ca0bf34c3789ab664511b51bff6e7a5f32aeb986a854d841079175399fc09dd1e61ae8e20a5665982e9bd5b7153700e779828659daae3518ab8b127fe82f5cabeb3304c7c392a48fe3a7d02dd84dae927f660a3d675cb9cf5329213021181b07994c3d60f28ae31426212c46d24938476bcb2f07497ad0bf2644b14aad95e90fae460d496d8605143398a065c347c7553ae1ac234b6dae795b4fc66e48a9a9311dbdfc80e37b242ef978732dd9a743304a790f7e8d33873e407780713f83104fbed40251d071b4d2e28ab8099f8520c5eb01f77e91937fa7f78b7b67b219fe3392b4a6240bf5fca8948e7607957b76df0aa405469f2226c8f8935be9d2bfe491a85708e9c1573e41e5007903a96210135deb6e5e30fbd9a291cc49a3376e86d7b35629b7d7071d103354dbeae1256d07631c3af3748a1b0ee8f4200a180d6924889ad664092399abe25f25176447de193176bb95f5eefc817a3340e44839e84df0c2763e3b72fba762c8083ecf2c588ee1ee4198b4bded1cce45960f6a37dc19deccbe0f7e19cb7215976a620ef9a00e0fbf3e8f038afb610529232ca281ca78aa2b0f8e4a6a4ddfa23a84c80006e0e63b14d8afda91cb39d05551780755f3d282465278073a7c1ca7f9a62c4c51e255a3ad366070667f63110386c0f5be3ac90d34f6002a67e3e29ca9781a57c33364ff764c7243c0c34c61a0ccf5d123333ce75dc1a5a1d13e85a004392261ce98c566a3fbbb40176f8dcf274218ec26cd4cdbe15531b745203139bf53a9c14a92c90ef21d4b8332da567e0f73f8bc4075de841f7173b3dafa786b7174d567c0e9f74119d9050701550518ebb4da756acebe6be786e0f705219885fd82bc20409d39bfd23499bf2835053e7b421f2fe64a5b85d81e7a657addfaef2e6b716d9081b14bc70597b0621043f9acbb6f0ae7fe32ba7e8fac02986499142cd045c310e8903d70827e1ac8b46619c9a508535af1cd3f0e40743caaf7da0114e758f2a61e0f7b7258a13db12e2aabcc76bafe48777354d09a20fbad23af41399590338d765698a9cef08fc42e575aab3d583acfa71440f4e84a9e4acba69f7a72ecc6c1035b4391c0fa73fd9333c8fd32301e65b719654d1282d62bd51b4eadda98f34078b5bbf149a4cac4b71b6012ddabba2b04c3ddc6350320697d504f3636f3deed95d2120d8ff1fadbfc55e036849faf516fb3150e0b96399e5a501a08b7503a080129045867e659ff28880a1651de91bcf705bac940dce3d15b5a7d14dad696d71c16fb1c3f141313f599eb10c5f53b009354748022434952ecd7f368125517bdb5dec9fceae49f788d48684d991c8307ccbb301d6bc2c812da0d03d2a04bb54a21d7daead1393a39749b76b3156ef8af94c5c887d0a4e8e2a35316242aa1b791347312cbfca78c31c187c6571461b1cde213c1bc87ee19b02395bbaf81c028ca0dbe44849eb1d7e484da7abb264aeec8d9ab60d74ff9f1a7f1e2aaadff17f83ddf695aef57064c58ad4a765cfcafb51d95f0e6e760d829f2c6d8edc26090003eb23f978af21029eb03efcccbdc4a541305a61f9f3f29206606b37f98ca6dd1c631d6eec37dd8292e02a5b587bc71a2f8cd14c23c7e3a7cd8f3d2104f8fde737c01c4b4df885136efcf1754336c5020cf062e58ca126fd47971d9b06bd79f963cc05debba92e32d1103fc27c95fe923bc2ed4339e4f936f4c02c484becb02eed61440673d916a5213c594b03e2a56865a138bfdb321c2fa260603a3c34c962711589da56e170600f5dd99fbd77dc3ffd87a901f3141551a77b950f0756281cddd28ddbfcccabd7d5f3b48a00cc5c43ef02a1aad6fc1bfeee79089bfd0ffbead8b896e78aaa0ea130c066a2d323eeb5269e3281465287a1a7c415f3fbdea05bd1f63c0c367c38b8ca480c95df603aeee30065aa2f3e31477a454eca212249d238fe4242c21601dbacbe912b6d69b2927ff0c9abe26e4b6584dbb8026cc4755f770b5d2b735d3e330398af0808ee39064be67656f26d78d0bcad160d5f32de33e51a8dc31495146f404a2c7f4dbd259a48e98a6c74383652ce0632721f88b8ced3931a6921cf662943fc09035f74475072145e05813ce5e7f1e64bdc770c393058054d0adc53d924b41e0ddc3affaf9cef96182029e2ecf52828b319963079afbbdc184e59b54f53548738d5fbf07a5251f9554692d06400dbfb49b6b227fdf53d5ada9ff03f35379adc98d620dd8fd6d59662bf56604fd80cb90329705340115b816b5c2ad9ab044d6b86403d5873a61feadf67adf105eec6e0733963afc672392ca842ef58dcb8acbfd7be57a24ff97e42a5911823af9a17f9fa4575acc48a71eadeb9e987502d0311acc1d1e3e47bd7b96e9f1af9ecf9b14d73b30e1ddf0ce829b395bab3784faf68c0f03126d953c9b13d5af372fdd1aabb36c6c468d1f17a0866b6a253fbc0c1ea0409a779545725f30838edfb46c3658084d56923a60d8934ef0dcfa2f12ff20430d918351ca83ef7af3dd611f4d43e36cc8296813fcb4cb986a33205be1c8218e02dcd171074d2a0b5a2c99cc248f585f9126452255563740a4a4c5c0857650cfa20d5cef10013d43dd454e7d93087361eb763a418ae764c4b7093284cab00a714aa5960317eb27f706eb841a4a663e4e95c4c5b2a06bc8a4828179b31f3690bcff1dddeef6fdd3b44b0cfbd7a7d3bc768415cdcbb62396d1076dde268b2b4dc57014b125df1e07a8e6b3ab90ffc9c71bccef5374e697b88c86802ee5545c030a0a34b5952d88de0f2f0c8761f3b4be15ad7bf3b68ab56ac4868887a2950dc7f8012a3d2179dc1c80c52dc2c16506bcb6a6333376a7930f799262a7bdcdbdb643967252e29428a1c6aceacb89d71288cdd42450cdf1631e88ccd326e347c6e03796bc3f09331b8a80b9d6cd0e1c48cc6a34f7076f92f2462d7e2cdac56b51588b1be70a47b2d08f99e31c3a6db2b003ecbaa3e52971b1766d4e7dbe7522c0db88f319fab4744b830dc274973f4f90a6eb2a7c5b77798c4a44a570a367e38de796712549ad637ce43a076f8bd12aca3d3e1f95e411a9ffec447ce9ef7ff10423d11b474e1a1eaa5c18445c78438affd08f426032a5cb1caa9d0528bbd1d22027b0f866126999e55e28863ed4e5962489f2f240af150e2d2f229dd9ae17192d26de14de4b2c763840e60c9855f823183bba7be4d4c91f0160e82a69f02ad7f433482667be17593487a548ba659234704185fcbbf504baed12fe6893e12caf242837de75b173d0651e92a9ec0a602d22a36152a0ebd90684a2c1683bbe3f76b2164dc69896c4dbb313d4f78adaa586b1a34390d3acf5e61e885e6eca148a004607e707cf6bfa69b29a346eb936512956f1183991561ada8aeaf0673c006a41253fdacde4a27337740c51a725aafae2425901ef270c3065e2e569ba7b6a8658de0d7fd21fbae944bef5565cf2db63f36297546c709c2a223424580eafd461af724fa9704a93a9409f709dd117be63b48b85847754412f1a5ef01718861a129b0260e53199cca7a73f2c4869224b75710823924ccf29883844323e9ef2e78da93b05abf837749c790284158406f5eb22c8bd2c5ec785b4aaabc21f6b393ca039bcc46e5d65d84fe96f7bc598e079584159d517e3eb127e11ee11356af65bbcc6fca1bccf0d09a906f73f92ad852d60ef1a94eae322750a47578c28582fa4b7c2595324ec19363db91317839db933d2a17e150881be1c4da82d05f7a5286102c823f63c6b94ee5a00da1afd77d579e2502b6d97fb41ab85836cd5a32a8d87ba416efde6386d53e680d61813c13bfc477f4df11128083aa1941d2949229274bc720410357c94d7a57011476a1252c5404d0f71f73417308796ae45716895c3290ceee72a07608af104a2a1eb9b7848cf5470620327e2a1fd5d2234ca7fe5395166f0d97ba68319ad09f07788d64106773198b035737a32bfeef5ca912625ab6404b3caf4203d0978d36d30c96d102f279eb6469ae7da3364e341b77625205105004edfd0face3c0589c3946fa516decc8f52e82c9784c231e5b1c2cfa16043d3b210f108db4e228a423f1d0b9a102fb6107dfa797ca9a142b4317470d476483487e3329cd844d46d203db11717ec27afc71ba0563e7e851b89ee76cf1127b81b1d20bf619cacdc91b9eb67d4218b31ffade4f7cf92a02f76956ffca41e1556c1bdd7ab01bb24629f2d44cf02777a3bdad9229c98bd371d6cf55b326defdab5d451bcffa16290070e7b73456343b8b2e10b71dc0f9299c1abb40426b8a2323cd680016c3b21e26a9f3b30128d2bfcbf779475fa35be00b93b252b9c643f2664fa2f71c697031bf56bb31b4ce9d296eaa97d3851cc6e8b7b9af502b1fc2069839de9f1eca678ca79db520394d2f1640a58d1b68cab7edf9859320ad893644f63a3c2a3c039ff6edbd3c37115b5d36f05c4ae0566269e15e43c2f08fe5b2d51cc42eb359883d6e1d8fac066cf338714a145b4f123f901e9af7eb8542c08ca6676f1f42392e86c541223e764e1b487c3121128387f7c316718580c40c0b670b14946ffc7e2e970616775fef4e58fb50105603b2cb07b7deabe3a58fada703fc92d62696c566026644d67cf530d45aa8d42ae5884dd5c71bb18fdba04bc4d61046e9d41437495e56ab38a8c6f417f0514badb0152ba6c68ac7612ae2106d325e0d9d00b4a018292a4cb645695f2f06d3a7338e021b3acd14a67f58feceff3cb098fb7093564f4d9ae21ca4b87e9f437a5bfdecc06ef26616eb42c786d30fb25e5145e6194adab7911d1aa6f1897d6f4605db2a46c87b90b1853f8bcaeac805c59cbb511ad915bf5004a5d0a06665bb1d6ba48ac359653154f9f864a44ee4c6fdf80225b660f300e25e8aed9b7eac788b91a68d328636a33562bfc450f63ee4b8467c9552117e1d6082b69327de01991892e998a3291278544205f5839f2d6ce970b74d0bfe9bf14fa9c320933132a18ef432a70bb23ddaed4b9ed376eaf750c3d253a87416f401e921e6fc62878e4714b9eb04051e6885ec77aedc70633fdca15c7ec972acf04b8f04cb3fd37727ab23486de9ccdf16e287327021fea33c228797171d61167f128f75d2d18600ee1b50a51d8877df914e841be2cb0cb387ed45b4cea2781ffcd361ef6d905c96850e6ef23df770c5db3725f9789be559d0cbb81853a8a15863d591950b7ff5c3304a22f77953053a75676e814fddd67235403b408dd6e8ad38b683a971be8e1c2b30d213ccd30dd6fa0fdcfaba9fcf65e6491aafe5f9b3b55f7f3c4984870e480f1daedc0e2a711eded35d4e4122b677fd2ff844e16c28cd3d53af9106e0418104b77bb353845ed3b8340d3eed19be043741144e1ba178bc20049470e8f90e6b427d49d9b68f2237a228dab37698cb0f0a2da41d39eb2e3d3a33c5874bb874596ff9fcdcd605e02c199f238855b17c7e6256c482586e6e85dff49dea85884d55dc95bb3088494de44672d9647bb4a0d39f419ddf5250cd60dbc19d16dd26f19e3918bfb35892a326da8c12010a5393de4dd79a85598664b6d0aa022d09e29b6b78011ab90c2caf83251fec5a2fd118796a06640d588c83dba2b947abd45036c6496cbb252318e048ced8dd629be9a52dc2105f9a277e21debb5d2d120ec5cf10692bcbad63ad100d6f98adaad1d44512a55b803be056bb495f631a63533d7a1a50b960c978c51c229785088864b7a93ff9f7faed203b666a5cc9de2437832578915425efab8dada9496ff913a252033ac0247b3ef70e386c082c781a005960ae76d0d331e3daa9880d5e825ea0720c34b5a3e27b8254ce18c03113d0b8107fc470cde6f43a3136a438bc149c6171f022c5c59d0b094a9bb194d8603bccabc68e637716e40486632addd3ceffd68ed1747998b2ec877f0d0c757a99f9b126b63a48c4e8f5272fa1959e267b941316f980c7fb248624dc309b7bf4c11be84e7fa74bc016d4241d2957bef9437800b95c46327cc724562ad456b26330c7ffb5876a49f2ab3376e48cad49a04842872254a85a30b4fd1fa8467bae45a4f0a5d18d96bd4c7e58eeefe603c8bea746145b4b38e5f1aaae267b8803e7b06d989c97418319d4e210d787a7dc027a994c35bc7406c07530d445c67070e2c8dc6c86c550eead03373583bc16aec69a82dbcaaa52ef9af5004bfedd76e4daea24ea50c08c46104b4d09436ea45012abc524562df1456bcffd7c6adc2be756a45c1c01a4a0fe26e75d56261519397c667a711c7f2b973d3ce05d3bc207d500dda2cdc9d86fb629b2cec8b4e89dac6a0530e97041c1f06a775c206ded0695f643d9099aaa4d78409ba33b2fe2ca00b6a82ff4f7f892626059e1e9b4df25176115747e6bbc34beab63f412382826f5137088cb2efb3646515f0b2af4ef46af23ba890d2300e59f68ca2f1ccc6d24f683474b51bb51fc7ff0c31391d80516f7f16db580bdfd59f19fc6f59ec89b714506b763d5e8e4197fa96fe8e1b094c3bc65e5dd47dbb4d09da5ba9f7a400781bd36b0d42a15b56d1f162f94975ed1ab25269bbd9e3947fcb9a82afbacbe2983f63e394e89ab0df7cb8759c81e44cb666ee349f6bae3d5dfdf946a183997fb38d3f0dfec129acc913e192061e5138de375aa35daef5f7ab6aa29f5c97900b24507f5db89e27c3e8d6bd548d282e260ef73cd6f8a82e48f86fb6c9e6f0968f4b4cf64120ca3544e0370e4db529c65839a0211ff770bc2e93905be28ce14792df6bf5e875dc1b09e1e0a0cf7d7032c39e1dba10586ac52c9e1bdfeacd6ed7b75709b778f2fd83a61cf5f038247332e207871167c720b46233ec068ae20bd560bfd56bf28e2498fb0672a0f08008f96da3946fa760cc650dd60ada577d9b8e59bc886dec6019afbcf8d9158e03a7b76268e0028fd9ca7e6bf298b25901c6fb7f73dea965eabfa0fc3a44506799e997fa3f17244a69ad1759a2230f59fe1cd7c53dc48581da0b835faa05d4b87df8d4c36032f90452fd8328563aa3a2ac854c694e020323670db9d72ea2c3d35aa78f324c4af1f59c34bb55c2bacc2d7c56a241d7ec092354bcc0d780824adb07f3e404cf4a6aca0fecf629501c2bdeaf28af833cf30fcb20d16bbc10174683b680b3e4e99e23ea064b441bd495cc91f83e356cff50a51441f4909ae71ae3bf213daac0c6f7db22b8ffcd2952cc10208ba485ce528505d9ad7a00295983f5d68c4a515e6d9df46d64a2230492479f07d0e9918c29ff929257ef7a49c32ace7dae27f9462e6d5bad39b5273cc67e395dd7f11f7c5518e6feb3b4c810e19920169492288e01b475027ffd36d13dce49457dc40939170d17b0e8cf6e490772090af1c21f6e1bca5c9ee0fc1f73f6106c144fd7223049e8eda14e85e99a1050fb600f9fa2bc30c533afd7b0e4c3ada9a76c333cca94a20a6c55016e7f7aae2b639272d00458f2957377869b284cba6907f74481692eb70a5a3098f178fe79dc91de6ad650994994327f46c56fe45b75351423b93fdaf24e05aed041a36d24795bf735335322765bb02ad43bd0651a638489a91710b424f09a0d26c313b40b2b8735d616149b6bdd316d5751b6ec0c80317d5eaae4c728f19205aef062261946abfc76289b9ac4b2b4f89fa01dd7b7425547ac69b55356429f6e78e796d8965e76926dfe22fdc739b8011aa59eb25613d45b25eb89350261665efad594fa24fbdea1db8aa785b960867aa004fa7dcf9e445c298b08d4b1e720460f9d5633041c0d493e6afec69f8f9fe87fdccc05abaf549d797311a1fa7a07f3b81ba54e3bbede8213a240fca5944d394a73b54c94ceaf75f91f34ecda6f4ba5f67c2d7a00afb4f846c1d227facdeb4ff02a27750e3b47132952536032a4a0222bdd5ee92fa80110c60db2ac0fa439616b3d8f582a47232730cc7e44a6e9e09672ea48161efed74666c8a43128998dfd208373db0d7e242db398503c01d131a35017ee21e193ffdb40cbbe1ea57ede3dc476e512108670cdf442c85f8f1ecd58bf0276b19a38fa1907ba40c25469b38a77df953c773f5682818889d70110358c6f3a1bc8f6bfdd9c2c07baf429a314181fdb7471a387fab1f36b6d1d4d6bca79ba7251fbd7a534aedf5f5c4c7c0daa226af1d91c0a73bdfef6e943172b4808e17512c4a819a651f19c1d854d8c63d6106941bf208766bc5090d03772c930b06d82191cdfe5f89144d6ee660415e56f1dc659ca766d32d59d498556e6ee1d27310bb5a29757470a591b1f8f2416e8d3a8c21182c709ff63b6eeaeab392f0b9d8cb9a2e66834f6456f6cb125c216e00dc93ed615745d5903413286149c0a3f8baaddb2ca8e6efdde841d45e4e517e63dc0cc633db1dbd2a26cb64a9d87588c53f3c71509326425d0d1260c53c67415315581e21c949b058cb58b4df1f644a5446be10aa6113ed0f77bd2e821722a91aec79656f923273d8271c40c773c3eb22dfe24cb7d6d856b41e7befcb08b7b4064e49e1656a20d8fb8cb25b378bc039533b056c8ed5ed1a1d200ec515b9248ec4f7a8b7cee8a14eaf25e9b92065648ad749c04ad2b9ffcaaedcbd264a1d4bb55a9910ffb8ab31d8f55a53ccf38e10fc9d6538cc459bf7a1ae5e8bce5a7291dadb3223616b6e3faac977693cde8f65a5057a0e7c1fb938a588de22d53f6441d27dcf3ae7b91c59287da1c2a19e048ba0fc7fa901cabfaa42fb4165ba85f64d2226e5539805b6817d0c2fce06a3a8e3dccffc46f19b9db2417351c20a4a0dcd5f81edc8bbae5668ef709a5dc1c552933cb8090963602f34d177d9b791869abebf2da3b450795620d4b4cdca26bf3a5cffa1286767ba721b500d035d8551ab0080c7b8dc0e36df05de0013cab465ccf7679531f793d22357e8b53bd42f8c449bc37ff65200d45b254102e48b18fb5dbcea1238ec936015133fbd87006e9c82b5f8c58d140bd35d8c1c496ef387c3e71d85cdca84a0951158b2d4c3416a15c9b007bab9af61e531f97ca44030417cad55e4a01b3782575f915bd48e331114c70cee1270aa6406d939be25c52c00f76f6a92f5df4b2904d2b16d6b65d80efad558216d0eae26ebadde64ebffcd69cb1fddaabda2fd89ff157c098c2e6e1ff96cbb47f6b26463bb284a9a07d5d3957c9ee363ab2f7dc363830afeff4fcee1cf479cc9037eed94656a68eeb7781bdc4c732a2663664ba1b438ddb2098196a5601ed6b54286411b74a9fcb19b3a5b0e8b64c1b75c5d248e0cbc1e019002aa354600d8bac348043da6b3d2d7cdd33f8e30598f4cd175cc41bd5839e7348b26efb400012801f99d9e65e968a0e7345b2c57c7f4030675d9e5b3cd4dcb999120a5fa9bbf425e1c3750f1362d30e311a3f9428995b1577b15c30cc70303abbcc13496fceda52895538083e7f41458c35dc5b4be1f05e97303855b9786a0a4398a84248c75009bc235b8ae0fd417bf9d04ed270f1fffda21ab5aacc614e62f66ea507d8522473a973f0a2a289233ee8bd61e23e25d12f571217a4c1efde5364fd08254472a0a2bd53e58c09b5855333089ceca2b0ec29a365079ada453bcb347b8d2f50ce8d16f33852f6e6133002d3a3e56e6f3ddc0f7545dd827fd55e3384d55aca7f5a10bc1490d12038547de734c18716bec1dcb2894506510b89d42261085a814050b1169e7698599ff2f86eac5b026ecc4bf4ef368c13e7e0d1ec53b3ee31882d7038a9b3ae6c12de2d9bd13c71379a82f52dff6b26e655ae59c0a43c1575da377aca03faa981024044f0c06f30dac887879060375568e3543ba57521d7e98c7169837b11d2f48dc53857dc10b6c7bfcd3db4628c466621cea35986ed194834c76be2c86850dbba756c7abbc6ba99009a18239e71339eff3926e23a541efea315105477d3381842c0cd7f2a6a6676e2df26f3e4df6ae961c118d73925e0ba9fa9316206b76914ca7e456ad52e3ca2548f65cdf77631c053c9a2ff63180bcb6ad6a290cb6ccbcef2de9063653633ef8f78522ff0d14bd0230d404909ef3aee1f07463b61a9b00c9d7e44fd7ca1d04f17fa6f64b004bf55a119c53a8841820150b801dac770ee63b974093522f601d4720536f81f249d7656e5278c927b4eb78c7b8d59ae43096d3f0041f138866c775091af27955c5407f50a9b0e367e6b9a79fde779814f7b966573c615384e827e179a2aace485013bd2e25d2bdacef963ffd6ec948a3ac13a87d7f893bd1780de3c01d2031fd88303d566a8849751aed2030a56f38687e598be0d27a4b395c264d3d97b4511d16dc1314a4a3db7bbbdedeca5b508105de1591569ad69c4234d9e9641e47c476c6acabe3b8db8864e462702d50037e9363350a57c90f0fe1e100eae25398a0bb4f1714ea9f05ee4ba19e56e0484838b322b3452b16c798e7d8a7a5288b0115f933033039ab901231ac5513e726ebfd32fc32c0fdd09d7a97d45096fe36947483814dd74876d909c1a1f283a4af8a82e6b8cdc1da58fb250ea6b3a09540b0c01fdca2a2969d62f573b555d3911ea4e3f2969ba6e4c28a5e9b6475c8ad6bf1c2f42f874ff08c063fae3ea8b71143cdbd8d72571978bffb3ff80eaf464f1bbad3bd9c4d95c0bfe650984ec20f9ca79f9c81c5b261e0347c477f56b2ffb493f6b3985a571bd7789c00e862c098855bd70430664800d99aaaaff1f24d37630ed602e0ebd62e9a97b39abeee720c8721c40ad7057d433c07711c1be964b4fd0eafb3c4ab29a8dcc853d063d2ea575f73a4dbb87d80d207eba897322a9a0321ace92e59fbd6113d1988c5df15a0b385000a9bfac2c11c685522a1a4a892a86c29be345d844632058b217eedc6f3ecab9ff601c952274a339647a1461448b0ba694dbcf0374599649f90aa8d00aa1f4cd4d3bf219f8aa2a2d85a06a3393eac45b77ea35555103b448365d91ae6fe8984cf8b895577421139f1cfb7a8d7a728cf797dc1ea6606f37d415bb699e1b463adc25943f031e3e169015a4bedb5394257fdaf7ec39210c59a144a342452d9ad7a9f148f7eb06e71a3cadef7b15a1f746478d906a45c28bb6dfc13500b9fd8a0b49147a3879b6ceba91be97c153a188424ce7056fce1425191dc776011b170c5d65ccad77fc489c7cca61e58d0a9b2c5d66c09935dbdd2c1d7bc3dc321be5dbbe343905a1afa4a362f45df9b1b72cc4f9da8dd0fca7baad2b6b9f9e0ba7d71593941e4e581b64927d20829e9c1cc75de44de1dc2584e9eea6f35a6dd89014014a5d156906ed9ce26fbc32f669ee2bddfc9149627d8a22f192c18cd6c61ac42435da05ec4779863304686ab2ec96a756b245e185989c049953abff979a34a669d067a30713f7478628b25939f4c99bae9a5f431d8994a12f2e9d7bab4386aa6ad82cf46938b7855119db4f098d5513422dcc12b8745eb713765afaea0736606503e1943c730168eb734f490e1454e89ef3112e738670e5a930f2b4a7e11efad7526f1f246679b1c0350d9ccd147d5c00e6e6438544a073f51bc9c89e432c81c42ce4e7c0347d282508ebf00b81dc76435a54ca2e1584bbe59378daf78540552beb94bcba021fa1dc70bc2ea37bcb2b77dba72f01739831ce7c56992f02f01dd8cc1c93408378cf062db9ce0fac1b99cfc7a4d02b0a15b04f759bd0598e63fe5d9700c75916366e9baa7b364f077f1fef92a2a96cab1d5caaca4861719fc65386a56cb08b94a85fffe90e8876ef2b88f2e6c925ee781b90fe98ff0379125eda8f7d58b053ade5223bf897c4e0318f0480f1dc27a91d636e5d8c821b9b025f360430a9f2c03f66b85d6d3f2062be06e2fb492744790fa4ca41b173685a2940d77504e142b14de7c300ba34fc61209ab802912f2d7b7d549378092d7826498526ed4a7e974e8fad0d1db4a5afc95d8ee3844a4ac8897c2a0537253fe4d058ad0025946c5a397781ea067d47bba7d99130762cb7e106bfe818078d0720e154fce194ea80bba56b463243e4796d9622918555f7e8c27ae83edd5aeff4f9979ee4501bb1531aba53d2e64247592e081c649efd5c3de42514bfe89af1eada838776bce2e5ffea76592a186f4bc7fbda5c2e6ba9f062298097c4acddfb5c50ba66ec3dd8848a58da773398f9db1bb1f5c7e4e1487e9c5878243cbbfa2fc83eb2f4a96edaeca88cda00db68dcce7dbbc2a3c2cb1804293128cd3c1a0fe06c56a6f1e7d626648ce1da14f544eaa7dc4cd6f56ce8c7f732cfb67532fdf628b36cb504e985d016feb9e698d9b940d006898006b65c0280347f855562d855a03c82a682478c616d963424ed6217ad2fa5c7d832ad91d404db670d799fda6786c0f34d6dccc609b0d14c2de74abfc4239986e7a527a3a278464caf70de536c1e77dc65757bcb336f7e0a3f0a79157628b83dc8c03b11cd8f04ae89081b2f23ec64019746a7d10bafda7f87d3f6da95d853e3f982ae66622e33a94f1b85afe99e63c94c723306abb3cf40e2e931928a275c613d0dc325fe7886707052835d85350085b5464dcea952e83d12b61d5792cba6b5b7e3ba6ac2ec53d79f23d96d7910f26c1b83050bd29a0b8ee4676828221e238c961446ee1ee191e55cf0babbb67522c9d834b5547166b6967b1632725de047c5221387c88fea21c326df362e1ae4b5aa883e93b2046155dc166a29c6d5b55387c4d467a154d190c07dfb46d05df64c73b71e185bbd1beb34169a116b7ff9f0394e8d2b986605b5fcc349c428791778374e4232f4ef687c88b793c5a8e83a197f52f93a0258f9e3f39c337c42f9d9ca811391ebc7039766ffdbe91d4b7a05f2d4ef48fea25ef9eaf8ebe409c3da1caa5ab69ba9937380bd217df173c1c0327a619681b94258a409c0aef800eb00d0ecf8321b2b22c21d0433e179e6f57339e5c8344fb171d5f7db34f201f5579f6f1fbc65c5a5c35828405c293f02f4e69574776475ac5126e47d31628c4f36e4f7facffc0ae5aec93d7378d37c3a6be3b2433998c99dd21148163d3f7e217063b0b9f6a8db7df4f38fa45e9162f749bd08954888cb649d72ea722b1218907ca11a4a1f5035d063a71ad00e77f45afb9401cb7910071c7cdcee12d057c49857560abe60c30ad3e02178ab42d8a96d44cc531807af5f42e27cd31cb5d48124329e5ae04ea02e72a254797cad76f573f4105effeccfa8f3e14ec80f08c5b6a98ff7dd6c7a010f3f98bb116f97c37c07194e546218b5c8ed56f2ea34ad6b20d2cea13e76e3d1496497a999b3118a76718105e77f045b50cc03e3b07c90fda02710207770991cf4280b64e4d76210e71ddbe069c0fc8572053b21607d9e19ddc05ffbdaf7f5648197be5443b207a53480fbdd704b4468502ef2682eddb654234ddc8d138201b8ae87aa29ce5a8ccf0050035929569af5399117d86f036654723851d7681844798445275650a4b296449781d067a18bfa56a2837127e5752f1b67b3c1f075047ff283a97e357c2f22683b2921aa150781111922c9389cc8ffe51e617520c1f80860b250806c254e2698c52daf232e4f4e75a300840a6371618cc524bfa1357350ef35eb6975209418e7bfe7d220d117f2f9e29b7d7011d7d6a3033f1da47ea36b676841e5e178b6d931b7c9d57eb18188a113b272d9ceb757a385e4fa882d8624ec974f35a8fafebe0e8733f06f9b06894862afe7c1d2facd2f95a4abfe0ee1d10bb537599a074a57e1da93f2edc35fc8769b7c9bcdbb80a12cddcc9f0c98d244c86486a110f4acc0762fb0c53f444bf83172aec733c0d83fbb46339906074cc144ff62eb67502ace1cb23f5c8a046c8755f7feb262845e176c916dd60872fc6f3e9b844c8704b337d3773adbac717c1862f72424323688809de8f93868491ab1a9d13b2e8740cd97afc4bc73ae0d5949d573db8e099fbff1162ab3c85be0e2f6efe34199d45ae5792f8fe35550f390c64eba6b12f48a38aa4666849f9511371dcbf785f7236c6688223c12a803f7bcf63d3ce01570efb7f0eb82be38b3a34735950b3cc85b6a03f713e926cca4b868630f9a51adabc7306b0f618bafa7adbdb07937f8ebe22629dd601df1b1bd88386dba78b743e93dc059b1591484ff26ef5d1373f9618020a733ae90fd2671155f80de3c800074fd79cdb6c3b8d6b17b90bf3e0e1468ed115efbd340db65d250893c6cedbd44e85bd67ba7aab00dc444acadabfa5d49342d2856deca2010da6e43f4d79203f57e19e4dd74ab364ba7f617af7fb334ba3e168a2b4ebbdcb993fae9453686e0d90b6fcddae94157cf31ab5b4036c674eb248a5d4ad540bf4470e5a336aa25679dd1944ed505f0ffb22b6b40dd1496d88d75ea8cb6fea033da3ec6e3ad9bcb0c93a7ef5ba10f6f0b6be098d2efba48ae01a5166d948b9ea763015783eaabc2a8cfcfe0074ed1802154c3aed38fabdc0e905fca1c2f511f470a3f6535761cb98d920a8aa0ff87b74ad770948c1e01799a7712eb09aa5311527083af84c0fc160564771c91d29d1026ee298a0fcdfcf35f039ad3807669fc280cec7157fdcc7dea06cfefa85e52b3e8dfaf0821517b7f14ab3313c3d566d82cd9fb914faf36f7722a30eb72bcc30573052b603bc3b43ea2261de7151d902b2356fb7810bc8180ad67bd141dd32ed0188d48bc23f51c844aa5938adfd4964ceaa547d6665683363f37f36135c632d8e0346526fcac087f609674541d02f09ea34e6e2ecb7bca45357a668f560878d50bfdcb82e82847f2b2b126b89559d5e639431a50a7c1a377d517e2b63bec8f74f83c19f2a994af994eb1328b1728fc64d5d34f1c7235e94a3e4e68243ab6e07a88f8f426d7459a9585b8829d59e9a10f702e06191b87c448cb2dceff772c6a93b3787c4b66fe6fa325c8edd420e330ddb7bd85ae45c391e84ea457ab0b64f6e8f57460fe8e6332f96d5927da3e12e8caeb0177d509fee46eb776fd59e6f7b1e41541e952f303e0944afe27b49ccabc265f19f2410d8904e7fadab9335c0dd9e79997b9117f26308810894b2c9e58ea3465b1fc450c18a857ec9dcaa4bfc570b32ea5a261b839212aa99ebab6be3b563fbcc61be6acb1391f5188045a2b00e79034d9a55c69f9c928abf625fb8516ce34c724d57ab7092505d0f2707104d4dc04cc9fea1d4e9262f1b2281329ce849a78148053d4235d28126630067a35c96f0d733e43daf6f2cde6832013f46262cbc2e015e2f0f064954ad225243075eb75dc51d7dc2f16a4fa34e6cf90aa910afe421ec83834ea853311928fc8b781871ce75a7287b41c13df4308a238591257711d4d3f20d1c025245157abcd47ca23f965e0b87432261261cbabefbc8ec3d33fb576d2b8d70af7f4694d3254f58a478a8d198ee4d628376421790acd7a7a38d3bf29f1f2053373ae5bed99731723fd0ecf7f9ac63bd5ba6aac1d8cb32e5ee3f61cafd0313ce6f6f5ab903ad6caf3df83ba676a41cea2d2a172efc6c0a39fb412bfce63380f71d4b8e8b320ecfcf0e4a579c8b1126308dc6c5dc2b9e8348e0e72e5ad9279372c5da1f3239b5275f9c4d4198bece3c1e740b7f6aad81eb60474f4a90e925cde78cf5bd58f1b8bb595e320f9d50e0a5d16d421146ea69b6e9ed93007f4bda7f76f1f624993689afa08879c6a35eb23c76e2ff0460b8d767d1daecb3c04013e8fb2b6bc9f13519bc550976adc7f7c25dccc2a613b95ed2f031434d84ee19d45051b47e7e8382626fb720305c824642af6c69d783af80c3419f4ec6117b8127c9dd358e2df68d7356a882b7feb1ef8165c3b33c00517de57e7376ecc512357ad8f4c3c3d24e5323e4e9374ea11848f4ba3890e0a12bbe6ae5c271aeeda559573a489d36126cb38f7da1e4f88ea689edecf0bb9fb80ef05af08de91c1cb316f4a0859fd63a3eebb1fa5525d1e9eda38c7e4980405790f1f1512ec4e46058e73f188822a2ae972d65f738e9ac20c6db59dd1bb556805c7c23c2115717eb565ecc525ae8d8cca8f8eb6b54a8c530d46e94a29399af72383423c1683655150039dba9ccbde0697a28092da912585ede84ad0063d9cbce40bc4c9c3388bb8ebd0b4d03314d45e4ded003b0bc3e75809ea0ab5e35a043eefcba4adaec288ffb96b5c340cd9b380134323c9398ef9addd024751fe424439ce5138cafa307dcb1dc71d79c415b221113a191e17dd8881ab45bc461022c4c84ea73893045f9fec8725e562c7ff942fddfea92d9049cc0324b1a5f55bf5807d71a7d9750fb3bf1ef9755d89fe3e490cbebec42a66752768f9b88b8035ff2b7f0acd446f7d15e142b1cc314e1d7c3f15e6c7d0f9c3a760226b6167a16d0d99e3a6fa2c6ae6f0a67172bf0f0a157876b781c016315ee6d5baa1abb8852c2debd61501be415fa3a5f76a89150b6c6c690cb20401ddc11293cc5b1637455dd5cc6b6ca7e79c4243e054a11f2ee8bc40c6907bc1289e994073aa8c6bcf80337851fbbfe8b6eae152f5229dc5b24671fddd436cc75bbe4109ada1b926830bda6216deb2f9bb4d1ed51acb6bc7952029be2487cb5ceda1a80370de1a87a41a53406a90a8a445a01d46497a218181691758e2d8704314830ed254d7933cb3ef7cac69de75dd70b494490d2f461dc140a644afda7de952d15683a67eeafb31125cd220875a74c778b67839129501011394f7a30c7503e010cc2066134044b5931256e16ed44effa6cbd425b79b6cea55ee4aabbfe485385e9ac7ca69ce0c45518de32a93f9b2b9b1df22297e526b3ae8e26f388505698fdf28a9f4ebd30f704b704337ebbfb53f3c3c4e6ed4a82191e16c53da4a9666cafd0822367224ee01e24c0752de88578634afd0001f5c4fcf64c16e46bea8ab41499f3b060e6bf19b7dd56b74fe7ab150f016e40a2094676b9a539a7ba7f7397f6c705a3249328f1c424b5bc861a9e42b1bb311bdc0613f3ae9ab2b4b26c424e9891d0d3196df5e35416a8925e36bf2a44dac6330fe0ccc108eb30a1f000e915e8d485af8c5f0c8222e165c3486f62d9233f9bfd84bf61377ded157f2a828683939ee2741af100d847ed5cd95368475450433902642d92b705eeb78</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-wave">
      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">My Name</span>
      </label>
      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">
        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>
      </svg>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue 高阶技能</title>
    <url>/2020/11/11/5-3-vue%E9%AB%98%E9%98%B6%E6%8A%80%E8%83%BD/</url>
    <content><![CDATA[<h1 id="一、Proxy-对象"><a href="#一、Proxy-对象" class="headerlink" title="一、Proxy 对象"></a>一、Proxy 对象</h1><h2 id="对比-defineProperty"><a href="#对比-defineProperty" class="headerlink" title="对比 defineProperty"></a>对比 defineProperty</h2><blockquote>
<p>Vue2.0 数据双向绑定通过 <strong>Object.defineProperty</strong> 去监听对象的每一个属性，然后在 get、set 方法中通过发布订阅者模式来实现的数据响应，但是存在一定的缺陷，比如只能监听已存在的属性而对增删属性无能为力，同时无法监听数组的变化，所以 Vue3.0 将其换成了功能更强大的 <strong>Proxy</strong>。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="title function_">observe</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;瑶瑶&#x27;</span>,</span><br><span class="line">    <span class="attr">sex</span>: <span class="string">&#x27;男&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">key, value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`属性[<span class="subst">$&#123;key&#125;</span>]的值被修改为[<span class="subst">$&#123;value&#125;</span>]`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;妹纸&#x27;</span></span><br><span class="line">obj.<span class="property">sex</span> = <span class="string">&#x27;女&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params">obj, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> newObj = &#123;&#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(newObj, key, &#123;</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj[key]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">        obj[key] = newVal</span><br><span class="line">        <span class="title function_">callback</span>(key, newVal)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> newObj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params">obj, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> target[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(!target.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`新增属性<span class="subst">$&#123;key&#125;</span>, 值为<span class="subst">$&#123;value&#125;</span>`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      target[key] = value</span><br><span class="line">      <span class="title function_">callback</span>(key, value)</span><br><span class="line">      <span class="comment">// return true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读取：目标对象、访问属性、proxy 对象本身</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, key, receiver</span>)&#123; &#125;,      </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置：目标对象、赋值属性、新值、proxy 对象本身</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, key, value, receiver</span>)&#123; &#125;, </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断：目标对象、属性       </span></span><br><span class="line">  <span class="title function_">has</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(key.<span class="title function_">startsWith</span>(<span class="string">&#x27;_&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target,key)</span><br><span class="line">  &#125;      </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除</span></span><br><span class="line">  <span class="title function_">deleteProperty</span>(<span class="params">target,key</span>) &#123;</span><br><span class="line">    <span class="comment">// const readonlyKeys = [&#x27;name&#x27;, &#x27;gzh&#x27;]</span></span><br><span class="line">    <span class="keyword">if</span>(readonlyKeys.<span class="title function_">includes</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`属性<span class="subst">$&#123;key&#125;</span>不能被删除`</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> target[key]</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// proxy 监听函数</span></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params"></span>)&#123;&#125;,      </span><br><span class="line"></span><br><span class="line">  <span class="comment">// Object.getOwnPropertyNames、Object.getownPropertySymbols、</span></span><br><span class="line">  <span class="comment">// Object.keys、Reflect.ownKeys 获取对象信息时</span></span><br><span class="line">  <span class="title function_">ownKeys</span>(<span class="params"></span>)&#123;&#125;,   </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 new 操作符时 </span></span><br><span class="line">  <span class="title function_">construct</span>(<span class="params"></span>)&#123;&#125;,      </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 Object.defineProperty 修改属性修饰符时</span></span><br><span class="line">  <span class="title function_">defineProperty</span>(<span class="params"></span>)&#123;&#125;,  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读取对象的原型时 </span></span><br><span class="line">  <span class="title function_">getPrototypeOf</span>(<span class="params"></span>)&#123;&#125;,  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置对象的原型时</span></span><br><span class="line">  <span class="title function_">setPrototypeOf</span>(<span class="params"></span>)&#123;&#125;,   </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过 Object.isExtensible 判断对象是否可以添加新属性时</span></span><br><span class="line">  <span class="title function_">isExtensible</span>(<span class="params"></span>)&#123;&#125;,   </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过 Object.preventExtensions 设置对象不可以修改新属性时</span></span><br><span class="line">  <span class="title function_">preventExtensions</span>(<span class="params"></span>)&#123;&#125;,  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取代理对象某个属性的属性描述时</span></span><br><span class="line">  <span class="title function_">getOwnPropertyDescriptor</span>(<span class="params"></span>)&#123;&#125;,  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h2><blockquote>
<p>Proxy内部调用对象的默认行为的 API，提供的静态方法与 Proxy handler 相同。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">name</span>: <span class="string">&#x27;子君&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">let</span> has = <span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> obj</span><br><span class="line"><span class="keyword">let</span> _has = <span class="title class_">Reflect</span>.<span class="title function_">has</span>(obj,<span class="string">&#x27;name&#x27;</span>)</span><br></pre></td></tr></table></figure>


<h1 id="二、装饰器"><a href="#二、装饰器" class="headerlink" title="二、装饰器"></a>二、装饰器</h1><blockquote>
<p>ts 开发时 vue-property-decorator 提供了很多装饰器，但是没有 ts 时也可以使用装饰器。</p>
</blockquote>
<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 如果有 eslint 则需要配置支持装饰器</span></span><br><span class="line"><span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaFeatures</span>: &#123; <span class="attr">legacyDecorators</span>: <span class="literal">true</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> target 对应 methods 这个对象</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> name 对应属性方法的名称</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> descriptor 对应属性方法的修饰符</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> fn = descriptor.<span class="property">value</span></span><br><span class="line">        descriptor.<span class="property">value</span> = <span class="keyword">function</span> (<span class="params">...rest</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`调用方法【<span class="subst">$&#123;name&#125;</span>】前`</span>)</span><br><span class="line">            fn.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...rest)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`调用方法【<span class="subst">$&#123;name&#125;</span>】后`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getData</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        @<span class="title function_">log</span>()</span><br><span class="line">        <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取数据&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="节流防抖"><a href="#节流防抖" class="headerlink" title="节流防抖"></a>节流防抖</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; throttle, debounce &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 函数节流装饰器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; wait 节流的毫秒</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; options 节流选项对象</span></span><br><span class="line"><span class="comment">* [options.leading=true] (boolean): 指定调用在节流开始前。</span></span><br><span class="line"><span class="comment">* [options.trailing=true] (boolean): 指定调用在节流结束后。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> throttle = <span class="keyword">function</span> (<span class="params">wait, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">        descriptor.<span class="property">value</span> = <span class="title function_">throttle</span>(descriptor.<span class="property">value</span>, wait, options)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 函数防抖装饰器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; wait 需要延迟的毫秒数。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; options 选项对象</span></span><br><span class="line"><span class="comment">* [options.leading=false] (boolean): 指定在延迟开始前调用。</span></span><br><span class="line"><span class="comment">* [options.maxWait] (number): 设置 func 允许被延迟的最大值。</span></span><br><span class="line"><span class="comment">* [options.trailing=true] (boolean): 指定在延迟结束后调用。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> debounce = <span class="keyword">function</span> (<span class="params">wait, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">        descriptor.<span class="property">value</span> = <span class="title function_">debounce</span>(descriptor.<span class="property">value</span>, wait, options)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件中使用</span></span><br><span class="line"><span class="keyword">import</span> &#123;debounce&#125; <span class="keyword">from</span> <span class="string">&#x27;@/decorator&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>:&#123;</span><br><span class="line">    @<span class="title function_">debounce</span>(<span class="number">100</span>)</span><br><span class="line">    <span class="title function_">resize</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Loading"><a href="#Loading" class="headerlink" title="Loading"></a>Loading</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Toast</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* loading 装饰器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; message 提示信息</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; errorFn 异常处理逻辑</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> loading = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  message = <span class="string">&#x27;加载中...&#x27;</span>, </span></span><br><span class="line"><span class="params">  errorFn = <span class="keyword">function</span> () &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> fn = descriptor.<span class="property">value</span></span><br><span class="line">        descriptor.<span class="property">value</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">...rest</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> loading = <span class="title class_">Toast</span>.<span class="title function_">loading</span>(&#123;</span><br><span class="line">                <span class="attr">message</span>: message,</span><br><span class="line">                <span class="attr">forbidClick</span>: <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">await</span> fn.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...rest)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="comment">// 调用失败并且用户自定义失败的回调函数时执行</span></span><br><span class="line">                errorFn &amp;&amp; errorFn.<span class="title function_">call</span>(<span class="variable language_">this</span>, error, ...rest)</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                loading.<span class="title function_">clear</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>:&#123;</span><br><span class="line">    @<span class="title function_">loading</span>(<span class="string">&#x27;加载中&#x27;</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">loadData</span>()</span><br><span class="line">      &#125;<span class="keyword">catch</span>(error)&#123; </span><br><span class="line">        <span class="title class_">Toast</span>.<span class="title function_">fail</span>(<span class="string">&#x27;加载失败&#x27;</span>) </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="确认框"><a href="#确认框" class="headerlink" title="确认框"></a>确认框</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Dialog</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 确认提示框装饰器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; message 提示信息</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; title 标题</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; cancelFn 取消回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">confirm</span>(<span class="params"></span></span><br><span class="line"><span class="params">  message = <span class="string">&#x27;确定要删除数据，此操作不可回退。&#x27;</span>,</span></span><br><span class="line"><span class="params">  title = <span class="string">&#x27;提示&#x27;</span>,</span></span><br><span class="line"><span class="params">  cancelFn = <span class="keyword">function</span>() &#123;&#125;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> originFn = descriptor.<span class="property">value</span></span><br><span class="line">    descriptor.<span class="property">value</span> = <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">...rest</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title class_">Dialog</span>.<span class="title function_">confirm</span>(&#123;</span><br><span class="line">          message,</span><br><span class="line">          <span class="attr">title</span>: title</span><br><span class="line">        &#125;)</span><br><span class="line">        originFn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, rest)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        cancelFn &amp;&amp; <span class="title function_">cancelFn</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    @<span class="title function_">confirm</span>()</span><br><span class="line">    <span class="title function_">deleteData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;在这里做删除操作&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、Typescript-Vue"><a href="#三、Typescript-Vue" class="headerlink" title="三、Typescript Vue"></a>三、Typescript Vue</h1><blockquote>
<p>项目构建：vue create typescript-app。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">project</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">Prop</span>, <span class="title class_">Vue</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-property-decorator&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Project</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/Project.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">@<span class="title class_">Component</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    project</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// data</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  private <span class="attr">msg</span>: string = <span class="string">&quot;welcome to my app&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  private <span class="attr">list</span>: <span class="title class_">Array</span>&lt;object&gt; = [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">name</span>: <span class="string">&#x27;Preetish&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">age</span>: <span class="string">&#x27;26&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">age</span>: <span class="string">&#x27;30&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  ]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Prop</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Prop</span>() readonly msg!: string</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Prop</span>(&#123;<span class="attr">default</span>: <span class="string">&#x27;John&#x27;</span>&#125;) readonly <span class="attr">name</span>: string</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Prop</span>(&#123;<span class="attr">required</span>: <span class="literal">true</span>&#125;) readonly <span class="attr">age</span>: number</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Prop</span>(<span class="title class_">String</span>) readonly <span class="attr">address</span>: string</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Prop</span>(&#123;<span class="attr">required</span>: <span class="literal">false</span>, <span class="attr">type</span>: <span class="title class_">String</span>, <span class="attr">default</span>: <span class="string">&#x27;A&#x27;</span>&#125;) readonly <span class="attr">job</span>: string</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Computed</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">get</span> <span class="title function_">fullName</span>(): string &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">first</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable language_">this</span>.<span class="property">last</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Methods</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  public <span class="title function_">clickMe</span>(): <span class="keyword">void</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="title function_">addNum</span>(<span class="number">4</span>, <span class="number">2</span>))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  public <span class="title function_">addNum</span>(<span class="attr">num1</span>: number, <span class="attr">num2</span>: number): number &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> num1 + num2</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Watchers</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Watch</span>(<span class="string">&#x27;name&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">nameChanged</span>(<span class="params">newVal: string</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="property">name</span> = newVal</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Watch</span>(<span class="string">&#x27;project&#x27;</span>, &#123; </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">deep</span>: <span class="literal">true</span> </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">projectChanged</span>(<span class="params">newVal: Person, oldVal: Person</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Emit</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Emit</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">addToCount</span>(<span class="params">n: number</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="property">count</span> += n</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @<span class="title class_">Emit</span>(<span class="string">&#x27;resetData&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">resetCount</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 生命周期</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123; &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123; &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// Mixins：ProjectMixin.ts</span></span><br><span class="line"><span class="language-xml">import &#123; Component, Vue &#125; from &#x27;vue-property-decorator&#x27;</span></span><br><span class="line"><span class="language-xml">@Component</span></span><br><span class="line"><span class="language-xml">class ProjectMixin extends Vue &#123;</span></span><br><span class="line"><span class="language-xml">  public projName: string = &#x27;My project&#x27;</span></span><br><span class="line"><span class="language-xml">  public setProjectName(newVal: string): void &#123;</span></span><br><span class="line"><span class="language-xml">    this.projName = newVal</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">export default ProjectMixin</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">import &#123; Component, Vue, Mixins &#125; from &#x27;vue-property-decorator&#x27;</span></span><br><span class="line"><span class="language-xml">import ProjectMixin from &#x27;@/mixins/ProjectMixin&#x27;</span></span><br><span class="line"><span class="language-xml">@Component</span></span><br><span class="line"><span class="language-xml">export default class Project extends Mixins(ProjectMixin) &#123;</span></span><br><span class="line"><span class="language-xml">  get projectDetail(): string &#123;</span></span><br><span class="line"><span class="language-xml">    return this.projName + &#x27; &#x27; + &#x27;Preetish HS&#x27;</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// Vuex</span></span><br><span class="line"><span class="language-xml">npm install vuex-module-decorators vuex-class -D</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// store/modules/user.ts</span></span><br><span class="line"><span class="language-xml">import &#123; VuexModule, Module, Mutation, Action &#125; from &#x27;vuex-module-decorators&#x27;</span></span><br><span class="line"><span class="language-xml">@Module(&#123; namespaced: true, name: &#x27;test&#x27; &#125;)</span></span><br><span class="line"><span class="language-xml">class User extends VuexModule &#123;</span></span><br><span class="line"><span class="language-xml">  public name: string = &#x27;&#x27;</span></span><br><span class="line"><span class="language-xml">  @Mutation</span></span><br><span class="line"><span class="language-xml">  public setName(newName: string): void &#123;</span></span><br><span class="line"><span class="language-xml">    this.name = newName</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">  @Action</span></span><br><span class="line"><span class="language-xml">  public updateName(newName: string): void &#123;</span></span><br><span class="line"><span class="language-xml">    this.context.commit(&#x27;setName&#x27;, newName)</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">export default User</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// store/modules/index.ts</span></span><br><span class="line"><span class="language-xml">import Vue from &#x27;vue&#x27;</span></span><br><span class="line"><span class="language-xml">import Vuex from &#x27;vuex&#x27;</span></span><br><span class="line"><span class="language-xml">import User from &#x27;@/store/modules/user&#x27;</span></span><br><span class="line"><span class="language-xml">Vue.use(Vuex)</span></span><br><span class="line"><span class="language-xml">const store = new Vuex.Store(&#123;</span></span><br><span class="line"><span class="language-xml">  modules: &#123;</span></span><br><span class="line"><span class="language-xml">    User</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;)</span></span><br><span class="line"><span class="language-xml">export default store</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;details&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;username&quot;</span>&gt;</span>User: &#123;&#123; nameUpperCase &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">:value</span>=<span class="string">&quot;name&quot;</span> @<span class="attr">keydown</span>=<span class="string">&quot;updateName($event.target.value)&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">Vue</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-property-decorator&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; namespace &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex-class&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> user = <span class="title function_">namespace</span>(<span class="string">&#x27;user&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">@<span class="title class_">Component</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @user.<span class="property">State</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  public name!: string</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @user.<span class="property">Getter</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  public nameUpperCase!: string</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  @user.<span class="property">Action</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  public updateName!: <span class="function">(<span class="params">newName: string</span>) =&gt;</span> <span class="keyword">void</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="四、require-context"><a href="#四、require-context" class="headerlink" title="四、require.context"></a>四、require.context</h1>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@title</span> require.context(directory, useSubdirectories, regExp)</span></span><br><span class="line"><span class="comment">* <span class="doctag">@prame</span> directory：检索目录。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@prame</span> useSubdirectories：是否检索子文件夹。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@prame</span> regExp：匹配文件的正则表达式，一般是文件名。</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件内引入多个组件</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> files = <span class="built_in">require</span>.<span class="title function_">context</span>(<span class="string">&#x27;@/components/home&#x27;</span>, <span class="literal">false</span>, <span class="regexp">/\.vue$/</span>)</span><br><span class="line"><span class="keyword">const</span> modules = &#123;&#125;</span><br><span class="line">files.<span class="title function_">keys</span>().<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> name = path.<span class="title function_">basename</span>(key, <span class="string">&#x27;.vue&#x27;</span>)</span><br><span class="line">  modules[name] = <span class="title function_">files</span>(key).<span class="property">default</span> || <span class="title function_">files</span>(key)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="attr">components</span>: modules</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js 引入大量公共组件：.vue 结尾的文件</span></span><br><span class="line"><span class="keyword">const</span> requireComponents = <span class="built_in">require</span>.<span class="title function_">context</span>(<span class="string">&#x27;../components&#x27;</span>, <span class="literal">true</span>, <span class="regexp">/\.vue/</span>)</span><br><span class="line">requireComponents.<span class="title function_">keys</span>().<span class="title function_">forEach</span>(<span class="function"><span class="params">fileName</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reqCom = requireComponents(fileName)</span><br><span class="line">  <span class="comment">// 兼容 import export、require module.export 两种规范</span></span><br><span class="line">  <span class="title class_">Vue</span>.<span class="title function_">component</span>(reqCom.<span class="property">name</span>, reqCom.<span class="property">default</span> || reqCom)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// vuex 动态引入模块文件</span></span><br><span class="line"><span class="keyword">const</span> modulesFiles = <span class="built_in">require</span>.<span class="title function_">context</span>(<span class="string">&#x27;../modules&#x27;</span>, <span class="literal">true</span>, <span class="regexp">/\.js$/</span>)</span><br><span class="line"><span class="keyword">const</span> modules = modulesFiles.<span class="title function_">keys</span>().<span class="title function_">reduce</span>(<span class="function">(<span class="params">modules, modulePath</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// set &#x27;./app.js&#x27; =&gt; &#x27;app&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> moduleName = modulePath.<span class="title function_">replace</span>(<span class="regexp">/^\.\/(.*)\.\w+$/</span>, <span class="string">&#x27;$1&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">modulesFiles</span>(modulePath)</span><br><span class="line">  modules[moduleName] = value.<span class="property">default</span></span><br><span class="line">  <span class="keyword">return</span> modules</span><br><span class="line">&#125;, &#123;&#125;)</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  modules,</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="五、render-函数"><a href="#五、render-函数" class="headerlink" title="五、render 函数"></a>五、render 函数</h1><blockquote>
<p>render：自定义渲染、适合复杂逻辑、性能较高。template：声明是渲染、适合逻辑简单、性能较低。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// 初级</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;level === 1&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else-if</span>=<span class="string">&quot;level === 2&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-else-if</span>=<span class="string">&quot;level === 3&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span> <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">v-else-if</span>=<span class="string">&quot;level === 6&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span> <span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 优化版：利用 render 函数减小了代码重复率</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">:level</span>=<span class="string">&quot;level&quot;</span>&gt;</span>Hello world<span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Vue.component(&#x27;child&#x27;, &#123;</span><br><span class="line">  render(h) &#123;</span><br><span class="line">    const tag = [&#x27;div&#x27;, &#x27;p&#x27;, &#x27;h1&#x27;, &#x27;textarea&#x27;][this.level-1]</span><br><span class="line">    return h(tag, this.$slots.default)</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    level: &#123;  type: Number,  required: true  &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)   </span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;hehe&#x27;,</span><br><span class="line">  data() &#123; return &#123; level: 3 &#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="六、异步组件"><a href="#六、异步组件" class="headerlink" title="六、异步组件"></a>六、异步组件</h1><blockquote>
<p>项目过大时会导致加载缓慢，则需要异步组件实现按需加载。异步组件的渲染本质上是执行 2 次或 2 次以上的渲染，先把当前组件渲染为注释节点, 然后通过 forceRender 重新渲染。或者渲染为注释节点, 然后再渲染为 loading 节点, 在渲染为请求完成的组件。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一、异步注册组件</span></span><br><span class="line"><span class="comment">// 1、工厂函数执行 resolve 回调：切割代码为多个包并通过 Ajax 加载</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;async-webpack-example&#x27;</span>, <span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="built_in">require</span>([<span class="string">&#x27;./async-com&#x27;</span>], resolve)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、工厂函数返回 Promise</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(</span><br><span class="line">  <span class="string">&#x27;async-webpack-example&#x27;</span>,</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;./async-com&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、工厂函数返回一个配置化组件对象</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">AsyncComponent</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">component</span>: <span class="title function_">import</span>(<span class="string">&#x27;./MyCom.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">loading</span>: <span class="title class_">LoadingComponent</span>,</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">ErrorComponent</span>,</span><br><span class="line">  <span class="attr">delay</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">3000</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 二、路由的按需加载</span></span><br><span class="line"><span class="comment">// webpack&lt; 2.4 时</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>: <span class="function"><span class="params">resolve</span>=&gt;</span><span class="built_in">require</span>([<span class="string">&#x27;@/components/home&#x27;</span>], resolve)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack&gt; 2.4 时</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>: <span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;@/components/home&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




















]]></content>
      <categories>
        <category>JS 框架</category>
      </categories>
      <tags>
        <tag>JS 框架</tag>
      </tags>
  </entry>
  <entry>
    <title>Angular 组件化开发</title>
    <url>/2020/11/03/14-2-angular%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="一、路由机制"><a href="#一、路由机制" class="headerlink" title="一、路由机制"></a>一、路由机制</h1><h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建应用</span></span><br><span class="line">ng <span class="keyword">new</span> my-app --skip-install --routing</span><br><span class="line">ng generate component <span class="title class_">Index</span></span><br><span class="line">ng generate component <span class="title class_">HeroList</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由配置：app-routing.module.ts</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">redirectTo</span>: <span class="string">&#x27;home&#x27;</span>, <span class="attr">pathMatch</span>: <span class="string">&#x27;full&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">component</span>: <span class="title class_">HomeComponent</span>, <span class="attr">children</span>: [] &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;heroes&#x27;</span>, <span class="attr">component</span>: <span class="title class_">HeroListComponent</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;hero/:id&#x27;</span>, <span class="attr">component</span>: <span class="title class_">HeroDetailComponent</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;**&#x27;</span>, </span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">ErrorComponent</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;参数错误或者地址不存在&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">RouterModule</span>.<span class="title function_">forRoot</span>(routes)],</span><br><span class="line">  <span class="attr">exports</span>: [<span class="title class_">RouterModule</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="路由导航"><a href="#路由导航" class="headerlink" title="路由导航"></a>路由导航</h2>  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// 1、两种方式</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;hero&quot;</span> <span class="attr">routerLinkActive</span>=<span class="string">&quot;active&quot;</span>&gt;</span>Hero<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> [<span class="attr">routerLink</span>]=<span class="string">&quot;[&#x27;/hero&#x27;]&quot;</span> [<span class="attr">routerLinkActive</span>]=<span class="string">&quot;[&#x27;active&#x27;]&quot;</span>&gt;</span>Hero<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-outlet</span>&gt;</span><span class="tag">&lt;/<span class="name">router-outlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 2、路径匹配：假设当前路由为 /home/index</span><br><span class="line"></span><br><span class="line">// 路由名字</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;hero&quot;</span>&gt;</span>/home/index/hexo<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 绝对路径</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/hero/list&quot;</span>&gt;</span>/hero/list<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> [<span class="attr">routerLink</span>]=<span class="string">&quot;[&#x27;/hero&#x27;]&quot;</span>&gt;</span>/hero<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 相对路径</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> [<span class="attr">routerLink</span>]=<span class="string">&quot;[&#x27;../hero&#x27;]&quot;</span>&gt;</span>/home/hero<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">this.router.navigate([&#x27;hero&#x27;], &#123; relativeTo: this.route &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、路由配置</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;hero&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">HeroComponent</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;页1&#x27;</span>, <span class="attr">subtitle</span>: <span class="string">&#x27;页2&#x27;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> title = <span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">snapshot</span>.<span class="property">data</span>[<span class="string">&#x27;title&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> title = <span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">snapshot</span>.<span class="property">data</span>[<span class="string">&#x27;subtitle&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、动态路由</span></span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;hero/:id&#x27;</span>, <span class="attr">component</span>: <span class="title class_">HeroDetailComponent</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="string">`&lt;a routerLink=&quot;/hero/1&quot; &gt;详情&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;a [routerLink]=&quot;[&#x27;/hero/2&#x27;]&quot;&gt;详情&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;a [routerLink]=&quot;[&#x27;/hero&#x27;, 3]&quot;&gt;详情&lt;/a&gt;`</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigate</span>([<span class="string">&#x27;/hero/1&#x27;</span>]);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigate</span>([<span class="string">&#x27;/hero&#x27;</span>, <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ActivatedRoute</span>, <span class="title class_">Params</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">private route: ActivatedRoute</span>) &#123; &#125;</span><br><span class="line"><span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 三种获取方式</span></span><br><span class="line">  <span class="keyword">const</span> id = <span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">snapshot</span>.<span class="property">paramMap</span>.<span class="title function_">get</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> id = <span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">snapshot</span>.<span class="property">params</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">params</span>.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">params: Params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = params[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、queryParams</span></span><br><span class="line"><span class="string">`&lt;a [routerLink]=&quot;[&#x27;/hero&#x27;]&quot; [queryParams]=&quot;&#123;id: 4, title: &#x27;hero&#x27;&#125;&quot;&gt;&lt;/a&gt;`</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigate</span>([<span class="string">&#x27;/hero&#x27;</span>], &#123; <span class="attr">queryParams</span>: &#123;<span class="attr">id</span>: <span class="number">4</span>, <span class="attr">title</span>: <span class="string">&#x27;hero&#x27;</span>&#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> id = <span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">snapshot</span>.<span class="property">queryParams</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">queryParams</span>.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">params: Params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = params[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="keyword">const</span> title = params[<span class="string">&#x27;title&#x27;</span>];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="路由守卫"><a href="#路由守卫" class="headerlink" title="路由守卫"></a>路由守卫</h2><blockquote>
<p>常用于实现用户的访问权限问题，实现惰性加载模块。守卫类型主要有：CanLoad (是否加载)、Resolve (预先获取数据)、CanActivate (是否进入)、CanActivateChild (是否进入子路由)、CanDeactivate (是否离开)。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建 AuthGuard</span></span><br><span class="line">ng g <span class="variable language_">module</span> admin -routing --flat --<span class="variable language_">module</span>=app</span><br><span class="line">ng g component admin/admin</span><br><span class="line">ng g component admin/admin-dashboard</span><br><span class="line">ng g guard auth/auth</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、定义：auth/auth.guard.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">Router</span>, <span class="title class_">ActivatedRouteSnapshot</span>, <span class="title class_">RouterStateSnapshot</span>,</span><br><span class="line">  <span class="title class_">CanActivate</span>, <span class="title class_">CanActivateChild</span>, <span class="title class_">CanLoad</span>, <span class="title class_">CanDeactivate</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span></span><br><span class="line">@<span class="title class_">Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AuthGuard</span> implements <span class="title class_">CanActivate</span>, </span><br><span class="line"><span class="title class_">CanActivateChild</span>, <span class="title class_">CanLoad</span>, <span class="title class_">CanDeactivate</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    private router: Router, </span></span><br><span class="line"><span class="params">    private _http: HttpClient</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getIsAdmin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_http</span>.<span class="title function_">get</span>(<span class="string">&#x27;/user/isAdmin&#x27;</span>)</span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="function">(<span class="params">res: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">canActivate</span>(</span><br><span class="line">    <span class="attr">route</span>: <span class="title class_">ActivatedRouteSnapshot</span>, </span><br><span class="line">    <span class="attr">state</span>: <span class="title class_">RouterStateSnapshot</span>): boolean &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">getIsAdmin</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">isAdmin</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isAdmin) &#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigateByUrl</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">canDeactivate</span>(<span class="params"></span></span><br><span class="line"><span class="params">    component: HomeComponent,</span></span><br><span class="line"><span class="params">    currentRoute: ActivatedRouteSnapshot,</span></span><br><span class="line"><span class="params">    currentState: RouterStateSnapshot,</span></span><br><span class="line"><span class="params">    nextState: RouterStateSnapshot</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">canActivateChild</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">canLoad</span>(<span class="params">route: Route</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Resolve</span> (</span><br><span class="line">    <span class="attr">route</span>: <span class="title class_">ActivatedRouteSnapshot</span>, </span><br><span class="line">    <span class="attr">state</span>: <span class="title class_">RouterStateSnapshot</span>): any &#123;</span><br><span class="line">      <span class="keyword">if</span>(route.<span class="property">params</span>[<span class="string">&#x27;id&#x27;</span>])&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigateByUrl</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、注入：app-routing.module.ts 或 app.modules.ts</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123; </span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;admin&#x27;</span>, </span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">AdminComponent</span>, </span><br><span class="line">    <span class="attr">canLoad</span>: [<span class="title class_">AuthGuard</span>],</span><br><span class="line">    <span class="attr">canActivate</span>: [<span class="title class_">AuthGuard</span>],</span><br><span class="line">    <span class="attr">canActivateChild</span>: [<span class="title class_">AuthGuard</span>],</span><br><span class="line">    <span class="attr">canDeactivate</span>: [<span class="title class_">AuthGuard</span>],</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">admin</span>: <span class="title class_">AuthGuard</span></span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">RouterModule</span>.<span class="title function_">forRoot</span>(routes)],</span><br><span class="line">  <span class="attr">exports</span>: [<span class="title class_">RouterModule</span>],</span><br><span class="line">  <span class="attr">providers</span>: [<span class="title class_">AuthGuard</span>, <span class="title class_">DetailResolver</span>]</span><br><span class="line">&#125;)  </span><br></pre></td></tr></table></figure>


<h1 id="三、HTTP-请求"><a href="#三、HTTP-请求" class="headerlink" title="三、HTTP 请求"></a>三、HTTP 请求</h1><h2 id="Angular4-3-后"><a href="#Angular4-3-后" class="headerlink" title="Angular4.3 后"></a>Angular4.3 后</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span>, <span class="title class_">HttpHeaders</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; map, catchError &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">    <span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>(&#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HttpService</span> &#123;</span><br><span class="line">    public http;</span><br><span class="line">    private <span class="attr">baseUrl</span>: any;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private http: HttpClient</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">http</span> = http;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">baseUrl</span> = <span class="string">&#x27;http://localhost:8080&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">get</span>(<span class="params">url: string</span>) &#123;</span><br><span class="line">        url = <span class="variable language_">this</span>.<span class="property">baseUrl</span> + url;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(url, options)</span><br><span class="line">            .<span class="title function_">pipe</span>(<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="property">extractData</span>), <span class="title function_">catchError</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">post</span>(<span class="params">url: string, params?: any</span>) &#123;</span><br><span class="line">        url = <span class="variable language_">this</span>.<span class="property">baseUrl</span> + url;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">post</span>(url, params, options)</span><br><span class="line">            .<span class="title function_">pipe</span>(<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="property">extractData</span>), <span class="title function_">catchError</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">delete</span>(<span class="params">url: string</span>) &#123;</span><br><span class="line">        url = <span class="variable language_">this</span>.<span class="property">baseUrl</span> + url;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">delete</span>(url, options)</span><br><span class="line">            .<span class="title function_">pipe</span>(<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="property">extractData</span>), <span class="title function_">catchError</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">postForm</span>(<span class="params">url: string, params?: any</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">formData</span>: <span class="title class_">FormData</span> = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">        formData.<span class="title function_">append</span>(<span class="string">&#x27;username&#x27;</span>, params.<span class="property">username</span>);</span><br><span class="line">        formData.<span class="title function_">append</span>(<span class="string">&#x27;password&#x27;</span>, params.<span class="property">password</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">post</span>(url, formData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">extractData</span>(<span class="params">response: Response</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> data = response.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">return</span> data || &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">handleError</span>(<span class="params">error: Response | any</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">errMsg</span>: string;</span><br><span class="line">        <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="title class_">Response</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = error.<span class="title function_">json</span>() || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">const</span> err = data.<span class="property">toString</span> || <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data);</span><br><span class="line">            errMsg = <span class="string">`<span class="subst">$&#123;error.status&#125;</span> - <span class="subst">$&#123;error.statusText || <span class="string">&#x27;&#x27;</span>&#125;</span> <span class="subst">$&#123;err&#125;</span>`</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            errMsg = error.<span class="property">message</span> ? error.<span class="property">message</span> : error.<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Observable</span>.<span class="keyword">throw</span>(errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="四、Rxjs-异步"><a href="#四、Rxjs-异步" class="headerlink" title="四、Rxjs 异步"></a>四、Rxjs 异步</h1><blockquote>
<p>ReactiveX 编程理念的 Js 库。ReactiveX 来自微软，它是一种基于事件处理异步数据流的编程。简单来说，它将用户操作、网络响应、定时器、Worker 等一切数据都包装成流的形式，然后通过强大丰富的操作符对流进行处理，使你能以同步编程的方式处理异步数据，并组合不同的操作符来实现功能。</p>
</blockquote>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><strong>Observable</strong>：可观察对象，一个可调用的未来值或事件的集合，用于存储流动的数据。</li>
<li><strong>Observer</strong>：观察者，一个监听 Observable 流动结果的回调函数集合，用于作为参数传入订阅方法 subscribe 来获取数据流动结果。</li>
<li><strong>Subscription</strong>：订阅，一个可执行的 Observable，主要用于取消订阅。</li>
<li><strong>Operators</strong>：操作符，map、filter、concat、flatMap 等采用函数式编程风格的纯函数，用于处理数据。</li>
<li><strong>Subject</strong>：主体，相当于 EventEmitter，用于将值或事件多路推送给多个 Observer。</li>
<li><strong>Schedulers</strong>：集中式调度程序用来控制并发的调度器，用于将所有任务进行排序并控制执行时机 (计时器、动画等)。</li>
</ul>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><blockquote>
<p>数据流是一种可观察的序列，可以被订阅，也可以被用来做一些转换和组合。</p>
</blockquote>
<ul>
<li>创建<ul>
<li>单值：<strong>of、empty、never</strong></li>
<li>多值：<strong>from</strong></li>
<li>定时：<strong>interval、timer</strong></li>
<li>事件：<strong>fromEvent</strong></li>
<li>Promise：<strong>fromPromise</strong></li>
<li>自定义：<strong>create</strong></li>
</ul>
</li>
<li>转换<ul>
<li>改变数据形态：<strong>map、mapTo、pluck</strong></li>
<li>过滤：<strong>filter、skip、first、last、take</strong></li>
<li>时间轴：<strong>delay、timeout、throttle、debounce、audit、buffer</strong></li>
<li>累加：<strong>reduce、scan</strong></li>
<li>异常处理：<strong>throw、catch、retry、finally</strong></li>
<li>条件执行：<strong>takeUntil、delayWhen、retryWhen、subscribeOn、ObserveOn</strong></li>
<li>转接：<strong>switch</strong></li>
</ul>
</li>
<li>组合<ul>
<li><strong>merge</strong>：合并序列。</li>
<li><strong>concat</strong>：保持原顺序连接两个数据流。</li>
<li><strong>race</strong>：预设条件为其中一个数据流完成。</li>
<li><strong>forkJoin</strong>：预设条件为所有数据流都完成。</li>
<li><strong>zip</strong>：将各数据流最后一个值合并为对象。</li>
<li><strong>combineLatest</strong>：各数据流最后一个值合并为数组。</li>
</ul>
</li>
<li>特殊 subject<ul>
<li><strong>AsyncSubject</strong>：结束时传送最后一个值。</li>
<li><strong>ReplaySubject</strong>：新订阅时发送最后几个值。</li>
<li><strong>BehaviorSubject</strong>：新订阅时发送当前的最新值。</li>
</ul>
</li>
</ul>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="title class_">Observable</span>.<span class="title function_">interval</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">// take 取前 3 个数据、map 对数据翻倍、filter 过滤数据</span></span><br><span class="line">stream.<span class="title function_">take</span>(<span class="number">3</span>).<span class="title function_">map</span>(<span class="function"><span class="params">n</span> =&gt;</span> n * <span class="number">2</span>).<span class="title function_">filter</span>(<span class="function"><span class="params">n</span> =&gt;</span> n &gt; <span class="number">0</span>).<span class="title function_">subscribe</span>(<span class="function"><span class="params">n</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(n)  <span class="comment">// 2、4</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 完整参数为函数集合，只传一个函数时指 next 函数</span></span><br><span class="line"><span class="keyword">const</span> observer = &#123;</span><br><span class="line">    <span class="attr">next</span>: <span class="function"><span class="params">val</span>=&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`get <span class="subst">$&#123;val&#125;</span>`</span>), <span class="comment">// 正常流动</span></span><br><span class="line">    <span class="attr">error</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err),      <span class="comment">// 流中出错</span></span><br><span class="line">    <span class="attr">complete</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done&#x27;</span>)    <span class="comment">// 流结束</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> subscription = stream.<span class="title function_">subscribe</span>(observer)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    subscription.<span class="title function_">unsubscribe</span>();   <span class="comment">// 取消订阅</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多次订阅</span></span><br><span class="line"><span class="keyword">const</span> observerA = &#123; <span class="attr">next</span>: <span class="function"><span class="params">val</span>=&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`A：<span class="subst">$&#123;val&#125;</span>`</span>) &#125;;</span><br><span class="line"><span class="keyword">const</span> observerB = &#123; <span class="attr">next</span>: <span class="function"><span class="params">val</span>=&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`B：<span class="subst">$&#123;val&#125;</span>`</span>) &#125;;</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> <span class="title class_">Subject</span>();</span><br><span class="line">subject.<span class="title function_">subscribe</span>(observerA);</span><br><span class="line">subject.<span class="title function_">subscribe</span>(observerB);</span><br><span class="line">observable.<span class="title function_">subscribe</span>(subject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 广播简化</span></span><br><span class="line"><span class="keyword">var</span> source = <span class="title function_">interval</span>(<span class="number">1000</span>).<span class="title function_">pipe</span>(<span class="title function_">take</span>(<span class="number">3</span>), <span class="title function_">multicast</span>(<span class="keyword">new</span> <span class="title class_">Subject</span>()));</span><br><span class="line">source.<span class="title function_">subscribe</span>(observerA);</span><br><span class="line">source.<span class="title function_">subscribe</span>(observerB);</span><br><span class="line"></span><br><span class="line"><span class="comment">// before subscribe、after subscribe、get 1、get 2、done</span></span><br><span class="line"><span class="keyword">const</span> stream = <span class="title class_">Observable</span>.<span class="title function_">create</span>(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">    observer.<span class="title function_">next</span>(<span class="number">1</span>);</span><br><span class="line">    observer.<span class="title function_">next</span>(<span class="number">2</span>);</span><br><span class="line">    observer.<span class="title function_">complete</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">observeOn</span>(<span class="title class_">Scheduler</span>.<span class="property">async</span>);   <span class="comment">// 改变执行时机</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;before subscribe&#x27;</span>);</span><br><span class="line"><span class="comment">// observer 是多个函数的集合，订阅时传入的一个函数指 next</span></span><br><span class="line">stream.<span class="title function_">subscribe</span>(observer);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;after subscribe&#x27;</span>);</span><br></pre></td></tr></table></figure>



















]]></content>
      <categories>
        <category>JS 框架</category>
      </categories>
      <tags>
        <tag>JS 框架</tag>
      </tags>
  </entry>
  <entry>
    <title>Angular 项目开发</title>
    <url>/2020/09/09/14-1-angular%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="一、项目构建"><a href="#一、项目构建" class="headerlink" title="一、项目构建"></a>一、项目构建</h1><ul>
<li><strong>独立开发者</strong>：利用 cli 可以简单的创建 Angular 应用程序、组件和其他模块，Standalone 无需很多模板也可以轻松创建组件。</li>
<li><strong>初创公司</strong>：利用 Angular Language Service 插件，开发人员可以生成一致的代码，通过类型检测和其他工具，开发人员可以在部署前发现错误。</li>
<li><strong>中型公司</strong>：Angular 目前已经支持国际化和渐进式 Web 应用程序(PWA)。</li>
<li><strong>大型公司</strong>：微前端。</li>
</ul>
<h2 id="项目新建"><a href="#项目新建" class="headerlink" title="项目新建"></a>项目新建</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装：当前 angular@14</span></span><br><span class="line">cnpm i -g @angular/cli</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳过依赖安装、覆盖现有文件、更严格的 typescript 编译选项</span></span><br><span class="line">ng <span class="keyword">new</span> my-app --skip-install、--force、--strict</span><br><span class="line">ng test、ng e2e            <span class="comment">// 单元测试、端对端测试</span></span><br><span class="line">ng serve、ng build         <span class="comment">// 运行、打包</span></span><br><span class="line">ng serve -o/--open         <span class="comment">// 打开浏览器</span></span><br><span class="line">ng serve --prod            <span class="comment">// 开发环境运行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建类、接口、组件、指令、服务、模块、管道、枚举</span></span><br><span class="line">ng g <span class="keyword">class</span> <span class="title class_">model</span>/name</span><br><span class="line">ng g interface model/hero</span><br><span class="line">ng g component components/name</span><br><span class="line">ng g directive directives/name</span><br><span class="line">ng g service services/name</span><br><span class="line">ng g <span class="variable language_">module</span> name</span><br><span class="line">ng g pipe name</span><br><span class="line">ng g enum name</span><br></pre></td></tr></table></figure>


<h2 id="目录解析"><a href="#目录解析" class="headerlink" title="目录解析"></a>目录解析</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 运行时文件加载顺序</span></span><br><span class="line">main.<span class="property">ts</span>、app.<span class="property">module</span>.<span class="property">ts</span>、app.<span class="property">component</span>.<span class="property">ts</span>、index.<span class="property">html</span>、app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 项目目录 </span></span><br><span class="line">├── e2e            <span class="comment">// 端对端测试文件</span></span><br><span class="line">├── config.<span class="property">xml</span>     <span class="comment">// 打包成 app 的配置文件</span></span><br><span class="line">├── package.<span class="property">json</span>   <span class="comment">// 配置项目的元数据和管理项目所需要的依赖</span></span><br><span class="line">├── angular.<span class="property">json</span>   <span class="comment">// angular 配置文件</span></span><br><span class="line">├── karma.<span class="property">conf</span>.<span class="property">js</span>  <span class="comment">// 测试相关的配置文件</span></span><br><span class="line">├── tsconfig.<span class="property">json</span>  <span class="comment">// 指定编译 typescript 项目的根文件和编译选项</span></span><br><span class="line">├── tslint.<span class="property">json</span>    <span class="comment">// 格式化和校验 typescript</span></span><br><span class="line">└── src：          <span class="comment">// 工作空间源代码</span></span><br><span class="line">    ├── app           <span class="comment">// 应用根目录（组件、路由、静态资源等）</span></span><br><span class="line">    ├── environments  <span class="comment">// 环境配置</span></span><br><span class="line">    ├── favicon.<span class="property">ico</span>   <span class="comment">// 网站图标</span></span><br><span class="line">    ├── index.<span class="property">html</span>    <span class="comment">// 应用的主页面</span></span><br><span class="line">    ├── styles.<span class="property">scss</span>   <span class="comment">// 全局样式文件</span></span><br><span class="line">    ├── main.<span class="property">ts</span>       <span class="comment">// 主入口文件</span></span><br><span class="line">    ├── test.<span class="property">js</span>       <span class="comment">// 测试入口文件</span></span><br><span class="line">    └── polyfills.<span class="property">ts</span>  <span class="comment">// 兼容不同浏览器</span></span><br></pre></td></tr></table></figure>


<h2 id="模块引用"><a href="#模块引用" class="headerlink" title="模块引用"></a>模块引用</h2><blockquote>
<p>内置模块主要有：核心模块 @angular&#x2F;core、通用模块 @angular&#x2F;common、表单模块 @angular&#x2F;forms、网络模块 @angular&#x2F;http。简单项目时可以将所有组件都挂载到根模块，复杂项目时则需要通过自定义模块来组织代码和实现路由懒加载。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义模块：新建模块、组件、服务</span></span><br><span class="line">ng g m <span class="variable language_">module</span>/user --routing          <span class="comment">// m == module</span></span><br><span class="line">ng g s <span class="variable language_">module</span>/user/services/common    <span class="comment">// s == service</span></span><br><span class="line">ng g c <span class="variable language_">module</span>/user                    <span class="comment">// c == component、根组件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义子组件</span></span><br><span class="line">ng g c <span class="variable language_">module</span>/user/components/order</span><br><span class="line">ng g c <span class="variable language_">module</span>/user/components/address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 路由懒加载模块</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> forRoot、forChild：分别用于根模块、子模块加载路由的 RouterModule 对象方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> component、loadChildren：分别用于加载模块、组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> loadChildren：导入模块的相对路径、\#分隔符、导出模块类的名称</span></span><br><span class="line"><span class="comment"> **/</span> </span><br><span class="line"><span class="comment">// user-routing.module.ts</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">    <span class="comment">// &lt;a [routerLink]=&quot;[&#x27;/user&#x27;]&quot;&gt;用户模块&lt;/a&gt;</span></span><br><span class="line">    &#123; </span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, </span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">UserComponent</span>, </span><br><span class="line">      <span class="attr">children</span>: [&#123; <span class="attr">path</span>: <span class="string">&#x27;order&#x27;</span>, <span class="attr">component</span>: <span class="title class_">OrderComponent</span> &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// &lt;a [routerLink]=&quot;[&#x27;/user/address&#x27;]&quot;&gt;用户地址&lt;/a&gt;</span></span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;address&#x27;</span>, <span class="attr">component</span>: <span class="title class_">AddressComponent</span> &#125;</span><br><span class="line">]</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">imports</span>: [<span class="title class_">RouterModule</span>.<span class="title function_">forChild</span>(routes)],</span><br><span class="line">    <span class="attr">exports</span>: [<span class="title class_">RouterModule</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UserRoutingModule</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// user.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UserComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./user.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">OrderComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./components/order/order.component&#x27;</span>;</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">declarations</span>: [<span class="title class_">UserComponent</span>, <span class="title class_">OrderComponent</span>, <span class="title class_">AddressComponent</span>],</span><br><span class="line">    <span class="attr">imports</span>: [<span class="title class_">UserRoutingModule</span>],</span><br><span class="line">    <span class="attr">exports</span>: [<span class="title class_">UserComponent</span>]       <span class="comment">// 暴露组件</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UserModule</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app-routing.module.ts</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;home&#x27;</span>, <span class="attr">component</span>: <span class="title class_">HomeComponent</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">redirectTo</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">pathMatch</span>: <span class="string">&#x27;full&#x27;</span> &#125;,</span><br><span class="line">    <span class="comment">// 懒加载模式一：导入模块的相对路径、#分隔符、导出模块类的名称</span></span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">loadChildren</span>: <span class="string">&#x27;./module/user/user.module#UserModule&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;./module/user/user.module&#x27;</span>)</span><br><span class="line">                                        .<span class="title function_">then</span>( <span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">UserModule</span>) &#125;,</span><br><span class="line">];</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">imports</span>: [<span class="title class_">RouterModule</span>.<span class="title function_">forRoot</span>(routes)],</span><br><span class="line">    <span class="attr">exports</span>: [<span class="title class_">RouterModule</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppRoutingModule</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.module.ts：告诉 Angular 如何编译和启动应用的根模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UserModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../module/user/user.module&#x27;</span>     <span class="comment">// 自定义模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CommonService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./services/common.service&#x27;</span>   <span class="comment">// 自定义服务</span></span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;           <span class="comment">// 模块装饰器：接受一个元数据对象，将相关代码组织为功能单元</span></span><br><span class="line">    <span class="attr">declarations</span>: [<span class="title class_">AppComponent</span>],  <span class="comment">// 声明定义的组件、指令、管道 (静态的元数据)</span></span><br><span class="line">    <span class="attr">imports</span>: [<span class="title class_">AppRoutingModule</span>, <span class="title class_">UserModule</span>],  <span class="comment">// 导入/挂载模块：&lt;app-user&gt;  </span></span><br><span class="line">    <span class="attr">exports</span>: [<span class="title class_">FocusDirective</span>],     <span class="comment">// 导出/暴露模块</span></span><br><span class="line">    <span class="attr">providers</span>: [<span class="title class_">CommonService</span>],    <span class="comment">// 声明模块定义的公共服务 (运行时的元数据)  </span></span><br><span class="line">    <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>],     <span class="comment">// 指定应用的主视图</span></span><br><span class="line">    <span class="attr">entryComponents</span>: [<span class="title class_">Users</span>],      <span class="comment">// 入口文件，引导动态加载组件</span></span><br><span class="line">    <span class="attr">schemas</span>: []                    <span class="comment">// 声明非 Angular 组件、指令的元素或属性</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>



<h1 id="二、组件开发"><a href="#二、组件开发" class="headerlink" title="二、组件开发"></a>二、组件开发</h1><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><blockquote>
<p>angular 应用是通过一个个组件所构成的组件树，每个组件都包含了一组独立功能并且可以重复使用，通过 angular-cli 命令行创建的组件会被放到目录 src&#x2F;app&#x2F; 并自动注册到应用的根模块 app.module.ts。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 新建一个 hero 组件</span></span><br><span class="line">ng g component hero</span><br><span class="line"></span><br><span class="line"><span class="comment">// components 目录下新建 hero 组件</span></span><br><span class="line">ng g component components/hero</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件包含的四个部分</span></span><br><span class="line">hero.<span class="property">component</span>.<span class="property">ts</span>：组件类，用来处理数据和功能，为视图呈现提供支持</span><br><span class="line">hero.<span class="property">component</span>.<span class="property">html</span>：组件对应的页面 <span class="variable constant_">HTML</span> 模板，用来呈现组件的功能</span><br><span class="line">hero.<span class="property">component</span>.<span class="property">scss</span>：只针对当前组件的样式</span><br><span class="line">hero.<span class="property">component</span>.<span class="property">spec</span>.<span class="property">ts</span>：当前组件的单元测试文件（非必须）</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件装饰器：定义组件在运行期间该如何处理、实例化和使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HeroService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../hero.service&#x27;</span>;</span><br><span class="line">@<span class="title class_">Component</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;app-hero&#x27;</span>,  <span class="comment">// 自定义标签：标签位置会创建并插入组件实例</span></span><br><span class="line">    <span class="attr">templateUrl</span>: <span class="string">&#x27;./hero.component.html&#x27;</span>,</span><br><span class="line">    <span class="attr">styleUrls</span>: [<span class="string">&#x27;./hero.component.less&#x27;</span>],</span><br><span class="line">    <span class="attr">providers</span>: [<span class="title class_">HeroService</span>],  <span class="comment">// 声明服务</span></span><br><span class="line">    <span class="attr">template</span>:</span><br><span class="line">    <span class="string">`&lt;ul&gt;</span></span><br><span class="line"><span class="string">        &lt;li *ngFor=&quot;let hero of heroes&quot; (click)=&quot;onSelect(hero)&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;`</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HeroComponent</span> implements <span class="title class_">OnInit</span> &#123;</span><br><span class="line">    <span class="attr">heroes</span>: <span class="title class_">Hero</span>[];</span><br><span class="line">    <span class="attr">onSelect</span>: <span class="title class_">Hero</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span> (private <span class="attr">service</span>: <span class="title class_">HeroService</span>) &#123;  <span class="comment">// 注入服务</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hero</span> = <span class="string">&#x27;Tony&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngOnInit () &#123;     <span class="comment">// 初始化组件时调用一次的钩子</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">heroes</span> = <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">getHeroes</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onSelect (<span class="attr">hero</span>: <span class="title class_">Hero</span>) &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hero</span> = hero; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2>  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">插值表达式</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>显示变量值：&#123;&#123;name.toUpperCase()&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ngNonBindable</span>&gt;</span>显示花括号：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">属性绑定：赋值为常量时需加引号</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> [<span class="attr">title</span>]=<span class="string">&quot;name&quot;</span>&gt;</span>推荐方式<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">bind-href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>bind 方式<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">指令绑定</span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let hero of heroes; let i=index; trackBy: trackByIndex&quot;</span></span></span><br><span class="line"><span class="tag">    *<span class="attr">ngIf</span>=<span class="string">&quot;hero.name&quot;</span> </span></span><br><span class="line"><span class="tag">    [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;active: hero.isSelected&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    [<span class="attr">ngStyle</span>]=<span class="string">&quot;&#123;color: hero.color&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> [<span class="attr">style.width</span>]=<span class="string">&quot;&#x27;100px&#x27;&quot;</span> [<span class="attr">class</span>]=<span class="string">&quot;&#x27;a b&#x27;&quot;</span>&gt;</span>属性绑定 []<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>属性型指令：NgClass、NgStyle 设置多个动态的类名和样式<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>trackByIndex(i: number, item: any): string &#123; return item.id &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">事件绑定 ()</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> (<span class="attr">click</span>)=<span class="string">&quot;onClick()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">on-click</span>=<span class="string">&quot;onClick()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">双向绑定：FormModule 引入后才能使用 ngModel</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">bindon-ngModel</span>=<span class="string">&quot;hero.name&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;hero.name&quot;</span> (<span class="attr">ngModelChange</span>)=<span class="string">&quot;onChange()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> [<span class="attr">value</span>]=<span class="string">&quot;hero.name&quot;</span> (<span class="attr">input</span>)=<span class="string">&quot;hero.name=$event.target.value&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">模板引用变量：可用来直接访问元素</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> #<span class="attr">refMsgInput</span> (<span class="attr">keyup</span>)=<span class="string">&quot;getRefMsg(refMsgInput.value)&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">内嵌视图</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> [<span class="attr">ngTemplateOutlet</span>]=<span class="string">&quot;a&quot;</span> <span class="attr">ngOutletContext</span>=<span class="string">&quot;b&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 精确匹配 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngSwitch</span>]=<span class="string">&quot;hero&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;A&#x27;&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;B&#x27;&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchDefault</span>&gt;</span>C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 范围匹配 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngPlural</span>]=<span class="string">&quot;value&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">ngPluralCase</span>=<span class="string">&quot;=0&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">ngPluralCase</span>=<span class="string">&quot;=1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">ngPluralCase</span>=<span class="string">&quot;other&quot;</span>&gt;</span>其他<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 内置指令</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 属性型指令：NgClass、NgStyle、NgModel</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 结构型指令：NgIf、NgFor、NgSwitch</span></span><br><span class="line"><span class="comment"> **/</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 自定义指令</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 新建指令：ng g directive directives/highlight</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 模块声明：<span class="doctag">@NgModule</span>(&#123; declarations: [HighlightDirective] &#125;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 组件使用：&lt;span [appHighlight]=&quot;green&quot;&gt;点亮&lt;/span&gt;</span></span><br><span class="line"><span class="comment"> **/</span> </span><br><span class="line">@<span class="title class_">Directive</span>(&#123; <span class="attr">selector</span>: <span class="string">&#x27;[appHighlight]&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HighlightDirective</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private el: ElementRef</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Input</span>() <span class="attr">appHighlight</span>: string;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">HostListener</span>(<span class="string">&#x27;mouseenter&#x27;</span>) <span class="title function_">onMouseEnter</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">highlight</span>(<span class="variable language_">this</span>.<span class="property">appHighlight</span> || <span class="string">&#x27;red&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">HostListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>) <span class="title function_">onMouseLeave</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">highlight</span>(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">highlight</span>(<span class="params">color: string</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">el</span>.<span class="property">nativeElement</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = color;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 内置管道：date、json、uppercase、lowercase、currency、percent、slice</span></span><br><span class="line">&lt;span&gt;&#123;&#123;today | <span class="attr">date</span>:<span class="string">&#x27;yyyy-MM-dd&#x27;</span>/<span class="string">&#x27;fullDate&#x27;</span>/<span class="string">&#x27;shortTime&#x27;</span>&#125;&#125;&lt;/span&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;&#x27;abcdefg&#x27; | slice:0:3 | uppercase&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 自定义管道</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 新建管道：ng g pipe pipes/strLength</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 模块声明：<span class="doctag">@NgModule</span>(&#123; declarations: [StrLengthPipe] &#125;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 组件使用：&lt;span&gt;&#123;&#123;title | strLength&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">@<span class="title class_">Pipe</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;strLength&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">StrLengthPipe</span> implements <span class="title class_">PipeTransform</span> &#123;</span><br><span class="line">    <span class="title function_">transform</span>(<span class="attr">value</span>: string, args?: any): any &#123;</span><br><span class="line">        <span class="keyword">return</span> value.<span class="property">length</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h2><blockquote>
<p>封装了日志服务等公共方法的独立模块，通过依赖注入提供给专注业务的组件。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 自定义服务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 新建服务：ng g service services/hero</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 组件使用：import 导入、providers 注册、constructor 依赖注入</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="comment">// hero.service.ts：创建可注入服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span></span><br><span class="line">@<span class="title class_">Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HeroService</span> &#123;</span><br><span class="line">    <span class="comment">// 依赖注入：声明一个私有属性并标记为注入点 (组件创建时赋值 Logger 单例对象)</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        private logger: Logger,</span></span><br><span class="line"><span class="params">        private http: HttpClient</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getHeroes</span>(): <span class="title class_">Hero</span>[] &#123;</span><br><span class="line">        <span class="keyword">let</span> heroes = []</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">&#x27;/hexo&#x27;</span>)</span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="function">(<span class="params">heroes: Hero[]</span>) =&gt;</span> &#123;</span><br><span class="line">            heroes.<span class="title function_">push</span>(...heroes);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">logger</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;heroes.length&#125;</span> heroes`</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> heroes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hero.component.ts：组件使用</span></span><br><span class="line">@<span class="title class_">Component</span>(&#123;  </span><br><span class="line">    <span class="attr">selector</span>:  <span class="string">&#x27;hero&#x27;</span>,</span><br><span class="line">    <span class="attr">templateUrl</span>: <span class="string">&#x27;./hero.component.html&#x27;</span>,</span><br><span class="line">    <span class="attr">providers</span>: [<span class="title class_">HeroService</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HomeComponent</span> implements <span class="title class_">OnInit</span> &#123;</span><br><span class="line">    private <span class="attr">heroes</span>: <span class="title class_">Hero</span>[] = [];</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private heroService: HeroService</span>) &#123; &#125;</span><br><span class="line">    <span class="title function_">getHeroes</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">heroes</span> = <span class="variable language_">this</span>.<span class="property">heroService</span>.<span class="title function_">getHeroes</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册服务的三种方式</span></span><br><span class="line">@<span class="title class_">Injectable</span>()   <span class="comment">// 声明为可注入的服务但未注册</span></span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;     <span class="comment">// 模块中注册：当前模块下所有组件可使用</span></span><br><span class="line">    <span class="attr">providers</span>: [<span class="title class_">HeroService</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Injectable</span>()</span><br><span class="line">@<span class="title class_">Component</span>(&#123;    <span class="comment">// 组件中注册：当前组件的每一个实例可使用</span></span><br><span class="line">    <span class="attr">providers</span>: [<span class="title class_">HeroService</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Injectable</span>(&#123;   <span class="comment">// 声明服务并在根注入器中注册，可以全局使用</span></span><br><span class="line">    <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span>  </span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>


<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><blockquote>
<p>组件加载过程中会按照以下顺序依次执行，页面加载过程中涉及数据绑定和更新时会再次触发 ngDoCheck、ngAfterContentChecked、ngAfterViewChecked。</p>
</blockquote>
<ul>
<li><strong>constructor</strong>：构造函数而并非生命周期钩子，一般用于注入服务。</li>
<li><strong>ngOnChanges</strong>：绑定数据变化时调用，注意无法监听对象内部数据的变化。</li>
<li><strong>ngOnInit</strong>：组件初始化，在首次 ngOnChanges 之后调用。</li>
<li><strong>ngDoCheck</strong>：可以检测一切数据的变化，可用来自定义检测逻辑。</li>
<li><strong>ngAfterContentInit</strong>：组件内容初始化之后。</li>
<li><strong>ngAfterContentChecked</strong>：组件内容变更之后。</li>
<li><strong>ngAfterViewInit</strong>：视图初始化之后。</li>
<li><strong>ngAfterViewChecked</strong>：视图每次发生变化时。</li>
<li><strong>ngOnDestroy</strong>：组件注销时调用一次。</li>
</ul>
<h2 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ============================= 父子通信 ===============================</span></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line">@<span class="title class_">Component</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;app-parent&#x27;</span>,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;button (click)=&quot;printData()&quot;&gt;调用子组件的方法&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;app-child #child [name]=&quot;name&quot; (childEmit)=&quot;onClick($event)&quot;&gt;&lt;/app-child&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ParentComponent</span> &#123;</span><br><span class="line">    <span class="comment">// 1、父组件发送数据</span></span><br><span class="line">    public <span class="attr">name</span>:string = <span class="string">&#x27;儿子&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、父组件接收数据</span></span><br><span class="line">    public <span class="title function_">onClick</span>(<span class="attr">bool</span>:<span class="title class_">Boolean</span>):<span class="keyword">void</span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3、父组件获取子组件的实例：static 是否在运行更改检测前处理查询结果</span></span><br><span class="line">    @<span class="title class_">ViewChild</span>(<span class="string">&#x27;child&#x27;</span>, &#123; <span class="attr">static</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    public child!: <span class="title class_">ElementRef</span>&lt;<span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">printData</span>():<span class="keyword">void</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">child</span>)  &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">child</span>.<span class="title function_">print</span>(<span class="string">&#x27;hello2&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">Input</span>, <span class="title class_">Output</span>, <span class="title class_">EventEmitter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line">@<span class="title class_">Component</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;app-child&#x27;</span>,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`&lt;h3 (click)=&quot;myClick()&quot;&gt;&#123;&#123;name&#125;&#125;&lt;/h3&gt;`</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HeroChildComponent</span> &#123;</span><br><span class="line">    <span class="comment">// 1、子组件接收数据</span></span><br><span class="line">    @<span class="title class_">Input</span>() </span><br><span class="line">    public <span class="attr">name</span>: string;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、子组件发送数据</span></span><br><span class="line">    @<span class="title class_">Output</span>()</span><br><span class="line">    public readonly <span class="attr">childEmit</span>: <span class="title class_">EventEmitter</span>&lt;boolean&gt; = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">myClick</span>():<span class="keyword">void</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">childEmit</span>.<span class="title function_">emit</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">print</span>(<span class="attr">content</span>:string):<span class="keyword">void</span>&#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ========================= 全局通信 ============================</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> dataService.ts</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> BehaviorSubject：用来创建一个共享服务，实现发布订阅模式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> rxjs：使用 Observables 的响应式编程的库，方便编写异步或回调代码</span></span><br><span class="line"><span class="comment"> **/</span> </span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BehaviorSubject</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/BehaviorSubject&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    private message = <span class="keyword">new</span> <span class="title class_">BehaviorSubject</span>&lt;string&gt;(<span class="string">&#x27;start&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">getMessage</span>(): <span class="title class_">Observable</span>&lt;string&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">message</span>.<span class="title function_">asObservable</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">setMessage</span>(<span class="attr">msg</span>: string): <span class="keyword">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">message</span>.<span class="title function_">next</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// a.component.ts：发布</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">messageService</span>.<span class="title function_">setMessage</span>(<span class="string">&#x27;update&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.component.ts：订阅、取消订阅</span></span><br><span class="line"><span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messageService</span>.<span class="title function_">getMessage</span>().<span class="title function_">subscribe</span>(<span class="function"><span class="params">m</span> =&gt;</span> &#123; &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">ngOnDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRecoverSub</span>.<span class="title function_">unsubscribe</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、表单控件"><a href="#三、表单控件" class="headerlink" title="三、表单控件"></a>三、表单控件</h1><blockquote>
<p>模板驱动表单通过表单指令将数据和相关验证绑定到组件模板并通过修改 ngModel 绑定的数据模型来完成数据更新，响应式表单则是在表单数据发生变更时通过 FormControl 实例返回一个新的数据模型而不是直接修改原模型。</p>
</blockquote>
<h2 id="模板驱动表单"><a href="#模板驱动表单" class="headerlink" title="模板驱动表单"></a>模板驱动表单</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.module.js：引入 ngModel 依赖的 FormsModule</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FormsModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">imports</span>: [<span class="title class_">FormsModule</span>],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// css 样式：输入内容不满足条件时进行提示</span></span><br><span class="line">.<span class="property">ng</span>-valid[required], .<span class="property">ng</span>-valid.<span class="property">required</span>  &#123;</span><br><span class="line">    border-<span class="attr">left</span>: 5px solid #42A948;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">ng</span>-<span class="attr">invalid</span>:<span class="title function_">not</span>(<span class="params">form</span>)  &#123;</span><br><span class="line">    border-<span class="attr">left</span>: 5px solid #a94442;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常用的控件状态</span></span><br><span class="line">valid、invalid：校验成功/失败</span><br><span class="line">pristine、dirty：数据未/已被修改</span><br><span class="line">enabled、disabled：启用/禁用状态</span><br><span class="line">touched、untouched：未/已被触摸或点击过</span><br></pre></td></tr></table></figure>

  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> (<span class="attr">ngSubmit</span>)=<span class="string">&quot;submit()&quot;</span> #<span class="attr">heroForm</span>=<span class="string">&quot;ngForm&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>姓名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 将 ngModel 指令通过模板引用变量的形式暴露出来，从而获取控件状态 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;hero.name&quot;</span> </span></span><br><span class="line"><span class="tag">               <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">required</span> <span class="attr">minlength</span>=<span class="string">&quot;4&quot;</span> #<span class="attr">name</span>=<span class="string">&quot;ngModel&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;name.invalid &amp;&amp; (name.dirty || name.touched)&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;name.errors.required&quot;</span>&gt;</span>姓名不能为空<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;name.errors.minlength&quot;</span>&gt;</span>姓名信息至少 4 个字符长度<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;age&quot;</span>&gt;</span>年龄：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;hero.age&quot;</span> </span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;gender&quot;</span>&gt;</span>性别：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let gender of genderList&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-check&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&#123;&#123;gender.id&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;gender.value&#125;&#125;&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;hero.gender&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&#123;&#123;gender.id&#125;&#125;&quot;</span>&gt;</span>&#123;&#123;gender.text&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;address&quot;</span>&gt;</span>住址：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;address&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;hero.address&quot;</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;address&#125;&#125;&quot;</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let address of addressList&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span>&#123;&#123;address&#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> [<span class="attr">disabled</span>]=<span class="string">&quot;!heroForm.form.valid&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>表单数据：&#123;&#123;hero | json&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="响应式表单"><a href="#响应式表单" class="headerlink" title="响应式表单"></a>响应式表单</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.module.js：引入 FormControl 依赖的 ReactiveFormsModule</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ReactiveFormsModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">imports</span>: [<span class="title class_">ReactiveFormsModule</span>],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表单：&lt;input type=&quot;text&quot; id=&quot;name&quot; [formControl]=&#x27;name&#x27; autocomplete=&quot;off&quot;&gt;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FormControl</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ReactiveFormsComponent</span> implements <span class="title class_">OnInit</span> &#123;</span><br><span class="line">    <span class="comment">// 定义属性来承接 FormControl 实例</span></span><br><span class="line">    public name = <span class="keyword">new</span> <span class="title class_">FormControl</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">    <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span>.<span class="title function_">setValue</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复杂表单</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Validators</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FormBuilder</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FormControl</span>, <span class="title class_">FormGroup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ReactiveFormsComponent</span> implements <span class="title class_">OnInit</span> &#123;</span><br><span class="line">    <span class="comment">// 定义对象属性来承接 FormGroup 实例</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">    public profileForm = <span class="keyword">new</span> <span class="title class_">FormGroup</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="keyword">new</span> <span class="title class_">FormControl</span>(<span class="string">&#x27;李先生&#x27;</span>),</span><br><span class="line">        <span class="attr">age</span>: <span class="keyword">new</span> <span class="title class_">FormControl</span>(<span class="number">12</span>),</span><br><span class="line">        <span class="attr">address</span>: <span class="keyword">new</span> <span class="title class_">FormGroup</span>(&#123;</span><br><span class="line">            <span class="attr">province</span>: <span class="keyword">new</span> <span class="title class_">FormControl</span>(<span class="string">&#x27;河南省&#x27;</span>),</span><br><span class="line">            <span class="attr">city</span>: <span class="keyword">new</span> <span class="title class_">FormControl</span>(<span class="string">&#x27;郑州市&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 表单控件过多时 FormGroup 很麻烦，此时可使用 FormBuilder 表单构造器 </span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private formBuilder: FormBuilder</span>) &#123; &#125;</span><br><span class="line">    public profileForm = <span class="variable language_">this</span>.<span class="property">formBuilder</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: [<span class="string">&#x27;&#x27;</span>, [</span><br><span class="line">            <span class="title class_">Validators</span>.<span class="property">required</span>,</span><br><span class="line">            <span class="title class_">Validators</span>.<span class="title function_">minLength</span>(<span class="number">4</span>)</span><br><span class="line">        ]],</span><br><span class="line">        <span class="attr">age</span>: [<span class="number">12</span>],</span><br><span class="line">        <span class="attr">address</span>: <span class="variable language_">this</span>.<span class="property">formBuilder</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line">            <span class="attr">province</span>: [<span class="string">&#x27;河南省&#x27;</span>],</span><br><span class="line">            <span class="attr">city</span>: [<span class="string">&#x27;郑州市&#x27;</span>],</span><br><span class="line">            <span class="attr">district</span>: [<span class="string">&#x27;金水区&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 验证控件添加 getter 方法用来在模板中获取状态信息</span></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">profileForm</span>.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">updateProfile</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 更新某个控件的数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">profileForm</span>.<span class="title function_">patchValue</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;123&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">submit</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">profileForm</span>.<span class="property">value</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> [<span class="attr">formGroup</span>]=<span class="string">&#x27;profileForm&#x27;</span> (<span class="attr">ngSubmit</span>)=<span class="string">&#x27;submit()&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>姓名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">formControlName</span>=<span class="string">&#x27;name&#x27;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">required</span> <span class="attr">minlength</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;name.invalid &amp;&amp; (name.dirty || name.touched)&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;name.errors.required&quot;</span>&gt;</span>姓名不能为空<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;name.errors.minlength&quot;</span>&gt;</span>姓名信息至少 4 个字符长度<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;age&quot;</span>&gt;</span>年龄：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span> <span class="attr">formControlName</span>=<span class="string">&#x27;age&#x27;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">required</span> <span class="attr">step</span>=<span class="string">&quot;1&quot;</span> <span class="attr">max</span>=<span class="string">&quot;100&quot;</span> <span class="attr">min</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">formGroupName</span>=<span class="string">&#x27;address&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;province&quot;</span>&gt;</span>省：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;province&quot;</span> <span class="attr">formControlName</span>=<span class="string">&#x27;province&#x27;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;city&quot;</span>&gt;</span>市：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;city&quot;</span> <span class="attr">formControlName</span>=<span class="string">&#x27;city&#x27;</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;updateProfile()&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> [<span class="attr">disabled</span>]=<span class="string">&quot;!profileForm.valid&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>FormGroup 表单组控件的值： &#123;&#123;profileForm.value | json&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="自定义验证"><a href="#自定义验证" class="headerlink" title="自定义验证"></a>自定义验证</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 响应式表单自定义验证器：&lt;div *ngIf=&quot;name.errors.nameinvalid&quot;&gt;姓名无效&lt;/div&gt;</span></span><br><span class="line">public profileForm = <span class="variable language_">this</span>.<span class="property">formBuilder</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: [<span class="string">&#x27;&#x27;</span>, [</span><br><span class="line">        <span class="title class_">Validators</span>.<span class="property">required</span>,</span><br><span class="line">        <span class="title class_">Validators</span>.<span class="title function_">minLength</span>(<span class="number">4</span>),</span><br><span class="line">        validatorName</span><br><span class="line">    ]]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validatorName</span>(<span class="params">name: FormControl</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> name.<span class="property">value</span> === <span class="string">&#x27;lala&#x27;</span> ? &#123; <span class="attr">nameinvalid</span>: <span class="literal">true</span> &#125; : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模板驱动表单添加一个自定义指令实现校验：&lt;input type=&quot;text&quot; appHeroValidate&gt;</span></span><br><span class="line">ng g directive direactives/hero-validate</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Directive</span>, <span class="title class_">Input</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AbstractControl</span>, <span class="title class_">Validator</span>, <span class="title class_">ValidationErrors</span>, <span class="variable constant_">NG_VALIDATORS</span> &#125; </span><br><span class="line"><span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Directive</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;[appHeroValidate]&#x27;</span>,</span><br><span class="line">    <span class="attr">providers</span>: [&#123; </span><br><span class="line">        <span class="attr">provide</span>: <span class="variable constant_">NG_VALIDATORS</span>, </span><br><span class="line">        <span class="attr">useExisting</span>: <span class="title class_">HeroValidateDirective</span>, </span><br><span class="line">        <span class="attr">multi</span>: <span class="literal">true</span>  <span class="comment">// 将该验证器添加到现存的验证器集合</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HeroValidateDirective</span> implements <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">    <span class="comment">// 对指定的控件执行同步验证方法</span></span><br><span class="line">    <span class="title function_">validate</span>(<span class="attr">control</span>: <span class="title class_">AbstractControl</span>): <span class="title class_">ValidationErrors</span> | <span class="literal">null</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> control.<span class="property">value</span> === <span class="string">&#x27;lala&#x27;</span> ? &#123; <span class="string">&#x27;nameInvalid&#x27;</span>: <span class="literal">true</span> &#125; : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="跨字段验证"><a href="#跨字段验证" class="headerlink" title="跨字段验证"></a>跨字段验证</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 响应式表单：&lt;div *ngIf=&quot;profileForm.errors?.formInvalid&gt;l 不是 12 岁&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">    <span class="title class_">Validators</span>,</span><br><span class="line">    <span class="title class_">FormBuilder</span>,</span><br><span class="line">    <span class="title class_">FormControl</span>, </span><br><span class="line">    <span class="title class_">FormGroup</span>, </span><br><span class="line">    <span class="title class_">ValidatorFn</span>, </span><br><span class="line">    <span class="title class_">ValidationErrors</span> </span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">formCrossValidator</span>: <span class="title class_">ValidatorFn</span> = (<span class="attr">controlGroup</span>: <span class="title class_">FormGroup</span>): </span><br><span class="line"><span class="title class_">ValidationErrors</span> | <span class="function"><span class="params">null</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取子控件的信息</span></span><br><span class="line">    <span class="keyword">const</span> name = controlGroup.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> age = controlGroup.<span class="title function_">get</span>(<span class="string">&#x27;age&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> flag = name &amp;&amp; age &amp;&amp; name.<span class="property">value</span> === <span class="string">&#x27;l&#x27;</span> &amp;&amp; age.<span class="property">value</span> === <span class="number">12</span>;</span><br><span class="line">    <span class="keyword">return</span> flag ? &#123; <span class="string">&#x27;formInvalid&#x27;</span>: <span class="literal">true</span> &#125; : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ReactiveFormsComponent</span> implements <span class="title class_">OnInit</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private formBuilder: FormBuilder</span>) &#123; &#125;</span><br><span class="line">    public profileForm = <span class="variable language_">this</span>.<span class="property">formBuilder</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: [<span class="string">&#x27;&#x27;</span>, [</span><br><span class="line">          <span class="title class_">Validators</span>.<span class="property">required</span>,</span><br><span class="line">          <span class="title class_">Validators</span>.<span class="title function_">minLength</span>(<span class="number">4</span>)</span><br><span class="line">      ]],</span><br><span class="line">      <span class="attr">age</span>: [<span class="number">12</span>],</span><br><span class="line">      <span class="attr">address</span>: <span class="variable language_">this</span>.<span class="property">formBuilder</span>.<span class="title function_">group</span>(&#123; <span class="attr">province</span>: [<span class="string">&#x27;河南省&#x27;</span>], <span class="attr">city</span>: [<span class="string">&#x27;郑州市&#x27;</span>] &#125;)</span><br><span class="line">    &#125;, &#123; <span class="attr">validators</span>: [formCrossValidator] &#125;);     <span class="comment">// 添加针对控件组的验证器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模板驱动表单：自定义指令</span></span><br><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">    <span class="title class_">Validator</span>, </span><br><span class="line">    <span class="title class_">AbstractControl</span>, </span><br><span class="line">    <span class="title class_">ValidationErrors</span>, </span><br><span class="line">    <span class="title class_">ValidatorFn</span>, </span><br><span class="line">    <span class="title class_">FormGroup</span>, </span><br><span class="line">    <span class="variable constant_">NG_VALIDATORS</span> </span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">formCrossValidator</span>: <span class="title class_">ValidatorFn</span> = (<span class="attr">controlGroup</span>: <span class="title class_">FormGroup</span>): </span><br><span class="line"><span class="title class_">ValidationErrors</span> | <span class="function"><span class="params">null</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> name = controlGroup.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> age = controlGroup.<span class="title function_">get</span>(<span class="string">&#x27;age&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> flag = name &amp;&amp; age &amp;&amp; name.<span class="property">value</span> === <span class="string">&#x27;l&#x27;</span> &amp;&amp; age.<span class="property">value</span> === <span class="number">12</span>;</span><br><span class="line">    <span class="keyword">return</span> flag ? &#123; <span class="string">&#x27;formInvalid&#x27;</span>: <span class="literal">true</span> &#125; : <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line">@<span class="title class_">Directive</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;[appCrossFieldValidate]&#x27;</span>,</span><br><span class="line">    <span class="attr">providers</span>: [&#123; </span><br><span class="line">        <span class="attr">provide</span>: <span class="variable constant_">NG_VALIDATORS</span>, </span><br><span class="line">        <span class="attr">useExisting</span>: <span class="title class_">CrossFieldValidateDirective</span>, </span><br><span class="line">        <span class="attr">multi</span>: <span class="literal">true</span> </span><br><span class="line">    &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">CrossFieldValidateDirective</span> implements <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">    <span class="title function_">validate</span>(<span class="attr">control</span>: <span class="title class_">AbstractControl</span>): <span class="title class_">ValidationErrors</span> | <span class="literal">null</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">formCrossValidator</span>(control)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="四、HTTP-请求"><a href="#四、HTTP-请求" class="headerlink" title="四、HTTP 请求"></a>四、HTTP 请求</h1><h2 id="http-服务"><a href="#http-服务" class="headerlink" title="http 服务"></a>http 服务</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.module.ts：请求模块、解决跨域模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClientModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123; <span class="attr">imports</span>: [<span class="title class_">HttpClientModule</span>] &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/proxy.conf.json：解决本地开发跨域问题</span></span><br><span class="line"><span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;http://localhost:3000&quot;</span>,</span><br><span class="line">    <span class="string">&quot;secure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;pathRewrite&quot;</span>: &#123; <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;changeOrigin&quot;</span>: <span class="literal">true</span>    <span class="comment">// 后端服务器不在 localhost 时设置</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&quot;serve&quot;</span>: &#123;     <span class="comment">// angular.json 添加 proxyConfig 选项</span></span><br><span class="line">    <span class="string">&quot;builder&quot;</span>: <span class="string">&quot;@angular-devkit/build-angular:dev-server&quot;</span>,</span><br><span class="line">    <span class="string">&quot;options&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;browserTarget&quot;</span>: <span class="string">&quot;hero:build&quot;</span>,</span><br><span class="line">        <span class="string">&quot;proxyConfig&quot;</span>: <span class="string">&quot;src/proxy.conf.json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用环境配置：如果线上环境不需要路径 /api</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> environment = &#123;      <span class="comment">// environment.ts</span></span><br><span class="line">    <span class="attr">production</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">baseUrl</span>: <span class="string">&#x27;/api&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> environment = &#123;      <span class="comment">// environment.prod.ts</span></span><br><span class="line">    <span class="attr">production</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">baseUrl</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// hero.service.ts：封装请求服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; map, catchError &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; forkJoin &#125; <span class="keyword">from</span> <span class="string">&quot;rxjs/observable/forkJoin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span>, <span class="title class_">HttpHeaders</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">&#x27;../environments/environment&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HeroService</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private http: HttpClient</span>) &#123; &#125;</span><br><span class="line">    private <span class="attr">baseUrl</span>: string = environment.<span class="property">baseUrl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getHeroes</span>(params): <span class="title class_">Hero</span>[] &#123;</span><br><span class="line">        <span class="keyword">let</span> heroes = []</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">&#x27;/hexo&#x27;</span>, &#123;<span class="attr">params</span>: params&#125;)</span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="function">(<span class="params">heroes: Hero[]</span>) =&gt;</span> &#123;</span><br><span class="line">            heroes.<span class="title function_">push</span>(...heroes)</span><br><span class="line">        &#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> heroes</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> characterUrl = <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">&#x27;/api/people&#x27;</span>);</span><br><span class="line">        <span class="keyword">let</span> homeworldUrl = <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">&#x27;/api/planet&#x27;</span>);</span><br><span class="line">        <span class="comment">// 处理并发请求：forkJoin 相当于 Promise.all()</span></span><br><span class="line">        <span class="title function_">forkJoin</span>([characterUrl, homeworldUrl])</span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> character = results[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">let</span> homeworld = results[<span class="number">1</span>];</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// jsonp 解决跨域：第二个参数必须和后端对应上</span></span><br><span class="line">    getDataJsonp (url) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">jsonp</span>(url, <span class="string">&#x27;callback&#x27;</span>)</span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        &#125;)  </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    public get (<span class="attr">url</span>: string) &#123;</span><br><span class="line">        <span class="keyword">let</span> options = &#123;</span><br><span class="line">            <span class="attr">params</span>: params,</span><br><span class="line">            <span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">Headers</span>(&#123; <span class="string">&#x27;token&#x27;</span>: <span class="string">&#x27;abcdefgh&#x27;</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseUrl&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>, options)</span><br><span class="line">            .<span class="title function_">pipe</span>(<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="property">extractData</span>), <span class="title function_">catchError</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">post</span>(<span class="params">url: string, data?: any</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> options = &#123;</span><br><span class="line">            <span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">Headers</span>(&#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">post</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseUrl&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>, data, options)</span><br><span class="line">            .<span class="title function_">pipe</span>(<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="property">extractData</span>), <span class="title function_">catchError</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">postForm</span>(<span class="params">url: string, data: object</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">formData</span>: <span class="title class_">FormData</span> = <span class="keyword">new</span> <span class="title class_">FormData</span>()</span><br><span class="line">        formData.<span class="title function_">append</span>(<span class="string">&#x27;username&#x27;</span>, data.<span class="property">username</span>)</span><br><span class="line">        formData.<span class="title function_">append</span>(<span class="string">&#x27;password&#x27;</span>, data.<span class="property">password</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">post</span>(url, formData)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">extractData</span>(<span class="params">response: Response</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> res = response.<span class="title function_">json</span>()</span><br><span class="line">        <span class="keyword">return</span> res || &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">handleError</span>(<span class="params">error: Response | any</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">errMsg</span>: string;</span><br><span class="line">        <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="title class_">Response</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = error.<span class="title function_">json</span>() || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">const</span> err = data.<span class="property">toString</span> || <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data);</span><br><span class="line">            errMsg = <span class="string">`<span class="subst">$&#123;error.status&#125;</span> - <span class="subst">$&#123;error.statusText || <span class="string">&#x27;&#x27;</span>&#125;</span> <span class="subst">$&#123;err&#125;</span>`</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            errMsg = error.<span class="property">message</span> ? error.<span class="property">message</span> : error.<span class="title function_">toString</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Observable</span>.<span class="keyword">throw</span>(errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// hero.component.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HomeComponent</span> implements <span class="title class_">OnInit</span> &#123;</span><br><span class="line">    private <span class="attr">heroes</span>: <span class="title class_">Hero</span>[] = [];</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private heroService: HeroService</span>) &#123; &#125;</span><br><span class="line">    <span class="title function_">getHeroes</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">heroes</span> = <span class="variable language_">this</span>.<span class="property">heroService</span>.<span class="title function_">getHeroes</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="RxJS-编程"><a href="#RxJS-编程" class="headerlink" title="RxJS 编程"></a>RxJS 编程</h2><blockquote>
<p>基于微软 ReactiveX 响应式编程理念来实现异步编程的 JS 工具库，常用的异步编程范式有回调函数、事件监听、发布订阅、Promise、async&#x2F;await、RxJS。响应式编程是一种面向数据流和变更传播的异步编程范式，它将普通数据、http 请求、dom 事件等都包装成流并监听到更新后执行操作，流可看作是数据基于事件变化的整体(流 &#x3D; 数据 + 事件)，它是不可改变的但可以通过通过操作符转换或合并为一个新流并返回。核心概念主要如下：</p>
</blockquote>
<ul>
<li><strong>Observable</strong>：可观察对象，随时间产生的数据集合而可看作异步流，subscribe 启动流。</li>
<li><strong>Observer</strong>：观察者，回调函数的集合，监听 Observable 数据并执行相应操作。</li>
<li><strong>Subscription</strong>：订阅，存储已经启动过的流，unsubscribe 停止该流。</li>
<li><strong>Operators</strong>：操作符，函数式编程风格的纯函数，将异步代码以声明式的方式组合处理。</li>
<li><strong>Subject</strong>：主体，一种特殊类型的 Observable，用于通过多播模式将数据共享给多个观察者。不同于单播订阅者总是需要从头开始获取数据，多播模式能够保证数据的实时性。</li>
<li><strong>Schedulers</strong>：调度器，用来控制何时启动 subscription 和何时发送通知。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建流</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Rx</span> = <span class="built_in">require</span>(<span class="string">&#x27;rxjs/Rx&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> observable = <span class="title class_">Rx</span>.<span class="property">Observable</span>.<span class="title function_">of</span>(<span class="number">1</span>)/.<span class="title function_">from</span>([<span class="number">2</span>])/.<span class="title function_">interval</span>(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">const</span> stream = <span class="title class_">Rx</span>.<span class="property">Observable</span>.<span class="title function_">create</span>(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span></span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">                observer.<span class="title function_">complete</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">                observer.<span class="title function_">error</span>(<span class="string">&#x27;不会执行&#x27;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                observer.<span class="title function_">next</span>(i);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 启动流：订阅后才会执行 next()</span></span><br><span class="line"><span class="keyword">const</span> subscription = stream.<span class="title function_">subscribe</span>(<span class="function"><span class="params">val</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(val) )</span><br><span class="line"><span class="keyword">const</span> subscription = stream.<span class="title function_">subscribe</span>(&#123;</span><br><span class="line">    <span class="attr">next</span>: <span class="function"><span class="params">val</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(val),</span><br><span class="line">    <span class="attr">error</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err),</span><br><span class="line">    <span class="attr">complete</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finish&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 关闭流：取消订阅</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; subscription.<span class="title function_">unsubscribe</span>() &#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> subject：多播，以下为其三个变体</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> BehaviorSubject：有新订阅时会额外发出最新值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> BehaviorSubject：保存所有值，然后回放给新的订阅者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> AsyncSubject：只有 Observable 执行完成时才会发出最后的值</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="keyword">const</span> source = <span class="title class_">Rx</span>.<span class="property">Observable</span>.<span class="title function_">interval</span>(<span class="number">1000</span>).<span class="title function_">pipe</span>(<span class="title function_">take</span>(<span class="number">3</span>))</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> <span class="title class_">Rx</span>.<span class="property">Subject</span>&lt;number&gt;()</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> <span class="title class_">Rx</span>.<span class="title class_">BehaviorSubject</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> <span class="title class_">Rx</span>.<span class="title class_">ReplaySubject</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> <span class="title class_">Rx</span>.<span class="title class_">AsyncSubject</span>()</span><br><span class="line">subject.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">value: number</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;A：&#x27;</span> + value))</span><br><span class="line">subject.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">value: number</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;B：&#x27;</span> + value))</span><br><span class="line">subject.<span class="title function_">next</span>(<span class="number">1</span>)</span><br><span class="line">subject.<span class="title function_">next</span>(<span class="number">2</span>)</span><br><span class="line">source.<span class="title function_">subscribe</span>(subject)  <span class="comment">// 注释掉就不会执行</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span>  Schedulers 调度器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prames</span> null：不传递调度器，以同步方式发送通知，用于定时或尾递归操作。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prames</span> Rx.Scheduler.queue：当前事件帧中的队列调度，用于迭代操作。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prames</span> Rx.Scheduler.asap：微任务的队列调度，用于异步转换。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prames</span> Rx.Scheduler.async：setInterval 调度，用于基于时间的操作符。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 打印结果：before、after、1、done</span></span><br><span class="line"><span class="comment"> **/</span> </span><br><span class="line"><span class="keyword">var</span> observable = <span class="title class_">Rx</span>.<span class="property">Observable</span>.<span class="title function_">create</span>(<span class="keyword">function</span> (<span class="params">observer</span>) &#123;</span><br><span class="line">    observer.<span class="title function_">next</span>(<span class="number">1</span>);</span><br><span class="line">    observer.<span class="title function_">complete</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">observeOn</span>(<span class="title class_">Rx</span>.<span class="property">Scheduler</span>.<span class="property">async</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;before&#x27;</span>);</span><br><span class="line">observable.<span class="title function_">subscribe</span>(&#123;</span><br><span class="line">  <span class="attr">next</span>: <span class="function"><span class="params">x</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(x),</span><br><span class="line">  <span class="attr">complete</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;after&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> Operators 常用操作符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 创建类：create、from、fromEvent、fromPromise、of、range、interval</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 合并类：concat、merge、zip、race、startWith、forkJoin、switch</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 转化类：map、scan、concatMap、mergeMap、switchMap、exhaustMap</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">import</span> &#123;fromEvent, <span class="title class_">Observable</span>, <span class="keyword">of</span>, throwError&#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;catchError, debounceTime, pluck, switchMap&#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> stream = <span class="title function_">fromEvent</span>(input, <span class="string">&#x27;keyup&#x27;</span>).<span class="title function_">pipe</span>(  <span class="comment">// 创建事件流</span></span><br><span class="line">                <span class="title function_">debounceTime</span>(<span class="number">500</span>),            <span class="comment">// 防抖动：忽略 0.5s 间隔内的输入</span></span><br><span class="line">                <span class="title function_">pluck</span>(<span class="string">&#x27;target&#x27;</span>, <span class="string">&#x27;value&#x27;</span>),     <span class="comment">// 获取输入值</span></span><br><span class="line">                <span class="comment">// 输入流转 http：每一次请求前先取消上一次的请求</span></span><br><span class="line">                .<span class="title function_">switchMap</span>(<span class="function"><span class="params">value</span> =&gt;</span> value.<span class="property">length</span> ? <span class="title function_">httpInput</span>(value) : <span class="title function_">of</span>([])),</span><br><span class="line">                <span class="title function_">catchError</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="title function_">throwError</span>(err))</span><br><span class="line">             )</span><br><span class="line">             .<span class="title function_">subscribe</span>(</span><br><span class="line">                <span class="function"><span class="params">res</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res),</span><br><span class="line">                <span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">             )</span><br></pre></td></tr></table></figure>

<h2 id="http-拦截器"><a href="#http-拦截器" class="headerlink" title="http 拦截器"></a>http 拦截器</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ngModule 引入拦截器</span></span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">providers</span>: [&#123; </span><br><span class="line">        <span class="attr">provide</span>: <span class="variable constant_">HTTP_INTERCEPTORS</span>, <span class="attr">useClass</span>: <span class="title class_">ParamInterceptor</span>, <span class="attr">multi</span>: <span class="literal">true</span> </span><br><span class="line">    &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 拦截器自定义：ng g interceptor xxx</span></span><br><span class="line">@<span class="title class_">Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ParamInterceptor</span> implements <span class="title class_">HttpInterceptor</span> &#123;</span><br><span class="line">    <span class="title function_">intercept</span>(<span class="params">req: HttpRequest&lt;any&gt;, next: HttpHandler</span>) &#123;</span><br><span class="line">        <span class="comment">// HttpRequest、HttpResponse 实例的属性是只读的，所以需要克隆后回传</span></span><br><span class="line">        <span class="keyword">const</span> authReq = req.<span class="title function_">clone</span>(&#123;</span><br><span class="line">            <span class="attr">setHeaders</span>: &#123; <span class="attr">token</span>: req.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&#x27;Authorization&#x27;</span>) || <span class="string">&#x27;123&#x27;</span> &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> next.<span class="title function_">handle</span>(authReq);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装拦截器</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, <span class="title class_">Injector</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Router</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="title class_">HttpInterceptor</span>,</span><br><span class="line">    <span class="title class_">HttpRequest</span>,</span><br><span class="line">    <span class="title class_">HttpHandler</span>,</span><br><span class="line">    <span class="title class_">HttpErrorResponse</span>,</span><br><span class="line">    <span class="title class_">HttpResponse</span>,</span><br><span class="line">    <span class="title class_">HttpEvent</span>,</span><br><span class="line">    <span class="title class_">HttpResponseBase</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span>, <span class="keyword">of</span>, throwError &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mergeMap, catchError &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CODEMESSAGE</span> = &#123;</span><br><span class="line">  <span class="number">200</span>: <span class="string">&#x27;服务器成功返回请求的数据。&#x27;</span>,</span><br><span class="line">  <span class="number">201</span>: <span class="string">&#x27;新建或修改数据成功。&#x27;</span>,</span><br><span class="line">  <span class="number">202</span>: <span class="string">&#x27;一个请求已经进入后台排队（异步任务）。&#x27;</span>,</span><br><span class="line">  <span class="number">204</span>: <span class="string">&#x27;删除数据成功。&#x27;</span>,</span><br><span class="line">  <span class="number">400</span>: <span class="string">&#x27;发出的请求有错误，服务器没有进行新建或修改数据的操作。&#x27;</span>,</span><br><span class="line">  <span class="number">401</span>: <span class="string">&#x27;用户没有权限（令牌、用户名、密码错误）。&#x27;</span>,</span><br><span class="line">  <span class="number">403</span>: <span class="string">&#x27;用户得到授权，但是访问是被禁止的。&#x27;</span>,</span><br><span class="line">  <span class="number">404</span>: <span class="string">&#x27;发出的请求针对的是不存在的记录，服务器没有进行操作。&#x27;</span>,</span><br><span class="line">  <span class="number">406</span>: <span class="string">&#x27;请求的格式不可得。&#x27;</span>,</span><br><span class="line">  <span class="number">410</span>: <span class="string">&#x27;请求的资源被永久删除，且不会再得到的。&#x27;</span>,</span><br><span class="line">  <span class="number">422</span>: <span class="string">&#x27;当创建一个对象时，发生一个验证错误。&#x27;</span>,</span><br><span class="line">  <span class="number">500</span>: <span class="string">&#x27;服务器发生错误，请检查服务器。&#x27;</span>,</span><br><span class="line">  <span class="number">502</span>: <span class="string">&#x27;网关错误。&#x27;</span>,</span><br><span class="line">  <span class="number">503</span>: <span class="string">&#x27;服务不可用，服务器暂时过载或维护。&#x27;</span>,</span><br><span class="line">  <span class="number">504</span>: <span class="string">&#x27;网关超时。&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">DefaultInterceptor</span> implements <span class="title class_">HttpInterceptor</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private injector: Injector</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">msg</span>(): <span class="title class_">NzMessageService</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">injector</span>.<span class="title function_">get</span>(<span class="title class_">NzMessageService</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">goTo</span>(<span class="params">url: string</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">injector</span>.<span class="title function_">get</span>(<span class="title class_">Router</span>).<span class="title function_">navigateByUrl</span>(url));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">checkStatus</span>(<span class="params">ev: HttpResponseBase</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ev.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; ev.<span class="property">status</span> &lt; <span class="number">300</span>) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> errortext = <span class="variable constant_">CODEMESSAGE</span>[ev.<span class="property">status</span>] || ev.<span class="property">statusText</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">injector</span>.<span class="title function_">get</span>(<span class="title class_">NzNotificationService</span>)</span><br><span class="line">                     .<span class="title function_">error</span>(<span class="string">`请求错误 <span class="subst">$&#123;ev.status&#125;</span>: <span class="subst">$&#123;ev.url&#125;</span>`</span>, errortext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">handleData</span>(<span class="attr">ev</span>: <span class="title class_">HttpResponseBase</span>): <span class="title class_">Observable</span>&lt;any&gt; &#123;</span><br><span class="line">        <span class="comment">// 可能会因为 throw 导出无法执行 _HttpClient end() 操作</span></span><br><span class="line">        <span class="keyword">if</span> (ev.<span class="property">status</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">injector</span>.<span class="title function_">get</span>(_HttpClient).<span class="title function_">end</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkStatus</span>(ev);</span><br><span class="line">        <span class="comment">// 业务处理：一些通用操作</span></span><br><span class="line">        <span class="keyword">switch</span> (ev.<span class="property">status</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">                <span class="comment">// 业务层级错误处理，比如响应内容 &#123; status: 0, response: &#123;&#125; &#125;</span></span><br><span class="line">                <span class="keyword">if</span> (event <span class="keyword">instanceof</span> <span class="title class_">HttpResponse</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> <span class="attr">body</span>: any = event.<span class="property">body</span>;</span><br><span class="line">                    <span class="keyword">if</span> (body &amp;&amp; body.<span class="property">status</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">msg</span>.<span class="title function_">error</span>(body.<span class="property">msg</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="title function_">throwError</span>(&#123;&#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 重新修改 body 内容为 response 内容</span></span><br><span class="line">                    <span class="keyword">let</span> _event = <span class="title class_">Object</span>.<span class="title function_">assign</span>(event, &#123;<span class="attr">body</span>: body.<span class="property">response</span>&#125;) </span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_">of</span>(<span class="keyword">new</span> <span class="title class_">HttpResponse</span>(_event));</span><br><span class="line">                    <span class="comment">// 或者依然保持完整格式</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_">of</span>(event);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">401</span>: <span class="comment">// 请求错误 401: 用户没有权限（令牌、用户名、密码错误）</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">goTo</span>(<span class="string">&#x27;/passport/login?clean=token&#x27;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">500</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">goTo</span>(<span class="string">`/exception/<span class="subst">$&#123;ev.status&#125;</span>`</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">if</span> (ev <span class="keyword">instanceof</span> <span class="title class_">HttpErrorResponse</span>) &#123;</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;未可知错误&#x27;</span>, ev);</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">msg</span>.<span class="title function_">error</span>(ev.<span class="property">message</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">of</span>(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">intercept</span>(<span class="attr">req</span>: <span class="title class_">HttpRequest</span>, <span class="attr">next</span>: <span class="title class_">HttpHandler</span>): <span class="title class_">Observable</span>&lt;<span class="title class_">HttpEvent</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// 统一加上服务端前缀</span></span><br><span class="line">        <span class="keyword">let</span> url = req.<span class="property">url</span>;</span><br><span class="line">        <span class="keyword">if</span> (!url.<span class="title function_">startsWith</span>(<span class="string">&#x27;https://&#x27;</span>) &amp;&amp; !url.<span class="title function_">startsWith</span>(<span class="string">&#x27;http://&#x27;</span>)) &#123;</span><br><span class="line">            url = environment.<span class="property">SERVER_URL</span> + url;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> newReq = req.<span class="title function_">clone</span>(&#123; url &#125;);</span><br><span class="line">        <span class="keyword">return</span> next.<span class="title function_">handle</span>(newReq).<span class="title function_">pipe</span>(</span><br><span class="line">            <span class="title function_">mergeMap</span>(<span class="function">(<span class="params">event: any</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 允许统一对请求错误处理</span></span><br><span class="line">                <span class="keyword">if</span> (event <span class="keyword">instanceof</span> <span class="title class_">HttpResponseBase</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">handleData</span>(event);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 若一切都正常，则后续操作</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">of</span>(event);</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="title function_">catchError</span>(<span class="function">(<span class="params">err: HttpErrorResponse</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">handleData</span>(err))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="五、Router-路由"><a href="#五、Router-路由" class="headerlink" title="五、Router 路由"></a>五、Router 路由</h1>]]></content>
      <categories>
        <category>JS 框架</category>
      </categories>
      <tags>
        <tag>JS 框架</tag>
      </tags>
  </entry>
  <entry>
    <title>面试题之提升篇</title>
    <url>/2020/04/05/13-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E6%8F%90%E5%8D%87%E7%AF%87/</url>
    <content><![CDATA[<h1 id="一、源码实现"><a href="#一、源码实现" class="headerlink" title="一、源码实现"></a>一、源码实现</h1><h2 id="函数柯里化"><a href="#函数柯里化" class="headerlink" title="函数柯里化"></a>函数柯里化</h2><blockquote>
<p>指将多个参数的函数拆解为单一参数的多个函数的依次调用，即使用闭包返回一个延迟执行函数。优点是可以实现延迟计算和参数复用。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 普通函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// 柯里化实现</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">currying</span> = x =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">y</span> =&gt;</span> &#123; <span class="keyword">return</span> x+y &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">currying</span>(<span class="number">1</span>)(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装实现</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">curringAdd</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> args = [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">    args = [...args, [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">0</span>)];</span><br><span class="line">    <span class="keyword">return</span> add</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  add.<span class="property">toString</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">t, a</span>) =&gt;</span> t + +a, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> add;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curringAdd</span>(<span class="number">1</span>)) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curringAdd</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>))  <span class="comment">// 6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curringAdd</span>(<span class="number">2</span>, <span class="number">6</span>)(<span class="number">1</span>))  <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>


<h2 id="bind、call、apply"><a href="#bind、call、apply" class="headerlink" title="bind、call、apply"></a>bind、call、apply</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">MyCall</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> args = [...<span class="variable language_">arguments</span>].<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  context.<span class="property">fn</span> = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = context.<span class="title function_">fn</span>(...args);</span><br><span class="line">  <span class="keyword">delete</span> context.<span class="property">fn</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">MyApply</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> args = <span class="variable language_">arguments</span>[<span class="number">1</span>] || [];</span><br><span class="line"></span><br><span class="line">  context.<span class="property">fn</span> = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">const</span> result = context.<span class="title function_">fn</span>(...args);</span><br><span class="line">  <span class="keyword">delete</span> context.<span class="property">fn</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">MyBind</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> args = [...<span class="variable language_">arguments</span>].<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    context.<span class="title class_">MyApply</span>(context, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="模拟-new"><a href="#模拟-new" class="headerlink" title="模拟 new"></a>模拟 new</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myNew</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> newObj = <span class="title class_">Object</span>.<span class="title function_">create</span>(fn.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  result = fn.<span class="title function_">apply</span>(newObj, [...<span class="variable language_">arguments</span>].<span class="title function_">slice</span>(<span class="number">1</span>));</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> result === <span class="string">&quot;object&quot;</span> ? result : newObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Proxy-Fetch-实现-axios"><a href="#Proxy-Fetch-实现-axios" class="headerlink" title="Proxy + Fetch 实现 axios"></a>Proxy + Fetch 实现 axios</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axiosOriginal = &#123;</span><br><span class="line">  <span class="attr">methods</span>: [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>, <span class="string">&#x27;DELETE&#x27;</span>, <span class="string">&#x27;OPTIONS&#x27;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> axios = <span class="keyword">new</span> <span class="title class_">Proxy</span>(axiosOriginal, &#123;</span><br><span class="line">  <span class="title function_">set</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Can&#x27;t set any property&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, name</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> method = name.<span class="title function_">toLocaleUpperCase</span>();</span><br><span class="line">    <span class="keyword">if</span> (target.<span class="property">methods</span>.<span class="title function_">indexOf</span>(method) === -<span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Can&#x27;t support method <span class="subst">$&#123;method&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">url, options</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">        method,</span><br><span class="line">        ...options</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">text</span>())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;http://www.baidu.com&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;http://www.baidu.com&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br></pre></td></tr></table></figure>


<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&quot;pending&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">RESOLVED</span> = <span class="string">&quot;resolved&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">REJECTED</span> = <span class="string">&quot;rejected&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">PENDING</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">resolvedHandlers</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rejectedHandlers</span> = [];</span><br><span class="line">    <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">resolve</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="variable language_">this</span>.<span class="property">reject</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">resolve</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">RESOLVED</span>;</span><br><span class="line">      <span class="keyword">const</span> resolveHandler = <span class="variable language_">this</span>.<span class="property">resolvedHandlers</span>.<span class="title function_">shift</span>();</span><br><span class="line">      <span class="keyword">if</span> (!resolveHandler) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> result = <span class="title function_">resolveHandler</span>(props);</span><br><span class="line">      <span class="keyword">if</span> (result &amp;&amp; result <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">        result.<span class="title function_">then</span>(...<span class="variable language_">this</span>.<span class="property">resolvedHandlers</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">reject</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">      <span class="keyword">const</span> rejectHandler = <span class="variable language_">this</span>.<span class="property">rejectedHandlers</span>.<span class="title function_">shift</span>();</span><br><span class="line">      <span class="keyword">if</span> (!rejectHandler) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> result = <span class="title function_">rejectHandler</span>(error);</span><br><span class="line">      <span class="keyword">if</span> (result &amp;&amp; result <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">        result.<span class="title function_">catch</span>(...<span class="variable language_">this</span>.<span class="property">rejectedHandlers</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">...handlers</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">resolvedHandlers</span> = [...<span class="variable language_">this</span>.<span class="property">resolvedHandlers</span>, ...handlers];</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span>(...handlers) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rejectedHandlers</span> = [...<span class="variable language_">this</span>.<span class="property">rejectedHandlers</span>, ...handlers];</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">MyPromise</span>.<span class="property">all</span> = <span class="keyword">function</span> (<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> promise = promises[i];</span><br><span class="line">      promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        results.<span class="title function_">push</span>(res);</span><br><span class="line">        <span class="keyword">if</span> (results.<span class="property">length</span> === promises.<span class="property">length</span>) <span class="title function_">resolve</span>(results);</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(reject);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">MyPromise</span>.<span class="property">race</span> = <span class="keyword">function</span> (<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> promise = promises[i];</span><br><span class="line">      promise.<span class="title function_">then</span>(resolve).<span class="title function_">catch</span>(reject);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// promise.finally 实现</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">finally</span> = <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> P = <span class="variable language_">this</span>.<span class="property">constructor</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(</span><br><span class="line">    <span class="function"><span class="params">value</span>  =&gt;</span> P.<span class="title function_">resolve</span>(<span class="title function_">callback</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> value),</span><br><span class="line">    <span class="function"><span class="params">reason</span> =&gt;</span> P.<span class="title function_">resolve</span>(<span class="title function_">callback</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="keyword">throw</span> reason &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><ol>
<li>React 实现主要分为 Component、Element。</li>
<li>Component 属于 React 实例，创建实例的过程中会在实例中注册 state、props 属性，还会依次调用内置的生命周期函数。Component render 函数会返回一个 ElementObj &#x2F; null。</li>
<li>Element 对象分为原生 Element 对象和组件式对象，它们会被一起解析成虚拟 DOM 树，内部使用的 state、props 也会以 AST 的形式注入进去。</li>
<li>虚拟 DOM 树渲染前后会触发 componentWillMount、componentDidMount 等生命周期函数，解析完成后将被渲染成真实 DOM 树。</li>
<li>调用 setState 时会更新 Component state，并会触发内部的一个 updater。调用 render 会生成新的虚拟 DOM 树，利用 diff 算法对比后的醋最优方案去更新 DOM。</li>
</ol>
<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><ul>
<li><strong>实现原理</strong>：创建一个状态中心，通过纯函数来对其数据进行修改，然后将修改结果以发布订阅的方式通知到所有订阅者，从而达到一个共享状态的效果。</li>
<li><strong>核心</strong>：函数式编程，使用无副作用的同步函数 action 来触发 reducer 对数据进行修改。</li>
<li><strong>创建函数</strong>：createStore，这个函数的作用是创建一个 store 对象，关键步骤如下：<ul>
<li>1、将 reducer 利用闭包存储在函数内。</li>
<li>2、导出 subscribe 函数，内部将订阅者添加到一个订阅者列表中并等待通知。</li>
<li>3、导出 dispatch 函数，内部执行 reducer 函数并将 action 作为参数传入到 reducer。</li>
<li>4、将 reducer 函数的返回结果存到 currentState，并通知所有订阅者 state 已更新。</li>
<li>5、订阅者可以通过 getState 得到最新的 state。</li>
</ul>
</li>
<li><strong>中间件原理</strong>：Decorator 装饰器模式，将中间件通过装饰后返回一个增强型的 dispatch。</li>
<li><strong>redux-thunk 实现异步</strong>：内部判断 action 的类型，是函数则将 dispatch 作为参数执行，action 函数决定何时（可能是异步操作后）执行 dispatch。</li>
</ul>
<h2 id="new-Vue-执行后"><a href="#new-Vue-执行后" class="headerlink" title="new Vue 执行后"></a>new Vue 执行后</h2><ol>
<li>new Vue 会调用 Vue 原型链上的 _init 方法对 Vue 实例进行初始化。</li>
<li>首先 initLifecycle 初始化生命周期，对 children、isMounted 等实例属性进行初始化。</li>
<li>initEvents，初始化当前实例上的一些自定义事件（Vue.$on）。</li>
<li>initRender，解析 slots 绑定在 Vue 实例上，绑定 createElement 方法在实例上。</li>
<li>完成对生命周期、自定义事件等属性的初始化后，触发生命周期钩子 beforeCreate。</li>
<li>initInjections，在初始化 data、props 之前完成依赖注入（类似于 React.Context）。</li>
<li>initState，初始化 data、props，并对内部属性完成数据劫持，更新时触发回调。</li>
<li>initProvide，对依赖注入进行解析。</li>
<li>完成对数据（state 状态）的初始化后，触发生命周期钩子 created。</li>
<li>进入挂载阶段，将 vue 模板语法通过 vue-loader 解析成虚拟 DOM 树，虚拟 DOM 树与数据完成双向绑定，触发生命周期钩子 beforeMount。</li>
<li>将解析好的虚拟 DOM 树通过 vue 渲染成真实 DOM，触发生命周期钩子 mounted。</li>
</ol>
<h2 id="webpack-热更新原理"><a href="#webpack-热更新原理" class="headerlink" title="webpack 热更新原理"></a>webpack 热更新原理</h2><ol>
<li>修改一个或多个文件时，文件系统会接收更改并通知 webpack 重新编译。</li>
<li>webpack 构建一或多个模块，并通知 HMR（Hot Module Replacement）服务器更新。</li>
<li>HMR Server 使用 Websocket 通知 HMR runtime 更新，runtime 通过 HTTP 更新 jsonp。</li>
<li>HMR runtime 替换更新中的模块，如果确定这些模块无法更新，则触发整个页面刷新。</li>
</ol>
<h1 id="二、网络相关"><a href="#二、网络相关" class="headerlink" title="二、网络相关"></a>二、网络相关</h1><h2 id="HTTP-状态码及其功能"><a href="#HTTP-状态码及其功能" class="headerlink" title="HTTP 状态码及其功能"></a>HTTP 状态码及其功能</h2><ul>
<li>100~199：信息提示</li>
<li>200~299：成功</li>
<li>300~399：重定向</li>
<li>400~499：客户端错误</li>
<li>500~599：服务端错误</li>
<li>200 成功</li>
<li>204 无内容</li>
<li>301 永久移动（回应 GET 响应时会自动将请求者转到新位置）</li>
<li>304 未修改（协商缓存）</li>
<li>400 Bad Request</li>
<li>401 未授权</li>
<li>403 服务器拒绝请求</li>
<li>404 未找到</li>
<li>409 请求发生冲突</li>
<li>500 服务器内部错误</li>
<li>502 错误网关</li>
<li>503 服务不可用</li>
</ul>
<h2 id="输入-URL-到页面加载的全过程"><a href="#输入-URL-到页面加载的全过程" class="headerlink" title="输入 URL 到页面加载的全过程"></a>输入 URL 到页面加载的全过程</h2><ol>
<li>用户输入 URL，浏览器进程通过 URL 和协议组装为完整 URL。</li>
<li>网络进程接收到浏览器进程通过进程通信发送的 URL 后检查本地缓存资源。</li>
<li>网络进程没有请求缓存时向服务器发起 HTTP 请求：通过 DNS 查询获取服务器的 IP 地址和端口、通过 IP 和服务器建立 TCP 连接、发送请求并接收服务器的响应内容。</li>
<li>网络进程解析响应内容：状态码为 301&#x2F;302 时重定向，200 时则检查响应类型 Content-Type，字节流时将请求转给下载管理器并不再渲染，html 则发给渲染进程处理。</li>
<li>渲染进程构建 DOM 树：如果 URL 和已打开的渲染进程根域名不同时会开启新进程。</li>
<li>浏览器进程根据 DOM 树更新页面：关闭连接并重复请求至资源全部加载后更新页面。</li>
</ol>
<h2 id="HTTP-请求流程"><a href="#HTTP-请求流程" class="headerlink" title="HTTP 请求流程"></a>HTTP 请求流程</h2><ol>
<li>构建请求：浏览器构建请求行后准备发起网络请求。</li>
<li>查找缓存：浏览器首先会查询缓存中是否有请求资源副本，有则拦截请求并返回资源副本。</li>
<li>准备 IP 地址和端口：浏览器请求 DNS 返回域名对应 IP 并缓存域名解析结果。</li>
<li>等待 TCP 队列：Chrome 机制下同一个域名同时最多只能建立 6 个 TCP 连接。</li>
<li>建立 TCP 连接：TCP 通过三次握手建立连接和传输数据，通过四次挥手断开连接。</li>
<li>发送 HTTP 请求：浏览器建立 TCP 连接后首先会向服务器发送请求行，然后以请求头形式发送一些其他信息，如果是 POST 请求还会发送请求体。</li>
<li>服务器处理请求：如果请求头或响应头有 Connection:keep-alive TCP 则保持打开状态。</li>
<li>服务器返回请求和断开连接。</li>
</ol>
<h2 id="HTTPS-原理-握手过程"><a href="#HTTPS-原理-握手过程" class="headerlink" title="HTTPS 原理 (握手过程)"></a>HTTPS 原理 (握手过程)</h2><ol>
<li>客户端使用 https 的 url 访问 web 服务器，要求与服务器建立 ssl 连接。</li>
<li>web 服务器收到客户端请求后，会将网站的证书（包含公钥）传送一份给客户端。</li>
<li>客户端收到网站证书后会检查颁发机构和过期时间，没问题则随机生成一个秘钥。</li>
<li>客户端利用公钥将会话秘钥加密，并传送给服务端，服务端利用自己的私钥解密。</li>
<li>之后服务器与客户端使用秘钥加密传输。</li>
</ol>
<h2 id="HTTPS-握手时客户端验证证书"><a href="#HTTPS-握手时客户端验证证书" class="headerlink" title="HTTPS 握手时客户端验证证书"></a>HTTPS 握手时客户端验证证书</h2><ol>
<li>首先浏览器读取证书中的证书所有者、有效期等信息进行校验，校验证书的网站域名是否与证书颁发的域名一致，校验证书是否在有效期内。</li>
<li>浏览器开始查找操作系统中已内置的受新人的证书发布机构 CA，与服务器发来的证书中的颁发者 CA 比对，用于校验证书是否为合法机构颁发。</li>
<li>如果找不到，浏览器就会报错，说明浏览器发来的证书是不可信任的。</li>
<li>如果找到，浏览器就会从操作系统中取出颁发者 CA 的公钥（浏览器开发商一般会实现在内部植入常用认证机关的公开密钥），然后对服务器发来的证书里面的签名进行解密。</li>
<li>浏览器使用相同 hash 算法计算出服务器发送证书的 hash 值，然后与证书中签名做对比。</li>
<li>对比结果一致，则证明服务器发来的证书合法，没有被冒充。</li>
</ol>
<h2 id="HTTP2-多路复用"><a href="#HTTP2-多路复用" class="headerlink" title="HTTP2 多路复用"></a>HTTP2 多路复用</h2><ul>
<li>HTTP&#x2F;1 每次请求都会建立一次 HTTP 连接，即 3 次握手和 4 次挥手，这个过程在一次请求过程中占用了较长时间，即使开启了 Keep-Alive 解决了多次连接的问题，但是依然有两个效率上的问题，一是串行的文件传输，二是连接数过多导致的性能问题。HTTP&#x2F;2 的多路复用就是为了解决上述的两个性能问题。</li>
<li>HTTP&#x2F;2 有两个重要概念，分别是帧（frame）和流（stream）。帧代表着最小的数据单位，每个帧会标识出该帧属于哪个流，流是多个帧组成的数据流。</li>
<li>多路复用，就是在一个 TCP 连接中可以存在多条流。即可以发送多个请求，对端可以通过帧中的标识知道属于哪个请求。通过这个技术，可以避免 HTTP 旧版本中的队头阻塞问题，极大的提高传输性能。</li>
</ul>
<h2 id="HTTPS-中间人攻击"><a href="#HTTPS-中间人攻击" class="headerlink" title="HTTPS 中间人攻击"></a>HTTPS 中间人攻击</h2><blockquote>
<p>https 协议由 http + ssl 协议构成。攻击的防范方法：服务器在发送浏览器的公钥中加入 CA 证书，浏览器可以验证 CA 证书的有效性（HTTPS 只有信任了劫持者的 CA 证书才会被劫持）。中间人攻击过程如下：</p>
</blockquote>
<ol>
<li>服务器向客户端发送公钥。</li>
<li>攻击者截获公钥，保留在自己手上。</li>
<li>然后攻击者自己生成一个【伪造的】公钥，发给客户端。</li>
<li>客户端收到伪造的公钥后，生成加密 hash（秘钥） 值发给服务器。</li>
<li>攻击者获得加密 hash 值，用自己的私钥解密获得真秘钥。</li>
<li>同时生成假的加密 hash 值，发给服务器。</li>
<li>服务器用私钥解密获得假秘钥。</li>
<li>服务器用假秘钥加密传输信息。</li>
</ol>
<h2 id="token-加密"><a href="#token-加密" class="headerlink" title="token 加密"></a>token 加密</h2><blockquote>
<p>JWT (JSON Web Token) 是一种用于通信双方之间传递安全信息的基于 JSON 的开放标准，常用于跨域身份验证。它可以通过 HMAC 算法或 RSA 公私秘钥生成签名，具有简洁 (数据量小)、自包含 (负载中包含了所有用户所需要的信息，避免了多次查询数据库) 的特点。JWT 加密的实现过程如下：</p>
</blockquote>
<ol>
<li>需要一个 secret（随机数）。</li>
<li>后端利用 secret 和加密算法（如：HMAC-SHA256）对 payload（如账号密码）生成一个字符串（token），然后返回前端。</li>
<li>前端每次 request 都在 header 中带上 token。</li>
<li>后端用同样的算法解密。</li>
</ol>
<h2 id="SSL-连接断开后如何恢复"><a href="#SSL-连接断开后如何恢复" class="headerlink" title="SSL 连接断开后如何恢复"></a>SSL 连接断开后如何恢复</h2><ul>
<li><strong>Session ID</strong>：每次会话都有一个编号，当对话中断后重新连接时，只要客户端提供编号并且服务器有该编号的记录，则双方可以继续使用以前的密钥，而不用重新生成。</li>
<li><strong>Session Ticket</strong>：服务器在上一次对话中发送给客户的。这个 ticket 是加密的并且只有服务器能够解密，里面包含了本次会话的信息，比如对话密钥和加密方法等。不管请求是否转移到其他服务器，服务器将 ticket 解密后，就能获取上次对话的信息而不用重新生成对话秘钥了。</li>
</ul>
<h2 id="CDN-服务"><a href="#CDN-服务" class="headerlink" title="CDN 服务"></a>CDN 服务</h2><blockquote>
<p>CDN 是一个内容分发网络，通过对源网站资源的缓存，利用本身多台位于不同地域、不同运营商的服务器，向用户提供资源就近访问的功能。也就是说，用户的请求并不是直接发送给源网站，而是发送给 CDN 服务器，由 CDN 服务器将请求定位到最近的含有该资源的服务器上去请求。这样有利于提高网站的访问速度，同时也减轻了源服务器的访问压力。CDN 访问过程如下：</p>
</blockquote>
<ol>
<li>用户输入访问的域名,操作系统向 LocalDns 查询域名的ip地址。</li>
<li>LocalDns 向 ROOT DNS 查询域名的授权服务器(这里假设 LocalDns 缓存过期)。</li>
<li>ROOT DNS 将域名授权 dns 记录回应给 LocalDns。</li>
<li>LocalDns 得到域名的授权 dns 记录后,继续向域名授权 dns 查询域名的 ip 地址。</li>
<li>域名授权 dns 查询域名记录后(一般是 CNAME )，回应给 LocalDns。</li>
<li>LocalDns 得到域名记录后,向智能调度 DNS 查询域名的 ip 地址。</li>
<li>智能调度 DNS 根据一定的算法和策略(比如静态拓扑、容量等)，将最适合的 CDN 节点ip地址回应给 LocalDns。</li>
<li>LocalDns 将得到的域名 ip 地址，回应给用户端。</li>
<li>用户得到域名 ip 地址后，访问站点服务器。</li>
<li>CDN 节点服务器应答请求，将内容返回给客户端.(缓存服务器一方面在本地进行保存，以备以后使用，二方面把获取的数据返回给客户端，完成数据服务过程)。</li>
</ol>
<h1 id="三、设计模式"><a href="#三、设计模式" class="headerlink" title="三、设计模式"></a>三、设计模式</h1><h2 id="设计模式的原则"><a href="#设计模式的原则" class="headerlink" title="设计模式的原则"></a>设计模式的原则</h2><blockquote>
<p>设计模式描述了一个不断发生的问题和解决方案的核心，可以重复使用而减少工作量。解决复杂问题时主要通过分解(将复杂问题简单化)、抽象(忽略细节而处理抽象模型)。</p>
</blockquote>
<ul>
<li><strong>组件协作</strong><ol>
<li>Template Method 模式：定义一个操作中算法的骨架(稳定)，将一些步骤(变化)延迟到子类，比如 React 生命周期。</li>
<li>Observer 模式：定义对象间的一种一对多的依赖关系，当对象 Subject 的状态发生变化时则所有依赖它的对象都得到通知并自动更新，比如 Redux 实现。</li>
<li>Strategy 模式：定义一系列算法并封装，并且使它们可互相替换(变化)。该模式使得算法可独立于使用它的客户程序(稳定)而变化(扩展、子类化)，比如国际化语言。</li>
</ol>
</li>
<li><strong>单一职责</strong><ol>
<li>Decorator 模式：给一个对象动态(组合)增加额外功能，在增加功能方面比生成子类(继承)更加灵活，比如 React 高阶组件、中间件。</li>
<li>Bridge 模式：将业务功能与平台实现分离，使它们都可以独立变化，比如组件。</li>
</ol>
</li>
<li><strong>对象创建</strong><ol>
<li>Factory Method 模式：定义一个用于创建对象的接口，让子类决定实例化哪一个类。Factory Method 使得一个类的实例化延迟（目的：解耦，手段：抽象）到子类，比如 React.createElement()、gin.Default()。</li>
<li>Abstract Factory：提供一个接口，让该接口负责创建一系列相关或相互依赖的对象而无需指定他们具体的类，比如 SQL API 有连接类、创建类、操作类。</li>
</ol>
</li>
<li><strong>对象性能</strong><ol>
<li>Singleton 模式：一个类只有一个实例并提供实例的全局访问点，比如游戏主角。</li>
<li>FlyWeight 享元模式：运行共享技术有效支持大量细粒度的对象，比如对象池优化。</li>
</ol>
</li>
<li><strong>接口隔离</strong><ol>
<li>Facade 模式：为子系统的一组接口提供一致(稳定)的界面，Facade 模式定义了一个方便子系统复用的高层接口，比如各种硬件驱动。</li>
<li>Proxy 模式：为其他对象提供一种代理以控制(隔离、使用接口)对这种对象的访问，比如使用闭包导出方法(代理操作对象)。</li>
<li>Adapter 模式：将一个类的接口转换为客户希望的另一个接口，使得原本由于接口不兼容而不能一起工作的那些类可以一起工作，比如 Go http.ListenAndServe 所接受的结构体只需要实现 ServeHTTP 方法即可满足 http 的接口条件。</li>
<li>Composite 模式：将对象组合成树形结构以表示 部分-整体 的层次结构。Composite 使得用户对单个对象和组合对象的使用具有一致性(稳定)，比如树形结构中 Parent&#x2F;Child Node 都继承于同一抽象类 Node 并通过 process 执行方法。</li>
</ol>
</li>
</ul>
<h2 id="观察者模式、订阅-发布模式"><a href="#观察者模式、订阅-发布模式" class="headerlink" title="观察者模式、订阅-发布模式"></a>观察者模式、订阅-发布模式</h2><blockquote>
<p>发布-订阅模式是观察者模式的一种变体，它只是把一部分功能抽象成一个独立的变更管理器。一对多时使用观察者，多对多时则使用订阅-发布。观察者模式的主体和观察者是互相感知的，发布-订阅模式是借助第三方来实现调度的，发布者和订阅者之间互不感知。</p>
</blockquote>
<h2 id="面向对象的设计原则"><a href="#面向对象的设计原则" class="headerlink" title="面向对象的设计原则"></a>面向对象的设计原则</h2><ul>
<li><strong>依赖倒置原则</strong>：高层模块(稳定)不应该依赖低层模块(变化)，两者都应该依赖于抽象(稳定)。抽象(稳定)不应该依赖于实现细节(变化)，实现细节(变化)应该依赖于抽象(稳定)。</li>
<li><strong>开放封闭原则</strong>：对扩展开放而对更改封闭，类模块应该是可扩展的但不可修改。</li>
<li><strong>单一职责原则</strong>：一个类应该只有一个引起它变化的原因，变化方向隐含了类的责任。</li>
<li><strong>Liskov 替换原则</strong>：子类必须能够替换他们的基类 IS-A，继承表达类型抽象。</li>
<li><strong>接口隔离原则</strong>：不应该强迫客户端使用他们不用的方法，接口应该小而完备。</li>
<li><strong>优先使用对象组合，而不是类继承</strong>：类继承通常为白箱复用，对象组合通常为黑箱复用。继承在某种程度上破坏了封装性而导致子类和父类耦合度高，对象组合则只要求被组合的对象具有良好定义的接口而耦合度低。&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 白箱复用为 B 类继承 A 类的功能并了解内部细节从而实现复用但是耦合性较强，黑箱复用则是 B 类只需要关注 A 类所暴露的一些外部方法即可实现复用从而达到了解耦效果。</li>
<li><strong>封装变化点</strong>：使用封装来创建对象之间的分界层，让设计者可以在分界层的一侧进行修改，而不会对另一侧产生不良的影响，从而实现层次间的松耦合。</li>
<li><strong>针对接口编程，而不是针对实现编程</strong>：不将变量类型声明为具体的某个类，而是声明为某个接口。客户程序无需获取对象的具体类型，只需要知道对象所具有的接口。减少系统中的各部分依赖关系，从而实现高内聚、低耦合的类型设计方案。</li>
</ul>
<h1 id="四、算法相关"><a href="#四、算法相关" class="headerlink" title="四、算法相关"></a>四、算法相关</h1><h2 id="迭代方式实现-flatten-函数"><a href="#迭代方式实现-flatten-函数" class="headerlink" title="迭代方式实现 flatten 函数"></a>迭代方式实现 flatten 函数</h2><blockquote>
<p>迭代指按顺序访问数组、对象等的每一项 (查找、遍历)。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flatten</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(arr[i])) &#123;</span><br><span class="line">      arr = arr.<span class="title function_">concat</span>(arr[i])</span><br><span class="line">      arr.<span class="title function_">splice</span>(i, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, [<span class="number">6</span>, <span class="number">7</span>], <span class="number">8</span>], <span class="number">9</span>, <span class="number">10</span>, [<span class="number">11</span>, [<span class="number">12</span>, <span class="number">13</span>]]]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">flatten</span>(arr))</span><br></pre></td></tr></table></figure>

<h2 id="数组的随机排序"><a href="#数组的随机排序" class="headerlink" title="数组的随机排序"></a>数组的随机排序</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 随机数排序</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">random1</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">sort</span>(<span class="function">() =&gt;</span> <span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机插入排序</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">random2</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> cArr = [...arr];</span><br><span class="line">  <span class="keyword">const</span> newArr = [];</span><br><span class="line">  <span class="keyword">while</span> (cArr.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * cArr.<span class="property">length</span>);</span><br><span class="line">    newArr.<span class="title function_">push</span>(cArr[index]);</span><br><span class="line">    cArr.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 洗牌算法，随机交换排序</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">random3</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> l = arr.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (l - i)) + i;</span><br><span class="line">    <span class="keyword">const</span> temp = arr[index];</span><br><span class="line">    arr[index] = arr[i];</span><br><span class="line">    arr[i] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="五、Nodejs"><a href="#五、Nodejs" class="headerlink" title="五、Nodejs"></a>五、Nodejs</h1><h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><blockquote>
<p>Node 中的每个文件模块都是一个对象，定义如下：</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Module</span>(<span class="params">id, parent</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">exports</span> = &#123;&#125;;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">parent</span> = parent;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filename</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">loaded</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">children</span> = [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Module</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="variable language_">module</span> = <span class="keyword">new</span> <span class="title class_">Module</span>(filename, parent);</span><br></pre></td></tr></table></figure>


<h2 id="require-模块加载机制"><a href="#require-模块加载机制" class="headerlink" title="require 模块加载机制"></a>require 模块加载机制</h2><ol>
<li>计算模块绝对路径。</li>
<li>如果缓存中有该模块，则从缓存中取出该模块。</li>
<li>按优先级依次寻找并编译执行模块，将模块推入缓存（require.cache）。</li>
<li>输出模块的 exports 属性。</li>
</ol>
<h2 id="两个模块互相引用"><a href="#两个模块互相引用" class="headerlink" title="两个模块互相引用"></a>两个模块互相引用</h2><blockquote>
<p>假设 A、B 模块互相引用，此时运行 A 模块的话，先运行的 A 模块将会被缓存，但是此时缓存的是一个未执行完毕的 A 模块，而 A 模块中引入的 B 模块将会被完整加载并且正常使用，而 B 模块中调用的 A 模块将会是个默认的空对象（module.exports 的默认值），不具备 A 模块的任何功能。</p>
</blockquote>
<h2 id="异步-I-x2F-O"><a href="#异步-I-x2F-O" class="headerlink" title="异步 I&#x2F;O"></a>异步 I&#x2F;O</h2><ul>
<li>进程启动时，Node 会创建一个类似于 while(true) 的循环，每执行一次循环体的过程成为 Tick。每个 Tick 的过程就是查看是否有事件待处理，如果有就取出事件及其相关的回调函数。如果存在关联的回调函数就执行，然后进入下个循环，不再有事件处理时退出进程。（每个 Tick 都会把观察者中可执行的事件执行完毕后，再进行下一个 Tick）。</li>
<li>事件循环是一个典型的生产者&#x2F;消费者模型。异步I&#x2F;O、网络请求等则是事件的生产者，生产出的事件被传递到对应的观察者，事件循环从观察者取出事件并处理（消费者）。</li>
<li>具体流程<ul>
<li>1、发起异步调用</li>
<li>2、封装异步执行对象，设置回调函数和参数</li>
<li>3、将异步执行对象推入线程池（主线程继续往下执行）</li>
<li>4、异步执行对象执行完毕后，将执行结果连同线程一起交还给主线程。</li>
<li>5、主线程的 Tick 检测到有执行完成的异步任务，取出对象并执行对应的回调函数。</li>
<li>6、完成</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 简易型 tick</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> events = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;checking...&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (events.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> event = events.<span class="title function_">shift</span>();</span><br><span class="line">      <span class="title function_">event</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">50</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;event callback&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  events.<span class="title function_">push</span>(fn);</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">observer</span>();</span><br></pre></td></tr></table></figure>


<h2 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h2><blockquote>
<p>Node 中用于处理二进制数据的类，其中与 IO 相关的操作（网络&#x2F;文件等）均基于 Buffer。Buffer 类的实例非常类似于整数数组，但其大小是固定不变的，并且其内存在 V8 堆栈外分配原始内存空间。Buffer 类的实例创建之后，其所占用的内存大小就不能再进行调整。</p>
</blockquote>
<h2 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h2><blockquote>
<p>Node 中处理流式数据的抽象接口，stream 模块用于构建实现了流接口的对象。Node 提供了 http 请求、process.stdout 等多种流对象。流可以是可读的、可写的、或者可读可写的，所有的流都是 EventEmitter 的实例。</p>
</blockquote>
<h2 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h2><ul>
<li>IPC 又称进程间通信技术，是用于 Node 内部父子进程之间进行通信的方法。</li>
<li>Node IPC 是通过不同平台的管道技术实现的，特点是本地网络通信、速度快、效率高。</li>
<li>Node 在启动子进程时，主进程先建立 IPC 通道，然后将 IPC 通道的 fd（文件描述符）通过环境变量（NODE_CHANNEL_FD）的方式传递给子进程，然后子进程通过 fd 与 父进程建立 IPC 连接。</li>
</ul>
<h2 id="实现热更新"><a href="#实现热更新" class="headerlink" title="实现热更新"></a>实现热更新</h2><blockquote>
<p>Node API require.cache，该对象引用被清除后重新调用时就会重新加载，这个机制可以用来热加载更新的模块。然后使用 fs.watchFile 监听文件的更改，文件更改后调用 clearCache 传入对应的模块名即可。使用 pm2 reload 可以实现暴力热更新，它会保证在新实例重启成功后才会把旧进程杀死，可以保持服务一直在可响应状态。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">clearCache</span>(<span class="params">modulePath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> path = <span class="built_in">require</span>.<span class="title function_">resolve</span>(modulePath);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">require</span>.<span class="property">cache</span>[path]) &#123;</span><br><span class="line">    <span class="built_in">require</span>.<span class="property">cache</span>[path] = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Node-更适合处理-I-x2F-O-密集型任务还是-CPU-密集型任务"><a href="#Node-更适合处理-I-x2F-O-密集型任务还是-CPU-密集型任务" class="headerlink" title="Node 更适合处理 I&#x2F;O 密集型任务还是 CPU 密集型任务"></a>Node 更适合处理 I&#x2F;O 密集型任务还是 CPU 密集型任务</h2><ul>
<li>Node 更适合处理 I&#x2F;O 密集型的任务。因为 Node 的 I&#x2F;O 密集型任务可以异步调用，利用事件循环的处理能力，资源占用极少，并且事件循环能力避开了多线程的调用，在调用方面是单线程，内部处理其实是多线程的。</li>
<li>由于 JS 是单线程，Node 不适合处理 CPU 密集型的任务，CPU 密集型的任务会导致 CPU 时间片不能释放，使得后续 I&#x2F;O 无法发起，从而造成阻塞。但是可以利用到多进程的特点完成对一些 CPU 密集型任务的处理，不过由于 JS 并不支持多线程，所以在这方面的处理能力会弱于其他多线程语言（例如 Java、Go）。</li>
</ul>
<h2 id="Node-为何不给每个-js-文件以独立的上下文来避免作用域被污染"><a href="#Node-为何不给每个-js-文件以独立的上下文来避免作用域被污染" class="headerlink" title="Node 为何不给每个 js 文件以独立的上下文来避免作用域被污染"></a>Node 为何不给每个 js 文件以独立的上下文来避免作用域被污染</h2><blockquote>
<p>Node 模块正常情况下对作用域不会造成污染（模块函数内执行），意外创建全局变量是一种例外，可以采用严格模式来避免。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>); <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">global</span>.<span class="property">a</span>); <span class="comment">// 1 意外的全局上下文污染</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b); <span class="comment">// 10</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">b</span>); <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">global</span>.<span class="property">b</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>


<h2 id="console-log-是同步还是异步"><a href="#console-log-是同步还是异步" class="headerlink" title="console.log 是同步还是异步?"></a>console.log 是同步还是异步?</h2><blockquote>
<p>内部实现是 process.stdout，将输入内容打印到 stdout，同步异步取决于 stdout 连接的数据流的类型（需要写入的位置）以及不同的操作系统。造成这种差异的原因是因为一些历史遗留问题，不过这个问题并不会影响正常的输出结果。</p>
</blockquote>
<ul>
<li>文件：Windows、POSIX 同步。</li>
<li>TTY（终端）：Windows 异步，POSIX 同步。</li>
<li>管道（和 socket）：Windows 同步，POSIX 异步。</li>
</ul>
<h2 id="父-x2F-子进程的死亡有何影响"><a href="#父-x2F-子进程的死亡有何影响" class="headerlink" title="父&#x2F;子进程的死亡有何影响"></a>父&#x2F;子进程的死亡有何影响</h2><ul>
<li>子进程死亡不会影响父进程，不过子进程死亡时会向它的父进程发送死亡信号。反之父进程死亡，一般情况下子进程也会随之死亡，但如果此时子进程处于可运行状态、僵死状态等等的话，子进程将被 init 进程手痒，从而成为孤儿进程。</li>
<li>子进程死亡时（处于“终止状态”），父进程没有及时调用 wait() 或 waitpid() 来返回死亡进程的相关信息，此时子进程还有一个 PCB 残留在进程表中，被成为僵尸进程。</li>
</ul>
<h2 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h2><blockquote>
<p>不依赖终端 (tty) 的进程，不会因为用户退出终端而停止运行的进程。实现思路如下：</p>
</blockquote>
<ol>
<li>创建一个进程 A。</li>
<li>在进程 A 中创建进程 B，可以使用 child_process.fork 或其他方法。</li>
<li>启动子进程时，设置 detached 属性为 true，保证子进程在父进程退出后继续运行。</li>
<li>进程 A 退出，进程 B 由 init 进程接管。此时进程 B 为守护进程。</li>
</ol>
<h2 id="粘包问题"><a href="#粘包问题" class="headerlink" title="粘包问题"></a>粘包问题</h2><blockquote>
<p>默认情况下，TCP 连接会采用延迟传送算法（Nagle 算法），在数据发送之前缓存他们。如果短时间有多个数据发送，会缓冲到一起作一次发送（缓冲大小是 socket.bufferSize），这样可以减少 IO 消耗提高性能。（TCP 有这个问题，HTTP 协议已解决）。解决方法如下：</p>
</blockquote>
<ul>
<li>多次发送之前间隔一个等待时间：处理简单，但是影响传输效率。</li>
<li>关闭 Nagle 算法：消耗资源高，整体性能下降。</li>
<li>封包&#x2F;拆包：使用一些有标识来进行封包拆包（类似 HTTP 协议头尾）。</li>
</ul>
<h2 id="cookie、session"><a href="#cookie、session" class="headerlink" title="cookie、session"></a>cookie、session</h2><ul>
<li>session 存在服务端，cookie 存在客户端。session 比 cookie 更安全，而且 cookie 不一定一直能用（可能被浏览器禁止）。服务端可以通过设 cookie 的值为空并设置一个及时的 expires 来清除存在客户端上的 cookie。</li>
<li>cookie 可能会包含一些关键信息，而 session 一般都是一个加密串。</li>
</ul>
<h2 id="hosts-文件"><a href="#hosts-文件" class="headerlink" title="hosts 文件"></a>hosts 文件</h2><blockquote>
<p>一个没有扩展名的系统文件，作用是将网址域名和对应的 IP 地址建立一个关联“数据库”。当用户在浏览器中输入一个 url 时，系统会先从 hosts 文件中寻找对应的 IP 地址。</p>
</blockquote>
]]></content>
      <categories>
        <category>面试题库</category>
      </categories>
      <tags>
        <tag>面试题库</tag>
      </tags>
  </entry>
  <entry>
    <title>面试题之基础篇</title>
    <url>/2020/03/22/12-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%AF%87/</url>
    <content><![CDATA[<h1 id="一、HTML、CSS"><a href="#一、HTML、CSS" class="headerlink" title="一、HTML、CSS"></a>一、HTML、CSS</h1><ul>
<li><strong>语义化理解</strong>：使用合理标签来创建页面内容，让页面结构更清晰。好处是便于浏览器和搜索引擎解析，提高代码的可读性和重用性。</li>
<li><strong>CSS 盒模型</strong>：width&#x2F;height 设置的宽高只是指 content、盒子宽高 &#x3D;&#x3D; 内容 + 填充 + 边距 + 边框、标准盒模型 box-sizing: content-box、IE 盒模型 box-sizing: border-box。</li>
<li><strong>图片加载优化</strong>：可视区域的图片懒加载 (按需加载)、前后图片的预加载 (页面加载完成之前下载所需资源，使用时从缓存中调用) 、使用雪碧图。</li>
<li><strong>WebP</strong>：谷歌开发的一种支持有损压缩和无损压缩的新图片格式，优点是相同质量的图片拥有更小的文件体积，非常适合于网络图片的传输。</li>
<li><strong>header token 为何不会被劫持</strong>：token 不是防止 XSS 而是为了防止 CSRF、CSRF 攻击的原因是浏览器会自动带上 cookie 而浏览器不会自动带上 token。</li>
<li><strong>宽高覆盖规则</strong>：min-width &gt; max-width &gt; width，即使设置了行内样式或 !important。</li>
<li><strong>性能指标</strong>：FP 首次绘制、FCP 首次内容绘制、LCP 最大内容绘制时间、FPS 每秒传输帧数、TTI 页面可交互时间、HTTP 请求响应时间、DNS 解析时间、TCP 连接时间</li>
</ul>
<h2 id="link、-import-导入"><a href="#link、-import-导入" class="headerlink" title="link、@import 导入"></a>link、@import 导入</h2><ul>
<li><strong>从属关系</strong>：@import 只能用于加载 CSS，link 是 XHTML 标签，它还可以定义 RSS、rel 连接属性、引入网站图标等。</li>
<li><strong>加载顺序</strong>：加载页面时，link 引入的 CSS 被同时加载，@import 引入的 CSS 会等到页面被全部加载完成后再加载。</li>
<li><strong>兼容性</strong>：link 无兼容性问题，@import 只有 IE5+ 才能被识别。</li>
</ul>
<h2 id="HTML5-form-自动完成"><a href="#HTML5-form-自动完成" class="headerlink" title="HTML5 form 自动完成"></a>HTML5 form 自动完成</h2><ul>
<li><strong>autocomplete</strong> 属性规定表单是否应该启用自动完成功能，它自动完成允许浏览器预测对输入字段。在用户在开始键入时，浏览器基于之前键入过的值显示出历史选项。</li>
<li>关闭自动完成功能的方法：IE Internet 选项菜单的内容–自动完成设置、form autocomplete&#x3D;”off” 关闭整个表单的自动提示功能、input autocomplete&#x3D;”off” 关闭输入框的自动完成功能。</li>
</ul>
<h2 id="浏览器渲染"><a href="#浏览器渲染" class="headerlink" title="浏览器渲染"></a>浏览器渲染</h2><blockquote>
<p>渲染引擎为了更好的用户体验会尽快将内容呈现到屏幕，它是解析完一部分内容就会显示而不会等到所有内容解析完成之后再去构建 render tree。</p>
</blockquote>
<ol>
<li>解析 HTML 标记并构建 <strong>DOM 树</strong>。</li>
<li>解析 CSS 标记并构建 <strong>CSSOM 树</strong>。</li>
<li>根据 DOM、CSSOM 构建<strong>渲染树</strong>，节点是包含颜色等属性的渲染对象。</li>
<li><strong>布局</strong>：根据渲染树进行布局，计算各个节点在页面的位置、大小等信息。</li>
<li><strong>绘制</strong>：调用渲染对象的 paint 方法，将它们的内容显示在屏幕并绘制基础组件。</li>
</ol>
<h2 id="浏览器通信"><a href="#浏览器通信" class="headerlink" title="浏览器通信"></a>浏览器通信</h2><blockquote>
<p>由于标签页之间无法直接通信，它们的通信本质都是通过中介者转发消息来实现的。</p>
</blockquote>
<ol>
<li><strong>Websocket</strong>：通信的标签页连接同一个服务器，服务器将收到的消息推送给所有客户端。</li>
<li><strong>localStorage</strong>：localStorage 在浏览上下文中新增&#x2F;修改&#x2F;删除时会触发 storage 事件。</li>
<li><strong>SharedWorker</strong>：服务器注册一个 onmessage 监听信息的事件，客户端(即使用 sharedWorker 的标签页)发送 message 时就会触发。</li>
</ol>
<h2 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h2><ul>
<li>缓存类型：根据响应头内容分为强制缓存和协商缓存，优先级顺序依次为 <strong>cache-control、Expires、Etag、Last-modified</strong>。</li>
<li>缓存位置：<strong>Service Worker</strong> (运行在浏览器背后的独立线程)、<strong>Memory Cache</strong> (包含页面资源的内存缓存，关闭页面则释放)、<strong>Disk Cache</strong> (存储在硬盘)、<strong>Push Cache</strong> (会话缓存)。</li>
<li>缓存过程：浏览器在缓存中查找请求结果和缓存标识后发起请求，将返回结果存入缓存并根据响应头内容进行相应处理。</li>
</ul>
<h2 id="CSRF-攻击"><a href="#CSRF-攻击" class="headerlink" title="CSRF 攻击"></a>CSRF 攻击</h2><ul>
<li><strong>实现</strong>：跨站请求伪造攻击，攻击者诱导用户进入一个第三方网站，然后该网站向被攻击网站发送跨站请求。如果用户在被攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态（cookie），绕过后台的用户验证，冒充用户向服务器执行一些操作。</li>
<li><strong>本质</strong>：利用 cookie 会在同源请求中携带发送给服务器的特点来实现冒充用户。</li>
<li><strong>防护方法</strong>：同源检测和服务器检测请求来源、使用 token 验证、设置 cookie 时设置 Samesite 并限制为不能作为被第三方使用。</li>
</ul>
<h2 id="CSP-内容安全策略"><a href="#CSP-内容安全策略" class="headerlink" title="CSP 内容安全策略"></a>CSP 内容安全策略</h2><ul>
<li><strong>实现</strong>：本质是建立一个白名单，告诉浏览器哪些外部资源可以加载和执行。我们只需要配置规则，如何拦截由浏览器自己来实现。它也是解决 XSS 攻击的一个强力手段。</li>
<li><strong>开启</strong>：一种是设置 <code>HTTP 头部 Content-Security-Policy</code>，一种是设置 <code>meta 标签 &lt;meta http-equiv=&quot;Content-Security-Policy&quot;&gt;</code>。</li>
</ul>
<h2 id="PWA-渐进式网页应用"><a href="#PWA-渐进式网页应用" class="headerlink" title="PWA 渐进式网页应用"></a>PWA 渐进式网页应用</h2><blockquote>
<p>Progressive Web App 是一个让普通站点过渡到 Web 应用的渐进式过渡方案。目的是降低站点改造代价并逐渐支持新技术，从而提升性能和改善用户体验。</p>
</blockquote>
<ul>
<li>可安装：可以像原生 APP 在主屏幕上留有图标。</li>
<li>支持离线存储和消息推送：运行在浏览器进程的 ServiceWorker 能够为所有页面提供服务。</li>
<li>ServiceWorker：本质是一段在后台运行的脚本。作为一个运行环境不同于普通脚本的独立线程，不能直接参与 Web 交互行为，属于一种客户端代理。</li>
</ul>
<h2 id="HTTPS-让数据传输更安全"><a href="#HTTPS-让数据传输更安全" class="headerlink" title="HTTPS 让数据传输更安全"></a>HTTPS 让数据传输更安全</h2><ul>
<li>TCP、HTTP 之间插入一个安全层，所有经过安全层的数据都会被加密或解密。</li>
<li>对称加密：浏览器发送加密套件列表和一个随机数，服务器从列表选取一个加密套件并生成一个随机数返回，然后通过相同方法将两个随机数混合生成一个密钥后进行数据加密。缺点是随机数的过程都是明文，黑客可以拿到协商的加密套件和随机数，生成密钥并破解数据。</li>
<li>非对称加密：浏览器发送加密套件列表，服务器选择一个加密套件返回加密套件和公钥，浏览器用公钥加密数据，服务器用私钥解密。缺点是加密效率太低，不能保证服务器发送给浏览器的数据安全，黑客可以获取公钥。</li>
<li>对称加密结合非对称加密：浏览器发送对称加密套件列表、非对称加密列表和随机数，服务器生成随机数并选择加密套件和公钥返回，浏览器通过随机数计算出 pre-master 并利用公钥给 pre-master 加密后发送，服务器用私钥解密出 pre-master 数据并结合随机数生成对称密钥，使用对称密钥传输加密数据。</li>
<li>数字证书：用于向浏览器证明服务器的身份或用于服务器公钥。CA 使用 Hash 函数技术明文信息得出信息摘要，然后 CA 使用私钥对信息摘要加密后的秘文就是数字签名。验证是否合法时，读取证书明文信息并将相同 Hash 函数计算得到的信息摘要 A 和 CA 公钥解密得到的 B 进行对比，一致则确认证书合法。</li>
</ul>
<h2 id="沙盒隔离页面和系统"><a href="#沙盒隔离页面和系统" class="headerlink" title="沙盒隔离页面和系统"></a>沙盒隔离页面和系统</h2><ul>
<li>浏览器被划分为浏览器内核和渲染内核两个核心模块，其中浏览器内核由网络进程、浏览器主进程和 GPU 进程组成的，渲染内核就是渲染进程。</li>
<li>浏览器中的安全沙箱是利用操作系统提供的安全技术，让渲染进程在执行过程中无法访问或者修改操作系统中的数据，在渲染进程需要访问系统资源时需要通过浏览器内核来实现，然后将访问的结果通过 IPC 转发给渲染进程。</li>
<li>站点隔离（Site Isolation）将同一站点（包含相同根域名和相同协议的地址）中相互关联的页面放到同一个渲染进程中执行，这样就可以将恶意的 iframe 隔离在恶意进程内部而无法继续访问其他 iframe 进程的内容，因此无法攻击其他站点。</li>
</ul>
<h2 id="移动端适配方案"><a href="#移动端适配方案" class="headerlink" title="移动端适配方案"></a>移动端适配方案</h2><ul>
<li><strong>viewport 缩放</strong>：针对不同分辨率的手机设置等比例缩放，但是 PC 端可能会界面变形。</li>
<li><strong>响应式布局</strong>：通过媒体查询根据不同分辨率适配，但代码可维护性差，适用于简单页面。</li>
<li><strong>弹性布局</strong>：使容器子元素的宽高能够合理填充空间，可通过百分比、vw + vh、rem。</li>
<li><strong>vue 方案</strong>：通过 vw 实现适配，安装插件 postcss-px-to-viewport 并配置即可。</li>
</ul>
<h2 id="BFC-及其应用"><a href="#BFC-及其应用" class="headerlink" title="BFC 及其应用"></a>BFC 及其应用</h2><ul>
<li><strong>简单介绍</strong>：Block Format Context 块级格式化上下文，是页面盒模型的一种 CSS 渲染模式，相当于一个独立容器，里面的元素和外部的元素相互不影响。</li>
<li><strong>创建方式</strong>：html 根元素、float、position: absolute&#x2F;fixed、overflow: !visible、display: inline-block&#x2F;table&#x2F;flex。</li>
<li><strong>主要作用</strong>：清除浮动、不同 BFC 时可以阻止 margin 重叠。</li>
</ul>
<h2 id="重绘、回流"><a href="#重绘、回流" class="headerlink" title="重绘、回流"></a>重绘、回流</h2><ul>
<li><strong>重绘重排</strong><ul>
<li>重绘：简单外观的改变而不会影响布局，比如 outline、visibility、color。</li>
<li>回流：布局或几何属性改变而重新计算布局，大部分都会会导致页面的重新渲染。</li>
<li>关系：重绘不一定会引发回流，回流必定会发生重绘，它们都会重新生成渲染树。</li>
</ul>
</li>
<li><strong>优化方案</strong><ul>
<li><strong>JS</strong>：避免频繁操作 DOM、缓存频繁读取的属性值、对复杂动画的元素使用定位。</li>
<li><strong>CSS</strong>：CSS 硬件加速、尽量在 DOM 树的最末端改变 class、避免使用 CSS 表达式而导致回流、避免设置多层内联样式而提高 CSS 选择符从右往左匹配查找速度、将动画效果应用到定位元素而避免影响其他布局。</li>
</ul>
</li>
</ul>
<h2 id="Web-性能优化"><a href="#Web-性能优化" class="headerlink" title="Web 性能优化"></a>Web 性能优化</h2><ul>
<li><strong>减少请求量</strong>：合并资源、减少 HTTP 请求、gzip 压缩、WebP 图片、路由懒加载。</li>
<li><strong>加快请求速度</strong>：预解析 DNS、减少域名数、并行加载、CDN 分发。 </li>
<li><strong>资源预加载</strong>：支持预拉取图片、脚本以及任何可以被浏览器缓存的资源。</li>
<li><strong>渲染优化</strong>：静态渲染 SR、前端渲染 CSR、服务端渲染 SSR、客户端渲染 NSR。</li>
<li><strong>特效优化</strong>：合理利用 CSS 合成动画而避免重绘、将动画效果应用到定位元素。</li>
</ul>
<h2 id="opacity、visibility、display"><a href="#opacity、visibility、display" class="headerlink" title="opacity、visibility、display"></a>opacity、visibility、display</h2><ul>
<li><strong>opacity: 0</strong>：占据空间，可以点击，引起重绘，子元素不影响。</li>
<li><strong>display: none</strong>：不占空间，不能点击，会引起回流，子元素不影响。</li>
<li><strong>visibility: hidden</strong>：占据空间，不能点击，引起重绘，子元素可设置 visible 进行显示。</li>
</ul>
<h2 id="Rem-及其原理"><a href="#Rem-及其原理" class="headerlink" title="Rem 及其原理"></a>Rem 及其原理</h2><ul>
<li><strong>Rem</strong>：CSS3 新增的相对长度单位，指相对于根元素 html 的 font-size 大小，移动端新型浏览器支持较好。px 是相对固定单位，无法随着浏览器进行缩放。</li>
<li><strong>转换原理</strong>：默认根元素的 font-size: 16px，如果想要设置为 12px 则就是 12px&#x2F;16px &#x3D; 0.75rem。通过 postcss-px-to-viewport 插件可以实现对 px 到 vw 的自动转换。</li>
</ul>
<h2 id="移动端视口配置"><a href="#移动端视口配置" class="headerlink" title="移动端视口配置"></a>移动端视口配置</h2><ul>
<li><strong>initial-scale</strong>: 初始的缩放比例。</li>
<li><strong>minimum-scale</strong>: 允许用户缩放到的最小比例。</li>
<li><strong>maximum-scale</strong>: 允许用户缩放到的最大比例。</li>
<li><strong>user-scalable</strong>: 用户是否可以手动缩放。</li>
</ul>
<h2 id="伪类和伪元素"><a href="#伪类和伪元素" class="headerlink" title="伪类和伪元素"></a>伪类和伪元素</h2><ul>
<li><strong>伪类</strong>：用于为处于某种状态的已有元素添加样式，该状态是随着用户行为变化的。比如说 :hover。它只有处于 dom 树无法描述的状态才能为元素添加样式，所以称为伪类。</li>
<li><strong>伪元素</strong>：用于创建一些原本不在文档树中的元素，并为其添加样式。比如 ::before，虽然用户可以看到这些内容，但是其实它不在文档树中。</li>
<li><strong>区别</strong>：伪类的操作对象是文档树中已存在的元素，而伪元素是创建一个文档树外的元素。css 规范规定使用双冒号 :: 表示伪元素，一个冒号 : 表示伪类。</li>
</ul>
<h2 id="css-可继承属性"><a href="#css-可继承属性" class="headerlink" title="css 可继承属性"></a>css 可继承属性</h2><ul>
<li><strong>字体系列属性</strong>：font-family、font-size、font-weight、font-style。</li>
<li><strong>文本系列属性</strong>：text-indent、text-align、line-hight、word-spacing、color。</li>
<li><strong>其他</strong>：cursor、visibility。</li>
</ul>
<h1 id="二、JS"><a href="#二、JS" class="headerlink" title="二、JS"></a>二、JS</h1><ul>
<li><strong>JS 特性</strong>：运行在客户端浏览器、不用预编译而直接解析执行代码、弱类型语言而较为灵活、跨平台的语言而与操作系统无关、脚本语言、解释性语言。</li>
<li><strong>变量提升</strong>：JS 代码执行前需要先编译，在编译阶段将变量设为 undefined 并和函数存到变量环境 (重复则被覆盖)，JS 引擎会在代码执行阶段从变量环境中查找自定义的变量和函数。</li>
<li><strong>变量执行</strong>：JS 引擎使用变量时会在当前的执行上下文中查找变量，没有找到则会继续在作用域链指向的执行上下文中查找。函数总是可以访问其外部函数中声明的变量，当在函数内调用一个外部函数时引用的变量会一直保存在内存，这些变量的集合称为闭包。</li>
<li><strong>闭包</strong>：指能够读取其他函数内部变量的函数，用来实现私有的方法和变量。主要特点有：函数嵌套函数、函数内部引用外部的参数和变量、参数和变量不会被垃圾回收机制回收。优点是可以避免全局变量的污染，缺点是闭包会常驻内存而容易造成内存泄漏。</li>
<li><strong>块级作用域</strong>：let&#x2F;const 变量不会被提升而是在编译后保存到词法环境的一个单独栈区域，作用域内部变量压入栈顶并在作用域执行完后从栈顶弹出。</li>
<li><strong>new 操作符</strong>：新建一个原型 <code>__proto__</code> 指向构造函数 prototype 的空对象，然后将这个新对象赋值给构造函数 this 指向并在执行构造函数后返回。</li>
<li><strong>自执行函数</strong>：声明并立刻调用的匿名函数，用来创建一个独立的作用域，一般用于框架、插件等场景。好处如下：防止变量扩散到全局而造成冲突、隔离作用域避免闭包造成引用变量无法释放、利用立即执行特性返回需要的函数或对象而避免每次通过条件判断处理。</li>
<li><strong>尾调用优化</strong>：指函数的最后一步调用另一个函数。代码执行是基于执行栈的，所以在一个函数里调用另一个函数时，会保留当前的执行上下文并新建另外一个加入栈中。使用尾调用时则不必再保留当前的执行上下文，从而节省了内存，这就是尾调用优化。ES6 的尾调用优化只在严格模式下开启，正常模式是无效的。</li>
<li><strong>Babel 实现 ES6 转为 ES5</strong>：将代码字符串解析成抽象语法树 ES6 AST、处理后转换为 ES5 AST、通过新语法树生成代码字符串。</li>
<li><strong>事件委托</strong>：将原本需要绑定在子元素的监听事件委托给父元素，通过 DOM 元素的事件冒泡机制实现父元素监听到子元素上事件的触发，特别适用于动态元素的绑定。</li>
<li><strong>事件冒泡</strong>：一个事件触发后会在子元素和父元素之间分为三个阶段传播：捕获阶段(window 对象传导到目标节点，不响应任何事件)、目标阶段(在目标节点上触发)，冒泡阶段(从目标节点传导回 window 对象)。</li>
<li><strong>面向对象思想</strong>：将问题分解并抽象为一个个具体对象，并且将对象及其公共的属性和方法封装成一个类，整个程序由对象之间的分工和合作完成。主要特点有封装 (通过对象相互访问)、继承 (从已有对象上继承出新对象)、多态 (多对象的不同形态)，极大提高了程序的复用性性和可维护性。核心在于类的实现：js 基于 function 模拟类，通过 prototype 属性实现类方法的共享，ES6 class 是定义类的一个语法糖，通过 extends 继承父类。</li>
</ul>
<h2 id="JS-编译"><a href="#JS-编译" class="headerlink" title="JS 编译"></a>JS 编译</h2><ul>
<li><strong>两种计算机语言</strong>：编译型语言经过编译器编译后保留机器能读懂的二进制文件，比如 C&#x2F;C++、go。解释型语言是在程序运行时通过解释器对程序进行动态解释和执行，比如 Python、JavaScript。</li>
<li><strong>编译过程</strong>：编译型语言编译器首先将代码进行词法分析和语法分析并生成抽象语法树 AST，编译型语言和最后会被分别处理为机器码和字节码。</li>
<li><strong>字节码</strong>：直接将 AST 转化为机器码时执行效率是非常高但是会消耗大量内存，可以通过转化为字节码解决内存问题，字节码配合解释器和编译器的计数实现称为即时编译 JIT。</li>
</ul>
<h2 id="类型判断"><a href="#类型判断" class="headerlink" title="类型判断"></a>类型判断</h2><ul>
<li><strong>typeof</strong>：判断所有的基本数据类型，返回一个字符串。</li>
<li><strong>instanceOf</strong>：判断一个对象是否某构造函数的实例，返回值为 true&#x2F;false。</li>
<li><strong>constructor</strong>：返回一个对象具体的构造函数，比如 Array、Function、Map。</li>
<li>**Object.prototype.toString.call()**：对象的一个原型扩展函数，可以判断所有数据类型。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 6 种原始数据类型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="string">&#x27;a&#x27;</span>);   <span class="comment">// &quot;string&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="number">1</span>);     <span class="comment">// &quot;number&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">true</span>);  <span class="comment">// &quot;boolean&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Symbol</span>());  <span class="comment">// &quot;symbol&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">undefined</span>); <span class="comment">// &quot;undefined&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">null</span>);  <span class="comment">// &quot;object&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> &#123;&#125;);    <span class="comment">// &quot;object&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> []);    <span class="comment">// &quot;object&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Map</span>());  <span class="comment">// &quot;object&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Set</span>());  <span class="comment">// &quot;object&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function 类型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;); <span class="comment">// &quot;function&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Apple</span> () &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> fun = <span class="keyword">new</span> <span class="title class_">Function</span>();</span><br><span class="line"><span class="keyword">let</span> apple = <span class="keyword">new</span> <span class="title class_">Apple</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fun <span class="keyword">instanceof</span> <span class="title class_">Function</span>);    <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(apple <span class="keyword">instanceof</span> <span class="title class_">Apple</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(apple <span class="keyword">instanceof</span> <span class="title class_">Function</span>);  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] <span class="keyword">instanceof</span> <span class="title class_">Array</span>);   <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] <span class="keyword">instanceof</span> <span class="title class_">Object</span>);  <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125; <span class="keyword">instanceof</span> <span class="title class_">Object</span>);  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Map</span>() <span class="keyword">instanceof</span> <span class="title class_">Map</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Map</span>() <span class="keyword">instanceof</span> <span class="title class_">Object</span>);  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fun.<span class="property">constructor</span> === <span class="title class_">Function</span>);    <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(apple.<span class="property">constructor</span> === <span class="title class_">Apple</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(apple.<span class="property">constructor</span> === <span class="title class_">Function</span>);  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([].<span class="property">constructor</span> === <span class="title class_">Array</span>);   <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([].<span class="property">constructor</span> === <span class="title class_">Object</span>);  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Map</span>().<span class="property">constructor</span> === <span class="title class_">Map</span>);    <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Map</span>().<span class="property">constructor</span> === <span class="title class_">Object</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125;.<span class="property">constructor</span> === <span class="title class_">Object</span>);  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(fun));        <span class="comment">// &quot;[object Function]&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(apple));      <span class="comment">// &quot;[object Object]&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>([]));         <span class="comment">// &quot;[object Array]&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Map</span>()));  <span class="comment">// &quot;[object Map]&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(&#123;&#125;));         <span class="comment">// &quot;[object Object]&quot;</span></span><br></pre></td></tr></table></figure>


<h2 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h2><ul>
<li><strong>运算符转换</strong>：-、*、&#x2F;、% 会转换为数字后计算，+ 则进行数字相加或字符串拼接。</li>
<li><strong>双等号转换</strong>：两边会转换为同一类型再进行比较，有一个 NaN 则返回 false。</li>
<li><strong>点号操作符</strong>：数字、字符串等通过点调用方法时，隐式地将类型转换成对象。</li>
<li><strong>if() 语句</strong>：括号里的表达式部分会被隐式转换为布尔类型进行判断。</li>
</ul>
<h2 id="小数精度丢失"><a href="#小数精度丢失" class="headerlink" title="小数精度丢失"></a>小数精度丢失</h2><blockquote>
<p>有些小数在计算机使用二进制方式表示时无法准确表示，类似于十进制的 1&#x2F;3 无理数、无限循环。但是计算机存储小数的类型不管是 float&#x2F;double 都是有位数限制的，所以它们存储的只是一个近似值，这就导致了精度丢失。解决办法如下：</p>
</blockquote>
<ul>
<li>整数的出现问题几率较低，毕竟很少有业务需要用到超大整数，只要运算结果不超过 <strong>Math.pow(2, 53)</strong> 就不会丢失精度。</li>
<li>小数的出现问题几率很大，尤其是一些电商网站的金额等数据。解决方式：把小数放到位整数（乘倍数），再缩小回原来倍数（除倍数）。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// true, false</span></span><br><span class="line"><span class="keyword">var</span> two   = <span class="number">0.2</span></span><br><span class="line"><span class="keyword">var</span> one   = <span class="number">0.1</span></span><br><span class="line"><span class="keyword">var</span> eight = <span class="number">0.8</span></span><br><span class="line"><span class="keyword">var</span> six   = <span class="number">0.6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(two - one == one, eight - six == two)</span><br><span class="line"></span><br><span class="line"><span class="comment">// floatObj：包含加减乘除四个方法，确保浮点数运算不丢失精度</span></span><br><span class="line"><span class="keyword">var</span> floatObj = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断obj是否为一个整数</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isInteger</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(obj) === obj</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 将一个浮点数转成整数，返回整数和倍数。如 3.14 &gt;&gt; 314，倍数是 100</span></span><br><span class="line"><span class="comment">    * @param floatNum &#123;number&#125; 小数</span></span><br><span class="line"><span class="comment">    * @return &#123;object&#125;</span></span><br><span class="line"><span class="comment">    *   &#123;times:100, num: 314&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">toInteger</span>(<span class="params">floatNum</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> ret = &#123;<span class="attr">times</span>: <span class="number">1</span>, <span class="attr">num</span>: <span class="number">0</span>&#125;</span><br><span class="line">      <span class="keyword">var</span> isNegative = floatNum &lt; <span class="number">0</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isInteger</span>(floatNum)) &#123;</span><br><span class="line">          ret.<span class="property">num</span> = floatNum</span><br><span class="line">          <span class="keyword">return</span> ret</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> strfi  = floatNum + <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">var</span> dotPos = strfi.<span class="title function_">indexOf</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">      <span class="keyword">var</span> len    = strfi.<span class="title function_">substr</span>(dotPos+<span class="number">1</span>).<span class="property">length</span></span><br><span class="line">      <span class="keyword">var</span> times  = <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, len)</span><br><span class="line">      <span class="keyword">var</span> intNum = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(floatNum) * times + <span class="number">0.5</span>, <span class="number">10</span>)</span><br><span class="line">      ret.<span class="property">times</span>  = times</span><br><span class="line">      <span class="keyword">if</span> (isNegative) &#123;</span><br><span class="line">          intNum = -intNum</span><br><span class="line">      &#125;</span><br><span class="line">      ret.<span class="property">num</span> = intNum</span><br><span class="line">      <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 核心方法，实现加减乘除运算，确保不丢失精度</span></span><br><span class="line"><span class="comment">    * 思路：把小数放大为整数（乘），进行算术运算，再缩小为小数（除）</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @param a &#123;number&#125; 运算数1</span></span><br><span class="line"><span class="comment">    * @param b &#123;number&#125; 运算数2</span></span><br><span class="line"><span class="comment">    * @param digits &#123;number&#125; 精度，保留的小数点数，比如 2, 即保留为两位小数</span></span><br><span class="line"><span class="comment">    * @param op &#123;string&#125; 运算类型，有加减乘除（add/subtract/multiply/divide）</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">operation</span> (a, b, digits, op) &#123;</span><br><span class="line">    <span class="keyword">var</span> o1 = <span class="title function_">toInteger</span>(a)</span><br><span class="line">    <span class="keyword">var</span> o2 = <span class="title function_">toInteger</span>(b)</span><br><span class="line">    <span class="keyword">var</span> n1 = o1.<span class="property">num</span></span><br><span class="line">    <span class="keyword">var</span> n2 = o2.<span class="property">num</span></span><br><span class="line">    <span class="keyword">var</span> t1 = o1.<span class="property">times</span></span><br><span class="line">    <span class="keyword">var</span> t2 = o2.<span class="property">times</span></span><br><span class="line">    <span class="keyword">var</span> max = t1 &gt; t2 ? t1 : t2</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">switch</span> (op) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> (t1 === t2) &#123;  <span class="comment">// 两个小数位数相同</span></span><br><span class="line">                result = n1 + n2</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t1 &gt; t2) &#123;  <span class="comment">// o1 小数位 大于 o2</span></span><br><span class="line">                result = n1 + n2 * (t1 / t2)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;          <span class="comment">// o1 小数位 小于 o2</span></span><br><span class="line">                result = n1 * (t2 / t1) + n2</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result / max</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;subtract&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> (t1 === t2) &#123;</span><br><span class="line">                result = n1 - n2</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t1 &gt; t2) &#123;</span><br><span class="line">                result = n1 - n2 * (t1 / t2)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result = n1 * (t2 / t1) - n2</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result / max</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;multiply&#x27;</span>:</span><br><span class="line">            result = (n1 * n2) / (t1 * t2)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;divide&#x27;</span>:</span><br><span class="line">            result = (n1 / n2) * (t2 / t1)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 加减乘除的四个接口</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b, digits</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">operation</span>(a, b, digits, <span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">subtract</span>(<span class="params">a, b, digits</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">operation</span>(a, b, digits, <span class="string">&#x27;subtract&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">multiply</span>(<span class="params">a, b, digits</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">operation</span>(a, b, digits, <span class="string">&#x27;multiply&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">divide</span>(<span class="params">a, b, digits</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">operation</span>(a, b, digits, <span class="string">&#x27;divide&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// exports</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">add</span>: add,</span><br><span class="line">    <span class="attr">subtract</span>: subtract,</span><br><span class="line">    <span class="attr">multiply</span>: multiply,</span><br><span class="line">    <span class="attr">divide</span>: divide</span><br><span class="line">  &#125;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>


<h2 id="JS-继承模式"><a href="#JS-继承模式" class="headerlink" title="JS 继承模式"></a>JS 继承模式</h2><blockquote>
<p>按照几种继承模式的从最次的继承模式到最佳的继承模式的顺序去讲，讲出当前这种继承模式的利弊和相对前一种继承模式解决了什么问题，最关键的代码部分在哪里。</p>
</blockquote>
<ul>
<li><strong>原型链继承</strong><ul>
<li>实现：将子类的原型指向父类的实例，从而继承父类的私有属性和原型属性。</li>
<li>优点：子类实例能访问到父类新增的原型属性和方法、简单易用。</li>
<li>缺点：无法实现多继承(一个子类继承多个父类)、创建子类实例时无法向父类构造函数传参、存在子类实例共享父类引用属性而相互影响的问题。</li>
</ul>
</li>
<li><strong>父类构造函数继承</strong><ul>
<li>实现：子类构造函数中通过 call&#x2F;apply 调用父类构造函数来实现父类私有属性继承。</li>
<li>优点：可以实现多继承、创建子类实例时可以向父类传递参数、解决了原型链继承中子类实例共享父类引用属性的问题(引用类型数据会重新创建一份)。</li>
<li>缺点：每次创建子类实例时都要调用一次父类构造函数而影响性能、只继承父类的实例属性(私有属性)而没有继承父类的原型属性。</li>
</ul>
</li>
<li><strong>组合式继承 (原型链 + 构造函数)</strong><ul>
<li>实现：通过调用父类构造函数继承父类的属性并保留传参的优点，并通过 Object.create(Parent.prototype) 来创建继承了父类属性的对象并赋给子类原型，这样既让父类构造函数不用执行两次，又让子类继承了父类的原型方法。</li>
<li>本质：先创建子类的实例对象 this，然后通过 Parent.apply(this) 添加父类方法。</li>
<li>优点：构造函数继承的所有优点、父类构造函数只用执行一次。</li>
</ul>
</li>
<li><strong>ES6 class 继承</strong><ul>
<li>实现：使用 extends 关键字继承父类的原型属性，使用 static 关键字定义类的静态方法，调用 super 来继承父类的实例属性并且可以传参。</li>
<li>本质：先将父类实例对象的属性和方法添加到 this (所以必须先调用 super 方法)，然后再通过子类的构造函数修改 this。</li>
<li>优点：简单易用，不需要直接修改原型链来完成继承。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 组合式继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span> (sex) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sex</span> = sex</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setSex</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span> (name, age, sex) &#123;</span><br><span class="line">    <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, sex)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Son</span></span><br><span class="line"><span class="keyword">var</span> s1 = <span class="keyword">new</span> <span class="title class_">Son</span>(<span class="string">&#x27;Tony&#x27;</span>, <span class="number">25</span>, <span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 class 继承</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> (sex) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sex</span> = sex</span><br><span class="line">    &#125;</span><br><span class="line">    showSex () &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;父类方法&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> (name, age, sex) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(sex)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">    &#125;</span><br><span class="line">    showSex () &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;子类方法&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">new</span> <span class="title function_">B</span>(<span class="string">&#x27;Tony&#x27;</span>, <span class="number">25</span>, <span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br></pre></td></tr></table></figure>


<h2 id="this-指向"><a href="#this-指向" class="headerlink" title="this 指向"></a>this 指向</h2><blockquote>
<p>this 代表当前方法执行时自动生成的一个上下文对象。</p>
</blockquote>
<ul>
<li>元素绑定事件：指向当前操作的元素。</li>
<li>普通函数：指向点前面的对象，没有点则指向 window (js 严格模式下是 undefined)。</li>
<li>构造函数：指向生成的对象实例，而且 this 指向无法改变。new 的过程是在内部新建一个空对象，添加构造函数的属性和方法并返回该对象。</li>
<li>箭头函数：指向定义时所在的对象，因为它没有自身的 this，使用的是外层 this。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 普通函数</span></span><br><span class="line"><span class="keyword">let</span> fn = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) &#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;哈哈哈&#x27;</span>, <span class="attr">fn</span>: fn &#125;</span><br><span class="line"><span class="title function_">fn</span>();       <span class="comment">// window</span></span><br><span class="line">obj.<span class="title function_">fn</span>();   <span class="comment">// obj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span> (name, age) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)  <span class="comment">// p：&#123;name: &quot;Tom&quot;, age: 20&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Tony&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="function">()=&gt;</span>&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) &#125;,       <span class="comment">// Window</span></span><br><span class="line">    <span class="attr">b</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) &#125;  <span class="comment">// obj</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="各种位置"><a href="#各种位置" class="headerlink" title="各种位置"></a>各种位置</h2><ul>
<li><strong>offsetHeight</strong>：表示可视区域的高度，包含边框和滚动条。</li>
<li><strong>clientHeight</strong>：表示可视区域的高度，不包含边框和滚动条。</li>
<li><strong>scrollHeight</strong>：表示所有区域的高度，包含因为滚动被隐藏的部分。 </li>
<li><strong>clientTop</strong>：表示边框厚度，在未指定的情况下默认为 0。</li>
<li><strong>scrollTop</strong>：滚动后被隐藏的高度，相对于 offsetParent 父坐标距离顶端的高度。</li>
</ul>
<h2 id="防抖和节流"><a href="#防抖和节流" class="headerlink" title="防抖和节流"></a>防抖和节流</h2><blockquote>
<p>在网页实际运行的某些场景下，有些事件会被连续触发而频繁进行 DOM 操作和资源加载，严重影响了网页性能，甚至会造成浏览器崩溃。两者都是针对连续触发的某个行为，区别在于是要优化到减少它的执行次数还是只执行一次。</p>
</blockquote>
<ul>
<li><strong>防抖</strong>：将一个弹簧连续按下但只会在最后放手的一瞬反弹，即我们希望高频事件只执行一次而实现回调函数的延时执行。常见的应用场景有：搜索框输入内容时 keyup、浏览器窗口调整时 resize。</li>
<li><strong>节流</strong>：一个水龙头在滴水时保持 一滴水&#x2F;s 的频率。即我们希望高频事件以一定频率重复调用，减少函数的执行次数。常见的应用场景有：拖拽元素时 drag、监听滚动时 scroll、鼠标移动时 mousemove、手指滑动时 touchmove。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 防抖：n 秒内高频事件再次被触发则重新执行。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">callback, delay=<span class="number">200</span></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            callback.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, delay);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> handleSeach = <span class="title function_">debounce</span>(seachAjax, <span class="number">500</span>)</span><br><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&quot;keyup&quot;</span>, <span class="function"><span class="params">e</span>=&gt;</span>&#123; <span class="title function_">handleSeach</span>(e.<span class="property">target</span>.<span class="property">value</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 节流：n 秒内只会执行一次。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">callback, duration=<span class="number">200</span></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (timer) <span class="keyword">return</span>;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            callback.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, duration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> handleScroll = <span class="title function_">throttle</span>(handleScroll)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;touchmove&quot;</span>, handleScroll);</span><br></pre></td></tr></table></figure>


<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><ul>
<li>原因：对象存储的内存空间在使用完毕后并没有重置为 null 释放，导致该内存单元在离开当前作用域前无法被释放或者被垃圾回收。</li>
<li>出现场景：setTimeout 首个参数使用字符串而非函数、闭包、意外的全局变量、未被清空的定时器、未被销毁的事件监听、DOM 引用等。</li>
<li>解决方案：不要动态绑定事件、不要给动态元素绑定事件而通过事件冒泡在父容器监听事件、动态时则必须提供 destroy 方法、尽量单例化、少创建 dom、少绑事件。</li>
</ul>
<h2 id="内存机制"><a href="#内存机制" class="headerlink" title="内存机制"></a>内存机制</h2><ul>
<li>内存：由可读写单元组成而表示一片可操作空间。</li>
<li>内存管理：JS 解释器对新建的字符串和对象动态分配一块内存空间并自动管理，但由于没有相关 API 而无法像 C&#x2F;C++ 主动调用。</li>
<li>垃圾回收机制：JS 执行引擎将垃圾占用的对象空间回收的过程。对象创建时自动分配一块内存空间，对象不再被引用或者根作用域不能被访问时会自动释放它占用的内存。</li>
</ul>
<h2 id="堆栈溢出"><a href="#堆栈溢出" class="headerlink" title="堆栈溢出"></a>堆栈溢出</h2><ul>
<li><strong>递归</strong>：指一个函数不断的调用自身。它将原来的问题转化为更小的同一问题来求解，只需要少量代码就可以完成多次重复计算，大大地减少了程序的代码量。</li>
<li><strong>堆栈溢出</strong>：JS 引擎每调用一个函数时都会为其创建执行上下文并压入调用栈，执行函数代码时如果调用其它函数则创建新函数的执行上下文并压入栈顶。每个函数通过栈分配一定空间的数据块来保存参数、返回值等临时信息，等到函数执行完成时才出栈，但是当用来分配的调用栈空间被占满时会导致数据覆盖问题，即递归中经常发生的栈溢出错误 stackOverflow。</li>
<li><strong>栈溢出的解决方案</strong>：使用闭包 (每次调用时返回一个匿名函数，相关的参数和局部变量将会被释放而不会额外增加堆栈大小)、优化调用、尾递归 (添加一个参数，记录递归次数)。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 递归示例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Fibonacci</span> (n) &#123;</span><br><span class="line">  <span class="keyword">if</span> ( n &lt;= <span class="number">2</span> ) &#123;<span class="keyword">return</span> <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Fibonacci</span>(n - <span class="number">1</span>) + <span class="title class_">Fibonacci</span>(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 栈溢出</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">factorial</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> n * <span class="title function_">factorial</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 尾递归</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">factorial</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    count ++;</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;超过了最大调用次数&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> n * <span class="title function_">factorial</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="JS-异步任务"><a href="#JS-异步任务" class="headerlink" title="JS 异步任务"></a>JS 异步任务</h2><blockquote>
<p>先主线程后异步任务队列、先微任务再宏任务。</p>
</blockquote>
<ol>
<li>JS 引擎将所有操作分为 同步任务、异步任务。</li>
<li>同步任务进入主线程，然后直接按顺序执行。</li>
<li>异步任务进入工作线程，当满足触发条件后推入任务队列。</li>
<li>事件循环机制：主线程执行完所有同步任务之后空闲时，重复去任务队列中查看是否有可执行的异步任务，有则推入主进程的执行栈。<br>1. 执行一个宏任务（栈中没有就从事件队列中获取）。<br>2. 执行过程中如果遇到微任务，就将它添加到微任务的任务队列中。<br>3. 宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）。<br>4. 当前宏任务执行完毕，开始检查渲染，然后 GUI 线程接管渲染。<br>5. 渲染完毕后，JS 线程继续接管，开始下一个宏任务（从任务队列中获取）。</li>
</ol>
<h2 id="JS-异步编程"><a href="#JS-异步编程" class="headerlink" title="JS 异步编程"></a>JS 异步编程</h2><ul>
<li><strong>回调函数</strong>：解决了同步问题但可能存在回调地狱，不能使用 try catch、return。</li>
<li><strong>Promise</strong>：同步的立即执行函数，解决了回调地狱但无法取消，需要回调函数捕获错误。</li>
<li><strong>Generator</strong>：多个线程互相协作来完成异步任务的异步编程方案，主要特点是线程 A 执行到某处之后暂停执行并等到线程 B 执行完毕后继续执行。</li>
<li><strong>Async&#x2F;Await</strong>：本质是一个自执行的 generate 函数，以同步方式实现异步代码提高了代码的可维护性，async 函数遇到 await 时会先执行异步操作并返回一个 Promise 对象。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="keyword">yield</span> x + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>(<span class="number">1</span>);</span><br><span class="line">g.<span class="title function_">next</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> g.<span class="title function_">next</span>(res)).<span class="title function_">then</span>()</span><br></pre></td></tr></table></figure>


<h2 id="apply、call、bind"><a href="#apply、call、bind" class="headerlink" title="apply、call、bind"></a>apply、call、bind</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">name</span>: <span class="string">&#x27;linxin&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span> (x, y) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) &#125;</span><br><span class="line"></span><br><span class="line">f.<span class="title function_">apply</span>(a, [<span class="number">1</span>, <span class="number">2</span>])  <span class="comment">// 参数为数组、函数直接执行</span></span><br><span class="line">f.<span class="title function_">call</span>(a, <span class="number">1</span>, <span class="number">2</span>)     <span class="comment">// 参数为值、函数直接执行</span></span><br><span class="line">f.<span class="title function_">bind</span>(a, <span class="number">1</span>, <span class="number">2</span>)()   <span class="comment">// 参数为值或数组、函数返回一个绑定新 this 的函数但不执行</span></span><br></pre></td></tr></table></figure>



<h2 id="箭头函数和普通函数"><a href="#箭头函数和普通函数" class="headerlink" title="箭头函数和普通函数"></a>箭头函数和普通函数</h2><blockquote>
<p>箭头函数是普通函数的简写，可以更优雅的定义一个函数，和普通函数的差异如下：</p>
</blockquote>
<ul>
<li>函数体内的 this 对象，是定义时所在的对象，而不是使用时所在的对象。</li>
<li>不可以使用 arguments 对象，函数体内不存在该对象但可用 rest 代替。</li>
<li>不可以使用 yield 命令，因此箭头函数不能用作 Generator 函数。</li>
<li>不可以使用 new 命令：没有自己的 this 而无法调用 call&#x2F;apply、没有 prototype 属性。</li>
</ul>
<h2 id="MVC、MVP、MVVM"><a href="#MVC、MVP、MVVM" class="headerlink" title="MVC、MVP、MVVM"></a>MVC、MVP、MVVM</h2><ul>
<li><strong>MVC</strong>：View、Model 直接绑定，因此很多 view 可以修改多个 model 而变得混乱，交互增加导致代码不好维护。</li>
<li><strong>MVP</strong>：View 绑定事件的事件驱动机制，并通过 Presenter 实现分离和通信。它定义了 View、Presenter 之间的接口，需要维护 Presenter 的内部实现。</li>
<li><strong>MVVM</strong>：View、Model 分别通过 ViewModel 的 DOM-Listeners、Data-Bindings 绑定事件和监听数据而实现了双向绑定。它实现了数据与视图的分离，通过数据来驱动视图，开发者只需要关心数据变化 (DOM 操作被封装了)。</li>
</ul>
<h2 id="Set、Map、WeakSet、WeakMap"><a href="#Set、Map、WeakSet、WeakMap" class="headerlink" title="Set、Map、WeakSet、WeakMap"></a>Set、Map、WeakSet、WeakMap</h2><ul>
<li><strong>Set</strong>：成员不能重复、只有键值而没有键名、可以遍历。</li>
<li><strong>WeakSet</strong>：成员都是对象、成员都是弱引用而不计入垃圾回收机制、不能遍历。</li>
<li><strong>Map</strong>：本质是键值对的集合、可以遍历、可以和各种数据格式转换。</li>
<li><strong>WeakMap</strong>：只接收对象为键名、键名指向的对象不计入垃圾回收机制、不能遍历。</li>
</ul>
<h2 id="webpack-loader、plugin"><a href="#webpack-loader、plugin" class="headerlink" title="webpack loader、plugin"></a>webpack loader、plugin</h2><ul>
<li><strong>loader</strong>：一个转换器，将 A 文件进行编译成 B 文件，属于单纯的文件转换过程。</li>
<li><strong>plugin</strong>：一个扩展器，它丰富了 webpack 本身，针对的是 loader 结束后 webpack 打包的整个过程，它并不直接操作文件，而是基于事件机制工作，会监听 webpack 打包过程中的某些节点，执行广泛的任务。</li>
</ul>
<h1 id="三、JS-框架"><a href="#三、JS-框架" class="headerlink" title="三、JS 框架"></a>三、JS 框架</h1><h2 id="Angular、React、Vue"><a href="#Angular、React、Vue" class="headerlink" title="Angular、React、Vue"></a>Angular、React、Vue</h2><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><ul>
<li><strong>Vue</strong>：双向数据流，vuex 集中管理数据，有指令且能自定义指令，双向数据绑定。</li>
<li><strong>React</strong>：单项数据流，操作虚拟 dom，redux 集中管理数据，无指令。</li>
<li><strong>Angular</strong>：单项数据流，学习成本高而且性能稍差于其它两个，双向绑定原理不同 vue。</li>
</ul>
<h3 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h3><blockquote>
<p>尤雨溪开发的用于构建用户界面的一个渐进式 JS 库、数据驱动的组件系统、轻量高效的前端组件化方案，专注于视图层而不是一个全能框架。</p>
</blockquote>
<ul>
<li>特点：轻量级、双向数据绑定、数据驱动视图、视图与数据分离。</li>
<li>优点：渐进式构建能力、简单语法、更快的渲染速度和更小的体积。</li>
<li>缺点：不支持低端浏览器、首页加载缓慢，适用于中小型项目。</li>
</ul>
<h3 id="React"><a href="#React" class="headerlink" title="React"></a>React</h3><blockquote>
<p>Facebook 开源的一个用于动态构建用户界面的 JS 库、需要集成 Redux 等库才能实现复杂应用的非完整解决方案。</p>
</blockquote>
<ul>
<li>特点：采用声明式描述应用、引入 Virtual DOM 和 react-diff 算法实现高效渲染、通过 JSX 语法实现组件化、单向数据流。</li>
<li>优点：高效渲染、标准 API 解决了跨浏览器兼容问题、代码更加模块化。</li>
<li>缺点：专注于视图层而需要集成其它库，不适合大型项目。</li>
</ul>
<h3 id="Angular"><a href="#Angular" class="headerlink" title="Angular"></a>Angular</h3><blockquote>
<p>Google 开源的一个基于 TypeScript 的 JS 框架、最完善的前端工程框架。</p>
</blockquote>
<ul>
<li>特点：良好的结构程序、双向数据绑定(脏检查机制)、依赖注入、服务等。</li>
<li>优点：兼容所有平台、通过依赖注入实现注入服务、大型应用中实现静态类型检查。</li>
<li>缺点：验证功能错误信息显示比较薄弱，需要写很多模板标签。ngView 只能有一个，不能嵌套多个视图。比较笨重，没有让用户选择的轻量级版本，只适合大型项目。</li>
</ul>
<h2 id="Vue-1"><a href="#Vue-1" class="headerlink" title="Vue"></a>Vue</h2><h3 id="单向数据流"><a href="#单向数据流" class="headerlink" title="单向数据流"></a>单向数据流</h3><blockquote>
<p>数据流指组件之间的数据流动，vue、react 遵循数据只能由外层组件向内层组件传递的单向数据流。特点是子组件不能直接修改从父组件传递过来的数据，否则一个子组件修改数据就会导致所有子组件变化。优点是所有状态的改变可记录、可跟踪，组件数据只有唯一的入口和出口，有利于代码维护。缺点是写起来不太方便，变更时需要创建各种 action 来维护对应的 state。</p>
</blockquote>
<h3 id="双向绑定数据"><a href="#双向绑定数据" class="headerlink" title="双向绑定数据"></a>双向绑定数据</h3><blockquote>
<p>单双向绑定指 view、model 之间的映射关系，和数据流无关。优点是在表单交互较多的场景下，会简化大量与业务无关的代码。缺点是无法追踪局部状态的变化，增加了 debug 难度。react 采取单向绑定，vue 支持单向绑定(<code>插值，v-bind</code>) 和双向绑定(<code>v-model</code>)。</p>
</blockquote>
<ul>
<li><strong>实现原理</strong>：vue2.0 采用数据劫持结合发布者-订阅者模式的方式，通过 Object.defineProperty() 来劫持各个属性的 setter、getter 操作，在数据变动时发布消息给订阅者，触发相应监听回调。</li>
<li><strong>实现流程</strong> <ul>
<li><strong>1、模板解析为 render 函数</strong>：函数包含所有的模板信息并返回一个虚拟 DOM，模板的 data 和指令变成了 JS 变量和 JS 逻辑。</li>
<li><strong>2、响应式监听</strong>：通过 Object.defineProperty 设置对象的 get&#x2F;set 实现监听 data 的属性变化，然后将 data 属性代理到实例对象 vm。</li>
<li><strong>3、页面渲染</strong>：通过 updateComponent() 将模板渲染为 html。首次渲染时直接渲染虚拟 DOM，data 属性变化触发重新渲染时对比新旧节点后局部渲染。</li>
</ul>
</li>
<li><strong>实现方式</strong><ul>
<li><strong>发布者-订阅者模式</strong>：一般通过 sub、pub 的方式实现数据和视图的绑定监听，更新数据 <code>vm.set(&#39;property&#39;, value)</code>。</li>
<li><strong>脏值检查</strong>：angular 在指定事件触发时进入脏值检测，通过对比新旧数据来决定是否更新视图，它只对改变的数据进行更新元素。</li>
<li><strong>数据劫持</strong>：vue2.0 通过 <code>Object.defineProperty()</code> 来监听对象各个属性的 getter、setter，属性改变时触发回调。</li>
<li><strong>ES6 Proxy</strong>：vue3.0 用来替代 Object.defineProperty，因为它可以劫持整个对象而不需要遍历对象的所有属性。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">    (<span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">            <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get&#x27;</span>, key);</span><br><span class="line">                <span class="keyword">return</span> data[key];</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set&#x27;</span>, newVal);</span><br><span class="line">                data[key] = newVal;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> data = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params">obj, key</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj[key];</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">obj, key, val</span>) &#123;</span><br><span class="line">        obj[key] = val;</span><br><span class="line">        <span class="title function_">scan</span>();</span><br><span class="line">        <span class="keyword">return</span> obj[key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="双向绑定和-vuex-是否冲突"><a href="#双向绑定和-vuex-是否冲突" class="headerlink" title="双向绑定和 vuex 是否冲突"></a>双向绑定和 vuex 是否冲突</h3><blockquote>
<p>严格模式下使用时，Vuex state 上使用 v-model 会导致出错。解决方案如下：</p>
</blockquote>
<ul>
<li>使用带有 setter 的双向绑定计算属性。</li>
<li><code>&lt;Input&gt;</code> 绑定 value，然后监听 input&#x2F;change 事件并在事件回调中调用方法。</li>
</ul>
<h3 id="Proxy-替代-Object-defineProperty"><a href="#Proxy-替代-Object-defineProperty" class="headerlink" title="Proxy 替代 Object.defineProperty"></a>Proxy 替代 Object.defineProperty</h3><ul>
<li><strong>Object.defineProperty</strong>：无法低耗费的监听到数组下标的变化，导致通过数组下标添加元素时不能实时响应。只能劫持对象的属性，从而需要对每个对象、每个属性进行遍历，如果属性值是对象则还需要深度遍历。</li>
<li><strong>Proxy</strong>：可以劫持整个对象并返回一个新对象。可以代理对象、数组、动态增加的属性。</li>
</ul>
<h3 id="如何监控到属性修改并触发警告"><a href="#如何监控到属性修改并触发警告" class="headerlink" title="如何监控到属性修改并触发警告"></a>如何监控到属性修改并触发警告</h3><ul>
<li>因为 Vue 是单向数据流，易于检测数据的流动，出现了错误可以更加迅速的定位到错误发生的位置。</li>
<li>通过 setter 属性进行检测，修改值将会触发 setter，从而触发警告。</li>
</ul>
<h3 id="v-for-时给元素绑定事件要事件代理吗"><a href="#v-for-时给元素绑定事件要事件代理吗" class="headerlink" title="v-for 时给元素绑定事件要事件代理吗"></a>v-for 时给元素绑定事件要事件代理吗</h3><blockquote>
<p>v-for 中使用事件代理可以使监听器数量和内存占用率都减少，vue 内部并不会自动做事件代理，所以在 v-for 上使用事件代理在性能上会更优。</p>
</blockquote>
<h3 id="父子组件生命周期的执行顺序"><a href="#父子组件生命周期的执行顺序" class="headerlink" title="父子组件生命周期的执行顺序"></a>父子组件生命周期的执行顺序</h3><blockquote>
<p>vue 生命周期：beforeCreate、created、beforeMount、Mounted、beforeUpdate、updated、beforedestroy、destroyed。</p>
</blockquote>
<ul>
<li><strong>加载渲染过程</strong>：父 beforeCreate -&gt; 父 created -&gt; 父 beforeMount -&gt; 子 beforeCreate -&gt; 子 created -&gt; 子 beforeMount -&gt; 子 mounted -&gt; 父 mounted。</li>
<li><strong>子组件更新过程</strong>：父 beforeUpdate -&gt; 子 beforeUpdate -&gt; 子 updated -&gt; 父 updated。</li>
<li><strong>父组件更新过程</strong>：父 beforeUpdate -&gt; 父 updated。</li>
<li><strong>销毁过程</strong>：父 beforeDestroy -&gt; 子 beforeDestroy -&gt; 子 destroyed -&gt; 父 destroyed。</li>
</ul>
<h3 id="NextTick"><a href="#NextTick" class="headerlink" title="NextTick"></a>NextTick</h3><blockquote>
<p>在下次 DOM 更新循环结束之后执行延迟回调，在修改数据之后使用 $nextTick，则可以在回调中获取更新后的 DOM。</p>
</blockquote>
<h3 id="组件-key"><a href="#组件-key" class="headerlink" title="组件 key"></a>组件 key</h3><ul>
<li>Key 是用于追踪哪些列表中的元素被修改、被添加或被移除的辅助标识，开发时需要保证元素的 key 在其同级元素中具有唯一性。</li>
<li>vue、react 都是通过 diff 算法来对比新旧虚拟节点，从而实现更新。Key 值则用来判断该元素是新创建的还是被移动而来的元素，从而减少不必要的重复渲染。</li>
</ul>
<h3 id="组件-data-必须是函数"><a href="#组件-data-必须是函数" class="headerlink" title="组件 data 必须是函数"></a>组件 data 必须是函数</h3><blockquote>
<p>因为 JS 本身的特性带来的，如果 data 是一个对象，那么由于对象本身属于引用类型，当我们修改其中的一个属性时，会影响到所有 Vue 实例的数据。如果将 data 作为一个返回一个对象的函数，那么每一个实例的 data 属性都是独立的，不会相互影响了。</p>
</blockquote>
<h3 id="vuex-全局挂载"><a href="#vuex-全局挂载" class="headerlink" title="vuex 全局挂载"></a>vuex 全局挂载</h3><ul>
<li><strong>window 挂载</strong>：相当于增加全局属性，容易造成变量污染。数据是静态的而只能通过手动更新，数据更新后相关组件也不会重新渲染，必须手动渲染。</li>
<li><strong>vue 实例挂载</strong>：store 数据更新后就会立即渲染所有使用 store 数据的组件。Vuex 使用单向数据流，store 数据的更新需要经过 action 层、mutation 层，层次划分明确，便于管理。</li>
</ul>
<h3 id="Vuex-mutation、Redux-reducer-不能异步"><a href="#Vuex-mutation、Redux-reducer-不能异步" class="headerlink" title="Vuex mutation、Redux reducer 不能异步"></a>Vuex mutation、Redux reducer 不能异步</h3><blockquote>
<p>纯函数，给定同样的输入返回同样的输出，可预测性。</p>
</blockquote>
<h3 id="performance-性能模式"><a href="#performance-性能模式" class="headerlink" title="performance 性能模式"></a>performance 性能模式</h3><blockquote>
<p>通过 Performance API 可以获取到当前页面中与性能相关的信息，Performance.timing 对象包含了各种与浏览器处理相关的时间数据 (接口耗时、资源加载时间等)。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js：适用于开发模式和支持 performance.mark 的浏览器，开发工具的性能/时间线面板展示。</span></span><br><span class="line"><span class="keyword">const</span> isDev = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">performance</span> = isDev;</span><br></pre></td></tr></table></figure>

<h2 id="React-1"><a href="#React-1" class="headerlink" title="React"></a>React</h2><h3 id="redux-reducer-为何设计成纯函数"><a href="#redux-reducer-为何设计成纯函数" class="headerlink" title="redux reducer 为何设计成纯函数"></a>redux reducer 为何设计成纯函数</h3><blockquote>
<p>redux 的设计思想是不产生副作用、数据更改的状态可回溯。</p>
</blockquote>
<h3 id="react-router-里的标签和普通标签的区别"><a href="#react-router-里的标签和普通标签的区别" class="headerlink" title="react-router 里的标签和普通标签的区别"></a>react-router 里的标签和普通标签的区别</h3><ul>
<li>有 onClick 则执行 OnClick。</li>
<li>阻止 a 标签默认事件（跳转页面）。</li>
<li>使用 history&#x2F;hash 跳转，只是链接发现改变而并没有刷新页面。</li>
</ul>
<h3 id="组件的生命周期"><a href="#组件的生命周期" class="headerlink" title="组件的生命周期"></a>组件的生命周期</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、组件挂载</span></span><br><span class="line">constructor   <span class="comment">// 实例化：初始化 state，本地化 props，给事件处理函数绑定 this</span></span><br><span class="line"><span class="keyword">static</span> getDerivedStateFromProps  <span class="comment">// 实例化时或 props 变化时调用，返回 新state/null</span></span><br><span class="line">render        <span class="comment">// 渲染函数：不能省略并且必须有返回值 (返回 null/false 表示不渲染)</span></span><br><span class="line">componentDidMount  <span class="comment">// 挂载完成函数：axios 请求、事件绑定、setState 数据、操作 dom</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、组件更新</span></span><br><span class="line"><span class="keyword">static</span> getDeriverdStateFromProps  <span class="comment">// 从 props 中获取 state</span></span><br><span class="line">shouldComponentUpdate    <span class="comment">// 返回 true/false 表示是否更新组件，常用于组件性能优化</span></span><br><span class="line">render                   <span class="comment">// 渲染</span></span><br><span class="line">getSnapshotBeforeUpdate  <span class="comment">// 获取快照：最新渲染输出（提交到 DOM 节点）前被调用</span></span><br><span class="line">componentDidUpdate       <span class="comment">// 更新完成函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、组件卸载</span></span><br><span class="line">componentWillUnmount     <span class="comment">// 预销毁函数：移除定时器、事件绑定等</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、错误处理</span></span><br><span class="line"><span class="keyword">static</span> getDerivedStateFromError <span class="comment">// 从错误中获取 state</span></span><br><span class="line">componentDidCatch        <span class="comment">// 捕获错误并进行处理</span></span><br></pre></td></tr></table></figure>


<h3 id="Mixin、HOC、Render-Prop、React-Hooks"><a href="#Mixin、HOC、Render-Prop、React-Hooks" class="headerlink" title="Mixin、HOC、Render Prop、React Hooks"></a>Mixin、HOC、Render Prop、React Hooks</h3><h4 id="Mixin"><a href="#Mixin" class="headerlink" title="Mixin"></a>Mixin</h4><blockquote>
<p>缺陷如下：</p>
</blockquote>
<ul>
<li>命名冲突：多个 Mixin 可能定义了相同的 state 字段而导致数据覆盖问题。</li>
<li>相关依赖：组件与 Mixin、多个 Mixin 之间都可能存在依赖关系，维护成本较高。</li>
<li>增加复杂性：一个组件引入过多 mixin 时，代码逻辑将会非常复杂，过多的状态也降低了应用的可预测性。</li>
</ul>
<h4 id="HOC"><a href="#HOC" class="headerlink" title="HOC"></a>HOC</h4><ul>
<li>优势<ul>
<li>HOC 不会影响组件内部的状态，不存在冲突和互相干扰，这就降低了耦合度。</li>
<li>不同于 Mixin 的打平+合并，HOC 具有层级结构（组件树结构），降低了复杂度。</li>
</ul>
</li>
<li>缺陷<ul>
<li>嵌套地狱：每一次 HOC 调用都会产生一个组件实例，过多的嵌套会导致难以溯源，而且可能会存在 props 属性覆盖问题。</li>
<li>静态构建：HOC 只是声明了新组件但不会马上渲染，只有在组件被渲染时才执行。</li>
</ul>
</li>
</ul>
<h4 id="Render-Prop"><a href="#Render-Prop" class="headerlink" title="Render Prop"></a>Render Prop</h4><ul>
<li>优势<ul>
<li>动态构建，组件会重新渲染。</li>
<li>不用担心 props 的命名冲突。</li>
<li>可以溯源，子组件的 props 一定是来自于直接父组件。</li>
</ul>
</li>
<li>缺陷<ul>
<li>嵌套地狱：虽然摆脱了组件多层嵌套的问题，但是转化为了函数回调的嵌套。</li>
<li>使用繁琐：HOC 可以通过装饰器语法的一行代码实现复用，Render Props 则不行。</li>
<li>没有组件的上下文：没有 this.props 属性，不能像 HOC 那样可以直接获取到子组件实例对象 this.props.children。</li>
</ul>
</li>
</ul>
<h4 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h4><ul>
<li>优势<ul>
<li>解决了以上的嵌套问题，而且实现了视图和状态的分离，Hooks 还可以相互组合。</li>
<li>Hooks 为函数组件而生，从而解决了类组件的几大问题：this 指向容易错误、声明周期中的逻辑代码难以理解和维护、代码复用成本高等。</li>
</ul>
</li>
<li>缺陷<ul>
<li>存在不能出现在条件、循环中等写法限制，内部实现也不直观，增加了学习成本。</li>
<li>在闭包场景可能会引用到旧的 state、props 值，React.memo 也不能完全替代 shouldComponentUpdate（因为拿不到 state change，只针对 props change）。</li>
</ul>
</li>
</ul>
<h3 id="Flux-思想"><a href="#Flux-思想" class="headerlink" title="Flux 思想"></a>Flux 思想</h3><blockquote>
<p>主要特点就是数据单向流动，具体流程如下：</p>
</blockquote>
<ol>
<li>用户访问 View。</li>
<li>View 发出用户的 Action。</li>
<li>Dispatcher 收到 Action，要求 Store 进行对应的更新。</li>
<li>Store 更新后，发出一个 change 事件。</li>
<li>View 收到 change 后，更新页面。</li>
</ol>
<h3 id="合成事件"><a href="#合成事件" class="headerlink" title="合成事件"></a>合成事件</h3><blockquote>
<p>React SyntheticEvent 中间层通过事件委托的方式基于原生 DOM 事件封装并暴露接口的事件对象，优化了浏览器兼容和性能等问题，</p>
</blockquote>
<ul>
<li>当用户在为 onClick 添加函数时，React 并没有将 Click 时间绑定到 DOM，而是在 document 处监听所有支持的事件。</li>
<li>当事件发生并冒泡至 document 时，React 才会让中间层 SyntheticEvent 将所有事件合成。所以原生事件会先执行，然后执行 React 合成事件，最后执行真正在 document 上挂载的事件。</li>
<li>React 事件和原生事件最好不要混用。原生事件中如果执行了 stopPropagation 方法，就会导致其他 React 事件失效。因为所有元素的事件将无法冒泡到 document上，导致所有的 React事件都将无法被触发。</li>
</ul>
<h3 id="setState-是异步还是同步"><a href="#setState-是异步还是同步" class="headerlink" title="setState 是异步还是同步"></a>setState 是异步还是同步</h3><ul>
<li>setState 只在合成事件和钩子函数中是异步的，在原生事件和 setTimeout 中都是同步的。</li>
<li>setState 的异步并不是说内部由异步代码实现，其实本身执行的过程和代码都是同步的，只是合成事件和钩子函数的调用顺序在更新之前，导致在合成事件和钩子函数中无法马上获取更新后的值，形成了所谓的“异步”。但可以通过第二个参数 callback 获取最新数据。<br>  setState 的批量更新优化也是建立在“异步”（合成事件、钩子函数）之上的，在原生事件和 setTimeout 中不会批量更新，在“异步”中如果对同一个值进行多次 setState，setState的批量更新策略会对其进行覆盖，取最后一次的执行，如果是同时 setState 多个不同的值，在更新时会对其进行合并批量更新。</li>
</ul>
<h3 id="redux、dva、vuex"><a href="#redux、dva、vuex" class="headerlink" title="redux、dva、vuex"></a>redux、dva、vuex</h3><ul>
<li>redux：通过 store 存储，通过 dispatch(action) 唯一更改，reducer 描述如何更改。</li>
<li>dva：基于 redux，结合 redux-saga 等中间件进行封装。</li>
<li>vuex：类似dva，集成化。action 异步，mutation 同步。</li>
</ul>
<h3 id="redux-中间件"><a href="#redux-中间件" class="headerlink" title="redux 中间件"></a>redux 中间件</h3><blockquote>
<p>中间件提供第三方插件的模式，自定义拦截 action -&gt; reducer 的过程。变为 action -&gt; middlewares -&gt; reducer。这种机制可以让我们改变数据流，实现异步 action、action 过滤、日志输出、异常报告等功能。常见的中间件如下：</p>
</blockquote>
<ul>
<li><strong>redux-thunk</strong>：处理异步操作。</li>
<li><strong>redux-logger</strong>：提供日志输出。</li>
<li><strong>redux-promise</strong>：处理异步操作，actionCreator 的返回值是 promise。</li>
</ul>
<h3 id="redux-缺点"><a href="#redux-缺点" class="headerlink" title="redux 缺点"></a>redux 缺点</h3><ul>
<li>组件所需要的数据必须由父组件传过来，而不能像 flux 中直接从 store 获取。</li>
<li>组件相关数据更新时，父组件即使用不到该组件也会重新 render，这样可能会影响效率，或者需要写复杂的 shouldComponentUpdate 进行判断。</li>
</ul>
<h3 id="性能优化方案"><a href="#性能优化方案" class="headerlink" title="性能优化方案"></a>性能优化方案</h3><ul>
<li>使用 production 版本的 react.js。</li>
<li>重写 shouldComponentUpdate 来避免不必要的 dom 操作。</li>
<li>使用 key 来帮助 React 识别列表中所有子组件的最小变化。</li>
</ul>
<h3 id="setState-执行"><a href="#setState-执行" class="headerlink" title="setState 执行"></a>setState 执行</h3><ul>
<li>前两次都是在 react 自身声明周期内，触发时 <code>isBatchingUpdates: true</code>，所以并不会直接执行更新，而是加入了 dirtyComponents，所以获取的都是更新前的状态 0。</li>
<li>两次 setState 相同，react 内部会合并而只执行一次，完成后 state.val 值为 1。</li>
<li>setTimeout 中的代码触发时 <code>isBatchingUpdate: false</code>，直接更新而输出 2、3。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 0、0、2、3</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Example</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">val</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">val</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">val</span> + <span class="number">1</span>&#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">val</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">val</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">val</span> + <span class="number">1</span>&#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">val</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">val</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">val</span> + <span class="number">1</span>&#125;);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">val</span>);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">val</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">val</span> + <span class="number">1</span>&#125;);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">val</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="四、小程序"><a href="#四、小程序" class="headerlink" title="四、小程序"></a>四、小程序</h1><h2 id="架构原理"><a href="#架构原理" class="headerlink" title="架构原理"></a>架构原理</h2><ul>
<li>数据驱动的架构模式，UI 和数据是分离的，所有的页面更新都通过对更新数据来实现。</li>
<li>小程序本质是一个单页面应用，所有的页面渲染和事件处理都在一个页面内进行，但又可以通过微信客户端调用原生的各种接口。</li>
<li>它从技术讲和现有的前端开发差不多，采用 JS、WXML、WXSS 三种技术进行开发。功能可分为 webview、appService 两个部分。webview 用来展现 UI，appService 用来处理业务逻辑、数据及接口调用。两个部分在两个进程中运行，通过系统层 JSBridge 实现通信、UI 渲染、事件处理等。</li>
</ul>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><ul>
<li>**onLoad()**：页面加载时触发，只会调用一次，可获取当前页面路径中的参数。</li>
<li>**onShow()**：页面显示&#x2F;切入前台时触发，一般用来发送数据请求。</li>
<li>**onReady()**：页面初次渲染完成时触发, 只会调用一次，代表页面已可和视图层进行交互。</li>
<li>**onHide()**：页面隐藏&#x2F;切入后台时触发, 如底部 tab 切换到其他页面或小程序切入后台等。</li>
<li>**onUnload()**：页面卸载时触发，比如 redirectTo、navigateBack 到其他页面时。</li>
</ul>
<h2 id="双向绑定对比-vue"><a href="#双向绑定对比-vue" class="headerlink" title="双向绑定对比 vue"></a>双向绑定对比 vue</h2><blockquote>
<p>大体相同，但小程序直接 this.data 的属性不可以同步到视图，必须调用 this.setData() 方法。</p>
</blockquote>
<h2 id="wxml-与标准-html"><a href="#wxml-与标准-html" class="headerlink" title="wxml 与标准 html"></a>wxml 与标准 html</h2><blockquote>
<p>wxml 基于 xml 设计，标签只能在微信小程序中使用，不能使用 html 标签。</p>
</blockquote>
<h2 id="页面间传递数据"><a href="#页面间传递数据" class="headerlink" title="页面间传递数据"></a>页面间传递数据</h2><ul>
<li>使用全局变量实现数据传递。</li>
<li>页面跳转或重定向时，使用 url 带参数传递数据。</li>
<li>使用组件模板 template 传递参数。</li>
<li>使用缓存传递参数。</li>
<li>使用数据库传递数据。</li>
</ul>
<h2 id="提高应用速度"><a href="#提高应用速度" class="headerlink" title="提高应用速度"></a>提高应用速度</h2><ul>
<li>提高页面加载速度</li>
<li>用户行为预测</li>
<li>减少默认 data 的大小</li>
<li>组件化方案</li>
</ul>
<h1 id="五、编程相关"><a href="#五、编程相关" class="headerlink" title="五、编程相关"></a>五、编程相关</h1><h2 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结果：[1, NaN, NaN]</span></span><br><span class="line"><span class="comment">// 原因：map 回调传入 item、index，执行 parseInt(1, 0)、parseInt(2, 1)、parseInt(3, 2)。</span></span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>].<span class="title function_">map</span>(<span class="built_in">parseInt</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 什么情况下会打印 1</span></span><br><span class="line"><span class="keyword">var</span> a = ?;</span><br><span class="line"><span class="keyword">if</span>(a == <span class="number">1</span> &amp;&amp; a == <span class="number">2</span> &amp;&amp; a == <span class="number">3</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="title function_">valueOf</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> ++<span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现 (5).add(3).minus(2)</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">add</span> = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span> + n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">minus</span> = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span> - n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 某公司 1-12 月的销售额为：&#123;1:22, 2:12, 5: 88&#125;，请处理为：</span></span><br><span class="line"><span class="comment">// [22, 12, null, null, 88, null, null, null, null, null, null, null]</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">convert</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="number">12</span> &#125;).<span class="title function_">map</span>(<span class="function">(<span class="params">item, i</span>) =&gt;</span> obj[i] || <span class="literal">null</span>).<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="综合考察"><a href="#综合考察" class="headerlink" title="综合考察"></a>综合考察</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  getName = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>); &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);&#125;;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);&#125;;</span><br><span class="line"><span class="keyword">var</span> getName = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="title function_">getName</span>();        <span class="comment">// 2</span></span><br><span class="line"><span class="title function_">getName</span>();            <span class="comment">// 4</span></span><br><span class="line"><span class="title class_">Foo</span>().<span class="title function_">getName</span>();      <span class="comment">// 1</span></span><br><span class="line"><span class="title function_">getName</span>();            <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Foo</span>.<span class="title function_">getName</span>();    <span class="comment">// 2</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Foo</span>().<span class="title function_">getName</span>();  <span class="comment">// 3</span></span><br><span class="line"><span class="keyword">new</span> <span class="keyword">new</span> <span class="title class_">Foo</span>().<span class="title function_">getName</span>();    <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>



<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@desp</span> 变量提升：JS 解析器都会将函数体内声明的变量移到函数体的顶部。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@result</span> ：Goodbye Jack、World</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;World&#x27;</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// var name; </span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = <span class="string">&#x27;Jack&#x27;</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Goodbye &#x27;</span> + name);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello &#x27;</span> + name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 查找变量时，当前函数体内没找到则到一直向上到全局对象中寻找。</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 赋值表达式：undefined、&#123; n: 2 &#125;</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">n</span>: <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> b = a;</span><br><span class="line">a.<span class="property">x</span> = a = &#123;<span class="attr">n</span>: <span class="number">2</span>&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">x</span>, b.<span class="property">x</span>)</span><br></pre></td></tr></table></figure>

<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line">(<span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 内部作用域会先去查找已有变量的声明，有则赋值，但 IIFE 函数无法赋值。</span></span><br><span class="line">    b = <span class="number">20</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(b);         <span class="comment">// [Function b]</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">b</span>);  <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// window.b = 20 打印：[Function b]、20</span></span><br><span class="line">    <span class="comment">// var b = 20 打印：20、10</span></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)   <span class="comment">// undefined</span></span><br><span class="line">    a = <span class="number">5</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">a</span>)   <span class="comment">// 10</span></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">20</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)   <span class="comment">// 20</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>


<h2 id="this-指针"><a href="#this-指针" class="headerlink" title="this 指针"></a>this 指针</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 4 2 1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Foo</span>.<span class="property">a</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property">a</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="title function_">a</span>();</span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">Foo</span>(); </span><br><span class="line">obj.<span class="title function_">a</span>();</span><br><span class="line"><span class="title class_">Foo</span>.<span class="title function_">a</span>();</span><br></pre></td></tr></table></figure>

<h2 id="对象应用"><a href="#对象应用" class="headerlink" title="对象应用"></a>对象应用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://www.baidu.com</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">changeObjProperty</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  o.<span class="property">siteUrl</span> = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line">  o = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">  o.<span class="property">siteUrl</span> = <span class="string">&quot;http://www.google.com&quot;</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">let</span> webSite = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="title function_">changeObjProperty</span>(webSite);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(webSite.<span class="property">siteUrl</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// [ , , 1, 2]</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">&#x27;3&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="string">&#x27;length&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;splice&#x27;</span>: <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">splice</span>,</span><br><span class="line">    <span class="string">&#x27;push&#x27;</span>: <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span></span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">push</span>(<span class="number">1</span>)</span><br><span class="line">obj.<span class="title function_">push</span>(<span class="number">2</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br></pre></td></tr></table></figure>


<h2 id="事件循环-x2F-异步"><a href="#事件循环-x2F-异步" class="headerlink" title="事件循环&#x2F;异步"></a>事件循环&#x2F;异步</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// script start、async1 start、async2、promise1、</span></span><br><span class="line"><span class="comment">// script end、async1 end、promise2、setTimeout</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;async1 start&#x27;</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;async1 end&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;async2&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;script start&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;script end&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h2 id="jsonp-封装"><a href="#jsonp-封装" class="headerlink" title="jsonp 封装"></a>jsonp 封装</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">jsonp</span> (&#123;url, param, callback&#125;) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">callback</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(data)</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> param = &#123;...param, callback&#125;</span><br><span class="line">    <span class="keyword">var</span> arr = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> param) &#123;</span><br><span class="line">      arr.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;param[key]&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    script.<span class="property">src</span> = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;arr.join(<span class="string">&#x27;&amp;&#x27;</span>)&#125;</span>`</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="实现一个-sleep-函数"><a href="#实现一个-sleep-函数" class="headerlink" title="实现一个 sleep 函数"></a>实现一个 sleep 函数</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Promise</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sleep1</span>(<span class="params">time</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, time);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sleep1</span>(<span class="number">1000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sleep1&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generator</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">sleep2</span>(<span class="params">time</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> <span class="title function_">sleep1</span>(time);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> s = <span class="title function_">sleep2</span>(<span class="number">1500</span>);</span><br><span class="line">s.<span class="title function_">next</span>().<span class="property">value</span>.<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sleep2&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Async/Await</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sleep3</span>(<span class="params">time</span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">sleep1</span>(time);</span><br><span class="line">&#125;</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">sleep3</span>(<span class="number">2000</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sleep3&quot;</span>)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>


<h2 id="消息队列的类实现"><a href="#消息队列的类实现" class="headerlink" title="消息队列的类实现"></a>消息队列的类实现</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设计一个 LazyMan 类，实现以下功能</span></span><br><span class="line"><span class="title class_">LazyMan</span>(<span class="string">&#x27;Tony&#x27;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"><span class="title class_">LazyMan</span>(<span class="string">&#x27;Tony&#x27;</span>).<span class="title function_">sleep</span>(<span class="number">10</span>).<span class="title function_">eat</span>(<span class="string">&#x27;lunch&#x27;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"><span class="comment">// 等待了10秒...</span></span><br><span class="line"><span class="comment">// I am eating lunch</span></span><br><span class="line"><span class="title class_">LazyMan</span>(<span class="string">&#x27;Tony&#x27;</span>).<span class="title function_">eat</span>(<span class="string">&#x27;lunch&#x27;</span>).<span class="title function_">sleep</span>(<span class="number">10</span>).<span class="title function_">eat</span>(<span class="string">&#x27;dinner&#x27;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"><span class="comment">// I am eating lunch</span></span><br><span class="line"><span class="comment">// 等待了10秒...</span></span><br><span class="line"><span class="comment">// I am eating diner</span></span><br><span class="line"><span class="title class_">LazyMan</span>(<span class="string">&#x27;Tony&#x27;</span>).<span class="title function_">eat</span>(<span class="string">&#x27;lunch&#x27;</span>).<span class="title function_">eat</span>(<span class="string">&#x27;dinner&#x27;</span>).<span class="title function_">sleepFirst</span>(<span class="number">5</span>).<span class="title function_">sleep</span>(<span class="number">10</span>).<span class="title function_">eat</span>(<span class="string">&#x27;junk food&#x27;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"><span class="comment">// 等待了5秒...</span></span><br><span class="line"><span class="comment">// I am eating lunch</span></span><br><span class="line"><span class="comment">// I am eating dinner</span></span><br><span class="line"><span class="comment">// 等待了10秒...</span></span><br><span class="line"><span class="comment">// I am eating junk food</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazyManClass</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fns</span> = [];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hi I am <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">next</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">sleep</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`等待了<span class="subst">$&#123;time&#125;</span>秒...`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">next</span>();</span><br><span class="line">      &#125;, time * <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fns</span>.<span class="title function_">push</span>(fn);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">sleepFirst</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`等待了<span class="subst">$&#123;time&#125;</span>秒...`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">next</span>();</span><br><span class="line">      &#125;, time * <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fns</span>.<span class="title function_">unshift</span>(fn);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">eat</span>(<span class="params">food</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`I am eating <span class="subst">$&#123;food&#125;</span>`</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fns</span>.<span class="title function_">push</span>(fn);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> fn = <span class="variable language_">this</span>.<span class="property">fns</span>.<span class="title function_">shift</span>();</span><br><span class="line">    fn &amp;&amp; <span class="title function_">fn</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">LazyMan</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LazyManClass</span>(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>面试题库</category>
      </categories>
      <tags>
        <tag>面试题库</tag>
      </tags>
  </entry>
  <entry>
    <title>TypeScript 进阶语法</title>
    <url>/2019/11/06/11-2-typescript%20%E8%BF%9B%E9%98%B6%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<h1 id="一、类型检查"><a href="#一、类型检查" class="headerlink" title="一、类型检查"></a>一、类型检查</h1><blockquote>
<p>TS 的类型约束对象为变量、函数的参数和返回值，比如字面量类型约束变量、void 和 never 约束函数返回值等。</p>
</blockquote>
<h2 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h2><ul>
<li>实现：<code>&lt;类型&gt; 值、值 as 类型</code>，注意使用 JSX 时只允许 as 语法。</li>
<li>用来指定一个值的类型而使 TS 假设已经类型检查，注意指定的必须是其子类型。</li>
<li>类似类型转换但并不进行数据检查和解构，它只在编译阶段起作用而运行时没影响。</li>
</ul>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">val</span>: <span class="built_in">any</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">len_1</span>: <span class="built_in">number</span> = (&lt;<span class="built_in">string</span>&gt;val).<span class="property">length</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">len_2</span>: <span class="built_in">number</span> = (val <span class="keyword">as</span> <span class="built_in">string</span>).<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例：将一个联合类型的变量指定为一个更加具体的类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params">something: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="comment">// 类型断言不是类型转换，不能断言成一个联合类型中不存在的类型</span></span><br><span class="line">  <span class="keyword">if</span> ((&lt;<span class="built_in">string</span>&gt;something).<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> (&lt;<span class="built_in">string</span>&gt;something).<span class="property">length</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> something.<span class="title function_">toString</span>().<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h2><blockquote>
<p>没有明确指定变量的类型时，TS 会根据某些规则自动推断出类型，常见场景有：声明变量时没有指定类型、函数默认参数、函数返回值。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a;         <span class="comment">// 推断为 any</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">1</span>;     <span class="comment">// 推断为 number</span></span><br><span class="line"><span class="keyword">let</span> c = [];    <span class="comment">// 推断为由 any 类型构成的数组</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">d</span> = (<span class="params">x=<span class="number">1</span></span>) =&gt; x+<span class="number">1</span>;  <span class="comment">// 函数默认参数被推断为 number，返回值也会被推断</span></span><br><span class="line"><span class="keyword">let</span> e = [<span class="number">1</span>, <span class="literal">null</span>];     <span class="comment">// 推断出兼容所有数据的类型：number、null 的联合类型</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">&#x27;seven&#x27;</span>;</span><br><span class="line">a = <span class="number">7</span>;</span><br><span class="line">b = <span class="string">&#x27;3&#x27;</span>;  <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文类型：根据变量所在位置的上下文进行推论</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onmousedown</span> = <span class="keyword">function</span>(<span class="params">mouseEvent: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 编译通过，如果不指定 mouseEvent 类型则会报错</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(mouseEvent.<span class="property">button</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS 推论有时不符合预期，可以通过类型断言进行覆盖。</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Foo</span>&#123;</span><br><span class="line">  <span class="attr">bar</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">foo</span>: <span class="title class_">Foo</span> = &#123;&#125; <span class="keyword">as</span> <span class="title class_">Foo</span>;  <span class="comment">// 约定对象按照接口规范</span></span><br><span class="line">foo.<span class="property">bar</span> = <span class="number">1</span>;               <span class="comment">// 实现对象的具体定义</span></span><br></pre></td></tr></table></figure>


<h2 id="类型兼容"><a href="#类型兼容" class="headerlink" title="类型兼容"></a>类型兼容</h2><ul>
<li>TS 允许类型相互兼容的变量（函数、类等结构）相互赋值</li>
</ul>
<h3 id="兼容规则"><a href="#兼容规则" class="headerlink" title="兼容规则"></a>兼容规则</h3><blockquote>
<p>基于(成员的)结构类型，与通过明确的声明或类型名称决定兼容性的名义类型形成对比。基础规则为：函数之间是参数多的兼容参数少的、结构之间则是成员少的兼容成员多的，两个兼容的类型之间必须具有共同的属性。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基于结构类型系统的 TS 会检查成功，Java 则会报错</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Named</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">p</span>: <span class="title class_">Named</span>;</span><br><span class="line">p = <span class="keyword">new</span> <span class="title class_">Person</span>();  <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure>


<h3 id="兼容实例"><a href="#兼容实例" class="headerlink" title="兼容实例"></a>兼容实例</h3><blockquote>
<p>如果类型 Y 可以被赋值给类型 X 时，则认为 X 兼容 Y，X 为目标类型，Y 为源类型。</p>
</blockquote>
<ul>
<li>函数<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 形参需要包含关系，参数名可以不相同</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">x</span> = (<span class="params">a: <span class="built_in">number</span></span>) =&gt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">y</span> = (<span class="params">b: <span class="built_in">number</span>, s: <span class="built_in">string</span></span>) =&gt; <span class="number">0</span>;</span><br><span class="line">y = x;    <span class="comment">// 正确</span></span><br><span class="line">x = y;    <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回类型需要被包含关系</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">x</span> = (<span class="params"></span>)=&gt;(&#123;<span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">y</span> = (<span class="params"></span>)=&gt;(&#123;<span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>:<span class="number">20</span>&#125;);</span><br><span class="line">y = x;    <span class="comment">// 报错</span></span><br><span class="line">x = y     <span class="comment">// 正确</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选参数和剩余参数的兼容</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">a1</span> = (<span class="params">p1: <span class="built_in">number</span>, p2: <span class="built_in">number</span></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">b1</span> = (<span class="params">p1?: <span class="built_in">number</span>, p2?: <span class="built_in">number</span></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">c1</span> = (<span class="params">...args: <span class="built_in">number</span>[]</span>) =&gt; &#123;&#125;;</span><br><span class="line">a1 = b1;</span><br><span class="line">a1 = c1;</span><br><span class="line">b1 = a1;    <span class="comment">// 报错：可选参数不能被兼容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于有重载的函数，源函数的每个重载都要在目标函数上找到对应的函数签名。</span></span><br></pre></td></tr></table></figure></li>
<li>接口<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> X &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">b</span>: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> Y &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">b</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">c</span>: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">x</span>: X = &#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">y</span>: Y = &#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>,<span class="attr">c</span>:<span class="number">3</span>&#125;;</span><br><span class="line">x = y; <span class="comment">// x 兼容 y，成员少的会兼容成员多的</span></span><br></pre></td></tr></table></figure></li>
<li>枚举：枚举类型与数字类型兼容，不同枚举类型之间不兼容。<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Status</span> &#123; <span class="title class_">Ready</span>, <span class="title class_">Waiting</span> &#125;;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123; <span class="title class_">Red</span>, <span class="title class_">Blue</span>, <span class="title class_">Green</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> status = <span class="title class_">Status</span>.<span class="property">Ready</span>;   <span class="comment">// 0</span></span><br><span class="line">status = <span class="title class_">Color</span>.<span class="property">Green</span>;        <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure></li>
<li>类<ul>
<li>比较两个类的对象时，只会比较实例的成员而不比较静态成员和构造函数。</li>
<li>类的私有成员和受保护成员会影响兼容性。当检查类实例的兼容时，如果目标类型包含一个私有成员或受保护成员，那么源类型必须包含来自同一个类的这个成员。这允许子类赋值给父类，但是不能赋值给其它有同样类型的类。<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">feet</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, numFeet: <span class="built_in">number</span></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Size</span> &#123;</span><br><span class="line">  <span class="attr">feet</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">numFeet: <span class="built_in">number</span></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="title class_">Animal</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">s</span>: <span class="title class_">Size</span>;</span><br><span class="line">a = s;         <span class="comment">// 正确</span></span><br><span class="line">s = a;         <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>泛型：类型参数只影响使用其做为类型一部分的结果类型。<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">NotEmpty</span>&lt;T&gt; &#123; </span><br><span class="line">  <span class="attr">data</span>: T;   <span class="comment">// 注释掉则正确</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">x</span>: <span class="title class_">NotEmpty</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">y</span>: <span class="title class_">NotEmpty</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">x = y;       <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="子类型与赋值"><a href="#子类型与赋值" class="headerlink" title="子类型与赋值"></a>子类型与赋值</h3><blockquote>
<p>TS 有两种类型的兼容性：子类型与赋值。它们的区别在于，赋值扩展了子类型兼容，允许和 any 来回赋值，以及 enum 和对应数字值之间的来回赋值。实际上，类型兼容性是由赋值兼容性来控制的，包括 implements、extends 语句。</p>
</blockquote>
<h2 id="类型保护"><a href="#类型保护" class="headerlink" title="类型保护"></a>类型保护</h2><blockquote>
<p>通过类型判断等方式在特定语句块中确定变量的类型，从而可以放心地访问它的属性和方法。TS 支持的四种方式如下：</p>
</blockquote>
<ul>
<li>in：判断一个属性&#x2F;方法是否属于某对象，比如 <code>a in obj</code>。</li>
<li>typeof：判断基本类型，比如 <code>typeof b === &#39;number&#39;</code>。</li>
<li>instanceof：判断一个实例是否属于某个类，比如 <code>x instanceof ClassX</code>。</li>
<li>类型保护函数：当判断逻辑复杂时，可以自定义返回值是一个 类型谓词的判断函数。</li>
</ul>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义类型保护函数</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">name</span>: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> name === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(name.<span class="property">length</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型保护函数：类型谓词为 name is Type</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isFish</span>(<span class="params">pet: Fish | Bird</span>): pet is <span class="title class_">Fish</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (&lt;<span class="title class_">Fish</span>&gt;pet).<span class="property">swim</span> !== <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isFish</span>(pet)) &#123;  <span class="comment">// pet 是 Fish 类型</span></span><br><span class="line">    pet.<span class="title function_">swim</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    pet.<span class="title function_">fly</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h2><blockquote>
<p>对已知的一些类型通过 type 定义新名字以避免重复。它和接口的区别如下：</p>
</blockquote>
<ul>
<li>类型别名不能使用 extends、implement。</li>
<li>接口创建了一个新名字，可以在其他任何地方使用。类型别名并不创建新名字。</li>
<li>如果无法通过接口描述一个类型而需要使用联合&#x2F;元组类型，则一般可以选择类型别名。</li>
</ul>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Name</span> = <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">NameResolver</span> = <span class="function">() =&gt;</span> <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">NameOrResolver</span> = <span class="title class_">Name</span> | <span class="title class_">NameResolver</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getName</span>(<span class="params">n: NameOrResolver</span>): <span class="title class_">Name</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> n;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">n</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Container</span> &lt;T&gt; =  &#123;<span class="attr">value</span>: T&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性中引用</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Tree</span> &lt;T&gt; = &#123;</span><br><span class="line">  <span class="attr">value</span>: T;</span><br><span class="line">  <span class="attr">left</span>: <span class="title class_">Tree</span> &lt;T&gt;;   </span><br><span class="line">  <span class="attr">right</span>: <span class="title class_">Tree</span> &lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配合交叉类型使用</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LinkedList</span> &lt;T&gt; = T &amp; &#123; <span class="attr">next</span>: <span class="title class_">LinkedList</span> &lt;T&gt; &#125;;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">people</span>: <span class="title class_">LinkedList</span>&lt;<span class="title class_">Person</span>&gt;;</span><br><span class="line"><span class="keyword">var</span> s = people.<span class="property">name</span>;</span><br><span class="line"><span class="keyword">var</span> s = people.<span class="property">next</span>.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错：类型别名不能出现在声明右侧的任何地方</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Yikes</span> = <span class="title class_">Array</span>&lt;<span class="title class_">Yikes</span>&gt;;</span><br></pre></td></tr></table></figure>


<h1 id="二、高级类型"><a href="#二、高级类型" class="headerlink" title="二、高级类型"></a>二、高级类型</h1><h2 id="交叉类型"><a href="#交叉类型" class="headerlink" title="交叉类型"></a>交叉类型</h2><blockquote>
<p>通过 <code>&amp;</code> 获取多个类型的并集，与继承的区别是继承可以有自己的属性而交叉没有。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> extend&lt;T, U&gt;(<span class="attr">first</span>: T, <span class="attr">second</span>: U): T &amp; U &#123;</span><br><span class="line">  <span class="keyword">const</span> result = &lt;T &amp; U&gt;&#123;&#125;;</span><br><span class="line">  for (let id in first) &#123;</span><br><span class="line">      (&lt;T&gt;result)[id] = first[id];</span><br><span class="line">  &#125;</span><br><span class="line">  for (let id in second) &#123;</span><br><span class="line">    if (!result.hasOwnProperty(id)) &#123;</span><br><span class="line">        (&lt;U&gt;result)[id] = second[id];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const x = extend(&#123; a: &#x27;hello&#x27; &#125;, &#123; b: 42 &#125;);</span><br><span class="line"></span><br><span class="line">// 现在 x 拥有了 a、b 属性</span><br><span class="line">const a = x.a;</span><br><span class="line">const b = x.b;</span><br></pre></td></tr></table></figure>


<h2 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h2><blockquote>
<p>通过 <code>|</code> 获取多个类型中的一个，具体类型需要等到赋值时根据类型推论的规则推断出。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 类型限定</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">number</span> | <span class="built_in">string</span> = <span class="string">&quot;a&quot;</span>;</span><br><span class="line"><span class="comment">// 取值限定</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">string</span> | <span class="built_in">number</span></span>)&#123; &#125;</span><br><span class="line"></span><br><span class="line">a = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">a = <span class="number">20</span>        <span class="comment">// 报错：已经推断出 string</span></span><br></pre></td></tr></table></figure>


<h2 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h2><blockquote>
<p>使用不存在的索引时会返回 undefined 而且没有约束，因此我们需要有对索引的约束。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不使用索引类型：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getValue</span>(<span class="params">obj: <span class="built_in">any</span>,keys: <span class="built_in">string</span>[]</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> keys.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> obj[key]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getValue</span>(obj,[<span class="string">&quot;c&quot;</span>,<span class="string">&quot;f&quot;</span>]))  <span class="comment">// 返回 undefined，没有约束</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用索引类型：T[k][] 表示返回值必须是 obj 中的值组成的列表</span></span><br><span class="line"><span class="keyword">function</span> getValue&lt;T,K <span class="keyword">extends</span> keyof T&gt;(<span class="attr">obj</span>: T, <span class="attr">keys</span>: K[]): T[K][] &#123; </span><br><span class="line">  <span class="keyword">return</span> keys.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> obj[key]); <span class="comment">// keys 中的元素只能是 obj 中的键</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getValue</span>(obj,[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>]));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getValue</span>(obj,[<span class="string">&quot;c&quot;</span>,<span class="string">&quot;f&quot;</span>]));  <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>

<h2 id="映射类型"><a href="#映射类型" class="headerlink" title="映射类型"></a>映射类型</h2><blockquote>
<p>从旧类型中创建新类型的一种方式，比如将接口中的所有成员变成只读、可选。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Obj</span>&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">b</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">c</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将所有属性变为只读，生成一个新接口</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ReadonlyObj</span> = <span class="title class_">Readonly</span>&lt;<span class="title class_">Obj</span>&gt;;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Readonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将所有属性变为可选</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PartialObj</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Obj</span>&gt;;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Partial</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取原类型的子集：两个等同</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PickObj</span> = <span class="title class_">Pick</span>&lt;<span class="title class_">Obj</span>,<span class="string">&#x27;a&#x27;</span>|<span class="string">&#x27;b&#x27;</span>&gt;;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PickObj</span> &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="条件类型"><a href="#条件类型" class="headerlink" title="条件类型"></a>条件类型</h2><blockquote>
<p>指由表达式所决定的类型，它使类型具有了不唯一性并增加了语言的灵活性。</p>
</blockquote>
<ul>
<li>实例<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 如果类型 T 可以被赋值给类型 U，name 结果就赋予 X 类型，否则赋予 Y 类型</span></span><br><span class="line">T <span class="keyword">extends</span> U ? X : Y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">TypeName</span>&lt;T&gt; =</span><br><span class="line">  T <span class="keyword">extends</span> <span class="built_in">string</span> ? <span class="built_in">string</span> :</span><br><span class="line">  T <span class="keyword">extends</span> <span class="built_in">number</span> ? <span class="built_in">number</span> :</span><br><span class="line">  T <span class="keyword">extends</span> <span class="built_in">boolean</span> ? <span class="built_in">boolean</span> :</span><br><span class="line">  T <span class="keyword">extends</span> <span class="literal">undefined</span> ? <span class="literal">undefined</span> :</span><br><span class="line">  T <span class="keyword">extends</span> <span class="title class_">Function</span> ? <span class="title class_">Function</span> :</span><br><span class="line">  <span class="built_in">object</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T1</span> = <span class="title class_">TypeName</span>&lt;<span class="built_in">string</span>&gt;;   <span class="comment">// 字符串类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T2</span> = <span class="title class_">TypeName</span>&lt;<span class="built_in">string</span>[]&gt;; <span class="comment">// object 类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T3</span> = <span class="title class_">TypeName</span>&lt;<span class="title class_">Function</span>&gt;; <span class="comment">// function 类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T4</span> = <span class="title class_">TypeName</span>&lt;<span class="built_in">string</span> | <span class="built_in">string</span>[]&gt;; <span class="comment">// string、obj 的联合类型</span></span><br></pre></td></tr></table></figure></li>
<li>应用：类型的过滤<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Diff</span>&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作用是过滤掉第一个参数中的&#x27;a&#x27;。T5 为联合类型 &#x27;b&#x27; | &#x27;c&#x27; </span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T5</span> = <span class="title class_">Diff</span>&lt; <span class="string">&#x27;a&#x27;</span>|<span class="string">&#x27;b&#x27;</span>|<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>|<span class="string">&#x27;e&#x27;</span> &gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析过程</span></span><br><span class="line"><span class="title class_">Diff</span>&lt;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>|<span class="string">&#x27;e&#x27;</span>&gt; | <span class="title class_">Diff</span>&lt;<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>|<span class="string">&#x27;e&#x27;</span>&gt; | <span class="title class_">Diff</span>&lt;<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>|<span class="string">&#x27;e&#x27;</span>&gt;</span><br><span class="line"><span class="built_in">never</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span></span><br><span class="line"><span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>TS 内置<ul>
<li><code>Exclude&lt;T, U&gt;</code>：从 T 中剔除可以赋值给 U 的类型。</li>
<li><code>Extract&lt;T, U&gt;</code>：提取 T 中可以赋值给 U 的类型。</li>
<li><code>NonNullable&lt;T&gt;</code>：从 T 中剔除 null、undefined。</li>
<li><code>ReturnType&lt;T&gt;</code>：获取函数返回值类型。</li>
<li><code>InstanceType&lt;T&gt;</code>：获取构造函数类型的实例类型。<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &quot;b&quot; | &quot;d&quot;</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T0</span> = <span class="title class_">Exclude</span>&lt;<span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span> | <span class="string">&quot;d&quot;</span>, <span class="string">&quot;a&quot;</span> | <span class="string">&quot;c&quot;</span> | <span class="string">&quot;f&quot;</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;a&quot; | &quot;c&quot;</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T1</span> = <span class="title class_">Extract</span>&lt;<span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span> | <span class="string">&quot;d&quot;</span>, <span class="string">&quot;a&quot;</span> | <span class="string">&quot;c&quot;</span> | <span class="string">&quot;f&quot;</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// string | number</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T3</span> = <span class="title class_">NonNullable</span>&lt;<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="literal">undefined</span>&gt;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="可以为-null-的类型"><a href="#可以为-null-的类型" class="headerlink" title="可以为 null 的类型"></a>可以为 null 的类型</h2><blockquote>
<p>TS 有两种特殊的类型 <code>null、undefined</code>，类型检查器默认它们可以赋值给任意类型。<code>--strictNullChecks</code> 标记可以解决此错误：当声明一个变量时，它不会自动包含 null、undefined，但是可以使用联合类型明确的包含它们：</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">s = <span class="literal">null</span>;        <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">sn</span>: <span class="built_in">string</span> | <span class="literal">null</span> = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line">sn = <span class="literal">null</span>;       <span class="comment">// 正确</span></span><br><span class="line">sn = <span class="literal">undefined</span>;  <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>

<h3 id="可选参数-x2F-属性"><a href="#可选参数-x2F-属性" class="headerlink" title="可选参数&#x2F;属性"></a>可选参数&#x2F;属性</h3><blockquote>
<p>使用 strictNullChecks 标记之后默认添加 <code>| undefined</code>。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">x:<span class="built_in">number</span>, y?: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + (y || <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">f</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_">f</span>(<span class="number">1</span>, <span class="literal">undefined</span>);</span><br><span class="line"><span class="title function_">f</span>(<span class="number">1</span>, <span class="literal">null</span>)  <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="built_in">number</span>;</span><br><span class="line">  b?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> <span class="title function_">C</span>();</span><br><span class="line">c.<span class="property">a</span> = <span class="literal">undefined</span>;   <span class="comment">// 报错</span></span><br><span class="line">c.<span class="property">b</span> = <span class="literal">undefined</span>;   <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure>

<h3 id="类型保护和断言"><a href="#类型保护和断言" class="headerlink" title="类型保护和断言"></a>类型保护和断言</h3><blockquote>
<p>由于可以为 null 的类型是通过联合类型实现，那么需要使用类型保护来去除 null。如果编译器不能够去除 null&#x2F;undefined，可以使用类型断言手动去除，语法 <code>identifier!</code> 表示从 identifier 的类型里去除了 null、undefined。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用类型保护来去除 null</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">sn: <span class="built_in">string</span> | <span class="literal">null</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (sn == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;default&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> sn;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 简洁方式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">sn: <span class="built_in">string</span> | <span class="literal">null</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> sn || <span class="string">&quot;default&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用类型断言手动去除 null/undefined</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fixed</span>(<span class="params">name: <span class="built_in">string</span> | <span class="literal">null</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">postfix</span>(<span class="params">epithet: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 去掉 ! 就会报错</span></span><br><span class="line">    <span class="keyword">return</span> name!.<span class="title function_">charAt</span>(<span class="number">0</span>) + <span class="string">&#x27;.  the &#x27;</span> + epithet;</span><br><span class="line">  &#125;</span><br><span class="line">  name = name || <span class="string">&quot;Bob&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">postfix</span>(<span class="string">&quot;great&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="字面量类型"><a href="#字面量类型" class="headerlink" title="字面量类型"></a>字面量类型</h2><blockquote>
<p>分为字符串、数字字面量类型，通过指定一个固定值实现类型约束或区分函数重载</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">gender</span>: <span class="string">&quot;男&quot;</span>| <span class="string">&quot;女&quot;</span>;   <span class="comment">// 只能为是男或女</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>:<span class="string">&quot;A&quot;</span>;               <span class="comment">// 只能为 A</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">user</span>: &#123;              <span class="comment">// 必须有 name、age</span></span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>:<span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNum</span>(<span class="params"></span>): <span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span> | <span class="number">4</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 区分函数重载</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">tagName: <span class="string">&quot;img&quot;</span></span>): <span class="title class_">HTMLImageElement</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">tagName: <span class="string">&quot;input&quot;</span></span>): <span class="title class_">HTMLInputElement</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">tagName: <span class="built_in">string</span></span>): <span class="title class_">Element</span> &#123; &#125;</span><br></pre></td></tr></table></figure>


<h2 id="可辨识联合"><a href="#可辨识联合" class="headerlink" title="可辨识联合"></a>可辨识联合</h2><blockquote>
<p>合并单例类型、联合类型、类型保护和类型别名来创建一个叫做 可辨识联合 的高级模式，它也称为 标签联合、代数数据类型。它在函数式编程很有用处。一些语言会自动地为你辨识联合，TS 则基于已有的 JS 模式。</p>
</blockquote>
<ul>
<li>实现要素<ul>
<li>具有普通的单例类型属性：可辨识的特征。</li>
<li>一个类型别名包含了那些类型的联合：联合。</li>
<li>此属性上的类型保护。<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将要联合的接口：都有 kind 属性但有不同的字符串字面量类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Square</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&quot;square&quot;</span>;</span><br><span class="line">  <span class="attr">size</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&quot;rectangle&quot;</span>;</span><br><span class="line">  <span class="attr">width</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&quot;circle&quot;</span>;</span><br><span class="line">  <span class="attr">radius</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用可辨识联合</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Shape</span> = <span class="title class_">Rectangle</span> | <span class="title class_">Circle</span> | triangle;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">area</span>(<span class="params">s: Shape</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (s.<span class="property">kind</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;rectangle&quot;</span>: <span class="keyword">return</span> s.<span class="property">height</span> * s.<span class="property">width</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;circle&quot;</span>: <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="property">PI</span> * s.<span class="property">radius</span> ** <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 报错：switch 没有包涵所有情况，没有处理 case triangle</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>完整性检查：没有涵盖所有可辨识联合的变化时让编译器通知<ul>
<li>法一：启用 <code>--strictNullChecks</code> 并指定一个返回值类型。</li>
<li>法二：使用 never 类型，用来除去所有可能情况后剩下的类型。<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 报错：TS 认为函数返回值为 number | undefined</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Shape</span> = <span class="title class_">Rectangle</span> | <span class="title class_">Circle</span> | triangle;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">area</span>(<span class="params">s: Shape</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (s.<span class="property">kind</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;rectangle&quot;</span>: <span class="keyword">return</span> s.<span class="property">height</span> * s.<span class="property">width</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;circle&quot;</span>: <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="property">PI</span> * s.<span class="property">radius</span> ** <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertNever</span>(<span class="params">x: <span class="built_in">never</span></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Unexpected object: &quot;</span> + x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">area</span>(<span class="params">s: Shape</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (s.<span class="property">kind</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;square&quot;</span>: <span class="keyword">return</span> s.<span class="property">size</span> * s.<span class="property">size</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;rectangle&quot;</span>: <span class="keyword">return</span> s.<span class="property">height</span> * s.<span class="property">width</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;circle&quot;</span>: <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="property">PI</span> * s.<span class="property">radius</span> ** <span class="number">2</span>;</span><br><span class="line">    <span class="attr">default</span>: <span class="keyword">return</span> <span class="title function_">assertNever</span>(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="多态的-this-类型"><a href="#多态的-this-类型" class="headerlink" title="多态的 this 类型"></a>多态的 this 类型</h2><blockquote>
<p>表示某个包含类或接口的子类型，称为 <code>F-bounded 多态性</code>。它能很容易的表现连贯接口间的继承。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BasicCalculator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">protected</span> value: <span class="built_in">number</span> = <span class="number">0</span></span>) &#123; &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">currentValue</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">add</span>(<span class="attr">operand</span>: <span class="built_in">number</span>): <span class="variable language_">this</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> += operand;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">multiply</span>(<span class="attr">operand</span>: <span class="built_in">number</span>): <span class="variable language_">this</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> *= operand;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// other operations go here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> v = <span class="keyword">new</span> <span class="title class_">BasicCalculator</span>(<span class="number">2</span>)</span><br><span class="line">            .<span class="title function_">multiply</span>(<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">add</span>(<span class="number">1</span>)</span><br><span class="line">            .<span class="title function_">currentValue</span>();</span><br></pre></td></tr></table></figure>



<h1 id="三、命名空间"><a href="#三、命名空间" class="headerlink" title="三、命名空间"></a>三、命名空间</h1><h2 id="单文件"><a href="#单文件" class="headerlink" title="单文件"></a>单文件</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">Page</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IPage</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="attr">data</span>: <span class="built_in">object</span>): <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">IndexPage</span> <span class="keyword">implements</span> <span class="title class_">IPage</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="attr">data</span>: <span class="built_in">object</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&lt;div&gt;Index page content&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用别名：import a = x.y</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Shapes</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">namespace</span> <span class="title class_">Polygons</span> &#123;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Triangle</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Square</span> &#123; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> polygons = <span class="title class_">Shapes</span>.<span class="property">Polygons</span>;</span><br><span class="line"><span class="keyword">let</span> sq = <span class="keyword">new</span> polygons.<span class="title class_">Square</span>();</span><br></pre></td></tr></table></figure>


<h2 id="文件拆分"><a href="#文件拆分" class="headerlink" title="文件拆分"></a>文件拆分</h2><blockquote>
<p>三斜线指令引用当前目录文件：<code>/// &lt;reference path=&quot;./IPage.ts&quot; /&gt;</code>。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// IPage.ts</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Page</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IPage</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="attr">data</span>: <span class="built_in">object</span>): <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IndexPage.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;./IPage.ts&quot; /&gt;</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Page</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">IndexPage</span> <span class="keyword">implements</span> <span class="title class_">IPage</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="attr">data</span>: <span class="built_in">object</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&lt;div&gt;Index page content&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;./IndexPage.ts&quot; /&gt;</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;./DetailPage.ts&quot; /&gt;</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title class_">Page</span>.<span class="title class_">IndexPage</span>().<span class="title function_">render</span>(&#123;<span class="attr">value</span>: <span class="string">&#x27;index&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="命名空间和模块"><a href="#命名空间和模块" class="headerlink" title="命名空间和模块"></a>命名空间和模块</h2><ul>
<li><strong>命名空间</strong><ul>
<li>内部模块，通过 namespace 声明的全局对象，主要用于组织代码并避免命名冲突。</li>
<li>命名空间通过三斜线指令引入，相当于源码嵌入，会引入额外变量到当前作用域。</li>
<li>本质是 IIFE，不存在文件即模块的加载机制约束，算是旧时代的产物，不建议使用。</li>
</ul>
</li>
<li><strong>模块</strong><ul>
<li>外部模块的简称，一个文件即一个模块，主要用于代码复用并解决加载依赖关系。</li>
<li>模块通过 import&#x2F;require 引入，调用时通过变量引用而不会主动影响当前作用域。</li>
<li>TS 遵从文件即模块的 ES Module 规范，通过编译可以输出 CommonJS、AMD、UMD 等模块形式，推荐使用。</li>
</ul>
</li>
</ul>
<h1 id="四、声明合并"><a href="#四、声明合并" class="headerlink" title="四、声明合并"></a>四、声明合并</h1><blockquote>
<p>编译器将多个地方具有相同名称的声明合并为一个，合并后的声明同时拥有原先所有声明的特性。TS 声明会创建出声明实体中的一至三类，比如一个 namespace 会创建出 namespace、value，声明实体可以在一定条件下进行合并。</p>
</blockquote>
<h2 id="声明分类"><a href="#声明分类" class="headerlink" title="声明分类"></a>声明分类</h2><ul>
<li><strong>声明实体</strong><ul>
<li><strong>命名空间 namespace</strong>：指声明的分类而非实体。建立应用时需要通过 <code>import</code>，如果使用 <code>const/let/var</code> 则会使新的实体不再具有命名空间的属性。</li>
<li><strong>类型 type</strong>：可以描述一个值的形状，它只能存在于命名空间。它可以是写在变量声明时冒号右边的部分，也可以是类型别名的值 (<code>type Foo = string;</code>)。</li>
<li><strong>值 value</strong>：编译为 js 后唯一会被保留的一种，命名空间与类型都会被清除。</li>
</ul>
</li>
<li><strong>声明及其实体</strong><ul>
<li>**命名空间 (namespace)**：命名空间、值。一个命名空间实体如果不包含值的声明则只属于命名空间一类。</li>
<li>**类 (class)**：类型、值</li>
<li>**枚举 (enum)**：类型、值</li>
<li>**接口 (interface)**：类型</li>
<li>**类别名 (type)**：类型</li>
<li>**函数 (function)**：值</li>
<li>**变量 (let、const、var、parameters)**：值</li>
</ul>
</li>
</ul>
<h2 id="声明合并"><a href="#声明合并" class="headerlink" title="声明合并"></a>声明合并</h2><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><blockquote>
<p>将双方的成员放到一个同名的接口。</p>
</blockquote>
<ul>
<li>对于非函数成员，必须类型一致，否则报错。</li>
<li>对于函数成员，会发生重载，重载的顺序按照以下规则。<ul>
<li>接口内部按照先后顺序。接口之间，声明在后的接口函数成员排序更靠前。</li>
<li>如果参数类型为单一的字符串字面量，排名最靠前。后面的接口的排在第一位，前面接口的排在第二位。</li>
</ul>
</li>
</ul>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 接口合并</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Box</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">string</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Box</span> &#123;</span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">foo</span>(<span class="attr">bar</span>: <span class="built_in">string</span>[]): <span class="built_in">string</span>[],</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">box</span>: <span class="title class_">Box</span> = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">y</span>: <span class="string">&quot;15&quot;</span>,</span><br><span class="line">  <span class="title function_">foo</span>(<span class="params">bar: <span class="built_in">any</span></span>) &#123; <span class="keyword">return</span> bar &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注释为合并后的函数排序</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">StateMerge</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="title function_">foo</span>(<span class="attr">bar</span>: <span class="built_in">number</span>): <span class="built_in">number</span>;   <span class="comment">// 4</span></span><br><span class="line">  <span class="title function_">foo</span>(<span class="attr">bar</span>: <span class="built_in">string</span>): <span class="built_in">string</span>;   <span class="comment">// 5</span></span><br><span class="line">  <span class="title function_">foo</span>(<span class="attr">bar</span>: <span class="string">&quot;b&quot;</span>): <span class="built_in">number</span>;      <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">StateMerge</span> &#123;</span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">foo</span>(<span class="attr">bar</span>: <span class="built_in">string</span>[]): <span class="built_in">string</span>[],  <span class="comment">// 3</span></span><br><span class="line">  <span class="title function_">foo</span>(<span class="attr">bar</span>: <span class="string">&quot;a&quot;</span>): <span class="built_in">number</span>,         <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><ul>
<li>同名的 namespace 也会合并导出的成员。</li>
<li>注意合并后的命名空间成员无法访问非导出成员。</li>
</ul>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">Box</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isFlag</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 合并后会报错：flag 并没有导出</span></span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="命名空间与类、函数、枚举"><a href="#命名空间与类、函数、枚举" class="headerlink" title="命名空间与类、函数、枚举"></a>命名空间与类、函数、枚举</h3><ul>
<li>可以用来扩展 class、function、Enum。</li>
<li>注意合并时需要将命名空间放在它们的后面，否则会报错。</li>
</ul>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 命名空间和类：相当于为类 C 添加了属性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> C&#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">let</span> state = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(C.<span class="property">state</span>);   <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 命名空间和函数：相当于为函数 Lib 添加了属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Lib</span>(<span class="params"></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Lib</span>.<span class="property">version</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Lib</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">let</span> version = <span class="string">&quot;1.0&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Lib</span>());   <span class="comment">// 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 命名空间和枚举类型</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  red = <span class="number">1</span>,</span><br><span class="line">  green = <span class="number">2</span>,</span><br><span class="line">  blue = <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mixColor</span>(<span class="params">colorName: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (colorName === <span class="string">&#x27;yellow&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Color</span>.<span class="property">red</span> + <span class="title class_">Color</span>.<span class="property">green</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (colorName === <span class="string">&#x27;white&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Color</span>.<span class="property">red</span> + <span class="title class_">Color</span>.<span class="property">green</span> + <span class="title class_">Color</span>.<span class="property">blue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (colorName == <span class="string">&quot;magenta&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Color</span>.<span class="property">red</span> + <span class="title class_">Color</span>.<span class="property">blue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (colorName == <span class="string">&quot;cyan&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Color</span>.<span class="property">green</span> + <span class="title class_">Color</span>.<span class="property">blue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="非法合并"><a href="#非法合并" class="headerlink" title="非法合并"></a>非法合并</h2><blockquote>
<p>TS 并非允许所有的合并，目前不支持 class 与其它 class、变量合并。模仿类的合并可以参考 TypeScript Mixins (混入)。</p>
</blockquote>
<h1 id="五、装饰器"><a href="#五、装饰器" class="headerlink" title="五、装饰器"></a>五、装饰器</h1>  <div style="text-indent: 2em">一种特殊类型的声明，能够被附加到类声明、方法、访问符、属性或参数而用于监视、修改或替换其定义。它可以看作是在原有代码外层包装了一层处理逻辑来增强代码功能，比如对参数的类型判断、对返回值的排序过滤、对函数添加节流、防抖。目前它还属于实验性语法，你必须在命令行或 `tsconfig.json` 启用编译选项：</div>

  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 命令行</span></span><br><span class="line">tsc --target <span class="title class_">ES5</span> --experimentalDecorators</span><br><span class="line"></span><br><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;ES5&quot;</span>,   <span class="comment">// 方法修饰器时需配置为 es6</span></span><br><span class="line">    <span class="string">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>使用形式为 <code>@expression</code>，expression 必须是一个函数。它的本质是代码编译时执行的函数，注意不是 TS 编译而是 JS 执行的编译阶段。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// hello.ts：执行命令 tsc 编译、node helloword.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">helloWord</span>(<span class="params">target: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello Word!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@helloWord</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWordClass</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个装饰器可以同时应用到一个声明时，可以在同行或多行</span></span><br><span class="line"><span class="meta">@f</span> <span class="meta">@g</span> x</span><br><span class="line"></span><br><span class="line"><span class="meta">@f</span></span><br><span class="line"><span class="meta">@g</span></span><br><span class="line">x</span><br></pre></td></tr></table></figure>


<h2 id="常用类型"><a href="#常用类型" class="headerlink" title="常用类型"></a>常用类型</h2><blockquote>
<p>注意没有函数装饰器，不能使用在声明文件和任何外部上下文。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、类装饰器</span></span><br><span class="line"><span class="keyword">function</span> addPropsAndMethods&lt;T <span class="keyword">extends</span> &#123; <span class="title function_">new</span>(...<span class="attr">args</span>: <span class="built_in">any</span>[]): &#123;&#125; &#125;&gt;(<span class="attr">target</span>: T)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> target &#123;</span><br><span class="line">    word = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">    printWord = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.word&#125;</span>!`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @addAge(18)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addAge</span>(<span class="params">args: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target: <span class="built_in">Function</span></span>) &#123;</span><br><span class="line">    target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> = args;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、属性装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">writableProperty</span>(<span class="params">flag: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="comment">// target：对于静态成员是类的构造函数，对于实例成员是类的原型对象。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target: <span class="built_in">any</span>, propName: <span class="built_in">string</span> | <span class="built_in">symbol</span></span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, propName, &#123;</span><br><span class="line">      <span class="attr">writable</span>: flag</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、方法装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">editableMethod</span>(<span class="params">flag: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target: <span class="built_in">any</span>, methodName: <span class="built_in">string</span> | <span class="built_in">symbol</span>, descriptor: PropertyDescriptor</span>) &#123;</span><br><span class="line">    descriptor.<span class="property">writable</span> = flag;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、参数装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printArgs</span>(<span class="params">target: <span class="built_in">any</span>, methodName: <span class="built_in">string</span> | <span class="built_in">symbol</span>, paramIndex: <span class="built_in">number</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// paramIndex：参数在函数参数列表中的索引</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target, methodName, paramIndex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5、存取器装饰器：TS 不允许为单个成员装饰 get、set 访问器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">configurable</span>(<span class="params">value: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target: <span class="built_in">any</span>, propName: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) &#123;</span><br><span class="line">    descriptor.<span class="property">configurable</span> = value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@addPropsAndMethods</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DummyClass</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类的属性默认可以被写入</span></span><br><span class="line">    <span class="meta">@writableProperty</span>(<span class="literal">true</span>)</span><br><span class="line">    <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">bornY</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">_domain</span>:<span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name:<span class="built_in">string</span>, bornY:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">      &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Error:&#x27;</span>,e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">bornY</span> = bornY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">printData</span>(<span class="params">prefix: <span class="built_in">string</span>, <span class="meta">@printArgs</span> printAll:<span class="built_in">boolean</span></span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (printAll)&#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="variable language_">this</span>.<span class="property">bornY</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不允许修改该方法</span></span><br><span class="line">    <span class="meta">@editableMethod</span>(<span class="literal">false</span>)</span><br><span class="line">    <span class="title function_">dummyMethod</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hi&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存取器装饰器</span></span><br><span class="line">    <span class="meta">@configurable</span>(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">data</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>+<span class="string">&#x27;@&#x27;</span>+ <span class="variable language_">this</span>.<span class="property">bornY</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@configurable</span>(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">domain</span>(<span class="params">value: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_domain</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">domain</span>():<span class="built_in">string</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_domain</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">DummyClass</span>(<span class="string">&quot;Jack Ma&quot;</span>, <span class="number">1981</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;类的装饰器：为类添加方法、属性和默认属性值&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((&lt;<span class="built_in">any</span>&gt;d).<span class="title function_">helloWorld</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;属性的装饰器)&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;方法的装饰器：让方法不可被修改，下面的修改无效&#x27;</span>);</span><br><span class="line">d.<span class="title function_">dummyMethod</span>();</span><br><span class="line">d.<span class="property">dummyMethod</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hi there!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">d.<span class="title function_">dummyMethod</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;存取器装饰器&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line">d.<span class="property">domain</span> = <span class="string">&quot;coolwp.com&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d.<span class="property">domain</span>);</span><br></pre></td></tr></table></figure>

<h2 id="加载顺序"><a href="#加载顺序" class="headerlink" title="加载顺序"></a>加载顺序</h2><ul>
<li>类装饰器总是最后执行。</li>
<li>方法和方法参数中参数装饰器先执行。</li>
<li>有多个参数装饰器时从最后一个依次向前执行。</li>
<li>方法和属性装饰器，谁在前面谁先执行。因为参数是方法一部分，所以参数会一直紧挨着方法执行。</li>
</ul>
<h1 id="六、JSX"><a href="#六、JSX" class="headerlink" title="六、JSX"></a>六、JSX</h1><blockquote>
<p>全称 <code>JavaScript XML</code>，React 发明的一种类似 XML 的 JS 扩展语法，主要用于创建虚拟 DOM 并可以编译为 JS 对象，编译的基本规则为：<code>&lt; 开头的代码以 HTML 语法解析、&#123; 开头的代码以 JS 语法解析</code>。TS 支持嵌入、类型检查和直接编译 JSX 为有效的 JS。</p>
</blockquote>
<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><ul>
<li><strong>使用前提</strong>：使用 tsx 文件、启用 jsx 选项。</li>
<li><strong>类型断言</strong>：tsx 文件中的类型断言必须使用 as 操作符，因为使用尖括号表示类型断言时结合 JSX 语法后将带来解析上的困难。</li>
<li><strong>编译模式</strong>：仅影响编译阶段，类型检查不受影响。可以通过在命令行使用 <code>--jsx</code> 标记或者在 <code>tscofnig.json</code> 文件中指定选项。<ul>
<li><strong>preserve</strong>：将保持 JSX 作为部分输出以用于 Babel 等变换时编译。输出 .jsx 文件。</li>
<li><strong>react</strong>：调用 <code>React.createElement</code> 而不需要经过 JSX 转换，输出 .js 文件。 </li>
<li><strong>react-native</strong>：相当于保留，因为它保留了所有 JSX。输出 .js 文件。</li>
</ul>
</li>
<li><strong>结果类型</strong>：默认是 any 类型，可以通过指定 <code>JSX.Element</code> 接口实现自定义类型，但是不能从接口里检索元素、属性或子元素的类型信息。</li>
</ul>
<h2 id="类型检查"><a href="#类型检查" class="headerlink" title="类型检查"></a>类型检查</h2><blockquote>
<p>假设有一个 JSX 表达式 <code>&lt;expr /&gt;</code>，expr 可能是固有元素(环境自带的东西，比如 DOM 环境的 div、span)，也可能是基于值的元素(自定义组件)。TS 使用与 React 相同的规范来区别它们：<code>固有元素总是以一个小写字母开头，基于值的元素总是以一个大写字母开头</code>。</p>
</blockquote>
<h3 id="固有元素"><a href="#固有元素" class="headerlink" title="固有元素"></a>固有元素</h3><blockquote>
<p>使用特殊接口 JSX.IntrinsicElements 来查找。如果这个接口没有指定，则不对固有元素进行类型检查而全部通过。如果接口存在，则固有元素的名字需要在接口的属性里查找。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 没有 JSX.IntrinsicElements 里指定的就会报错。</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> JSX　&#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">IntrinsicElements</span> &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="built_in">any</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;foo /&gt;    <span class="comment">// 正确</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">bar</span> /&gt;</span></span>    <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定一个用来捕获所有字符串索引</span></span><br><span class="line">declate <span class="keyword">namespace</span> JSX &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">IntrinsicElements</span> &#123;</span><br><span class="line">    [<span class="attr">elemName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="基于值的元素"><a href="#基于值的元素" class="headerlink" title="基于值的元素"></a>基于值的元素</h3><blockquote>
<p>在它所在的作用域里按照标识符查找。它有两种定义方式：<strong>无状态函数组件 SFC、类组件</strong>，由于它们在 JSX 表达式里无法区分，TS 解析时会先将表达式作为无状态函数组件，解析成功则完成操作，否则以类组件的形式进行解析，依旧失败则抛出错误。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MyCom</span> <span class="keyword">from</span> <span class="string">&#x27;./myCom&#x27;</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyCom</span> /&gt;</span></span>         <span class="comment">// 正确</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">OtherCom</span> /&gt;</span></span>      <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无状态函数组件：返回值可以赋值给 JSX.Element</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FooProp</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">X</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">Y</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> <span class="title function_">AnotherCom</span>(<span class="params">prop: &#123;name: <span class="built_in">string</span>&#125;</span>);  <span class="comment">// declare 声明文件或模块</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ComFoo</span>(<span class="params">prop: FooProp</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">AnotherCom</span> <span class="attr">name</span>=<span class="string">&#123;prop.name&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Button</span> = (<span class="params">prop: &#123;value: <span class="built_in">string</span>&#125;, context: &#123;color: <span class="built_in">string</span>&#125;</span>) =&gt; &lt;button&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类组件：元素的实例类型必须赋值给 JSX.ElementClass，否则抛出错误。</span></span><br><span class="line"><span class="comment">// 元素类的类型：MyComponent、MyFactoryFn</span></span><br><span class="line"><span class="comment">// 元素实例的类型： &#123; render: () =&gt; void &#125;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> JSX &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">ElementClass</span> &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="built_in">any</span>;  <span class="comment">// 如果没有 render 方法则会报错。</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyFactoryFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">render</span>: <span class="function">() =&gt;</span> &#123;&#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">MyComponent</span> /&gt;;    <span class="comment">// 正确</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyFactoryFn</span> /&gt;</span></span>;    <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure>


<h3 id="属性类型检查"><a href="#属性类型检查" class="headerlink" title="属性类型检查"></a>属性类型检查</h3><ol>
<li>确定元素属性类型<br>* 固有元素：JSX.IntrinsicElements 接口中的属性类型。<br>* 基于值的元素：元素实例类型上的 JSX.ElementAttributesProperty 指定属性的类型，没有指定则使用类元素构造函数或 SFC 调用的第一个参数的类型。</li>
<li>JSX 里进行属性检查<br>* 支持可选属性、必选属性。<br>* 如果一个属性名不是个合法的 JS 标识符(比如 data-* 属性)，并且它没有出现在元素属性类型里时不会报错。<br><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 固有元素 foo：&#123;bar?: boolean&#125;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> JSX &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">IntrinsicElements</span> &#123;</span><br><span class="line">    <span class="attr">foo</span>: &#123;</span><br><span class="line">      <span class="attr">required</span>: <span class="built_in">string</span>; </span><br><span class="line">      bar?: <span class="built_in">boolean</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;foo required=<span class="string">&quot;a&quot;</span> /&gt;;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">foo</span> <span class="attr">required</span>=<span class="string">&quot;a&quot;</span> <span class="attr">bar</span> /&gt;</span></span>;</span><br><span class="line"><span class="comment">// 正确：some-unknown 不是合法的标识符</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">foo</span> <span class="attr">required</span>=<span class="string">&quot;a&quot;</span> <span class="attr">some-unknown</span> /&gt;</span></span>;</span><br><span class="line"><span class="comment">// 报错：缺少必须属性、unknown 不存在</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">foo</span> /&gt;</span></span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">foo</span> <span class="attr">required</span>=<span class="string">&quot;a&quot;</span> <span class="attr">unknown</span> /&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于值的元素 MyCom：&#123;foo?: string&#125;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> JSX &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">ElementAttributesProperty</span> &#123;</span><br><span class="line">    props;     <span class="comment">// 指定属性名</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCom</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;  <span class="comment">// 在元素实例类型上指定属性</span></span><br><span class="line">    foo?: <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">MyCom</span> foo=<span class="string">&quot;bar&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="子孙类型检查"><a href="#子孙类型检查" class="headerlink" title="子孙类型检查"></a>子孙类型检查</h3>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">PropsType</span> &#123;</span><br><span class="line">  <span class="attr">children</span>: <span class="variable constant_">JSX</span>.<span class="property">Element</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;<span class="title class_">PropsType</span>, &#123;&#125;&gt; &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;this.props.children&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line">&lt;<span class="title class_">Component</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Component</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错：JSX.Element 不是数组类型</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Component</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Component</span>&gt;</span></span></span><br></pre></td></tr></table></figure>


<h2 id="React-集成"><a href="#React-集成" class="headerlink" title="React 集成"></a>React 集成</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 React 类型定义</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;react.d.ts&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCom</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;<span class="title class_">Props</span>, &#123;&#125;&gt; &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;this.props.foo&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line">&lt;<span class="title class_">MyCom</span> foo=<span class="string">&quot;bar&quot;</span> /&gt;; </span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">foo</span>=<span class="string">&#123;0&#125;</span> /&gt;</span></span>; </span><br></pre></td></tr></table></figure>


<h2 id="工厂函数"><a href="#工厂函数" class="headerlink" title="工厂函数"></a>工厂函数</h2><blockquote>
<p><code>jsx: react</code> 编译选项用的工厂函数是可以配置的。可以使用 <code>jsxFactory</code> 命令行选项，或者内联的 <code>@jsx</code> 注释指令在每个文件上设置。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置 jsxFactory：调用 createElement(&quot;div&quot;) 而非 React.createElement(&quot;div&quot;)</span></span><br><span class="line"><span class="keyword">import</span> preact = <span class="built_in">require</span>(<span class="string">&quot;preact&quot;</span>);</span><br><span class="line"><span class="comment">/* @jsx preact.h */</span></span><br><span class="line"><span class="keyword">const</span> x = <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> /&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line"><span class="keyword">const</span> preact = <span class="built_in">require</span>(<span class="string">&#x27;preact&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> x =  preact.<span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>JS 扩展</category>
      </categories>
      <tags>
        <tag>JS 扩展</tag>
      </tags>
  </entry>
  <entry>
    <title>TypeScript 简介和数据类型</title>
    <url>/2019/11/03/11-1-typescript%20%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="一、入门简介"><a href="#一、入门简介" class="headerlink" title="一、入门简介"></a>一、入门简介</h1><div style="text-indent: 2em">TypeScript 是微软推出的一种静态强类型语言，设计初衷就是为了**帮助 JS 开发人员能够像 C#、Java 等高级语言那样编写代码**，比如使用高级语言的强类型、面向对象、语法检查、代码编译等特性。它是 JS 的超集(基于 JS 并拓展了其语法)，填充了 JS 作为动态弱类型语言的缺点，能够对代码中的错误及时反馈并可以将 TS 代码转为原生 JS，非常适用于团队合作的大型项目和封装库文件 (比较严谨)。</div>

<h2 id="语言类型"><a href="#语言类型" class="headerlink" title="语言类型"></a>语言类型</h2><ul>
<li><strong>动态类型语言</strong>：在运行期间检查数据类型的语言。永远不需要指定变量的数据类型，该语言会在变量被首次赋值时在内部记录数据类型。</li>
<li><strong>静态类型语言</strong>：在编译期间检查数据类型的语言。变量在使用前要声明数据类型，好处是把类型检查放在编译期，可以提前检查可能出现的类型错误。</li>
<li><strong>强类型语言</strong>：强制数据类型定义的语言。变量只要不经过强制转换就不会改变数据类型，不允许隐式的类型转换。</li>
<li><strong>弱类型语言</strong>：数据类型可以被忽略的语言。变量声明后可以改变数据类型，而且允许编译器进行隐式的类型转换。</li>
</ul>
<h2 id="出现原因"><a href="#出现原因" class="headerlink" title="出现原因"></a>出现原因</h2><ol>
<li><strong>JavaScript 发展迅速</strong></li>
<li><strong>我们需要强类型的 JavaScript</strong><br>* 强类型特性可以防止编写 JS 代码时因为数据类型的转换造成的意外错误。<br>* 比如函数的参数必须是数字类型，使用原生 JS 时会正常执行而并不会提示错误，这样会增加项目开发的潜在风险。</li>
<li><strong>按需输出 JavaScript 版本</strong><br>* JS 版本现在几乎每年都有更新，兼容性的脚本对于开发者是一个比较大的挑战。<br>* TypeScript 解决了版本问题，你可以按需输出 JS 脚本，比如 ES3、ES5 、ES6 。</li>
<li><strong>代码标准化利于团队开发</strong><br>* 由于 JS 本身语言的特点和其版本迭代太快的原因，团队成员使用 JS 时很容易随意发挥而不受规范约束。<br>* 团队当然可以针对不同版本的 JS 做出使用规范并引入 eslint 等质量检测插件，整理这些内容并推广使用比较浪费时间，还不如基于 TypeScript 并整理一套标准来应对 JS 版本不断的更新迭代。</li>
<li><strong>主流框架及最新特性的支持</strong><br>* Angular 等主流框架都已经集成 TypeScript 来解决版本兼容性和弱语言的特点。<br>* TypeScript 紧跟 JS 的发展，比如 ES7、ES8、ES9 的新特性都支持，比浏览器支持的速度更快。这就意味着你能用最新的语言特性，编写质量更高的 JS。</li>
</ol>
<h2 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h2><ul>
<li>JS 缺点<ul>
<li>开发工具不够智能。</li>
<li>弱类型，缺乏必要的类型检查。</li>
<li>代码不可分割，可维护性较差。</li>
<li>编程不够语义化，代码可阅读性差。</li>
</ul>
</li>
<li>TS 优势<ul>
<li>完全兼容 JS，并且集成简单。</li>
<li>强类型：编译期有静态类型检查。 </li>
<li>IDE 智能提示和重构：TS 可以轻松更改某个全局变量名。</li>
<li>语义化编程和面向对象：类型声明本身是最好查阅的文档，代码可读性高。</li>
</ul>
</li>
<li>TS 趋势<ul>
<li>替代 Javascript</li>
<li>更多的 IDE 支持</li>
<li>不断丰富的 Javascript 库支持</li>
</ul>
</li>
</ul>
<h2 id="开发调试"><a href="#开发调试" class="headerlink" title="开发调试"></a>开发调试</h2><ol>
<li><strong>安装工具</strong>：IDE 推荐使用 <code>VSCode + ESLint</code>、TS <code>npm install -g typescript</code></li>
<li><strong>编译方式</strong>：手动编译 <code>tsc test.ts</code>，自动编译则可以通过 vscode 配置直接编译或者 webpack&#x2F;gulp 配置打包时编译。<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、vscode</span></span><br><span class="line">构建任务：ctrl + shift + b</span><br><span class="line">运行任务：build (编译一次)、watch (变动就编译)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、webpack.config.js：需要先安装 ts-loader</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.ts&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;./dist/bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>配置编译选项</strong><br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json：项目根目录执行 `tsc --init`</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 编译后生成的 JS 标准（es3、es5、es2015、ES2016)</span></span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="comment">// 代码模块加载器 (commonjs、AMD、es2015)</span></span><br><span class="line">    <span class="string">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">    <span class="comment">// 编译 js 时删除注释</span></span><br><span class="line">    <span class="string">&quot;removeComments&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// false：编译器无法判断变量使用判断类型时使用 any 类型</span></span><br><span class="line">    <span class="comment">// true：进行强类型检查，编译器无法判断出变量类型时会报错</span></span><br><span class="line">    <span class="string">&quot;noImplicitAny&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 生成的 js、js.map 的目录</span></span><br><span class="line">    <span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;./dist&quot;</span>,</span><br><span class="line">    <span class="comment">// 允许在 ts 文件中打断点</span></span><br><span class="line">    <span class="string">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 允许编译 js 文件</span></span><br><span class="line">    <span class="string">&quot;allowJs&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 需要排除编译的目录</span></span><br><span class="line">  <span class="string">&quot;exclude&quot;</span>: [<span class="string">&quot;node_modules&quot;</span>],</span><br><span class="line">  <span class="comment">// 需要编译的 ts 文件：* 表示文件匹配、** 表示忽略文件的深度问题</span></span><br><span class="line">  <span class="string">&quot;include&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;./src/*.ts&quot;</span>,</span><br><span class="line">    <span class="string">&quot;./src/**/*.ts&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>配置调试环境</strong><br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .vscode/launch.json：调试时会将 ts 编译成 js 执行、sourcemap 定位</span></span><br><span class="line"><span class="string">&quot;configurations&quot;</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="string">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Typescript&quot;</span>,</span><br><span class="line">    <span class="string">&quot;program&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/src/index.ts&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preLaunchTask&quot;</span>: <span class="string">&quot;tsc: build - tsconfig.json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sourceMaps&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;outFiles&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;$&#123;workspaceFolder&#125;/**/*.js&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="二、基础数据"><a href="#二、基础数据" class="headerlink" title="二、基础数据"></a>二、基础数据</h1><h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><blockquote>
<p>类型只是一组值。JS 的所有类型都是动态的，你可以在运行时使用它们。TS 为 JS 额外带来了静态类型，可以在编译期间对值所具有的结构进行类型检查而无需运行代码。</p>
</blockquote>
<ul>
<li>JS 类型：Boolean、Number、String、Object、Symbol、null、undefined。</li>
<li>新增类型：Tuple (元组)、Enum (枚举)、Any (任意)、Void (空值)、Never (永不存在的值)、unknown (类型不确定的值)。</li>
</ul>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">num</span>: <span class="built_in">number</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">str</span>: <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">isDone</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">num = <span class="string">&#x27;123&#x27;</span>;     <span class="comment">// 报错</span></span><br><span class="line">str = <span class="number">123</span>;       <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array：各元素的类型必须相同</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">arr</span>:<span class="built_in">boolean</span>[] = [<span class="literal">true</span>, <span class="literal">false</span>];  <span class="comment">// 通过元素类型后面添加 []</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">arr</span>:<span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>];  <span class="comment">// 使用数组泛型：Array&lt;类型&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Tuple：一个有不同数据类型的数组，参数和类型一一对应 (不能缺少)</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">x</span>:[<span class="built_in">string</span>, <span class="built_in">number</span>];</span><br><span class="line">x = [<span class="string">&#x27;hello&#x27;</span>, <span class="number">10</span>];  <span class="comment">// OK</span></span><br><span class="line">x = [<span class="number">10</span>, <span class="string">&#x27;hello&#x27;</span>];  <span class="comment">// Error</span></span><br><span class="line">x[<span class="number">3</span>] = <span class="string">&#x27;world&#x27;</span>;     <span class="comment">// OK，访问越界元素时使用联合类型(str、num)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Enum：通过语义化的单词来代表某一状态，相比数值更加直观和易读</span></span><br><span class="line"><span class="comment">// 枚举值为 数字或字符串，默认从 0 开始递增，赋值后后面的值递增</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Status</span> &#123;success = <span class="number">1</span>, error = <span class="number">2</span>, cancel, wait&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">flag</span>:<span class="title class_">Status</span> = <span class="title class_">Status</span>.<span class="property">success</span>;  <span class="comment">// 枚举值 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Status</span>[<span class="number">2</span>]);            <span class="comment">// 根据枚举值获取变量名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Any：相当于关闭类型检查，尽量不用</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">notSure</span>:<span class="built_in">any</span> = <span class="number">4</span>;</span><br><span class="line">notSure = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">list</span>:<span class="built_in">any</span>[] = [<span class="number">1</span>, <span class="literal">true</span>, <span class="string">&quot;free&quot;</span>];</span><br><span class="line">list[<span class="number">1</span>] = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// undefined：void 的一个子集</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Void：只能用于返回空值的函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">warnUser</span>(<span class="params"></span>):<span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This is my warning message&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Props</span> = &#123;</span><br><span class="line">  <span class="attr">getValue</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;  <span class="comment">// 不关注返回值类型，number、string 等都可以</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// null、undefined：默认是所有类型的子类型，可以赋值给任意类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">u</span>: <span class="built_in">number</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Never：用于永远不会结束的函数，是所有类型的子类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">message: <span class="built_in">string</span></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;never&quot;</span>);     <span class="comment">// 无法运行到的代码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>): <span class="built_in">never</span> &#123; </span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">1</span>; </span><br><span class="line">  <span class="keyword">while</span>(count)&#123; count++; &#125;  <span class="comment">// 一个肯定会报错或死循环的函数</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// Object：表示非原始类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">obj</span>:<span class="built_in">object</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;Wang&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">obj</span>:&#123; <span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">age</span>: <span class="built_in">number</span> &#125; = &#123; </span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Wang&quot;</span>, </span><br><span class="line">    <span class="attr">age</span>: <span class="number">25</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unknown：可以任意值赋值，但不可调用</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">foo</span>: <span class="built_in">unknown</span> = <span class="string">&#x27;string&#x27;</span>;</span><br><span class="line">foo.<span class="title function_">substr</span>(<span class="number">1</span>);     <span class="comment">// Error：静态检查不通过报错</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">input: <span class="built_in">unknown</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(input)) &#123;</span><br><span class="line">      <span class="keyword">return</span> input.<span class="property">length</span>;  <span class="comment">// Pass：input 已识别为 array</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> input.<span class="property">length</span>; <span class="comment">// Error: input 还是 unknown，入参 any 则放弃检查</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ! 非空判断：可用在变量名或函数名之后。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onClick</span>(<span class="params">callback?: () =&gt; <span class="keyword">void</span></span>) &#123;</span><br><span class="line">    callback!();  <span class="comment">// 参数是可选入参，加 ! 之后则 TS 编译不报错</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Demo</span>(<span class="params"></span>): <span class="variable constant_">JSX</span>.<span class="property">Elememt</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> divRef = useRef&lt;<span class="title class_">HTMLDivElement</span>&gt;();</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 组件 Mount 后才触发 useEffect，current 一定有值</span></span><br><span class="line">      divRef.<span class="property">current</span>!.<span class="title function_">scrollIntoView</span>();  </span><br><span class="line">    &#125;, []);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;divRef&#125;</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ? 可选：undefined 在非严格模式下会被重新赋值，void 0 会返回 undefined</span></span><br><span class="line">obj?.<span class="property">prop</span>  obj?.[index]  func?.(args)</span><br><span class="line">a?.<span class="property">b</span> 编译为 a === <span class="literal">null</span> || a === <span class="keyword">void</span> <span class="number">0</span> ? <span class="keyword">void</span> <span class="number">0</span> : a.<span class="property">b</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?? 空值合并：只对 null/undefined 生效，|| 对 false/&#x27;&#x27;/NaN/0 等空值也生效</span></span><br><span class="line"><span class="keyword">let</span> b = a ?? <span class="number">10</span>    编译为</span><br><span class="line"><span class="keyword">let</span> b = a !== <span class="literal">null</span> &amp;&amp; a !== <span class="keyword">void</span> <span class="number">0</span> ? a : <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _ 数字分隔符：为了便于数字的阅读，编译后的代码是没有下划线的</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num</span>:number = <span class="number">1_2_345.6_78_9</span></span><br></pre></td></tr></table></figure>

<h2 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// keyof：获取类型的所有键值，可用于限制访问对象的 key，因为 any 不可做索引</span></span><br><span class="line">type <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">age</span>: number;</span><br><span class="line">&#125;</span><br><span class="line">type <span class="title class_">PersonKey</span> = keyof <span class="title class_">Person</span>;  <span class="comment">// &#x27;name&#x27; | &#x27;age&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getValue</span> (<span class="attr">p</span>: <span class="title class_">Person</span>, <span class="attr">k</span>: keyof <span class="title class_">Person</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> p[k];  <span class="comment">// 如果 k 不如此定义，则无法以 p[k] 的代码格式通过编译</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// typeof：获取一个对象/实例的类型</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">me</span>: <span class="title class_">Person</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;a&#x27;</span>, <span class="attr">age</span>: <span class="number">16</span> &#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">you</span>: <span class="keyword">typeof</span> me = &#123; <span class="attr">name</span>: <span class="string">&#x27;b&#x27;</span>, <span class="attr">age</span>: <span class="number">69</span> &#125;</span><br><span class="line">type <span class="title class_">PersonKey</span> = keyof <span class="keyword">typeof</span> me;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in：只能用在类型的定义中，可以对枚举类型进行遍历</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">obj</span>: <span class="title class_">TypeToNumber</span>&lt;<span class="title class_">Person</span>&gt; = &#123; <span class="attr">name</span>: <span class="number">10</span>, <span class="attr">age</span>: <span class="number">10</span> &#125;</span><br><span class="line">type <span class="title class_">TypeToNumber</span>&lt;T&gt; = &#123;</span><br><span class="line">  [key <span class="keyword">in</span> keyof T]: number   <span class="comment">// 将键值转化为 number 类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="三、接口"><a href="#三、接口" class="headerlink" title="三、接口"></a>三、接口</h1><blockquote>
<p>接口是一个对外的规范和约定，作用是为属性、函数等类型命名和(第三方)代码定义契约。</p>
</blockquote>
<h2 id="属性类型"><a href="#属性类型" class="headerlink" title="属性类型"></a>属性类型</h2><blockquote>
<p>描述实体：对对象属性进行约束。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 确定属性：变量的个数和类型必须和接口的完全匹配</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Tom&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">25</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选属性：？表示可选</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Tom&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任意属性：确定属性和可选属性都必须是它的子属性</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">// 报错，可将 string 改为 any</span></span><br><span class="line">  [<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只读属性</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">x</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">y</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">p1</span>: <span class="title class_">Point</span> = &#123; <span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">20</span> &#125;;</span><br><span class="line">p1.<span class="property">x</span> = <span class="number">5</span>;     <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>


<h2 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h2><blockquote>
<p>对函数的传入参数和返回值进行约束，注意函数的参数名称不影响函数的匹配。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 加密：参数和返回值都为字符串</span></span><br><span class="line"><span class="keyword">interface</span> encrypt&#123;</span><br><span class="line">  (<span class="attr">key</span>:<span class="built_in">string</span>, <span class="attr">value</span>:<span class="built_in">string</span>):<span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="attr">md5</span>:encrypt = <span class="keyword">function</span>(<span class="params">key:<span class="built_in">string</span>, value:<span class="built_in">string</span></span>):<span class="built_in">string</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> key + value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">sha1</span>:encrypt = <span class="keyword">function</span>(<span class="params">key:<span class="built_in">string</span>, value:<span class="built_in">string</span></span>):<span class="built_in">string</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> key + <span class="string">&#x27;---&#x27;</span> + value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">md5</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;lisi&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sha1</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;wanwu&#x27;</span>));</span><br></pre></td></tr></table></figure>


<h2 id="可索引类型"><a href="#可索引类型" class="headerlink" title="可索引类型"></a>可索引类型</h2><blockquote>
<p>描述那些能够通过索引得到的类型：对数组和对象的约束。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 约束数组</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserArr</span>&#123;</span><br><span class="line">  [<span class="attr">index</span>:<span class="built_in">number</span>]:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">arr</span>:<span class="title class_">UserArr</span> = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;4&#x27;</span>];   <span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">arr</span>:<span class="title class_">UserArr</span> = [<span class="number">2</span>, <span class="string">&#x27;bb&#x27;</span>];    <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 只读数组</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ReadonlyArr</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [<span class="attr">index</span>: <span class="built_in">number</span>]: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="title class_">ReadonlyArr</span> = [<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>];</span><br><span class="line">arr[<span class="number">2</span>] = <span class="string">&quot;Mallory&quot;</span>;     <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 约束对象</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserObj</span>&#123;</span><br><span class="line">  [<span class="attr">index</span>:<span class="built_in">string</span>]:<span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">arr</span>:<span class="title class_">UserObj</span> = &#123;<span class="attr">name</span>: <span class="string">&#x27;li&#x27;</span>&#125;;  <span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">arr</span>:<span class="title class_">UserObj</span> = &#123;<span class="attr">age</span>: <span class="number">20</span>&#125;;     <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>


<h2 id="类类型"><a href="#类类型" class="headerlink" title="类类型"></a>类类型</h2><blockquote>
<p>行为的抽象：一个类只能继承自另一个类，有时不同类之间存在一些共有的特性，这时就可以把特性提取成接口用来约束类必须存在的属性和方法。接口可以声明一个类的结构(包含属性和方法)，但它只是一个规范和约定，没有访问修饰符和具体方法，也不能被实例化。类是也是声明一个类的结构，但它包含属性和方法，有访问修饰符和具体方法，可以实例化。</p>
</blockquote>
<h3 id="实现接口"><a href="#实现接口" class="headerlink" title="实现接口"></a>实现接口</h3><blockquote>
<p>接口约束类的属性或方法，类具体实现接口规范。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TS 只会检查类的公共属性和方法，不会检查私有部分</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Animall</span> &#123;</span><br><span class="line">  <span class="attr">curTime</span>: <span class="title class_">Date</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> <span class="keyword">implements</span> <span class="title class_">ClockInterface</span> &#123;</span><br><span class="line">  <span class="attr">currentTime</span>: <span class="title class_">Date</span>     <span class="comment">// 注释后会报错</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">h: <span class="built_in">number</span>, n: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">setTime</span>(<span class="params">d: <span class="built_in">Date</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">curTime</span> = d;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS 只会检查类的实例部分，而不会检查静态部分(构造器)</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ClockConstructor</span> &#123;</span><br><span class="line">  <span class="comment">// 接口匹配不到任何类型，会报错</span></span><br><span class="line">  <span class="keyword">new</span> (<span class="attr">hour</span>: <span class="built_in">number</span>, <span class="attr">minute</span>: <span class="built_in">number</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> <span class="keyword">implements</span> <span class="title class_">ClockConstructor</span> &#123;</span><br><span class="line">  <span class="attr">currentTime</span>: <span class="title class_">Date</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">h: <span class="built_in">number</span>, m: <span class="built_in">number</span></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="继承接口"><a href="#继承接口" class="headerlink" title="继承接口"></a>继承接口</h3><blockquote>
<p>实现接口的分割和重用。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 动物接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">eat</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 猫科接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Felidae</span> &#123;</span><br><span class="line">  <span class="attr">claw</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">run</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让猫类实现 Animal 和 Felidae 两个接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">implements</span> <span class="title class_">Animal</span>, <span class="title class_">Felidae</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">claw</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;tag&#x27;</span>, <span class="string">&#x27;I love eat Food!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attr">run</span>: () &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;tag&#x27;</span>, <span class="string">&#x27;My speed is very fast!&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">dog</span>: <span class="title class_">Dog</span> = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">dog.<span class="title function_">eat</span>();</span><br></pre></td></tr></table></figure>

<h3 id="混合类型"><a href="#混合类型" class="headerlink" title="混合类型"></a>混合类型</h3><blockquote>
<p>一个对象可以为函数和变量使用。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Counter 接口既服务于 getCounter 方法，也服务于 counter 对象</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">  (<span class="attr">start</span>: <span class="built_in">number</span>): <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">interval</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="title function_">reset</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCounter</span>(<span class="params"></span>): <span class="title class_">Counter</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> counter = &lt;<span class="title class_">Counter</span>&gt;<span class="keyword">function</span> (<span class="params">start: <span class="built_in">number</span></span>) &#123; &#125;;</span><br><span class="line">  counter.<span class="property">interval</span> = <span class="number">123</span>;</span><br><span class="line">  counter.<span class="property">reset</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;;</span><br><span class="line">  <span class="keyword">return</span> counter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = <span class="title function_">getCounter</span>();</span><br><span class="line"><span class="title function_">c</span>(<span class="number">10</span>);</span><br><span class="line">c.<span class="title function_">reset</span>();</span><br><span class="line">c.<span class="property">interval</span> = <span class="number">5.0</span>;</span><br></pre></td></tr></table></figure>

<h3 id="接口继承类"><a href="#接口继承类" class="headerlink" title="接口继承类"></a>接口继承类</h3><blockquote>
<p>接口可以继承类的成员但是不会去实现。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只有子类才能去实现私有属性 state </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Control</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">state</span>: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 其他类如果要实现 SelectableControl 接口，必须是 Control 的子类</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SelectableControl</span> <span class="keyword">extends</span> <span class="title class_">Control</span> &#123;</span><br><span class="line">  <span class="title function_">select</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Control</span> <span class="keyword">implements</span> <span class="title class_">SelectableControl</span> &#123;</span><br><span class="line">  <span class="title function_">select</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextBox</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Control</span> &#123;</span><br><span class="line">  <span class="title function_">select</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错：Image 类型缺少 state 属性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span> <span class="keyword">implements</span> <span class="title class_">SelectableControl</span> &#123;</span><br><span class="line">  <span class="title function_">select</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Location</span> &#123; &#125;</span><br></pre></td></tr></table></figure>


<h1 id="四、类"><a href="#四、类" class="headerlink" title="四、类"></a>四、类</h1><ul>
<li><strong>类 Class</strong>：由静态部分和实例部分组成，定义了一件事物的抽象特点，描述了它的属性和方法，比如猫类。</li>
<li><strong>对象 Object</strong>：继承了类所有属性和方法的实例对象，它是类通过 new 实例化之后生成的具体事物，比如加菲猫。</li>
<li><strong>封装 Encapsulation</strong>：将对数据的操作细节隐藏起来而只暴露对外的接口，外部只通过对外接口就能访问该对象，这样保证了对象内部的数据不会被外部任意更改。</li>
<li><strong>继承 Inheritance</strong>：子类(派生类) 通过 extends 继承 父类(基类)，子类可以拥有除了父类的私有成员和构造函数之外的所有特性，而且还有自身特性。注意 TS 不支持一次继承多个类，但支持多重继承（A 继承 B，B 继承 C）</li>
<li><strong>多态 Polymorphism</strong>：由继承而产生的不同子类，它们对同一个方法可以有不同的响应。</li>
<li><strong>修饰符 Modifiers</strong>：一些用于限定成员性质的关键字。</li>
<li><strong>存取器 getter、setter</strong>：用于改变属性的读取和赋值行为。</li>
<li><strong>抽象类 Abstract Class</strong>：提供其他类继承的的基类（父类）。不允许被实例化。抽象方法只能包含在抽象类中并且必须在子类中实现，非抽象方法可以直接使用而无需重复实现。</li>
<li><strong>接口 Interfaces</strong>：不同类之间公有的属性或方法可以抽象成一个接口。接口可以被类实现（implements）。一个类只能继承自另一个类，但是可以实现多个接口。</li>
</ul>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123; </span><br><span class="line">  <span class="comment">// 属性</span></span><br><span class="line">  <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">val:<span class="built_in">string</span></span>)&#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = val;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 类的方法</span></span><br><span class="line">  <span class="title function_">getInfo</span>(<span class="attr">age</span>:<span class="built_in">number</span>=<span class="number">20</span>):<span class="built_in">string</span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;: &quot;</span> + age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实例化创建一个对象</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;龙梅子&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="title function_">getInfo</span>());</span><br></pre></td></tr></table></figure>


<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 不使用 constructor</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span>&#123;</span><br><span class="line">  <span class="title function_">getInfo</span>(<span class="params">age:<span class="built_in">number</span>=<span class="number">20</span></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;: &quot;</span> + age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">s.<span class="property">name</span> = <span class="string">&#x27;李四&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s.<span class="title function_">getInfo</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 constructor + super</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name:<span class="built_in">string</span></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getInfo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span>&#123;</span><br><span class="line">  <span class="attr">age</span>:<span class="built_in">number</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getInfo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> superMsg = <span class="variable language_">super</span>.<span class="title function_">getInfo</span>();</span><br><span class="line">    <span class="keyword">return</span> superMsg + <span class="string">&quot;:&quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">20</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s.<span class="title function_">getInfo</span>());</span><br></pre></td></tr></table></figure>


<h2 id="多继承"><a href="#多继承" class="headerlink" title="多继承"></a>多继承</h2><blockquote>
<p>TS 中不允许一个子类继承多个父类，只能通过 mixins 模拟实现。mixins 混入用于将一个对象的方法和属性直接拷贝到另一个对象，是面向对象继承的一种替代方案。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">sayHello</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;tag&#x27;</span>, <span class="string">`Helo <span class="subst">$&#123; <span class="variable language_">this</span>.name &#125;</span>!`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">  <span class="attr">grade</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">study</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;tag&#x27;</span>, <span class="string">&#x27; I need Study!&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将两个父类的属性和方法做占位，但只定义而不去实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmartObject</span> <span class="keyword">implements</span> <span class="title class_">Person</span>, <span class="title class_">Student</span> &#123;</span><br><span class="line">  <span class="comment">// Person</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&#x27;person&#x27;</span>;</span><br><span class="line">  <span class="attr">sayHello</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// Activatable</span></span><br><span class="line">  <span class="attr">grade</span>: <span class="built_in">number</span> = <span class="number">3</span>;</span><br><span class="line">  <span class="attr">study</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 混入实现：直接将需要继承的所有属性都拷贝过去</span></span><br><span class="line"><span class="title function_">applyMixins</span>(<span class="title class_">SmartObject</span>, [<span class="title class_">Person</span>, <span class="title class_">Student</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">applyMixins</span>(<span class="params">derivedCtor: <span class="built_in">any</span>, baseCtors: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  baseCtors.<span class="title function_">forEach</span>(<span class="function"><span class="params">baseCtor</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(baseCtor.<span class="property"><span class="keyword">prototype</span></span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">      derivedCtor.<span class="property"><span class="keyword">prototype</span></span>[name] = baseCtor.<span class="property"><span class="keyword">prototype</span></span>[name];</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h2><ol>
<li>访问<br>* <strong>private</strong>：私有，只能在当前类的内部访问。<br>* <strong>protected</strong>：受保护，只能在当前类内部及其子类可以访问。<br>* <strong>public</strong>：公有(默认)，在当前类内部、子类、类外部都可以访问。<br><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">sex</span>:<span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>:<span class="built_in">number</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span>, sex:<span class="built_in">string</span></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span>=name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span>=age;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sex</span>=sex;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`我是<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>我<span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span>岁`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span>&#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span>, sex:<span class="built_in">string</span></span>)&#123;</span><br><span class="line">    <span class="variable language_">super</span>(name, age, sex)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">run1</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);   <span class="comment">// 报错</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">sex</span>);    <span class="comment">// 正确</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);    <span class="comment">// 正确</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">23</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>);     <span class="comment">// 报错</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">sex</span>);      <span class="comment">// 报错</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">age</span>);      <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure></li>
<li>只读 readonly<br><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置的只读属性必须在声明时或构造函数里被初始化，并且值不能被修改。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123; </span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">age</span>: <span class="built_in">number</span>=<span class="number">23</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name:<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;yzq&quot;</span>);</span><br><span class="line">p.<span class="property">name</span> = <span class="string">&quot;Lisa&quot;</span>;   <span class="comment">// 报错</span></span><br><span class="line">p.<span class="property">age</span> = <span class="number">24</span>;        <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure></li>
<li>静态 static<br><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 静态属性和方法存在于类本身而非实例上，所以访问时需要直接通过类名。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="attr">name</span>: <span class="title class_">String</span>; </span><br><span class="line">  <span class="keyword">static</span> <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">String</span>, age: <span class="built_in">number</span></span>)&#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 静态方法不能访问类里面的非静态属性</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">printInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property">name</span> + <span class="string">&quot;: &quot;</span> + <span class="title class_">Person</span>.<span class="property">age</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">printInfo</span>()</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="存取器"><a href="#存取器" class="headerlink" title="存取器"></a>存取器</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义存取数据之前的业务逻辑</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">age</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_age</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">age</span>(<span class="params">inputAge: <span class="built_in">number</span>=<span class="number">20</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (inputAge &gt; <span class="number">0</span> &amp;&amp; inputAge &lt;&gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_age</span> = inputAge;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line">p.<span class="property">age</span> = <span class="number">200</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">age</span>)  <span class="comment">// 20</span></span><br></pre></td></tr></table></figure>


<h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><blockquote>
<p>抽象类更多的是实现业务上的严谨性，而接口更多的是制定各种规范。需要注意的是，它们都无法实例化，但是有很大区别：<code>抽象类只能作为父类被继承而接口可以当做子类继承其他类、抽象类中非抽象方法可以包含具体实现但接口中不能包含具体实现、抽象类中的抽象方法在子类中必须实现但接口中的非可选项在接口被调用时必须实现</code>。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 抽象类：可以使用修饰符、部分实现方法</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name:<span class="built_in">string</span></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 抽象方法：不包含具体实现，要求子类中必须实现此方法</span></span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">eat</span>():<span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非抽象方法：无需要求子类实现或重写</span></span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;非抽象方法，不要子类实现、重写&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span>&#123;</span><br><span class="line">  <span class="comment">// 子类中必须实现父类抽象方法，否则 ts 编译报错</span></span><br><span class="line">  <span class="title function_">eat</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;吃肉&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="title function_">eat</span>());</span><br></pre></td></tr></table></figure>


<h2 id="高级技巧"><a href="#高级技巧" class="headerlink" title="高级技巧"></a>高级技巧</h2><h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><blockquote>
<p>通过 typeof 获取 Greeter 类的类型，即构造函数的类型而不是实例的类型，这个类型包含了类的所有静态成员和构造函数。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Greeter</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> greeting = <span class="string">&#x27;Hello, there&#x27;</span></span><br><span class="line">  <span class="title function_">greet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Greeter</span>.<span class="property">greeting</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">g</span>: <span class="title class_">Greeter</span></span><br><span class="line">g = <span class="keyword">new</span> <span class="title class_">Greeter</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">greet</span>())  <span class="comment">// Hello, there</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">greeterMaker</span>: <span class="keyword">typeof</span> <span class="title class_">Greeter</span> = <span class="title class_">Greeter</span></span><br><span class="line">greeterMaker.<span class="property">greeting</span> = <span class="string">&#x27;Hey there&#x27;</span></span><br><span class="line"><span class="keyword">let</span> g2 = <span class="keyword">new</span> <span class="title function_">greeterMaker</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g2.<span class="title function_">greet</span>())     <span class="comment">// Hey there</span></span><br></pre></td></tr></table></figure>

<h3 id="把类当做接口使用"><a href="#把类当做接口使用" class="headerlink" title="把类当做接口使用"></a>把类当做接口使用</h3><blockquote>
<p>类定义会创建两个东西：类的实例类型和一个构造函数，类可以创建出类型而可以在允许使用接口的地方使用类。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// extends 使子类可以共享父类的属性</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Point3</span>d <span class="keyword">extends</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">z</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">p</span>: <span class="title class_">Point3</span>d = &#123;<span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">2</span>, <span class="attr">z</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>


<h1 id="五、函数"><a href="#五、函数" class="headerlink" title="五、函数"></a>五、函数</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>函数的类型由传入参数和返回值组成，它们都需要指定数据类型。参数类型只要匹配即可而不会验证参数名是否正确，没有返回值时必须指定类型为 void 而不能留空。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="keyword">function</span>(<span class="params">x: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 完整函数类型: =&gt; 表示函数的定义，左右两侧分别是输入和输出类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">sum</span>: <span class="function">(<span class="params">a: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = <span class="keyword">function</span>(<span class="params">x: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过接口定义</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Search</span> &#123;</span><br><span class="line">  (<span class="attr">source</span>: <span class="built_in">string</span>, <span class="attr">name</span>: <span class="built_in">string</span>): <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">s</span>: <span class="title class_">Search</span>;</span><br><span class="line">s = <span class="keyword">function</span>(<span class="params">source: <span class="built_in">string</span>, name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> source.<span class="title function_">search</span>(name) !== -<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 没有参数没有返回值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run1</span>(<span class="params"></span>):<span class="built_in">void</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 没有参数有返回值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run2</span>(<span class="params"></span>):<span class="built_in">string</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有参有返回值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run3</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span></span>):<span class="built_in">string</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;name&#125;</span>: <span class="subst">$&#123;age&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有参没有返回值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run4</span>(<span class="params">name:<span class="built_in">string</span>,</span>):<span class="built_in">void</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数永远不会返回</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;never reach&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可选参数：必须放在最后面</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">firstName: <span class="built_in">string</span>, lastName?: <span class="built_in">string</span></span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(lastName)&#123;</span><br><span class="line">    <span class="keyword">return</span> firstName + lastName;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> firstName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认参数：不用放到最后</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">name: <span class="built_in">string</span>, age:<span class="built_in">number</span>=<span class="number">20</span></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;name&#125;</span>: <span class="subst">$&#123;age&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 剩余参数：ES6 规定 rest 参数只能是最后一个参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum2</span>(<span class="params">...list: <span class="built_in">number</span>[]</span>): <span class="built_in">number</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>;i&lt;list.<span class="property">length</span>;i++)&#123;</span><br><span class="line">    sum += list[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h2><blockquote>
<p>允许一个函数接受不同数量或类型的参数，并作出不同的处理。TS 会优先从最前面的函数定义开始匹配，所以多个函数定义如果有包含关系，需要优先把精确的定义写在前面 (输入数字则输出数字)。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 反转数字或字符串</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reverse</span>(<span class="params">x: <span class="built_in">number</span></span>): <span class="built_in">number</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reverse</span>(<span class="params">x: <span class="built_in">string</span></span>): <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reverse</span>(<span class="params">x: <span class="built_in">number</span> | <span class="built_in">string</span></span>): <span class="built_in">number</span> | <span class="built_in">string</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> x === <span class="string">&#x27;number&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Number</span>(x.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>));</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> x === <span class="string">&#x27;string&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="六、泛型"><a href="#六、泛型" class="headerlink" title="六、泛型"></a>六、泛型</h1><blockquote>
<p>一种动态调用时才指定具体类型的宽泛类型，常用于创建支持不定数据类型的可复用代码。</p>
</blockquote>
<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 普通类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Dog</span>&lt;T&gt; = &#123; <span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">type</span>: T &#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">dog</span>: <span class="title class_">Dog</span>&lt;<span class="built_in">number</span>&gt; = &#123; <span class="attr">name</span>: <span class="string">&#x27;ww&#x27;</span>, <span class="attr">type</span>: <span class="number">20</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinClass</span>&lt;T&gt;&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">list</span>:T[]=[];</span><br><span class="line">  <span class="title function_">add</span>(<span class="attr">num</span>:T):<span class="built_in">void</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(num);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">min</span>():T&#123;</span><br><span class="line">      <span class="keyword">var</span> minNum = <span class="variable language_">this</span>.<span class="property">list</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i =<span class="number">0</span>; i&lt;<span class="variable language_">this</span>.<span class="property">list</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (minNum &gt; <span class="variable language_">this</span>.<span class="property">list</span>[i]) &#123;</span><br><span class="line">              minNum = <span class="variable language_">this</span>.<span class="property">list</span>[i]</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> minNum;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> <span class="title class_">MinClass</span>&lt;<span class="built_in">number</span>&gt;();</span><br><span class="line">m.<span class="title function_">add</span>(<span class="number">1</span>);</span><br><span class="line">m.<span class="title function_">add</span>(<span class="number">6</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m.<span class="title function_">min</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数</span></span><br><span class="line"><span class="keyword">function</span> swipe&lt;T, U&gt;(<span class="attr">value</span>: [T, U]): [U, T] &#123;</span><br><span class="line">  <span class="keyword">return</span> [value[<span class="number">1</span>], value[<span class="number">0</span>]];</span><br><span class="line">&#125;</span><br><span class="line">swipe&lt;<span class="title class_">Cat</span>&lt;<span class="built_in">number</span>&gt;, <span class="title class_">Dog</span>&lt;<span class="built_in">number</span>&gt;&gt;([cat, dog])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口定义一</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ConfigFn</span>&#123;</span><br><span class="line">  &lt;T&gt;(<span class="attr">value</span>:T):T;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">getData</span>:<span class="title class_">ConfigFn</span> = <span class="keyword">function</span>&lt;T&gt;(<span class="attr">value</span>:T):T&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line">getData&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;张三&#x27;</span>);</span><br><span class="line"><span class="comment">// 接口定义二</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ConfigFn</span>&lt;T&gt;&#123;</span><br><span class="line">  (<span class="attr">value</span>:T):T;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> getData&lt;T&gt;(<span class="attr">value</span>:T):T&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">myGetData</span>:<span class="title class_">ConfigFn</span>&lt;<span class="built_in">string</span>&gt; = getData;</span><br><span class="line"><span class="title function_">myGetData</span>(<span class="string">&#x27;20&#x27;</span>);   <span class="comment">// 20 则报错</span></span><br></pre></td></tr></table></figure>


<h2 id="泛型推导"><a href="#泛型推导" class="headerlink" title="泛型推导"></a>泛型推导</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TS 在函数调用时会根据变量定义时的类型自动推导</span></span><br><span class="line">type <span class="title class_">Dog</span>&lt;T&gt; = &#123; <span class="attr">name</span>: string, <span class="attr">type</span>: T &#125;</span><br><span class="line"><span class="keyword">function</span> adopt&lt;T&gt;(<span class="attr">dog</span>: <span class="title class_">Dog</span>&lt;T&gt;) &#123; <span class="keyword">return</span> dog &#125;;</span><br><span class="line"><span class="keyword">const</span> dog = &#123; <span class="attr">name</span>: <span class="string">&#x27;ww&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;hsq&#x27;</span> &#125;;</span><br><span class="line"><span class="title function_">adopt</span>(dog);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 若不适用函数泛型推导，定义变量时必须指定类型</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">dog</span>: <span class="title class_">Dog</span>&lt;string&gt; = &#123; <span class="attr">name</span>: <span class="string">&#x27;ww&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;hsq&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不想指定则可以使用泛型默认值</span></span><br><span class="line">type <span class="title class_">Dog</span>&lt;T=any&gt; = &#123; <span class="attr">name</span>: string, <span class="attr">type</span>: T &#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">dog</span>: <span class="title class_">Dog</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;ww&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;hsq&#x27;</span> &#125;</span><br><span class="line">dog.<span class="property">type</span> = <span class="number">123</span>;    <span class="comment">// type 类型为 any，无法推导</span></span><br></pre></td></tr></table></figure>


<h2 id="泛型约束"><a href="#泛型约束" class="headerlink" title="泛型约束"></a>泛型约束</h2>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、泛型继承接口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接实现无法保证所有的参数都有 length 方法</span></span><br><span class="line"><span class="keyword">function</span> getLen&lt;T&gt;(<span class="attr">arg</span>:T):T&#123;</span><br><span class="line">  <span class="keyword">return</span> arg.<span class="property">length</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 增加接口来约束泛型：没有 length 属性的参数在函数调用前编译无法通过</span></span><br><span class="line"><span class="keyword">interface</span> lengthRequire&#123;</span><br><span class="line">  <span class="attr">length</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> newGetLen&lt;T <span class="keyword">extends</span> lengthRequire&gt;(<span class="attr">arg</span>:T):T&#123;</span><br><span class="line">  <span class="keyword">return</span> arg.<span class="property">length</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、使用类型参数：改写 getProperty</span></span><br><span class="line"><span class="keyword">function</span> getProperty&lt;T, K <span class="keyword">extends</span> keyof T&gt;(<span class="attr">obj</span>: T, <span class="attr">key</span>: K) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj[key]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> x = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">d</span>: <span class="number">4</span> &#125;;</span><br><span class="line"><span class="title function_">getProperty</span>(x, <span class="string">&quot;a&quot;</span>);   <span class="comment">// 正常</span></span><br><span class="line"><span class="title function_">getProperty</span>(x, <span class="string">&quot;m&quot;</span>);   <span class="comment">// 异常</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、使用类类型</span></span><br><span class="line"><span class="keyword">function</span> create&lt;T&gt; (<span class="attr">c</span>: &#123;<span class="title function_">new</span>(): T;&#125;): T &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">c</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 4、泛型条件和推断</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 条件类型：泛型名A extends 类型B ? 类型C: 类型D</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 推断 infer：预定义整体结构后，运行时就会自动判断</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> &#123;<span class="type">t: infer Test</span>&#125;：可看作一个包含 t 属性的类型定义</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Foo</span>&lt;T&gt; = T <span class="keyword">extends</span> &#123;<span class="attr">t</span>: infer <span class="title class_">Test</span>&#125; ? <span class="title class_">Test</span>: <span class="built_in">string</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">One</span> = <span class="title class_">Foo</span>&lt;<span class="built_in">number</span>&gt;                       <span class="comment">// string </span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Two</span> = <span class="title class_">Foo</span>&lt;&#123;<span class="attr">t</span>: <span class="built_in">boolean</span>&#125;&gt;                 <span class="comment">// boolean</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Three</span> = <span class="title class_">Foo</span>&lt;&#123;<span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">t</span>: <span class="function">()=&gt;</span><span class="built_in">void</span>&#125;&gt;   <span class="comment">// ()=&gt;void</span></span><br></pre></td></tr></table></figure>


<h2 id="泛型工具"><a href="#泛型工具" class="headerlink" title="泛型工具"></a>泛型工具</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Partical&lt;T&gt;：将泛型中全部属性变为可选的</span></span><br><span class="line">type <span class="title class_">Partial</span>&lt;T&gt; = &#123; [P <span class="keyword">in</span> keyof T]?: T[P] &#125;  <span class="comment">// 源码</span></span><br><span class="line">type <span class="title class_">Animal</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: string,</span><br><span class="line">  <span class="attr">age</span>: number,</span><br><span class="line">  <span class="attr">eat</span>: <span class="function">() =&gt;</span> number</span><br><span class="line">&#125;</span><br><span class="line">type <span class="title class_">PartOfAnimal</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Animal</span>&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">ww</span>: <span class="title class_">PartOfAnimal</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;ww&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Record&lt;K, T&gt;：将 K 所有属性值转为 T 类型，常用来申明一个普通对象</span></span><br><span class="line">type <span class="title class_">Record</span>&lt;K <span class="keyword">extends</span> keyof any,T&gt; = &#123; [key <span class="keyword">in</span> K]: T &#125;   <span class="comment">// 源码</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">obj</span>: <span class="title class_">Record</span>&lt;string, string&gt; = &#123; <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;bg&#x27;</span>, <span class="string">&#x27;tag&#x27;</span>: <span class="string">&#x27;武德&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Pick&lt;T, K&gt;：将 T 类型中的 K 键列表提取出来，生成新的子键值对类型</span></span><br><span class="line">type <span class="title class_">Pick</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123; [P <span class="keyword">in</span> K]: T[P] &#125;     <span class="comment">// 源码</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">bird</span>: <span class="title class_">Pick</span>&lt;<span class="title class_">Animal</span>, <span class="string">&quot;name&quot;</span> | <span class="string">&quot;age&quot;</span>&gt; = &#123; <span class="attr">name</span>: <span class="string">&#x27;bird&#x27;</span>, <span class="attr">age</span>: <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exclude&lt;T, U&gt;：T 类型中去除 T 类型和 U 类型的交集，返回剩余的部分</span></span><br><span class="line">type <span class="title class_">Exclude</span>&lt;T, U&gt; = T <span class="keyword">extends</span> U ? never : T     <span class="comment">// 源码</span></span><br><span class="line">type <span class="variable constant_">T1</span> = <span class="title class_">Exclude</span>&lt;<span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span>, <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span>&gt;;   <span class="comment">// &quot;c&quot;</span></span><br><span class="line">type <span class="variable constant_">T2</span> = <span class="title class_">Exclude</span>&lt;string | number | (<span class="function">()=&gt;</span><span class="keyword">void</span>), <span class="title class_">Function</span>&gt;;<span class="comment">// string/number</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Omit&lt;T, K&gt;：去除类型 T 包含 K 的键值对，适用于键值对对象的 Exclude</span></span><br><span class="line">type <span class="title class_">Omit</span> = <span class="title class_">Pick</span>&lt;T, <span class="title class_">Exclude</span>&lt;keyof T, K&gt;&gt;         <span class="comment">// 源码</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OmitAnimal</span>:<span class="title class_">Omit</span>&lt;<span class="title class_">Animal</span>, <span class="string">&#x27;name&#x27;</span>|<span class="string">&#x27;age&#x27;</span>&gt; = &#123; </span><br><span class="line">  <span class="attr">category</span>: <span class="string">&#x27;lion&#x27;</span>, </span><br><span class="line">  <span class="attr">eat</span>: <span class="function">() =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;eat&#x27;</span>) &#125;  <span class="comment">// Omit、Pick 分别获取非结果、结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReturnType&lt;T&gt;：获取 T 类型(函数)对应的返回值类型，简化源码如下</span></span><br><span class="line">type <span class="title class_">ReturnType</span>&lt;T <span class="keyword">extends</span> func&gt; = T <span class="keyword">extends</span> () =&gt; infer R ? <span class="attr">R</span>: any;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x: string | number</span>): string | number &#123;  &#125;</span><br><span class="line">type <span class="title class_">FooType</span> = <span class="title class_">ReturnType</span>&lt;foo&gt;;   <span class="comment">// string | number</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Required&lt;T&gt;：将类型 T 中所有的属性变为必选项</span></span><br><span class="line">type <span class="title class_">Required</span>&lt;T&gt; = &#123; [P <span class="keyword">in</span> keyof T]-?: T[P] &#125; <span class="comment">// 源码：-? 减去可选属性</span></span><br></pre></td></tr></table></figure>


<h1 id="七、枚举"><a href="#七、枚举" class="headerlink" title="七、枚举"></a>七、枚举</h1><blockquote>
<p>可以声明一组带名字的常量，用于取值被限定在一定范围内的场景，比如一周只能有七天、颜色限定为红绿蓝等。</p>
</blockquote>
<h2 id="根据枚举成员分类"><a href="#根据枚举成员分类" class="headerlink" title="根据枚举成员分类"></a>根据枚举成员分类</h2><h3 id="数字枚举"><a href="#数字枚举" class="headerlink" title="数字枚举"></a>数字枚举</h3><blockquote>
<p>枚举成员是常量而非变量，所以不能对其进行赋值但可以初始化。它们经过编译后会生成反向映射表，即除了生成键值对的集合，还会生成值键对的集合。</p>
</blockquote>
<ul>
<li><strong>不带初始化器</strong>：枚举成员默认从 0 开始并依次递增<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Days</span> &#123; <span class="title class_">Sun</span>, <span class="title class_">Mon</span>, <span class="title class_">Tue</span>, <span class="title class_">Wed</span>, <span class="title class_">Thu</span>, <span class="title class_">Fri</span>, <span class="title class_">Sat</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">d</span>: <span class="built_in">string</span> = <span class="title class_">Days</span>[<span class="number">0</span>];     <span class="comment">// Sun</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">i</span>: <span class="built_in">number</span> = <span class="title class_">Days</span>.<span class="property">Sat</span>;    <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译结果</span></span><br><span class="line">&#123; </span><br><span class="line">  <span class="number">0</span>: <span class="string">&quot;Sun&quot;</span>, <span class="number">1</span>: <span class="string">&quot;Mon&quot;</span>, <span class="number">2</span>: <span class="string">&quot;Tue&quot;</span>, <span class="number">3</span>: <span class="string">&quot;Wed&quot;</span>, <span class="number">4</span>: <span class="string">&quot;Thu&quot;</span>,</span><br><span class="line">  <span class="number">5</span>: <span class="string">&quot;Fri&quot;</span>, <span class="number">6</span>: <span class="string">&quot;Sat&quot;</span>, <span class="title class_">Fri</span>: <span class="number">5</span>, <span class="title class_">Mon</span>: <span class="number">1</span>, <span class="title class_">Sat</span>: <span class="number">6</span>, <span class="title class_">Sun</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="title class_">Thu</span>: <span class="number">4</span>, <span class="title class_">Tue</span>: <span class="number">2</span>, <span class="title class_">Wed</span>: <span class="number">3</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错：不带初始化器的枚举需要被放在第一位置或初始化的枚举后面</span></span><br><span class="line"><span class="keyword">enum</span> E &#123;</span><br><span class="line">  A = <span class="title function_">getValue</span>(),</span><br><span class="line">  B</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>使用初始化器</strong>：后面的枚举成员从初始值依次递增<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Days</span> &#123; <span class="title class_">Sun</span>=<span class="number">7</span>, <span class="title class_">Mon</span>, <span class="title class_">Tue</span>, <span class="title class_">Wed</span>=<span class="number">1</span>, <span class="title class_">Thu</span>, <span class="title class_">Fri</span>, <span class="title class_">Sat</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译结果</span></span><br><span class="line">&#123; </span><br><span class="line">  <span class="number">1</span>: <span class="string">&quot;Wed&quot;</span>, <span class="number">2</span>: <span class="string">&quot;Thu&quot;</span>, <span class="number">3</span>: <span class="string">&quot;Fri&quot;</span>, <span class="number">4</span>: <span class="string">&quot;Sat&quot;</span>, <span class="number">7</span>: <span class="string">&quot;Sun&quot;</span>, </span><br><span class="line">  <span class="number">8</span>: <span class="string">&quot;Mon&quot;</span>, <span class="number">9</span>: <span class="string">&quot;Tue&quot;</span>, <span class="title class_">Sun</span>: <span class="number">7</span>, <span class="title class_">Mon</span>: <span class="number">8</span>, <span class="title class_">Tue</span>: <span class="number">9</span>, <span class="title class_">Wed</span>: <span class="number">1</span>, </span><br><span class="line">  <span class="title class_">Thu</span>: <span class="number">2</span>, <span class="title class_">Fri</span>: <span class="number">3</span>, <span class="title class_">Sat</span>: <span class="number">4</span>, <span class="title class_">Sun</span>: <span class="number">7</span>, <span class="title class_">Mon</span>: <span class="number">8</span>, <span class="title class_">Tue</span>: <span class="number">9</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始值：常数、常量表达式，不能是变量、NaN、Infinity</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Days</span>_1 &#123; one = <span class="number">2</span>, two &#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Days</span>_2 &#123; one = <span class="title class_">Days</span>_1.<span class="property">Sun</span>, two = <span class="number">2</span> * one &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNum</span> (<span class="attr">x</span>: <span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Days</span>_3 &#123;</span><br><span class="line">  one = <span class="title function_">getNum</span>(<span class="number">10</span>) * <span class="title class_">Days</span>_2.<span class="property">one</span>,</span><br><span class="line">  two = (<span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;)()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">const</span> first = <span class="number">10</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Days</span>_4 &#123; one = first, two, three &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="字符串枚举"><a href="#字符串枚举" class="headerlink" title="字符串枚举"></a>字符串枚举</h3><blockquote>
<p>需要使用字符串字面量或者之前定义的字符串枚举成员来初始化，注意它不会生成反向映射表。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全部使用字符串字面量来初始化</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">StrEnum1</span> &#123;</span><br><span class="line">  one = <span class="string">&#x27;one&#x27;</span>,</span><br><span class="line">  two = <span class="string">&#x27;two&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全部使用其他枚举成员的字面量初始化</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">StrEnum2</span> &#123;</span><br><span class="line">  one = <span class="title class_">StrEnum1</span>.<span class="property">one</span>,</span><br><span class="line">  two = <span class="title class_">StrEnum1</span>.<span class="property">two</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错：不能将这初始化方式混写</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">StrEnum3</span> &#123;</span><br><span class="line">  one = <span class="string">&#x27;first&#x27;</span>,</span><br><span class="line">  two = <span class="title class_">StrEnum1</span>.<span class="property">two</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="异构枚举"><a href="#异构枚举" class="headerlink" title="异构枚举"></a>异构枚举</h3><blockquote>
<p>混合字符串和数字成员，一般不推荐使用。</p>
</blockquote>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">BooleanLike</span> &#123;</span><br><span class="line">  <span class="title class_">No</span> = <span class="number">0</span>,</span><br><span class="line">  <span class="title class_">Yes</span> = <span class="string">&quot;YES&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="根据声明方式分类"><a href="#根据声明方式分类" class="headerlink" title="根据声明方式分类"></a>根据声明方式分类</h2><ul>
<li><strong>普通枚举</strong>：可以生成反向映射表。</li>
<li><strong>常量枚举</strong>：不会生成反向映射，节省了代码量但只能通过成员访问。</li>
<li><strong>外部枚举</strong>：不会生成反向映射，主要用于防止枚举的命名冲突和成员冲突。</li>
<li><strong>外部常量枚举</strong>：和常量枚举没有区别，只是会提示是否有枚举命名冲突和成员冲突。</li>
</ul>
  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 普通枚举：关键词 + 枚举名称</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">NumEnum</span> &#123; a, b c &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量枚举：const + 关键词 + 枚举名称 </span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> <span class="title class_">Color</span> &#123; <span class="title class_">Red</span>, <span class="title class_">Green</span>, <span class="title class_">Blue</span> &#125;</span><br><span class="line"><span class="title class_">Color</span>[<span class="string">&#x27;0&#x27;</span>]     <span class="comment">// 报错</span></span><br><span class="line"><span class="title class_">Color</span>.<span class="property">Green</span>    <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 外部枚举：declear + 关键词 + 枚举名称</span></span><br><span class="line">declear <span class="keyword">enum</span> <span class="title class_">Animal</span> &#123; cat, dog, tiger &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>)       <span class="comment">// 报错：不存在</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>.<span class="property">cat</span>)   <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 外部常量枚举：declear + const + 关键词 + 枚举名称</span></span><br><span class="line"><span class="comment">// 声明语 + 修饰符 + 关键词 + 枚举名称</span></span><br><span class="line">declear <span class="keyword">const</span> <span class="keyword">enum</span> <span class="title class_">Animal2</span> &#123; cat=<span class="number">1</span>, dog, tiger &#125;</span><br><span class="line"><span class="title class_">Animal2</span>.<span class="property">tiger</span>      <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>JS 扩展</category>
      </categories>
      <tags>
        <tag>JS 扩展</tag>
      </tags>
  </entry>
  <entry>
    <title>React 工具库</title>
    <url>/2019/08/29/10-2-React%E5%B7%A5%E5%85%B7%E5%BA%93/</url>
    <content><![CDATA[<h1 id="一、组件复用方案"><a href="#一、组件复用方案" class="headerlink" title="一、组件复用方案"></a>一、组件复用方案</h1><blockquote>
<p>React 团队一直在探索：早期使用 <code>CreateClass + Mixins</code> (混入：将对象拷贝到另一个对象)，然后使用 Class Component 取代 CreateClass 之后设计了 <code>Render Props</code> (通过 props 接收一个返回新组件的渲染函数)、<code>Higher Order Component</code> (高阶组件：接收原组件为参数并返回一个新组件的函数)，直到再后来的 <code>Function Component + Hooks</code> (封装组件中状态相关逻辑的函数)。</p>
</blockquote>
<h2 id="混入-Mixin"><a href="#混入-Mixin" class="headerlink" title="混入 Mixin"></a>混入 Mixin</h2><blockquote>
<p>将公用逻辑封装为一个 Mixin 并通过通过侵入的方式修改了原组件，相同键值的对象与函数会导致命名冲突、代码覆盖、逻辑复杂等问题。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mixinPart = &#123;</span><br><span class="line">    <span class="title function_">mixinFunc</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;this mixin!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Contacts</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    <span class="attr">mixins</span>: [mixinPart],</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.mixinFunc()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="继承-extends"><a href="#继承-extends" class="headerlink" title="继承 extends"></a>继承 extends</h2><blockquote>
<p>ES6 class 继承方式，但是注意父子类型应该一致，滥用继承可能产生混乱的类层次结构。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 圆形类继承一个点类的定义很不合理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="attr">x</span>: number;</span><br><span class="line">    <span class="attr">y</span>: number;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: number, y: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Point</span> &#123;</span><br><span class="line">    <span class="attr">radius</span>: number;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: number, y: number, radius: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(x, y);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">radius</span> = radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="高阶组件-HOC"><a href="#高阶组件-HOC" class="headerlink" title="高阶组件 HOC"></a>高阶组件 HOC</h2><blockquote>
<p>一种类似于装饰器的设计模式，本质是一个接收原组件为参数并返回新组件的纯函数，主要用于组件扩展、组件复用、提升渲染性能等。</p>
</blockquote>
<ul>
<li>优势：不会导致父组件的修改和冲突而降低了<strong>耦合度</strong>、具有组件树层级结构而降低了<strong>复杂度</strong>。</li>
<li>缺陷：<strong>嵌套地狱</strong> (每次调用都会产生一个组件实例，过多嵌套会导致难以溯源和 props 覆盖问题)、<strong>静态构建</strong> (只是声明了新组件但不会马上渲染，只有在组件被渲染时才执行)。</li>
<li>功能：<strong>属性代理</strong> (原组件作为子组件更新 props)、<strong>反向继承</strong> (原组件作为父组件更新 state)。</li>
<li>解决问题：<strong>复用逻辑</strong> (对原组件进行扩展的纯函数)、<strong>强化props</strong> (劫持上层 props 并混入新 props，比如 react-router withRouter)、<strong>扩展组件</strong> (为包裹的业务组件扩展功能，比如 react-keepalive-router keepaliveLifeCycle)、<strong>控制渲染</strong> (劫持渲染时对原组件的模板进行修改和替换，比如登陆验证和 react-redux dynamic 组件懒加载)。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">withSubscription</span>(<span class="params">WrappedCom, selectData</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">            <span class="variable language_">super</span>(props);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">data</span>: <span class="title function_">selectData</span>(<span class="title class_">DataSource</span>, props) &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 使用新数据渲染被包装的组件</span></span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedCom</span> <span class="attr">data</span>=<span class="string">&#123;this.state.data&#125;</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性代理</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyContainer</span> = (<span class="params">WrappedComponent</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 反向继承</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ReverHOC</span> = <span class="title class_">WrapComponent</span> =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">WrapComponent</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">            <span class="variable language_">super</span>(props)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">count</span>: <span class="number">1000</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">static</span> <span class="title function_">getDerivedStateFromProps</span>(<span class="params">nextProps, state</span>) &#123;</span><br><span class="line">            <span class="comment">// 存储数据等</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 反向继承后可以获取原组件数据</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;高阶组件&quot;</span>, <span class="variable language_">this</span>.<span class="property">props</span>, <span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">clickComponent</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="comment">// 反向继承时不能在子组件模板中使用父组件标签</span></span><br><span class="line">                <span class="comment">// 使用 super.render() 渲染父组件模板 </span></span><br><span class="line">                <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">onClick</span>=<span class="string">&#123;this.clickComponent&#125;</span>&gt;</span>高阶组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;super.render()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="渲染属性-Render-Props"><a href="#渲染属性-Render-Props" class="headerlink" title="渲染属性 Render Props"></a>渲染属性 Render Props</h2><blockquote>
<p>通过 props 将复用的状态传递给原组件定义的渲染函数，注意可以是任意名称的 prop。</p>
</blockquote>
<ul>
<li>优势：动态构建、没有 props 命名冲突、可以溯源 (子组件 props 一定来自直接父组件)。</li>
<li>缺陷：函数回调的嵌套地狱、使用繁琐 (HOC 可以通过装饰器语法的一行代码实现复用)、没有组件的上下文 (HOC 可以直接获取子组件实例对象 this.props.children)。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;<span class="title class_">Router</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">render</span>=<span class="string">&#123;()</span> =&gt;</span> <span class="tag">&lt;<span class="name">div</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125; /&gt;</span></span><br><span class="line">&lt;/<span class="title class_">Router</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    state = &#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line">    handleMouseMove = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">x</span>: e.<span class="property">clientX</span>, <span class="attr">y</span>: e.<span class="property">clientY</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleMouseMove</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleMouseMove</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">render</span>(<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        <span class="comment">// return this.props.children(this.state)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Mouse</span>.<span class="property">prototypes</span> = &#123;</span><br><span class="line">    <span class="attr">children</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>.<span class="property">isRequired</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>render 调用<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Mouse</span> <span class="attr">render</span>=<span class="string">&#123;</span> <span class="attr">i</span> =&gt;</span> &#123;return (<span class="tag">&lt;<span class="name">div</span>&gt;</span>位置：&#123;i.x&#125;, &#123;i.y&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)&#125; &#125;/&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Mouse</span> <span class="attr">render</span>=<span class="string">&#123;</span> <span class="attr">i</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          return (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&#123;&#123;position:</span>&#x27;<span class="attr">absolute</span>&#x27;, <span class="attr">top:i.y</span>, <span class="attr">left:i.x</span>&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          )</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>children 调用<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Mouse</span>&gt;</span>&#123; (&#123;x, y&#125;) =&gt; &#123;return (<span class="tag">&lt;<span class="name">div</span>&gt;</span>位置：&#123;x&#125;, &#123;y&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)&#125; &#125;<span class="tag">&lt;/<span class="name">Mouse</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Mouse</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;</span></span><br><span class="line"><span class="language-xml">            (&#123;x, y&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">              return (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&#123;&#123;position:</span>&#x27;<span class="attr">absolute</span>&#x27;, <span class="attr">top:y</span>, <span class="attr">left:x</span>&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              )</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">          &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Mouse</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h2><ul>
<li>优势<ul>
<li>解决了以上的嵌套问题，而且实现了视图和状态的分离，Hooks 还可以相互组合。</li>
<li>Hooks 为函数组件而生，从而解决了类组件的几大问题：this 指向容易错误、声明周期中的逻辑代码难以理解和维护、代码复用成本高等。</li>
</ul>
</li>
<li>缺陷<ul>
<li>用法限制：只能在最顶层使用 Hook，不能在循环、条件判断或嵌套函数中调用。只能在 React 函数组件中调用 Hook，不能在普通函数中调用。</li>
<li>在闭包场景可能会引用到旧的 state、props 值，React.memo 也不能完全替代 shouldComponentUpdate（因为拿不到 state change，只针对 props change）。</li>
</ul>
</li>
</ul>
<h1 id="二、react-hooks"><a href="#二、react-hooks" class="headerlink" title="二、react-hooks"></a>二、react-hooks</h1><blockquote>
<p>react16.8 新增的特性，是为纯函数组件提供能力的 React API。它并不能完全代替 class 声明的组件，对于业务比较复杂的组件还是首选 class 组件，但我们可以把 class 组件内部拆解成 funciton 组件并根据业务需求分为逻辑交互、动态渲染等，然后配合 usememo 等提升性能。使用规则主要如下：</p>
</blockquote>
<ul>
<li><strong>函数声明方式</strong>：不需要定义 constructor、render、class 就可以操作 state 等特性，不需要写各种生命周期。</li>
<li><strong>限制条件</strong>：只能在最顶层调用，不能在循环、条件判断或嵌套函数中调用。只能在 React 函数组件中调用，不能在普通函数中调用。</li>
<li><strong>性能提升</strong>：支持将大组件拆分为一个个独立的渲染空间而减少了渲染次数，支持抽离公共方法和组件而增加了代码的可复用性和逻辑性。</li>
</ul>
<h2 id="主要-API"><a href="#主要-API" class="headerlink" title="主要 API"></a>主要 API</h2><blockquote>
<p>usestate、useReducer 可以保存当前数据，但是它们的回调函数执行时会使整个组件重新执行渲染。如果我们想要更新数据但又不想触发组件更新，则可以选择 useRef。useMemo、useCallback 接收的参数一样，都是在其依赖项发生变化后才执行，都是返回缓存的值，区别在于 useMemo 返回函数运行的结果，useCallback 返回的是经过处理后的函数。</p>
</blockquote>
<ul>
<li><strong>useState</strong>：数据存储，派发更新。</li>
<li><strong>useEffect</strong>：组件更新的钩子，可重复多个。执行顺序为 组件更新挂载完成、浏览器 dom 绘制完成、执行 useEffect 回调。回调函数的代码在渲染视图过程中会造成画面闪动的效果。</li>
<li><strong>useLayoutEffect</strong>：渲染更新之前的 useEffect。执行顺序为 组件更新挂载完成、执行 useLayoutEffect 回调、浏览器 dom 绘制完成。回调函数的代码会阻塞浏览器绘制而引起画面卡顿等效果。</li>
<li><strong>useRef</strong>：获取元素，缓存数据。类似 class 组件的 ref 获取元素方法，第一个参数可以用来初始化保存数据并在 current 属性上获取和更新。</li>
<li><strong>useContext</strong>：获取父级组件传递的上下文 context，可以代替 context.Consumer 来获取 Provider value。</li>
<li><strong>useReducer</strong>：react-hooks 提供的能够在无状态组件中运行的类似 redux 的功能 api，但它并不能代替 redux，redux 中间件模式能够在复杂的逻辑中展现优势。</li>
<li><strong>useMemo</strong>：能够形成独立的渲染空间，让组件和变量按照约定好的规则更新，让无状态组件实现部分视图的更新而提高性能。memo、useMemo 可看作是结合了 pureComponent 纯组件、componentShouldUpdate 更新次数限制的功能。</li>
<li><strong>useCallback</strong>：用法同 useMemo 但返回回调函数。父组件向子组件传递函数时，由于无状态组件每一次都会重新生成新的 props 函数，这样就使每次传递的函数都发生了变化进而会触发子组件的更新，这些更新是没有必要的，此时我们就可以通过 useCallback 来处理此函数，然后作为 props 传递给子组件。注意它必须配合 react.memo pureComponent，否则不但不会提升性能，还有可能降低性能。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect, useRef, useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Demo</span> = (<span class="params">&#123; a &#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleResize</span> =(<span class="params"></span>)=&gt;&#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 第一个参数可以用来初始化保存数据</span></span><br><span class="line">    <span class="keyword">const</span> div = <span class="title function_">useRef</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@prame</span>  参数一：初始状态值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@prame</span>  参数二：改变状态的函数，函数的参数即需要更新的值</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [userMessage, setUserMessage]:any= <span class="title function_">useState</span>(&#123;&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@prame</span>  参数一：function，默认每次渲染完成后执行的函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@prame</span>  参数二：函数执行条件，[] 首次渲染时，[count] count更新时</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@desp</span>   useEffect 使用时如果不加限制 ，会是函数重复执行，陷入死循环</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="title function_">useEffect</span>(() = &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">`You clicked <span class="subst">$&#123;number&#125;</span> times`</span>;</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">getUserInfo</span>(a).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">setUserMessage</span>(res)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取和改变数据，默认 dom 元素</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(div.<span class="property">current</span>) </span><br><span class="line">        div.<span class="property">current</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 订阅、计时器的设置和卸载</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize)</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">setNumber</span>(<span class="function"><span class="params">number</span> =&gt;</span> number + <span class="number">1</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(timer) </span><br><span class="line">          <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,[a, number])</span><br><span class="line">    <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;div&#125;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;userMessage.name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;userMessage.age&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setNumber(number + 1)&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 错误写法</span></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>(payload)</span><br><span class="line">    &#125;, [])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> <span class="variable">useContext</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Context 两种获取方式：createContext 方式引入、父级传递</span></span><br><span class="line"><span class="comment"> *        </span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">DemoContext</span> = (<span class="params"></span>)=&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">value</span>:any = <span class="title function_">useContext</span>(<span class="title class_">Context</span>)</span><br><span class="line">    <span class="comment">/* my name is alien */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> my name is &#123; value.name &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Context.Consumer 方式</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">DemoContext1</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Context.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/*  my name is alien  */&#125;</span></span><br><span class="line"><span class="language-xml">        &#123; (value)=&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span> my name is &#123; value.name &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span> &#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Context.Consumer</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ()=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">name:</span>&#x27;<span class="attr">alien</span>&#x27; , <span class="attr">age:18</span> &#125;&#125; &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">DemoContext</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">DemoContext1</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span>  参数一：函数 reducer，返回更新后的 state</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span>  参数二：state 初始值，返回一个数组包含 state 新值和 dispatch</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>   触发组件重新渲染的派发更新函数函数：useState、dispatch</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">DemoUseReducer</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="comment">// number 为更新后的 state 值，dispatchNumbner 为当前的派发函数</span></span><br><span class="line">    <span class="keyword">const</span> [ number, dispatchNumbner ] = <span class="title function_">useReducer</span>(<span class="function">(<span class="params">state, action</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; payload, name  &#125; = action</span><br><span class="line">        <span class="comment">// return 的值为新 state</span></span><br><span class="line">        <span class="keyword">switch</span> (name) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> state + <span class="number">1</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;sub&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> state - <span class="number">1</span> </span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;reset&#x27;</span>:</span><br><span class="line">              <span class="keyword">return</span> payload       </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> state</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        当前值：&#123; number &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>dispatchNumbner(&#123; name:&#x27;add&#x27; &#125;)&#125;&gt;增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>dispatchNumbner(&#123; name:&#x27;sub&#x27; &#125;)&#125;&gt;减少<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>dispatchNumbner(&#123; name:&#x27;reset&#x27;, payload: 66 &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;赋值<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123; // 把 dispatch、state 传递给子组件 &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">MyChildren</span> <span class="attr">dispatch</span>=<span class="string">&#123;</span> <span class="attr">dispatchNumbner</span> &#125; <span class="attr">State</span>=<span class="string">&#123;&#123;</span> <span class="attr">number</span> &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 参数一：重新渲染的回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 参数二：deps 数组，数组参数变化时执行回调函数</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  1、listshow、selectList 改变时才更新，减少不必要的循环和渲染</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  2、减少子组件的渲染次数：包裹的函数可以避免每次组件更新时重新声明</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  3、让函数在某个依赖项改变时才运行，避免很多不必要的开销</span></span><br><span class="line"><span class="comment">**/</span> </span><br><span class="line"><span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Modal</span> <span class="attr">width</span>=<span class="string">&#123;</span>&#x27;<span class="attr">70</span>%&#x27;&#125; <span class="attr">visible</span>=<span class="string">&#123;listshow&#125;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">PatentTable</span> <span class="attr">getList</span>=<span class="string">&#123;getList&#125;</span> <span class="attr">selectList</span>=<span class="string">&#123;selectList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line">), [listshow, selectList])</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">DemoUseMemo</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// 打印值不是最新 number：因为 useMemo 包裹的上下文会形成一个独立闭包</span></span><br><span class="line">    <span class="keyword">const</span> newLog = <span class="title function_">useMemo</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">log</span> =(<span class="params"></span>)=&gt;&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(number) &#125;</span><br><span class="line">        <span class="keyword">return</span> log</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>newLog()&#125; &gt;打印<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setNumber(number+1)&#125;&gt;增加<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// react.memo </span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DemoChildren</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 只有初始化时打印了，子组件更新</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;子组件更新&#x27;</span>)</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        props.<span class="title function_">getInfo</span>(<span class="string">&#x27;子组件&#x27;</span>)</span><br><span class="line">    &#125;, [])</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>子组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">DemoUseCallback</span>=(<span class="params">&#123; id &#125;</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">// usecallback 参数一经过处理赋值给 getInfo</span></span><br><span class="line">    <span class="keyword">const</span> getInfo = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">sonName</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(sonName)</span><br><span class="line">    &#125;, [id])</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* 点击按钮触发父组件更新 ，但是子组件没有更新 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>setNumber(number+1)&#125;&gt;增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">DemoChildren</span> <span class="attr">getInfo</span>=<span class="string">&#123;getInfo&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="自定义-Hook"><a href="#自定义-Hook" class="headerlink" title="自定义 Hook"></a>自定义 Hook</h2><h2 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h2><ul>
<li>单个组件内部数据传递：state</li>
<li>父组件向子组件传递：props</li>
<li>子组件向父组件传递：props</li>
<li>兄弟组件之间的通信：props</li>
<li>父组件向后代组件传递：props、Context API、Redux、发布-订阅模式、EventBus</li>
<li>非关系组件传递：Context API、Redux、发布-订阅模式、EventBus</li>
</ul>
]]></content>
      <categories>
        <category>JS 框架</category>
      </categories>
      <tags>
        <tag>JS 框架</tag>
      </tags>
  </entry>
  <entry>
    <title>React 框架</title>
    <url>/2019/08/17/10-1-React%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h1 id="一、开发技术"><a href="#一、开发技术" class="headerlink" title="一、开发技术"></a>一、开发技术</h1><ul>
<li><strong>脚手架</strong>：<code>create-react-app</code> 官方推荐、<code>Vite</code> 构建工具、<code>Umi Ice</code> 蚂蚁和阿里的前端框架、<code>nwb</code> 构建应用和库的工具包、<code>Neutrino</code> 构建初始配置的应用、<code>NextJS</code> 构建基于 NodeJS 的服务端应用、<code>Razzle</code> 构建无配置的服务端应用、<code>Gatsby</code> 构建静态网站。</li>
<li><strong>底层框架</strong>：<code>Umi Ice</code> 前端应用框架、<code>NextJS Razzle</code> 服务端渲染(后者无需配置)、<code>Remix</code> 全栈开发、<code>Flutter ReactNative Ionic Taro</code> 跨平台开发、<code>Gatsby</code> 静态网站部署。</li>
<li><strong>UI 组件库</strong>：<code>Ant-design</code> 阿里、<code>Arco-design</code> 字节、<code>TDesign</code> 腾讯、<code>MaterialUI MUI</code> 谷歌、<code>Zarm</code> 众安、<code>NutUI</code> 京东、<code>WeUI</code> 微信、<code>Chakra</code> 响应式、<code>Blueprint</code> 桌面应用。</li>
<li><strong>单页面开发</strong>：<code>create-react-app umi</code> 初始化结构，<code>Component</code> 开发组件、<code>JSX</code> 扩展语法、<code>react-router</code> 管理路由、<code>storybook</code> 组件测试、<code>react-devtools</code> 项目调试。</li>
<li><strong>样式策略</strong>：<code>JSX</code> 内联、<code>CSS SCSS</code> 文件、<code>styled-components Jss Radium</code> 使用 JS。</li>
<li><strong>状态管理</strong>：<code>Redux Zustand</code> 手动更新的单向数据流、<code>Mobx Valtio</code> 响应式自动更新的双向绑定、<code>Jotai Recoil</code> 多组件数据共享的状态原子化、<code>Xsate</code> 管理复杂状态跳转的有限状态机、<code>Rxjs</code> 自定义数据流的异步编程库、<code>Dva</code> 基于 redux + react-router + redux-saga 进行二次封装的数据流方案、<code>React-Query + Context</code> 分别管理服务端和客户端的状态。</li>
<li><strong>技术展望</strong>：<code>pnpm</code> 更快更节省空间的包管理工具 (取代 npm)、<code>Vite</code> 按需编译的构建工具 (取代 webpack)、<code>Tailwindcss</code> 构建定制化样式的框架 (取代 CSS 及其预处理工具)，<code>React-Query</code> 服务端异步状态管理器 (取代异步请求时需要维护大量状态的 Redux&#x2F;MobX)。</li>
</ul>
<h2 id="React-简介"><a href="#React-简介" class="headerlink" title="React 简介"></a>React 简介</h2><blockquote>
<p>Facebook 开源的一个用于动态构建界面的视图框架。它采用声明范式来描述应用，构建虚拟 DOM，支持 JSX 语法，通过 React.Component 构建可复用组件，通过 props 实现简单的父子组件通信，它并不是复杂应用的完整解决方案，还需要集成 react-router、react-redux、redux-saga、Ant-design 等第三方库或者直接使用一个应用级框架。</p>
</blockquote>
<ol>
<li><strong>声明式设计</strong>：采用简洁易懂的声明范式，可以轻松描述应用。</li>
<li><strong>单向数据流</strong>：推崇一种单向的数据流动模式，减少了重复代码。</li>
<li><strong>高效渲染</strong>：通过组件构建 <code>Virtual DOM</code> (描述元素的对象)，更新时通过算法 <code>react-diff</code> 只将差异部分重新渲染到真实元素，相比每次遍历元素属性的传统方式而极大提升了性能。</li>
<li><strong>组件化开发</strong>：DOM 树上的节点称为<code>元素</code>，Virtual DOM 上的节点则称为<code>组件</code>。组件具有功能独立、高内聚、低耦合的特点，开发时不能用模板而推荐使用 <code>JSX</code>。</li>
<li><strong>支持客户端与服务器渲染</strong>：服务端渲染 (Node)、APP (ReactNative)。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 虚拟 DOM</span></span><br><span class="line"><span class="keyword">const</span> span = <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">null</span>, <span class="string">&#x27;玫瑰&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> p = <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">className</span>: <span class="string">&#x27;active&#x27;</span>&#125;, <span class="string">&#x27;花&#x27;</span>, span)</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(p, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>];</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">    <span class="string">`&lt;ul&gt;&#123;list.map((item,index) =&gt; &lt;li key=&#123;index&#125;&gt;&#123;item&#125;&lt;/li&gt;)&#125;&lt;/ul&gt;`</span>, </span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令式编程</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>.<span class="title function_">map</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;m&#x27;</span>), &#123;<span class="attr">center</span>: &#123;lat,lng&#125;&#125;)</span><br><span class="line"><span class="keyword">const</span> marker = <span class="keyword">new</span> <span class="title class_">Map</span>.<span class="title function_">marker</span>(&#123; <span class="attr">position</span>: &#123;lat, lng&#125;, <span class="attr">title</span>: <span class="string">&#x27;Marker&#x27;</span> &#125;)</span><br><span class="line">marker.<span class="title function_">setMap</span>(map)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明式编程</span></span><br><span class="line">&lt;<span class="title class_">Map</span> zoom=&#123;<span class="number">4</span>&#125; center=&#123;lat, lng&#125;&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Marker</span> <span class="attr">position</span>=<span class="string">&#123;lat,</span> <span class="attr">lng</span>&#125; <span class="attr">title</span>=<span class="string">&#123;</span>&#x27;<span class="attr">Hello</span> <span class="attr">Marker</span>&#x27;&#125;/&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Map</span>&gt;</span><br></pre></td></tr></table></figure>


<h2 id="项目构建"><a href="#项目构建" class="headerlink" title="项目构建"></a>项目构建</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// create-react-app：基于 webpack 大而全的打包层方案</span></span><br><span class="line">npx create-react-app react-app</span><br><span class="line">npm start        <span class="comment">// 开发模式运行</span></span><br><span class="line">npm run build    <span class="comment">// 生产模式打包</span></span><br><span class="line">npm test         <span class="comment">// 测试模式测试</span></span><br><span class="line">npm run eject    <span class="comment">// 显示配置文件 webpack.config.js</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Vite：小而巧的打包层方案</span></span><br><span class="line">npm install vite -g</span><br><span class="line">npm init vite-app --template react</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Umi4：整合了 React 生态的应用框架，推荐高性能 npm 的 pnpm </span></span><br><span class="line">npm i pnpm -g</span><br><span class="line">pnpm config set registry <span class="attr">https</span>:<span class="comment">//registry.npmmirror.com</span></span><br><span class="line">pnpm dlx create-umi@latest</span><br><span class="line">npx create-umi@latest</span><br><span class="line">pnpm run dev、npm start</span><br><span class="line"></span><br><span class="line"><span class="comment">// Umi3：注意不要混淆新版命令</span></span><br><span class="line">npx @umijs/create-umi-app</span><br><span class="line">npm create @umijs/umi-app</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>


<h2 id="样式策略"><a href="#样式策略" class="headerlink" title="样式策略"></a>样式策略</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 内联样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Button</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> buttonGreen = &#123;</span><br><span class="line">        <span class="attr">backgroundColor</span>: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">        <span class="attr">border</span>: <span class="string">&quot;1px solid white&quot;</span>,</span><br><span class="line">        <span class="attr">borderRadius</span>: <span class="string">&quot;2px&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;buttonGreen&#125;</span>&gt;</span>green<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 样式文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TestChidren</span> <span class="keyword">from</span> <span class="string">&quot;./TestChidren&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;@/assets/css/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;link-name&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">TestChidren</span>&gt;</span>子组件样式<span class="tag">&lt;/<span class="name">TestChidren</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Test</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// npm i react-jss -D：支持复用、局部、props 动态样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;createUseStyles&#125; <span class="keyword">from</span> <span class="string">&#x27;react-jss&#x27;</span></span><br><span class="line"><span class="keyword">const</span> useStyles = <span class="title function_">createUseStyles</span>(&#123;</span><br><span class="line">    <span class="attr">buttonGreen</span>: &#123;</span><br><span class="line">        <span class="attr">backgroundColor</span>: <span class="function"><span class="params">backgroundColour</span> =&gt;</span> backgroundColour,</span><br><span class="line">        <span class="attr">border</span>: <span class="string">&quot;1px solid white&quot;</span>,</span><br><span class="line">        <span class="attr">borderRadius</span>: <span class="string">&quot;2px&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Button</span> = (<span class="params">&#123;backgroundColour, children&#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;buttonStyles&#125; = <span class="title function_">useStyles</span>(backgroundColour)</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;buttonStyles&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// npm i styled-components -D：支持 Sass、props 动态样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">&quot;styled-components&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Btn</span> = styled.<span class="property">button</span><span class="string">`background: blue;`</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CoolButton</span> = <span class="title function_">styled</span>(<span class="title class_">Btn</span>)<span class="string">`color: pink;`</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Title</span> = styled.<span class="property">div</span><span class="string">`</span></span><br><span class="line"><span class="string">    text-align: center;</span></span><br><span class="line"><span class="string">    img &#123;</span></span><br><span class="line"><span class="string">        height: 100px;</span></span><br><span class="line"><span class="string">        width: 200px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    p &#123;</span></span><br><span class="line"><span class="string">        font-size: 20px;</span></span><br><span class="line"><span class="string">        color: <span class="subst">$&#123;props =&gt; props.color&#125;</span>;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">&#123;imgUrl, themeColor&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">color</span>=<span class="string">&#123;themeColor&#125;</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;imgURl&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Title</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// npm i radium -D：扩展内联样式，支持变量、伪类、媒体查询、动画</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Radium</span> <span class="keyword">from</span> <span class="string">&#x27;radium&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> styles = &#123;</span><br><span class="line">    <span class="attr">base</span>: &#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;:hover&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">background</span>: <span class="string">&#x27;#0074d9&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">primary</span>: &#123;</span><br><span class="line">        <span class="attr">background</span>: <span class="string">&#x27;#0074D9&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">warning</span>: &#123;</span><br><span class="line">        <span class="attr">background</span>: <span class="string">&#x27;#FF4136&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;[styles.base,</span> <span class="attr">styles.primary</span>]&#125;&gt;</span>P<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="JSX-语法"><a href="#JSX-语法" class="headerlink" title="JSX 语法"></a>JSX 语法</h2><blockquote>
<p>Facebook 提出的 <code>JS 扩展语法、React.Fragment 语法糖</code>，主要用于创建虚拟 DOM 并被 babel 编译为 React.createElement。主要优点有编写组件简单、渲染时输出虚拟 dom 提高性能、渲染前将传入值转为字符串而防止 XSS 跨站脚本攻击，实现原理和使用规则如下：</p>
</blockquote>
  <div align="center">
      <img src="/images/react/jsx.png" alt="JSX 原理" width="100%">
  </div>

<ul>
<li>表格标签必须添加 tbody。</li>
<li>最外层有且只有一个标签，但可以是空标签。</li>
<li>对大小写敏感，区分是组件还是 html 标签。</li>
<li>所有的标签必须闭合，单标签必须有末尾反斜杠。</li>
<li>标签内放 <code>&lt;</code> 会报错，因为他会按照 html 来解析。</li>
<li>在标签内部的注释需要写入 <code>&#123;&#125;</code>，在标签外的的注释则不需要。</li>
<li><code>&#123;&#125;</code> 不可插入：函数声明、对象、for 循环、if 语句、while 语句。</li>
<li><code>&#123;&#125;</code> 可插入：变量、简单运算、JS 内置函数、函数执行、三元运算符、自定义组件。</li>
<li>属性名：小驼峰命名，不能使用关键字：<code>class - classNmae、for - htmlFor</code>。</li>
<li>属性值：字符串加引号，变量加 <code>&#123;&#125;</code>。有换行符时设置样式 <code>whiteSpace: &#39;pre-wrap&#39;</code>。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 解析规则：&lt; 开头的标签使用 HTML 规则解析、&#123; 开头的使用 JS 规则解析</span></span><br><span class="line"><span class="comment">// 编译前：JSX 表达式</span></span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;input-wrap&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">title</span>=<span class="string">&quot;请输入&quot;</span> /&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译过程：执行 React.createElement</span></span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>, &#123;<span class="attr">className</span>: <span class="string">&#x27;input-wrap&#x27;</span>&#125;,</span><br><span class="line">    <span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">        <span class="string">&quot;input&quot;</span>,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">class</span>: <span class="string">&#x27;input&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;请输入&#x27;</span> &#125;</span><br><span class="line">    ),</span><br><span class="line">    <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">null</span>, <span class="string">&quot;搜索&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译结果：虚拟 DOM</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">tagName</span>: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">  <span class="attr">attribute</span>: &#123; <span class="attr">className</span>: <span class="string">&#x27;input-wrap&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">tagName</span>: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">      <span class="attr">attribute</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>, <span class="attr">value</span>:<span class="string">&#x27;&#x27;</span>, <span class="attr">class</span>:<span class="string">&#x27;input&#x27;</span>, <span class="attr">title</span>:<span class="string">&#x27;请输入&#x27;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">tagName</span>: <span class="string">&quot;button&quot;</span>, <span class="attr">attribute</span>: <span class="literal">null</span>, <span class="attr">children</span>: <span class="string">&#x27;搜索&#x27;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">============= 基础使用 =============</span><br><span class="line"><span class="comment">// 空标签：&lt;React.Fragment /&gt; 的语法糖</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Columns</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性值</span></span><br><span class="line">&lt;div tabIndex=<span class="string">&quot;0&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> = <span class="string">&#123;</span>`<span class="attr">images</span>/$&#123;<span class="attr">star</span>&#125;<span class="attr">.png</span>`&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;</span>`<span class="attr">tab</span> $&#123;<span class="attr">index</span>==<span class="string">this.state.i</span> ? &#x27;<span class="attr">active</span>&#x27;<span class="attr">:</span>&#x27;&#x27;&#125;`&#125;&gt;</span>标签<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> props = &#123; <span class="attr">name</span>: <span class="string">&quot;Jack&quot;</span>, <span class="attr">age</span>: <span class="number">20</span>, <span class="attr">children</span>: [] &#125;</span><br><span class="line">&lt;span &#123;...props&#125;&gt;&lt;/span&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 行内样式：双大括号，标准 JSON，省略 px，名字性驼峰</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> <span class="attr">200</span>, <span class="attr">height:</span> <span class="attr">200</span>, <span class="attr">backgroundColor</span> <span class="attr">:</span> &#x27;<span class="attr">red</span>&#x27;&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&#123;&#123;display:</span> (<span class="attr">index</span>==<span class="string">this.state.i)</span> ? &#x27;<span class="attr">block</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">none</span>&#x27;&#125;&#125;&gt;</span>标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件渲染</span></span><br><span class="line"><span class="keyword">const</span> isBtn = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isBtn</span></span><br><span class="line">&lt;div&gt;&#123; isBtn &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span> /&gt;</span></span>&#125;&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123; isBtn ? <span class="tag">&lt;<span class="name">Button</span> /&gt;</span> : <span class="tag">&lt;<span class="name">span</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">span</span>&gt;</span> &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="keyword">if</span> (isBtn) &#123; <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">Button</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Render</span> (&#123; <span class="attr">if</span>: cond, children &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> cond ? children : <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">Render</span> <span class="keyword">if</span>=&#123;status === <span class="string">&#x27;loading&#x27;</span>&#125; &gt;加载&lt;/<span class="title class_">Render</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表达式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatName</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;user.firstName&#125;</span> <span class="subst">$&#123;user.lastName&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line">render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;parseInt(Math.random() * 100)&#125;年<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;formatName(this.state.user)&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列表</span></span><br><span class="line">&lt;ul&gt;&#123;arr.<span class="title function_">map</span>(<span class="function">(<span class="params">item,index</span>)=&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span> &#123;item&#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>)&#125;&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件</span></span><br><span class="line"><span class="keyword">import</span> cn <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">CustomIcon</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; type, className, active=<span class="literal">false</span>, onClick &#125; = props;</span><br><span class="line">    <span class="keyword">const</span> cls = <span class="title function_">cn</span>(<span class="string">&#x27;custom-icon&#x27;</span>, className, <span class="string">`custom-icon**<span class="subst">$&#123;type&#125;</span>`</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;custom-icon--active&#x27;</span>: active</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">className</span>=<span class="string">&#123;cls&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CustomIcon</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@C/_common&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">DeletableBlock</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; title, children, index, onDelete &#125; = props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;cc-delete-block&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CustomIcon</span> <span class="attr">type</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>handleDelete(index)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">          &#123;/* 注释：子组件 */&#125;</span></span><br><span class="line"><span class="language-xml">          &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleDelete</span>(<span class="params">index</span>) &#123;</span><br><span class="line">        <span class="title function_">onDelete</span>(index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Vite-工具"><a href="#Vite-工具" class="headerlink" title="Vite 工具"></a>Vite 工具</h2><blockquote>
<p>一个基于浏览器原生 ES imports 的开发服务器。主要原理是服务器拦截浏览器发出的 ES imports 请求并做相应处理后返回，整个过程没有对文件进行打包编译，所以热更新的速度不会随着模块增多而变慢，但是 Vite 处理的是开发模式而在生产模式则可以通过 rollup 打包。主要优点有快速冷启动服务器、即时热模块更换 HMR、真正的按需编译。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vite 搭建项目</span></span><br><span class="line">npm install vite -g</span><br><span class="line">npm init vite-app --template react</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 实现原理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  1、模块引入路径按需修改：import &#123; createApp &#125; from &#x27;<span class="doctag">@modules</span>/vue.js&#x27;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  2、浏览器发起请求：GET localhost:3000/src/main.js、/<span class="doctag">@modules</span>/vue.js</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  3、Vite 劫持包含浏览器请求并通过服务器解析处理后返回，</span></span><br><span class="line"><span class="comment">**/</span> </span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// vite/index.js：简单实现</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="property">promises</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; parse &#125; = <span class="built_in">require</span>(<span class="string">&#x27;es-module-lexer&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MagicString</span> = <span class="built_in">require</span>(<span class="string">&#x27;magic-string&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Readable</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;stream&#x27;</span>)</span><br><span class="line"><span class="comment">// 读取 body 方法</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">readBody</span>(<span class="params">stream</span>) &#123;    </span><br><span class="line">    <span class="keyword">if</span> (stream <span class="keyword">instanceof</span> <span class="title class_">Readable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            stream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">chunk</span>) &#123;</span><br><span class="line">                res += chunk</span><br><span class="line">            &#125;)</span><br><span class="line">            stream.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(res)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stream;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// koa 中间件</span></span><br><span class="line"><span class="keyword">const</span> resolvePlugin = [  </span><br><span class="line">    <span class="comment">// 1、模块引入路径前面加 /@modules/vue，重写后浏览器会再次发送请求</span></span><br><span class="line">    <span class="function">(<span class="params">&#123; app, root &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">rewriteImports</span>(<span class="params">source</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> imports = <span class="title function_">parse</span>(source)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">let</span> ms = <span class="keyword">new</span> <span class="title class_">MagicString</span>(source);</span><br><span class="line">            <span class="keyword">if</span> (imports.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; imports.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">let</span> &#123; s, e &#125; = imports[i];</span><br><span class="line">                    <span class="comment">// 应用的标识 vue  ./App.vue</span></span><br><span class="line">                    <span class="keyword">let</span> id = source.<span class="title function_">slice</span>(s, e); </span><br><span class="line">                    <span class="comment">// 不是./ 或者 /</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="regexp">/^[^\/\.]/</span>.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">                        id = <span class="string">`/@modules/<span class="subst">$&#123;id&#125;</span>`</span>;</span><br><span class="line">                        ms.<span class="title function_">overwrite</span>(s, e, id)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ms.<span class="title function_">toString</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">next</span>();   <span class="comment">// 静态服务</span></span><br><span class="line">            <span class="comment">// 默认会先执行 静态服务中间件 会将结果放到 ctx.body</span></span><br><span class="line">            <span class="comment">// 需要将流转换成字符串，只需要处理 js 中的引用问题</span></span><br><span class="line">            <span class="keyword">if</span> (ctx.<span class="property">body</span> &amp;&amp; ctx.<span class="property">response</span>.<span class="title function_">is</span>(<span class="string">&#x27;js&#x27;</span>)) &#123;</span><br><span class="line">                <span class="keyword">let</span> r = <span class="keyword">await</span> <span class="title function_">readBody</span>(ctx.<span class="property">body</span>);    <span class="comment">// vue =&gt; /@modules</span></span><br><span class="line">                <span class="keyword">const</span> result = <span class="title function_">rewriteImports</span>(r);</span><br><span class="line">                ctx.<span class="property">body</span> = result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 2. 拦截包含 /@modules/vue 的请求，然后去 node_modules 引入对应模块并返回</span></span><br><span class="line">    <span class="function">(<span class="params">&#123; app, root &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^\/@modules\//</span></span><br><span class="line">        app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">            <span class="comment">// 如果没有匹配到 /@modules/vue 就往下执行</span></span><br><span class="line">            <span class="keyword">if</span> (!reg.<span class="title function_">test</span>(ctx.<span class="property">path</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">next</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> id = ctx.<span class="property">path</span>.<span class="title function_">replace</span>(reg, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="keyword">let</span> mapping = &#123;</span><br><span class="line">                <span class="attr">vue</span>: path.<span class="title function_">resolve</span>(root, <span class="string">&#x27;node_modules&#x27;</span>, </span><br><span class="line">                <span class="string">&#x27;@vue/runtime-dom/dist/runtime-dom.esm-browser.js&#x27;</span>),</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> content = <span class="keyword">await</span> fs.<span class="title function_">readFile</span>(mapping[id], <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">            ctx.<span class="property">type</span> = <span class="string">&#x27;js&#x27;</span>;      <span class="comment">// 返回的文件是 js</span></span><br><span class="line">            ctx.<span class="property">body</span> = content;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 3. 解析.vue文件</span></span><br><span class="line">    <span class="function">(<span class="params">&#123; app, root &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!ctx.<span class="property">path</span>.<span class="title function_">endsWith</span>(<span class="string">&#x27;.vue&#x27;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">next</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(root, ctx.<span class="property">path</span>);</span><br><span class="line">            <span class="keyword">const</span> content = <span class="keyword">await</span> fs.<span class="title function_">readFile</span>(filePath, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">            <span class="comment">// 引入 .vue 文件解析模板</span></span><br><span class="line">            <span class="keyword">const</span> &#123; compileTemplate, parse &#125; = <span class="built_in">require</span>(path.<span class="title function_">resolve</span>(root, </span><br><span class="line">            <span class="string">&#x27;node_modules&#x27;</span>, <span class="string">&#x27;@vue/compiler-sfc/dist/compiler-sfc.cjs&#x27;</span>))</span><br><span class="line">            <span class="keyword">let</span> &#123; descriptor &#125; = <span class="title function_">parse</span>(content);</span><br><span class="line">            <span class="keyword">if</span> (!ctx.<span class="property">query</span>.<span class="property">type</span>) &#123;</span><br><span class="line">                <span class="comment">// App.vue</span></span><br><span class="line">                <span class="keyword">let</span> code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> (descriptor.<span class="property">script</span>) &#123;</span><br><span class="line">                    <span class="keyword">let</span> desp = descriptor.<span class="property">script</span>.<span class="property">content</span>;</span><br><span class="line">                    code += desp.<span class="title function_">replace</span>(<span class="regexp">/((?:^|\n|;)\s*)export default/</span>, </span><br><span class="line">                    <span class="string">&#x27;$1const __script=&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (descriptor.<span class="property">template</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> reqPath = ctx.<span class="property">path</span> + <span class="string">`?type=template`</span>;</span><br><span class="line">                    code += <span class="string">`\nimport &#123;render as __render&#125; from &quot;<span class="subst">$&#123;reqPath&#125;</span>&quot;`</span>;</span><br><span class="line">                    code += <span class="string">`\n__script.render = __render`</span></span><br><span class="line">                &#125;</span><br><span class="line">                code += <span class="string">`\nexport default __script`</span></span><br><span class="line">                ctx.<span class="property">type</span> = <span class="string">&#x27;js&#x27;</span>;</span><br><span class="line">                ctx.<span class="property">body</span> = code</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ctx.<span class="property">query</span>.<span class="property">type</span> == <span class="string">&#x27;template&#x27;</span>) &#123;</span><br><span class="line">                ctx.<span class="property">type</span> = <span class="string">&#x27;js&#x27;</span>;</span><br><span class="line">                <span class="keyword">let</span> desp = descriptor.<span class="property">template</span>.<span class="property">content</span></span><br><span class="line">                <span class="comment">// 将 app.vue 中的模板 转换成 render 函数</span></span><br><span class="line">                <span class="keyword">const</span> &#123; code &#125; = <span class="title function_">compileTemplate</span>(&#123; <span class="attr">source</span>: desp &#125;); </span><br><span class="line">                ctx.<span class="property">body</span> = code;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 4. 静态服务插件 实现可以返回文件的功能</span></span><br><span class="line">    <span class="function">(<span class="params">&#123; app, root &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        app.<span class="title function_">use</span>(<span class="title function_">static</span>(root))</span><br><span class="line">        app.<span class="title function_">use</span>(<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(root, <span class="string">&#x27;public&#x27;</span>)))</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createServer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>()</span><br><span class="line">    <span class="comment">// 创建一个用来给不同插件共享功能的上下文对象</span></span><br><span class="line">    <span class="keyword">const</span> context = &#123;     </span><br><span class="line">        app,</span><br><span class="line">        <span class="attr">root</span>: process.<span class="title function_">cwd</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 运行中间件</span></span><br><span class="line">    resolvePlugin.<span class="title function_">forEach</span>(<span class="function"><span class="params">plugin</span> =&gt;</span> <span class="title function_">plugin</span>(context))</span><br><span class="line">    <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">createServer</span>().<span class="title function_">listen</span>(<span class="number">4000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Dev server running at:&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">` &gt; Local: <span class="subst">$&#123;chalk.cyan(<span class="string">&#x27;http://localhost:4000/&#x27;</span>)&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h1 id="三、组件开发"><a href="#三、组件开发" class="headerlink" title="三、组件开发"></a>三、组件开发</h1><blockquote>
<p>根据功能可分为展示组件和容器组件，根据定义方式可分为函数组件和类组件，根据状态可分为无状态组件和有状态组件。React 组件使用 state 来管理自身数据并通过 props 来接收外部数据，为了实现对数据变更做出响应而采用 Class 组件并提供了生命周期和一系列 API。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基于 Class 设计组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyConponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="comment">// 组件数据</span></span><br><span class="line">    state = &#123; <span class="attr">counts</span>: <span class="number">0</span> &#125;</span><br><span class="line">    <span class="comment">// 响应数据变更</span></span><br><span class="line">    clickHandle = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">counts</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">counts</span>++ &#125;);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">onClick</span>) <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onClick</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 生命周期钩子</span></span><br><span class="line">    <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Will mouned!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 接收外部数据并显示</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>Input content: &#123;props.content&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>btn click counts: &#123;this.state.counts&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.clickHandle&#125;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="组件创建"><a href="#组件创建" class="headerlink" title="组件创建"></a>组件创建</h2><blockquote>
<p>组件名的首字母必须大写，因为 JSX 转换时会调用 <code>React.createElement(type, config, children)</code>。type 声明了元素类型：首字母大写时会被 babel 看作一个组件而传入变量，小写时则看作一个 html 标签而传入字符串。</p>
</blockquote>
<ul>
<li><strong>函数式创建无状态组件</strong>：组件不会被实例化而整体渲染性能较好(推荐尽量使用)、组件不能操作 state 而且不能访问生命周期和 this。</li>
<li><strong>ES5 原生方式已废弃</strong>：每个成员函数的 this 都会由 React 自动绑定而导致不必要的性能开销、创建组件时可以添加 mixins 属性并将可供混合的所有类的数组形式赋给它。</li>
<li><strong>ES6 创建有状态组件</strong>：成员函数需要开发者手动绑定否则会让 this 不能获取当前组件的实例对象、state 是在 constructor 中实现初始化、props 属性和默认属性作为组件类的属性并不是组件实例的属性所以使用类的静态属性配置。</li>
<li><strong>其它方式</strong>：高阶组件(一个接收原组件为参数并返回新组件的纯函数)、Hooks。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数组件：写法简洁，应尽量使用，但是功能单一</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyCom</span>(<span class="params">props</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>mycomponent<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5 原生</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyCom</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    <span class="title function_">getInitialState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">message</span>: <span class="string">&#x27;Hi&#x27;</span> &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">log</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">message</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Log&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.log&#125;</span> /&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类组件：官方推荐，可以维护状态变量和实现复杂功能</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCom</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 正常写法：有 constructor 则必须有 super</span></span><br><span class="line">    <span class="comment">// super 指父类构造函数 React.Component，传参后会初始化 props</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =  &#123; <span class="attr">name</span>: <span class="string">&quot;&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 简写写法</span></span><br><span class="line">    state =  &#123; <span class="attr">name</span>: <span class="string">&quot;&quot;</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;William&quot;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>this.state.name<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高阶组件</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    state = &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> path = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; path &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>rendering at: &#123;this.state.path&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withRouter</span>(<span class="title class_">App</span>)</span><br></pre></td></tr></table></figure>

<h2 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h2><blockquote>
<p>将事件绑定到 this。</p>
</blockquote>
<ol>
<li><strong>constructor + bind</strong>：只需要在构造函数中预先绑定一次</li>
<li><strong>render + bind</strong>：每次渲染时都需要重新绑定，存在性能问题</li>
<li><strong>ES6 箭头函数</strong>：只能在 render 添加，存在性能问题并且不能移除监听事件。</li>
<li><strong>ES7 箭头函数</strong>：ES6 优化方案，可以在 Class 中直接赋值。需要安装 babel-preset-stage-2 并配置 <code>.babelrc：&quot;presets&quot;:[&quot;react&quot;,&quot;env&quot;,&quot;stage-2&quot;]</code>。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">msg</span>: <span class="string">&quot;hello&quot;</span> &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">logMsg</span> = <span class="variable language_">this</span>.<span class="property">logMsg</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)  <span class="comment">// 1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">logMsg</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">msg</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    _logMsg = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">message</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.logMsg&#125;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.logMsg.bind(this)&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.logMsg()&#125;&gt;3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this._logMsg&#125;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2>  <div align="center">
      <img src="/images/react/life_cycle.png" alt="生命周期执行顺序" width="100%">
  </div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// react-v16.3 之前版本</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1、组件挂载：组件第一次渲染到 Dom 树</span></span><br><span class="line">  constructor</span><br><span class="line">  componentWillMount</span><br><span class="line">  render</span><br><span class="line">  componentDidMount</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2、组件更新：组件 state、props 变化引发的重新渲染</span></span><br><span class="line">  componentWillReceiveProps</span><br><span class="line">  shouldComponentUpdate</span><br><span class="line">  componentWillUpdate</span><br><span class="line">  render</span><br><span class="line">  componentDidUpdate</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3、组件卸载：组件从 Dom 树删除</span></span><br><span class="line">  componentWillUnmount</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// react-v16.3 版本</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 新增</span></span><br><span class="line">  <span class="comment">// 组件实例化时或 props 变化时调用，返回新对象作为新 state，返回 null 则不更新</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromProps</span>(<span class="params">nextProps, prevState</span>)&#123;&#125;</span><br><span class="line">  <span class="comment">// DOM 更新完成前被调用，返回值是 componentDidUpdate 的第三个参数</span></span><br><span class="line">  <span class="title function_">getSnapshotBeforeUpdate</span>(<span class="params">prevProps, prevState</span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 废弃</span></span><br><span class="line">  componentWillMount   <span class="comment">// 预装载函数：不能进行修改 state 的操作</span></span><br><span class="line">  componentWillReceiveProps  <span class="comment">// props 变化时调用，常用于根据新旧数据设置组件状态</span></span><br><span class="line">  componentWillUpdate  <span class="comment">// 预更新函数：此时不能修改属性和状态</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1、组件挂载</span></span><br><span class="line">  constructor   <span class="comment">// 实例化：初始化 state，本地化 props，给事件处理函数绑定 this</span></span><br><span class="line">  <span class="keyword">static</span> getDerivedStateFromProps</span><br><span class="line">  render        <span class="comment">// 渲染函数：不能省略并且必须有返回值 (返回 null/false 表示不渲染)</span></span><br><span class="line">  componentDidMount  <span class="comment">// 挂载完成函数：axios、事件绑定、setState 数据、操作 dom</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2、组件更新</span></span><br><span class="line">  <span class="keyword">static</span> getDeriverdStateFromProps  <span class="comment">// 从 props 中获取 state</span></span><br><span class="line">  shouldComponentUpdate    <span class="comment">// 返回 true/false 表示是否更新，常用于组件性能优化</span></span><br><span class="line">  render                   <span class="comment">// 渲染</span></span><br><span class="line">  getSnapshotBeforeUpdate  <span class="comment">// 获取快照</span></span><br><span class="line">  componentDidUpdate       <span class="comment">// 更新完成函数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3、组件卸载</span></span><br><span class="line">  componentWillUnmount     <span class="comment">// 预销毁函数：移除定时器、事件绑定等</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4、错误处理</span></span><br><span class="line">  <span class="keyword">static</span> getDerivedStateFromError <span class="comment">// 从错误中获取 state</span></span><br><span class="line">  componentDidCatch        <span class="comment">// 捕获错误并进行处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="组件-API"><a href="#组件-API" class="headerlink" title="组件 API"></a>组件 API</h2><blockquote>
<p>npm install react 时加载。组件接收 props 并返回描述渲染逻辑的 React 元素，React 通过传入参数即可渲染出对应页面，这是 React 被称为声明性 API 的原因。</p>
</blockquote>
<ul>
<li><code>render</code>：class 方式创建组件时用于实例化组件(转换格式并插入到指定节点)的渲染函数，props&#x2F;state 被改变时就会重新执行，shouldComponentUpdate 返回 false 时不会执行。</li>
<li><code>state</code>：用于存储组件内部数据，更新时通过 this.setState()、useState。setState 在钩子函数和基于原生事件封装的合成事件中无法获取最新值并且在合成事件中执行多次时只会执行一次，这是因为它们的调用顺序在更新之前而且 setState 源码本身是同步的。</li>
<li><code>props</code>：继承父组件属性和方法的对外接口，数据是只读的但可以限制其类型和默认值。</li>
<li><code>Context</code>：组件树从上至下逐层自动传递的上下文对象，避免了在每个层级都需要手动传递 props。实现原理为基于生产者消费者模式创建一个包含两个组件的上下文对象：Provider (生产者：定义数据的父组件)、Consumer (消费者：使用数据的子孙组件)。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、render：组件渲染</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Header</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    state = &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>rendering at: &#123;this.state.path&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Header</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span>  路由渲染</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> component: 属性值是一个组件，URL、Route 匹配时就会被渲染</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> render: 属性值是一个返回 jsx 元素的函数，方便为组件传递额外属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> children: 同上，区别是返回组件一定会渲染，不匹配时 match: null</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/foo&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;FOO&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/foo&#x27;</span> <span class="attr">render</span>=<span class="string">&#123;props</span>=&gt;</span>(</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Foo</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">data</span>=<span class="string">&#123;extraProps&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/foo&#x27;</span> <span class="attr">children</span>=<span class="string">&#123;props</span>=&gt;</span>(</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;props.match</span> ? &#x27;<span class="attr">active</span>&#x27;<span class="attr">:</span> &#x27;&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Foo</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">data</span>=<span class="string">&#123;extraProps&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">)&#125; /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、state</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyCom</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    state = &#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;</span><br><span class="line">    handle (option, value)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; [option]: value &#125;, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// 状态更新后的回调函数，重新渲染后执行</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> this.handle(&quot;name&quot;)&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、props：传递数据和事件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Block</span> ()&#123;</span><br><span class="line">    <span class="keyword">const</span> name = <span class="string">&quot;Mary&quot;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleDelete</span> = (<span class="params"></span>) =&gt; &#123; &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Name</span> <span class="attr">name</span>=<span class="string">&#123;name&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">DeletableBlock</span> <span class="attr">onDelete</span>=<span class="string">&#123;handleDelete&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Name</span> (&#123;name&#125;)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">DeletableBlock</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; children, onDelete &#125; = props;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> onDelete()&#125;&gt;清空<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Name</span>.<span class="property">propTypes</span> = &#123; <span class="attr">name</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span> &#125;</span><br><span class="line"><span class="title class_">Name</span>.<span class="property">defaultProps</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;Mary&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、Context</span></span><br><span class="line"><span class="comment">// index.js：父组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./son&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123;<span class="title class_">Provider</span>, <span class="title class_">Consumer</span>&#125; = <span class="title class_">React</span>.<span class="title function_">createContext</span>(<span class="string">&quot;value默认值&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = <span class="string">&quot;context 通信&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">value</span>=<span class="string">&#123;name&#125;</span>&gt;</span> <span class="tag">&lt;<span class="name">Son</span> /&gt;</span> <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// son.js：子组件、孙组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Consumer</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">Consumer</span>&gt;</span>&#123;name=&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span>子组件接收：&#123;name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span> &#125;<span class="tag">&lt;/<span class="name">Consumer</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="五、路由功能"><a href="#五、路由功能" class="headerlink" title="五、路由功能"></a>五、路由功能</h1><blockquote>
<p>react-router-4.0 (以下简称 RR4) 采用单代码仓库模型架构，包含了若干相互独立的包。注意：react-router-dom&#x2F;native 已经包含了 react-router 的依赖，使用时不需要安装和引用 react-router。</p>
</blockquote>
<ul>
<li><strong>react-router</strong>：核心公用组件和方法。具体有：MemoryRouter、Prompt、Redirect、Route、RouterStaticRouter、 Switch、matchPath、withRouter。</li>
<li><strong>react-router-dom</strong>：用于 web 环境开发，提供了 dom 操作控制路由的主要方法有 BrowserRouter、 HashRouter、 Link 、NavLink。</li>
<li><strong>react-router-native</strong>：用于给 native 相关应用提供路由支持，主要有 NativeRouter、 Link、 DeepLinkingAndroidBackButton。</li>
<li><strong>react-router-redux</strong>：React Router 和 Redux 的集成。</li>
<li><strong>react-router-config</strong>：集中配置静态路由，主要有 matchRoutes、renderRoutes。</li>
</ul>
<h2 id="路由组件"><a href="#路由组件" class="headerlink" title="路由组件"></a>路由组件</h2><blockquote>
<p>所有与路由有关的组件（Link、NavLink、Route、Switch）必须包裹在容器组件中，容器组件有且只能有一个子元素。</p>
</blockquote>
<ul>
<li>容器组件<ul>
<li><strong>BrowserRouter</strong>：浏览器的路由组件，利用 HTML5 的 history API (pushState、replaceState 和 popstate 事件) 来同步 URL、UI。需要添加服务器配置 (node&#x2F;nginx)，让前端请求映射到对应的 html。</li>
<li><strong>HashRouter</strong>：使用 URL hash (window.location.hash) 方式在前端完成路由切换。<code>#</code> 后面的内容不会发送到服务器端，路由地址对于后端始终不变。</li>
<li><strong>MemoryRouter</strong>：内存路由组件，在内存中管理 URL history，主要用于 ReactNative 这种非浏览器的环境。</li>
<li><strong>StaticRouter</strong>：地址不改变的静态路由组件，主要用于服务端渲染。</li>
<li><strong>NativeRouter</strong>：Native 的路由组件。</li>
</ul>
</li>
<li>相关组件<ul>
<li><strong>Link</strong>：react-router 提供，用于点击时链接到某路径。</li>
<li><strong>NavLink</strong>：Link 的加强版，可以自定义选中状态和钩子函数。</li>
<li><strong>Switch</strong>：用于嵌套 Route 组件，多个路径相同时只匹配第一个。</li>
<li><strong>Route</strong>：用于实现 RR4 动态路由的嵌套。</li>
<li><strong>Redirect</strong>：用于重定向到某路径。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;<span class="title class_">BrowserRouter</span> </span><br><span class="line">    basename=<span class="string">&quot;/admin&quot;</span>     <span class="comment">// 路由器的默认根路径</span></span><br><span class="line">    forceRefresh=&#123;<span class="literal">false</span>&#125;  <span class="comment">// 布尔类型，导航时是否刷新整个页面</span></span><br><span class="line">    keyLength=&#123;<span class="number">12</span>&#125;        <span class="comment">// location.key 的长度，默认 6</span></span><br><span class="line">    getUserConfirmation=&#123;getConfirmation&#125;  <span class="comment">// 导航需要确认时执行的函数</span></span><br><span class="line">&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>/&gt;</span></span>   <span class="comment">// 渲染为 &lt;a href=&quot;/admin/home&quot;&gt;</span></span><br><span class="line">&lt;/<span class="title class_">BrowserRouter</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 覆盖当前路径</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">replace</span>=<span class="string">&#123;true&#125;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span> </span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">pathname:</span> &#x27;/<span class="attr">courses</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">search:</span> &#x27;?<span class="attr">sort</span>=<span class="string">name</span>&#x27;,  // <span class="attr">下个页面取值</span>：<span class="attr">props.location.state</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">hash:</span> &#x27;#<span class="attr">the-hash</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">state:</span> &#123; <span class="attr">fromDashboard:</span> <span class="attr">true</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">&#125;&#125;/&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当 event id 为奇数的时候，激活链接</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">activeEvent</span> = (<span class="params">match, location</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!match) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">    <span class="keyword">const</span> eventID = <span class="built_in">parseInt</span>(match.<span class="property">params</span>.<span class="property">eventID</span>)</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">isNaN</span>(eventID) &amp;&amp; eventID % <span class="number">2</span> === <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">NavLink</span></span><br><span class="line">    to=<span class="string">&quot;/home?ask&quot;</span> </span><br><span class="line">    exact  <span class="comment">// 是否严格匹配</span></span><br><span class="line">    activeClassName=<span class="string">&quot;selected&quot;</span> </span><br><span class="line">    activeStyle=&#123;&#123; <span class="attr">color</span>: <span class="string">&#x27;green&#x27;</span>, <span class="attr">fontWeight</span>: <span class="string">&#x27;bold&#x27;</span> &#125;&#125;</span><br><span class="line">    isActive=&#123;activeEvent&#125;  <span class="comment">// 判断链接是否激活的额外逻辑</span></span><br><span class="line">&gt;问答&lt;/<span class="title class_">NavLink</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">exact</span>                // <span class="attr">是否完全匹配</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">strict</span>               // <span class="attr">path</span> <span class="attr">有结尾斜线只能匹配有斜线的路径</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">path</span>=<span class="string">&quot;/peoples/&quot;</span>     // <span class="attr">路由匹配路径</span> (<span class="attr">不能匹配</span> /<span class="attr">peoples</span>)</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">component</span>=<span class="string">&#123;Peoples&#125;</span>  // <span class="attr">URL</span>、<span class="attr">Route</span> <span class="attr">匹配时渲染的组件</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">&gt;</span><span class="tag">&lt;<span class="name">Route</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/* 进入客户管理页面，默认展示 List 区域内容，或者使用重定向 */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/custom&#x27;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/custom/list&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/custom/create&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Create&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/custom/Detail/:id&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Detail&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/* <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&#x27;/custom&#x27;</span> <span class="attr">to</span>=<span class="string">&#x27;/custom/list&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">Redirect</span>&gt;</span> */&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&#123;&#123;</span> <span class="attr">pathname:</span> &#x27;/<span class="attr">log</span>&#x27;, <span class="attr">search:</span> &#x27;?<span class="attr">name</span>=<span class="string">a</span>&#x27;, <span class="attr">state:</span>&#123;<span class="attr">id:</span> <span class="attr">1</span>&#125; &#125;&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure>


<h2 id="路由对象"><a href="#路由对象" class="headerlink" title="路由对象"></a>路由对象</h2><blockquote>
<p>被 Route 绑定的渲染组件，总是被传入三个属性（对象）：history、location、match。在渲染组件中也会有很多其他组件，这些组件内部如果想要获取三个对象，需要 withRouter（通过装饰器或函数调用的形式都可以）。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// history：用于编程式导航</span></span><br><span class="line"><span class="keyword">let</span> &#123; history &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">history.<span class="title function_">push</span>()       <span class="comment">// 追加一条记录   </span></span><br><span class="line">history.<span class="title function_">replace</span>()    <span class="comment">// 不会追加记录   </span></span><br><span class="line">history.<span class="title function_">goback</span>()     <span class="comment">// 回退</span></span><br><span class="line">history.<span class="title function_">goforward</span>()  <span class="comment">// 前进</span></span><br><span class="line">history.<span class="title function_">go</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="comment">// loaction：指当前位置</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">location</span>: &#123; pathname, search, state&#125; &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;location&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NaviveLink</span> <span class="attr">to</span>=<span class="string">&#123;location&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&#123;location</span> /&gt;</span></span></span><br><span class="line">history.<span class="title function_">push</span>(location)</span><br><span class="line">history.<span class="title function_">replace</span>(location)</span><br><span class="line"></span><br><span class="line"><span class="comment">// match：包含了路由匹配的信息</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">match</span>: &#123; params &#125; &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">id</span>)</span><br></pre></td></tr></table></figure>


<h2 id="路由传参"><a href="#路由传参" class="headerlink" title="路由传参"></a>路由传参</h2><blockquote>
<p>不推荐：localstroage、redux（页面刷新后会丢失数据）。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、params</span></span><br><span class="line">&lt;<span class="title class_">Route</span> path=<span class="string">&#x27;/user/:id&#x27;</span> component=&#123;<span class="title class_">User</span>&#125; /&gt;  <span class="comment">// 路由设置</span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/user/2&#x27;</span> /&gt;</span></span>                 <span class="comment">// 传值一</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">push</span>(<span class="string">&quot;/user/2&quot;</span>);   <span class="comment">// 传值2二</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">match</span>.<span class="property">params</span>.<span class="property">id</span>     <span class="comment">// 获取值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、URL参数</span></span><br><span class="line">&lt;<span class="title class_">Route</span> path=<span class="string">&#x27;/user&#x27;</span> component=&#123;<span class="title class_">User</span>&#125; /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/user?id=2&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">location</span>.<span class="property">query</span>.<span class="property">id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、location 对象（哈希路由不支持）</span></span><br><span class="line">&lt;<span class="title class_">Route</span> path=<span class="string">&#x27;/user&#x27;</span> component=&#123;<span class="title class_">User</span>&#125;&gt;&lt;/<span class="title class_">Route</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;&#123;pathname:</span>&#x27; /<span class="attr">u</span>&#x27;, <span class="attr">state:</span> &#123;<span class="attr">id:1</span>&#125;, <span class="attr">search:</span>&#x27;?<span class="attr">sort</span>=<span class="string">a</span>&#x27;, <span class="attr">hash:</span>&#x27;#<span class="attr">h</span>&#x27;&#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">location</span>.<span class="property">state</span>.<span class="property">id</span></span><br></pre></td></tr></table></figure>


<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><ul>
<li><strong>静态路由</strong>：在应用渲染前的初始化阶段配置好路由信息，应用于 RR4 之前的版本。</li>
<li><strong>动态路由</strong>：随着应用渲染而起作用，无需事先配置路由。核心设计理念是一切都是组件，这更符合 React 组件化的思想。</li>
<li><strong>嵌套路由</strong>：Route 渲染的组件内部定义新的 Route，实现页面的局部变换，比如说标题栏不变，内容根据路由引入不同模块。</li>
<li><strong>响应式路由</strong>：手机端访问 &#x2F;admin，竖屏模式下只展示导航栏，横屏时展示导航栏和内容。PC 端根据屏幕大小展示不同内容。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cnpm i react-router-dom -S</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span>, <span class="title class_">Redirect</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态路由</span></span><br><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/detail/:id&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Detail&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 嵌套路由</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">About</span> = (<span class="params">&#123; match &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;match.url</span> + &#x27;/<span class="attr">other</span>&#x27;&#125; <span class="attr">component</span>=<span class="string">&#123;Other&#125;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    // 路由重定向</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">render</span>=<span class="string">&#123;()</span>=&gt;</span> ( <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> /&gt;</span>) &#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span> /&gt;</span> </span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应式路由</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">AppLayout</span>&gt;</span> <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/admin&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Admin&#125;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">AppLayout</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Admin</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Nav</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Media</span> <span class="attr">query</span>=<span class="string">&#123;PRETTY_SMALL&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;screenIsSmall =&gt; screenIsSmall</span></span><br><span class="line"><span class="language-xml">        ? <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/admin/dashboard&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Dashboard&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/admin/other&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Other&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        : <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/admin/dashboard&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Dashboard&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/admin/other&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Other&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&quot;/admin&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/admin/dashboard&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Media</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<h1 id="六、状态管理"><a href="#六、状态管理" class="headerlink" title="六、状态管理"></a>六、状态管理</h1><blockquote>
<p>将组件之间的共享数据抽取出来进行统一管理，通过约定规则更新而实现可预测的状态更新。</p>
</blockquote>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><blockquote>
<p>实现组件和子孙组件之间跨层级通信，React 原生支持的状态管理方案。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, createContext, useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NotesContext</span> = <span class="title function_">createContext</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [notes, setNotes] = <span class="title function_">useState</span>([])</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createNote</span>(<span class="params">note</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> notesArray = [...notes, note]</span><br><span class="line">        <span class="title function_">setNotes</span>(notesArray)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">NotesContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">notes</span>, <span class="attr">createNote</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">NotesContext.Provider</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;notes, createNote&#125; = <span class="title function_">useContext</span>(<span class="title class_">NotesContext</span>);</span><br><span class="line">    <span class="keyword">const</span> [input, setInput] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onCreateNote</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">createNote</span>(input)</span><br><span class="line">        <span class="title function_">setInput</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My notes app<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onCreateNote&#125;</span>&gt;</span>Create Note<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;input&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span>=&gt;</span>setInput(e.target.value)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            &#123; notes.map(note =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;note&#125;</span>&gt;</span>Note: &#123;note&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>) &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-Query"><a href="#React-Query" class="headerlink" title="React-Query"></a>React-Query</h2><blockquote>
<p>React 获取、缓存和更新服务器数据的 hooks，为轻交互重数据的业务场景提供了极大便利。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数据请求</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 后端返回数据</span></span><br><span class="line">    <span class="keyword">const</span> [zen, setZen] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="comment">// 加载状态</span></span><br><span class="line">    <span class="keyword">const</span> [isLoading, setIsLoading] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 是否申请胜利</span></span><br><span class="line">    <span class="keyword">const</span> [isError, setIsError] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 后端返回的错误信息</span></span><br><span class="line">    <span class="keyword">const</span> [errorMessage, setErrorMessage] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fetchData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">setIsLoading</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.github.com/zen&#x27;</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="keyword">async</span> (res) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">status</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; message &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">text</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">text: string</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">setIsLoading</span>(<span class="literal">false</span>);</span><br><span class="line">            <span class="title function_">setIsError</span>(<span class="literal">false</span>);</span><br><span class="line">            <span class="title function_">setZen</span>(text);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">setIsLoading</span>(<span class="literal">false</span>);</span><br><span class="line">          <span class="title function_">setIsError</span>(<span class="literal">true</span>);</span><br><span class="line">          <span class="title function_">setErrorMessage</span>(error.<span class="property">message</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fetchData</span>();   <span class="comment">// 初始化申请数据</span></span><br><span class="line">    &#125;, []);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Zen from Github<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;isLoading ? &#x27;加载中&#x27; : isError ? errorMessage : zen&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;!isLoading &amp;&amp; (<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;fetchData&#125;</span>&gt;</span>&#123;isError ? &#x27;重试&#x27; </span></span><br><span class="line"><span class="language-xml">            : &#x27;刷新&#x27;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// react-query：简单接口</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&#x27;react-query&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.github.com/zen&#x27;</span>).<span class="title function_">then</span>(<span class="keyword">async</span> (res) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">status</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; message &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">text</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@method</span> <span class="variable">useQuery</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@prame</span>  queryKeys：查询的唯一标识，string/array/object (数组可加依赖项)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@prame</span>  queryFunc：异步查问函数，组件实例化第一次执行和依赖项更新时重新执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@prame</span>  options：内置功能的配置项，比如错误重试、缓存过期、网络恢复时查询等</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">const</span> zenQuery = <span class="title function_">useQuery</span>([<span class="string">&#x27;zen&#x27;</span>], fetchData);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Zen from Github<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;zenQuery.isLoading || zenQuery.isFetching</span></span><br><span class="line"><span class="language-xml">                  ? &#x27;加载中...&#x27;</span></span><br><span class="line"><span class="language-xml">                  : zenQuery.isError</span></span><br><span class="line"><span class="language-xml">                  ? zenQuery.error?.message</span></span><br><span class="line"><span class="language-xml">                  : data&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;!zenQuery.isLoading &amp;&amp; !zenQuery.isFetching &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; zenQuery.refetch() &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                  &#123;zenQuery.isError ? &#x27;重试&#x27; : &#x27;刷新&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            )&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// react-query：复杂接口</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&#x27;react-query&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchData</span> = (<span class="params">&#123; queryKey &#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> [, owner, repo] = queryKey;</span><br><span class="line">    <span class="comment">// queryKey 指查询依赖项，每次修改时就会触发接口重新请求</span></span><br><span class="line">    <span class="comment">// https://api.github.com/repos/facebook/react/issues</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/repos/<span class="subst">$&#123;owner&#125;</span>/<span class="subst">$&#123;repo&#125;</span>/issues`</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123; <span class="title class_">Authorization</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">async</span> (res) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">status</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; message &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [inputOwner, setInputOwner] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&#x27;facebook&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> [inputRepo, setInputRepo] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> [queryKey, setQueryKey]= <span class="title class_">React</span>.<span class="title function_">useState</span>([inputOwner, inputRepo])</span><br><span class="line">    <span class="keyword">const</span> issueQuery = <span class="title function_">useQuery</span>([<span class="string">&#x27;issues&#x27;</span>, ...queryKey], fetchData);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>仓库：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">name</span>=<span class="string">&#123;</span>&#x27;<span class="attr">owner</span>&#x27;&#125; </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">value</span>=<span class="string">&#123;inputOwner&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setInputOwner(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">name</span>=<span class="string">&#123;</span>&#x27;<span class="attr">repo</span>&#x27;&#125; </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">value</span>=<span class="string">&#123;inputRepo&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setInputRepo(e.target.value)&#125; </span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123; setQueryKey([inputOwner, inputRepo]) &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                查看最新issue信息</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>仓库&#123;queryKey[0]&#125;/&#123;queryKey[1]&#125;最新issue信息<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;issueQuery.isLoading</span></span><br><span class="line"><span class="language-xml">                      ? &#x27;加载中...&#x27;</span></span><br><span class="line"><span class="language-xml">                      : issueQuery.isError</span></span><br><span class="line"><span class="language-xml">                      ? issueQuery.message</span></span><br><span class="line"><span class="language-xml">                      : JSON.stringify(issueQuery.data[0])&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><blockquote>
<p>基于 Flux 架构单向数据流思想和函数式编程模式而构建状态容器，主要特点为：<code>store 单一数据源</code> (状态存储在唯一的树状对象)、<code>state 只读</code> (纯函数返回新值并不会改变旧值)、<code>reducer 纯函数同步更新</code> (纯函数：输入输出相同类型，不改参数，不依赖外部变量和方法)。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 核心概念</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> store：存储状态和更新规则的唯一树状结构对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> action：描述用户行为的对象，type 属性表示执行的操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> reducer：同步更新状态的纯函数</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, combineReducers, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> createSageMiddleware <span class="keyword">from</span> <span class="string">&#x27;redux-saga&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mySaga <span class="keyword">from</span> <span class="string">&quot;./views/sagas/sagas.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123; </span><br><span class="line">    <span class="attr">INCREASE</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;INCREASE&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">DECREASE</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;DECREASE&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">countReducer</span> = (<span class="params">state=&#123; count: <span class="number">0</span> &#125;, action</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> actions.<span class="property">INCREASE</span>.<span class="property">type</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">        <span class="keyword">case</span> actions.<span class="property">DECREASE</span>.<span class="property">type</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">tabReducer</span> = (<span class="params">state=&#123; show: <span class="literal">false</span> &#125;, action</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> newState = &#123;...pre&#125;   </span><br><span class="line">    <span class="keyword">switch</span>(action.<span class="property">type</span>)&#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;yes&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;yes&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">show</span>: <span class="literal">false</span> &#125;  </span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">return</span> state      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> reducer = <span class="title function_">combineReducers</span>(&#123; countReducer, tabReducer &#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">logger</span> = store =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123; <span class="comment">// 函数柯里化</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(action.<span class="property">type</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(action));</span><br><span class="line">    <span class="title function_">next</span>(action);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> saga = <span class="title function_">createSageMiddleware</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> <span class="variable">API</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> createStore：创建容器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> getState：获取最新状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> dispatch：触发同步更新</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> subscribe：监听更新</span></span><br><span class="line"><span class="comment">**/</span> </span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer, applyMiddleware[logger, thunk, saga]);</span><br><span class="line"><span class="keyword">const</span> unsubscribe = store.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(store.<span class="title function_">getState</span>());</span><br><span class="line">&#125;);</span><br><span class="line">store.<span class="title function_">dispatch</span>(actions.<span class="property">INCREASE</span>);</span><br><span class="line"><span class="title function_">unsubscribe</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 中间件：dispatch 方法的封装和升级</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> <span class="variable">redux</span>-thunk：返回函数时会替代 dispatch 实现异步</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> <span class="variable">redux</span>-saga：统一管理所有异步操作，可代替 redux-thunk</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">increaseAsync</span> = (<span class="params"></span>) =&gt; <span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">dispatch</span>(actions.<span class="property">INCREASE</span>), <span class="number">2000</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getHttpAction</span> = (<span class="params">url, func</span>) =&gt; <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.<span class="title function_">get</span>(url).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> action = <span class="title function_">func</span>(res.<span class="property">data</span>)</span><br><span class="line">        <span class="title function_">dispatch</span>(action)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">saga.<span class="title function_">run</span>(mySaga);</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">// sagas.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeEvery &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>*()&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(<span class="string">&quot;increaseAsync&quot;</span>, <span class="keyword">function</span>*() &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;redux-saga&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// react-redux：针对 react 组件语法开发的 redux 简化版本</span></span><br><span class="line"><span class="comment">// index.js：通过 provider 为后代组件 store (此处为全局)</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span>, useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore, createReducer, combineReducers&#125; </span><br><span class="line"><span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;  </span><br><span class="line">    <span class="keyword">const</span> [input, setInput] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> notes = <span class="title function_">useSelector</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">notes</span>)</span><br><span class="line">    <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>()</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onCreateNote</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;CREATE_NOTE&#x27;</span>, <span class="attr">note</span>: input &#125;)</span><br><span class="line">        <span class="title function_">setInput</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My notes app<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onCreateNote&#125;</span>&gt;</span>Create Note<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;input&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span>=&gt;</span>setInput(e.target.value)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            &#123; notes.map(note =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;note&#125;</span>&gt;</span>Note: &#123;note&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>) &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> notesReducer = <span class="title function_">createReducer</span>([], &#123;</span><br><span class="line">    <span class="string">&#x27;CREATE_NOTE&#x27;</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> [...state, action.<span class="property">note</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> reducers = <span class="title function_">combineReducers</span>(&#123; <span class="attr">notes</span>: notesReducer &#125;)</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123; <span class="attr">reducer</span>: reducers &#125;)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Main</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ReduxPage.js：通过 connect 对象为组件提供状态和更新方法</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReduxPage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; num, add, minus &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ReduxPage<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;num&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;add&#125;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;minus&#125;</span>&gt;</span>minus<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        ); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapStateToProps</span> = state =&gt; &#123;  <span class="comment">// 状态映射</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">num</span>: state &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = &#123;     <span class="comment">// 派发事件映射</span></span><br><span class="line">    <span class="attr">add</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">&quot;add&quot;</span> &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">minus</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">&quot;minus&quot;</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="title class_">ReduxPage</span>);</span><br></pre></td></tr></table></figure>


<h2 id="MobX"><a href="#MobX" class="headerlink" title="MobX"></a>MobX</h2><blockquote>
<p>基于 Flux 单向数据流思想填补了 Redux 对概念约束太强而失去灵活性的空缺，适合中小型项目。主要特点有 <code>state 可变</code>(直接操作而没有回退能力)、<code>多个数据源</code>(划分多个模块而不利于维护)、<code>面向对象编程</code>(将状态包装成可观察对象)、<code>响应式编程</code>(声明变化的联动关系)。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// npm install mobx mobx-react-lite</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; observer &#125; <span class="keyword">from</span> <span class="string">&quot;mobx-react-lite&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; makeAutoObservable &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoteStore</span> &#123;</span><br><span class="line">    notes = []</span><br><span class="line">    <span class="title function_">createNote</span>(<span class="params">note</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">notes</span> = [...<span class="variable language_">this</span>.<span class="property">notes</span>, note]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">makeAutoObservable</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Notes</span> = <span class="keyword">new</span> <span class="title class_">NoteStore</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span> = <span class="title function_">observer</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [input, setInput] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; notes &#125; = <span class="title class_">Notes</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onCreateNote</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Notes</span>.<span class="title function_">createNote</span>(input)</span><br><span class="line">        <span class="title function_">setInput</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onCreateNote&#125;</span>&gt;</span>Create Note<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;input&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span>=&gt;</span>setInput(e.target.value)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            &#123; notes.map(note =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;note&#125;</span>&gt;</span>Note: &#123;note&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>) &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<h2 id="XState"><a href="#XState" class="headerlink" title="XState"></a>XState</h2><blockquote>
<p>试图解决现代页面复杂性的问题，并且依赖于有限状态机的思想和实现。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// npm install xstate @xstate/react</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useService &#125; <span class="keyword">from</span> <span class="string">&#x27;@xstate/react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Machine</span>, assign, interpret &#125; <span class="keyword">from</span> <span class="string">&#x27;xstate&#x27;</span></span><br><span class="line"><span class="keyword">const</span> notesMachine = <span class="title class_">Machine</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;notes&#x27;</span>,</span><br><span class="line">    <span class="attr">initial</span>: <span class="string">&#x27;ready&#x27;</span>,</span><br><span class="line">    <span class="attr">context</span>: &#123; <span class="attr">notes</span>: [], <span class="attr">note</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">states</span>: &#123; <span class="attr">ready</span>: &#123;&#125; &#125;,</span><br><span class="line">    <span class="attr">on</span>: &#123;</span><br><span class="line">        <span class="string">&quot;CHANGE&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">actions</span>: [</span><br><span class="line">                <span class="title function_">assign</span>(&#123; <span class="attr">note</span>: <span class="function">(<span class="params">_, event</span>) =&gt;</span> event.<span class="property">value</span> &#125;)</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;CREATE&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">actions</span>: [</span><br><span class="line">                <span class="title function_">assign</span>(&#123;</span><br><span class="line">                    <span class="attr">note</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="attr">notes</span>: <span class="function"><span class="params">context</span> =&gt;</span> [...context.<span class="property">notes</span>, context.<span class="property">note</span>]</span><br><span class="line">                &#125;)</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> service = <span class="title function_">interpret</span>(notesMachine).<span class="title function_">start</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [state, send] = <span class="title function_">useService</span>(service)</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">context</span>: &#123; note, notes&#125; &#125; = state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>send(&#123;type: &#x27;CREATE&#x27;&#125;)&#125;&gt;Create<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;note&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> send(&#123; type: &#x27;CHANGE&#x27;, </span></span><br><span class="line"><span class="language-xml">            value: e.target.value&#125;)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            &#123; notes.map(note =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;note&#125;</span>&gt;</span>Note: &#123;note&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>) &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Recoil"><a href="#Recoil" class="headerlink" title="Recoil"></a>Recoil</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// npm install recoil</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span>, atom, useRecoilState &#125; <span class="keyword">from</span> <span class="string">&#x27;recoil&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> notesState = <span class="title function_">atom</span>(&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;notesState&#x27;</span>,</span><br><span class="line">    <span class="attr">default</span>: []</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">RecoilRoot</span>&gt;</span> <span class="tag">&lt;<span class="name">App</span> /&gt;</span> <span class="tag">&lt;/<span class="name">RecoilRoot</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [notes, setNotes] = <span class="title function_">useRecoilState</span>(notesState);</span><br><span class="line">    <span class="keyword">const</span> [input, setInput] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createNote</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> notesArray = [...notes, input]</span><br><span class="line">        <span class="title function_">setNotes</span>(notesArray)</span><br><span class="line">        <span class="title function_">setInput</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;createNote&#125;</span>&gt;</span>Create Note<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;input&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span>=&gt;</span>setInput(e.target.value)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            &#123; notes.map(note =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;note&#125;</span>&gt;</span>Note: &#123;note&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>) &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Dva"><a href="#Dva" class="headerlink" title="Dva"></a>Dva</h2><blockquote>
<p>一个为了简化开发基于 redux、redux-saga 实现的数据流方案，可以看作是一个轻量级的应用框架：<code>dva = react-router + redux + redux-saga</code>。model 对象上定义了所有的应用逻辑并通过 namespace 区分，通过 state 存储数据，通过 subsciprtions 实现监听，通过 effect 发起异步操作，通过 reducer 执行同步操作，</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install dva-cli -g</span><br><span class="line">dva <span class="keyword">new</span> dva-quickstart</span><br><span class="line">cd dva-quickstart</span><br><span class="line">npm start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> dva <span class="keyword">from</span> <span class="string">&#x27;dva&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">dva</span>();    <span class="comment">// Initialize</span></span><br><span class="line"><span class="comment">// app.use(&#123;&#125;);       // Plugins</span></span><br><span class="line"><span class="comment">// app.model(require(&#x27;./models/example&#x27;).default);  // Model</span></span><br><span class="line">app.<span class="title function_">router</span>(<span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>).<span class="property">default</span>);   <span class="comment">// Router</span></span><br><span class="line">app.<span class="title function_">start</span>(<span class="string">&#x27;#root&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面连接 redux</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;dva&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./IndexPage.css&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">IndexPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.normal&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">IndexPage</span>.<span class="property">propTypes</span> = &#123; &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>()(<span class="title class_">IndexPage</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// app.model 对象定义了所有的应用逻辑</span></span><br><span class="line"><span class="keyword">import</span> &#123;routerRedux&#125; <span class="keyword">from</span> <span class="string">&#x27;dva/router&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespace</span>: <span class="string">&#x27;example&#x27;</span>,</span><br><span class="line">    <span class="attr">state</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">subscriptions</span>: &#123;</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params">&#123; dispatch, history &#125;</span>) &#123; &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">effects</span>: &#123;</span><br><span class="line">        *<span class="title function_">fetch</span>(<span class="params">&#123; payload &#125;, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="title function_">put</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;save&#x27;</span> &#125;);</span><br><span class="line">            <span class="keyword">yield</span>.<span class="title function_">put</span>(routerRedux.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;</span><br><span class="line">        <span class="title function_">save</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, ...action.<span class="property">payload</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>JS 框架</category>
      </categories>
      <tags>
        <tag>JS 框架</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序项目开发</title>
    <url>/2019/08/03/9-2-%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="一、项目初始化"><a href="#一、项目初始化" class="headerlink" title="一、项目初始化"></a>一、项目初始化</h1><h2 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h2><ol>
<li>注册账号：<a href="https://mp.weixin.qq.com/">微信公众平台</a></li>
<li>调试工具：<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1455784140">微信 web 开发者工具</a></li>
<li>创建项目<br>* 登录开发工具：选择小程序项目、选择路径、填入注册的小程序 AppID、点击创建。<br>* 编译预览：可以点击编译按钮在工具的左侧模拟器界面查看效果，也可以点击预览按钮在手机查看。</li>
<li>学习资料<br>* <a href="https://developers.weixin.qq.com/miniprogram/dev/">微信小程序官方文档</a><br>* <a href="https://www.w3cschool.cn/weixinapp/">W3CSchool 小程序</a><br>* <a href="https://www.cnblogs.com/softwyy/p/8948416.html">特殊效果合集</a></li>
</ol>
<h2 id="项目目录"><a href="#项目目录" class="headerlink" title="项目目录"></a>项目目录</h2><blockquote>
<p>以下为完善后的目录，注意 json 文件不能添加任何注释</p>
</blockquote>
<ul>
<li>通过 <code>JSON</code> 表现应用的配置信息<ul>
<li><code>app.json</code>：全局配置</li>
<li><code>page.json</code>：页面配置</li>
<li><code>project.config.json</code>：开发工具读取</li>
</ul>
</li>
<li>通过 <code>CSS、XML</code> 实现视图层的描述</li>
<li>通过 <code>JavaScript</code> 语言实现逻辑层结构</li>
<li>架构在视图层和逻辑层之间提供 <code>数据和事件传输功能</code></li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">testapp</span><br><span class="line">  ├─ constants    <span class="comment">// 项目中的常亮</span></span><br><span class="line">  ├─ services     <span class="comment">// 接口目录</span></span><br><span class="line">  ├─ image        <span class="comment">// 图片资源</span></span><br><span class="line">  ├─ utils        <span class="comment">// 工具函数目录：公共的 js 方法和库文件</span></span><br><span class="line">      └─ util.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">  ├─ components   <span class="comment">// 组件目录：自定义封装的可复用组件</span></span><br><span class="line">    ├─ menu          </span><br><span class="line">    └─ collapse</span><br><span class="line"></span><br><span class="line">  ├─ pages        <span class="comment">// 页面目录：可以删除或自定义配置，新建文件需要在 app.json 声明</span></span><br><span class="line">      ├─ index            <span class="comment">// 首页</span></span><br><span class="line">          ├─ index.<span class="property">js</span>            <span class="comment">// 页面交互、跳转、数据渲染逻辑</span></span><br><span class="line">          ├─ index.<span class="property">json</span>          <span class="comment">// 首页自定义配置信息 (可选)</span></span><br><span class="line">          ├─ index.<span class="property">wxml</span>          <span class="comment">// 首页视图文件 </span></span><br><span class="line">          └─ index.<span class="property">wxss</span>          <span class="comment">// 首页样式文件</span></span><br><span class="line">      └─ logs            <span class="comment">// 日志页面</span></span><br><span class="line"></span><br><span class="line">  ├─ app.<span class="property">js</span>    <span class="comment">// 入口文件，生成小程序实例，通过 App() 定义全局变量、监听生命周期函数等 </span></span><br><span class="line">  ├─ app.<span class="property">wxss</span>  <span class="comment">// 公共样式代码，用于项目的字体、颜色等页面和标签的基础样式，类似 CSS </span></span><br><span class="line">  ├─ app.<span class="property">json</span>  <span class="comment">// 全局配置文件，包括项目的页面引入、导航条颜色和标题等具体的代码开发配置</span></span><br><span class="line">  └─ project.<span class="property">config</span>.<span class="property">json</span>  <span class="comment">// 项目配置文件，包括代码的打包、压缩等，类似 package.json</span></span><br></pre></td></tr></table></figure>


<h1 id="二、插件功能"><a href="#二、插件功能" class="headerlink" title="二、插件功能"></a>二、插件功能</h1><blockquote>
<p>插件是可以被添加到小程序内直接使用的功能组件，它不能独立运行和预览，只能嵌入到其他小程序中使用。开发者可以直接在小程序内使用插件，无需重复开发，为用户提供更丰富的服务。</p>
</blockquote>
<ul>
<li>目前插件开发的开放范围还是企业、媒体或其他组织，暂时不支持个人。</li>
<li>插件对标一个微服务，开发插件必须有 appid，所以一个小程序只能开发一个插件。</li>
<li>开通插件时的插件名称和图片确定后是不允许修改的。</li>
<li>目前没有插件可供搜索的地方，期待微信的插件商城的出现。</li>
<li>插件发布需要通过微信审核(较严格)，插件支持多个线上版本的同时存在。</li>
<li>插件的使用需要申请，插件开发者同意后，使用方可以接入使用插件。</li>
</ul>
<h2 id="区别-NPM-依赖"><a href="#区别-NPM-依赖" class="headerlink" title="区别 NPM 依赖"></a>区别 NPM 依赖</h2><blockquote>
<p>相同点是都不能独立运行</p>
</blockquote>
<ul>
<li>插件必须由腾讯审核通过才能使用（NPM 无需腾讯审核）。</li>
<li>使用第三方插件必须向第三方申请 （通过 NPM 使用第三方库无需向第三方申请）。</li>
<li>插件拥有独立的 API 接口和域名列表，不被小程序本身的域名列表限制。（NPM 依赖库不能进行第三方数据请求）。</li>
</ul>
<h2 id="插件开发"><a href="#插件开发" class="headerlink" title="插件开发"></a>插件开发</h2><blockquote>
<p>官网开通插件功能、开发者工具、新建项目、开发模式为插件</p>
</blockquote>
<ul>
<li>项目目录<ul>
<li>plugin：插件代码目录</li>
<li>miniprogram ：调试插件的小程序</li>
</ul>
</li>
</ul>
<h1 id="三、常用功能"><a href="#三、常用功能" class="headerlink" title="三、常用功能"></a>三、常用功能</h1><h2 id="登录授权"><a href="#登录授权" class="headerlink" title="登录授权"></a>登录授权</h2><h3 id="登录方式"><a href="#登录方式" class="headerlink" title="登录方式"></a>登录方式</h3><blockquote>
<p>目前前两种方式在 Web 应用中比较常见，在微信小程序中同样可以使用，但是需要注意的是：小程序中没有 Cookie 的机制，所以在使用这 2 种方式前，请确认你们或第三方的 API 是否需要依赖 Cookie。还有小程序中也不支持 HTML 页面，那些需要使用页面重定向来进行登录的第三方 API 就需要改造或不能用了。下面主要来讨论一下第三种方式，因为这种方式和微信平台结合最紧密，用户体验比较好。</p>
</blockquote>
<ul>
<li>自有的账号注册和登录</li>
<li>使用其他第三方平台账号登录</li>
<li>使用微信账号登录：即直接使用当前已登录的微信账号来作为小程序的用户进行登录</li>
</ul>
<h3 id="登录流程"><a href="#登录流程" class="headerlink" title="登录流程"></a>登录流程</h3><blockquote>
<p>只有首次登录时才会执行完整流程，小程序客户端并不需要知道 <code>session_key、openid</code>，它只需要保存 <code>3rd_session</code> 并在每次请求时在请求头携带即可。注意同一个用户在同一个微信开放平台下的相同主体的应用对应着 <code>相同的 userid、unionid 和不同的 openid</code>。</p>
</blockquote>
<ul>
<li>实现流程<ul>
<li>小程序客户端调用 wx.login() 获取当前登录微信用户的临时登录凭证 code </li>
<li>开发者服务器接收客户端发送的 code 并向微信服务器换取该微信用户的唯一标识 (openid) 和会话密钥 (session_key)</li>
<li>小程序客户端保存开发者服务器通过算法生成的 3rd_session (有超时时间)，并把它放到每次请求的请求头进行权限验证</li>
</ul>
</li>
<li>参数说明<ul>
<li><strong>code</strong>：只能使用一次的临时登录凭证，有过期时间</li>
<li><strong>3rd_session</strong>：通过操作系统的随机数算法生成的新 session</li>
<li><strong>openid</strong>：普通用户的标识。对于每个公众号，每个用户的 openid 都是唯一的</li>
<li><strong>unionid</strong>：用户在开放平台的唯一标识符。对于同一个微信开放平台帐号下的移动应用、网站应用和公众帐号（包括小程序），用户的 unionid 是唯一的。</li>
<li><strong>userid</strong>：应用后台都有一个用户表，每个用户对应不同的 userid。用户登录时通过 unionid 去判断是不是同一个用户并去关联用户表，然后获取对应的 userid。</li>
</ul>
</li>
</ul>
  <div align="center">
      <img src="/images/webchat/applet_login.png" alt="小程序登录流程" width="100%">
  </div>


<h3 id="获取用户信息"><a href="#获取用户信息" class="headerlink" title="获取用户信息"></a>获取用户信息</h3><blockquote>
<p>执行顺序：<code>app.onLaunch、page.onLoad</code></p>
</blockquote>
<ul>
<li><code>wx.getUserInfo</code>：首次登录时调用，该接口需要用户授权</li>
<li><code>wx.login</code>：已关注过公众号或已经授权登录过小程序时调用</li>
</ul>
<h3 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">App</span>(&#123;</span><br><span class="line">  <span class="attr">onLaunch</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> code = res.<span class="property">code</span>;</span><br><span class="line">        <span class="comment">// 发送 res.code 到后台换取 openId、sessionKey、unionId</span></span><br><span class="line">        wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">          <span class="comment">// url: API_URL,</span></span><br><span class="line">          <span class="attr">data</span>: &#123; <span class="attr">code</span>: code &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取用户信息</span></span><br><span class="line">    wx.<span class="title function_">getSetting</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">authSetting</span>[<span class="string">&#x27;scope.userInfo&#x27;</span>]) &#123;</span><br><span class="line">          <span class="comment">// 已经授权，则可以直接调用 getUserInfo 获取头像昵称，不会弹框</span></span><br><span class="line">          wx.<span class="title function_">getUserInfo</span>(&#123;</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">// 可以将 res 发送给后台解码出 unionId</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">userInfo</span> = res.<span class="property">userInfo</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">/**</span></span><br><span class="line"><span class="comment">               * userInfoReadyCallback</span></span><br><span class="line"><span class="comment">               *     index.js onload 中定义</span></span><br><span class="line"><span class="comment">               *     因为 getUserInfo 是网络请求，可能会在 Page.onLoad 之后才返回</span></span><br><span class="line"><span class="comment">               *     作用是保证页面的 userInfo 被正确赋值，无论用户信息在页面加载完成之前还是之后返回</span></span><br><span class="line"><span class="comment">              **/</span></span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">userInfoReadyCallback</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">userInfoReadyCallback</span>(res)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">globalData</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h3>  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;!hasUserInfo &amp;&amp; canIUse&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">open-type</span>=<span class="string">&quot;getUserInfo&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">bindgetuserinfo</span>=<span class="string">&quot;getUserInfo&quot;</span>&gt;</span> </span><br><span class="line">    获取头像昵称 </span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">hasUserInfo</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 判断小程序的 API、回调、参数、组件等是否在当前版本可用</span></span><br><span class="line">    <span class="attr">canIUse</span>: wx.<span class="title function_">canIUse</span>(<span class="string">&#x27;button.open-type.getUserInfo&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (app.<span class="property">globalData</span>.<span class="property">userInfo</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">userInfo</span>: app.<span class="property">globalData</span>.<span class="property">userInfo</span>,</span><br><span class="line">        <span class="attr">hasUserInfo</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">canIUse</span>)&#123;</span><br><span class="line">      <span class="comment">// 由于 getUserInfo 是网络请求，可能会在 Page.onLoad 之后才返回</span></span><br><span class="line">      app.<span class="property">userInfoReadyCallback</span> = <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">userInfo</span>: res.<span class="property">userInfo</span>,</span><br><span class="line">          <span class="attr">hasUserInfo</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 在没有 open-type=getUserInfo 版本的兼容处理</span></span><br><span class="line">      wx.<span class="title function_">getUserInfo</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          app.<span class="property">globalData</span>.<span class="property">userInfo</span> = res.<span class="property">userInfo</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">userInfo</span>: res.<span class="property">userInfo</span>,</span><br><span class="line">            <span class="attr">hasUserInfo</span>: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getUserInfo</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    app.<span class="property">globalData</span>.<span class="property">userInfo</span> = e.<span class="property">detail</span>.<span class="property">userInfo</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">userInfo</span>: e.<span class="property">detail</span>.<span class="property">userInfo</span>,</span><br><span class="line">      <span class="attr">hasUserInfo</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="改变首页"><a href="#改变首页" class="headerlink" title="改变首页"></a>改变首页</h2><ol>
<li>app.json：pages 数组的第一个页面就是默认启动页面，改变页面顺序即可</li>
<li>配置编译参数：微信开发者工具、普通编译、添加编译模式、启动页面</li>
<li>提交正式版本时设置首页：配置功能页面</li>
</ol>
]]></content>
      <categories>
        <category>移动端开发</category>
      </categories>
      <tags>
        <tag>移动端开发</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序入门</title>
    <url>/2019/07/07/9-1-%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="一、简单入门"><a href="#一、简单入门" class="headerlink" title="一、简单入门"></a>一、简单入门</h1><blockquote>
<p>微信朋友圈提供了好友之间沟通信息的手段，订阅号提供了面向粉丝推送信息的手段，而小程序则是提供了用户通过自己的操作而与服务实现互动的手段。小程序融合了原生 App 和 web 端，通过微信 APP 实现了多线程而且可以调用丰富的功能接口，同时又跨平台。需要注意的是，小程序基于浏览器内核重构的内置解析器，所以不能使用 DOM、BOM 的相关 API。</p>
</blockquote>
<h2 id="存在问题"><a href="#存在问题" class="headerlink" title="存在问题"></a>存在问题</h2><ul>
<li>开发者不可以扩展新组件。</li>
<li>暂时不支持 ipad 打开小程序</li>
<li>小程序无法打开页面，无法拉起 APP。</li>
<li>需要独立开发，不能在非微信环境运行。</li>
<li>小程序使用 WebView 渲染，并非原生渲染。</li>
<li>WXSS 不支持级联选择器、less 等。</li>
<li>WXSS 中无法使用本地资源（图片、字体等）。</li>
<li>WXSS 转化成 js 而不是 css，是为了兼容 rpx。</li>
<li>微信小程序不支持 cookie<ul>
<li>可使用 Reids 存储 session</li>
<li>有些手机不支持 Object.assign 方法，使用报错时可以直接写一个合并对象的方法。</li>
</ul>
</li>
<li>小程序不能和公众号重名，于是小程序的名字就成了：自选股+、滴滴出行DiDi。</li>
<li>依赖浏览器环境的 js 库不能使用，因为是在 JSCore 运行的，没有 window、document 对象。</li>
</ul>
<h2 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h2><ul>
<li>前端组件化开发。</li>
<li>基于微信跨平台，即用即走。</li>
<li>全部使用 https，确保传输中安全。</li>
<li>使用 Virtual DOM，进行局部更新。</li>
<li>使用 rpx 单位，隔离设备尺寸，方便开发。</li>
<li>视图层和逻辑层分离，通过数据驱动，不直接操作 DOM。</li>
<li>拥有离线能力：页面返回时显示历史 View，退出小程序时不销毁 View 状态。</li>
<li>Native 预先新建 WebView，打开新页面时直接渲染默认数据然后进行局部更新。</li>
<li>去中心化：微信不会提供类似小程序商店的地方，需要小程序提供者自己通过二维码、群分享的手段来传播。</li>
</ul>
<h2 id="PWA-渐进式应用"><a href="#PWA-渐进式应用" class="headerlink" title="PWA 渐进式应用"></a>PWA 渐进式应用</h2><blockquote>
<p>全称是 Progressive Web Apps，它是结合了 web 和 原生应用中最好功能的一种体验。首次访问时，用户可以直接在浏览器中进行访问而不需要安装应用。随着时间的推移，当用户和应用逐渐建立了联系，它会变得越来越强大。它能够快速地加载，即使在弱网络环境下也能够推送相关消息，也可以像原生应用那样添加至主屏，能够有全屏浏览的体验。</p>
</blockquote>
<ul>
<li>主要特点<ul>
<li><strong>渐进增强</strong>：支持的新特性的浏览器获得更好的体验，不支持的保持原来的体验。</li>
<li><strong>离线访问</strong>：通过 service workers 可以在离线或者网速差的环境下工作。</li>
<li><strong>类原生应用</strong>：使用 app shell model 做到原生应用般的体验。</li>
<li><strong>可安装</strong>：允许用户保留对他们有用的应用在主屏幕上，不需要通过应用商店。</li>
<li><strong>容易分享</strong>：通过 URL 可以轻松分享应用。</li>
<li><strong>持续更新</strong>：受益于 service worker 的更新进程，应用能够始终保持更新。</li>
<li><strong>安全</strong>：通过 HTTPS 来提供服务来防止网络窥探，保证内容不被篡改。</li>
<li><strong>可搜索</strong>：得益于 W3C manifests 元数据和 service worker 的登记，让搜索引擎能够找到 web 应用。</li>
<li><strong>再次访问</strong>：通过消息推送等特性让用户再次访问变得容易。</li>
</ul>
</li>
<li>功能模块<ul>
<li><strong>Service Workers</strong>：增强 Web 能力，主要用于实现资源离线缓存和更新。</li>
<li><strong>Web App Manifest</strong>：使 Web 更像 Native，它以 JSON 的格式定义 Web 应用的相关配置（应用名称、图像链接、自定义特性、启动默认配置、全屏设置等）。</li>
<li><strong>App Shell</strong>：提升显示效率的应用外壳，它是应用的用户界面所需的最基本的 HTML、CSS、JS，首次加载后立刻被缓存下来，不需要每次使用时都被下载，而是只异步加载需要的数据，以实现 UI 保持本地化。</li>
</ul>
</li>
</ul>
<h2 id="区别-H5"><a href="#区别-H5" class="headerlink" title="区别 H5"></a>区别 H5</h2><ul>
<li><strong>系统权限</strong>：小程序可以获得更多的系统权限，如网络通信状态、数据缓存能力等。</li>
<li><strong>运行环境</strong>：小程序基于浏览器内核重构的内置解析器，而 H5 的宿主环境是浏览器。所以小程序中没有 DOM、BOM 的相关 API。</li>
<li><strong>渲染机制</strong>：小程序的逻辑层和渲染层分别在不同的线程中运行 (相互独立)，而 H5 页面的 UI 渲染、Js 脚本执行都在一个单线程 (互斥)。所以 H5 页面中长时间的脚本运行可能会导致页面失去响应。</li>
</ul>
<h2 id="程序限制"><a href="#程序限制" class="headerlink" title="程序限制"></a>程序限制</h2><h3 id="程序限制-1"><a href="#程序限制-1" class="headerlink" title="程序限制"></a>程序限制</h3><ul>
<li>样式表不支持级联选择器。</li>
<li>不支持 A 标签，无法打开普通网页。</li>
<li>脚本内不能使用 window、document 等对象。</li>
<li>background-image 不能加载本地资源，可以是 网络图片、base64、标签。</li>
</ul>
<h3 id="数量限制"><a href="#数量限制" class="headerlink" title="数量限制"></a>数量限制</h3><ul>
<li>一个应用同时只能打开 5 个页面。</li>
<li>wx.request 请求最开始最大并发数是 10 个。</li>
<li>底部或顶部可以添加的 tab 按钮区域 tabBar 是一个数组，只能配置 2 ～ 5 个 tab。</li>
</ul>
<h3 id="大小限制"><a href="#大小限制" class="headerlink" title="大小限制"></a>大小限制</h3><ul>
<li>setStorage 本地缓存最大为 10MB。</li>
<li>setData 页面传递数据单次设置的数据不能超过 1024kB。</li>
<li>tabBar 的按钮路径为 iconPath，icon 大小限制为 40kb。</li>
<li>为了提升体验流畅度，小程序源码编译后的代码包大小限制为 1MB。</li>
</ul>
<h2 id="使用-npm"><a href="#使用-npm" class="headerlink" title="使用 npm"></a>使用 npm</h2><blockquote>
<p>因为小程序使用的是不完整的浏览器对象，所以很多 js 包无法使用。npm 可用来引入 moment 等插件，但是要注意不能通过 npm 引入没有 js 文件的 UI 库 weui，它可以通过直接下载文件并放到根目录，然后在 app.wxss 文件的开头引入。 </p>
</blockquote>
<ol>
<li>微信开发者工具、详情、使用 npm 模块。</li>
<li>项目的根目录打开命令行：npm init、npm i。</li>
<li>微信开发者工具、工具、构建 npm。此时小程序会将 node_modules 文件编译打包并生成新目录 miniprogram_npm。</li>
<li>对应页面的 js 文件引入后直接使用即可：const moment&#x3D; require(‘moment’)。</li>
<li>新建忽略文件 .gitignore，添加不需要上传的文件如 node_modules 、 package_lock.json。</li>
</ol>
<h1 id="二、底层原理"><a href="#二、底层原理" class="headerlink" title="二、底层原理"></a>二、底层原理</h1><h2 id="双线程模型"><a href="#双线程模型" class="headerlink" title="双线程模型"></a>双线程模型</h2><blockquote>
<p>小程序框架由视图层和逻辑层两部分组成。两者分别在两个相互独立的线程中运行而实现了视图和逻辑的分离，它们通过 Native（系统层，即微信客户端）做中转实现通信，逻辑层发送网络请求也会经由 Native 转发，这种双线程通信方式是为了管控安全并避免操作 DOM，缺点是带来了无处不在的异步问题 (任何数据传递都是线程间的通信，数据需要转换为字符串并将数据内容拼接为 JS 脚本的形式，然后传递给两边的 evaluateJavascript 异步执行)。由于一个小程序存在多个界面，视图层存在多个 webview 线程。</p>
</blockquote>
<ul>
<li><strong>视图层</strong>：渲染页面，运行的线程为 WKWebView (IOS) &#x2F; XWeb (Android) &#x2F; Chromium 60 Webview (开发者工具)。</li>
<li><strong>逻辑层</strong>：运行 js 脚本，主要处理业务逻辑和数据，运行的线程为 JSCore (IOS) &#x2F; V8 (Android) &#x2F; NWJS (开发者工具)。</li>
<li><strong>系统层</strong>：通过 JSBridge 向上提供微信的原生功能，向下实现视图层和逻辑层的双向交互 (视图层触发事件、逻辑层通知页面更新数据)。</li>
</ul>
  <div align="center">
      <img src="/images/webchat/framework.png" alt="架构模型" width="100%">
  </div>


<h2 id="渲染机制"><a href="#渲染机制" class="headerlink" title="渲染机制"></a>渲染机制</h2><ol>
<li><strong>渲染方式</strong>：小程序使用第三种方式<br>* web 渲染<br>* Native 原生渲染<br>* Hybrid 渲染：混合 web、Native</li>
<li><strong>具体流程</strong>：模版数据更新时容易影响性能，小程序使用 React 提出的虚拟 DOM 机制。<br>1. 在视图层把 WXML 转化成对应的 JS 对象 (虚拟 DOM 树)。<br>2. 在逻辑层发生数据变更时，通过宿主环境提供的 setData 方法把数据从逻辑层传递到 Native，再转发到视图层。<br>3. 在视图层渲染出最新的虚拟 DOM，经过对比新旧两个 DOM 树获取差异，然后将差异应用在真实的 DOM 树从而更新界面。</li>
<li><strong>页面渲染</strong><br>* wxml 编译器：wcc，它将 wxml 文件转为 js 执行 wcc index.wxml。<br>* wxss 编译器：wcsc，它将 wxss 文件转为 js 执行 wcsc index.wxss。</li>
</ol>
  <div align="center">
      <img src="/images/webchat/wxml_render.png" alt="渲染机制" width="100%">
  </div>


<h2 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h2><ul>
<li><strong>热启动</strong>：假如用户已经打开过某小程序，然后在一定时间内再次打开，此时无需重新启动，只需将后台态的小程序切换到前台，这个过程就是热启动。</li>
<li><strong>冷启动</strong>：用户首次打开或小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启动，即冷启动。</li>
<li><strong>销毁</strong>：只有当小程序进入后台一定时间，或者系统资源占用过高，才会被真正的销毁。</li>
</ul>
  <div align="center">
      <img src="/images/webchat/runing.png" alt="运行机制" width="100%">
  </div>


<h2 id="更新机制"><a href="#更新机制" class="headerlink" title="更新机制"></a>更新机制</h2><ul>
<li>开发者在后台发布新版本之后，无法立刻影响到所有现网用户，但最差情况下，也会在发布之后 24 小时之内下发新版本信息到用户。</li>
<li>小程序每次冷启动时都会检查是否有更新版本，如果发现有新版本，将会异步下载新版本的代码包，并同时使用客户端本地的包进行启动，即新版本的小程序需要等下一次冷启动才会应用上。</li>
<li>如果想让用户使用最新版本的小程序，可以利用 wx.getUpdateManager 做个检查更新的功能：</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">checkNewVersion</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> updateManager = wx.<span class="title function_">getUpdateManager</span>();</span><br><span class="line">  updateManager.<span class="title function_">onCheckForUpdate</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hasUpdate&#x27;</span>, res.<span class="property">hasUpdate</span>);</span><br><span class="line">    <span class="comment">// 请求完新版本信息的回调</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">hasUpdate</span>) &#123;</span><br><span class="line">      updateManager.<span class="title function_">onUpdateReady</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">hasNewVersion</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="组件系统"><a href="#组件系统" class="headerlink" title="组件系统"></a>组件系统</h2><ul>
<li>基础组件<ul>
<li>基于 Exparser 框架实现组织管理的内置组件和自定义组件，包括视图容器、表单组件、导航组件等。</li>
<li>Exparser 内置在小程序基础库，为各种组件提供基础支持 (节点操作、自定义组件特性等)。</li>
<li>Exparser 基于 WebComponents 的 ShadowDOM 模型，但是不依赖其它库和浏览器的原生支持，而且可在纯 JS 环境中运行。</li>
</ul>
</li>
<li>原生组件<ul>
<li>由客户端原生实现的内置组件，包括 <code>camera、canvas、input(仅在focus时)、live-player\live-pusher、map、textarea、video</code>。</li>
<li>它们脱离于 WebView 渲染流程之外，使用时有如下限制：<ul>
<li>层级最高，总是覆盖普通组件，后插入的原生组件覆盖之前插入的。</li>
<li>不支持部分 CSS 样式：CSS 动画、position: fixed、overflow: hidden。</li>
<li>不支持 bind:eventname 的事件监听、catch 和 capture 的事件绑定。</li>
<li>遮挡 vConsole 弹出的调试面板，建议开发者在使用到原生组件时尽量在真机上调试。</li>
</ul>
</li>
<li>优点<ul>
<li>扩展 Web 的能力</li>
<li>体验更好，减轻 WebView 的渲染工作</li>
<li>绕过 setData、数据通信和重渲染流程，性能更好</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="基础库"><a href="#基础库" class="headerlink" title="基础库"></a>基础库</h2><blockquote>
<p>它由 JavaScript 编写，可以被注入到视图层和逻辑层运行。</p>
</blockquote>
<ul>
<li>功能<ul>
<li>在渲染层，提供各类组件来组件页面的元素。</li>
<li>在逻辑层，提供各种API来处理各种元素。</li>
<li>处理数据绑定、组件系统、事件系统、通信系统等一系列框架逻辑。</li>
</ul>
</li>
<li>特点<ul>
<li>小程序的渲染层和逻辑层由两个线程管理，两个线程各自注入了基础库。</li>
<li>基础库不会打包在小程序的代码中，它会被提前内置在微信客户端。这样做的优点是：可以降低业务小程序的代码包大小、可以单独修复基础库中的 Bug 而无需修改到业务小程序的代码包。</li>
</ul>
</li>
</ul>
<h1 id="四、View-视图层"><a href="#四、View-视图层" class="headerlink" title="四、View 视图层"></a>四、View 视图层</h1><blockquote>
<p>使用小程序组件来展示，包括 WXML、WXSS。将逻辑层的数据反应成视图，同时将视图层的事件发送给逻辑层。</p>
</blockquote>
<h2 id="WXML-模版"><a href="#WXML-模版" class="headerlink" title="WXML 模版"></a>WXML 模版</h2><ul>
<li>属于微信视图层的一套标签语言，类似 Vue 的模板语法。</li>
<li>支持数据绑定和逻辑运算、支持模板及其引用、支持事件绑定。</li>
<li>不支持 div、span 等标签，全部使用视图容器、基础内容等组件。</li>
</ul>
<h3 id="数据渲染"><a href="#数据渲染" class="headerlink" title="数据渲染"></a>数据渲染</h3>  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 数据绑定 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span> &#123;&#123;name&#125;&#125; + a <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">&quot;item-&#123;&#123;id&#125;&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">hidden</span>=<span class="string">&quot;&#123;&#123;status ? true : false&#125;&#125;&quot;</span>&gt;</span> Hidden <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 条件渲染 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;num &gt; 5&#125;&#125;&quot;</span>&gt;</span> A <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:elif</span>=<span class="string">&quot;&#123;&#123;num &gt; 2&#125;&#125;&quot;</span>&gt;</span> B <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span>&gt;</span> C <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">  列表渲染</span></span><br><span class="line"><span class="comment">    一维数组：默认索引 index、选项 item </span></span><br><span class="line"><span class="comment">    二/多维数组：等同于 &lt;view wx:for=&quot;&#123;&#123;list&#125;&#125;&quot; wx:for-item=&quot;x&quot;&gt;&lt;/view&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;arr&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&#x27;&#123;&#123;index&#125;&#125;&#x27;</span> <span class="attr">id</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;pList&#125;&#125;&quot;</span> &gt;</span>  </span><br><span class="line"> 　　&#123;&#123;item.id&#125;&#125; </span><br><span class="line">  <span class="comment">&lt;!-- wx:for 用于循环数组，wx:for-item 用于给列表赋别名 --&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;item.cList&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;items&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;idx&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;items.name&#125;&#125;：&#123;&#123;item.account&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  data:&#123;</span><br><span class="line">    name: &#x27;Mike&#x27;,</span><br><span class="line">    id: 0,</span><br><span class="line">    status: false,</span><br><span class="line">    arr: [1, 2, 3]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="模板使用"><a href="#模板使用" class="headerlink" title="模板使用"></a>模板使用</h3><ul>
<li>基础使用<ul>
<li>name：定义模版名称</li>
<li>is：用于引用指定模版</li>
<li>data：用于传入模版数据<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;msgItem&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span> &#123;&#123;index&#125;&#125;: &#123;&#123;msg&#125;&#125; <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span> Time: &#123;&#123;time&#125;&#125; <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">&quot;msgItem&quot;</span> <span class="attr">data</span>=<span class="string">&quot;&#123;&#123;...item&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    item: &#123;</span><br><span class="line">      index: 0,</span><br><span class="line">      msg: &#x27;item msg&#x27;,</span><br><span class="line">      time: &#x27;2016-09-15&#x27;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;content-item&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;content.type == &#x27;TEXT&#x27;&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;margin-top:30rpx&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;content.type == &#x27;TEXT&#x27;&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123;content.content&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;content.type == &#x27;IMAGE&#x27;&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;media&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">mode</span>=<span class="string">&quot;aspectFill&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;content.content&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">bindtap</span>=<span class="string">&quot;enterPreviewMode&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">data-src</span>=<span class="string">&quot;&#123;&#123;content.content&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 10rpx&quot;</span>&gt;</span>&#123;&#123;content.description&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;diary.list&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;content&quot;</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">&quot;content-item&quot;</span> <span class="attr">data</span>=<span class="string">&quot;&#123;&#123;content&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>页面引用<ul>
<li><code>import</code> 引用模版内容，不能多重引用</li>
<li><code>include</code> 引用模版内容，就可以多重引用<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- test.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;text&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">&quot;test.wxml&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">&quot;test&quot;</span> <span class="attr">data</span>=<span class="string">&quot;&#123;&#123;text&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">src</span>=<span class="string">&quot;header.wxml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span> body <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">src</span>=<span class="string">&quot;footer.wxml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h3><ul>
<li>绑定：<code>bind/catch + 事件</code>，区别是 bind 不阻止冒泡而 catch 阻止</li>
<li>事件：<code>touchstart、touchmove、touchend、touchcancel、longtap、tap</code><ul>
<li>事件对象：event 包含 currentTarget、target 等事件触发的相关信息</li>
<li>传参方式：<code>data-hi、dataset</code>，类似 html 的自定义属性 data-xxx</li>
<li>点击事件：绑定时不能用 bindclick <code>&lt;view bindtap=&quot;doTap&quot;&gt;&lt;/view&gt;</code></li>
</ul>
</li>
<li>数据<ul>
<li>传递数据：<code>&lt;view data-prop&gt;&lt;/view&gt;</code></li>
<li>获取数据：<code>this.data[prop]</code></li>
<li>修改数据：<code>this.setData(&#123; &#125;)</code></li>
</ul>
</li>
</ul>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&#x27;box&#x27;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">wx:for</span>=<span class="string">&#x27;&#123;&#123;list&#125;&#125;&#x27;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">wx:key</span>=<span class="string">&#x27;&#123;&#123;index&#125;&#125;&#x27;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">data-itemId</span>=<span class="string">&#x27;&#123;&#123;item.id&#125;&#125;&#x27;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">bindtap</span>=<span class="string">&#x27;clickMe&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&#x27;&#123;&#123;item.img&#125;&#125;&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  clickMe: function(e) &#123;</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">        url: &#x27;../../pages/test/test?id=$&#123;e.currentTarget.dataset.itemId&#125;‘</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="WXSS-样式"><a href="#WXSS-样式" class="headerlink" title="WXSS 样式"></a>WXSS 样式</h2><ul>
<li>支持大部分 CSS 特性</li>
<li>新增尺寸单位 rpx，可根据屏幕宽度自适应</li>
<li>使用 @import 语句可以导入外联样式表</li>
<li>支持 class、id、element、::before、::after  </li>
<li>不支持 less、sass 等写法，不支持级联选择器，不支持多层选择器：避免被组件内结构破坏</li>
</ul>
<h2 id="WXS-模块"><a href="#WXS-模块" class="headerlink" title="WXS 模块"></a>WXS 模块</h2><blockquote>
<p>Weixin Script 脚本的简称，用于增强 WXML 的功能而可以直接调用 JS 方法，使用时将 wxs 文件或标签作为一个模块。</p>
</blockquote>
<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><ul>
<li><strong>wxs 标签</strong>：wxml 文件中直接使用<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">wxs</span> <span class="attr">moudle</span>=<span class="string">&quot;tools&quot;</span>&gt;</span></span><br><span class="line">  var a = require(&quot;./tools.wxs&quot;)</span><br><span class="line"></span><br><span class="line">  function my_slice(str, a, b)&#123;</span><br><span class="line">    return str.slice(a, b)</span><br><span class="line">  &#125;</span><br><span class="line">  moudle.exports = &#123;</span><br><span class="line">    my_slice: my_slice,</span><br><span class="line">    msg: &quot;hello&quot;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">wxs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;tools.my_slice(&quot;123456&quot;, 0, 5)&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><strong>wxs 文件</strong>：wxml 文件中引用<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">wxs</span> <span class="attr">src</span>=<span class="string">&quot;../../utils/string.wxs&quot;</span> <span class="attr">module</span>=<span class="string">&quot;tools&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">wxs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;tools.msg&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="模块引用"><a href="#模块引用" class="headerlink" title="模块引用"></a>模块引用</h3><blockquote>
<p>wxs 模块中可以通过 require 引用其它 wxs 文件，注意点如下</p>
</blockquote>
<ul>
<li>只能引用 wxs 文件，并且必须使用相对路径</li>
<li>wxs 模块如果在定义后一直没有被引用，则不会被解析运行</li>
<li>wxs 模块都是单例，多处、多次引用时使用的都是同一个模块对象</li>
</ul>
<h1 id="四、App-Service-逻辑层"><a href="#四、App-Service-逻辑层" class="headerlink" title="四、App Service 逻辑层"></a>四、App Service 逻辑层</h1><blockquote>
<p>将数据进行处理后发送给视图层，同时接受视图层的事件反馈。</p>
</blockquote>
<ul>
<li>每个页面都有独立的作用域，并提供模块化能力。</li>
<li>App() 是小程序的入口，Page() 是页面的入口。</li>
<li>小程序提供了丰富的 API，它们通过 JSBridge 和 Native 进行通信。</li>
</ul>
<h2 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h2><ul>
<li>数据绑定使用 Mustache 语法（双大括号）将变量包起来，动态数据均来自对应 Page 的 data，可以通过 setData 方法修改数据。</li>
<li>事件绑定的写法为 <code>bind/catch + 事件类型 = &quot;事件名&quot;</code>，比如 bindtap, catchtouchstart，事件名需要在对应的 Page 中定义同名的函数。</li>
</ul>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><h3 id="App-应用"><a href="#App-应用" class="headerlink" title="App 应用"></a>App 应用</h3>  <div align="center">
      <img src="/images/webchat/app_life.png" alt="App 应用生命周期" width="100%">
  </div>


<h3 id="Page-页面"><a href="#Page-页面" class="headerlink" title="Page 页面"></a>Page 页面</h3>  <div align="center">
      <img src="/images/webchat/page_life.png" alt="Page 页面生命周期" width="100%">
  </div>

  
<h3 id="影响结果"><a href="#影响结果" class="headerlink" title="影响结果"></a>影响结果</h3>  <div align="center">
      <img src="/images/webchat/app_to_page.png" alt="Page 页面生命周期" width="100%">
  </div>


<h2 id="数据请求"><a href="#数据请求" class="headerlink" title="数据请求"></a>数据请求</h2><blockquote>
<p>必须是 https 请求，需要到小程序的后台设置合法域名。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 项目目录新建文件： utils/request.js</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">getApp</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">url, options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;app.origin&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      ...options,</span><br><span class="line">      <span class="attr">data</span>: options.<span class="property">data</span>,</span><br><span class="line">      <span class="attr">header</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;cookie&#x27;</span>: wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;cookie&quot;</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="comment">//重新授权登录</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">statusCode</span> === <span class="number">401</span>)&#123;</span><br><span class="line">          wx.<span class="title function_">redirectTo</span>(&#123;<span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span>&#125;)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (res.<span class="property">statusCode</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;服务器忙，请稍后重试&#x27;</span>, <span class="attr">code</span>: <span class="number">500</span> &#125;);</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (url === <span class="string">&#x27;/api/cdz/user/weixin/login&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> cookie = res.<span class="property">header</span>[<span class="string">&quot;set-cookie&quot;</span>] || res.<span class="property">header</span>[<span class="string">&quot;Set-Cookie&quot;</span>];</span><br><span class="line">　　　　　　　　</span><br><span class="line">            <span class="keyword">if</span> (cookie) wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;cookie&quot;</span>, cookie);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="title function_">resolve</span>(res.<span class="property">data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (url === <span class="string">&#x27;/api/cdz/user/weixin/login&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> cookie = res.<span class="property">header</span>[<span class="string">&quot;set-cookie&quot;</span>] || res.<span class="property">header</span>[<span class="string">&quot;Set-Cookie&quot;</span>];</span><br><span class="line">          <span class="keyword">if</span> (cookie) wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;cookie&quot;</span>, cookie);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">reject</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;网络错误&#x27;</span>, <span class="attr">code</span>: <span class="number">0</span> &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装 API</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;../utils/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">testPost</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">`/api/test/post`</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">    data,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">testGet</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">`/api/test/get`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h1 id="三、组件化开发"><a href="#三、组件化开发" class="headerlink" title="三、组件化开发"></a>三、组件化开发</h1><blockquote>
<p>开发者可以将页面内的功能模块抽象成自定义组件，具有高内聚、可复用的特点。</p>
</blockquote>
<h2 id="官方组件"><a href="#官方组件" class="headerlink" title="官方组件"></a>官方组件</h2><blockquote>
<p>小程序不支持 html 标签，全部使用视图容器、基础内容等组件渲染页面</p>
</blockquote>
  <div align="center">
      <img src="/images/webchat/com.png" alt="小程序组件" width="100%">
  </div>


<h2 id="block-标签"><a href="#block-标签" class="headerlink" title="block 标签"></a>block 标签</h2><blockquote>
<p>block 仅仅是一个包装元素而并不是一个组件，它只接受控制属性，不会在页面中做任何渲染</p>
</blockquote>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span> text <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;[1, 2, 3]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span> &#123;&#123;index&#125;&#125;: &#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="自定义组件"><a href="#自定义组件" class="headerlink" title="自定义组件"></a>自定义组件</h2><blockquote>
<p>开发者可以将页面内的功能模块抽象成自定义组件，具有高内聚、可复用的特点</p>
</blockquote>
<ul>
<li>优点<ul>
<li>可以在不同的页面中重复使用</li>
<li>可以将复杂的页面拆分成多个低耦合的模块有助于代码维护</li>
</ul>
</li>
<li>实现<ul>
<li>根目录新建文件夹 components </li>
<li>components 目录下新建 Item 文件夹</li>
<li>Item 右键点击新建 Component 并命名 item</li>
<li>编辑自动生成的组件组成文件：<code>json、wxml、wxss、js</code><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  默认只能有一个 slot 插槽，需要使用多个时需要声明启用</span></span><br><span class="line"><span class="comment"> *  除继承样式外，全局样式、组件所在页面的的样式对自定义组件无效</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// item.json：配置文件</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;component&quot;</span>: <span class="literal">true</span>,      <span class="comment">// 声明这个是组件</span></span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;&#125;   <span class="comment">// 表示在该组件中可使用其它组件</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// item.js：逻辑交互文件，定义组件的属性、数据及方法</span></span><br><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="attr">behaviors</span>: [],  <span class="comment">// 类似 vue mixins、traits 的组件间代码复用机制</span></span><br><span class="line">  <span class="attr">relations</span>: &#123;&#125;,  <span class="comment">// 定义关联</span></span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">multipleSlots</span>: <span class="literal">true</span>    <span class="comment">// 启用多 slot 支持</span></span><br><span class="line">    <span class="attr">addGlobalClass</span>: <span class="literal">true</span>,  <span class="comment">// 使组件接受全局样式，尽量避免</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">properties</span>: &#123;    <span class="comment">// 对外定义的接收属性</span></span><br><span class="line">    <span class="attr">innerText</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,  <span class="comment">// String、Number、Boolean、Object、Array、null</span></span><br><span class="line">      <span class="attr">value</span>: <span class="string">&quot;&quot;</span>,     <span class="comment">// 默认值</span></span><br><span class="line">      <span class="title function_">observer</span>(<span class="params">newVal, oldVal, changedPath</span>)&#123; &#125;  <span class="comment">// 属性被改变时执行的函数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">message</span>: <span class="title class_">String</span>    <span class="comment">// 简写方式</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">data</span>: &#123;   <span class="comment">// 私有数据，组件的初始数据</span></span><br><span class="line">    <span class="attr">isShow</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">showData</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">isShow</span>: !<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">isShow</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 内部私有方法建议以下划线开头</span></span><br><span class="line">    <span class="comment">// triggerEvent 用于触发事件</span></span><br><span class="line">    <span class="title function_">_confirmEvent</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">triggerEvent</span>(<span class="string">&quot;confirmEvent&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">externalClasses</span>: [<span class="string">&#x27;tag-class&#x27;</span>],  <span class="comment">// 使用外部类名样式，尽量避免</span></span><br><span class="line">  <span class="attr">lifetimes</span>: &#123;        <span class="comment">// 生命周期函数</span></span><br><span class="line">    <span class="title function_">created</span>(<span class="params"></span>)&#123;&#125;,</span><br><span class="line">    <span class="title function_">attached</span>(<span class="params"></span>)&#123;&#125;,     <span class="comment">// vue beforeMount</span></span><br><span class="line">    <span class="title function_">ready</span>(<span class="params"></span>)&#123;&#125;,        <span class="comment">// vue mounted</span></span><br><span class="line">    <span class="title function_">moved</span>(<span class="params"></span>)&#123;&#125;,        <span class="comment">// 组件位置更新</span></span><br><span class="line">    <span class="title function_">detached</span>(<span class="params"></span>)&#123;&#125;      <span class="comment">// 组件卸载</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">pageLifetimes</span>: &#123;   <span class="comment">// 组件所在页面的生命周期函数</span></span><br><span class="line">    <span class="title function_">show</span>(<span class="params"></span>) &#123; &#125;,</span><br><span class="line">    <span class="title function_">hide</span>(<span class="params"></span>) &#123; &#125;,</span><br><span class="line">    <span class="title function_">resize</span>(<span class="params"></span>) &#123; &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">definitionFilter</span>: &#123;&#125;     <span class="comment">// 组件扩展</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// item.wxss：样式文件，注意只能通过类名指定</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">&quot;../../app.wxss&quot;</span>;  <span class="comment">// 引入公共样式</span></span><br><span class="line">.<span class="property">inner</span>&#123;</span><br><span class="line">  <span class="attr">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// item.wxml：模版文件</span></span><br><span class="line">&lt;view <span class="keyword">class</span>=<span class="string">&quot;inner&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">catchtap</span>=<span class="string">&#x27;_confirmEvent&#x27;</span>&gt;</span>&#123;&#123;innerText&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/view&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">slot</span>&gt;</span>单个插槽<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;before&quot;</span>&gt;</span>插槽 before<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span>&gt;</span>&#123;&#123;innerText&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;after&quot;</span>&gt;</span>插槽 after<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ol start="4">
<li>页面文件中使用<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;index 页面&quot;</span>,</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;myItem&quot;</span>: <span class="string">&quot;/components/item/item&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.wxml</span></span><br><span class="line">&lt;view <span class="keyword">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">myItem</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">innerText</span>=<span class="string">&quot;确定&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">bind:confirmEvent</span>=<span class="string">&quot;_confirmEvent&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>插入到卡槽<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">myItem</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;showData&quot;</span>&gt;</span> ClickMe <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/view&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">&quot;before&quot;</span>&gt;</span>插入到卡槽 before<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">&quot;after&quot;</span>&gt;</span>插入到卡槽 after<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">getApp</span>()</span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">onReady</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">item</span> = <span class="variable language_">this</span>.<span class="title function_">selectComponent</span>(<span class="string">&quot;#item&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">showData</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">item</span>.<span class="title function_">showData</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">_confirmEvent</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">item</span>.<span class="title function_">hideData</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h2><h3 id="父传子：数据绑定"><a href="#父传子：数据绑定" class="headerlink" title="父传子：数据绑定"></a>父传子：数据绑定</h3><ul>
<li>父组件 wxss 子组件标签添加属性：<code>	&lt;submit-bar id=&quot;&#123;&#123;id&#125;&#125;&quot;&gt;&lt;/submit-bar&gt;</code></li>
<li>子组件 js 通过 properties 接收：<code>properties: &#123; id: Number &#125;</code></li>
</ul>
<h3 id="子传父：事件触发"><a href="#子传父：事件触发" class="headerlink" title="子传父：事件触发"></a>子传父：事件触发</h3><ul>
<li>子组件触发事件<ul>
<li><code>this.triggerEvent(&#39;myevent&#39;, &#123; id: 1 &#125;, myEventOption)</code></li>
<li>自定义事件名、传递数据的 detail 对象、事件选项（是否冒泡等）</li>
</ul>
</li>
<li>父组件捕获事件<br>* 子组件标签绑定自定义事件：<code>	&lt;submit-bar bind:submit=&quot;submit&quot;&gt;&lt;/submit-bar&gt;</code><br>* 监听事件执行并接收数据：<code>submit(event)&#123; event.detail.id &#125;</code></li>
</ul>
<h3 id="父组件获取子组件实例"><a href="#父组件获取子组件实例" class="headerlink" title="父组件获取子组件实例"></a>父组件获取子组件实例</h3><ul>
<li><code>&lt;compontent id=&quot;modal&quot;&gt;&lt;/compontent&gt;</code></li>
<li><code>var modal = this.setlectComponet(&#39;#modal&#39;)</code></li>
</ul>
<h2 id="组件共享"><a href="#组件共享" class="headerlink" title="组件共享"></a>组件共享</h2><blockquote>
<p>behaviors 用于组件间代码共享一组属性、数据、生命周期函数和方法，类似 mixins</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 新建 my-behavior.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Behavior</span>(&#123;</span><br><span class="line">  <span class="attr">behaviors</span>: [],</span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="attr">carModel</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">price</span>: <span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">sale</span>: <span class="title class_">Boolean</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">behaviorData1</span>: <span class="string">&quot;eyes on me&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">attached</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">behaviorMethod</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件中使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// com.js</span></span><br><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="attr">behaviors</span>: [myBehavior],  <span class="comment">// 挂载 Behavior</span></span><br><span class="line">  <span class="attr">properties</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">me</span>: <span class="string">&#x27;组件自身数据&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// com.wxml</span></span><br><span class="line">&lt;view <span class="keyword">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span>组件 data：&#123;&#123;me&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span>共有 data：&#123;&#123;behaviorData1&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span>共有 property：&#123;&#123;price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;behaviorMethod&quot;</span>&gt;</span>共有方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure>


<h1 id="五、路由功能"><a href="#五、路由功能" class="headerlink" title="五、路由功能"></a>五、路由功能</h1><h2 id="页面跳转"><a href="#页面跳转" class="headerlink" title="页面跳转"></a>页面跳转</h2><ul>
<li><strong>实现 API</strong><ul>
<li><code>wx.navigateTo</code>：保留当前页面，跳转到应用内的某个页面</li>
<li><code>wx.redirectTo</code>：关闭当前页面，跳转到应用内的某个页面</li>
<li><code>wx.navigateBack</code>：关闭当前页面，回退前一页面</li>
</ul>
</li>
<li><strong>接口说明</strong><ul>
<li>如果某页面设置为 tab 页，则只支持 wx.switchTab</li>
<li>wx.navigateTo 全局最多调用 5 次</li>
</ul>
</li>
<li><strong>接口使用</strong><ul>
<li>对于可逆操作，使用 wx.navigateTo，比如从首页跳转到二级页面，从二级页面返回是不需要重新渲染首页。</li>
<li>对于不可逆操作，使用 wx.redirectTo，比如用户登录成功后关闭登录页面，不能返回到登录界面。</li>
<li>对于一些介绍性等不常用页面，使用 wx.redirectTo、wx.navigatrBack</li>
<li>不要在首页使用 wx.redirectTo，这样会导致应用无法返回首页</li>
</ul>
</li>
<li><strong>应用场景</strong><ul>
<li>小程序启动，初始化第一个页面</li>
<li>打开新页面，调用 API wx.navigateTo 或使用 navigator 组件</li>
<li>页面重定向，调用 API wx.redirectTo 或使用 navigator 组件</li>
<li>页面返回，调用 API wx.navigateBack 或用户按左上角返回按钮</li>
<li>tarbar 切换</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// API</span></span><br><span class="line">wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;pages/logs/index&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>)&#123; &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;pages/logs/index&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>)&#123; &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户点击左上角返回按钮，或调用 wx.navigateBack 返回上一页</span></span><br><span class="line"><span class="comment"> * delta 为 1 时表示返回上一页，为 2 时表示上上一页，以此类推</span></span><br><span class="line"><span class="comment"> * 如果 dalta 大于已打开的页面总数，则返回到首页。返回后元界面会销毁</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">    <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 组件</span></span><br><span class="line"><span class="comment"> *     默认 redirect: false，等同于 wx.navigateTo 接口</span></span><br><span class="line"><span class="comment"> *     添加 redirect 属性时，等同于 wx.redirectTo 接口</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">&lt;navigator url=<span class="string">&quot;pages/logs/index&quot;</span> hover-<span class="keyword">class</span>=<span class="string">&quot;navigator-hover&quot;</span>&gt;跳转&lt;/navigator&gt;</span><br></pre></td></tr></table></figure>

<h2 id="页面栈"><a href="#页面栈" class="headerlink" title="页面栈"></a>页面栈</h2><ul>
<li>页面栈以栈（先进后出）的形式维护页面与页面之间的关系</li>
<li>小程序提供了 getCurrentPages() 函数获取页面栈，第一个元素为首页，最后一个元素为当前页面</li>
<li>页面跳转对页面栈大小的影响<ul>
<li><code>wx.redirectTo</code><ul>
<li>不会增加页面栈大小</li>
<li>从四级页面重定向到二级页面，此时会将关闭四级页面，并使用二级页面替换四级页面，但两个页面状态独立。此时的页面栈大小不变</li>
</ul>
</li>
<li><code>wx.navigateTo</code><ul>
<li>每新开一个页面，页面栈大小加 1 直到为 5 为止</li>
<li>从四级页面跳转到二级页面，此时会在页面栈顶添加一个二级页面的初始状态界面，但两个页面状态独立。页面栈大小加 1，如果是 5 则 wx.navigateTo 无效</li>
</ul>
</li>
<li><code>wx.navigateBack</code>：会减少页面栈大小，直到页面栈大小为 1</li>
</ul>
</li>
</ul>
  <div align="center">
      <img src="/images/webchat/page_stack.png" alt="页面跳转与页面栈" width="100%">
  </div>


<h2 id="页面传值"><a href="#页面传值" class="headerlink" title="页面传值"></a>页面传值</h2><h3 id="事件传参"><a href="#事件传参" class="headerlink" title="事件传参"></a>事件传参</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// view data-id=&#x27;&#123;&#123;id&#125;&#125;&#x27; data-list=&#x27;list&#x27; bindtap=&#x27;clickMe&#x27;</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">clickMe</span>: <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="comment">// 字符串</span></span><br><span class="line">    <span class="keyword">let</span> id = e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">id</span></span><br><span class="line">    <span class="comment">// 数组</span></span><br><span class="line">    <span class="keyword">var</span> albumList = e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">list</span>.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="路由传参"><a href="#路由传参" class="headerlink" title="路由传参"></a>路由传参</h3><blockquote>
<p>适用于传递少量数据，注意 wx.switchTab 中的 url 不能传参</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A 页面传递数据：wxml 标签、js</span></span><br><span class="line">&lt;navigator url=<span class="string">&quot;../detail/detail?name=&#123;&#123;name&#125;&#125;&amp;id=1&quot;</span>&gt;&lt;/navigator&gt;</span><br><span class="line"></span><br><span class="line">wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">`/pages/detail/detail?id=<span class="subst">$&#123;e.currentTarget.dataset.id&#125;</span>`</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail?name=&#x27;</span> + <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">name</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// B 页面接收数据：pages/detail/detail.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span>(<span class="params">option</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">detail_id</span>: options.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">detail_name</span>: options.<span class="property">name</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><blockquote>
<p>通过在 App.js 中设置 globalData </p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// App.js：初始值</span></span><br><span class="line"><span class="title class_">App</span>(&#123;</span><br><span class="line">  <span class="attr">globalData</span>:&#123;</span><br><span class="line">    <span class="attr">appid</span>: <span class="string">&#x27;1wqas2342dasaqwe232342xxx&#x27;</span>,</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;e0dassdadef2424234209bwXXX&#x27;</span>,</span><br><span class="line">    <span class="attr">openid</span>: <span class="string">&#x27;你好&#x27;</span>,</span><br><span class="line">    <span class="attr">deviceInfo</span>: <span class="literal">null</span>,    <span class="comment">// 设备信息，主要用于获取屏幕尺寸而做适配</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 获取日记列表</span></span><br><span class="line">  <span class="title function_">getDiaryList</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">diaryList</span>) &#123;</span><br><span class="line">      <span class="keyword">typeof</span> cb == <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="title function_">cb</span>(<span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">diaryList</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 模拟数据 diaries.js：module.exports = &#123; &#125;</span></span><br><span class="line">      <span class="keyword">const</span> diaries = <span class="built_in">require</span>(<span class="string">&#x27;demo/diaries&#x27;</span>)</span><br><span class="line">      list.<span class="title function_">push</span>(...diaries)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">diaryList</span> = list</span><br><span class="line">      <span class="keyword">typeof</span> cb == <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="title function_">cb</span>(<span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">diaryList</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// test.js：可修改</span></span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">getApp</span>();</span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="title function_">getDiary</span>(<span class="params">params</span>)&#123;</span><br><span class="line">    app.<span class="property">globalData</span>.<span class="property">openid</span> = <span class="string">&quot;12345&quot;</span>;</span><br><span class="line">    app.<span class="title function_">getDiaryList</span>(<span class="function"><span class="params">list</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> id === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        diary = list[<span class="number">0</span>];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        diary = list[id];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="本地缓存"><a href="#本地缓存" class="headerlink" title="本地缓存"></a>本地缓存</h3><blockquote>
<p>单个密钥允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 添加缓存</span></span><br><span class="line"><span class="title function_">set</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 异步存储</span></span><br><span class="line">  wx.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: <span class="string">&#x27;cck&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">()=&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;存储成功&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 同步存储</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">      wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;cck&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123; </span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 获取缓存</span></span><br><span class="line"><span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 异步</span></span><br><span class="line">  wx.<span class="title function_">getStorage</span>(&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">    success (res) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 同步</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> value = wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 移除缓存</span></span><br><span class="line"><span class="title function_">remove</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 异步</span></span><br><span class="line">  wx.<span class="title function_">removeStorage</span>(&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">    success (res) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 同步</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    wx.<span class="title function_">removeStorageSync</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="页面栈-1"><a href="#页面栈-1" class="headerlink" title="页面栈"></a>页面栈</h3><blockquote>
<p>首页 index 进入列表页 list，然后进入详情页 detail，此时如果需要从 detail 页一键返回到 index 页并且传值给 index 页，这里就可以用页面栈来实现</p>
</blockquote>
<ul>
<li>不要尝试修改页面栈，会导致路由以及页面状态错误</li>
<li>不要在 App.onLaunch 时调用 getCurrentPages()，此时 page 还没有生成</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 详情页：view bindtap=&#x27;backToIndex&#x27;&gt; 返回首页</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">tag</span>: <span class="string">&#x27;土豆&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  backToIndex () &#123;</span><br><span class="line">    <span class="comment">// 获取当前的页面栈实例，pages 是一个根据栈的顺序存储了所有页面的数组</span></span><br><span class="line">    <span class="keyword">let</span> pages = <span class="title function_">getCurrentPages</span>()</span><br><span class="line">    </span><br><span class="line">    wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">      <span class="attr">delta</span>: <span class="number">2</span>,</span><br><span class="line">      success () &#123;</span><br><span class="line">        pages[<span class="number">0</span>].<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">tag</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">tag</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首页：&lt;view&gt; &#123;&#123;tag&#125;&#125;</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">tag</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="input-搜索传值"><a href="#input-搜索传值" class="headerlink" title="input 搜索传值"></a>input 搜索传值</h3><ul>
<li><code>&lt;input auto-focus bindinput=&quot;bindKeyInput&quot; bindconfirm=&#39;goSearch&#39; /&gt;</code></li>
<li><strong>bindinput</strong>：键盘输入时触发，<code>event.detail = &#123;value, cursor, keyCode&#125;</code></li>
<li><strong>bindconfirm</strong>：点击完成按钮时触发，<code>event.detail = &#123;value: value&#125;</code></li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/search/search.js </span></span><br><span class="line"><span class="title class_">Page</span>(&#123; </span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">inputValue</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;, </span><br><span class="line"></span><br><span class="line">  <span class="title function_">bindKeyInput</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">inputValue</span>: e.<span class="property">detail</span>.<span class="property">value</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 进入搜索结果页</span></span><br><span class="line">  <span class="title function_">goSearch</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> content = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">inputValue</span></span><br><span class="line">    <span class="keyword">if</span> (!content) &#123; <span class="keyword">return</span> &#125; </span><br><span class="line"></span><br><span class="line">    wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/pages/list/list?content=<span class="subst">$&#123;content&#125;</span>`</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>移动端开发</category>
      </categories>
      <tags>
        <tag>移动端开发</tag>
      </tags>
  </entry>
  <entry>
    <title>移动端技术难点</title>
    <url>/2019/06/28/8-4-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%9A%BE%E7%82%B9/</url>
    <content><![CDATA[<h1 id="一、Hybrid-App"><a href="#一、Hybrid-App" class="headerlink" title="一、Hybrid App"></a>一、Hybrid App</h1><blockquote>
<p>混合模式移动应用，指兼具 NativeApp 良好用户交互体验和 WebApp 跨平台开发优势的应用。由于 H5 页面是内嵌到原生应用的 WebView 组件 (手机浏览器内核)，JS 没有修改系统配置、读写文件等权限，所以通讯机制是混合应用的最关键部分。</p>
</blockquote>
<h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><blockquote>
<p>区别在于 UI 渲染机制，但都是基于 JSBridge 完成的通讯层。第二三种方案可看作基于方案一并通过新技术提高了应用的混合程度。</p>
</blockquote>
<ul>
<li><strong>基于 WebView UI 的方案</strong>：在原生 App 中使用 WebView 作为容器直接承载 Web 页面而赋予 H5 一定的原生功能。WebView 是 android 用来显示 Web 网页并和 js 交互的控件，基于它的方式可扩展很多功能。</li>
<li><strong>基于 Native UI 的方案</strong>：比如 React-Native、Weex。通过 JSBridge 进一步将 js 解析为虚拟 DOM 并传递到 Native 使用原生渲染。</li>
<li><strong>小程序方案</strong>：定制化 JSBridge，WebView 双线程的模式隔离了 JS 逻辑和 UI 渲染。</li>
</ul>
<h2 id="H5-调用-Native"><a href="#H5-调用-Native" class="headerlink" title="H5 调用 Native"></a>H5 调用 Native</h2><ul>
<li><strong>API 注入</strong>：Android4.2+ 通过 addJavascriptInterface 注册方法并暴露到 window，IOS7+ 通过 JavaScriptCore 注册方法并暴露到 window。。</li>
<li><strong>拦截 URL Scheme</strong>：为了方便 app 直接互相调用而设计的类似 url 链接，比如微信 weixin:&#x2F;&#x2F;。前端页面触发 scheme，Android、IOS 分别通过 shouldOverrideUrlLoading、shouldStartLoadWithRequest 拦截请求获取 url 并通过约定的协议处理。</li>
<li><strong>拦截 prompt&#x2F;confirm&#x2F;alert</strong>：Native 通过 onJsPrompt&#x2F;onJsConfirm&#x2F;onJsAlert 实现。</li>
</ul>
<h3 id="API-注入"><a href="#API-注入" class="headerlink" title="API 注入"></a>API 注入</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@title</span> <span class="variable">Android</span></span></span><br><span class="line"><span class="comment">* <span class="doctag">@desp</span> H5 调用一：window.JSBridge.foo();         // foo</span></span><br><span class="line"><span class="comment">* <span class="doctag">@desp</span> H5 调用二：window.JSBridge.foo2(&#x27;test&#x27;);  // foo2:test</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">webSettings = mWebView.<span class="title function_">getSettings</span>();  </span><br><span class="line">webSettings.<span class="title function_">setJavaScriptEnabled</span>(<span class="literal">true</span>);  <span class="comment">// Android 允许 JS 脚本</span></span><br><span class="line">mWebView.<span class="title function_">addJavascriptInterface</span>(<span class="title function_">getJSBridge</span>(), <span class="string">&quot;JSBridge&quot;</span>);</span><br><span class="line">private <span class="title class_">Object</span> <span class="title function_">getJSBridge</span>(<span class="params"></span>)&#123;  </span><br><span class="line">    <span class="title class_">Object</span> insertObj = <span class="keyword">new</span> <span class="title class_">Object</span>()&#123;  </span><br><span class="line">        <span class="comment">// Android4.2 以上暴露的 api 必须加上 @JavascriptInterface</span></span><br><span class="line">        @<span class="title class_">JavascriptInterface</span></span><br><span class="line">        public <span class="title class_">String</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;foo&quot;</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line"></span><br><span class="line">        @<span class="title class_">JavascriptInterface</span></span><br><span class="line">        public <span class="title class_">String</span> <span class="title function_">foo2</span>(<span class="params">final <span class="built_in">String</span> param</span>)&#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;foo2:&quot;</span> + param;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> insertObj;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@title</span> <span class="variable">IOS</span></span></span><br><span class="line"><span class="comment">* <span class="doctag">@desp</span> H5 调用：window.top.foo(&#x27;test&#x27;); // &#x27;foo:test&#x27;</span></span><br><span class="line"><span class="comment">* <span class="doctag">@desp</span> top 确保调用到最顶级，iframe 需要用 top 才能拿到顶级</span></span><br><span class="line"><span class="comment">* <span class="doctag">@desp</span> iOS7+ 原生无法被 JS 调用，需要引入库 JavaScriptCore</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">#<span class="keyword">import</span> &lt;<span class="title class_">JavaScriptCore</span>/<span class="title class_">JavaScriptCore</span>.<span class="property">h</span>&gt;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)<span class="attr">webViewDidFinishLoad</span>:(<span class="title class_">UIWebView</span> *)webView&#123;</span><br><span class="line">    [self hideProgress];</span><br><span class="line">    [self setJSInterface];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)setJSInterface&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">JSContext</span> *context =[_wv <span class="attr">valueForKeyPath</span>:</span><br><span class="line">        @<span class="string">&quot;documentView.webView.mainFrame.javaScriptContext&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册名为foo的api方法</span></span><br><span class="line">    context[@<span class="string">&quot;foo&quot;</span>] = ^() &#123;</span><br><span class="line">        <span class="comment">// 获取参数</span></span><br><span class="line">        <span class="title class_">NSArray</span> *args = [<span class="title class_">JSContext</span> currentArguments];</span><br><span class="line">        <span class="title class_">NSString</span> *title = [<span class="title class_">NSString</span> <span class="attr">stringWithFormat</span>:@<span class="string">&quot;%@&quot;</span>,</span><br><span class="line">            [args <span class="attr">objectAtIndex</span>:<span class="number">0</span>]];</span><br><span class="line">        <span class="comment">// 自定义逻辑：返回一个值 &#x27;foo:&#x27;+title</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="title class_">NSString</span> <span class="attr">stringWithFormat</span>:@<span class="string">&quot;foo:%@&quot;</span>, title];</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="拦截-URL-Scheme"><a href="#拦截-URL-Scheme" class="headerlink" title="拦截 URL Scheme"></a>拦截 URL Scheme</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// H5 发送 URL Scheme 请求</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">callNative</span>(<span class="params"></span>) &#123;    </span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;js://getInfo&quot;</span>;   </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">nativeInfo</span>(<span class="params">info</span>) &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(info) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// h5 发起请求，通知 iOS 需要获取数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">callNative</span>();</span><br><span class="line">    <span class="comment">// 全局注册方法供安卓、Ios 调用，然后返回数据</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">nativeInfo</span> = <span class="variable language_">this</span>.<span class="property">nativeInfo</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Android 拦截请求</span></span><br><span class="line">public boolean <span class="title function_">shouldOverrideUrlLoading</span>(<span class="params">WebView view, <span class="built_in">String</span> url</span>) &#123;</span><br><span class="line">    <span class="comment">// 判断 url 拦截事件：解析出双方约定的协议参数</span></span><br><span class="line">    <span class="keyword">if</span> (url.<span class="title function_">equals</span>(<span class="string">&quot;js://getInfo&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 自定义逻辑</span></span><br><span class="line">      view.<span class="title function_">loadUrl</span>(<span class="string">&quot;javascript:nativeInfo(&quot;</span> + json + <span class="string">&quot;);&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IOS 拦截 url scheme</span></span><br><span class="line">- (<span class="variable constant_">BOOL</span>)<span class="attr">webView</span>:(<span class="title class_">UIWebView</span> *)webView <span class="attr">shouldStartLoadWithRequest</span>:(<span class="title class_">NSURLRequest</span> *)</span><br><span class="line">request <span class="attr">navigationType</span>:(<span class="title class_">UIWebViewNavigationType</span>)navigationType &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable constant_">NSURL</span> *url = [request <span class="variable constant_">URL</span>];</span><br><span class="line">  <span class="title class_">NSString</span> *requestString = [[request <span class="variable constant_">URL</span>] absoluteString];</span><br><span class="line">  <span class="comment">// 获取 URL 并处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="拦截-prompt-x2F-confirm-x2F-alert"><a href="#拦截-prompt-x2F-confirm-x2F-alert" class="headerlink" title="拦截 prompt&#x2F;confirm&#x2F;alert"></a>拦截 prompt&#x2F;confirm&#x2F;alert</h3><blockquote>
<p>IOS 由于安全机制，WKWebView 对 alert、confirm、prompt 等方法做了拦截。如果通过此方式和 JS 交互，需要实现 WKWebView 的三个 WKUIDelegate 代理方法。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// let appBackData = window.prompt(&#x27;js://getInfo&#x27;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Android 重写 prompt</span></span><br><span class="line">public boolean <span class="title function_">onJsPrompt</span>(<span class="params"></span></span><br><span class="line"><span class="params">    WebView view, </span></span><br><span class="line"><span class="params">    <span class="built_in">String</span> url, </span></span><br><span class="line"><span class="params">    <span class="built_in">String</span> message,</span></span><br><span class="line"><span class="params">    <span class="built_in">String</span> defaultValue,</span></span><br><span class="line"><span class="params">    JsPromptResult result,</span></span><br><span class="line"><span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 自定义逻辑</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IOS 解决 prompt</span></span><br><span class="line">- (<span class="keyword">void</span>)<span class="attr">webView</span>:(<span class="title class_">WKWebView</span> *)webView <span class="attr">runJavaScriptTextInputPanelWithPrompt</span>:</span><br><span class="line">(<span class="title class_">NSString</span> *)prompt <span class="attr">defaultText</span>:(<span class="title class_">NSString</span> *)defaultText <span class="attr">initiatedByFrame</span>:</span><br><span class="line">(<span class="title class_">WKFrameInfo</span> *)frame <span class="attr">completionHandler</span>:(<span class="keyword">void</span> (^)(<span class="title class_">NSString</span> * _Nullable))completionHandler&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">UIAlertController</span> *alertController = [<span class="title class_">UIAlertController</span> <span class="attr">alertControllerWithTitle</span>:prompt <span class="attr">message</span>:@<span class="string">&quot;&quot;</span> <span class="attr">preferredStyle</span>:<span class="title class_">UIAlertControllerStyleAlert</span>];</span><br><span class="line"></span><br><span class="line">    [alertController <span class="attr">addTextFieldWithConfigurationHandler</span>:^(<span class="title class_">UITextField</span> * _Nonnull textField) &#123;</span><br><span class="line"></span><br><span class="line">        textField.<span class="property">text</span> = defaultText;</span><br><span class="line"></span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    [alertController <span class="attr">addAction</span>:([<span class="title class_">UIAlertAction</span> <span class="attr">actionWithTitle</span>:@<span class="string">&quot;完成&quot;</span> <span class="attr">style</span>:<span class="title class_">UIAlertActionStyleDefault</span> <span class="attr">handler</span>:^(<span class="title class_">UIAlertAction</span> * _Nonnull action) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">completionHandler</span>(alertController.<span class="property">textFields</span>[<span class="number">0</span>].<span class="property">text</span>?:@<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;])];</span><br><span class="line"></span><br><span class="line">    [self <span class="attr">presentViewController</span>:alertController <span class="attr">animated</span>:<span class="variable constant_">YES</span> <span class="attr">completion</span>:nil];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Native-调用-H5"><a href="#Native-调用-H5" class="headerlink" title="Native 调用 H5"></a>Native 调用 H5</h2><h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><blockquote>
<p>通过 loadUrl 调用，4.4+ 版本还可以通过 evaluateJavascript 调用。注意需要将 JS 方法暴露到 Window。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// H5</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">callAndroid</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;h5 数据&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Android</span></span><br><span class="line"><span class="comment">// 4.4 版本之前：无法获取返回值，需要在 UI 线程运行</span></span><br><span class="line">webView = <span class="keyword">new</span> <span class="title class_">WebView</span>(<span class="variable language_">this</span>);       <span class="comment">// UI 控件      </span></span><br><span class="line">webView.<span class="title function_">loadUrl</span>(<span class="string">&quot;javascript: method(data)&quot;</span>); </span><br><span class="line"><span class="comment">// 4.4 及以后    </span></span><br><span class="line">webView.evaluateJavascript(<span class="string">&quot;javascript: method(data)&quot;</span>, </span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">ValueCallback</span>&lt;<span class="title class_">String</span>&gt;() &#123;</span><br><span class="line">      @<span class="title class_">Override</span></span><br><span class="line">      public <span class="keyword">void</span> <span class="title function_">onReceiveValue</span>(<span class="params"><span class="built_in">String</span> value</span>) &#123;</span><br><span class="line">          <span class="comment">// value 即对应 JS 方法的返回值</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="IOS"><a href="#IOS" class="headerlink" title="IOS"></a>IOS</h3><blockquote>
<p>通过 stringByEvaluatingJavaScriptFromString、evaluateJavaScript 可以调用注册在 H5 window.top.foo 的全局方法。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// UIWebview</span></span><br><span class="line">webview.<span class="title function_">stringByEvaluatingJavaScriptFromString</span>(<span class="string">&quot;method(data)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// WKWebview</span></span><br><span class="line">[jsContext <span class="attr">evaluateJavaScript</span>:@<span class="string">&quot;method(ev, data)&quot;</span>]</span><br></pre></td></tr></table></figure>


<h2 id="JSBridge-通信"><a href="#JSBridge-通信" class="headerlink" title="JSBridge 通信"></a>JSBridge 通信</h2><h3 id="基础介绍"><a href="#基础介绍" class="headerlink" title="基础介绍"></a>基础介绍</h3><ul>
<li><strong>JSBridge</strong>：<code>WebView JavaScript Bridge)</code>，用于构建 JS、Native 双向通信的交互方案，比如微信的 JS-SDK、wx 对象。主要为 JS 提供调用 Native 功能的接口，实现查看本地相册、打开摄像头、指纹支付等原生功能。</li>
<li><strong>实现原理</strong>：Android4.2 以下 addJavascriptInterface 方式有安全漏掉、iOS7 以下 JS 无法调用 Native。目前常用方案是兼容各个版本的 url scheme 方式，基本流程为 H5 触发一个 url scheme、Native 捕获并执行相应功能、Native 调用 h5 方法并将执行结果返回给 h5。</li>
<li><strong>引用方式</strong>：H5 引用可以通过 npm 安装封装上传的 jsBridge，这样需要做更多的兼容处理和维护成本。Native 注入的方式有利于保持 API、Native 的一致性，但是 JS 调用 Native 之前需要先判断 JSBridge 是否注入成功。</li>
</ul>
<h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><blockquote>
<p>bridge.js 包含协议的拼接&#x2F;发送&#x2F;参数池&#x2F;回调池等基础功能、Native SDK 作为客户端 bridge 功能映射代码实现 URL 拦截与解析&#x2F;环境信息的注入&#x2F;通用功能映射等功能。注入时可将这两部分封装为一个 Native SDK 并由客户端统一引入。以下以 Android 为例：</p>
</blockquote>
  <div align="center">
      <img src="/images/mobile/bridge.png" alt="JSBridge 实现流程" width="100%">
  </div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">callJSBridge</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">JSBridge</span>.<span class="title function_">call</span>(<span class="string">&#x27;bridge&#x27;</span>, <span class="string">&#x27;showToast&#x27;</span>,</span><br><span class="line">        &#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;Hello JSBridge&#x27;</span>&#125;,</span><br><span class="line">        <span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res))</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jsBridge.js</span></span><br><span class="line"><span class="attr">call</span>: <span class="keyword">function</span> (<span class="params">obj, method, params, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> port = <span class="title class_">Util</span>.<span class="title function_">getPort</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">callbacks</span>[port] = callback;</span><br><span class="line">    <span class="keyword">var</span> uri = <span class="title class_">Util</span>.<span class="title function_">getUri</span>(obj, method, params, port);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">prompt</span>(uri);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Android</span></span><br><span class="line">@<span class="title class_">Override</span></span><br><span class="line">public boolean <span class="title function_">onJsPrompt</span>(<span class="params"></span></span><br><span class="line"><span class="params">    WebView view, </span></span><br><span class="line"><span class="params">    <span class="built_in">String</span> url, </span></span><br><span class="line"><span class="params">    <span class="built_in">String</span> message, </span></span><br><span class="line"><span class="params">    <span class="built_in">String</span> defaultValue, </span></span><br><span class="line"><span class="params">    JsPromptResult result</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    result.<span class="title function_">confirm</span>(<span class="title class_">JSBridge</span>.<span class="title function_">callJava</span>(view, message));</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showToast</span>(<span class="params">  <span class="comment">// 管理暴露给前端使用的函数</span></span></span><br><span class="line"><span class="params">    WebView webView, </span></span><br><span class="line"><span class="params">    JSONObject param, </span></span><br><span class="line"><span class="params">    final JSBridge.Callback callback</span></span><br><span class="line"><span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">String</span> message = param.<span class="title function_">optString</span>(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">    <span class="title class_">Toast</span>.<span class="title function_">makeText</span>(webView.<span class="title function_">getContext</span>(),message,<span class="title class_">Toast</span>.<span class="property">LENGTH_LONG</span>).<span class="title function_">show</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> != callback)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">JSON</span><span class="built_in">Object</span> object = <span class="keyword">new</span> <span class="title class_">JSON</span><span class="built_in">Object</span>();</span><br><span class="line">            object.<span class="title function_">put</span>(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);</span><br><span class="line">            object.<span class="title function_">put</span>(<span class="string">&quot;key1&quot;</span>,<span class="string">&quot;vaule1&quot;</span>);</span><br><span class="line">            callback.<span class="title function_">apply</span>(<span class="title function_">getJSONObject</span>(<span class="number">0</span>,<span class="string">&quot;ok&quot;</span>,object));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (<span class="title class_">Exception</span> e)&#123;</span><br><span class="line">            e.<span class="title function_">printStackTrace</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常用功能"><a href="#常用功能" class="headerlink" title="常用功能"></a>常用功能</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ================ jsBridge.js ===============</span></span><br><span class="line"><span class="comment">// app 加载完毕后修改 loadstatus</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">HQAppGetH5Header</span> = <span class="keyword">function</span> (<span class="params">n</span>) &#123; </span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">loadstatus</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 呼叫身份证扫描</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">idCardScan</span> = <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="title function_">clearTimer</span>()</span><br><span class="line">  <span class="keyword">const</span> idcard = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      options = options ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(options) : <span class="literal">undefined</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">HQAppJSInterface</span>.<span class="title function_">requestScanCertificateCard</span>(options)</span><br><span class="line">      <span class="variable language_">window</span>.**tid = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">status</span>) &#123;</span><br><span class="line">          <span class="title function_">clearTimer</span>()</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="title class_">SetCustomerRules</span>(<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">value</span>))</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// reject(&#x27;fail&#x27;)</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">30</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="title function_">checkload</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">idcard</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 导入银行卡</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">getBank</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">clearTimer</span>()</span><br><span class="line">  <span class="keyword">const</span> bank = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">HQAppJSInterface</span>.<span class="title function_">requestScanBankCard</span>()</span><br><span class="line">      <span class="variable language_">window</span>.**tid = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// alert(&#x27;job=&#x27; + window.jsBridge.status.bank.status)</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">status</span>) &#123;</span><br><span class="line">          <span class="title function_">clearTimer</span>()</span><br><span class="line">          <span class="comment">// alert(&#x27;job start=&#x27; + window.jsBridge.status.bank.status)</span></span><br><span class="line">          <span class="title function_">resolve</span>(<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">value</span>)</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// reject(&#x27;fail&#x27;)</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">30</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="title function_">checkload</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">bank</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 呼叫 app 照相机</span></span><br><span class="line"><span class="keyword">let</span> timeid</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">callCamera</span> = <span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="title function_">clearTimer</span>()</span><br><span class="line">  <span class="keyword">let</span> camera = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">index</span> += <span class="number">1</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>[<span class="string">&#x27;camera&#x27;</span> + <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">index</span>] = &#123;</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">HQAppJSInterface</span>.<span class="title function_">takeUserImage</span>()</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">window</span>.**tid = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">status</span>) &#123;</span><br><span class="line">          <span class="title function_">clearTimer</span>()</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">value</span>, n)</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// reject(&#x27;fail&#x27;)</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">30</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="title function_">checkload</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">camera</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 呼叫app 照相机-裁剪</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">tailorCamera</span> = <span class="keyword">function</span> (<span class="params">n, bool, width, height</span>) &#123;</span><br><span class="line">  <span class="title function_">clearTimer</span>()</span><br><span class="line">  <span class="keyword">let</span> camera = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">index</span> += <span class="number">1</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>[<span class="string">&#x27;camera&#x27;</span> + <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">index</span>] = &#123;</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">HQAppJSInterface</span>.<span class="title function_">takeUserImage</span>(bool, width, height)</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">window</span>.**tid = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">status</span>) &#123;</span><br><span class="line">          <span class="title function_">clearTimer</span>()</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">value</span>, n)</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">camera</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// reject(&#x27;fail&#x27;)</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">30</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="title function_">checkload</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">camera</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 组件调用 ============</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">idCardScan</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$emit(<span class="string">&#x27;scan&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(response))</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">getBank</span>().<span class="title function_">then</span>(<span class="title class_">JSON</span>.<span class="property">parse</span>).<span class="title function_">then</span>(<span class="variable language_">this</span>.<span class="property">onScan</span>).<span class="title function_">catch</span>(toast)</span><br></pre></td></tr></table></figure>


<h2 id="App-中接入-H5"><a href="#App-中接入-H5" class="headerlink" title="App 中接入 H5"></a>App 中接入 H5</h2><ul>
<li><strong>在线 H5</strong><ul>
<li>实现方式：将 H5 代码部署到服务器，通过 WebView 打开对应的 URL 即可嵌入。一般应用到帮助页、提示页等不需要复杂协议和离线使用的轻量级页面。</li>
<li>优点：独立性强而具有独立的开发&#x2F;调试&#x2F;更新&#x2F;上线能力、资源放在服务器上而完全不会影响客户端的包体积、完全的热更新机制而接入成本很低。</li>
<li>缺点：完全依赖网络，离线时无法打开页面，网络较慢时首屏加载也较慢。</li>
</ul>
</li>
<li><strong>内置包 H5</strong><ul>
<li>实现方式：本地化的嵌入方式，需要将代码进行打包后下发到客户端，并由客户端直接解压到本地储存中。一般应用在一些比较大和比较重要的模块。</li>
<li>优点：接近原生的用户体验、首屏加载速度快、可以不依赖网络而离线运行。</li>
<li>缺点：开发流程&#x2F;更新机制复杂、需要客户端和服务端的共同协作、增加包体积。</li>
</ul>
</li>
</ul>
<h2 id="H5-唤起应用程序"><a href="#H5-唤起应用程序" class="headerlink" title="H5 唤起应用程序"></a>H5 唤起应用程序</h2><blockquote>
<p>Window 系统注册表存储了系统和应用程序的设置信息，查看可通过 Windows + R 打开后输入 regedit。H5 通过注册表查找并通过 URL Scheme 协议打开应用程序，<code>&lt;a href=&quot;vscode://&quot;&gt;打开 vscode：// 后面为参数内容&lt;/a&gt;</code>。</p>
</blockquote>
  <div align="center">
      <img src="/images/mobile/regedit.png" alt="注册表" width="100%">
  </div>


<h1 id="二、跨平台框架"><a href="#二、跨平台框架" class="headerlink" title="二、跨平台框架"></a>二、跨平台框架</h1><blockquote>
<p><a href="https://www.zhihu.com/question/55714900">https://www.zhihu.com/question/55714900</a></p>
</blockquote>
<h2 id="Cordova"><a href="#Cordova" class="headerlink" title="Cordova"></a>Cordova</h2><h2 id="React-Native"><a href="#React-Native" class="headerlink" title="React Native"></a>React Native</h2><h2 id="Weex"><a href="#Weex" class="headerlink" title="Weex"></a>Weex</h2><h2 id="uni-app"><a href="#uni-app" class="headerlink" title="uni-app"></a>uni-app</h2><p><a href="https://uniapp.dcloud.net.cn/">https://uniapp.dcloud.net.cn/</a></p>
<h2 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h2><p>跨平台技术<br><a href="https://juejin.cn/post/6922641090164195341#heading-10">https://juejin.cn/post/6922641090164195341#heading-10</a></p>
<p><a href="https://juejin.cn/post/6977171385349046286#heading-6">https://juejin.cn/post/6977171385349046286#heading-6</a><br><a href="https://juejin.cn/post/6854573218485927949">https://juejin.cn/post/6854573218485927949</a><br><a href="https://juejin.cn/post/7070504601107038244">https://juejin.cn/post/7070504601107038244</a></p>
<p><a href="http://www.apppark.cn/t-28064.html">http://www.apppark.cn/t-28064.html</a></p>
<h1 id="三、微信公众号"><a href="#三、微信公众号" class="headerlink" title="三、微信公众号"></a>三、微信公众号</h1><h2 id="基础介绍-1"><a href="#基础介绍-1" class="headerlink" title="基础介绍"></a>基础介绍</h2><h3 id="公众号类型"><a href="#公众号类型" class="headerlink" title="公众号类型"></a>公众号类型</h3><blockquote>
<p>订阅号存放在一个文件夹中且需要点开查看关注，服务号直接显示在聊天列表。个人只能申请订阅号，几乎没有可用的接口。</p>
</blockquote>
<ul>
<li><strong>订阅号</strong>：主要用于推送资讯而让用户阅读，每天只能群发一条消息。</li>
<li><strong>服务号</strong>：主要用于为企业、政府等提供对用户的服务，比如银行的服务号可以让用户查询账单等，每个月只可群发四条消息。</li>
<li><strong>企业号</strong>：主要用于公司内部通讯使用，旨在为用户提供移动办公，需要先有成员的通讯信息验证才可以关注成功企业微信。</li>
<li><strong>测试号</strong>：用于开发测试及功能体验，是专门为开发人员准备的一种仅用于测试的公众号，但不可使用微信支付等高级功能。</li>
</ul>
<h3 id="微信公众平台"><a href="#微信公众平台" class="headerlink" title="微信公众平台"></a>微信公众平台</h3><blockquote>
<p>用于管理注册过的公众号，比如自定义菜单、自动回复、推送文章等，主要有两种管理模式：<strong>编辑模式</strong>就是为所有人提供的，如果你的需求仅仅只是最常见的菜单、自动回复等，使用编辑模式已经满足。但是如果你需求的功能比较复杂，就需要使用到<strong>开发模式</strong>。</p>
</blockquote>
<ul>
<li><strong>编辑模式</strong>：主要针对非编程人员及信息发布类公众帐号使用，开启后可以直接通过界面配置自定义菜单、自动回复的消息。优点是可视化界面配置、操作简单快捷，但功能有限。</li>
<li><strong>开发模式</strong>：主要针对开发人员使用，开启后可以使用微信公众平台的开放接口，但编辑模式的自定义菜单等功能会失效。优点是可以实现更多的复杂功能，提供个性化服务。</li>
</ul>
<h3 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h3><ul>
<li><strong>技术文档</strong>：<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1445241432/">微信公众平台开发文档</a>、<a href="http://mp.weixin.qq.com/debug/">接口在线调试网址</a>。</li>
<li><strong>测试账号</strong>：拥有几乎所有的公众号接口但不支持微信支付，主要用于手机端开发测试。</li>
<li><strong>微信 API 在线调试</strong>：后端代码与微信服务器交互实现创建自定义菜单等功能，手机端可通过扫描测试号二维码查看最新效果。</li>
<li><strong>微信开发者工具</strong>：自带审查元素功能的微信浏览器，用于调试微信端页面。使用前需要绑定开发者微信号 (公众平台首页、开发者工具)。</li>
<li><strong>JS-SDK 工具包</strong>：基于微信内的网页开发工具包。开发者可用来借助微信高效地使用拍照、选图、语音、位置等手机系统的能力，而且可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力，为微信用户提供更优质的网页体验。</li>
</ul>
<h2 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h2><h3 id="公众号配置"><a href="#公众号配置" class="headerlink" title="公众号配置"></a>公众号配置</h3><blockquote>
<p>手机端调试：扫码关注测试二维码。公众号域名可以是 http&#x2F;https，小程序必须是 https。</p>
</blockquote>
<ol>
<li>注册一个服务号并认证通过：只有服务号可以开通微信支付。</li>
<li>管理员为开发者添加服务号和商户平台的用户管理权限：微信公众平台的权限为运营者微信号、微信商户平台的权限为员工账号。</li>
<li><strong>开通微信支付功能</strong><br>* 公众号：拥有通过微信认证的公众帐号且为服务号、服务号和商户平台是一个账户主体。<br>* 商户平台：产品中心处开通公众号支付、扫码支付等所需要的支付方式，然后配置支付授权目录。注意小程序也属于公众号支付，不需要单独开通。</li>
<li><strong>配置公众号</strong><br>* 测试账号：JS 接口安全域名 (用于实现微信分享等功能，不需要加 http&#x2F;https)、授权回调页面域名 (用于用户登录和基本信息获取，只支持 80 端口，务必使服务器监听 80 端口)、接口配置信息 (URL、Token 由后端提供)。<br>* IP 白名单：在公众号后台设置服务器 IP 为白名单，否则无法获取 access_token。<br>* 自定义菜单：上线时配置 公众号网址 + 各个菜单对应的前端路由，比如公司简介 <code>https://wx.shanghailife.com.cn/aboutus</code>。</li>
</ol>
<h3 id="内网穿透环境"><a href="#内网穿透环境" class="headerlink" title="内网穿透环境"></a>内网穿透环境</h3><blockquote>
<p>公众号开发涉及到微信的回调，所以本地调试的内网服务器需要外网服务器能够连接通信。解决方案主要有两种：一是<strong>购买域名和云服务器并配置代理</strong>，将本地服务器网址映射到外网。二是使用<strong>内网穿透技术</strong>，让本地服务器直接穿透到外网。我们一般通过拥有免费通道的 natapp 实现内网穿透，但缺点是外网访问本地项目的地址经常会变化而不太稳定，具体配置如下：</p>
</blockquote>
<ol>
<li>登录并购买免费隧道：首次需要<a href="https://natapp.cn/register">注册</a>、点击购买并配置地址 <code>http://127.0.0.1:80</code>。</li>
<li>本机运行 web 服务：配置地址 <code>http://127.0.0.1:80</code>。</li>
<li>本机运行 natapp 服务：下载 <a href="https://natapp.cn/#download">natapp.exe</a>、获取 authtoken (我的隧道处)。<br>* 直接启动：<strong>natapp -authtoken&#x3D;9ab6b9040a624f40</strong><br>* 通过 config.ini：<a href="https://natapp.cn/article/config_ini">下载 config.ini</a> 并填入 authtoken 后双击启动。</li>
<li>测试 natapp 分配的网址：拔掉电脑网线后在浏览器地址栏打开即可。</li>
</ol>
<h3 id="接口参数"><a href="#接口参数" class="headerlink" title="接口参数"></a>接口参数</h3><ul>
<li><strong>appid</strong>：公众号唯一标识。</li>
<li><strong>secret</strong>：公众号开发密钥。</li>
<li><strong>openid</strong>：用户单平台的唯一标识，同一用户在公众号和小程序有不同的 openid。</li>
<li><strong>unionid</strong>：用户跨微信平台的唯一标识，同一用户在公众号和小程序有相同的 unionid。</li>
<li><strong>code</strong>：用户授权时用于获取 access_token，只能使用一次且 5分钟未被使用则自动过期。</li>
<li><strong>redirect_uri</strong>：完成授权后重定向的回调链接（其实是用户要访问的页面，注意转义）。</li>
<li><strong>response_type</strong> ：返回类型，固定为 code。</li>
<li><strong>state</strong>：重定向后被微信原样返回，可用于前后对比来防止别人的攻击。</li>
<li><strong>scope</strong>：授权方式。snsapi_base (不弹出授权页面而直接跳转，只能获取用户 openid)、snsapi_userinfo (弹出授权页面，可通过 openid 获取昵称、性别、所在地等信息)。</li>
<li><strong>#wechat_redirect</strong>：直接在微信打开链接的可选参数。实现页面 302 重定向时必须携带。</li>
</ul>
<h2 id="网页授权"><a href="#网页授权" class="headerlink" title="网页授权"></a>网页授权</h2><blockquote>
<p>用户通过扫码、点击按钮等方式进入公众号页面，没有用户信息时会跳转到微信授权页面，用户同意后则自动跳转到携带参数 code、state 的回调页面，然后通过 code 获取网页授权 access_token 后才能请求获取用户信息，详情可参考<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html">官方文档</a>。注意区分 access_token：网页授权 access_token 不限制调用次数而且只要用户允许后就可以获取用户信息，普通 access_token 限制每日 2000 次而且必须关注公众号才能获取。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">后端接入：开源工具 weixin-java-tools  <span class="attr">https</span>:<span class="comment">//github.com/Wechat-Group/WxJava</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、pom.xml 引入 jar 包</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.binarywang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>weixin-java-mp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、application.yml 添加配置，没有则去申请测试账号</span></span><br><span class="line"><span class="attr">wechat</span>:</span><br><span class="line">  <span class="attr">mpAppId</span>: appid</span><br><span class="line">  <span class="attr">mpAppSecret</span>: appsecret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、新建读取配置文件 WechatMpProperties.java</span></span><br><span class="line">package com.<span class="property">hsc</span>.<span class="property">power</span>.<span class="property">dm</span>.<span class="property">wechat</span>.<span class="property">config</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.<span class="property">Data</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">context</span>.<span class="property">properties</span>.<span class="property">ConfigurationProperties</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">stereotype</span>.<span class="property">Component</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Data</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">@<span class="title class_">ConfigurationProperties</span>(prefix = <span class="string">&quot;wechat&quot;</span>)</span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WechatMpProperties</span> &#123;</span><br><span class="line">    private <span class="title class_">String</span> mpAppId;</span><br><span class="line">    private <span class="title class_">String</span> mpAppSecret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、新建自定义微信配置 WechatMpConfig.java</span></span><br><span class="line">package com.<span class="property">hsc</span>.<span class="property">power</span>.<span class="property">dm</span>.<span class="property">wechat</span>.<span class="property">config</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">mp</span>.<span class="property">api</span>.<span class="property">WxMpService</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">mp</span>.<span class="property">api</span>.<span class="property">impl</span>.<span class="property">WxMpServiceImpl</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">mp</span>.<span class="property">config</span>.<span class="property">WxMpConfigStorage</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">mp</span>.<span class="property">config</span>.<span class="property">impl</span>.<span class="property">WxMpDefaultConfigImpl</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">beans</span>.<span class="property">factory</span>.<span class="property">annotation</span>.<span class="property">Autowired</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">context</span>.<span class="property">annotation</span>.<span class="property">Bean</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">stereotype</span>.<span class="property">Component</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WechatMpConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">WechatMpProperties</span> wechatMpProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置 WxMpService 所需信息</span></span><br><span class="line">    @<span class="title class_">Bean</span></span><br><span class="line">    public <span class="title class_">WxMpService</span> <span class="title function_">wxMpService</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">WxMpService</span> wxMpService = <span class="keyword">new</span> <span class="title class_">WxMpServiceImpl</span>();</span><br><span class="line">        <span class="comment">// 设置配置信息的存储位置</span></span><br><span class="line">        wxMpService.<span class="title function_">setWxMpConfigStorage</span>(<span class="title function_">wxMpConfigStorage</span>());</span><br><span class="line">        <span class="keyword">return</span> wxMpService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置 appId、appsecret</span></span><br><span class="line">    @<span class="title class_">Bean</span></span><br><span class="line">    public <span class="title class_">WxMpConfigStorage</span> <span class="title function_">wxMpConfigStorage</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">WxMpDefaultConfigImpl</span> wxMpDefaultConfig = <span class="keyword">new</span> <span class="title class_">WxMpDefaultConfigImpl</span>();</span><br><span class="line">        wxMpDefaultConfig.<span class="title function_">setAppId</span>(wechatMpProperties.<span class="title function_">getMpAppId</span>());</span><br><span class="line">        wxMpDefaultConfig.<span class="title function_">setSecret</span>(wechatMpProperties.<span class="title function_">getMpAppSecret</span>());</span><br><span class="line">        <span class="keyword">return</span> wxMpDefaultConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5、新建微信用户 Bean</span></span><br><span class="line">package com.<span class="property">hsc</span>.<span class="property">power</span>.<span class="property">dm</span>.<span class="property">wechat</span>.<span class="property">vo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.<span class="property">Data</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">mp</span>.<span class="property">bean</span>.<span class="property">result</span>.<span class="property">WxMpUser</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Data</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WechatUser</span> &#123;</span><br><span class="line">    public <span class="title class_">WechatUser</span>(<span class="title class_">WxMpUser</span> wxMpUser, <span class="title class_">String</span> accessToken) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setAccessToken</span>(accessToken);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setOpenid</span>(wxMpUser.<span class="title function_">getOpenId</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setUnionId</span>(wxMpUser.<span class="title function_">getUnionId</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setNickname</span>(wxMpUser.<span class="title function_">getNickname</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setLanguage</span>(wxMpUser.<span class="title function_">getLanguage</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setCountry</span>(wxMpUser.<span class="title function_">getCountry</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setProvince</span>(wxMpUser.<span class="title function_">getCity</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setCity</span>(wxMpUser.<span class="title function_">getCity</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setSex</span>(wxMpUser.<span class="title function_">getSex</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setSexDesc</span>(wxMpUser.<span class="title function_">getSexDesc</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setHeadImgUrl</span>(wxMpUser.<span class="title function_">getHeadImgUrl</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title class_">String</span> openid;</span><br><span class="line">    private <span class="title class_">String</span> accessToken;</span><br><span class="line">    private <span class="title class_">String</span> unionId;</span><br><span class="line">    private <span class="title class_">String</span> nickname;</span><br><span class="line">    private <span class="title class_">String</span> language;</span><br><span class="line">    private <span class="title class_">String</span> country;</span><br><span class="line">    private <span class="title class_">String</span> province;</span><br><span class="line">    private <span class="title class_">String</span> city;</span><br><span class="line">    private <span class="title class_">Integer</span> sex;</span><br><span class="line">    private <span class="title class_">String</span> sexDesc;</span><br><span class="line">    private <span class="title class_">String</span> headImgUrl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 6、授权接口 WechatController.java</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  /auth：获取授权跳转地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  /auth/user/info：初次授权获取用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span>  /token/user/info：静默授权获取用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">package com.<span class="property">hsc</span>.<span class="property">power</span>.<span class="property">dm</span>.<span class="property">wechat</span>.<span class="property">web</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">baomidou</span>.<span class="property">mybatisplus</span>.<span class="property">core</span>.<span class="property">toolkit</span>.<span class="property">ExceptionUtils</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">hsc</span>.<span class="property">power</span>.<span class="property">core</span>.<span class="property">base</span>.<span class="property">ret</span>.<span class="property">Rb</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">hsc</span>.<span class="property">power</span>.<span class="property">dm</span>.<span class="property">wechat</span>.<span class="property">vo</span>.<span class="property">WechatUser</span>;</span><br><span class="line"><span class="keyword">import</span> lombok.<span class="property">extern</span>.<span class="property">slf4j</span>.<span class="property">Slf4j</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">common</span>.<span class="property">api</span>.<span class="property">WxConsts</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">common</span>.<span class="property">error</span>.<span class="property">WxErrorException</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">mp</span>.<span class="property">api</span>.<span class="property">WxMpService</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">mp</span>.<span class="property">bean</span>.<span class="property">result</span>.<span class="property">WxMpOAuth2AccessToken</span>;</span><br><span class="line"><span class="keyword">import</span> me.<span class="property">chanjar</span>.<span class="property">weixin</span>.<span class="property">mp</span>.<span class="property">bean</span>.<span class="property">result</span>.<span class="property">WxMpUser</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">beans</span>.<span class="property">factory</span>.<span class="property">annotation</span>.<span class="property">Autowired</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">web</span>.<span class="property">bind</span>.<span class="property">annotation</span>.<span class="property">GetMapping</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">web</span>.<span class="property">bind</span>.<span class="property">annotation</span>.<span class="property">RequestMapping</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">web</span>.<span class="property">bind</span>.<span class="property">annotation</span>.<span class="property">RequestParam</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">web</span>.<span class="property">bind</span>.<span class="property">annotation</span>.<span class="property">RestController</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">net</span>.<span class="property">URLEncoder</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Slf4</span>j</span><br><span class="line">@<span class="title class_">RestController</span></span><br><span class="line">@<span class="title class_">RequestMapping</span>(<span class="string">&quot;/wechat&quot;</span>)</span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WechatController</span> &#123;</span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">WxMpService</span> wxMpService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 code 参数：returnUrl 需要跳转的重定向 url</span></span><br><span class="line">    @<span class="title class_">GetMapping</span>(<span class="string">&quot;/auth&quot;</span>)</span><br><span class="line">    public <span class="title class_">Rb</span>&lt;<span class="title class_">String</span>&gt; <span class="title function_">authorize</span>(<span class="params">@RequestParam <span class="built_in">String</span> authCallbackUrl, </span></span><br><span class="line"><span class="params">    @RequestParam <span class="built_in">String</span> returnUrl</span>) &#123;</span><br><span class="line">        <span class="comment">// 暂时将回调地址硬编码在这里，方便调试</span></span><br><span class="line">        <span class="title class_">String</span> redirectUrl = wxMpService.<span class="title function_">oauth2buildAuthorizationUrl</span>(</span><br><span class="line">            authCallbackUrl, </span><br><span class="line">            <span class="title class_">WxConsts</span>.<span class="property">OAuth2Scope</span>.<span class="property">SNSAPI_USERINFO</span>, </span><br><span class="line">            <span class="title class_">URLEncoder</span>.<span class="title function_">encode</span>(returnUrl)</span><br><span class="line">        );</span><br><span class="line">        log.<span class="title function_">info</span>(<span class="string">&quot;【微信网页授权】获取code，redirectUrl = &#123;&#125;&quot;</span>, redirectUrl);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Rb</span>.<span class="title function_">ok</span>(redirectUrl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初次授权获取用户信息</span></span><br><span class="line">    @<span class="title class_">GetMapping</span>(<span class="string">&quot;/auth/user/info&quot;</span>)</span><br><span class="line">    public <span class="title class_">Rb</span>&lt;<span class="title class_">WechatUser</span>&gt; <span class="title function_">userInfo</span>(<span class="params">@RequestParam(<span class="string">&quot;code&quot;</span>) <span class="built_in">String</span> code, </span></span><br><span class="line"><span class="params">    @RequestParam(<span class="string">&quot;state&quot;</span>) <span class="built_in">String</span> returnUrl</span>) &#123;</span><br><span class="line">        <span class="title class_">WxMpOAuth2AccessToken</span> wxMpOAuth2AccessToken;</span><br><span class="line">        <span class="title class_">WxMpUser</span> wxMpUser;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 使用 code 换取 access_token 信息</span></span><br><span class="line">            wxMpOAuth2AccessToken = wxMpService.<span class="title function_">oauth2getAccessToken</span>(code);</span><br><span class="line">            wxMpUser = wxMpService.<span class="title function_">oauth2getUserInfo</span>(wxMpOAuth2AccessToken, <span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">WxErrorException</span> e) &#123;</span><br><span class="line">            log.<span class="title function_">error</span>(<span class="string">&quot;【微信网页授权】异常，&#123;&#125;&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="title class_">ExceptionUtils</span>.<span class="title function_">mpe</span>(e.<span class="title function_">getError</span>().<span class="title function_">getErrorMsg</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 从 access_token 信息中获取到用户的 openid</span></span><br><span class="line">        <span class="title class_">String</span> openId = wxMpOAuth2AccessToken.<span class="title function_">getOpenId</span>();</span><br><span class="line">        log.<span class="title function_">info</span>(<span class="string">&quot;【微信网页授权】获取openId，openId = &#123;&#125;&quot;</span>, openId);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">WechatUser</span> wechatUser = <span class="keyword">new</span> <span class="title class_">WechatUser</span>(wxMpUser, wxMpOAuth2AccessToken.<span class="title function_">getAccessToken</span>());</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Rb</span>.<span class="title function_">ok</span>(wechatUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静默授权获取用户信息：openid、token</span></span><br><span class="line">    @<span class="title class_">GetMapping</span>(<span class="string">&quot;/token/user/info&quot;</span>)</span><br><span class="line">    public <span class="title class_">Rb</span>&lt;<span class="title class_">WechatUser</span>&gt; <span class="title function_">getUserInfo</span>(<span class="params">@RequestParam <span class="built_in">String</span> openid, </span></span><br><span class="line"><span class="params">    @RequestParam <span class="built_in">String</span> token</span>) &#123;</span><br><span class="line">        <span class="title class_">WxMpOAuth2AccessToken</span> wxMpOAuth2AccessToken = <span class="keyword">new</span> <span class="title class_">WxMpOAuth2AccessToken</span>();</span><br><span class="line">        wxMpOAuth2AccessToken.<span class="title function_">setOpenId</span>(openid);</span><br><span class="line">        wxMpOAuth2AccessToken.<span class="title function_">setAccessToken</span>(token);</span><br><span class="line">        <span class="comment">// 判断 accessToken是否失效，失效即刷新 accecssToken</span></span><br><span class="line">        boolean ret = wxMpService.<span class="title function_">oauth2validateAccessToken</span>(wxMpOAuth2AccessToken);</span><br><span class="line">        <span class="keyword">if</span> (!ret) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wxMpOAuth2AccessToken = wxMpService.<span class="title function_">oauth2refreshAccessToken</span>(wxMpOAuth2AccessToken.<span class="title function_">getRefreshToken</span>());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="title class_">WxErrorException</span> e) &#123;</span><br><span class="line">                log.<span class="title function_">error</span>(<span class="string">&quot;【微信网页授权】刷新token失败，&#123;&#125;&quot;</span>, e.<span class="title function_">getError</span>().<span class="title function_">getErrorMsg</span>());</span><br><span class="line">                <span class="keyword">throw</span> <span class="title class_">ExceptionUtils</span>.<span class="title function_">mpe</span>(e.<span class="title function_">getError</span>().<span class="title function_">getErrorMsg</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取用户信息</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">WxMpUser</span> wxMpUser = wxMpService.<span class="title function_">oauth2getUserInfo</span>(wxMpOAuth2AccessToken, <span class="literal">null</span>);</span><br><span class="line">            <span class="title class_">WechatUser</span> wechatUser = <span class="keyword">new</span> <span class="title class_">WechatUser</span>(wxMpUser, wxMpOAuth2AccessToken.<span class="title function_">getAccessToken</span>());</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Rb</span>.<span class="title function_">ok</span>(wechatUser);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">WxErrorException</span> e) &#123;</span><br><span class="line">            log.<span class="title function_">error</span>(<span class="string">&quot;【微信网页授权】获取用户信息失败，&#123;&#125;&quot;</span>, e.<span class="title function_">getError</span>().<span class="title function_">getErrorMsg</span>());</span><br><span class="line">            <span class="keyword">throw</span> <span class="title class_">ExceptionUtils</span>.<span class="title function_">mpe</span>(e.<span class="title function_">getError</span>().<span class="title function_">getErrorMsg</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">前端接入</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、环境配置 main.js</span></span><br><span class="line"><span class="keyword">let</span> appid = &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="string">&#x27;wx0431d286df253cea&#x27;</span>,</span><br><span class="line">    <span class="attr">uat</span>: <span class="string">&#x27;wx58656f9344fbc048&#x27;</span>,</span><br><span class="line">    <span class="attr">prd</span>: <span class="string">&#x27;wx7899e3317bf82ab8&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> domain = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">switch</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;development&quot;</span>:</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">appid</span> = appid.<span class="property">test</span></span><br><span class="line">        domain = <span class="string">&quot;10.52.200.2:9011&quot;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;production&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> (location.<span class="property">href</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;test&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">appid</span> = appid.<span class="property">test</span></span><br><span class="line">          domain = <span class="string">&quot;shlife-test.zhongan.io&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (location.<span class="property">href</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;wxdat&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">appid</span> = appid.<span class="property">test</span></span><br><span class="line">          domain = <span class="string">&quot;wxdat.shanghailife.com.cn&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(location.<span class="property">href</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;wxpre&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">appid</span> = appid.<span class="property">uat</span></span><br><span class="line">          domain = <span class="string">&quot;wxpre.shanghailife.com.cn&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">appid</span> = appid.<span class="property">prd</span></span><br><span class="line">          domain = <span class="string">&quot;wx.shanghailife.com.cn&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">baseURL</span> = location.<span class="property">protocol</span> + <span class="string">&quot;//&quot;</span> + domain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、路由拦截 router.js</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!to.<span class="property">meta</span>.<span class="property">noAuth</span>) &#123;   <span class="comment">// 需要授权的页面</span></span><br><span class="line">        <span class="keyword">if</span> (_.<span class="title function_">isEmpty</span>(store.<span class="property">getters</span>.<span class="property">wechatUserInfo</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                !_.<span class="title function_">isEmpty</span>(store.<span class="property">getters</span>.<span class="property">openid</span>) &amp;&amp;</span><br><span class="line">                !_.<span class="title function_">isEmpty</span>(store.<span class="property">getters</span>.<span class="property">accessToken</span>)</span><br><span class="line">            ) &#123;</span><br><span class="line">                <span class="comment">// 存在 openid、accessToken 则已授权，判断是否过期，过期则刷新</span></span><br><span class="line">                store.<span class="title function_">dispatch</span>(<span class="string">&#x27;getUserInfo&#x27;</span>)</span><br><span class="line">                <span class="title function_">next</span>()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 跳转到授权页面</span></span><br><span class="line">                <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;currentUrl&#x27;</span>, to.<span class="property">fullPath</span>)</span><br><span class="line">                <span class="title function_">next</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;auth&#x27;</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、授权页面</span></span><br><span class="line">&#123;  </span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/auth&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;auth&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function"><span class="params">resolve</span> =&gt;</span> &#123; <span class="built_in">require</span>([<span class="string">&#x27;@/views/auth/index.vue&#x27;</span>], resolve) &#125;,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">noAuth</span>: <span class="literal">true</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">https</span>:<span class="comment">//open.weixin.qq.com/connect/oauth2/authorize?appid=$&#123;appid&#125;&amp;redirect_uri</span></span><br><span class="line">=$&#123;<span class="variable constant_">URI</span>&#125;&amp;response_type=code&amp;scope=$&#123;<span class="variable constant_">SCOPE</span>&#125;&amp;state=<span class="variable constant_">STATE</span>#wechat_redirect</span><br><span class="line"></span><br><span class="line">&lt;template&gt;&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;@/config&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> <span class="title class_">WechatService</span> <span class="keyword">from</span> <span class="string">&#x27;@/api/wechat&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title class_">WechatService</span>.<span class="title function_">auth</span>(config.<span class="property">WechatAuthCallbackUrl</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">if</span> (res.<span class="title function_">ok</span>()) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                  <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = res.<span class="property">data</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、授权 store：在vuex中进行授权和存储用户信息</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">WechatService</span> <span class="keyword">from</span> <span class="string">&#x27;@/api/wechat&#x27;</span></span><br><span class="line"><span class="keyword">import</span> localStorageUtil <span class="keyword">from</span> <span class="string">&#x27;@/utils/LocalStorageUtil&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">unionId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">openid</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">accessToken</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">wechatUserInfo</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">unionId</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">unionId</span> || localStorageUtil.<span class="title function_">get</span>(<span class="string">&#x27;unionId&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">openid</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">openid</span> || localStorageUtil.<span class="title function_">get</span>(<span class="string">&#x27;openid&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">accessToken</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">accessToken</span> || localStorageUtil.<span class="title function_">get</span>(<span class="string">&#x27;accessToken&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">wechatUserInfo</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">wechatUserInfo</span> || localStorageUtil.<span class="title function_">get</span>(<span class="string">&#x27;wechatUserInfo&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// 保存 userInfo，设置有效时间，默认30天</span></span><br><span class="line">    <span class="attr">saveWechatUserInfo</span>: <span class="function">(<span class="params">state, res</span>) =&gt;</span> &#123;</span><br><span class="line">        state.<span class="property">wechatUserInfo</span> = res</span><br><span class="line">        state.<span class="property">unionId</span> = res.<span class="property">unionId</span></span><br><span class="line">        state.<span class="property">openid</span> = res.<span class="property">openid</span></span><br><span class="line">        state.<span class="property">accessToken</span> = res.<span class="property">accessToken</span></span><br><span class="line">        localStorageUtil.<span class="title function_">set</span>(<span class="string">&#x27;unionId&#x27;</span>, res.<span class="property">unionId</span>)</span><br><span class="line">        localStorageUtil.<span class="title function_">set</span>(<span class="string">&#x27;openid&#x27;</span>, res.<span class="property">openid</span>)</span><br><span class="line">        localStorageUtil.<span class="title function_">set</span>(<span class="string">&#x27;accessToken&#x27;</span>, res.<span class="property">accessToken</span>)</span><br><span class="line">        localStorageUtil.<span class="title function_">set</span>(<span class="string">&#x27;wechatUserInfo&#x27;</span>, res, <span class="number">30</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 静默授权获取用户信息</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getUserInfo</span>(<span class="params">&#123; commit, getters &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> openid = getters.<span class="property">openid</span></span><br><span class="line">        <span class="keyword">const</span> token = getters.<span class="property">accessToken</span></span><br><span class="line">        <span class="keyword">if</span> (!_.<span class="title function_">isEmpty</span>(openid) &amp;&amp; !_.<span class="title function_">isEmpty</span>(token)) &#123;</span><br><span class="line">            <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title class_">WechatService</span>.<span class="title function_">getUserInfo</span>(openid, token)</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="title function_">ok</span>()) &#123;</span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;saveWechatUserInfo&#x27;</span>, res.<span class="property">data</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 初次授权获取用户信息</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getAuthUserInfo</span>(<span class="params">&#123; commit &#125;, &#123; code, state &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_.<span class="title function_">isEmpty</span>(code) &amp;&amp; !_.<span class="title function_">isEmpty</span>(state)) &#123;</span><br><span class="line">            <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title class_">WechatService</span>.<span class="title function_">getAuthUserInfo</span>(code, state)</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="title function_">ok</span>()) &#123;</span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;saveWechatUserInfo&#x27;</span>, res.<span class="property">data</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、自定义存储工具 localStorageUtil.js：用于设置保存有效期</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key, defaultValue</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">parse</span>(key, defaultValue)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, obj, expires</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (expires) &#123;</span><br><span class="line">          <span class="keyword">const</span> tmpTime = <span class="title function_">moment</span>().<span class="title function_">add</span>(expires, <span class="string">&#x27;days&#x27;</span>).<span class="title function_">format</span>(<span class="string">&#x27;YYYY-MM-DD&#x27;</span>)</span><br><span class="line">          <span class="keyword">const</span> handleObj = &#123; <span class="attr">expires</span>: tmpTime, <span class="attr">value</span>: obj &#125;</span><br><span class="line">          <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(handleObj))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (_.<span class="title function_">isObject</span>(obj)) &#123;</span><br><span class="line">              <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj))</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, obj)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">parse</span>(<span class="params">key, defaultValue</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key)</span><br><span class="line">      <span class="keyword">if</span> (_.<span class="title function_">isObject</span>(value)) &#123;</span><br><span class="line">          <span class="keyword">const</span> valueObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(value)</span><br><span class="line">          <span class="comment">// 有过期时间，判断是否过期：在现在时间之前，过期</span></span><br><span class="line">          <span class="keyword">if</span> (valueObj.<span class="property">expires</span>) &#123;</span><br><span class="line">              <span class="keyword">if</span> (<span class="title function_">moment</span>(valueObj.<span class="property">expires</span>).<span class="title function_">isBefore</span>(<span class="title function_">moment</span>(), <span class="string">&#x27;day&#x27;</span>)) &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="title function_">remove</span>(key)</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> valueObj.<span class="property">value</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 没有过期时间直接返回对象</span></span><br><span class="line">          <span class="keyword">return</span> valueObj</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 不是对象则返回值</span></span><br><span class="line">      <span class="keyword">return</span> value || defaultValue</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="分享-x2F-支付"><a href="#分享-x2F-支付" class="headerlink" title="分享&#x2F;支付"></a>分享&#x2F;支付</h2><blockquote>
<p>公众号的内嵌 H5 页面实现微信分享、支付等功能需要引入 <strong>JS-SDK</strong>，而且必须先注入配置信息让微信验证是否支持。vue 项目注意：1、路由必须使用 history 模式，因为各个页面需要不同的签名信息，而且安卓设备的微信会自动截取 # 后面的内容而无法分享，2、iOS 需要使用第一次进入页面的 URL 获取签名，安卓每次路由切换都重新配置签名，具体如下：</p>
</blockquote>
  <div align="center">
      <img src="/images/webchat/mode-skip.png" alt="页面跳转" width="100%">
  </div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">npm install axios weixin-js-sdk -S</span><br><span class="line"></span><br><span class="line"><span class="comment">// wxSetting.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> wx <span class="keyword">from</span> <span class="string">&#x27;weixin-js-sdk&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 初始化</span></span><br><span class="line">  wxConfig (callback) &#123;</span><br><span class="line">    <span class="comment">// 微信签名等配置数据需要从服务器获取 (url 参数需要编码)</span></span><br><span class="line">    <span class="keyword">let</span> url = <span class="built_in">encodeURIComponent</span>(location.<span class="property">href</span>.<span class="title function_">split</span>(<span class="string">&quot;#/&quot;</span>)[<span class="number">0</span>]);</span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">`/api/getShareSign?url=<span class="subst">$&#123;url&#125;</span>`</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 微信验证</span></span><br><span class="line">      <span class="keyword">const</span> &#123;appId, timestamp, nonceStr, signature&#125; = res.<span class="property">data</span></span><br><span class="line">      wx.<span class="title function_">config</span>(&#123;</span><br><span class="line">          <span class="attr">debug</span>: <span class="literal">true</span>,  <span class="comment">// 开启调试模式</span></span><br><span class="line">          appId,        <span class="comment">// 必填，公众号的唯一标识</span></span><br><span class="line">          timestamp,    <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">          nonceStr,     <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">          signature,    <span class="comment">// 必填，签名 </span></span><br><span class="line">          <span class="attr">jsApiList</span>: [  <span class="comment">// 必填，需要使用的接口列表</span></span><br><span class="line">              <span class="string">&#x27;updateAppMessageShareData&#x27;</span>, </span><br><span class="line">              <span class="string">&#x27;updateTimelineShareData&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;scanQRCode&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;chooseImage&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;uploadImage&#x27;</span></span><br><span class="line">          ]</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 验证成功：执行微信功能函数 share、scan</span></span><br><span class="line">      wx.<span class="title function_">ready</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          callback &amp;&amp; <span class="title function_">callback</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 验证失败</span></span><br><span class="line">      wx.<span class="title function_">error</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(err.<span class="property">errMsg</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 自定义分享</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; data 分享内容</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; fullPath 分享路径，传入 this.$route.fullPath</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="title function_">share</span>(<span class="params">data, fullPath</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;title, imgUrl, desc&#125; = data</span><br><span class="line">      <span class="keyword">let</span> link = location.<span class="property">protocol</span> + <span class="string">&#x27;//&#x27;</span> + location.<span class="property">host</span> + fullPath</span><br><span class="line">      <span class="comment">// 分享到朋友圈：link 不需要编码但必须加 http://</span></span><br><span class="line">      wx.<span class="title function_">updateTimelineShareData</span>(&#123;</span><br><span class="line">          title,   <span class="comment">// 分享标题</span></span><br><span class="line">          imgUrl,  <span class="comment">// 分享图标</span></span><br><span class="line">          link,    <span class="comment">// 分享链接，域名必须与当前页面对应的公众号安全域名一致</span></span><br><span class="line">          <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title class_">Toast</span>(<span class="string">&#x27;分享成功&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 分享给朋友</span></span><br><span class="line">      wx.<span class="title function_">updateAppMessageShareData</span>(&#123;</span><br><span class="line">          title,</span><br><span class="line">          desc,</span><br><span class="line">          link,</span><br><span class="line">          imgUrl,</span><br><span class="line">          <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">              <span class="title class_">Toast</span>(<span class="string">&#x27;分享成功&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 禁止微信分享</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desption</span> share(&#123; hideMenuItems: true &#125;, $route.fullPath)、hideOptionMenu()</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="title function_">hideOptionMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onBridgeReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">WeixinJSBridge</span>.<span class="title function_">call</span>(<span class="string">&quot;hideOptionMenu&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">WeixinJSBridge</span> === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;WeixinJSBridgeReady&quot;</span>, onBridgeReady, <span class="literal">false</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">attachEvent</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">attachEvent</span>(<span class="string">&quot;WeixinJSBridgeReady&quot;</span>, onBridgeReady);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">attachEvent</span>(<span class="string">&quot;onWeixinJSBridgeReady&quot;</span>, onBridgeReady);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">onBridgeReady</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 调用微信扫一扫接口</span></span><br><span class="line">  <span class="title function_">scan</span>(<span class="params"></span>)&#123;</span><br><span class="line">    wx.<span class="title function_">scanQRCode</span>(&#123;</span><br><span class="line">      <span class="attr">needResult</span>: <span class="number">0</span>,      <span class="comment">// 默认为 0，扫描结果由微信处理，1则直接返回扫描结果</span></span><br><span class="line">      <span class="attr">scanType</span>: [<span class="string">&quot;qrCode&quot;</span>,<span class="string">&quot;barCode&quot;</span>], <span class="comment">// 指定扫二维码还是一维码，默认二者都有</span></span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> result = res.<span class="property">resultStr</span>;  <span class="comment">// needResult 为 1 时，扫码返回的结果</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 图片上传</span></span><br><span class="line">  <span class="title function_">openCamera</span>(<span class="params"></span>)&#123;</span><br><span class="line">    wx.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">1</span>,              <span class="comment">// 默认9</span></span><br><span class="line">      <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>], <span class="comment">// 指定是原图还是压缩图，默认都有</span></span><br><span class="line">      <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>, <span class="string">&#x27;camera&#x27;</span>],      <span class="comment">// 指定来源是相册还是相机，默认都有</span></span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> localIds = res.<span class="property">localIds</span>;</span><br><span class="line">          wx.<span class="title function_">uploadImage</span>(&#123;</span><br><span class="line">              <span class="attr">localId</span>: localIds.<span class="title function_">toString</span>(),  <span class="comment">// 图片 ID</span></span><br><span class="line">              <span class="attr">isShowProgressTips</span>: <span class="number">1</span>,         <span class="comment">// 进度提示</span></span><br><span class="line">              <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123; &#125;,</span><br><span class="line">              <span class="attr">fail</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123; &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 微信支付：本质是对微信浏览器内置方法 weixinjsbridge.invoke() 的再次封装</span></span><br><span class="line">  <span class="title function_">wxPay</span>(<span class="params">options</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;appId, timeStamp, nonceStr, package, signType, paySign&#125; = options</span><br><span class="line">    wx.<span class="title function_">chooseWXPay</span>(&#123;</span><br><span class="line">        appId,</span><br><span class="line">        <span class="attr">timestamp</span>: timeStamp,  <span class="comment">// 支付签名时间戳，但新版支付后台返回 timeStamp</span></span><br><span class="line">        nonceStr,   <span class="comment">// 支付签名随机串</span></span><br><span class="line">        package,    <span class="comment">// 统一支付接口返回的参数值，提交格式如：prepay_id=\*\*\*</span></span><br><span class="line">        signType,   <span class="comment">// 签名方式，默认为&#x27;SHA1&#x27;，使用新版支付需传入&#x27;MD5&#x27;</span></span><br><span class="line">        paySign,    <span class="comment">// 支付签名</span></span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123; success &amp;&amp; <span class="title function_">success</span>() &#125;,</span><br><span class="line">        <span class="attr">cancel</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123; cancel &amp;&amp; <span class="title function_">cancel</span>(res) &#125;,  </span><br><span class="line">        <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123; error &amp;&amp; <span class="title function_">error</span>(res) &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="四、移动端支付"><a href="#四、移动端支付" class="headerlink" title="四、移动端支付"></a>四、移动端支付</h1><blockquote>
<p>通过宿主环境主要可分为 APP 支付、微信支付、小程序支付、浏览器 H5 支付等，常见支付方式及其场景如下：</p>
</blockquote>
  <div align="center">
      <img src="/images/mobile/payment.png" alt="支付方式" width="100%">
  </div>

<h2 id="APP-支付"><a href="#APP-支付" class="headerlink" title="APP 支付"></a>APP 支付</h2><ul>
<li><strong>前端工作</strong>：调用业务创建订单接口并获取订单 id、调用业务发起支付接口并获取支付信息、调用第三方支付提供的 SDK jsbridge 将支付信息传给第三方支付平台、成功调用 jsbridge 后就通过服务端轮询或 websocket 获取用户支付状态并然后更新页面。</li>
<li><strong>IAP 支付</strong>：In-App Purchase，即用户在 APP 内就能完成购买。IOS 强制使用有交易抽成的 AppStore，Android 需要开发 GooglePlay 等应用商店才能支持而但各个厂商不统一。</li>
<li><strong>第三方支付</strong>：跳转到支付宝等第三方 APP 才能完成支付行为，Android 大多数采用的方式。</li>
</ul>
  <div align="center">
      <img src="/images/mobile/IAP.png" alt="IAP" width="100%">
  </div>

  <div align="center">
      <img src="/images/mobile/otherpay.png" alt="第三方支付" width="100%">
  </div>


<h2 id="微信支付"><a href="#微信支付" class="headerlink" title="微信支付"></a>微信支付</h2><blockquote>
<p><a href="https://pay.weixin.qq.com/wiki/doc/api/index.html">微信支付平台开发文档</a>：付款码支付、JSAPI 支付、Native 支付、APP 支付、H5 支付、小程序支付、刷脸支付。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// H5 支付流程：配置支付目录、获取用户标示 openid、用户支付并获取预支付信息、调用微信 jsapi</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">wxpay</span> (params, callback)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">WeixinJSBridge</span> == <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// _onBridge: onBridgeReady(params, callback)</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">addEventListener</span>)&#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;WeixinJSBridgeReady&#x27;</span>, _onBridge, <span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">attachEvent</span>)&#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">attachEvent</span>(<span class="string">&#x27;WeixinJSBridgeReady&#x27;</span>, _onBridge); </span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">attachEvent</span>(<span class="string">&#x27;onWeixinJSBridgeReady&#x27;</span>, _onBridge);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">onBridgeReady</span>(params, callback);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onBridgeReady</span> (payParam, callback) &#123;   <span class="comment">// 预支付信息、支付回调函数</span></span><br><span class="line">    payParam = &#123;     </span><br><span class="line">        <span class="attr">appId</span>: <span class="string">&quot;wx2421b1c4370ec43b&quot;</span>,      <span class="comment">// 公众号 id，由商户传入 </span></span><br><span class="line">        <span class="attr">timeStamp</span>: <span class="string">&quot;1395712654&quot;</span>,          <span class="comment">// 时间戳，自1970年以来的秒数   </span></span><br><span class="line">        <span class="attr">nonceStr</span>: <span class="string">&quot;e61463f8efa94090&quot;</span>,     <span class="comment">// 随机字符串  </span></span><br><span class="line">        <span class="attr">package</span>: <span class="string">&quot;prepay_id=u802345jgf&quot;</span>,  <span class="comment">// 订单详情扩展字符串</span></span><br><span class="line">        <span class="attr">signType</span>: <span class="string">&quot;MD5&quot;</span>,                  <span class="comment">// 微信签名方式</span></span><br><span class="line">        <span class="attr">paySign</span>: <span class="string">&quot;70EA570631E4BB79&quot;</span>       <span class="comment">// 微信签名</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">WeixinJSBridge</span>.<span class="title function_">invoke</span>(<span class="string">&#x27;getBrandWCPayRequest&#x27;</span>, payParam, <span class="keyword">function</span>(<span class="params">res</span>)&#123;  </span><br><span class="line">        <span class="title function_">callback</span>(res)</span><br><span class="line">        <span class="keyword">switch</span> (res.<span class="property">err_msg</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;get_brand_wcpay_request:ok&quot;</span>:</span><br><span class="line">                <span class="comment">// 支付成功</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;get_brand_wcpay_request:fail&quot;</span>:</span><br><span class="line">                <span class="comment">// 支付失败</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;get_brand_wcpay_request:cancel&quot;</span>:</span><br><span class="line">                <span class="comment">// 取消支付</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 小程序支付流程：获取 openid、用户发起支付并获取预支付信息、小程序调用 wx.requestPayment</span></span><br><span class="line">wx.<span class="title function_">requestPayment</span>(&#123; </span><br><span class="line">    ...payParam, </span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;&#125;, </span><br><span class="line">    <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;&#125;, </span><br><span class="line">    <span class="attr">complete</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="H5-支付"><a href="#H5-支付" class="headerlink" title="H5 支付"></a>H5 支付</h2><blockquote>
<p>从手机浏览器直接唤起微信或支付宝进行支付，也通过生成二维码让用户扫描支付。注意嵌入到小程序的 h5 页面不支持 h5 原生支付，但可以通过 window.wx.miniProgram.navigateTo 跳转到小程序页面支付。以下为拉起微信支付的流程图：</p>
</blockquote>
  <div align="center">
      <img src="/images/mobile/h5pay.png" alt="H5 支付" width="100%">
  </div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 中间页</span></span><br><span class="line"><span class="comment"> * https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?</span></span><br><span class="line"><span class="comment"> prepay_id=wx162128390473563d952e4f371ca7d70000&amp;package=2985141145&amp;</span></span><br><span class="line"><span class="comment"> redirect_url=https%3A%2F%2Fwww.ggl.cn%2Feggl%2Fh5%2Fsale%2Fpay%2Fresult</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> prepay_id、package：支付相关参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> redirect_url：支付成功、取消、超时返回浏览器要打开的页面地址</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> deeplink:</span></span><br><span class="line"><span class="comment"> * weixin://wap/pay?prepayid%3Dwx162128390473563d952e4f371ca7d70000</span></span><br><span class="line"><span class="comment"> &amp;package=2985141145&amp;noncestr=1623850119&amp;sign=bfc799bb3c643e44c0a334b53</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">goWechatPayH5</span> () &#123;</span><br><span class="line">    <span class="keyword">let</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> cur_url = <span class="built_in">encodeURI</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> + <span class="string">&#x27;?openLayer=1&#x27;</span>)</span><br><span class="line">    <span class="title function_">axios</span>(&#123; </span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(prames)</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> mweb_url = res.<span class="property">data</span>.<span class="property">mweb_url</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = mweb_url + <span class="string">&#x27;&amp;redirect_url=&#x27;</span> + cur_url;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">400</span>) &#123;</span><br><span class="line">            _this.$toast(res.<span class="property">error</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>















]]></content>
      <categories>
        <category>移动端开发</category>
      </categories>
      <tags>
        <tag>移动端开发</tag>
      </tags>
  </entry>
  <entry>
    <title>移动端开发</title>
    <url>/2019/06/24/8-1-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="一、混合开发"><a href="#一、混合开发" class="headerlink" title="一、混合开发"></a>一、混合开发</h1><blockquote>
<p>即跨平台应用开发：利用单个共享代码库和用户界面为 Android、iOS 开发移动应用程序，为 Windows、macOS 开发桌面应用程序。</p>
</blockquote>
<h2 id="开发模式"><a href="#开发模式" class="headerlink" title="开发模式"></a>开发模式</h2><ul>
<li>应用开发模式<ul>
<li><strong>Native App</strong>：传统的原生 APP 开发模式。Android 基于 Java 语言并在底层调用 Google API，IOS 基于 objective-c&#x2F;swift 语言并在底层调用 App API。支持离线运行、支持设备所有功能、用户体验最好，但是开发成本高、更新版本时需要用户重新下载安装。</li>
<li><strong>Web App</strong>：网页开发模式，即将 SPA 模式等开发出的 Html5 页面部署在服务器并让用户使用手机浏览器访问。开发成本较低、跨平台开发、用户可直接访问最新版本，但是用户体验最差、不能调用相机等系统功能。</li>
<li><strong>Hybrid App</strong>：混合开发模式，即使用原生语言编写功能性的应用外壳，然后在 webview 内嵌展示性的 H5 页面，实现时由 Native 通过 JSBridge 等方法提供统一 API 并通过 Html5、JS 实现具体逻辑。兼具 Native 原生体验和 H5 跨平台开发和快速迭代的优势，但是对网络要求较高。</li>
</ul>
</li>
<li>混合开发方案<ul>
<li><strong>Capacitor&#x2F;Cordova&#x2F;Phonegap</strong>：第一代技术，主要通过 webview 内嵌 H5 页面。</li>
<li><strong>Ionic&#x2F;ReactNative&#x2F;Weex&#x2F;NativeScript</strong>：第二代技术，通过一种语言触发原生平台的渲染引擎而实现原生体验，比如 ReactNative 结合 JS 和原生语法实现跨平台。</li>
<li><strong>Flutter</strong>：未来趋势，通过绘图引擎和 Dart 语言实现了高性能，但没有大规模应用。</li>
</ul>
</li>
</ul>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Mac 下打开目录</span></span><br><span class="line"><span class="title class_">Finder</span>、command + shift + G、输入回车</span><br><span class="line"></span><br><span class="line"><span class="comment">// 环境变量配置</span></span><br><span class="line">vim ~/.<span class="property">bash_profile</span>          </span><br><span class="line">i、编辑内容、esc 退出、:wq 保存</span><br><span class="line">source ~/.<span class="property">bash_profile</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、安装 node 版本的切换工具</span></span><br><span class="line">cd ~/</span><br><span class="line">git clone <span class="attr">https</span>:<span class="comment">//github.com/nvm-sh/nvm.git</span></span><br><span class="line">cd nvm</span><br><span class="line">./install.<span class="property">sh</span>  <span class="comment">// 等待执行成功：不成功时可以则执行几次</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ~/.bash_profile</span></span><br><span class="line"># nvm</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">NVM_DIR</span>=<span class="string">&quot;$HOME/.nvm&quot;</span></span><br><span class="line">[ -s <span class="string">&quot;$NVM_DIR/nvm.sh&quot;</span> ] &amp;&amp; \. <span class="string">&quot;$NVM_DIR/nvm.sh&quot;</span></span><br><span class="line">[ -s <span class="string">&quot;$NVM_DIR/bash_completion&quot;</span> ] &amp;&amp; \. <span class="string">&quot;$NVM_DIR/bash_completion&quot;</span></span><br><span class="line"># node</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">NVM_NODEJS_ORG_MIRROR</span>=<span class="attr">https</span>:<span class="comment">//npmmirror.com/mirrors/node/</span></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">NVM_IOJS_ORG_MIRROR</span>=<span class="attr">https</span>:<span class="comment">//npmmirror.com/mirrors/iojs/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ~/.zshrc</span></span><br><span class="line">source ~/.<span class="property">bash_profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 常用命令</span></span><br><span class="line">nvm ls-remote               <span class="comment">// 查看 node 可用版本  </span></span><br><span class="line">nvm install <span class="number">14.19</span><span class="number">.3</span>         <span class="comment">// 安装 node 指定版本</span></span><br><span class="line">nvm install --lts           <span class="comment">// 安装 node 最新稳定版本</span></span><br><span class="line">nvm uninstall <span class="number">11.15</span><span class="number">.0</span>       <span class="comment">// 卸载 node 指定版本</span></span><br><span class="line">nvm alias <span class="keyword">default</span> <span class="number">11.15</span><span class="number">.0</span>   <span class="comment">// 设置 node 默认版本</span></span><br><span class="line">nvm use <span class="number">11.15</span><span class="number">.0</span>             <span class="comment">// 使用 node 指定版本</span></span><br><span class="line">nvm list                    <span class="comment">// 查看 node 已安装版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// node 版本安装对应 cnpm</span></span><br><span class="line">npm install cnpm@<span class="number">7.1</span><span class="number">.0</span> -g --registry=<span class="attr">https</span>:<span class="comment">//registry.npm.taobao.org</span></span><br><span class="line">npm i cnpm -g --registry=<span class="attr">https</span>:<span class="comment">//registry.npmmirror.com/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 2、项目搭建工具安装</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span> ionic5、ionic6 版本安装分别通过 ionic、<span class="doctag">@ionic</span>/cli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span> npm：旧版本镜像已经弃用 http://registry.npm.taobao.org</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">npm i cnpm -g --registry=<span class="attr">https</span>:<span class="comment">//registry.npmmirror.com/</span></span><br><span class="line">cnpm i -g @angular/cli @ionic/cli cordova typescript</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 3、android 环境配置</span></span><br><span class="line"><span class="comment"> * Java 工具包 JDK：jdk-8u281-macosx-x64.dmg </span></span><br><span class="line"><span class="comment"> * 安装：android 工具包 android-sdk、构建工具 gradle</span></span><br><span class="line"><span class="comment"> * gradle 手动安装：gradle.zip 解压缩后拖至 /user/local/Caskroom</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> android studio：Android 集成开发工具</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> jdk：Java 开发工具包</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> <span class="variable">android</span>-sdk：Android 开发工具包</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> gradle：项目构建工具</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">brew install android-sdk gradle</span><br><span class="line">brew list android-sdk</span><br><span class="line"></span><br><span class="line"><span class="comment">// .bash_profile</span></span><br><span class="line"># sdk</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">ANDROID_HOME</span>=<span class="regexp">/usr/</span>local/<span class="title class_">Caskroom</span>/android-sdk</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">PATH</span>=<span class="attr">$PATH</span>:$ANDROID_HOME/tools</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">PATH</span>=<span class="attr">$PATH</span>:$ANDROID_HOME/platform-tools</span><br><span class="line"># gradle</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">GRADLE_HOME</span>=<span class="regexp">/usr/</span>local/<span class="title class_">Caskroom</span>/gradle-<span class="number">6.7</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">PATH</span>=<span class="attr">$PATH</span>:$GRADLE_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验</span></span><br><span class="line">java -version</span><br><span class="line">adb version</span><br><span class="line">gradle -version</span><br></pre></td></tr></table></figure>


<h2 id="Ionic-Capacitor-Angular"><a href="#Ionic-Capacitor-Angular" class="headerlink" title="Ionic + Capacitor + Angular"></a>Ionic + Capacitor + Angular</h2><blockquote>
<p>Ionic&#x2F;Angular 负责实现 H5 页面，Capacitor 则负责将 H5 应用编译打包为原生应用 (Android apk、iOS ipa)。</p>
</blockquote>
<ul>
<li><strong>Ionic</strong>：用于开发移动应用的开源 H5 框架，提供了移动端常用的组件库。ionic6 新增了 capacitor 调用原生功能的方式，虽然使用方便但是官方接口不多，之前版本只能集成 cordova。</li>
<li><strong>Capacitor&#x2F;Cordova&#x2F;Phonegap</strong>：不仅支持将 H5 代码打包为原生应用，还提供了 JS 调用原生设备功能的接口。Capacitor 是一个由 Ionic 团队开发维护的跨平台的应用程序容器，它对之前的 Cordova&#x2F;Phonegap 作出了优化并兼容了 Cordova 插件，现在已经成为 ionic4+ 项目默认的打包工具。</li>
<li><strong>Vue&#x2F;React&#x2F;Angular</strong>：前端 JS 框架，类似于 JQuery、BootStrap、Three.js 等。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> Ionic Angular 项目构建：ng v 查看版本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> blank/tabs/sidemenu：空项目、带选项卡、带侧边栏</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 手机浏览器调试：</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">ionic start ionic-angular tabs/blank/sidemenu</span><br><span class="line">ionic serve    <span class="comment">// 电脑运行：电脑端 localhost 访问</span></span><br><span class="line">ionic build    <span class="comment">// 编译打包：生成文件夹 www</span></span><br><span class="line">ionic serve --external --host=<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>   <span class="comment">// 手机浏览器调试</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Capacitor 构建应用</span></span><br><span class="line">ionic capacitor add android     <span class="comment">// 添加安卓平台</span></span><br><span class="line">ionic capacitor copy android    <span class="comment">// 项目更新同步到安卓</span></span><br><span class="line">ionic capacitor run android</span><br><span class="line">ionic capacitor build android</span><br><span class="line">npm i @capacitor/core -D        <span class="comment">// 项目创建时已集成 capacitor 则不安装 </span></span><br><span class="line"><span class="comment">// Capacitor 添加原生插件：页面 ts 文件引用如下</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Camera</span>, <span class="title class_">CameraResultType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@capacitor/camera&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">takePhoto</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> photo = <span class="keyword">await</span> <span class="title class_">Camera</span>.<span class="title function_">getPicture</span>(&#123;</span><br><span class="line">        <span class="attr">quality</span>: <span class="number">90</span>,</span><br><span class="line">        <span class="attr">allowEditing</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">resultType</span>: <span class="title class_">CameraResultType</span>.<span class="property">Uri</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">imgSrc</span> = photo.<span class="property">webPath</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// cordova 构建应用</span></span><br><span class="line">ionic integrations disable capacitor  <span class="comment">// 禁用 capacitor</span></span><br><span class="line">ionic cordova platform add android    <span class="comment">// 先删除 android 文件夹</span></span><br><span class="line">ionic cordova plugin add cordova-plugin-camera</span><br><span class="line">ionic cordova run/build android</span><br><span class="line">npm i @awesome-cordova-plugins/camera   <span class="comment">// 相机插件</span></span><br><span class="line">npm i @awesome-cordova-plugins/core     <span class="comment">// 打包时需要的依赖</span></span><br><span class="line"><span class="comment">// app.module.ts：全局引入服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Camera</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@awesome-cordova-plugins/camera/ngx&#x27;</span>;</span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">providers</span>: [..., <span class="title class_">Camera</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// home.ts：页面引用</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">takePhoto</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> photo = <span class="keyword">await</span> <span class="title class_">Camera</span>.<span class="title function_">getPicture</span>(&#123;</span><br><span class="line">        <span class="attr">quality</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="attr">mediaType</span>: <span class="title class_">Camera</span>.<span class="property">MediaType</span>.<span class="property">PICTURE</span>,</span><br><span class="line">        <span class="attr">encodingType</span>: <span class="title class_">Camera</span>.<span class="property">EncodingType</span>.<span class="property">JPEG</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span>  目录解析</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span>  android：ionic capacitor add android</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span>  www：ionic build</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">├── e2e            <span class="comment">// ionic 端对端测试文件</span></span><br><span class="line">├── platforms      <span class="comment">// android/ios/pwa/...</span></span><br><span class="line">├── plugins        <span class="comment">// capacitor/cordova 插件文件夹</span></span><br><span class="line">├── www            <span class="comment">// ionic 打包生成目录</span></span><br><span class="line">├── src            <span class="comment">// ionic 开发工作目录</span></span><br><span class="line">│   ├── app           <span class="comment">// 应用根目录（组件、页面、服务、模块等）</span></span><br><span class="line">│   ├── assets        <span class="comment">// 资源目录（图片、js 框架等静态文件）</span></span><br><span class="line">│   ├── theme         <span class="comment">// 主题文件（设置主题信息的 scss 文件）</span></span><br><span class="line">│   ├── environments  <span class="comment">// 针对不同环境的构建配置选项 </span></span><br><span class="line">│   ├── index.<span class="property">html</span>    <span class="comment">// 主页面</span></span><br><span class="line">│   ├── main.<span class="property">ts</span>       <span class="comment">// 入口文件</span></span><br><span class="line">│   ├── polyfills.<span class="property">ts</span>  <span class="comment">// 兼容不同浏览器的原生 API</span></span><br><span class="line">│   └── karma.<span class="property">conf</span>.<span class="property">js</span>、test.<span class="property">js</span>   <span class="comment">// 测试相关配置</span></span><br><span class="line">│</span><br><span class="line">├── config.<span class="property">xml</span>     <span class="comment">// 打包成 app 的配置文件</span></span><br><span class="line">├── package.<span class="property">json</span>   <span class="comment">// 管理项目的元数据和依赖</span></span><br><span class="line">├── angular.<span class="property">json</span>   <span class="comment">// angular 配置文件</span></span><br><span class="line">├── tsconfig.<span class="property">json</span>  <span class="comment">// typescript 配置文件</span></span><br><span class="line">├── tslint.<span class="property">json</span>    <span class="comment">// 格式化和校验文件</span></span><br><span class="line">└── ionic.<span class="property">config</span>.<span class="property">json</span>、ionic.<span class="property">starter</span>.<span class="property">json</span> <span class="comment">// ionic 配置文件</span></span><br></pre></td></tr></table></figure>

<h2 id="Ionic-Vue"><a href="#Ionic-Vue" class="headerlink" title="Ionic + Vue"></a>Ionic + Vue</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br><span class="line">vue create ionic-vue</span><br><span class="line">cd ionic-vue</span><br><span class="line">npm run serve</span><br><span class="line"></span><br><span class="line">npm install @ionic/core @ionic/vue vue-router</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">IonicVue</span> <span class="keyword">from</span> <span class="string">&#x27;@ionic/vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@ionic/core/css/core.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@ionic/core/css/ionic.bundle.css&#x27;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;       <span class="comment">// 阻止 vue 启动时生成生产提示</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">ignoredElements</span> = [<span class="regexp">/^ion-/</span>]  <span class="comment">// 忽略 vue 之外的自定义元素</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">IonicVue</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// HelloWorld.vue：通过 ionic UI 组件重写</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">ion-app</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ion-header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ion-toolbar</span> <span class="attr">color</span>=<span class="string">&quot;primary&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ion-title</span>&gt;</span>Hello, Ionic!<span class="tag">&lt;/<span class="name">ion-title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ion-toolbar</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ion-header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ion-content</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ion-card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ion-card-header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ion-card-subtitle</span>&gt;</span>Isn&#x27;t it great?<span class="tag">&lt;/<span class="name">ion-card-subtitle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ion-card-title</span>&gt;</span>Look at this view!<span class="tag">&lt;/<span class="name">ion-card-title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ion-card-header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ion-card-content</span>&gt;</span>it does look fairly cold.<span class="tag">&lt;/<span class="name">ion-card-content</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ion-card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ion-app</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Ionic-React"><a href="#Ionic-React" class="headerlink" title="Ionic + React"></a>Ionic + React</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install create-react-app -g</span><br><span class="line">create-react-app ionic-react</span><br><span class="line">cd ionic-react</span><br><span class="line">npm start</span><br><span class="line">npm install @ionic/react react-router react-router-dom</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@ionic/core/css/core.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@ionic/core/css/ionic.bundle.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// App.js </span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">IonApp</span>,</span><br><span class="line">  <span class="title class_">IonHeader</span>,</span><br><span class="line">  <span class="title class_">IonToolbar</span>,</span><br><span class="line">  <span class="title class_">IonContent</span>,</span><br><span class="line">  <span class="title class_">IonTitle</span>,</span><br><span class="line">  <span class="title class_">IonCard</span>,</span><br><span class="line">  <span class="title class_">IonCardHeader</span>,</span><br><span class="line">  <span class="title class_">IonCardTitle</span>,</span><br><span class="line">  <span class="title class_">IonCardSubtitle</span>,</span><br><span class="line">  <span class="title class_">IonCardContent</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ionic/react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">IonApp</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">IonHeader</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">IonToolbar</span> <span class="attr">color</span>=<span class="string">&quot;primary&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">IonTitle</span>&gt;</span>Hello, Ionic!<span class="tag">&lt;/<span class="name">IonTitle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">IonToolbar</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">IonHeader</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">IonContent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">IonCard</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">IonCardHeader</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">IonCardSubtitle</span>&gt;</span>Isn&#x27;t it great?<span class="tag">&lt;/<span class="name">IonCardSubtitle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">IonCardTitle</span>&gt;</span>Look at this view!<span class="tag">&lt;/<span class="name">IonCardTitle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">IonCardHeader</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">IonCardContent</span>&gt;</span>it does look fairly cold.<span class="tag">&lt;/<span class="name">IonCardContent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">IonCard</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">IonContent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">IonApp</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>


<h1 id="二、适配方案"><a href="#二、适配方案" class="headerlink" title="二、适配方案"></a>二、适配方案</h1><blockquote>
<p>让页面能在不同尺寸和分辨率的移动设备上尽可能的实现合理展示，设计图都是 2 倍的，这是因为页面中除了字体是矢量图而大部分都是位图。如果 1px 宽高的盒子里放入 1px 宽高的图片则图片会失真，因为在移动端渲染时是用 4px 渲染。</p>
</blockquote>
<ul>
<li><strong>设备像素</strong>：物理像素，通常指设备的分辨率。单位 dp，是设备能控制显示的最小单位。主要特点是：同一个设备的 1dp 长度是固定不变的、DPR 设备像素比取决于是否高清等屏幕特性和缩放比例。页面放大时内容减少是因为 1px 等于更多的设备像素。</li>
<li><strong>CSS 像素</strong>：逻辑像素，主要用于精确度量浏览器的 Web 页面。单位 px，是独立于设备而用于开发的抽象单位。主要特点是：改变大小的场景有缩放屏幕、更换设备。同样代码在不同分辨率的设备中显示一致是因为移动设备根据各自像素比转换成了设备像素。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设备判断：微信、支付宝、移动端、Ios、Android</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">isWechat</span>: navigator.<span class="property">userAgent</span>.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&quot;micromessenger&quot;</span>) &gt; -<span class="number">1</span>,</span><br><span class="line">  <span class="attr">isAlipay</span>: navigator.<span class="property">userAgent</span>.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&quot;alipay&quot;</span>) &gt; -<span class="number">1</span>,  </span><br><span class="line">  isMobile = <span class="regexp">/Android|webOS|iPhone|iPod|BlackBerry/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>),</span><br><span class="line">  <span class="attr">isIOS</span>: <span class="regexp">/iPhone|iPad|iPod/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>),</span><br><span class="line">  <span class="attr">isAndroid</span>: <span class="regexp">/Android/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用360浏览器的极速模式 (webkit)  </span></span><br><span class="line">&lt;meta name=<span class="string">&quot;renderer&quot;</span> content=<span class="string">&quot;webkit&quot;</span> /&gt;</span><br><span class="line"><span class="comment">// 优先使用 IE 最新版本和 Chrome  </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=EDGE, chrome=1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">// 页面窗口自动调整到设备宽度，并禁止用户缩放页面 (scale) </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, height=device-height, </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">// 使用全屏模式运行，仅针对 ios safari  </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-capable&quot;</span> <span class="attr">content</span>=<span class="string">&quot;yes&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">// 设置顶端状态栏背景为灰色半透明，仅针对 ios safari  </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> <span class="attr">content</span>=<span class="string">&quot;black-translucent&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">// windows phone 点击无高光 </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;msapplication-tap-highlight&quot;</span> <span class="attr">content</span>=<span class="string">&quot;no&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">// 关闭电话号码和邮箱的自动识别  </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;format-detection&quot;</span> <span class="attr">content</span>=<span class="string">&quot;telephone=no, email=no&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>


<h2 id="Viewport-缩放"><a href="#Viewport-缩放" class="headerlink" title="Viewport 缩放"></a>Viewport 缩放</h2><ul>
<li><strong>Viewport</strong>：浏览器上用来显示网页的部分区域，是手机浏览器的实际宽度。注意移动设备默认的是布局视口，但是移动端开发时需要的是理想视口，视口控制通过只对移动端有效的 meta 实现：设备宽度 &#x3D; 页面宽度 &#x3D; 浏览器视口宽度。</li>
<li><strong>浏览器宽度</strong>：PC 端网站都是以浏览器窗口(设备屏幕) 作为视口进行布局，但是手机浏览器的实际宽度默认比手机屏幕宽，手机浏览器内部的宽度始终是本身 viewport 而无论手机宽度是 320px&#x2F;640px。手机浏览器的设计页面为了让浏览桌面端网页时显示正常一般基于 960px，但这样会使手机浏览器出现横向滚动条，所以移动端浏览器会自动将视口缩放到移动端窗口的大小，网页内容看起来被压扁而不容易观看。可简单理解为：<strong>当浏览器宽度小于 980 时，viewport 宽度为980，大于 980 时则和 viewport 宽度一致</strong>。</li>
<li>分类：<strong>布局视口</strong> (手机浏览器的实际区域，用于计算 CSS 页面布局)、<strong>视觉视口</strong> (用户当前看到的区域，放大页面时内容减少但并不会受影响)、<strong>理想视口</strong> (移动设备的屏幕区域，它以 CSS 单位计算并与设备的物理宽高无关)。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 针对不同屏幕分辨率的手机设置等比例缩放。简单方便，但是 PC 端可能会界面变形、像素失真。</span></span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, height=device-height, </span></span><br><span class="line"><span class="string">  initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>


<h2 id="Responsive-响应式"><a href="#Responsive-响应式" class="headerlink" title="Responsive 响应式"></a>Responsive 响应式</h2><blockquote>
<p>设计理念通过媒体查询根据不同的屏幕分辨率来进行适配，从而在不同设备不同分辨率下都有良好的用户体验，一般通过媒体查询设置移动端宽度。缺点是 无法覆盖全部分辨率、代码量大且维护性难、安卓机型问题较多，一般只适合简单的资讯类页面。</p>
</blockquote>
  <div align="center">
      <img src="/images/mobile/Responsive.png" alt="flex 布局" width="100%">
  </div>

  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 法一 */</span> </span><br><span class="line">link media=&quot;(<span class="attribute">max-width</span>:<span class="number">480px</span>)<span class="string">&quot; href=&quot;</span>mobile.css<span class="string">&quot;</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">/* 法二 */ </span></span><br><span class="line"><span class="string">@media all and (orientation :landscape) &#123;  /* 横屏 */  &#125; </span></span><br><span class="line"><span class="string">@media all and (orientation :portrait) &#123;  /* 竖屏 */  &#125;</span></span><br><span class="line"><span class="string">@media screen and (max-width: 500px) &#123;  </span></span><br><span class="line"><span class="string">   body &#123; background: black &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="Adaptive-自适应"><a href="#Adaptive-自适应" class="headerlink" title="Adaptive 自适应"></a>Adaptive 自适应</h2><blockquote>
<p>使容器子元素的宽高能够最合理的方式填充空间。</p>
</blockquote>
<ul>
<li><strong>百分比布局</strong>：宽度自适应而实现在不同的分辨率下都能达到适配，但缺点是需要根据确定父级元素计算。width、height 等大多相对于直接父元素。border-radius、translate、background-size 等相对于自身。</li>
<li><strong>vw、vh 布局</strong>：指定相对视口的宽高实现宽高自适应，单位转换方便。但是缺点是单位换算时可能出现小数、一些低版本手机不支持。</li>
<li><strong>rem 布局</strong>：通过字体自适应解决移动端适配屏幕尺寸问题，只适用于固定尺寸，但是不能兼容所有终端，而且字号在不同屏幕上的绝对尺寸不一致而不符合用户习惯。实现原理是通过媒体查询设置根元素的 font-size、通过 js 读取屏幕宽度计算并设置根元素的 font-size。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过媒体查询实现移动端字体的自适应</span></span><br><span class="line">@media screen and (min-<span class="attr">width</span>: 375px)&#123;</span><br><span class="line">  html &#123; font-<span class="attr">size</span>: <span class="number">14.</span>0625px; &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-<span class="attr">width</span>: 360px)&#123;</span><br><span class="line">  html &#123; font-<span class="attr">size</span>: <span class="number">13.</span>5px;  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-<span class="attr">width</span>: 320px)&#123;</span><br><span class="line">  html &#123; font-<span class="attr">size</span>: 12px; &#125;</span><br><span class="line">&#125;</span><br><span class="line">html &#123;</span><br><span class="line">  font-<span class="attr">size</span>: 16px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Js 动态设置 rem：根据设计图 640 分辨率封装 rem.js，网上优化版 flexible.js</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params">doc, win</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> docEl = doc.<span class="property">documentElement</span>,</span><br><span class="line">    reEvt = <span class="string">&#x27;orientationchange&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span> ? <span class="string">&#x27;orientationchange&#x27;</span>:<span class="string">&#x27;resize&#x27;</span>,</span><br><span class="line">    recalc = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取屏幕宽度</span></span><br><span class="line">        <span class="keyword">var</span> clientWidth = docEl.<span class="property">clientWidth</span>;</span><br><span class="line">        <span class="keyword">if</span> (!clientWidth) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (clientWidth &gt;= <span class="number">640</span>) &#123;</span><br><span class="line">            docEl.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&#x27;100px&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 设置 html 的字体大小：clientWidth/(640/100)</span></span><br><span class="line">            docEl.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="number">100</span> * (clientWidth / <span class="number">640</span>) + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="keyword">if</span> (!doc.<span class="property">addEventListener</span>) <span class="keyword">return</span>;</span><br><span class="line">win.<span class="title function_">addEventListener</span>(reEvt, recalc, <span class="literal">false</span>);</span><br><span class="line">doc.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, recalc, <span class="literal">false</span>);</span><br><span class="line">&#125;)(<span class="variable language_">document</span>, <span class="variable language_">window</span>);</span><br></pre></td></tr></table></figure>
<h2 id="vue-方案"><a href="#vue-方案" class="headerlink" title="vue 方案"></a>vue 方案</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue-cli3 项目通过 vw 实现移动端适配，安装插件 npm i postcss-px-to-viewport -D</span></span><br><span class="line"><span class="comment">// postcss.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;autoprefixer&#x27;</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">&#x27;postcss-px-to-viewport&#x27;</span>: &#123; </span><br><span class="line">      <span class="attr">viewportWidth</span>: <span class="number">750</span>,    <span class="comment">// 视窗宽度，对应设计稿的宽度，一般是 750 </span></span><br><span class="line">      <span class="attr">viewportHeight</span>: <span class="number">1334</span>,  <span class="comment">// 视窗高度，根据 750 设备的宽度来指定，一般指定 1334</span></span><br><span class="line">      <span class="attr">unitPrecision</span>: <span class="number">3</span>,      <span class="comment">// 指定`px`转换为视窗单位值的小数位数（很多时候无法整除） </span></span><br><span class="line">      <span class="attr">viewportUnit</span>: <span class="string">&#x27;vw&#x27;</span>,    <span class="comment">// 指定需要转换成的视窗单位，建议使用 vw </span></span><br><span class="line">      <span class="attr">selectorBlackList</span>: [<span class="string">&#x27;.ignore&#x27;</span>, <span class="string">&#x27;.hairlines&#x27;</span>], <span class="comment">// 指定不转换为视窗单位的类</span></span><br><span class="line">      <span class="attr">minPixelValue</span>: <span class="number">1</span>,      <span class="comment">// 小于或等于`1px`不转换为视窗单位</span></span><br><span class="line">      <span class="attr">mediaQuery</span>: <span class="literal">false</span>      <span class="comment">// 允许在媒体查询中转换`px` </span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、Flex-布局"><a href="#三、Flex-布局" class="headerlink" title="三、Flex 布局"></a>三、Flex 布局</h1><blockquote>
<p>如果想让一个盒子变成弹性盒子可以用 <code>display: flex</code>，弹性盒子中有主轴(横轴row) 和副轴(纵轴column)，可以根据需要设置盒子的容器(父元素)和项目(子元素)。</p>
</blockquote>
<h2 id="基础属性"><a href="#基础属性" class="headerlink" title="基础属性"></a>基础属性</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 容器属性</span></span><br><span class="line"><span class="selector-class">.parent</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 元素排列方向(左右和上下)，切换主副轴</span></span><br><span class="line">  <span class="attribute">flex-direction</span>: row | row-reverse | column | column-reverse;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是否换行：reverse 往上一行换行</span></span><br><span class="line">  <span class="attribute">flex-wrap</span>: nowrap | wrap | wrap-reverse;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 复合属性，无顺序关系</span></span><br><span class="line">  <span class="attribute">flex-flow</span>: flex-direction flex-wrap; </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 副轴上(即子项垂直) 的对齐方式</span></span><br><span class="line">  <span class="attribute">align-items</span>: stretch | flex-start | flex-end | center | baseline;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 主轴上(即子项水平) 的对齐方式</span></span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start | flex-end | center | space-between | space-around;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 多行垂直(副轴) 对齐方式, 默认 stretch</span></span><br><span class="line">  <span class="attribute">align-content</span>: flex-start | flex-end | center | space-between | space-around;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 项目属性</span></span><br><span class="line"><span class="selector-class">.child</span>&#123;</span><br><span class="line">  <span class="comment">// 定义排列顺序, 数字越大越靠后(可为负值)</span></span><br><span class="line">  <span class="attribute">order</span>: number;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义放大比例 (单行有多余空间时)</span></span><br><span class="line">  <span class="attribute">flex-grow</span>: number;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义缩小比例 (单行空间不足时)    </span></span><br><span class="line">  <span class="attribute">flex-shrink</span>: number;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置主轴上项目宽度(建议代替宽度)   </span></span><br><span class="line">  <span class="attribute">flex-basis</span>: %/px/rem;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 前三者复合属性，默认0 1 auto; </span></span><br><span class="line">  <span class="attribute">flex</span>: grow [shrink] [basis];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义项目自己的对齐方式，可覆盖 align-items</span></span><br><span class="line">  <span class="attribute">align-self</span>: stretch | flex-start | flex-end | center | baseline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="布局实例"><a href="#布局实例" class="headerlink" title="布局实例"></a>布局实例</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// div.box、span.item</span></span><br><span class="line"><span class="selector-class">.box-1</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box-2</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box-3</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="selector-class">.item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    <span class="attribute">align-self</span>: center;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>) &#123;</span><br><span class="line">    <span class="attribute">align-self</span>: flex-end;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box-4</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-flow</span>: row-reverse wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">align-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// div.box、div.column 分别两个 span.item</span></span><br><span class="line"><span class="selector-class">.box-5</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">align-content</span>: space-between;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.column</span>&#123;</span><br><span class="line">    <span class="attribute">flex-basis</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box-6</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">align-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-7</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-flow</span>: column wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">align-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// div.column 分别包含 2、1、3 个子元素</span></span><br><span class="line"><span class="selector-class">.box-8</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">align-content</span>: space-between;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.column</span>&#123;</span><br><span class="line">    <span class="attribute">flex-basis</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.column</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>)&#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <div align="center">
      <img src="/images/mobile/flex.png" alt="flex 布局" width="100%">
  </div>


<h2 id="网格布局"><a href="#网格布局" class="headerlink" title="网格布局"></a>网格布局</h2><blockquote>
<p>平均分布，即在容器里面平均分配空间</p>
</blockquote>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 几个子元素就平分几份</span></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="selector-class">.item</span>&#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 某个网格的宽度为固定的百分比，其余网格平均分配剩余的空间</span></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="selector-class">.item</span>&#123;</span><br><span class="line">    <span class="comment">// flex: 1 1 0%;</span></span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-class">.fixed</span>&#123;</span><br><span class="line">      <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">20%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="圣杯布局"><a href="#圣杯布局" class="headerlink" title="圣杯布局"></a>圣杯布局</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">header</span>, <span class="selector-tag">footer</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-class">.main</span>&#123;</span><br><span class="line">      <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.left</span>, <span class="selector-class">.right</span>&#123;</span><br><span class="line">      <span class="comment">// 两个边栏的宽度设为 12em</span></span><br><span class="line">      <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">12em</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.left</span>&#123;</span><br><span class="line">      <span class="attribute">order</span>: -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 小屏幕时内容区三栏自动变为垂直叠加</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.content</span> &#123;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.left</span>, <span class="selector-class">.main</span>, <span class="selector-class">.right</span> &#123;</span><br><span class="line">      <span class="attribute">flex</span>: auto;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <div align="center">
      <img src="/images/mobile/grail.png" alt="圣杯布局" width="100%">
  </div>


<h2 id="流式布局"><a href="#流式布局" class="headerlink" title="流式布局"></a>流式布局</h2><blockquote>
<p>每行的项目数固定，会自动分行</p>
</blockquote>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: black;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-flow</span>: row wrap;</span><br><span class="line">  <span class="attribute">align-content</span>: flex-start;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">25%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="固定底栏"><a href="#固定底栏" class="headerlink" title="固定底栏"></a>固定底栏</h2><blockquote>
<p>页面内容太少时底栏会抬高到页面的中间，移动端 fixed 定位会导致输入内容的虚拟键盘会导致定位元素错位等问题</p>
</blockquote>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// header、footer、div.content</span></span><br><span class="line">  <span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: auto;</span><br><span class="line">    <span class="attribute">overflow-y</span>: scroll;</span><br><span class="line">    -webkit-<span class="attribute">overflow</span>-scrolling: touch;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏滚动条</span></span><br><span class="line">::-webkit-scrollbar&#123;  </span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0px</span>; </span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// absolute 方式</span></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: auto;</span><br><span class="line">    <span class="attribute">overflow-y</span>: scroll;</span><br><span class="line">    -webkit-<span class="attribute">overflow</span>-scrolling: touch;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">footer</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="样式布局"><a href="#样式布局" class="headerlink" title="样式布局"></a>样式布局</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 输入框的前方添加提示，后方添加按钮</span></span><br><span class="line"><span class="selector-class">.input-item</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="selector-tag">input</span>&#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主栏的左侧或右侧添加一个图片栏 (类似头像)</span></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: flex-start;</span><br><span class="line">  <span class="selector-tag">img</span>&#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">1em</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">p</span>&#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两端对齐，列不满时左对齐</span></span><br><span class="line"><span class="comment">// 法一：如果每行有 n 项，则在最后添加 n-2 个空项</span></span><br><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f1f8ff</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">li</span><span class="selector-class">.empty</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 法二；利用 after/before，适用于每行 3/4 项</span></span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>:block;</span><br><span class="line">  <span class="attribute">content</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="四、事件类型"><a href="#四、事件类型" class="headerlink" title="四、事件类型"></a>四、事件类型</h1><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ul>
<li><strong>click</strong>：单击事件。移动端中连续 click 的触发有 200~300ms 的延迟，延迟来自判断双击和长按，因为只有默认等待时间结束以确定没有后续动作发生时才会触发 click 事件。所以触摸事件反应更快，体验更好，也可以通过 fastclick 库解决延迟问题。</li>
<li><strong>touch</strong>：触摸类事件，分为四种触发方式：touchstart (触屏开始)、touchmove (拖拽)、touchend (触屏完成)、touchcancel (触屏取消)。触屏时如果有更高级别的事件发生，比如电话接入或弹出信息等，则触发 ontouchcancel 事件。</li>
<li><strong>gesture</strong>：手势类事件，可分为三种：gesturestart (两&#x2F;多根手指按下时)、gesturechange (两&#x2F;多根手指按下且移动时)、gestureend (倒数第二根手指移开时)。手势的专有属性有：rotation (手指变化引起的旋转角度)、scale (手指之间的距离)。</li>
<li><strong>tap</strong>：触碰类事件，一般用于代替 click 事件，分为四种：tap (手指触碰屏幕)、longTap (手指长按屏幕)、singleTap (手指单击屏幕)、doubleTap(手指双击屏幕)。</li>
<li><strong>swipe</strong>：滑动事件，分为五种：swipe (滑动手指)、swipeLeft (左滑)、swipeRight (右滑)、swipeUp (上滑)、swipeDown (下滑)。</li>
</ul>
<h2 id="触发"><a href="#触发" class="headerlink" title="触发"></a>触发</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 触发顺序：ontouchstart、ontouchmove、ontouchend、onclick</span></span><br><span class="line"><span class="title function_">addEvent</span>(dom, <span class="string">&#x27;tap click touchstart touchmove&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addEvent</span>(<span class="params">dom, type, showAll</span>) &#123;</span><br><span class="line">    type = type.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    type.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">        dom.<span class="title function_">addEventListener</span>(item, <span class="keyword">function</span>(<span class="params">v</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(showAll ? v : v.<span class="property">type</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="事件对象"><a href="#事件对象" class="headerlink" title="事件对象"></a>事件对象</h3><ul>
<li>获取：box.addEventListener(“touchstart”, function(event){ },true)。</li>
<li>属性<ul>
<li>touches：当前跟踪的触摸操作的 touch 对象的数组。</li>
<li>targetTouches：特定于事件目标的 touch 对象数组 (事件冒泡指出目标对象)。</li>
<li>changedTouches：表示自上次触摸以来发生了什么改变的 touch 对象的数组。</li>
</ul>
</li>
<li>特点<ul>
<li>touchend 事件时 touches、targetTouches 信息会被删除，changedTouches 保存最后一次的信息，最好用于计算手指信息。</li>
<li>通过 jquery 不能获取以上三个属性，而通过 zepto.js (精简版的 jquery，现在用的不多) 可以正常获取。</li>
</ul>
</li>
</ul>
<h2 id="问题方案"><a href="#问题方案" class="headerlink" title="问题方案"></a>问题方案</h2><h3 id="click-延迟"><a href="#click-延迟" class="headerlink" title="click 延迟"></a>click 延迟</h3><blockquote>
<p>原因：移动端浏览器会优先判断用户是否要触发双击缩放、双击滚动等默认行为，用户碰触页面后需要等待 300ms 左右来判断是不是双击动作而不是立即响应。</p>
</blockquote>
<ul>
<li>设置 device-width：<meta name="viewport" content="width=device-width">&#96;。</li>
<li>禁用缩放：<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, user-scalable=no&quot;&gt;</code>。</li>
<li>FastClick：<code>import fastclick from &#39;fastclick&#39;、fastclick.attach(document.body)</code>。</li>
<li>CSS touch-action：<code>touch-action: none</code>，表示在该元素上的操作不会触发用户代理的任何默认行为。</li>
</ul>
<h3 id="点击穿透"><a href="#点击穿透" class="headerlink" title="点击穿透"></a>点击穿透</h3><blockquote>
<p>原生 touch 事件、框架的自定义 tap 事件都存在该问题，因为 touch 系列事件发生大约 300ms 后才会触发 click 事件。</p>
</blockquote>
<ul>
<li>出现问题<ul>
<li>点击蒙层上的关闭按钮，蒙层消失后发现触发了按钮下面元素的 click 事件，如果有 a 标签则会触发页面跳转。</li>
<li>直接点击页面内按钮跳转至新页面，然后发现新页面中对应位置元素的 click 事件被触发。</li>
</ul>
</li>
<li>解决方案<ul>
<li>不要混用 touch、click：只用一种事件就不会存在点击穿透问题。</li>
<li>fastclick：引入库之后把页面内所有 touch 事件都换为 click。</li>
<li>pointer-events： 不建议使用 mask 隐藏后，给按钮下面元素添加 <code>pointer-events: none;</code>。</li>
<li>阻止默认：<code>&lt;div class=&quot;mask&quot; @touchmove.prevent&gt;&lt;/div&gt;、&lt;div ontouchend = &quot;e.preventDefault()&quot;&gt;&lt;/div&gt;</code>。</li>
</ul>
</li>
</ul>
<h3 id="touch、mouse"><a href="#touch、mouse" class="headerlink" title="touch、mouse"></a>touch、mouse</h3>  <div style="text-indent: 2em">移动端中只有触屏事件完成后再次触发时，才会触发上一个事件的 mouseout 事件。即系统会在手指提起的瞬间判断接收到事件的元素是否被改变，若没有改变则会按照 mousedown、mouseup、click 的顺序依次触发，反之不会触发。</div>
 

<h3 id="点击状态处理"><a href="#点击状态处理" class="headerlink" title="点击状态处理"></a>点击状态处理</h3><ul>
<li>hover 样式：移动端不可用。</li>
<li>touch 事件：动态增删 class 或绑定动画。</li>
<li>激活状态：常用于 a、button 等元素的伪类 :active<ul>
<li>js：<code>document.body.addEventListener(&#39;touchstart&#39;, fn)</code></li>
<li>html：<code>body ontouchstart</code></li>
</ul>
</li>
<li>点击高亮：<code>a &#123; tap-highlight-color: transparent; &#125;</code></li>
</ul>
<h3 id="touch、gesture"><a href="#touch、gesture" class="headerlink" title="touch、gesture"></a>touch、gesture</h3><ul>
<li>当一个手指放在屏幕上时会触发 touchstart 事件，如果另一个手指又放到了屏幕上则会触发 gesturestart 事件，然后触发基于该手指的 touchstart 事件。</li>
<li>如果两个手指在屏幕上滑动将会触发 gesturechange 事件，但只要有一个手指移开则会触发 gestureend 事件，然后又触发 touchend 事件。</li>
</ul>
]]></content>
      <categories>
        <category>移动端开发</category>
      </categories>
      <tags>
        <tag>移动端开发</tag>
      </tags>
  </entry>
  <entry>
    <title>Node.js 常用框架</title>
    <url>/2019/06/20/7-2-Node%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h1 id="一、Express"><a href="#一、Express" class="headerlink" title="一、Express"></a>一、Express</h1><blockquote>
<p>基于 ES5 语法实现而只能通过回调实现异步代码，框架本身缺少约束而写法较多，只适合开发小型项目并作为新手入门级框架。</p>
</blockquote>
<h2 id="核心特性"><a href="#核心特性" class="headerlink" title="核心特性"></a>核心特性</h2><ul>
<li>设置中间件来响应 HTTP 请求。</li>
<li>定义路由表用于执行不同的 HTTP 请求。</li>
<li>通过向模板传递参数来动态渲染 HTML。</li>
</ul>
<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 views 的文件夹和模板</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, **dirname + <span class="string">&quot;/views&quot;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;jade&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态资源</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(**dirname + <span class="string">&#x27;/public&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态渲染</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Hello world&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>


<h2 id="搭建应用"><a href="#搭建应用" class="headerlink" title="搭建应用"></a>搭建应用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认 localhost:3000</span></span><br><span class="line">npm install express express-generator -g </span><br><span class="line"></span><br><span class="line">express -e myApp  <span class="comment">// 使用 ejs 模板</span></span><br><span class="line">cd myApp</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">npm start </span><br></pre></td></tr></table></figure>



<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><blockquote>
<p>本质是处理 HTTP 请求的函数。每个中间件都可以接收到请求对象 req、响应对象 res 和回调函数 next 这三个参数，经过处理后可以通过调用 next() 传递给下一个中间件。</p>
</blockquote>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul>
<li><strong>应用级中间件</strong>：使用 app.use&#x2F;method 绑定到 app 对象。</li>
<li><strong>路由级中间件</strong>：使用 router.use&#x2F;method 绑定到 express.Router() 对象。</li>
<li><strong>错误处理中间件</strong>：接收四个参数，用于处理应用中的错误。</li>
<li><strong>第三方中间件</strong>：安装后 require 到文件中使用，用来扩展功能。</li>
<li><strong>内置中间件</strong>：express.static 托管静态资源、express.json 解析请求。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 应用级</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>) =&gt;</span> &#123;   </span><br><span class="line">    <span class="title function_">next</span>()   </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由级</span></span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">params</span>.<span class="property">id</span>==<span class="number">0</span>) <span class="title function_">next</span>(<span class="string">&#x27;route&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span> <span class="title function_">next</span>()</span><br><span class="line">&#125;,<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&quot;Hello world&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Something broke&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内置中间件 </span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(**dirname + <span class="string">&#x27;/public&#x27;</span>))</span><br></pre></td></tr></table></figure>


<h3 id="定义方法"><a href="#定义方法" class="headerlink" title="定义方法"></a>定义方法</h3><ul>
<li><strong>app.use</strong>：对客户端请求路径及其所有扩展结果进行匹配。</li>
<li><strong>app.method</strong>：对客户端请求路径进行精确匹配，但会忽略锚点和 get 参数数据。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路径默认 &#x27;/&#x27;，匹配所有路径(都可以看作是 &#x27;/&#x27; 的扩展)</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路径默认 &#x27;/&#x27; ，只匹配根路径</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123; &#125;)</span><br></pre></td></tr></table></figure>


<h3 id="响应方法"><a href="#响应方法" class="headerlink" title="响应方法"></a>响应方法</h3><ul>
<li><strong>res.end</strong>：结束响应进程但不返回数据。</li>
<li><strong>res.send</strong>：发送各种类型的响应。</li>
<li><strong>res.json</strong>：发送 JSON 响应。</li>
<li><strong>res.jsonp</strong>：在 JSONP 的支持下发送 JSON 响应。</li>
<li><strong>res.render</strong>：呈现视图模板。</li>
<li><strong>res.redirect</strong>：重定向请求。</li>
<li><strong>res.sendFile</strong>：以八位元流形式发送文件。</li>
<li><strong>res.download</strong>：提示将要下载文件。</li>
<li><strong>res.sendStatus</strong>：设置响应状态码并发送其字符串表示。</li>
</ul>
<h2 id="路由管理"><a href="#路由管理" class="headerlink" title="路由管理"></a>路由管理</h2><h3 id="路径规则"><a href="#路径规则" class="headerlink" title="路径规则"></a>路径规则</h3><ul>
<li>url 字符串不区分字母的大小写。</li>
<li>url 传递的数据通过冒号语法提取。</li>
<li>所有 get 方式提交的 url 参数及锚点均会被忽略。</li>
<li>所有路由中间件的书写顺序至关重要，只会执行首次匹配到的中间件。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// localhost:3000/tom/24：tom, 24</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/:name/:age&#x27;</span>, <span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">params</span>.<span class="property">name</span>, req.<span class="property">params</span>.<span class="property">age</span>)</span><br><span class="line">  res.<span class="title function_">send</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// localhost:3000/a#?name=tom </span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/a&#x27;</span>, <span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// localhost:3000/admin/login：只执行第一个</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/:username/:method&#x27;</span>, <span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">  res.<span class="title function_">end</span>()  <span class="comment">// 此处如果执行 next() 则会第二个</span></span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/admin/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">  res.<span class="title function_">end</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="路径匹配"><a href="#路径匹配" class="headerlink" title="路径匹配"></a>路径匹配</h3><h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 匹配根路径的请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配 /about 路径的请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/about&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;about&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配 /random.text 路径的请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/random.text&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;random.text&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h4 id="字符串模式"><a href="#字符串模式" class="headerlink" title="字符串模式"></a>字符串模式</h4>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 匹配 /user、/user/5，去掉 ? 则只匹配 /user/5</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user/:id?&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;/users/:id?&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配 acd 和 abcd</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/ab?cd&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ab?cd&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配 /abe 和 /abcde</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/ab(cd)?e&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ab(cd)?e&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配 abcd、abbcd、abbbcd等</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/ab+cd&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ab+cd&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/ab*cd&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ab*cd&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 匹配任何路径中含有 a 的路径：</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="regexp">/a/</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;/a/&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="regexp">/.*fly$/</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;/.*fly$/&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 匹配 /abcd、/xyza、/lmnand、/pqr</span></span><br><span class="line">app.<span class="title function_">use</span>([<span class="string">&#x27;/abcd&#x27;</span>, <span class="string">&#x27;/xyza&#x27;</span>, <span class="regexp">/\/lmn|\/pqr/</span>], <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="路由句柄"><a href="#路由句柄" class="headerlink" title="路由句柄"></a>路由句柄</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一个回调函数</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/example/a&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Hello from A&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 多个回调函数</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/example/b&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调函数数组</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123; <span class="title function_">next</span>() &#125;</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123; <span class="title function_">next</span>() &#125;</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">function</span> (<span class="params">req, res</span>) &#123; res.<span class="title function_">send</span>(<span class="string">&#x27;Hello from C&#x27;</span>) &#125;</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/example/c&#x27;</span>, [a, b, c])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 混合使用</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/example/d&#x27;</span>, [a, b], <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Hello from D&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h3><ul>
<li><strong>req.param</strong>：已被弃用。</li>
<li><strong>req.query</strong>：解析 GET 请求中的查询字符串。</li>
<li><strong>req.body</strong>：解析 POST 请求中的数据（需引用body-parser）。</li>
<li><strong>req.params</strong>：解析 GET&#x2F;POST 请求中的占位符数据（如&#x2F;:name）。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user/10</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;user/:id&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">params</span>[<span class="string">&quot;id&quot;</span>])</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// user/?id=10</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/user&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">query</span>[<span class="string">&quot;id&quot;</span>])</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 body-parser 模块获取 post 请求数据</span></span><br><span class="line"><span class="keyword">let</span> bodyParser=<span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">body</span>.<span class="property">name</span>, req.<span class="property">body</span>.<span class="property">password</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="特殊路由"><a href="#特殊路由" class="headerlink" title="特殊路由"></a>特殊路由</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 验证或处理 路径参数</span></span><br><span class="line">router.<span class="title function_">param</span>(<span class="string">&#x27;id&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next, id</span>) &#123;</span><br><span class="line">  req.<span class="property">name</span> = name</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;hello &#x27;</span> + req.<span class="property">name</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式路由：一个路径处理多种请求</span></span><br><span class="line">app.<span class="title function_">route</span>(<span class="string">&#x27;/book&#x27;</span>)</span><br><span class="line">  .<span class="title function_">get</span>(<span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">      res.<span class="title function_">send</span>(<span class="string">&#x27;Get a random book&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">post</span>(<span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">      res.<span class="title function_">send</span>(<span class="string">&#x27;Add a book&#x27;</span>);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>


<h3 id="next-方法"><a href="#next-方法" class="headerlink" title="next 方法"></a>next 方法</h3><ul>
<li>**next()**：从下一个处理函数开始往下执行</li>
<li>**next(‘router’)**：直接执行下一个相同路由</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="title function_">next</span>()           </span><br><span class="line">  <span class="comment">// 结果：1234，替换为next(&#x27;route&#x27;)则结果：1234</span></span><br><span class="line">  </span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">  <span class="title function_">next</span>(<span class="string">&#x27;route&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h1 id="二、Koa"><a href="#二、Koa" class="headerlink" title="二、Koa"></a>二、Koa</h1><blockquote>
<p>Express 团队打造的进阶框架，基于 ES7 语法使用 Promise 实现异步而极大简化了异步代码。但是开发项目时缺少约束，多人开发时代码合并困难而不适合团队协作开发项目。</p>
</blockquote>
<h2 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h2><ul>
<li><strong>洋葱中间件模式</strong>：next函数决定是否执行下一个中间件。</li>
<li><strong>Context 对象</strong>：内部封装了 HTTP 请求对象和响应对象。</li>
<li><strong>异步处理</strong>：使用 Promise 并配合 async await 实现异步。</li>
</ul>
<h2 id="基础使用-1"><a href="#基础使用-1" class="headerlink" title="基础使用"></a>基础使用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// npm install koa koa-route</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>()</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> route = <span class="built_in">require</span>(<span class="string">&#x27;koa-route&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态资源服务器：npm install koa-static</span></span><br><span class="line"><span class="keyword">const</span> serve = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">serve</span>(path.<span class="title function_">join</span>(**dirname, <span class="string">&#x27;/public&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态渲染页面：npm install koa-views ejs</span></span><br><span class="line"><span class="keyword">let</span> views = <span class="built_in">require</span>(<span class="string">&#x27;koa-views&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">views</span>(**dirname,&#123;</span><br><span class="line">  <span class="attr">extension</span>:<span class="string">&#x27;ejs&#x27;</span> <span class="comment">//指定用ejs模板</span></span><br><span class="line">&#125;))</span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next)=&gt;&#123;</span><br><span class="line">  <span class="comment">// 渲染 index.ejs</span></span><br><span class="line">  <span class="keyword">await</span> ctx.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123;<span class="attr">name</span>:<span class="string">&#x27;cgp&#x27;</span>, <span class="attr">age</span>:<span class="number">9</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>


<h2 id="搭建应用-1"><a href="#搭建应用-1" class="headerlink" title="搭建应用"></a>搭建应用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认 localhost:3000</span></span><br><span class="line">npm install koa koa-generator -g </span><br><span class="line"></span><br><span class="line">koa2 project </span><br><span class="line">cd project</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>


<h2 id="路由管理-1"><a href="#路由管理-1" class="headerlink" title="路由管理"></a>路由管理</h2><h3 id="原生路由"><a href="#原生路由" class="headerlink" title="原生路由"></a>原生路由</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过 ctx.request.path 获取用户请求的路径</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.<span class="property">request</span>.<span class="property">path</span> == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// ctx.response.body的简写 </span></span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;&lt;p&gt;Hello World&lt;/p&gt;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="路由中间件"><a href="#路由中间件" class="headerlink" title="路由中间件"></a>路由中间件</h3><blockquote>
<p>安装：npm install koa koa-router</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础用法：常用 get、post、all</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">async</span> (ctx, next)=&gt;&#123;</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&#x27;hello people&#x27;</span>;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>()</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/list&#x27;</span>, <span class="keyword">async</span> (ctx, next)=&gt;&#123;</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&#x27;list&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 传递参数</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">ctx,next</span>)=&gt;</span>&#123; </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;/home?id=1 传递参数：&#x27;</span>, ctx.<span class="property">query</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user/:name&#x27;</span>, <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;/user/tom 传递参数：&#x27;</span>, ctx.<span class="property">params</span>.<span class="property">name</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/user/register&#x27;</span>,<span class="title function_">async</span>(ctx, next)=&gt;&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(ctx.<span class="property">request</span>.<span class="property">body</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重定向</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.<span class="title function_">redirect</span>(<span class="string">&#x27;/user&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 嵌套路由</span></span><br><span class="line"><span class="keyword">let</span> home = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line">home.<span class="title function_">get</span>(<span class="string">&#x27;/list&#x27;</span>, <span class="title function_">async</span>(ctx)=&gt;&#123;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&quot;Home list&quot;</span>;</span><br><span class="line">&#125;).<span class="title function_">get</span>(<span class="string">&#x27;/todo&#x27;</span>, <span class="title function_">async</span>(ctx)=&gt;&#123;</span><br><span class="line">    ctx.<span class="property">body</span> =<span class="string">&#x27;Home ToDo&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line">user.<span class="title function_">get</span>(<span class="string">&#x27;/list&#x27;</span>, <span class="title function_">async</span>(ctx)=&gt;&#123;</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&quot;User list&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 装载所有子路由</span></span><br><span class="line"><span class="keyword">let</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line">router.<span class="title function_">use</span>(<span class="string">&#x27;/home&#x27;</span>, home.<span class="title function_">routes</span>(), home.<span class="title function_">allowedMethods</span>());</span><br><span class="line">router.<span class="title function_">use</span>(<span class="string">&#x27;/user&#x27;</span>, user.<span class="title function_">routes</span>(), user.<span class="title function_">allowedMethods</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载路由：当请求数据的方法与设置的方法不一致时会报错</span></span><br><span class="line">app.<span class="title function_">use</span>(router.<span class="title function_">routes</span>()).<span class="title function_">use</span>(router.<span class="title function_">allowedMethods</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听服务</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>


<h2 id="中间件-1"><a href="#中间件-1" class="headerlink" title="中间件"></a>中间件</h2>  <div style="text-indent: 2em">每个中间件默认接受 `Context 对象、next 函数` 两个参数。`Context 对象内部封装了原生 NodeJS 包含的 request、response 对象，分别为 ctx.req、ctx.res。next函数被调用时，会暂停该中间件的运行并将控制传递给下一个中间件。</div>


<h3 id="分类-1"><a href="#分类-1" class="headerlink" title="分类"></a>分类</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 第三方中间件：引入koa-router并对其实例化</span></span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="string">&#x27;404&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;服务器异常&#x27;</span>,</span><br><span class="line">    <span class="attr">desc</span>: error.<span class="property">message</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用级中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="keyword">if</span>(ctx.<span class="property">status</span> === <span class="number">404</span>)&#123;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&quot;404页面&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由级中间件</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&#x27;hello koa&#x27;</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动路由</span></span><br><span class="line">app.<span class="title function_">use</span>(router.<span class="title function_">routes</span>()).<span class="title function_">use</span>(router.<span class="title function_">allowedMethods</span>())</span><br></pre></td></tr></table></figure>
<h3 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h3><ul>
<li>多个中间件会形成堆栈结构，按先进后出顺序执行。</li>
<li>任何路由都会先经过应用级中间件，当执行完成next后再去匹配相应路由。</li>
<li>路由在匹配成功并执行完相应操作后还会再次进入应用级中间件执行 next 之后的逻辑。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;7&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&#x27;Hello Koa&#x27;</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="第三方中间件"><a href="#第三方中间件" class="headerlink" title="第三方中间件"></a>第三方中间件</h3><ul>
<li><strong>kao-views</strong>：模板渲染</li>
<li><strong>koa-router</strong>：路由处理</li>
<li><strong>koa-static</strong>：静态文件读取</li>
<li><strong>koa-bodyparse</strong>：处理post请求的数据</li>
</ul>
<h2 id="常用功能"><a href="#常用功能" class="headerlink" title="常用功能"></a>常用功能</h2><h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><blockquote>
<p>框架自带属性，不需要引入中间件</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置中文时报错解决</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 new Buffer().toString(&#x27;base64&#x27;) 转换</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;test&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="string">&#x27;你好&#x27;</span>).<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>))</span><br><span class="line">  <span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">Buffer</span>(ctx.<span class="property">cookies</span>.<span class="title function_">get</span>(<span class="string">&#x27;test&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>).<span class="title function_">toString</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 encodeURIComponent() 转换</span></span><br><span class="line">  ctx.<span class="property">cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="built_in">encodeURIComponent</span>(<span class="string">&#x27;李&#x27;</span>))</span><br><span class="line">  <span class="keyword">const</span> name = <span class="built_in">decodeURIComponent</span>(ctx.<span class="property">cookies</span>.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="表单处理"><a href="#表单处理" class="headerlink" title="表单处理"></a>表单处理</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparse&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">bodyParser</span>()); </span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/add&#x27;</span>, <span class="keyword">async</span> (ctx)=&gt;&#123;</span><br><span class="line">  <span class="comment">// 获取表单提交的数据</span></span><br><span class="line">  <span class="keyword">const</span> body = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">  ctx.<span class="property">body</span> = &#123; <span class="attr">name</span>: body.<span class="property">name</span> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h3>  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/file_upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;image&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入：npm install koa-body --save</span></span><br><span class="line"><span class="keyword">const</span> koaBody = <span class="built_in">require</span>(<span class="string">&#x27;koa-body&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">koaBody</span>(&#123;</span><br><span class="line">  <span class="attr">multipart</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">formidable</span>: &#123;</span><br><span class="line">    <span class="attr">maxFileSize</span>: <span class="number">200</span>*<span class="number">1024</span>*<span class="number">1024</span>  <span class="comment">// 设置文件最大限制，默认 2M</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传图片</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/file_upload&#x27;</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 获取上传图片</span></span><br><span class="line">  <span class="keyword">const</span> data = ctx.<span class="property">request</span>.<span class="property">body</span>.<span class="property">files</span>.<span class="property">data</span>;</span><br><span class="line">  <span class="comment">// 创建可读流</span></span><br><span class="line">  <span class="keyword">const</span> savePath = path.<span class="title function_">join</span>(<span class="string">`./files`</span>, data.<span class="property">name</span>)</span><br><span class="line">  <span class="keyword">const</span> reader = fs.<span class="title function_">createReadStream</span>(data.<span class="property">path</span>)</span><br><span class="line">  <span class="comment">// 创建可写流</span></span><br><span class="line">  <span class="keyword">const</span> writer = fs.<span class="title function_">createWriteStream</span>(savePath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 可读流通过管道写入可写流</span></span><br><span class="line">    <span class="keyword">var</span> stream = reader.<span class="title function_">pipe</span>(writer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图片上传成功后返回服务器地址，实时显示服务器图片</span></span><br><span class="line">    stream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">`http://当前服务器地址<span class="subst">$&#123;data.name&#125;</span>`</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  ctx.<span class="property">response</span>.<span class="property">body</span> =  <span class="keyword">await</span> pro</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传单个文件</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/uploadfile&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 获取上传文件</span></span><br><span class="line">  <span class="keyword">const</span> file = ctx.<span class="property">request</span>.<span class="property">files</span>.<span class="property">file</span>; </span><br><span class="line">  <span class="comment">// 创建可读流</span></span><br><span class="line">  <span class="keyword">const</span> reader = fs.<span class="title function_">createReadStream</span>(file.<span class="property">path</span>);</span><br><span class="line">  <span class="keyword">let</span> filePath = path.<span class="title function_">join</span>(**dirname, <span class="string">&#x27;public/upload/&#x27;</span>) + <span class="string">`/<span class="subst">$&#123;file.name&#125;</span>`</span>;</span><br><span class="line">  <span class="comment">// 创建可写流</span></span><br><span class="line">  <span class="keyword">const</span> upStream = fs.<span class="title function_">createWriteStream</span>(filePath);</span><br><span class="line">  <span class="comment">// 可读流通过管道写入可写流</span></span><br><span class="line">  reader.<span class="title function_">pipe</span>(upStream);</span><br><span class="line">  <span class="keyword">return</span> ctx.<span class="property">body</span> = <span class="string">&quot;上传成功！&quot;</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传多个文件</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/uploadfiles&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 获取上传文件，旧版本通过 ctx.request.body.files</span></span><br><span class="line">  <span class="keyword">const</span> files = ctx.<span class="property">request</span>.<span class="property">files</span>.<span class="property">file</span>; </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">    <span class="comment">// 创建可读流</span></span><br><span class="line">    <span class="keyword">const</span> reader = fs.<span class="title function_">createReadStream</span>(file.<span class="property">path</span>);</span><br><span class="line">    <span class="comment">// 获取上传文件扩展名</span></span><br><span class="line">    <span class="keyword">let</span> filePath = path.<span class="title function_">join</span>(**dirname, <span class="string">&#x27;public/upload/&#x27;</span>) + <span class="string">`/<span class="subst">$&#123;file.name&#125;</span>`</span>;</span><br><span class="line">    <span class="comment">// 创建可写流</span></span><br><span class="line">    <span class="keyword">const</span> upStream = fs.<span class="title function_">createWriteStream</span>(filePath);</span><br><span class="line">    <span class="comment">// 可读流通过管道写入可写流</span></span><br><span class="line">    reader.<span class="title function_">pipe</span>(upStream);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ctx.<span class="property">body</span> = <span class="string">&quot;上传成功！&quot;</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="合并中间件"><a href="#合并中间件" class="headerlink" title="合并中间件"></a>合并中间件</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// koa-compose：将多个中间件合成为一个</span></span><br><span class="line"><span class="keyword">const</span> compose = <span class="built_in">require</span>(<span class="string">&#x27;koa-compose&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> first = asycn (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">second</span> = <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> middle = <span class="title function_">compose</span>([first, second])</span><br><span class="line">app.<span class="title function_">use</span>(middle)</span><br></pre></td></tr></table></figure>


<h1 id="三、Egg"><a href="#三、Egg" class="headerlink" title="三、Egg"></a>三、Egg</h1><blockquote>
<p>基于 koa2 的企业级框架，是由阿里 NodeJS 团队封装的企业级 Web 应用解决方案。</p>
</blockquote>
  <div style="text-indent: 2em">官方定位是 为企业级框架和应用而生和孕育出更多上层框架，奉行 `约定优于配置`，帮助开发团队和开发人员降低开发和维护成本。async 的特性避免了回调地狱，洋葱式的中间件架构更容易后置逻辑，内置的多进程管理会更好的利用服务器性能，以及更方便的单元测试和更加约束的目录架构。</div>


<h2 id="框架体系"><a href="#框架体系" class="headerlink" title="框架体系"></a>框架体系</h2><ul>
<li>核心体系：egg-core 模块。以 Koa.js 为基类并利用它的 中间件机制 和 HTTP服务机制 作为框架基础，以 Loader 机制作为 Egg.js 各分层机制的约定基础。</li>
<li>辅助体系：egg-script、egg-bin 等模块：支持 开发模式、生产模式、多线程模式。</li>
<li>生态体系：中间件、插件、框架。</li>
</ul>
<h2 id="主要特点-1"><a href="#主要特点-1" class="headerlink" title="主要特点"></a>主要特点</h2><ul>
<li>渐进式开发</li>
<li>内置多进程管理</li>
<li>高度可扩展的插件机制</li>
<li>框架稳定，测试覆盖率高</li>
<li>基于 Koa 开发，性能优异</li>
<li>提供基于 Egg 定制上层框架的能力</li>
</ul>
<h2 id="搭建应用-2"><a href="#搭建应用-2" class="headerlink" title="搭建应用"></a>搭建应用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i egg-init -g</span><br><span class="line">egg-init test --type=simple  </span><br><span class="line"></span><br><span class="line">cd test</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">npm run dev </span><br></pre></td></tr></table></figure>


<h2 id="项目运行"><a href="#项目运行" class="headerlink" title="项目运行"></a>项目运行</h2><ul>
<li>绿色虚线框中的所有组件组成了一个实际执行代码逻辑的进程。</li>
<li>request 进入后先穿过中间件，自定义中间件放在 app&#x2F;middleware 并在 config 启用。</li>
<li>静态资源（project&#x2F;app&#x2F;public）经过内置的 egg-static 中间件时会直接响应给客户端，其它资源则会穿越所有中间件并到达路由文件 router.js。</li>
<li>路由文件一般没有任何逻辑而只起到目录和索引的作用，它会直接指向一个处理请求的 controller（app&#x2F;controller）。</li>
<li>Controller 负责调用并组合 Service（app&#x2F;service），最后将响应提交给客户端。Service 负责调用 Model 处理具体的业务逻辑。</li>
<li>除此之外，Worker 中还有定时任务（app&#x2F;schedule）。</li>
</ul>
  <div align="center">
      <img src="/images/nodejs/egg-run.png" alt="Egg Run" width="100%">
  </div>


<h2 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h2><blockquote>
<p>要分析框架的实现原理，直接从所有源码开始分析比较难。但是可以先将其精简到最小功能系统，然后针对各个功能进行分析和叠加。</p>
</blockquote>
<h3 id="模块架构"><a href="#模块架构" class="headerlink" title="模块架构"></a>模块架构</h3>  <div align="center">
      <img src="/images/nodejs/egg-framework.png" alt="Egg Framework" width="100%">
  </div>


<h3 id="最简目录"><a href="#最简目录" class="headerlink" title="最简目录"></a>最简目录</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">├── index.<span class="property">js</span>          <span class="comment">// 启动文件：初始化 应用实例 和 HTTP 服务器</span></span><br><span class="line">├── app               <span class="comment">// 业务模块：路由文件</span></span><br><span class="line">│     └── router.<span class="property">js</span>   </span><br><span class="line">├── lib               <span class="comment">// 应用模块：提供加载器和底层的中间件、插件、路由等机制</span></span><br><span class="line">|     ├── egg-core </span><br><span class="line">│     └── egg.<span class="property">js</span>                    </span><br><span class="line">└── package.<span class="property">json</span></span><br></pre></td></tr></table></figure>


<h3 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h3><ol>
<li>应用初始化：加载所有 loader、加载所有中间件和插件等内容、路由注册。</li>
<li>服务启动：提供 http 服务、执行路由处理。</li>
</ol>
<h3 id="代码逻辑"><a href="#代码逻辑" class="headerlink" title="代码逻辑"></a>代码逻辑</h3><ol>
<li>EggApplication：继承 EggCore，按照顺序加载所有中间件、插件、路由等内容。</li>
<li>EggCore<br>* 继承 Koa，实现功能：服务器的底层逻辑、工程项目文件的加载器、提供底层的中间件、插件、路由等机制。<br>* 构建 AppWorkerLoader：初始化加载器(继承 EggLoader)、路由(继承 Koa-router)。</li>
<li>EggLoader：注入各种加载器方法。</li>
</ol>
<h3 id="路由优化"><a href="#路由优化" class="headerlink" title="路由优化"></a>路由优化</h3><ul>
<li>路由大小写敏感</li>
<li>RESTFul 实现</li>
<li>Controller 句柄使用</li>
<li>Generator Function 兼容</li>
</ul>
<h3 id="RESTFul"><a href="#RESTFul" class="headerlink" title="RESTFul"></a>RESTFul</h3><blockquote>
<p>测试时需要先安装接口测试工具：chrome postman，然后在 chrome 地址栏使用</p>
</blockquote>
<ul>
<li>约定路由路径和对应的控制器。</li>
<li>统一处理封装 router 参数。</li>
<li>统一封装 controller：根据请求类型和路径注册对应的控制器。<ul>
<li>Async Function</li>
<li>Generator Function</li>
<li>controller 句柄读取 this.app.controller</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由文件添加</span></span><br><span class="line">router.<span class="title function_">resources</span>(<span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;/v1/users&#x27;</span>, <span class="string">&#x27;users&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建文件 app/controller/users.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Controller</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UsersController</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Controller</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;创建&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;删除&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;修改&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;查询&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;列表&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">new</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;创建页面&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">edit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;修改页面&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">UsersController</span>;</span><br></pre></td></tr></table></figure>


<h3 id="加载器"><a href="#加载器" class="headerlink" title="加载器"></a>加载器</h3>  <div style="text-indent: 2em">实际项目中的业务代码除了路由文件，还有 controller、service 等其他分层的源码文件。Egg.js 是通过加载器 EggLoader 将这些分层的项目业务代码、中间件和插件代码的大部分功能注入到 this、this.app、this.ctx 对象。</div>



 




]]></content>
      <categories>
        <category>JS 扩展</category>
      </categories>
      <tags>
        <tag>JS 扩展</tag>
      </tags>
  </entry>
  <entry>
    <title>Node.js 主要内容</title>
    <url>/2019/06/16/7-1-Node%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="一、NodeJS"><a href="#一、NodeJS" class="headerlink" title="一、NodeJS"></a>一、NodeJS</h1><blockquote>
<p>一个独立运行的 JS 代码解析器(即运行环境)，用于开发和运行视频流网站、单页应用或在线聊天应用等<code>io密集型网络应用</code>。它封装了 V8 引擎并引入 CommonJS 规范而解决了 JS 比较慢和乱的问题，通过单线程和异步事件驱动机制实现了较强的并发处理能力，适用于<code>高并发、I/O 密集、少量业务逻辑</code>的场景。但是不适合处理<code>密集计算和复杂逻辑</code>，因为那可能会阻塞应用中运行的单线程。</p>
</blockquote>
<h2 id="基础介绍"><a href="#基础介绍" class="headerlink" title="基础介绍"></a>基础介绍</h2><ul>
<li><strong>优点</strong>：轻量高效、事件驱动模型、异步非阻塞 I&#x2F;O 模型、单进程单线程应用程序。</li>
<li><strong>不足</strong>：不适合处理复杂逻辑、不适合计算密集型应用、不适合单用户多任务的程序、代码某个环节报错则整个系统崩溃、只支持单核 CPU 而不能充分利用多核 CPU 服务器。</li>
<li><strong>前端应用</strong>：<code>模块捆绑器</code>(类似 Webpack&#x2F;Vite 将代码片段捆绑为一个文件而方便运行)、<code>代码润色器</code>(类似 ESLint 检测和修改代码)、<code>npm 包</code>(帮助编程)、<code>样式设计</code>(编写组件库)。</li>
<li><strong>后端应用</strong>：<code>数据库集成</code>(支持 JS 进行数据库操作)、<code>实时应用</code>(事件驱动机制和非阻塞I&#x2F;O模型实现密集通信)、<code>网络和API调用</code>(在线论坛等支持处理请求的同时继续其它工作)。</li>
<li><strong>应用案例</strong>：<code>Uber</code>(快速处理大量数据和修正故障)、<code>Netflix</code>(视频流媒体服务)、<code>LinkedIn</code>(提升性能和资源利用率)、<code>贝宝</code>(允许通过 JS 开发浏览器和服务器应用程序)。</li>
</ul>
<h2 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h2><blockquote>
<p>同步异步指操作任务是否按顺序依次执行，阻塞非阻塞指 IO 操作是否影响主进城执行其它代码。</p>
</blockquote>
<ul>
<li><strong>单线程</strong>：通过一个主线程处理所有的请求，注意异步操作是通过线程池来完成的。</li>
<li><strong>异步非阻塞</strong>：主线程接收到操作请求后就作为一个事件放入任务队列，然后继续接收其他请求，如果有耗时操作则交给不同的工作线程去执行，所以主线程速度快而且不会阻塞。</li>
<li><strong>事件驱动</strong>：主线程按顺序将所有操作都注册为一个事件并等待触发的方式。主线程首先执行完同步操作，然后通过事件循环机制查看任务队列中的事件并将异步事件交给工作线程。</li>
</ul>
<h2 id="功能架构"><a href="#功能架构" class="headerlink" title="功能架构"></a>功能架构</h2>  <div align="center">
      <img src="/images/nodejs/node-framework.png" alt="Node Framework" width="100%">
  </div>
            
<ul>
<li><strong>顶部</strong>：Js 编写的应用程序和模块。</li>
<li><strong>中间</strong>：通过代码包装和暴露接口而实现 js 可以调用 c++ 代码。<ul>
<li><strong>Bindings</strong>：绑定核心库的依赖。</li>
<li><strong>Addons</strong>：绑定第三方或自定义 C&#x2F;C++。</li>
</ul>
</li>
<li><strong>底部</strong>：C&#x2F;C++ 编写的内部组件，提供了系统底层操作方法。<ul>
<li><strong>V8</strong>：Google 开源 js 引擎，用于将 Js 代码编译为机器码执行以便快速编译。</li>
<li><strong>libuv</strong>：跨平台的底层封装，实现事件循环、文件操作等异步功能。</li>
</ul>
</li>
</ul>
<h1 id="二、window-安装"><a href="#二、window-安装" class="headerlink" title="二、window 安装"></a>二、window 安装</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><blockquote>
<p>本质是把 NodeJS 执行程序复制到一个目录，然后保证这个目录在系统 PATH 环境变量下，以便终端下可以使用 node 命令。</p>
</blockquote>
<ul>
<li>版本：Windows Installer(.msi) 64位</li>
<li>地址：建议不要安装在 C 盘而修改默认地址为 “D:\nodejs&quot;</li>
<li>命令：查看版本 <code>node -v</code>、交互模式 <code>node</code>、执行文件 <code>node hello.js</code></li>
</ul>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="包文件"><a href="#包文件" class="headerlink" title="包文件"></a>包文件</h3><blockquote>
<p>统一管理通过 npm 全局安装的第三方包及其缓存。</p>
</blockquote>
<ol>
<li>新建文件夹：<code>node_global、node_cache</code></li>
<li>执行命令<br>* <code>npm config set cache &quot;D:\nodejs\node_cache&quot;</code><br>* <code>npm config set prefix &quot;D:\nodejs\node_global&quot;</code></li>
<li>修改文件：node_modules\npm\npmrc<br>* <code>prefix = D:\nodejs\node_global</code><br>* <code>cache = D:\nodejs\node_global</code></li>
</ol>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><blockquote>
<p>全局使用 npm、cnpm 等命令。</p>
</blockquote>
  <div style="text-indent: 2em;">path 指系统默认指定到某一路径，运行命令时会先从这些路径中开始找。另一种方法是在系统变量中设置 NODE_PATH = 安装的根目录，NodeJS 允许通过变量 NODE_PATH 指定额外的模块搜索路径。所以配置方法如下：</div>

<ul>
<li>用户变量 PATH 末尾添加 <code>&quot;;D:\nodejs\node_global&quot;</code></li>
<li>系统变量新增 <code>NODE_PATH: &quot;D:\nodejs\node_global\node_modules&quot;</code></li>
</ul>
<h2 id="安装-cnpm"><a href="#安装-cnpm" class="headerlink" title="安装 cnpm"></a>安装 cnpm</h2><blockquote>
<p>npm 服务器在国外而安装速度慢，所以大多都使用淘宝对 npm 的镜像服务器 cnpm，它和 npm 命令相同。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">npm install cnpm -g --registry=<span class="attr">https</span>:<span class="comment">//registry.npm.taobao.org</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 安装失败的解决方案</span></span><br><span class="line">npm config set registry <span class="attr">https</span>:<span class="comment">//registry.npm.taobao.org</span></span><br></pre></td></tr></table></figure>

<h2 id="安装-nodemon"><a href="#安装-nodemon" class="headerlink" title="安装 nodemon"></a>安装 nodemon</h2><blockquote>
<p>编写调试 Node 项目时，每次修改代码后都需要重新启动，比较麻烦。nodemon 工具可以监听代码文件的变化，并自动重启 Node 服务器和数据库服务器。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">cnpm install -g  nodemon</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;hello node&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动</span></span><br><span class="line">nodemon app</span><br></pre></td></tr></table></figure>


<h1 id="三、模块管理"><a href="#三、模块管理" class="headerlink" title="三、模块管理"></a>三、模块管理</h1><h2 id="模块机制"><a href="#模块机制" class="headerlink" title="模块机制"></a>模块机制</h2><ul>
<li>根据模块(文件) 划分功能、组织和复用代码。</li>
<li>通过 npm 工具和网站进行开源社区代码共享。</li>
<li>通过包规范管理应用和可复用组件。</li>
</ul>
<h2 id="模块模型"><a href="#模块模型" class="headerlink" title="模块模型"></a>模块模型</h2><ul>
<li><strong>核心模块</strong>：NodeJS 提供，会被编译到二进制执行文件（加载速度快）。<ul>
<li><strong>C&#x2F;C++ 内建模块</strong>：存放 src 目录下的最底层模块，会提供 js 调用的 API。</li>
<li><strong>Js 核心模块</strong>：存放在 lib 目录下，为 C&#x2F;C++ 内建模块提供封装和桥接。</li>
</ul>
</li>
<li><strong>文件模块</strong>：用户编写，动态加载（加载速度较慢）。<ul>
<li><strong>C++ 扩展模块</strong>：用于提高运行效率等自定义编写的底层模块。</li>
<li><strong>Js 文件模块</strong>：由第三方或用户自行编写的模块。</li>
</ul>
</li>
</ul>
<h2 id="模块缓存"><a href="#模块缓存" class="headerlink" title="模块缓存"></a>模块缓存</h2><ul>
<li>模块会在第一次 require 后被缓存，<code>多次 require 不会导致模块的代码被执行多次</code>。</li>
<li>Node 模块的缓存不同于浏览器的 js 缓存，浏览器只缓存文件，<code>Node 模块缓存的是编译和执行之后的对象</code>。</li>
<li>require.cache 对象代表 Node 模块缓存区，缓存模块以属性方式加入该对象，可以通过 <code>require.cache[&#39;模块标识符&#39;]</code> 访问具体的缓存模块，可以 delete 该缓存。</li>
</ul>
<h2 id="模块变量"><a href="#模块变量" class="headerlink" title="模块变量"></a>模块变量</h2><h3 id="全局对象"><a href="#全局对象" class="headerlink" title="全局对象"></a>全局对象</h3><ul>
<li><strong>global</strong>：表示 Node 所在的全局环境，类似于浏览器中的 window 对象。</li>
<li><strong>process</strong>：指向 Node 内置的 process 模块，允许开发者与当前进程互动。</li>
<li><strong>console</strong>：指向 Node 内置的 console 模块，提供命令行环境的标准输入、输出功能。</li>
</ul>
<h3 id="全局函数"><a href="#全局函数" class="headerlink" title="全局函数"></a>全局函数</h3><ul>
<li><strong>模块加载函数</strong>：require</li>
<li><strong>定时器函数</strong>：setTimeout、setInterval、clearTimeout、clearInterval</li>
</ul>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><ul>
<li><strong>_filename</strong>：指向当前运行脚本的文件名。</li>
<li><strong>_dirname</strong>：指向当前运行脚本所在的目录。</li>
</ul>
<h3 id="模块变量-1"><a href="#模块变量-1" class="headerlink" title="模块变量"></a>模块变量</h3><ul>
<li><strong>module</strong>：表示当前模块的对象。</li>
<li><strong>module.exports</strong>：模块的导出对象。</li>
<li><strong>module.filename</strong>：模块解析后的文件名。</li>
<li><strong>exports</strong>：指向 module.exports 对象的变量。</li>
</ul>
<h2 id="模块包规范"><a href="#模块包规范" class="headerlink" title="模块包规范"></a>模块包规范</h2><blockquote>
<p>NodeJS 采用包来对一组具有相互依赖关系的模块进行统一管理，封装为独立的复用组件或单个应用。Node的包通常为一个目录，主要包括如下内容：</p>
</blockquote>
<ul>
<li><strong>package.json</strong>：包的描述文件。</li>
<li><strong>bin</strong>：可执行文件、二进制文件。</li>
<li><strong>lib</strong>：待加载的 js 文件。</li>
<li><strong>doc</strong>：使用包的说明文档。</li>
<li><strong>test</strong>：单元测试用例代码文件。</li>
<li><strong>node_modules</strong>：本地安装包。</li>
</ul>
<h1 id="四、核心模块"><a href="#四、核心模块" class="headerlink" title="四、核心模块"></a>四、核心模块</h1><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><blockquote>
<p>处理客户端的网络请求。</p>
</blockquote>
<h3 id="作为客户端"><a href="#作为客户端" class="headerlink" title="作为客户端"></a>作为客户端</h3><ul>
<li><strong>client</strong>：连接服务器<ul>
<li>发起请求：<code>http.request(options, fn)</code></li>
<li>简化版，不用 end：<code>http.get(options, fn)</code></li>
</ul>
</li>
<li><strong>ClientRequest</strong>：处理要发送的请求信息<ul>
<li>收到请求：<code>req.on(&quot;response&quot;, fn)</code></li>
<li>收到错误：<code>req.on(&quot;error&quot;, fn)</code></li>
<li>写入数据：<code>req.write</code></li>
<li>完成发送：<code>req.end</code></li>
</ul>
</li>
<li><strong>ClientResponse</strong>：获取服务端返回信息<ul>
<li>传输数据：<code>res.on(&quot;data&quot;, fn)</code></li>
<li>传输结束：<code>res.on(&quot;end&quot;, fn)</code></li>
<li>请求关闭：<code>res.on(&quot;close&quot;, fn)</code></li>
<li>设置存储：<code>res.setEncoding</code></li>
<li>暂停请求：<code>res.pause</code></li>
<li>恢复请求：<code>res.resume</code></li>
<li>状态码：<code>res.statusCode</code></li>
<li>请求头：<code>res.headers</code></li>
</ul>
</li>
</ul>
<h3 id="作为服务端"><a href="#作为服务端" class="headerlink" title="作为服务端"></a>作为服务端</h3><ul>
<li><strong>Server</strong>：创建服务器<ul>
<li>生成实例：<code>Server()</code><ul>
<li>接收请求：<code>on(&quot;request&quot;, fn)</code></li>
<li>关闭请求：<code>on(&quot;close&quot;, fn)</code></li>
<li>监听服务：<code>listen(port, fn)</code></li>
<li>新建 TCP 流：<code>on(&quot;connection&quot;, fn)</code></li>
</ul>
</li>
<li>直接创建：<code>createServer(fn).listen(port)</code></li>
</ul>
</li>
<li><strong>IncomingMessage</strong>：获取客户端请求信息<ul>
<li>传输数据：<code>on(&quot;data&quot;, fn)</code></li>
<li>传输结束：<code>on(&quot;end&quot;, fn)</code></li>
<li>请求关闭：<code>on(&quot;close&quot;, fn)</code></li>
<li>请求方法：<code>method</code></li>
<li>请求地址：<code>url</code></li>
</ul>
</li>
<li><strong>ServerResponse</strong>：处理返回给客户端的信息res<ul>
<li>设置头信息：<code>setHead</code></li>
<li>合并头信息：<code>writeHead</code></li>
<li>写入数据：<code>write</code></li>
<li>结束传输：<code>end</code></li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 将传过来的URL转变为对象</span></span><br><span class="line">    <span class="keyword">var</span> params = url.<span class="title function_">parse</span>(req.<span class="property">url</span>,<span class="literal">true</span>)</span><br><span class="line">    res.<span class="title function_">write</span>(params.<span class="property">query</span>.<span class="property">name</span>)</span><br><span class="line">    res.<span class="title function_">end</span>()</span><br><span class="line">    <span class="comment">// res.end(params.query.name);</span></span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端请求</span></span><br><span class="line"><span class="keyword">var</span> request = http.<span class="title function_">get</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>:<span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&#x27;/user?name=tom&amp;age=22&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>:<span class="number">3000</span>&#125;,<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line">    res.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>,<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res_date：&#x27;</span>+data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><blockquote>
<p>处理客户端请求过来的 URL。</p>
</blockquote>
<ul>
<li><strong>parse</strong>：将 url 字符串地址转为一个对象。</li>
<li><strong>format</strong>：将 url 对象转为一个 url 字符串。</li>
<li><strong>resolve</strong>：对传入的两个参数用 <code>/</code> 拼接。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>)</span><br><span class="line"></span><br><span class="line">url.<span class="title function_">parse</span>(<span class="string">&quot;http://user:pass@host.com:8080/p/a/t/h?query=string#hash&quot;</span>)</span><br><span class="line">url.<span class="title function_">parse</span>(<span class="string">&quot;http://user:pass@host.com:8080/p/a/t/h?query=string#hash&quot;</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">url.<span class="title function_">format</span>(&#123;</span><br><span class="line">    <span class="attr">protocol</span>: <span class="string">&quot;http:&quot;</span>,</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;182.163.0:60&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;60&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">url.<span class="title function_">resolve</span>(<span class="string">&quot;http://whitemu.com&quot;</span>, <span class="string">&quot;gulu&quot;</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Querystring"><a href="#Querystring" class="headerlink" title="Querystring"></a>Querystring</h2><blockquote>
<p>处理客户端 get&#x2F;post 请求传递的参数。</p>
</blockquote>
<ul>
<li><strong>parse</strong>：将一个字符串反序列化为一个对象。</li>
<li><strong>stringify</strong>：将一个对象序列化成一个字符串。</li>
<li><strong>escape</strong>：使传入的字符串进行编码。</li>
<li><strong>unescape</strong>：对使用了 escape 编码的字符进行解码。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"></span><br><span class="line">querystring.<span class="title function_">parse</span>(<span class="string">&quot;name=tom&amp;sex=man&amp;sex=women&quot;</span>)</span><br><span class="line">querystring.<span class="title function_">stringify</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;tom&#x27;</span>, <span class="attr">sex</span>: [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;women&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line">querystring.<span class="built_in">escape</span>(<span class="string">&quot;name=慕白&quot;</span>)</span><br><span class="line">querystring.<span class="built_in">unescape</span>(<span class="string">&#x27;name%3D%E6%85%95%E7%99%BD&#x27;</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h2><blockquote>
<p>操作文件路径</p>
</blockquote>
<ul>
<li>获取路径信息<ul>
<li><strong>dirname</strong>：路径</li>
<li><strong>extname</strong>：扩展名</li>
<li><strong>basename</strong>：文件名</li>
</ul>
</li>
<li>路径拼接<ul>
<li><strong>join</strong>：使用当前系统的路径分隔符拼接路径。</li>
<li><strong>resolve</strong>：将相对路径拼接出绝对路径。</li>
<li><strong>relative</strong>：解析出两个路径之间的相对路径。</li>
</ul>
</li>
<li>路径处理<ul>
<li><strong>parse</strong>：路径分解而返回对象。</li>
<li><strong>format</strong>：路径组合而返回字符串。</li>
<li><strong>normalize</strong>：路径标准化。</li>
<li><strong>isAbsolute</strong>：判断路径是否为绝对路径。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">path.<span class="title function_">dirname</span>(<span class="string">&#x27;/foo/bar/baz/asdf/a.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">path.<span class="title function_">join</span>(<span class="string">&#x27;/foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz/asdf&#x27;</span>, <span class="string">&#x27;..&#x27;</span>)</span><br><span class="line">path.<span class="title function_">resolve</span>(<span class="string">&#x27;www&#x27;</span>, <span class="string">&#x27;js/upload&#x27;</span>, <span class="string">&#x27;../mod.js&#x27;</span>)</span><br><span class="line">path.<span class="title function_">relative</span>(<span class="string">&#x27;C:/test/aaa&#x27;</span>, <span class="string">&#x27;C:/bbb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">path.<span class="title function_">parse</span>(<span class="string">&#x27;/home/user/dir/file.txt&#x27;</span>)</span><br><span class="line">path.<span class="title function_">format</span>(&#123;</span><br><span class="line">    <span class="attr">dir</span>: <span class="string">&#x27;/tmp&#x27;</span>, </span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">    <span class="attr">ext</span>: <span class="string">&#x27;.js&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">path.<span class="title function_">normalize</span>(<span class="string">&#x27;a/../user/bin&#x27;</span>)</span><br><span class="line">path.<span class="title function_">isAbsolute</span>(<span class="string">&#x27;/foo/bar&#x27;</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h2><blockquote>
<p>事件处理模块。</p>
</blockquote>
  <div style="text-indent: 2em;">回调函数模式让 NodeJS 可以处理异步操作，但对于无法处理多状态的异步操作则需要进行拆分而分阶段执行。为了解决这个问题，NodeJS 提供了 Event Emitter 接口，通过事件解决多状态异步操作的响应问题。events 模块对外暴露一个 EventEmitter 类，可以用来生成事件发生器的实例 emitter，然后通过实例方法处理事件，比如 on/once 监听事件、emit 触发事件、removeListener 删除事件等。</div>
        
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模块调用</span></span><br><span class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">&quot;events&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> emitter = <span class="keyword">new</span> events.<span class="title class_">EventEmitter</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件监听</span></span><br><span class="line">emitter.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;linked Success&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件触发</span></span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&quot;connection&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="FS"><a href="#FS" class="headerlink" title="FS"></a>FS</h2><blockquote>
<p>在服务端来操作文件。默认异步操作，同步 API 则只需添加 Sync，比如 readFileSync。</p>
</blockquote>
<ul>
<li>操作文件<ul>
<li><strong>readFile</strong>：文件读取</li>
<li><strong>writeFile</strong>：文件写入</li>
<li><strong>appendFile</strong>：追加写入</li>
<li><strong>rename</strong>：文件重命名</li>
<li><strong>unlink</strong>：文件删除</li>
</ul>
</li>
<li>操作目录<ul>
<li><strong>mkdir</strong>：创建</li>
<li><strong>readdir</strong>：读取</li>
<li><strong>rmdir</strong>：删除空目录</li>
<li><strong>chmod</strong>：修改权限</li>
</ul>
</li>
<li>其它<ul>
<li><strong>stat</strong>：详细信息</li>
<li><strong>exists</strong>：判断存在</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.<span class="title function_">stat</span>(<span class="string">&#x27;input.txt&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, stats</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 大括号中只有一句语句时可以省略</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err) </span><br><span class="line"></span><br><span class="line">    stats.<span class="title function_">isFile</span>()        <span class="comment">// 是否为文件</span></span><br><span class="line">    stats.<span class="title function_">isDirectory</span>()   <span class="comment">// 是否为目录</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步写入</span></span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&#x27;input.txt&#x27;</span>, <span class="string">&#x27;写入文件的内容&#x27;</span>,  <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err) </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异步读取</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;input.txt&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err) </span><br><span class="line">        <span class="keyword">var</span> data_str = data.<span class="title function_">toString</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h2><blockquote>
<p>本质是对 buffer 对象的高级封装，它操作的底层是 buffer 对象。</p>
</blockquote>
<h3 id="流"><a href="#流" class="headerlink" title="流"></a>流</h3>  <div style="text-indent: 2em;">操作系统采用数据块（chunk）的方式读取数据，每收到一次数据就存入缓存。NodeJS 应用程序有两种缓存的处理方式：第一种是先将数据全部读入内存，然后一次性从缓存中读取，这种方式对于视频等二进制大文件很容易使内存"爆仓"。第二种是采用 数据流（stream）的方式，边读取边存入。</div>

  <div style="text-indent: 2em; margin-top: 15px;">流表示一组有序的、有起止点的字节数据的序列，但是流的数据不能一次性读取或写入。NodeJs 将关于流的操作封装到了 Stream 模块并提供了 Stream API 通过事件来实现基于流的IO操作，比如处理普通文件、网络文件 (http、net)、设备文件 (stdin、stdout)。</div>
            
            
<h3 id="流操作"><a href="#流操作" class="headerlink" title="流操作"></a>流操作</h3><ul>
<li><strong>流读取</strong>：NodeJS 不断将文件一小块内容读入缓冲区，再从缓冲区中读取内容。</li>
<li><strong>流写入</strong>：NodeJS 不断将流数据写入内在缓冲区，待缓冲区 满后再将缓冲区写入到文件中，重复操作直到完成。</li>
<li><strong>直接操作</strong>：readFile&#x2F;read、writeFile&#x2F;write 一次性读取内容或写入内存。</li>
</ul>
<h3 id="流事件"><a href="#流事件" class="headerlink" title="流事件"></a>流事件</h3><blockquote>
<p>所有 Stream 对象 都是 EventEmitter 类的实例，读写流的不同状态时就会触发相应事件。</p>
</blockquote>
<ul>
<li><strong>data</strong>：当有数据可读时触发。</li>
<li><strong>end</strong>：数据已经全部读取完毕时触发。</li>
<li><strong>error</strong>：读取或写入的过程中发生错误时触发。</li>
<li><strong>finish</strong>：所有数据都已经被写入到底层系统时触发。</li>
</ul>
<h3 id="流类型"><a href="#流类型" class="headerlink" title="流类型"></a>流类型</h3><ul>
<li><strong>Readable</strong>：从流中读取数据的 API，用于对外提供数据。</li>
<li><strong>Writable</strong>：往流中写入数据的 API，用于写入数据。</li>
<li><strong>Duplex</strong>：在流中可读写数据的 API，用于读取和写入数据。</li>
<li><strong>Transform</strong>：在读写过程中可以修改和变换数据的 Duplex 流。</li>
</ul>
<h3 id="流模式"><a href="#流模式" class="headerlink" title="流模式"></a>流模式</h3><blockquote>
<p>根据流中传递数据的类型来区分，一般需要在创建流时指定其模式而且不再修改，但是可以通过拼接转换流来进行模式转换并得到一个新的流。</p>
</blockquote>
<ul>
<li><strong>Object Mode</strong>：对象模式，即流中传递的是任意类型的 Js 对象（null 除外）。</li>
<li><strong>Buffering Mode</strong>：Buffer 模式，即流中传递的是 Buffer 对象。</li>
</ul>
<h3 id="null-对象"><a href="#null-对象" class="headerlink" title="null 对象"></a>null 对象</h3><blockquote>
<p>在流中的作用如下：</p>
</blockquote>
<ul>
<li>向 Writable 流中写入 null，表示数据源的数据已经写入完成，继续写入数据则会报错。</li>
<li>从 Readable 流中读取到 null，表示所有数据已经读取完毕，流中不会再有可读取的数据。</li>
</ul>
<h3 id="流的拼接"><a href="#流的拼接" class="headerlink" title="流的拼接"></a>流的拼接</h3>  <div style="text-indent: 2em;">就像可以把两个水管串成一个更长的水管一样，一个 Readable 流和一个 Writable 流串起来后，所有的数据自动从 Readable 流进入 Writable 流。Readable API 提供了 pipe 方法用于流的拼接，但注意位于中间的流必须是 Duplex 流。</div>


<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 读取数据流</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">// 创建可读流，即将文件内容读取为流数据</span></span><br><span class="line"><span class="keyword">var</span> readStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>) </span><br><span class="line">readStream.<span class="title function_">setEncoding</span>(<span class="string">&#x27;UTF8&#x27;</span>)  </span><br><span class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></span><br><span class="line">readStream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">chunk</span>) &#123;</span><br><span class="line">    data += chunk</span><br><span class="line">&#125;)</span><br><span class="line">readStream.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line">readStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入流</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;要写入的内容&#x27;</span></span><br><span class="line"><span class="comment">// 创建可写流并写入到文件中</span></span><br><span class="line"><span class="keyword">var</span> writeStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;output.txt&#x27;</span>)</span><br><span class="line">writeStream.<span class="title function_">write</span>(data, <span class="string">&#x27;UTF8&#x27;</span>)</span><br><span class="line">writeStream.<span class="title function_">write</span>(<span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="string">&#x27;使用Stream写入二进制数据...\n&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>));</span><br><span class="line">writeStream.<span class="title function_">end</span>()   <span class="comment">// 标记文件末尾</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></span><br><span class="line">writeStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入完成。&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">writeStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 管道流</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 创建一个可读流</span></span><br><span class="line"><span class="keyword">var</span> readStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">encoding</span>:<span class="string">&#x27;utf8&#x27;</span>,  <span class="comment">// 不传默认buffer，显示为字符串</span></span><br><span class="line">        <span class="attr">start</span>:<span class="number">3</span>,          <span class="comment">// 从索引为3的位置开始读</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 创建一个可写流</span></span><br><span class="line"><span class="keyword">var</span> writeStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;output.txt&#x27;</span>);</span><br><span class="line"><span class="comment">// 管道读写操作：读取 input.txt 内容并将内容写入到 output.txt</span></span><br><span class="line">readeStream.<span class="title function_">pipe</span>(writeStream);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式流：链式是通过连接输出流到另外一个流并创建多个对个流操作链的机制</span></span><br><span class="line"><span class="comment">// 链式流一般用于管道操作。以下是用管道和链式来压缩和解压文件</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;test dfddgfdgfdgfdgfd jkwu&#x27;</span></span><br><span class="line"><span class="comment">// 压缩 input.txt 文件为 input.txt.gz</span></span><br><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(zlib.<span class="title function_">createGzip</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>))</span><br><span class="line"><span class="comment">// 解压 input.txt.gz 文件为 input.txt</span></span><br><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(zlib.<span class="title function_">createGunzip</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">       </span><br><span class="line"><span class="comment">// HTTP 对象使用 Stream 接口，实现网络数据的读写</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> body = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    req.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">chunk</span>) &#123;</span><br><span class="line">        body += chunk</span><br><span class="line">    &#125;);</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(body);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">            res.<span class="property">statusCode</span> = <span class="number">400</span>;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&#x27;error: &#x27;</span> + er.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">write</span>(<span class="keyword">typeof</span> data);</span><br><span class="line">        res.<span class="title function_">end</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> stream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;filename.txt&#x27;</span>)</span><br><span class="line">    stream</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, onerror)</span><br><span class="line">    .<span class="title function_">pipe</span>(zlib.<span class="title function_">createGzip</span>())</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, onerror)</span><br><span class="line">    .<span class="title function_">pipe</span>(res)</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">onFinished</span>(res, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      stream.<span class="title function_">destroy</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="util"><a href="#util" class="headerlink" title="util"></a>util</h2><blockquote>
<p>提供一系列实用方法，注意需要安装 npm install util。</p>
</blockquote>
<ul>
<li>格式化字符串：<code>format</code></li>
<li>数据类型验证：<code>isDate、isArray、isError、isRegExp</code></li>
<li>其它：<code>inherits (继承)、inspect (对象转化为字符串)</code></li>
</ul>
<h1 id="五、Web-开发"><a href="#五、Web-开发" class="headerlink" title="五、Web 开发"></a>五、Web 开发</h1><h2 id="搭建-web-服务器"><a href="#搭建-web-服务器" class="headerlink" title="搭建 web 服务器"></a>搭建 web 服务器</h2><h3 id="通过插件"><a href="#通过插件" class="headerlink" title="通过插件"></a>通过插件</h3><blockquote>
<p>http-server、live-server</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install http-server -g</span><br><span class="line">cd progect      <span class="comment">// 进入项目目录</span></span><br><span class="line">http-server     <span class="comment">// 开启服务</span></span><br></pre></td></tr></table></figure>


<h3 id="通过-NodeJs"><a href="#通过-NodeJs" class="headerlink" title="通过 NodeJs"></a>通过 NodeJs</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令行第三个参数，用来接收目录，可为空，相对当前server.js的目录名称</span></span><br><span class="line"><span class="comment">// 比如 node server debug，则 debug 文件夹与 server.js 文件同级并以 debug 启动服务</span></span><br><span class="line"><span class="keyword">var</span> dir, arg = process.<span class="property">argv</span>[<span class="number">2</span>] || <span class="string">&#x27;&#x27;</span>; </span><br><span class="line"></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> pathname = **dirname + url.<span class="title function_">parse</span>(req.<span class="property">url</span>).<span class="property">pathname</span>;</span><br><span class="line">    <span class="comment">// 保存 dir (目录)</span></span><br><span class="line">    dir = dir ? dir : pathname; </span><br><span class="line">    <span class="comment">// 替换文件静态路径</span></span><br><span class="line">    pathname = dir ? pathname.<span class="title function_">replace</span>(dir, dir + arg + <span class="string">&#x27;/&#x27;</span>) : pathname; </span><br><span class="line">    <span class="keyword">if</span> (path.<span class="title function_">extname</span>(pathname) == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        pathname += <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pathname.<span class="title function_">charAt</span>(pathname.<span class="property">length</span> - <span class="number">1</span>) == <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 入口文件，此处默认index.html</span></span><br><span class="line">        pathname += <span class="string">&quot;index.html&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">exists</span>(pathname, <span class="keyword">function</span> (<span class="params">exists</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (path.<span class="title function_">extname</span>(pathname)) &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&quot;.html&quot;</span>:</span><br><span class="line">                  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/html&quot;</span>&#125;);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&quot;.js&quot;</span>:</span><br><span class="line">                  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/javascript&quot;</span>&#125;);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&quot;.css&quot;</span>:</span><br><span class="line">                  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/css&quot;</span>&#125;);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&quot;.gif&quot;</span>:</span><br><span class="line">                  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;image/gif&quot;</span>&#125;);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&quot;.jpg&quot;</span>:</span><br><span class="line">                  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;image/png&quot;</span>&#125;);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&quot;.png&quot;</span>:</span><br><span class="line">                  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;image/png&quot;</span>&#125;);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="attr">default</span>:</span><br><span class="line">                  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/octet-stream&quot;</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// res 可以自己添加信息来简单交互 比如可以修改 header 信息、修改返回数据</span></span><br><span class="line">            fs.<span class="title function_">readFile</span>(pathname, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">                res.<span class="title function_">end</span>(data);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">writeHead</span>(<span class="number">404</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/html&quot;</span>&#125;);</span><br><span class="line">            res.<span class="title function_">end</span>(<span class="string">&quot;Not Found&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">9090</span>, <span class="string">&quot;127.0.0.1&quot;</span>); <span class="comment">// 服务器端口</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;server running at http://127.0.0.1:9090/&quot;</span>);</span><br></pre></td></tr></table></figure>



<h2 id="连接-mysql"><a href="#连接-mysql" class="headerlink" title="连接 mysql"></a>连接 mysql</h2><blockquote>
<p>安装 mysql 及其驱动：npm install mysql node-mysql -g     </p>
</blockquote>
<h3 id="直接连接"><a href="#直接连接" class="headerlink" title="直接连接"></a>直接连接</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> mysql = <span class="built_in">require</span>(<span class="string">&quot;mysql&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> connection = mysql.<span class="title function_">createConnection</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,      <span class="comment">// 主机</span></span><br><span class="line">    <span class="attr">user</span>: <span class="string">&quot;root&quot;</span>,           <span class="comment">// 用户名</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">&quot;xxxxx&quot;</span>,      <span class="comment">// 用户密码</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;3306&quot;</span>,           <span class="comment">// 端口号</span></span><br><span class="line">    <span class="attr">database</span>: <span class="string">&quot;mysql&quot;</span>       <span class="comment">// 数据库名</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line">connection.<span class="title function_">connect</span>(<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`mysql connect fail: <span class="subst">$&#123;err&#125;</span>!`</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;mysql connect success!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行查询</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> sqlQuery = <span class="string">&quot;select * from students&quot;</span>;</span><br><span class="line">connection.<span class="title function_">query</span>(sqlQuery, <span class="keyword">function</span>(<span class="params">err, result</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`SQL error: <span class="subst">$&#123;err&#125;</span>!`</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        str = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回数据</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(str)</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server running at localhost:3000&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭connection  </span></span><br><span class="line">connection.<span class="title function_">end</span>(<span class="keyword">function</span>(<span class="params">err</span>)&#123;  </span><br><span class="line">    <span class="keyword">if</span>(err)&#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="title function_">toString</span>());</span><br><span class="line">        <span class="keyword">return</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[connection end] succeed!&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="通过连接池"><a href="#通过连接池" class="headerlink" title="通过连接池"></a>通过连接池</h3><blockquote>
<p>数据库连接池负责分配、管理和释放数据库连接，它允许应用程序重复使用一个现有的数据库连接而不是再重新建立一个，用于对数据库操作的性能。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pool = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,      <span class="comment">// 主机</span></span><br><span class="line">    <span class="attr">user</span>: <span class="string">&quot;root&quot;</span>,           <span class="comment">// 用户名</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">&quot;xxxxx&quot;</span>,      <span class="comment">// 用户密码</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;3306&quot;</span>,           <span class="comment">// 端口号</span></span><br><span class="line">    <span class="attr">database</span>: <span class="string">&quot;mysql&quot;</span>       <span class="comment">// 数据库名</span></span><br><span class="line">&#125;)</span><br><span class="line">pool.<span class="title function_">getConnection</span>(<span class="keyword">function</span>(<span class="params">err, connection</span>) &#123;</span><br><span class="line">    connection.<span class="title function_">query</span>(<span class="string">&#x27;select * from students&#x27;</span>, [], <span class="keyword">function</span>(<span class="params">err, result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error: &quot;</span> + err.<span class="property">message</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        connection.<span class="title function_">release</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h2>  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/file_upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;image&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> multer  = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// dest 定义上传目录，array 限制上传类型（即 input name）　</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">multer</span>(&#123; <span class="attr">dest</span>: <span class="string">&#x27;./uploads&#x27;</span>&#125;).<span class="title function_">array</span>(<span class="string">&#x27;image&#x27;</span>));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>( **dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;index.html&quot;</span> );</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/file_upload&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">files</span>[<span class="number">0</span>]);  <span class="comment">// 上传的文件信息</span></span><br><span class="line">    <span class="keyword">var</span> des_file = **dirname + <span class="string">&quot;/&quot;</span> + req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">originalname</span>;</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">readFile</span>( req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">path</span>, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">        fs.<span class="title function_">writeFile</span>(des_file, data, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                response = &#123;</span><br><span class="line">                    <span class="attr">message</span>: <span class="string">&#x27;File uploaded successfully&#x27;</span>, </span><br><span class="line">                    <span class="attr">filename</span>: req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">originalname</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>( response );</span><br><span class="line">            res.<span class="title function_">end</span>( <span class="title class_">JSON</span>.<span class="title function_">stringify</span>( response ) );</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;localhost:3000&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行命令</span></span><br><span class="line">npm install multer body-parser -S</span><br><span class="line">node server.<span class="property">js</span></span><br></pre></td></tr></table></figure>


<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><h3 id="通过-ws-模块"><a href="#通过-ws-模块" class="headerlink" title="通过 ws 模块"></a>通过 ws 模块</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">cnpm i ws -S</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端js</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">WebSocket</span> != <span class="literal">undefined</span>) &#123;  </span><br><span class="line">    <span class="comment">//创建一个WebSocket，监听端口6060端口，这里必须是：ws，不能是http</span></span><br><span class="line">    <span class="keyword">var</span> connection = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:6060&#x27;</span>); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// readyState : 0：正在连接、1：连接成功、2：正在关闭、3：连接关闭</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(connection.<span class="property">readyState</span>); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 握手协议成功以后，readyState就从0变为1，并触发open事件  </span></span><br><span class="line">    connection.<span class="property">onopen</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;   </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(event);</span><br><span class="line">        <span class="comment">//连接建立后，客户端通过send方法向服务器端发送数据。   </span></span><br><span class="line">        connection.<span class="title function_">send</span>(<span class="string">&#x27;client message&#x27;</span>); </span><br><span class="line">    &#125;;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//监听  </span></span><br><span class="line">    connection.<span class="property">onmessage</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;   </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(event);  </span><br><span class="line">    &#125;;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭WebSocket连接，会触发close事件。  </span></span><br><span class="line">    connection.<span class="property">onclose</span> = <span class="function">() =&gt;</span> &#123;   </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Closed&quot;</span>);  </span><br><span class="line">    &#125;;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//出现错误  </span></span><br><span class="line">    connection.<span class="property">onerror</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;   </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error: &quot;</span> + event.<span class="property">data</span>);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器 server.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动 WebSocket 服务器</span></span><br><span class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).<span class="title function_">createServer</span>() , </span><br><span class="line">    <span class="title class_">WebSocketServer</span> = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>).<span class="property">Server</span> , </span><br><span class="line">    wss = <span class="keyword">new</span> <span class="title class_">WebSocketServer</span>(&#123; <span class="attr">server</span>: server &#125;) , </span><br><span class="line">    app = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)() , </span><br><span class="line">    port = <span class="number">6060</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 express 中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123; </span><br><span class="line">    <span class="comment">//send用来向客户端发送信息，on用来接收/监听客户端发来的信息</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123; <span class="attr">msg</span>: <span class="string">&quot;hello&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 监听事件  %s 字符串、%d 整数、%f 浮点数</span></span><br><span class="line">wss.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="keyword">function</span> <span class="title function_">connection</span>(<span class="params">ws</span>) &#123; </span><br><span class="line">    <span class="comment">//监听 </span></span><br><span class="line">    ws.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span> <span class="title function_">incoming</span>(<span class="params">message</span>) &#123;  </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;received: %s&#x27;</span>, message);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//发送 </span></span><br><span class="line">    ws.<span class="title function_">send</span>(<span class="string">&#x27;something&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, app);</span><br><span class="line">server.<span class="title function_">listen</span>(port, <span class="keyword">function</span> (<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;http://localhost:&#x27;</span> + server.<span class="title function_">address</span>().<span class="property">port</span>) </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="通过-socket-io"><a href="#通过-socket-io" class="headerlink" title="通过 socket.io"></a>通过 socket.io</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">cnpm i socket.<span class="property">io</span> -S</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端 js (需要引入 socket.io.js)</span></span><br><span class="line"><span class="keyword">var</span> socket = io.<span class="title function_">connect</span>(<span class="string">&#x27;http://localhost:8080&#x27;</span>)  </span><br><span class="line">socket.<span class="title function_">on</span>(<span class="string">&#x27;news&#x27;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;   </span><br><span class="line">    socket.<span class="title function_">emit</span>(<span class="string">&#x27;event&#x27;</span>, &#123; <span class="attr">my</span>: <span class="string">&#x27;data&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器 server.js</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).<span class="title function_">createServer</span>(handler), </span><br><span class="line">    io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>).<span class="title function_">listen</span>(app), </span><br><span class="line">    fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br><span class="line">io.<span class="title function_">set</span>(<span class="string">&#x27;log level&#x27;</span>, <span class="number">1</span>)  <span class="comment">// 关闭 debug 信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handler</span> (req, res) &#123;</span><br><span class="line">  fs.<span class="title function_">readFile</span>(**dirname + <span class="string">&#x27;/index.html&#x27;</span>,<span class="keyword">function</span> (<span class="params">err, data</span>) &#123;  </span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        res.<span class="title function_">writeHead</span>(<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&#x27;Error loading index.html&#x27;</span>);</span><br><span class="line">      &#125;    </span><br><span class="line">      res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;);    </span><br><span class="line">      res.<span class="title function_">end</span>(data);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">io.<span class="property">sockets</span>.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="keyword">function</span> (<span class="params">socket</span>) &#123;</span><br><span class="line">    socket.<span class="title function_">emit</span>(<span class="string">&#x27;news&#x27;</span>, &#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;);</span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;my other event&#x27;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="解决跨域"><a href="#解决跨域" class="headerlink" title="解决跨域"></a>解决跨域</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cnpm install cors --save</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js 加入代码</span></span><br><span class="line"><span class="keyword">var</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>(&#123;</span><br><span class="line">    <span class="attr">origin</span>:[<span class="string">&#x27;http://localhost:8080&#x27;</span>],  <span class="comment">//指定接收的地址</span></span><br><span class="line">    <span class="attr">methods</span>:[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>],            <span class="comment">// 指定接收的请求类型</span></span><br><span class="line">    <span class="attr">alloweHeaders</span>:[<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;Authorization&#x27;</span>]  <span class="comment">// 指定 header</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>JS 扩展</category>
      </categories>
      <tags>
        <tag>JS 扩展</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue 常见场景的解决方案</title>
    <url>/2019/06/10/5-2-vue%E5%B8%B8%E8%A7%81%E5%9C%BA%E6%99%AF/</url>
    <content><![CDATA[<h1 id="一、路由控制"><a href="#一、路由控制" class="headerlink" title="一、路由控制"></a>一、路由控制</h1><blockquote>
<p>Token 是包含用户名、有效期和某些专有信息并通过共享密钥加密的信息字符串。</p>
</blockquote>
<h2 id="登录验证"><a href="#登录验证" class="headerlink" title="登录验证"></a>登录验证</h2><ol>
<li>客户端发送用户名和密码请求登录，服务端收到进行验证。</li>
<li>服务端验证成功后生成唯一的 Token 存储在数据库并返回给客户端。</li>
<li>客户端收到 Token 后通过 Cookie、Vuex 等方式存储。</li>
<li>客户端每次向服务端请求资源时都携带 Token。</li>
<li>服务端收到请求后去验证 Token，验证成功则返回数据。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端路由验证</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="built_in">require</span>(<span class="string">&#x27;./views/Home&#x27;</span>),</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span>  &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">requireAuth</span>) &#123;    </span><br><span class="line">      <span class="keyword">if</span> (store.<span class="property">state</span>.<span class="property">token</span>) &#123;  </span><br><span class="line">          <span class="title function_">next</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 记录目标路由，用于登录成功后直接跳转</span></span><br><span class="line">          <span class="title function_">next</span>(&#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">            <span class="attr">query</span>: &#123;<span class="attr">redirect</span>: to.<span class="property">fullPath</span>&#125;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端验证</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (store.<span class="property">state</span>.<span class="property">token</span>) &#123;  </span><br><span class="line">        config.<span class="property">headers</span>[<span class="string">&#x27;Token&#x27;</span>] = store.<span class="property">state</span>.<span class="property">token</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;)</span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">res</span>.<span class="property">status</span> == <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="comment">// 清除 token 信息并跳转到登录页面</span></span><br><span class="line">        store.<span class="title function_">commit</span>(<span class="string">&quot;token_clear&quot;</span>);</span><br><span class="line">        router.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">          <span class="attr">query</span>: &#123;<span class="attr">redirect</span>: router.<span class="property">currentRoute</span>.<span class="property">fullPath</span>&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error.<span class="property">response</span>.<span class="property">data</span>)   </span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>


<h2 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h2><blockquote>
<p>路由表一般由 Vuex 管理。</p>
</blockquote>
<ol>
<li>初始化路由时挂载登录、注册等公共组件。</li>
<li>用户登录后，客户端获取服务器返回的路由数据。</li>
<li>客户端触发 vuex 相关方法生成用户可访问的路由表。</li>
<li>动态挂载路由方法 router.addRoutes。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端初始化路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@//components/login&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;404&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@//components/404&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后端返回的路由数据 addRouter</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="string">&quot;home&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/userinfo&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="string">&quot;userInfo&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// vuex 添加路由表</span></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  [<span class="variable constant_">ADD_ROUTES</span>](state, addrouter) &#123;</span><br><span class="line">    <span class="keyword">let</span> routes = []</span><br><span class="line">    <span class="title function_">generaRouter</span>(routes, addRouter)</span><br><span class="line">    router.<span class="title function_">addRoutes</span>(routes)  </span><br><span class="line">    router.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="title function_">add_Routes</span>(<span class="params">&#123;commit&#125;, addrouter</span>) &#123;</span><br><span class="line">    <span class="title function_">commit</span>(<span class="variable constant_">ADD_ROUTES</span>, addrouter)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generaRouter</span>(<span class="params">routers, data</span>)&#123;</span><br><span class="line">  data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> menu = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, item)</span><br><span class="line">    menu.<span class="property">component</span> = <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">`@/components/<span class="subst">$&#123;menu.component&#125;</span>.vue`</span>)</span><br><span class="line">    <span class="keyword">if</span>(item.<span class="property">children</span>)&#123;</span><br><span class="line">        menu.<span class="property">children</span> = []</span><br><span class="line">        <span class="title function_">generaRouter</span>(menu.<span class="property">children</span>,item.<span class="property">children</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    routers.<span class="title function_">push</span>(menu)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js 用户手动刷新页面时重新新增路由</span></span><br><span class="line"><span class="keyword">if</span> (sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;user&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">let</span> routes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;routes&#x27;</span>))</span><br><span class="line">    store.<span class="title function_">dispatch</span>(<span class="string">&quot;add_Routes&quot;</span>, routes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="二、数据加密"><a href="#二、数据加密" class="headerlink" title="二、数据加密"></a>二、数据加密</h1><h2 id="安全需求"><a href="#安全需求" class="headerlink" title="安全需求"></a>安全需求</h2><blockquote>
<p>前后端的传输通过 HTTP 进行传输，也带来了一些安全问题，如果抓包、模拟请求、洪水攻击、参数劫持、网络爬虫等都能够获取请求的数据包。所以项目可能需要在 http 请求中添加安全级别，常用方式如下：</p>
</blockquote>
<ul>
<li>采用 HTTPS 协议。<ul>
<li>普通的 HTTP 协议是以明文形式进行传输，不提供任何方式的数据加密，很容易解读传输报文。</li>
<li>HTTPS 协议在 HTTP 基础上加入了 SSL 层，而 SSL 层通过证书来验证服务器身份，并为浏览器和服务器之间的通信加密，保护了传输过程中的数据安全。</li>
</ul>
</li>
<li>对请求参数进行合法性校验。</li>
<li>对请求参数进行签名认证，防止参数被篡改。</li>
<li>请求隐私接口，利用 token 机制校验其合法性。</li>
<li>密钥存储到服务端而非客户端，客户端应从服务端动态获取密钥。</li>
<li>对输入输出参数进行加密，客户端加密输入参数，服务端加密输出参数。</li>
</ul>
<h2 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h2><ul>
<li><strong>对称加密算法</strong>：加密与解密密钥相同，主要可分为序列算法（对明文的一个单位运算）、分组算法（对明文的一组运算）。<ul>
<li><code>DES</code>：一种分组密码，以 64 位为分组对数据加密，密钥长度是 56 位。</li>
<li><code>3DES</code>：基于 DES 的对称算法，对一块数据用三个不同密钥加密三次，强度更高。</li>
<li><code>AES</code>：密码学中的高级加密标准，它采用对称分组密码体制，密钥长度的最少支持为 128、192、256 ，分组长度 128 位，算法应易于各种硬件和软件实现。</li>
</ul>
</li>
<li><strong>非对称算法</strong>：加密密钥与解密密钥不同。<ul>
<li><code>RSA</code>：目前最有影响力的公钥加密算法，可用于签名和加密。</li>
<li><code>DSA</code>：基于整数有限域离散对数难题，主要特点是两个素数公开，只用于签名。</li>
</ul>
</li>
<li><strong>散列算法</strong><ul>
<li><code>MD5</code>：单向加密的消息摘要算法(不可解密)，常用于密码认证、登陆认证。</li>
<li><code>SHA1</code>：一种比 MD5 安全性强的消息摘要算法，主要用于标准的数字签名算法。</li>
</ul>
</li>
<li><strong>其它</strong>：不需要密钥。<ul>
<li><code>Base64</code>：并非真正的加密算法，是一种用于传输 8bit 字节代码的数据编码方式，可用于 http 传递较长的标识信息。</li>
</ul>
</li>
</ul>
<h2 id="AES-加密"><a href="#AES-加密" class="headerlink" title="AES 加密"></a>AES 加密</h2><blockquote>
<p>密钥是用来加密明文的密码，不可以直接在网络上传输。加密参数和实现流程主要如下：</p>
</blockquote>
<ul>
<li><code>key length</code>：密钥位数、密码长度。</li>
<li><code>key</code>：密钥、密码。</li>
<li><code>IV</code>：初始向量（密钥偏移量），加密和解密需要相同值。</li>
<li><code>mode</code>：加密模式，分为 ECB、CBC、CFB 等，只有 ECB 没有 IV 会不太安全。</li>
<li><code>padding</code>：填充方式，分为 PKCS5、PKCS7、NOPADDING，加解密需要相同模式。</li>
</ul>
  <div align="center">
      <img src="/images/vue/crypto.png" alt="AES 加密" width="100%">
  </div>


<h2 id="vue-加密"><a href="#vue-加密" class="headerlink" title="vue 加密"></a>vue 加密</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tool.js：封装加密算法，注意安装插件 npm i crypto-js -D</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机整数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">random</span>(<span class="params">min, max</span>)&#123;</span><br><span class="line">   <span class="keyword">if</span>(max == <span class="literal">null</span>)&#123;</span><br><span class="line">        max = min;  </span><br><span class="line">        min = <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> min + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*(max-min+<span class="number">1</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** randomWord 产生任意长度随机字母数字组合</span></span><br><span class="line"><span class="comment">** randomFlag-是否任意长度 min-任意长度最小位[固定位数] max-任意长度最大位</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">randomWord</span>(<span class="params">randomFlag, min, max</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    range = min,</span><br><span class="line">    arr = [<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>];</span><br><span class="line">    <span class="comment">// 随机产生</span></span><br><span class="line">    <span class="keyword">if</span>(randomFlag)&#123;</span><br><span class="line">        range = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max-min)) + min;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; range; i++)&#123;</span><br><span class="line">        pos = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (arr.<span class="property">length</span>-<span class="number">1</span>));</span><br><span class="line">        str += arr[pos];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* crypto-js</span></span><br><span class="line"><span class="comment">* word：待加密或者解密的字符串</span></span><br><span class="line"><span class="comment">* keyStr：AES 加密需要用到的16位字符串的key</span></span><br><span class="line"><span class="comment">* @author: shichuang</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CryptoJS</span> <span class="keyword">from</span> <span class="string">&#x27;crypto-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encrypt</span>(<span class="params">data, key, iv</span>)&#123;</span><br><span class="line">    key  = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(key);</span><br><span class="line">    <span class="comment">// iv = CryptoJS.enc.Utf8.parse(iv);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(data, key, &#123;</span><br><span class="line">          <span class="comment">// iv, mode: CryptoJS.mode.CBC</span></span><br><span class="line">          <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">ECB</span>, </span><br><span class="line">          <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decrypt</span>(<span class="params">data, key, iv</span>)&#123;</span><br><span class="line">    key  = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(key);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> decrypt = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(data, key, &#123;</span><br><span class="line">          <span class="comment">// iv, mode: CryptoJS.mode.CBC</span></span><br><span class="line">          <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line">          <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">stringify</span>(decrypt).<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AES 对称秘钥加密</span></span><br><span class="line"><span class="keyword">const</span> aes = &#123;</span><br><span class="line">    <span class="attr">en</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title function_">getAesString</span>(data, <span class="variable constant_">KP</span>.<span class="property">key</span>),</span><br><span class="line">    <span class="attr">de</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title function_">getDAesString</span>(data, <span class="variable constant_">KP</span>.<span class="property">key</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// BASE64</span></span><br><span class="line"><span class="keyword">const</span> base64 = &#123;</span><br><span class="line">    <span class="attr">en</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">stringify</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(data)),</span><br><span class="line">    <span class="attr">de</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">parse</span>(data).<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// SHA256</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sha256</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="title class_">SHA256</span>(data).<span class="title function_">toString</span>();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// MD5</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">md5</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(data).<span class="title function_">toString</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 签名</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> token 身份令牌：store.state.token</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> timestamp 签名时间戳：new Date().getTime()</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> data 签名数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sign</span> = (<span class="params">token, timestamp, data</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 签名格式： timestamp + token + data (字典升序)</span></span><br><span class="line">    <span class="keyword">let</span> ret = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> it <span class="keyword">in</span> data) &#123;</span><br><span class="line">        <span class="keyword">let</span> val = data[it];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span> &amp;&amp; (!(val <span class="keyword">instanceof</span> <span class="title class_">Array</span>) || </span><br><span class="line">        (val.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; (<span class="keyword">typeof</span> val[<span class="number">0</span>] === <span class="string">&#x27;object&#x27;</span>)))) &#123;</span><br><span class="line">            val = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(val);</span><br><span class="line">        &#125;</span><br><span class="line">        ret.<span class="title function_">push</span>(it + val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 字典升序</span></span><br><span class="line">    ret.<span class="title function_">sort</span>();</span><br><span class="line">    <span class="keyword">let</span> signsrc = timestamp + token + ret.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">md5</span>(signsrc);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    aes,</span><br><span class="line">    md5,</span><br><span class="line">    sha256,</span><br><span class="line">    base64,</span><br><span class="line">    sign</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// axios.js：数据加解密</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;random, randomWord, aes&#125; <span class="keyword">from</span> <span class="string">&quot;./tool.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ajax = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_URL</span>,   <span class="comment">// url 前缀</span></span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">10000</span>,                     <span class="comment">// 超时毫秒数</span></span><br><span class="line">    <span class="attr">withCredentials</span>: <span class="literal">true</span>               <span class="comment">// 携带认证信息 cookie</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">KP</span> = &#123;</span><br><span class="line">            <span class="attr">key</span>: <span class="title function_">randomWord</span>(<span class="literal">true</span>, <span class="number">16</span>, <span class="number">20</span>),  <span class="comment">// 秘钥</span></span><br><span class="line">            <span class="attr">iv</span>: <span class="title function_">randomWord</span>(<span class="literal">true</span>, <span class="number">16</span>, <span class="number">20</span>)    <span class="comment">// 偏移量</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 加密</span></span><br><span class="line">        config.<span class="property">data</span> = aes.<span class="title function_">en</span>(config.<span class="property">data</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置表头  &#x27;application/json&#x27;</span></span><br><span class="line">        config.<span class="property">headers</span> = &#123;</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>,</span><br><span class="line">            <span class="attr">url</span>: config.<span class="property">url</span>,</span><br><span class="line">            <span class="attr">method</span>: config.<span class="property">method</span>,</span><br><span class="line">            <span class="attr">shareKey</span>: <span class="variable constant_">KP</span>.<span class="property">key</span>,</span><br><span class="line">            <span class="attr">shareIv</span>: <span class="variable constant_">KP</span>.<span class="property">iv</span>,</span><br><span class="line">            <span class="attr">timestamp</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>(),  <span class="comment">// 时间戳</span></span><br><span class="line">            <span class="attr">token</span>: store.<span class="property">state</span>.<span class="property">token</span>,</span><br><span class="line">            <span class="attr">requestStr</span>: <span class="title function_">random</span>(<span class="number">100</span>, <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> url 请求 url</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> method get、post</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> params 参数</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> level 0：无加密，1：参数加密，2：签名+时间戳，默认0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_request</span> (url, methods, data = <span class="literal">undefined</span>, params = &#123;&#125;, level = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">service</span>(&#123;</span><br><span class="line">            <span class="attr">method</span>: methods,</span><br><span class="line">            <span class="attr">url</span>: url,</span><br><span class="line">            <span class="attr">data</span>: data,</span><br><span class="line">            <span class="attr">params</span>: <span class="title class_">Object</span>.<span class="title function_">assign</span>(params),</span><br><span class="line">            <span class="attr">headers</span>: &#123; level &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">resolve</span>(response.<span class="property">data</span>)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="三、数据更新"><a href="#三、数据更新" class="headerlink" title="三、数据更新"></a>三、数据更新</h1><h2 id="重置组件数据"><a href="#重置组件数据" class="headerlink" title="重置组件数据"></a>重置组件数据</h2><blockquote>
<p>this.$data 当前状态下的数据、this.$options.data() 该组件初始状态下的数据。</p>
</blockquote>
<ul>
<li>表单：<code>this.form = this.$options.data().form</code></li>
<li>组件：<code>Object.assign(this.$data, this.$options.data())</code></li>
</ul>
<h2 id="更新路由数据"><a href="#更新路由数据" class="headerlink" title="更新路由数据"></a>更新路由数据</h2><blockquote>
<p>路由变化后页面数据并未更新，原因是跳转前后使用同一个组件，vue-router 默认复用组件而没有执行 created 等生命周期钩子。</p>
</blockquote>
<ul>
<li>普通方案：监听 $route 变化来初始化数据 <code>watch: &#123; &#39;$route&#39;: &#123;handler: &#39;resetData&#39;,immediate: true&#125; &#125;</code>。</li>
<li>简单方案：监听路由地址变化来重新创建组件 <code>&lt;router-view :key=&quot;$route.fullPath&quot;&gt;&lt;/router-view&gt;</code>。</li>
</ul>
<h2 id="页面刷新方法"><a href="#页面刷新方法" class="headerlink" title="页面刷新方法"></a>页面刷新方法</h2><ul>
<li><code>router.go(0)</code>：兼容性不好</li>
<li><code>window.location.reload()</code>：会清空 vuex 数据</li>
<li><code>provice + inject</code>：推荐使用</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根组件定义：router-view v-if=&quot;isRouterAlive&quot;\</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">    provide ()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">reload</span>: <span class="variable language_">this</span>.<span class="property">reload</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">isRouterAlive</span>: <span class="literal">true</span>  &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>:&#123;</span><br><span class="line">        reload () &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isRouterAlive</span> = <span class="literal">false</span></span><br><span class="line">            <span class="variable language_">this</span>.$nextTick(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isRouterAlive</span> = <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件引用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">inject</span>: [<span class="string">&#x27;reload&#x27;</span>],</span><br><span class="line">    <span class="attr">method</span>: &#123;</span><br><span class="line">        <span class="title function_">fn</span>(<span class="params"></span>)&#123; <span class="variable language_">this</span>.<span class="title function_">reload</span>() &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="数据更新问题"><a href="#数据更新问题" class="headerlink" title="数据更新问题"></a>数据更新问题</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 刷新网页后 vuex 数据丢失的解决方案  </span></span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;store&quot;</span>) ) &#123;</span><br><span class="line">        <span class="keyword">let</span> storeData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;store&quot;</span>))</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">replaceState</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>, storeData))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;beforeunload&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;store&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新对象或数组后对应的视图值却不刷新</span></span><br><span class="line">更新对象：<span class="variable language_">this</span>.$set(obj, key, value)</span><br><span class="line">更新数组：<span class="variable language_">this</span>.$set(arr, index, value)</span><br></pre></td></tr></table></figure>


<h1 id="四、页面缓存"><a href="#四、页面缓存" class="headerlink" title="四、页面缓存"></a>四、页面缓存</h1><h2 id="组件缓存"><a href="#组件缓存" class="headerlink" title="组件缓存"></a>组件缓存</h2><blockquote>
<p>缓存组件只会在首次进入时执行一次生命周期钩子，再次进入则从缓存中获取数据等。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">全部缓存</span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line">部分缓存</span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&quot;a, b&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">router-view</span>/&gt;</span><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">exclude</span>=<span class="string">&quot;a, b&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line">export default new Router([</span><br><span class="line">    &#123;</span><br><span class="line">        path: &#x27;/&#x27;,</span><br><span class="line">        name: &#x27;home&#x27;,</span><br><span class="line">        component: Home,</span><br><span class="line">        meta: &#123;</span><br><span class="line">            keepAlive: true   // 需要被缓存</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-if</span>=<span class="string">&quot;$route.meta.keepAlive&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-if</span>=<span class="string">&quot;!$route.meta.keepAlive&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="旧版本缓存"><a href="#旧版本缓存" class="headerlink" title="旧版本缓存"></a>旧版本缓存</h2><blockquote>
<p>浏览器缓存会导致 vue 打包的文件偶尔会出现不能更新最新的打包代码，因此在打包的文件名中添加一个版本号以便浏览器能区分。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue.config.js：解决 js 缓存问题</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Timestamp</span> = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">configureWebpack</span>: &#123;    <span class="comment">// webpack 配置</span></span><br><span class="line">    <span class="attr">output</span>: &#123;            <span class="comment">// 输出重构，打包编译后的文件名称：模块名称.版本号.时间戳</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">`[name]-<span class="subst">$&#123;process.env.VUE_APP_Version&#125;</span>-<span class="subst">$&#123;Timestamp&#125;</span>.js`</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">`[name]-<span class="subst">$&#123;process.env.VUE_APP_Version&#125;</span>-<span class="subst">$&#123;Timestamp&#125;</span>.js`</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 其他写法</span></span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(config, &#123;</span><br><span class="line">      <span class="comment">// 开发生产共同配置</span></span><br><span class="line">      <span class="attr">output</span>: &#123;            <span class="comment">// 输出重构，打包编译后的文件名称：模块名称.版本号.时间戳</span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">`[name]-<span class="subst">$&#123;process.env.VUE_APP_Version&#125;</span>-<span class="subst">$&#123;Timestamp&#125;</span>.js`</span>,</span><br><span class="line">        <span class="attr">chunkFilename</span>: <span class="string">`[name]-<span class="subst">$&#123;process.env.VUE_APP_Version&#125;</span>-<span class="subst">$&#123;Timestamp&#125;</span>.js`</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 别名配置</span></span><br><span class="line">      <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(**dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">          <span class="string">&#x27;@c&#x27;</span>: path.<span class="title function_">resolve</span>(**dirname, <span class="string">&#x27;./src/components&#x27;</span>),</span><br><span class="line">          <span class="string">&#x27;@p&#x27;</span>: path.<span class="title function_">resolve</span>(**dirname, <span class="string">&#x27;./src/pages&#x27;</span>)</span><br><span class="line">        &#125; </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span> nginx 配置：不缓存 index.html </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desp</span> <span class="variable">no</span>-cache、no-store 可以只设置一个 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * no-cache：浏览器会缓存，但刷新页面或者重新打开时会请求服务器</span></span><br><span class="line"><span class="comment"> * no-store：浏览器不缓存，刷新页面需要重新下载页面</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">location = /index.<span class="property">html</span> &#123;</span><br><span class="line">  add_header <span class="title class_">Cache</span>-<span class="title class_">Control</span> <span class="string">&quot;no-cache, no-store&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="五、组件库优化"><a href="#五、组件库优化" class="headerlink" title="五、组件库优化"></a>五、组件库优化</h1><blockquote>
<p>elementui、antd 等组件库的组件经常满足不了项目的个性化需求，Vue Demo Collection 项目收集了一些通用的 Vue 组件，有需要时可查看。</p>
</blockquote>
<h2 id="组件样式"><a href="#组件样式" class="headerlink" title="组件样式"></a>组件样式</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局修改：代码覆盖、根据官网自定义主题的教程修改</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;./assets/css/index.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改单个文件的样式时，可以使用 /deep/、&gt;&gt;&gt; 来深度选择。</span></span><br><span class="line"><span class="selector-class">.dialog-wrapper</span> &#123;</span><br><span class="line">    /deep/<span class="selector-class">.el-dialog</span>**<span class="selector-tag">body</span>&#123;</span><br><span class="line">        <span class="attribute">border</span>: solid <span class="number">1px</span> <span class="number">#999</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="组件参数和方法"><a href="#组件参数和方法" class="headerlink" title="组件参数和方法"></a>组件参数和方法</h2>  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">我想要在 el-cascader 选中一个搜索选项后不关闭看板，通过源码发现 toggleDropDownVisible</span><br><span class="line">方法是控制看板展开的，所以通过 ref 获取组件并调用其方法。</span><br><span class="line"><span class="tag">&lt;<span class="name">el-cascader</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ref</span>=<span class="string">&quot;cascader&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">placeholder</span>=<span class="string">&quot;试试搜索：指南&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:options</span>=<span class="string">&quot;options&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:props</span>=<span class="string">&quot;&#123; multiple: true &#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">filterable</span>&gt;</span>&lt;/el-cascader</span><br><span class="line">    @visible-change=&quot;$refs.cascader.toggleDropDownVisible(true)&quot;&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">el-cascader</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="组件功能扩展"><a href="#组件功能扩展" class="headerlink" title="组件功能扩展"></a>组件功能扩展</h2><blockquote>
<p>element-ui 多选可搜索级联组件有一个问题：当用户选中全部子节点时不会合并为显示父节点，于是可进行以下优化：</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认看到级联看板展开，不会收起</span></span><br><span class="line">@visible-change=<span class="string">&quot;blurCascader(true)&quot;</span> <span class="comment">// 可触发展开</span></span><br><span class="line">mounted () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">blurCascader</span>(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 失焦后触发展开级联看板（默认失焦后关闭看板）</span></span><br><span class="line">blurCascader () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 调用组件内部未暴露的方法</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">cascader</span>.<span class="title function_">toggleDropDownVisible</span>(<span class="literal">true</span>) </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索选中后展示级联看板，并勾选搜索选中的节点</span></span><br><span class="line"><span class="comment">// 响应选中的节点，选中节点后关闭选择看板，展示级联看板</span></span><br><span class="line">changecascader (e) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">cascader</span>.<span class="title function_">handleDropdownLeave</span>()</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当子级节点全部选中后，tag只展示一个父级节点，而不是全部子节点。</span></span><br><span class="line"><span class="title function_">getPresetTags</span>(<span class="params"></span>) &#123;   <span class="comment">// 获取所有勾选的节点</span></span><br><span class="line">    <span class="keyword">const</span> tree = <span class="variable language_">this</span>.<span class="property">panel</span>.<span class="property">menus</span>[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">const</span> result = []</span><br><span class="line">    <span class="title function_">loop</span>(tree)</span><br><span class="line">    <span class="comment">// 递归查找选中的节点</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params">tree = []</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tree.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> child = tree[i]</span><br><span class="line">            <span class="comment">// checked 状态表示选中、indeterminate 状态表示待定，是半选</span></span><br><span class="line">            <span class="keyword">if</span> (child.<span class="property">checked</span>) &#123;                </span><br><span class="line">                result.<span class="title function_">push</span>(&#123; ...child, <span class="attr">closable</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child.<span class="property">indeterminate</span>) &#123;</span><br><span class="line">                child.<span class="property">children</span> &amp;&amp; <span class="title function_">loop</span>(child.<span class="property">children</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">presentFormatTags</span> = result <span class="comment">// 得到可显示的 tag</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除节点：由于修改了 tag 展示，所以它的 deleteTag 事件也要重写。</span></span><br><span class="line"><span class="title function_">deleteTag</span>(<span class="params">index, tag</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> _ = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">if</span> (tag &amp;&amp; tag.<span class="property">hasChildren</span>) &#123;</span><br><span class="line">        <span class="comment">// 当删除的节点是父节点时</span></span><br><span class="line">        <span class="title function_">loop</span>(tag.<span class="property">children</span>)</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params">list</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (list[i].<span class="property">hasChildren</span>) &#123;</span><br><span class="line">                    <span class="title function_">loop</span>(list[i].<span class="property">children</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> path = list[i].<span class="property">path</span></span><br><span class="line">                    _.<span class="property">checkedValue</span> = _.<span class="property">checkedValue</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">n</span> =&gt;</span> n !== path)</span><br><span class="line">                    _.$emit(<span class="string">&#x27;remove-tag&#x27;</span>, tag)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag) &#123;   <span class="comment">// 当删除的是子节点时</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">checkedValue</span> = <span class="variable language_">this</span>.<span class="property">checkedValue</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">n, i</span>) =&gt;</span> n !== tag.<span class="property">path</span>)</span><br><span class="line">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;remove-tag&#x27;</span>, tag)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// 当以回车键删除时</span></span><br><span class="line">        <span class="keyword">const</span> temp = <span class="variable language_">this</span>.<span class="property">presentFormatTags</span>[<span class="variable language_">this</span>.<span class="property">presentFormatTags</span>.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">        temp &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">deleteTag</span>(<span class="literal">null</span>, temp)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 原本这个方法的代码如下</span></span><br><span class="line">    <span class="comment">// const &#123; checkedValue &#125; = this</span></span><br><span class="line">    <span class="comment">// const val = checkedValue[index]</span></span><br><span class="line">    <span class="comment">// this.checkedValue = checkedValue.filter((n, i) =&gt; i !== index)</span></span><br><span class="line">    <span class="comment">// this.$emit(&#x27;remove-tag&#x27;, val)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="多个组件联动"><a href="#多个组件联动" class="headerlink" title="多个组件联动"></a>多个组件联动</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将 table、pagination 放到一个组件</span></span><br><span class="line">&lt;template lang=<span class="string">&quot;pug&quot;</span>&gt;</span><br><span class="line">div</span><br><span class="line">  .<span class="property">el</span>-table</span><br><span class="line">    <span class="title function_">template</span>(v-<span class="keyword">for</span>=<span class="string">&quot;(item, index) in columns&quot;</span>)</span><br><span class="line">      el-table-<span class="title function_">column</span>(</span><br><span class="line">        :prop=<span class="string">&quot;item.prop&quot;</span></span><br><span class="line">        :key=<span class="string">&quot;index&quot;</span></span><br><span class="line">        :label=<span class="string">&quot;item.label&quot;</span>)</span><br><span class="line"></span><br><span class="line">  el-pagination.<span class="property">pg</span>-<span class="title function_">wrapper</span>(</span><br><span class="line">    layout=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span><br><span class="line">    @size-change=<span class="string">&quot;handleSizeChange&quot;</span></span><br><span class="line">    @current-change=<span class="string">&quot;handleCurrentChange&quot;</span></span><br><span class="line">    :current-page=<span class="string">&quot;currentPage&quot;</span></span><br><span class="line">    :page-sizes=<span class="string">&quot;[10, 20, 50, 100]&quot;</span></span><br><span class="line">    :page-size=<span class="string">&quot;pagesize&quot;</span></span><br><span class="line">    :total=<span class="string">&quot;total&quot;</span>)</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入参数</span></span><br><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="comment">// 列信息</span></span><br><span class="line">    <span class="attr">columns</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">default</span>: [],</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 单页数据量</span></span><br><span class="line">    <span class="attr">pagesize</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="number">10</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 当前页码</span></span><br><span class="line">    <span class="attr">currentPage</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="number">1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 表格数据</span></span><br><span class="line">    <span class="attr">tableData</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">default</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 数据总数</span></span><br><span class="line">    <span class="attr">total</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="number">1000</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取数据的接口</span></span><br><span class="line">    <span class="attr">fetch</span>:&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="keyword">function</span>,</span><br><span class="line">      <span class="attr">default</span>:<span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 表单查询的参数</span></span><br><span class="line">    <span class="attr">query</span>:&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 改变当前页码 currentPage 时触发</span></span><br><span class="line">    <span class="attr">handleCurrentChange</span>: <span class="keyword">function</span> (<span class="params">currentPage</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;handleChange&#x27;</span>, <span class="variable language_">this</span>.<span class="property">pagesize</span>, currentPage)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">fetch</span>(<span class="variable language_">this</span>.<span class="property">query</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 改变当前页 pageSize 时触发</span></span><br><span class="line">    <span class="attr">handleSizeChange</span>: <span class="keyword">function</span> (<span class="params">pageSize</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;handleChange&#x27;</span>, pageSize, <span class="variable language_">this</span>.<span class="property">currentPage</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">fetch</span>(<span class="variable language_">this</span>.<span class="property">query</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>JS 框架</category>
      </categories>
      <tags>
        <tag>JS 框架</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue 项目构建</title>
    <url>/2019/06/05/5-1-vue%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="一、Vue-框架"><a href="#一、Vue-框架" class="headerlink" title="一、Vue 框架"></a>一、Vue 框架</h1><ul>
<li><strong>核心思想</strong>：数据驱动的组件系统、轻量高效的前端组件化方案。</li>
<li><strong>开发理念</strong>：渐进式开发 (先构建基础界面后根据需求添加功能)、聚焦视图层的框架、数据驱动的组件化开发、响应式 (页面根据分辨率改变大小，适应式则根据分辨率选择不同页面)。</li>
<li><strong>MVVM 模式</strong>：响应式、双向绑定、数据驱动、视图与数据分离、专注开发页面和业务。</li>
<li><strong>PC UI</strong>：<code>Element、iView、vue-element-admin、iview-admin、vue2-manage</code>。</li>
<li><strong>移动 UI</strong>：<code>Vux、Vant、mint-ui、Muse-UI、vonic、vue-material、cube-ui</code>。</li>
</ul>
<h2 id="全家桶"><a href="#全家桶" class="headerlink" title="全家桶"></a>全家桶</h2><blockquote>
<p>vue 项目的核心构成。</p>
</blockquote>
<ul>
<li><strong>vue-cli</strong>：快速搭建大型单页应用的脚手架。可以自动生成 Vue 项目的目录和文件，通过热加载方式快速启动项目，利用本地 node 服务器实现页面的实时刷新效果。</li>
<li><strong>vue-router</strong>：路由控制。用于配置路径和组件的映射关系，通过路径切换来实现页面切换。</li>
<li><strong>vuex</strong>：状态管理。用于组件间数据的通信和管理，是统一存储所有状态和更新方法的容器。</li>
<li><strong>axios</strong>：异步通信。基于 Promise HTTP 请求客户端，可以同时在浏览器和 nodejs 中使用。</li>
</ul>
<h2 id="双向绑定流程"><a href="#双向绑定流程" class="headerlink" title="双向绑定流程"></a>双向绑定流程</h2><ol>
<li><strong>解析模板为 render 函数。</strong><br>* 模板本质是一串包含指令等逻辑的字符串，最终必须转换成 JS 代码，原因是：必须使用 JS 来处理模板中的逻辑、必须使用 JS 将模板渲染到页面上。<br>* render 函数包含所有的模板信息并返回一个虚拟 DOM，模板用到的 data 属性和 vue 指令都分别变成了 JS 变量和 JS 逻辑，核心是设置对象属性和方法时可以简化代码的 with。</li>
<li><strong>响应式开始监听。</strong><br>* Object.defineProperty 监听：将一个普通 Js 对象传给 Vue 实例的 data 选项时，vue 将遍历此对象属性并通过 Object.defineProperty 将属性全部转为 getter&#x2F;setter。<br>* 将 data 的属性代理到 vm：render 函数中 with(this){} this 指的是 vm (vm.title、vm.list)，其中 title、list 变量都是 data 的属性。</li>
<li><strong>首次渲染显示页面，且绑定依赖。</strong><br>* 初次渲染，执行 updateComponent() 函数，执行 vm._render() 函数。<br>* 执行 render 函数，会访问到 vm.title、vm.list。<br>* 访问 vm.title vm.list 就会被响应式的 get 方法监听到。<br>* 执行 updateComponent()函数，会走到 vdom 的 patch 方法。<br>* patch 将 vnode 渲染成 DOM，初次渲染完成。</li>
<li><strong>data 属性变化，触发 rerender 函数。</strong><br>* 修改属性，被响应式的 set 监听到。<br>* set 中执行 updateComponent。<br>* updateComponent 重新执行 vm._render()。<br>* 生成的 vnode、prevVnode，通过 patch 进行对比。<br>* 局部渲染 html。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、解析模板为 render 函数：核心 with 的参数 this 表示 vm。</span></span><br><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;price&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="title function_">with</span>(<span class="params"><span class="variable language_">this</span></span>)&#123;</span><br><span class="line">    <span class="comment">// _c、_v、_l 函数分别用来创建一个 html 元素、文本节点、数组。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_c</span>(</span><br><span class="line">        <span class="string">&#x27;div&#x27;</span>, </span><br><span class="line">        &#123; <span class="attr">attrs</span>: &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;app&quot;</span>&#125; &#125;, </span><br><span class="line">        [ <span class="title function_">_c</span>(<span class="string">&#x27;p&#x27;</span>, [<span class="title function_">_v</span>(<span class="title function_">_s</span>(price))]) ]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@title</span> 2、响应式监听</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> 闭包：保证 key 的独立作用域。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> getter/setter 在属性被访问和修改时通知而让 vue 追踪依赖，对用户不可见。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@prame</span> 对象传给 Vue 实例的 data 时要遍历它的所有属性并设置 getter/setter。</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">    <span class="attr">price</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;zhangsan&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> key, value;</span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> data) &#123;</span><br><span class="line">    (<span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">            <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get&#x27;</span>, key);</span><br><span class="line">                <span class="keyword">return</span> data[key];</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set&#x27;</span>, newVal);</span><br><span class="line">                data[key] = newVal;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、vue 模板被渲染为 html</span></span><br><span class="line">vm.<span class="title function_">_update</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> prevVnode = vm.<span class="property">_vnode</span>;</span><br><span class="line">    vm.<span class="property">_vnode</span> = vnode;</span><br><span class="line">    <span class="keyword">if</span> (!prevVnode) &#123;    <span class="comment">// 第一次没有值</span></span><br><span class="line">        vm.<span class="property">$el</span> = vm.<span class="title function_">_patch_</span>(vm.<span class="property">$el</span>, vnode);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        vm.<span class="property">$el</span> = vm.<span class="title function_">_patch_</span>(prevVnode, vnode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    vm.<span class="title function_">_update</span>(vm.<span class="title function_">_render</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="二、项目构建"><a href="#二、项目构建" class="headerlink" title="二、项目构建"></a>二、项目构建</h1><h2 id="浏览器渲染-SPA"><a href="#浏览器渲染-SPA" class="headerlink" title="浏览器渲染 SPA"></a>浏览器渲染 SPA</h2><blockquote>
<p>浏览器中直接渲染组件的单页面应用程序。整个项目只有一个完整页面 index.html、一个根组件 App.vue。具体流程为：各个组件通过路由拼接到 App.vue router-view，然后将拼接结果转换为代码片段并添加到 index.html 标签中展示出来。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化目录</span></span><br><span class="line">cnpm install vue @vue/cli webpack -g</span><br><span class="line">vue -V、vue create test</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义配置</span></span><br><span class="line">按钮：A -- 全选、空格键 -- 选择与取消、上下 -- 移动</span><br><span class="line">选项：<span class="title class_">Babel</span>、<span class="title class_">Router</span>、<span class="title class_">Vuex</span>、<span class="variable constant_">CSS</span> <span class="title class_">Pre</span>-processors、<span class="title class_">Linter</span> / <span class="title class_">Formatter</span></span><br><span class="line">校验：<span class="title class_">ESLint</span> + <span class="title class_">Prettier</span>、<span class="title class_">Lint</span> on save</span><br><span class="line">保存：<span class="title class_">In</span> dedicated config files、自定义文件名</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动打包</span></span><br><span class="line">npm start、npm run build</span><br><span class="line"></span><br><span class="line"><span class="comment">// vue.config.js：根目录新建，webpack 自动识别的自定义配置文件。</span></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">join</span>(**dirname, dir)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&quot;./&quot;</span>,    <span class="comment">// 根路径</span></span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&#x27;dist&#x27;</span>,   <span class="comment">// 输出文件目录</span></span><br><span class="line">  <span class="attr">lintOnSave</span>: <span class="literal">false</span>,   <span class="comment">// 取消eslint验证</span></span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(config, &#123;</span><br><span class="line">      <span class="comment">// 输出配置打包文件名：模块名称.版本号.时间戳</span></span><br><span class="line">      <span class="attr">output</span>: &#123;    <span class="comment">// </span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">`[name]-<span class="subst">$&#123;process.env.VUE_APP_Version&#125;</span>-<span class="subst">$&#123;Timestamp&#125;</span>.js`</span>,</span><br><span class="line">        <span class="attr">chunkFilename</span>: <span class="string">`[name]-<span class="subst">$&#123;process.env.VUE_APP_Version&#125;</span>-<span class="subst">$&#123;Timestamp&#125;</span>.js`</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 配置目录别名：引用路径时减少复杂度</span></span><br><span class="line">      <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(**dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">          <span class="string">&#x27;views&#x27;</span>: path.<span class="title function_">resolve</span>(**dirname, <span class="string">&#x27;./src/views&#x27;</span>),</span><br><span class="line">          <span class="string">&#x27;assets&#x27;</span>: path.<span class="title function_">resolve</span>(**dirname, <span class="string">&#x27;./src/assets&#x27;</span>)</span><br><span class="line">        &#125; </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 配置目录别名</span></span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">resolve</span>.<span class="property">alias</span></span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;@&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;assets&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/views&#x27;</span>))</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8000</span>,</span><br><span class="line">    <span class="attr">https</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">hotOnly</span>: <span class="literal">true</span>,   <span class="comment">// 热更新</span></span><br><span class="line">    <span class="comment">// 配置跨域请求</span></span><br><span class="line">    <span class="comment">// proxy: &#x27;http://localhost:8000&#x27;   // 只有一个代理</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;                            <span class="comment">// 配置多个代理</span></span><br><span class="line">      <span class="string">&quot;/rest/*&quot;</span>: &#123;  <span class="comment">// 请求地址</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://172.16.1.12:7071&quot;</span>,  <span class="comment">// 实际映射到的目标地址</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,  <span class="comment">// 是否跨域</span></span><br><span class="line">        <span class="comment">// ws: true,//websocket支持</span></span><br><span class="line">        <span class="attr">secure</span>: <span class="literal">false</span>,  <span class="comment">// https 接口需要配置</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;/api/a&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://hongqiao-zatech-channel.test.za-tech.net&#x27;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123; <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;/&#x27;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 模拟本地数据</span></span><br><span class="line">    <span class="title function_">before</span>(<span class="params">app</span>) &#123;  </span><br><span class="line">      app.<span class="title function_">get</span>(<span class="string">&#x27;/api/seller&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">          res.<span class="title function_">json</span>(&#123; <span class="attr">errno</span>: <span class="number">0</span>, <span class="attr">data</span>: <span class="title function_">requare</span>(<span class="string">&#x27;./data/seller.json&#x27;</span>) &#125;) </span><br><span class="line">      &#125;),</span><br><span class="line">      app.<span class="title function_">post</span>(<span class="string">&#x27;/api/foods&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">          res.<span class="title function_">json</span>(&#123; <span class="attr">errno</span>: <span class="number">0</span>, <span class="attr">data</span>: foods &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="服务器端渲染-SSR"><a href="#服务器端渲染-SSR" class="headerlink" title="服务器端渲染 SSR"></a>服务器端渲染 SSR</h2><ul>
<li>两种模式：后端首次渲染的单页面应用模式、后端模板渲染模式，区别在于使用后端路由的程度。前者是后端模板渲染和单页面的组合，首次加载时 vue 服务器将当前页面的数据和组件模板生成 html 字符串返回给浏览器，js 资源加载完成后运行单页面应用。</li>
<li>优点：更好的 SEO 而方便搜索引擎爬虫、更快的首屏渲染而无需等待 Js 加载完成。</li>
<li>缺点：更多的服务器负载 (CPU 和内存资源)、更复杂的开发部署 (兼容 Node 环境)。</li>
<li>实现<ul>
<li>选择单页面框架 react&#x2F;vue。</li>
<li>选择 node 服务端框架 express&#x2F;koa2。</li>
<li>实现核心逻辑：node 根据路由渲染单页面组件。</li>
<li>优化开发和发布环境自动化构建工具 webpack。</li>
</ul>
</li>
</ul>
<h2 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、资源引用</span></span><br><span class="line"><span class="comment">// 适配移动端的库：postcss.config.js</span></span><br><span class="line">cnpm install postcss-px-to-viewport -D</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;autoprefixer&#x27;</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">&#x27;postcss-px-to-viewport&#x27;</span>: &#123; </span><br><span class="line">      <span class="attr">viewportWidth</span>: <span class="number">750</span>, <span class="comment">// 视窗的宽度，对应的是我们设计稿的宽度，一般是750 </span></span><br><span class="line">      <span class="attr">viewportHeight</span>: <span class="number">1334</span>, <span class="comment">// 视窗的高度，根据750设备的宽度来指定，一般指定 1334，也可不配置 </span></span><br><span class="line">      <span class="attr">unitPrecision</span>: <span class="number">3</span>, <span class="comment">// 指定`px`转换为视窗单位值的小数位数（很多时候无法整除） </span></span><br><span class="line">      <span class="attr">viewportUnit</span>: <span class="string">&#x27;vw&#x27;</span>, <span class="comment">// 指定需要转换成的视窗单位，建议使用vw </span></span><br><span class="line">      <span class="attr">selectorBlackList</span>: [<span class="string">&#x27;.ignore&#x27;</span>, <span class="string">&#x27;.hairlines&#x27;</span>], </span><br><span class="line">      <span class="comment">// 指定不转换为视窗单位的类，可以自定义，可以无限添加,建议定义一至两个通用的类名</span></span><br><span class="line">      <span class="attr">minPixelValue</span>: <span class="number">1</span>, <span class="comment">// 小于或等于`1px`不转换为视窗单位，你也可以设置为你想要的值 </span></span><br><span class="line">      <span class="attr">mediaQuery</span>: <span class="literal">false</span> <span class="comment">// 允许在媒体查询中转换`px`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Ace 代码编辑器插件</span></span><br><span class="line">cnpm install ace-builds -S</span><br><span class="line"><span class="attr">https</span>:<span class="comment">//blog.csdn.net/YoshinoNanjo/article/details/82978668</span></span><br><span class="line"><span class="comment">// 静态资源</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">&#x27;./reset.css&#x27;</span>;</span><br><span class="line">绝对路径 &lt;img src=<span class="string">&#x27;/images/logo.png&#x27;</span>&gt;;</span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;@/components/user&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getUserInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;./tool.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、环境接口配置</span></span><br><span class="line"><span class="comment">// package.json：开发 development、生产 production、测试 test</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve --mode dev&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build --mode prod&quot;</span>,</span><br><span class="line">  <span class="string">&quot;test&quot;</span>: <span class="string">&quot;vue-cli-service build --mode test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;vue-cli-service lint&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// .env.dev</span></span><br><span class="line"><span class="variable constant_">NODE_ENV</span> = <span class="string">&quot;dev&quot;</span></span><br><span class="line"><span class="variable constant_">VUE_APP_URL</span> = <span class="string">&quot;/apigateway&quot;</span></span><br><span class="line"><span class="comment">// .env.test</span></span><br><span class="line"><span class="variable constant_">NODE_ENV</span> = <span class="string">&quot;production&quot;</span></span><br><span class="line"><span class="variable constant_">VUE_APP_URL</span> = <span class="string">&quot;http://116.228.196.136:10003/apigateway&quot;</span></span><br><span class="line"><span class="comment">// .env.prod</span></span><br><span class="line"><span class="variable constant_">NODE_ENV</span> = <span class="string">&quot;prod&quot;</span></span><br><span class="line"><span class="variable constant_">VUE_APP_URL</span> = <span class="string">&quot;https://api.yongcheng.com:19090/apigateway&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、静态服务：可配置命令 &quot;script&quot;:&#123; &quot;server&quot;:&quot;live-server ./dist --port=8080&quot; &#125;</span></span><br><span class="line">npm install -g live-server / http-server</span><br><span class="line">live-server / http-server</span><br></pre></td></tr></table></figure>

<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><ul>
<li>开发过程<ul>
<li><strong>优先使用 v-if</strong>，减少 v-show。</li>
<li><strong>v-for、v-if 不要一起使用</strong>，可通过计算属性先过滤数据。</li>
<li><strong>v-for key</strong> 避免使用 index 作为标识，可采用唯一值来减少新增数据时的开销。</li>
<li><strong>组件和组件库</strong>：事件监听、计时器等需要及时销毁来释放组件资源，组件库引用时尽量通过按需加载的方式。</li>
<li><strong>路由懒加载</strong>：<code>component: () =&gt; import(&quot;views/Login.vue&quot;)</code>。</li>
<li><strong>长列表懒加载</strong>；v-for 生成的列表数据过多时可能造成页面卡顿，可通过 vue-virtual-scroller 等实现懒加载。</li>
<li><strong>图片加载优化</strong>：小图标使用字体图标或 SVG、小型图片通过 base64、webp 的方式、大图放到云服务器通过 CDN 加载、使用框架懒加载的图片。</li>
<li><strong>首屏加载</strong>：页面内容加载完成前使用 loading、进度条、骨架屏(使用一些空白内容的图形来展示未加载内容) 等方式来提升用户体验。</li>
</ul>
</li>
<li>项目过程<ul>
<li><strong>最小化 JS 文件</strong>：webpack4 打包处理，配置 config.optimization.minimize(true)。</li>
<li><strong>图片资源压缩</strong>：打包图片通过 image-webpack-loader 压缩，或者在线无损压缩。</li>
<li><strong>删除沉淀代码</strong>：可通过 Tree-Shaking 插件清理掉无用的沉淀代码。</li>
<li><strong>依赖库 CDN 加速</strong>：可通过 <a href="https://www.bootcdn.cn/">BootCDN</a> 引用公共库，vue 通过 script 引入后配置 <code>configureWebpack: &#123; externals: &#123; echarts: &#39;echarts&#39;&#125; &#125;</code>。</li>
<li><strong>开启 gzip 压缩</strong>：可通过 webpack 或后端进行配置。</li>
</ul>
</li>
</ul>
<h1 id="三、路由控制-Router"><a href="#三、路由控制-Router" class="headerlink" title="三、路由控制 Router"></a>三、路由控制 Router</h1><blockquote>
<p>路由根据不同地址展示不同的页面或数据。前端路由多用于 SPA，通过 hash &#x2F; HTML5 historyApi 实现而不涉及到服务器。</p>
</blockquote>
<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><blockquote>
<p>将组件映射到路由，然后通过 vue-router 渲染。</p>
</blockquote>
<ol>
<li>定义组件：<code>user.vue</code></li>
<li>定义路由配置：<code>var routes = []</code></li>
<li>生成路由对象：<code>var router = new VueRouter(&#123; routes: routes &#125;)</code></li>
<li>注入到实例对象：<code>var app = new Vue(&#123; el: &#39;#app&#39;, router, &#125;)</code></li>
<li>组件中定义渲染标签：<code>router-link、router-view</code></li>
</ol>
<h2 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h2><ul>
<li>命名路由：<code>name: &#39;home&#39;</code></li>
<li>嵌套路由：<code>children: [&#123; &#125;]</code></li>
<li>动态路由：<code>path: &#39;/user/:id&#39;</code></li>
<li>命名视图：<code>components: &#123; &#125;</code></li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;@/components/User&#x27;</span></span><br><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;@/components/Home&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由懒加载</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">home</span> = (<span class="params"></span>) =&gt; <span class="title function_">import</span>(<span class="string">&quot;views/extension/Home.vue&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;    </span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;history&quot;</span>,            <span class="comment">// 路径模式 </span></span><br><span class="line">  <span class="attr">base</span>: process.<span class="property">env</span>.<span class="property">BASE_URL</span>  <span class="comment">// 基路径(默认&#x27;/&#x27;)           </span></span><br><span class="line">  <span class="attr">linkActiveClass</span>: <span class="string">&#x27;active&#x27;</span>,  <span class="comment">// 链接激活时的class</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// history 模式下滚动行为，路由切换时页面滚动到指定位置</span></span><br><span class="line">  scrollBehavior (to, <span class="keyword">from</span>, savedPosition) &#123; </span><br><span class="line">    <span class="keyword">if</span>(savedPosition)&#123;  </span><br><span class="line">        <span class="keyword">return</span> savedPosition  <span class="comment">// 原位置</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">x</span>: <span class="number">0</span>,<span class="attr">y</span>: <span class="number">0</span>&#125;;   <span class="comment">// 顶部</span></span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(to.<span class="property">hash</span>)&#123;             <span class="comment">// 锚点定位</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">selector</span>: to.<span class="property">hash</span>&#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">routes</span>: [     <span class="comment">// 路由配置</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;登录页&#x27;</span>,</span><br><span class="line">      <span class="attr">alias</span>: <span class="string">&#x27;/b&#x27;</span>,       <span class="comment">// 路径别名</span></span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, </span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Index&#x27;</span>,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="comment">// 重定向(解决首次进入页面时不显示内容的问题)</span></span><br><span class="line">      <span class="attr">component</span>: home</span><br><span class="line">    &#125;, </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>:<span class="string">&quot;/home&quot;</span>,     <span class="comment">// 静态路由</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: home,</span><br><span class="line">      <span class="attr">children</span>: [&#123;       <span class="comment">// 嵌套路由(须先进 home) </span></span><br><span class="line">          <span class="attr">path</span>: <span class="string">&quot;/phone&quot;</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;phone&quot;</span>,</span><br><span class="line">          <span class="attr">component</span>: phone</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;,                  </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;user&quot;</span>,    </span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/user/:id&#x27;</span>,  <span class="comment">// 动态路由(指定参数形式)   </span></span><br><span class="line">      <span class="attr">component</span>: user,    </span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/name&#x27;</span>,</span><br><span class="line">      <span class="attr">components</span>: &#123;      <span class="comment">// 命名视图(同时渲染多个组件)</span></span><br><span class="line">        <span class="attr">default</span>: <span class="title class_">Foo</span>,</span><br><span class="line">        <span class="attr">a</span>: <span class="title class_">Bar</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="title class_">Baz</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>


<h2 id="路由模式"><a href="#路由模式" class="headerlink" title="路由模式"></a>路由模式</h2><h3 id="两种模式"><a href="#两种模式" class="headerlink" title="两种模式"></a>两种模式</h3><blockquote>
<p>应用于浏览器的历史记录站，在当前已有的 back、forward、go 的基础上提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前URL，但浏览器不会立即向后端发送请求。</p>
</blockquote>
<ul>
<li><strong>hash</strong>：默认模式，浏览器地址中的 # 及其后面的字符串称为 hash，可以通过 window.location.hash 读取，它用来模拟一个完整 URL 但不会被包括在 HTTP 请求中，改变时不会重新加载页面。</li>
<li><strong>history</strong>：利用了 HTML5 新增方法，pushState()、replaceState() 用来对浏览器历史记录栈进行修改，popState 事件用来监听到状态变化。</li>
</ul>
<p>	</p>
<h3 id="404-错误"><a href="#404-错误" class="headerlink" title="404 错误"></a>404 错误</h3><ul>
<li><strong>hash 模式</strong>：只有 # 前面的内容会被包含在请求中。因此对于后端来说，即使没有做到对路由的全覆盖也不会返回 404 错误。</li>
<li><strong>history 模式</strong>：前端 url 必须和实际向后端发起请求的 url 一致，比如 &#x2F;book&#x2F;id ，如果后端缺少对该路由的处理则返回 404 错误。</li>
</ul>
<h3 id="注意问题"><a href="#注意问题" class="headerlink" title="注意问题"></a>注意问题</h3>  <div style="text-indent: 2em">app 开发时一般需要分享页面到第三方 app，但部分 url 不允许带 #。去除 # 需要使用 history 模式，但是有一个问题：在访问二级页面时，刷新操作则会出现 404 错误，那么就需要和后端一起配置 apache 或是 nginx url 重定向，重定向到你的首页路由上即可。</div>
            

<h2 id="路由跳转"><a href="#路由跳转" class="headerlink" title="路由跳转"></a>路由跳转</h2><h3 id="组件标签"><a href="#组件标签" class="headerlink" title="组件标签"></a>组件标签</h3><ul>
<li><strong>跳转标签</strong><ul>
<li>样式：<code>&lt;router-link tag=&quot;li&quot;、active-class=&quot;active&quot; replace&gt;&lt;/router-link&gt;</code>。</li>
<li>导航：普通路由 <code>to= &quot;/path&quot;</code>、动态路由：<code>to=&quot;/user/12&quot;、:to=&quot;&#123; name: &#39;user&#39;, params/query: &#123; id: 1 &#125; &#125;&quot;</code>。</li>
</ul>
</li>
<li><strong>渲染视图</strong><ul>
<li>标签：<code>&lt;router-view name=&quot;user&quot;&gt;&lt;/router-view&gt;</code>。</li>
<li>包裹：缓存 <code>keep-alive</code>、过渡样式 <code>transition</code>。</li>
</ul>
</li>
</ul>
<h3 id="JS-编程式导航"><a href="#JS-编程式导航" class="headerlink" title="JS 编程式导航"></a>JS 编程式导航</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">to_home</span>(<span class="params"></span>)&#123;   <span class="comment">// 字符串 和 对象</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;home&quot;</span>)      </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/login?url=&#x27;</span> + <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">path</span> &#125;)  </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">to_user</span>(<span class="params"></span>)&#123;  <span class="comment">// 命名路由 和 查询参数</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;&#125;)  </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">query</span>: &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;&#125;)   </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">to_other</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">go</span>(n)         <span class="comment">// 前进</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">back</span>()        <span class="comment">// 后退</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">forward</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>()     <span class="comment">// 替换掉当前的history记录</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get_obj</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$route</span>)   <span class="comment">// 路由对象(包括 path、params 等)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="动态路由传参"><a href="#动态路由传参" class="headerlink" title="动态路由传参"></a>动态路由传参</h2><ul>
<li>方式<ul>
<li><strong>path</strong>：<code>to=&quot;/user/12&quot;</code></li>
<li><strong>params</strong>：<code>:to=&quot;&#123; name: &#39;user&#39;, params: &#123; id: 1 &#125; &#125;&quot;</code></li>
<li><strong>query</strong>：<code>:to=&quot;&#123; name: &#39;user&#39;, query: &#123; id: 1 &#125; &#125;&quot;</code></li>
</ul>
</li>
<li>注意<ul>
<li>通过 path&#x2F;params 传参时，需要在路由配置中指定参数形式 <code>path: &#39;/user/:id&#39;</code>。</li>
<li>通过 params&#x2F;query 传参时，参数必须是对象格式并绑定 to 属性 <code>v-bind:</code>。</li>
<li>跳转后的组件中获取参数 <code>this.$route.params/query.id</code>。</li>
</ul>
</li>
</ul>
<h2 id="导航钩子"><a href="#导航钩子" class="headerlink" title="导航钩子"></a>导航钩子</h2><blockquote>
<p>用于路由跳转时执行任务或不满足条件时取消跳转。</p>
</blockquote>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul>
<li><strong>全局钩子</strong>：beforeEach，常用于登录权限等验证。</li>
<li><strong>路由钩子</strong>：beforeLeave &#x2F; beforeEnter。</li>
<li><strong>组件钩子</strong>：beforeRouteLeave 用于清除计时器、提示保存内容、存储信息等，beforeRouteEnter 用于在跳转完成前获取数据。</li>
</ul>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul>
<li><strong>to</strong>：目标路由对象。</li>
<li><strong>from</strong>：当前路由对象。</li>
<li><strong>next</strong>：必须调用的函数，否则就是死循环。<ul>
<li><code>next()</code>：执行下一个钩子，如果钩子全部执行完成则导航状态为 confirmed。</li>
<li><code>next(false)</code>：中断当前导航，即重置到 from 路由对应的地址。</li>
<li><code>next(&#39;/&#39;)、next(&#123;path: &#39;/&#39;&#125;)</code>：中断掉当前导航并跳转到新地址。</li>
<li><code>next(error)</code>：如果传入一个 Error 实例，则导航被终止并会将错误传递给 router.onError() 注册的回调。</li>
</ul>
</li>
</ul>
<h1 id="四、异步通信-Axios"><a href="#四、异步通信-Axios" class="headerlink" title="四、异步通信 Axios"></a>四、异步通信 Axios</h1><h2 id="基础使用-1"><a href="#基础使用-1" class="headerlink" title="基础使用"></a>基础使用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$axios</span>.<span class="title function_">get</span>(<span class="string">&#x27;/user?id=12&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>( <span class="function"><span class="params">res</span> =&gt;</span> &#123; &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>( <span class="function"><span class="params">err</span> =&gt;</span> &#123; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> prames = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="variable language_">this</span>.<span class="property">form_data</span>)</span><br><span class="line"><span class="variable language_">this</span>.$axios(&#123; </span><br><span class="line">  <span class="attr">url</span>: url,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$qs</span>.<span class="title function_">stringify</span>(prames)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// formData 形式上传数据</span></span><br><span class="line">　<span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file);    </span><br><span class="line">　axios.<span class="title function_">post</span>(<span class="string">&#x27;url&#x27;</span>, formData, &#123;</span><br><span class="line">　　<span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;multipart/form-data&#x27;</span> &#125;</span><br><span class="line">　&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="请求-API"><a href="#请求-API" class="headerlink" title="请求 API"></a>请求 API</h2><ul>
<li>请求：<code>axios(config)、axios(url, [config])</code></li>
<li>并发：<code>axios.all(arr)、axios.spread(callback)</code></li>
<li>别名：<code>axios.get(url, [config])、axios.post(url, [data], [config])</code></li>
</ul>
<h2 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h2><h3 id="封装-axios"><a href="#封装-axios" class="headerlink" title="封装 axios"></a>封装 axios</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// axios.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; crypto, random, randomWord &#125; <span class="keyword">from</span> <span class="string">&#x27;./assets/js/tool.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_URL</span>,</span><br><span class="line">  <span class="comment">// timeout: 10000,            // 请求超时时间</span></span><br><span class="line">  <span class="attr">responseType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 1：加密数据</span></span><br><span class="line">    <span class="keyword">if</span>(config.<span class="property">headers</span>.<span class="property">level</span> == <span class="number">1</span>)&#123;  </span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">KP</span> = &#123;</span><br><span class="line">          <span class="attr">key</span>: <span class="title function_">randomWord</span>(<span class="literal">true</span>, <span class="number">16</span>, <span class="number">16</span>),  <span class="comment">// 秘钥</span></span><br><span class="line">          <span class="attr">iv</span>: <span class="title function_">randomWord</span>(<span class="literal">true</span>, <span class="number">16</span>, <span class="number">16</span>)    <span class="comment">// 偏移量</span></span><br><span class="line">        &#125;;</span><br><span class="line">        config.<span class="property">data</span> = crypto.<span class="title class_">AESEnc</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(config.<span class="property">data</span>), <span class="variable constant_">KP</span>.<span class="property">key</span>)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(config.<span class="property">headers</span>, &#123;</span><br><span class="line">          <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>,</span><br><span class="line">          <span class="attr">dataFormat</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">          <span class="attr">authMethod</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">          <span class="attr">signAlgo</span>: <span class="string">&quot;NO&quot;</span>,</span><br><span class="line">          <span class="attr">transAlgo</span>: <span class="string">&quot;AES&quot;</span>,</span><br><span class="line">          <span class="attr">shareKey</span>: <span class="variable constant_">KP</span>.<span class="property">key</span>,</span><br><span class="line">          <span class="attr">timestamp</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>(),</span><br><span class="line">          <span class="attr">nonce</span>: <span class="title class_">String</span>(<span class="title function_">random</span>(<span class="number">0</span>, <span class="number">100</span>))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 让每个请求携带 token</span></span><br><span class="line">    <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">token</span>) &#123;</span><br><span class="line">        config.<span class="property">data</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123; <span class="attr">token</span>: store.<span class="property">getters</span>.<span class="property">token</span> &#125;, config.<span class="property">data</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置表头  &#x27;application/json&#x27;</span></span><br><span class="line">    config.<span class="property">headers</span>[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异步请求的取消操作</span></span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">CancelToken</span> = axios.<span class="property">CancelToken</span>;  </span><br><span class="line">    <span class="keyword">let</span> cancel</span><br><span class="line">    config.<span class="property">cancelToken</span> = <span class="keyword">new</span> <span class="title class_">CancelToken</span>( <span class="function"><span class="params">c</span> =&gt;</span> &#123;</span><br><span class="line">        cancel = c;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">cancel</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 状态更新</span></span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;showLoad&#x27;</span>, &#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&quot;&quot;</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;showLoad&#x27;</span>, &#123; <span class="attr">status</span>: <span class="number">2</span>, <span class="attr">msg</span>: <span class="string">&quot;&quot;</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 解密返回数据</span></span><br><span class="line">    response.<span class="property">data</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(crypto.<span class="title class_">AESDec</span>(response.<span class="property">data</span>, response.<span class="property">config</span>.<span class="property">headers</span>.<span class="property">shareKey</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">CResultCde</span> == <span class="string">&quot;0000&quot;</span>)&#123;</span><br><span class="line">        store.<span class="title function_">commit</span>(<span class="string">&#x27;hideLoad&#x27;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        store.<span class="title function_">commit</span>(<span class="string">&#x27;showLoad&#x27;</span>, &#123; <span class="attr">status</span>: <span class="number">2</span>, <span class="attr">msg</span>: response.<span class="property">data</span>.<span class="property">CResultMsg</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(response)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;showLoad&#x27;</span>, &#123; <span class="attr">status</span>: <span class="number">2</span>, <span class="attr">msg</span>: <span class="string">&quot;&quot;</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"><span class="comment">// 导出对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">indexQRCode</span>(<span class="params">data</span>)&#123;  <span class="comment">// 不加密</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_request</span>(<span class="string">&#x27;/getHomePageQRcode&#x27;</span>, <span class="string">&#x27;post&#x27;</span>, data, &#123; <span class="attr">level</span>: <span class="number">2</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getProduct</span>(<span class="params">data</span>)&#123;   <span class="comment">// 加密</span></span><br><span class="line">  <span class="keyword">const</span> headers = &#123; </span><br><span class="line">    <span class="attr">level</span>: <span class="number">1</span>,     </span><br><span class="line">    <span class="attr">module</span>: <span class="string">&quot;prodAction&quot;</span>, </span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;getProductInfoList&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_request</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;post&#x27;</span>, data, headers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 资料上传</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">batchFileUpload</span>(<span class="params">data, progressfn</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">form_upload</span>(<span class="string">&#x27;/UploadController&#x27;</span>, data, progressfn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件数据上传</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">form_upload</span>(<span class="params">url, data, progressfn</span>)&#123;</span><br><span class="line">  <span class="comment">// formData 需要纯净的 axios 请求</span></span><br><span class="line">  <span class="keyword">const</span> formAxios = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_URL</span>,</span><br><span class="line">    <span class="attr">responseType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">    <span class="comment">// timeout: 10000,</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">formAxios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: data,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&quot;multipart/form-data&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onUploadProgress</span>(<span class="params">progressEvent</span>) &#123; <span class="comment">// 原生获取上传进度的事件</span></span><br><span class="line">      <span class="comment">// lengthComputable 主要表明总工作量和已完成工作是否可以被测量</span></span><br><span class="line">      progressEvent.<span class="property">lengthComputable</span> &amp;&amp; <span class="title function_">progressfn</span>(progressEvent);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表单数据上传</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_request</span> (url, methods, data, headers = &#123; <span class="attr">level</span>: <span class="number">1</span> &#125;, params = &#123;&#125;) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">service</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: methods,</span><br><span class="line">    <span class="attr">url</span>: headers.<span class="property">level</span> == <span class="number">1</span> ? <span class="string">&quot;/api&quot;</span> : url,</span><br><span class="line">    <span class="attr">data</span>: data,</span><br><span class="line">    <span class="attr">params</span>: <span class="title class_">Object</span>.<span class="title function_">assign</span>(params),</span><br><span class="line">    <span class="attr">headers</span>: <span class="title class_">Object</span>.<span class="title function_">assign</span>(headers),</span><br><span class="line">    <span class="attr">responseType</span>: headers.<span class="property">level</span> == <span class="number">1</span> ? <span class="string">&quot;text&quot;</span> : <span class="string">&quot;json&quot;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="引用方法"><a href="#引用方法" class="headerlink" title="引用方法"></a>引用方法</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js 全局引用</span></span><br><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;./axios&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$axios</span> = http</span><br><span class="line"></span><br><span class="line"><span class="comment">// 局部引用</span></span><br><span class="line"><span class="keyword">import</span> &#123; indexQRCode &#125; <span class="keyword">from</span> <span class="string">&#x27;@/axios&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="加密方法"><a href="#加密方法" class="headerlink" title="加密方法"></a>加密方法</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tool.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机整数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">random</span>(<span class="params">min, max</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(max == <span class="literal">null</span>)&#123;</span><br><span class="line">    max = min;  </span><br><span class="line">    min = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> min + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*(max-min+<span class="number">1</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** randomWord 产生任意长度随机字母数字组合</span></span><br><span class="line"><span class="comment">** randomFlag-是否任意长度 min-任意长度最小位[固定位数] max-任意长度最大位</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">randomWord</span>(<span class="params">randomFlag, min, max</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> str = <span class="string">&quot;&quot;</span>,</span><br><span class="line">  pos = <span class="string">&quot;&quot;</span>,</span><br><span class="line">  range = min,</span><br><span class="line">  arr = [<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>];</span><br><span class="line">  <span class="comment">// 随机产生</span></span><br><span class="line">  <span class="keyword">if</span>(randomFlag)&#123;</span><br><span class="line">      range = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max-min)) + min;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; range; i++)&#123;</span><br><span class="line">      pos = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (arr.<span class="property">length</span>-<span class="number">1</span>));</span><br><span class="line">      str += arr[pos];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** crypto-js </span></span><br><span class="line"><span class="comment">** word：待加密或者解密的字符串</span></span><br><span class="line"><span class="comment">** keyStr：AES 加密需要用到的16位字符串的key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CryptoJS</span> <span class="keyword">from</span> <span class="string">&#x27;crypto-js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> crypto = &#123;</span><br><span class="line">  <span class="attr">aesKey</span>: <span class="string">&#x27;com.iescp.gate&#x27;</span>,</span><br><span class="line">  <span class="title class_">AESEnc</span> (content, key) &#123;</span><br><span class="line">    key = key || <span class="variable language_">this</span>.<span class="property">aesKey</span>;</span><br><span class="line">    key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(key) <span class="comment">// 加密密钥</span></span><br><span class="line">    <span class="keyword">var</span> srcs = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(content)</span><br><span class="line">    <span class="keyword">var</span> encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(srcs, key, &#123; </span><br><span class="line">      <span class="attr">iv</span>: key, </span><br><span class="line">      <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span> </span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="title function_">toString</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title class_">AESDec</span>: <span class="keyword">function</span> (<span class="params">content, key</span>) &#123;</span><br><span class="line">    key = key || <span class="variable language_">this</span>.<span class="property">aesKey</span>;</span><br><span class="line">    key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(key) <span class="comment">// 解密密钥</span></span><br><span class="line">    <span class="keyword">let</span> decrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(content, key, &#123; </span><br><span class="line">      <span class="attr">iv</span>: key, </span><br><span class="line">      <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span> </span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> decryptedStr = decrypted.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>)</span><br><span class="line">    <span class="keyword">return</span> decryptedStr;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<h1 id="五、状态管理-Vuex"><a href="#五、状态管理-Vuex" class="headerlink" title="五、状态管理 Vuex"></a>五、状态管理 Vuex</h1><h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><blockquote>
<p>本质是一个挂载到 vue 实例的全局变量对象 store，它的属性和方法负责管理所有组件的状态及其更新。</p>
</blockquote>
<ul>
<li><strong>state</strong>：包含所有应用级别状态的对象 (组件用到的数据)。</li>
<li><strong>getters</strong>：派生出 state 所需数据 (计算属性)。</li>
<li><strong>mutators</strong>：更新 state 的唯一方式 (同步更新)。</li>
<li><strong>actions</strong>：异步提交 mutaions 更新状态 (异步更新)。</li>
<li><strong>module</strong>：划分为不同模块管理 (方便维护大型项目)。</li>
</ul>
<h2 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h2><ul>
<li>只能应用于 Vue，通过响应式机制更新视图。</li>
<li>单一数据源：全局只有一个 Store 实例。</li>
<li>单向数据流：<code>View、Action、Mutation、State</code>。</li>
</ul>
  <div align="center">
      <img src="/images/vue/vuex_base.png" alt="Vuex 单向数据流" width="100%">
  </div>
          
      
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><blockquote>
<p>如果 store 文件太大则需要分割到单独文件。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">store</span><br><span class="line">  ├── index.<span class="property">js</span>         <span class="comment">// 组装模块并导出store </span></span><br><span class="line">  ├── actions.<span class="property">js</span>       <span class="comment">// 根级别的 action</span></span><br><span class="line">  ├── mutations.<span class="property">js</span>     <span class="comment">// 根级别的 mutation</span></span><br><span class="line">  └── modules          <span class="comment">// 大型应用时分割到模块</span></span><br><span class="line">      ├── cart.<span class="property">js</span>      <span class="comment">// 购物车模块</span></span><br><span class="line">      └── products.<span class="property">js</span>  <span class="comment">// 产品模块</span></span><br></pre></td></tr></table></figure>


<h2 id="自定义配置-1"><a href="#自定义配置-1" class="headerlink" title="自定义配置"></a>自定义配置</h2><h3 id="单个文件"><a href="#单个文件" class="headerlink" title="单个文件"></a>单个文件</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vuex/store.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="comment">// state 状态变量</span></span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">VIEWID</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">LOADING</span>: &#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// state 的计算属性：派生所需状态</span></span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="title class_">IDNew</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;  </span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">ID</span> * <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 同步更新 state：store.commit(&#x27;showLoad&#x27;, &#123; status: 1, msg: &quot;&quot; &#125;)</span></span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">viewEntrance</span>(<span class="params">state, id</span>)&#123;</span><br><span class="line">      state.<span class="property">VIEWID</span> = id</span><br><span class="line">    &#125;,</span><br><span class="line">    showLoad (state, obj)&#123;</span><br><span class="line">      state.<span class="property">LOADING</span> = obj</span><br><span class="line">    &#125;,</span><br><span class="line">    hideLoad (state)&#123;</span><br><span class="line">      state.<span class="property">LOADING</span> = &#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&quot;&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 异步更新 state：this.$store.dispatch(&#x27;viewEntrance&#x27;, id)</span></span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 简写写法</span></span><br><span class="line">    <span class="attr">viewEntrance</span>: <span class="function">(<span class="params">&#123; commit &#125;, id</span>) =&gt;</span> <span class="title function_">commit</span>(<span class="string">&#x27;viewEntrance&#x27;</span>, id),</span><br><span class="line">    <span class="comment">// 完整写法</span></span><br><span class="line">    <span class="attr">viewEntrance</span>: <span class="function">(<span class="params"> context, id</span>) =&gt;</span> &#123; context.<span class="title function_">commit</span>(<span class="string">&#x27;viewEntrance&#x27;</span>, id) &#125;,</span><br><span class="line">    <span class="comment">// 异步操作</span></span><br><span class="line">    <span class="attr">entryAsync</span>: <span class="function">(<span class="params">&#123; commit &#125;, id</span>) =&gt;</span> &#123;  </span><br><span class="line">      <span class="built_in">setTimeout</span> (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">commit</span>(<span class="string">&#x27;viewEntrance&#x27;</span>, id)</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 分割成不同模块以方便管理：使用时不再导出以上变量</span></span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: &#123;</span><br><span class="line">      <span class="attr">state</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">getters</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">mutations</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">actions</span>: &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">b</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="全局引用"><a href="#全局引用" class="headerlink" title="全局引用"></a>全局引用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./vuex&#x27;</span>  </span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="组件使用"><a href="#组件使用" class="headerlink" title="组件使用"></a>组件使用</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters, mapMutations, mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span>&#123;</span><br><span class="line">          <span class="attr">localState</span>: <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 普通写法</span></span><br><span class="line">  <span class="attr">computed</span>: &#123;     </span><br><span class="line">      count () &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">isShow</span>(<span class="params"></span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">isShow</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 简洁写法：使用辅助函数返回对象并映射到组件实例</span></span><br><span class="line">  <span class="attr">computed</span>: <span class="title function_">mapState</span>(&#123;  </span><br><span class="line">      <span class="attr">count</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">count</span>, </span><br><span class="line">      <span class="attr">countAlias</span>: <span class="string">&#x27;count&#x27;</span>,      <span class="comment">// 改变名称</span></span><br><span class="line">      <span class="title function_">countPlus</span>(<span class="params">state</span>)&#123;         <span class="comment">// 使this指向组件对象</span></span><br><span class="line">          <span class="keyword">return</span> state.<span class="property">count</span> + <span class="variable language_">this</span>.<span class="property">localState</span>; </span><br><span class="line">      &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">computed</span>: <span class="title function_">mapState</span>([<span class="string">&#x27;count&#x27;</span>, <span class="string">&#x27;isShow&#x27;</span>]),  <span class="comment">// 名称相同</span></span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">local</span>(<span class="params"></span>)&#123;         <span class="comment">// 组件数据</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">localState</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 使用对象展开运算符将数据混入 computed 对象</span></span><br><span class="line">    ...<span class="title function_">mapState</span>([    <span class="comment">// 映射 State</span></span><br><span class="line">      <span class="string">&#x27;count&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;isShow&#x27;</span></span><br><span class="line">    ]),</span><br><span class="line">    ...<span class="title function_">mapGetters</span>([  <span class="comment">// 映射 Getters </span></span><br><span class="line">      <span class="string">&#x27;countNew&#x27;</span></span><br><span class="line">    ])</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">methods</span>: &#123;   </span><br><span class="line">    <span class="title function_">reduce</span>(<span class="params"></span>)&#123;     <span class="comment">// 有参数时需单独定义</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)           <span class="comment">// 同步</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;reduce&#x27;</span>, <span class="number">2</span>)   <span class="comment">// 异步</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...<span class="title function_">mapActions</span>([  <span class="comment">// 映射 Mutations</span></span><br><span class="line">      <span class="string">&#x27;add&#x27;</span>,  </span><br><span class="line">      <span class="string">&#x27;tog&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;addAsync&#x27;</span></span><br><span class="line">    ])</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: <span class="title function_">mapActions</span>([<span class="string">&#x27;add&#x27;</span>])</span><br><span class="line">  <span class="attr">methods</span>: <span class="title function_">mapMutations</span>([<span class="string">&#x27;add&#x27;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="简单用法"><a href="#简单用法" class="headerlink" title="简单用法"></a>简单用法</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">LOADING</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setState</span>(<span class="params">state, newState</span>) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(state, newState)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123; &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>, &#123;</span><br><span class="line">  <span class="attr">showLoading</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;setState&#x27;</span>, &#123; <span class="attr">LOADING</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">hideLoading</span>(<span class="params"></span>) &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;setState&#x27;</span>, &#123; <span class="attr">LOADING</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件中使用</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">showLoading</span>()</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">hideLoading</span>()</span><br></pre></td></tr></table></figure>


<h1 id="六、组件化开发"><a href="#六、组件化开发" class="headerlink" title="六、组件化开发"></a>六、组件化开发</h1><h2 id="组件实例化"><a href="#组件实例化" class="headerlink" title="组件实例化"></a>组件实例化</h2><blockquote>
<p>组件只有挂载到某个 Vue 实例下才会生效，挂载的本质就是创建一个包含数据、方法和组件的 vue 实例对象。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、直接创建</span></span><br><span class="line"><span class="keyword">var</span> app1 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&quot;#app1&quot;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、首先创建无挂载点的实例</span></span><br><span class="line"><span class="keyword">var</span> app2 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;    </span><br><span class="line">  <span class="attr">data</span>: &#123;          <span class="comment">// 对象</span></span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;app2&quot;</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app2.$mount(<span class="string">&#x27;#app2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、使用基础 Vue 构造器创建子类</span></span><br><span class="line"><span class="keyword">var</span> app3 = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;   <span class="comment">// 函数</span></span><br><span class="line">    <span class="keyword">return</span>&#123; </span><br><span class="line">      <span class="attr">msg</span>:<span class="string">&quot;app3&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)    </span><br><span class="line"><span class="keyword">new</span> <span class="title function_">app3</span>().$mount(<span class="string">&#x27;#app3&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h2 id="组件定义"><a href="#组件定义" class="headerlink" title="组件定义"></a>组件定义</h2><blockquote>
<p>三种书写方式：<strong>单文件组件</strong>、<strong>template 标签</strong>、<strong>script 标签</strong>。组件必须注册才能生效。组件和指令命名时注意：不能使用标签和关键字、尽量不使用驼峰命名 (因为 webpack 编译后会统一变为小写)，如果有大写字母则使用时必须都改为小写并添加 <code>-、v-</code>。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单文件组件配置选项：扩展名为 vue</span></span><br><span class="line"><span class="keyword">var</span> myMixin = </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">mixins</span>: [        <span class="comment">// 混入：扩展组件功能，可看作继承。</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">msg</span>:<span class="string">&#x27;mixins:msg&#x27;</span>,</span><br><span class="line">          <span class="attr">name</span>:<span class="string">&#x27;mixins:name&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;mixin:hello&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">hello</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">directive</span>: &#123;</span><br><span class="line">    <span class="comment">// 注册一个局部的自定义指令 v-auto-focus</span></span><br><span class="line">    <span class="attr">autoFocus</span>: &#123;</span><br><span class="line">      <span class="title function_">bind</span>(<span class="params">el, binding, vnode</span>)&#123; </span><br><span class="line">        <span class="comment">// 创建：指令第一次绑定到元素时调用，比如添加事件监听器等</span></span><br><span class="line">      &#125;,      </span><br><span class="line">      <span class="title function_">inserted</span>(<span class="params">el</span>)&#123;    </span><br><span class="line">        el.<span class="title function_">focus</span>()</span><br><span class="line">        <span class="comment">// 插入：当元素被插入到 DOM</span></span><br><span class="line">      &#125;,      </span><br><span class="line">      <span class="title function_">update</span>(<span class="params">el, binding, vnode, oldVnode</span>)&#123; </span><br><span class="line">        <span class="comment">// 更新：当元素所在模板更新时</span></span><br><span class="line">      &#125;,     </span><br><span class="line">      <span class="title function_">componentUpdate</span>(<span class="params">el, binding, vnode, oldVnode</span>)&#123; </span><br><span class="line">        <span class="comment">// 当元素所在模板完成一次更新周期时</span></span><br><span class="line">      &#125;,   </span><br><span class="line">      <span class="title function_">unbind</span>(<span class="params">el, binding, vnode</span>)&#123;          </span><br><span class="line">        <span class="comment">// 解除绑定时只调用一次，比如移除 bind 时绑定的事件监听器</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">filters</span>: &#123;          <span class="comment">// 过滤器：&#123;&#123;user.age | sum&#125;&#125; </span></span><br><span class="line">    sum (value) &#123;</span><br><span class="line">      <span class="keyword">return</span> value == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">components</span>: &#123; <span class="comment">// 组件注册：使用时 &lt;my-com&gt;</span></span><br><span class="line">    <span class="title class_">MyCom</span> </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>)&#123;      <span class="comment">// 组件数据：组件内必须使用箭头函数，否则 this 不指向当前组件</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;tom&quot;</span></span><br><span class="line">      <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123; &#125;,   <span class="comment">// 计算属性：派生所需数据</span></span><br><span class="line">  <span class="attr">methods</span>: &#123; &#125;,    <span class="comment">// 事件绑定：事件名不区分大小写)</span></span><br><span class="line">  <span class="attr">watch</span>:&#123;          <span class="comment">// 监听数据</span></span><br><span class="line">    <span class="attr">user</span>: &#123;        <span class="comment">// 深度监听(可监听到对象内部属性变化)</span></span><br><span class="line">      <span class="attr">handler</span>: <span class="string">&#x27;getList&#x27;</span>,</span><br><span class="line">      <span class="attr">immediate</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">      <span class="title function_">handler</span>(<span class="params">val, oldval</span>)&#123; &#125;,</span><br><span class="line">      <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,  </span><br><span class="line">    <span class="string">&quot;user.name&quot;</span>: <span class="keyword">function</span>(<span class="params">val, oldval</span>)&#123; <span class="comment">// 必须加引号  </span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(val)  </span><br><span class="line">    &#125;,</span><br><span class="line">    $route(to, <span class="keyword">from</span>)&#123;            <span class="comment">// 监听子组件路由变化</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(to.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;    <span class="comment">// 生命周期</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$root</span>.<span class="property">eventHub</span>.$on(<span class="string">&#x27;updateDash&#x27;</span>, <span class="variable language_">this</span>.<span class="property">getList</span>)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleScroll</span>)</span><br><span class="line">    <span class="comment">// 推迟回调到下次 DOM 更新循环之后执行</span></span><br><span class="line">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">444</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&#x27;hello&#x27;</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$root</span>.<span class="property">eventHub</span>.$off(<span class="string">&#x27;updateDash&#x27;</span>)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleScroll</span>)</span><br><span class="line">  &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;myCom&#x27;</span>, &#123; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">MyPlugin</span>, &#123; <span class="attr">someOption</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>, &#123;</span><br><span class="line">  showLoading () &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;setState&#x27;</span>, &#123; <span class="attr">LOADING</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">hideLoading</span>(<span class="params"></span>) &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;setState&#x27;</span>, &#123; <span class="attr">LOADING</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&quot;autoFocus &quot;</span>, &#123;</span><br><span class="line">  <span class="title function_">inserted</span>(<span class="params">el</span>)&#123;  el.<span class="title function_">focus</span>() &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">filter</span>(<span class="string">&#x27;formatDate&#x27;</span>, <span class="keyword">function</span> (<span class="params">value, fmt</span>)&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">nextTick</span>()</span><br></pre></td></tr></table></figure>


<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><blockquote>
<p>Vue 实例由创建到销毁的完整运行一次的过程中会触发的函数。</p>
</blockquote>
<ul>
<li><strong>beforeCreate</strong>：初始化非响应式变量，比如添加 Loading。</li>
<li><strong>created</strong>：页面初始化，比如关闭 Loading 和 Ajax 请求。</li>
<li><strong>mounted</strong>：获取和操作 Dom 元素和 Ajax 请求。</li>
<li><strong>updated</strong>：统一处理数据，但可能陷入死循环。</li>
<li><strong>beforeDestroy</strong>：销毁定时器、解绑全局事件、销毁插件对象等操作。</li>
</ul>
  <div align="center">
      <img src="/images/vue/vue_life.png" alt="Vue 生命周期" width="100%">
  </div>


<h2 id="内置指令"><a href="#内置指令" class="headerlink" title="内置指令"></a>内置指令</h2><ul>
<li>数据渲染：<code>双层 &#123; &#125;、v-text、v-html</code></li>
<li>条件渲染：<code>v-if、v-else</code></li>
<li>循环渲染：<ul>
<li>数组：<code>v-for=&quot;(item, index) in arr&quot; :key=&quot;index&quot;</code></li>
<li>对象：<code>v-for=&quot;(item, key, index) of obj&quot; :key=&quot;index&quot;</code></li>
</ul>
</li>
<li>事件绑定：<code>v-on:</code> 可缩写为 <code>@</code>。<ul>
<li>绑定：<code>v-on:click = &quot;todo&quot;、@click = &quot;todo&quot;</code></li>
<li>修饰符：<code>@click.stop.self、@keyup.stop.enter</code>。阻止冒泡 stop、阻止默认 prevent、执行一次 once。</li>
</ul>
</li>
<li>动态绑定：<code>v-bind:</code>，注意可以省略 v-bind <ul>
<li>class：<code>:class=&quot; [&#39;a&#39;, &#39;b&#39;]、[ true ? &#39;a&#39;: &#39;b&#39;]、&#123; &#39;active&#39;: isActive(id) &#125; &quot;</code>。</li>
<li>style：<code>:style=&quot;&#123;color: &#39;red&#39;&#125;、[&#123;color: &#39;red&#39;&#125;, &#123;fontSize: &#39;16px&#39;&#125;]&quot;</code>。</li>
</ul>
</li>
<li>双向绑定<ul>
<li>绑定：<code>v-model、v-model.trim</code></li>
<li>修饰符：trim 首尾空格过滤、lazy 监听change事件、number 字符串转为数字。</li>
</ul>
</li>
<li>性能优化<ul>
<li>只渲染一次：<code>v-once</code></li>
<li>防止页面闪烁：<code>v-cloak</code></li>
<li>不输出 data：<code>v-pre</code></li>
</ul>
</li>
</ul>
<h2 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h2><h3 id="父子组件"><a href="#父子组件" class="headerlink" title="父子组件"></a>父子组件</h3><ul>
<li>子传父：父组件监听 <code>&lt;child @updateList = &quot;updateList&quot;&gt;&lt;/child&gt;</code>，子组件触发自定义事件 <code>this.$emit(&quot;updateList&quot;, data)</code>。</li>
<li>父传子：在子组件中通过 props 定义父组件传递的属性如下：  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父组件：&lt;child name=&quot;Tom&quot; :songs=&quot;songs&quot; :age=&quot;age&quot;&gt;&lt;/child&gt;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 简洁写法</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;songs&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 普通写法</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>:&#123;  <span class="comment">// 静态数据</span></span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">songs</span>:&#123;  <span class="comment">// 动态数据</span></span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">age</span>:&#123;     <span class="comment">// 动态数据验证</span></span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,   </span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// default: 1000,</span></span><br><span class="line">      <span class="title function_">default</span>(<span class="params"></span>)&#123;     <span class="comment">// 默认值, 可直接1000 </span></span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">time</span>: <span class="number">1000</span> &#125; </span><br><span class="line">      &#125;,  </span><br><span class="line">      <span class="title function_">validator</span>(<span class="params">val</span>)&#123;  <span class="comment">// 自定义验证</span></span><br><span class="line">        <span class="keyword">return</span> val &gt; <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="双向绑定"><a href="#双向绑定" class="headerlink" title="双向绑定"></a>双向绑定</h3><blockquote>
<p>同步父子组件数据，注意不要在子组件中修改 props 接收的数据。</p>
</blockquote>
<ul>
<li>普通写法<ul>
<li>父组件监听自定义事件：<code>&lt;com @ut=&quot;val =&gt; pm = val&quot; :m=&quot;pm&quot;&gt;&lt;/com&gt;</code>。</li>
<li>子组件触发事件：<code>props: &#123; m: String &#125;、this.$emit(&#39;ut&#39;, newVal)</code>。</li>
</ul>
</li>
<li>使用 sync<ul>
<li>父组件：<code>&lt;child :s.sync=&quot;startDate&quot;&gt;&lt;/child&gt;</code>。</li>
<li>子组件：<code>props: &#123; s: String &#125;、this.$emit(&quot;update:s&quot;, val)</code>。</li>
</ul>
</li>
</ul>
<h3 id="祖孙组件"><a href="#祖孙组件" class="headerlink" title="祖孙组件"></a>祖孙组件</h3><blockquote>
<p><strong>$attrs</strong> 传递不被 prop 识别的属性 (class、style除外)、**$listeners**：传递组件的事件 (.native除外)。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.vue</span></span><br><span class="line">&lt;child sex=<span class="string">&quot;男&quot;</span> width=<span class="string">&quot;80&quot;</span> height=<span class="string">&quot;80&quot;</span> @change=<span class="string">&quot;change&quot;</span>&gt;&lt;/child&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// child.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">grand</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;$listeners&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">grand</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// grand.vue</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;sex&#x27;</span>],</span><br><span class="line">  <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,  <span class="comment">// 去掉默认行为</span></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// &#123; width: &quot;80&quot;, height: &quot;80&quot; &#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$attrs</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// change 事件</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$listeners</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="provide、inject"><a href="#provide、inject" class="headerlink" title="provide、inject"></a>provide、inject</h3><blockquote>
<p>允许一个祖先组件向其所有子孙后代注入一个依赖，但是绑定并不是可响应的。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="attr">provide</span>: &#123;      <span class="comment">// 一个对象</span></span><br><span class="line">  <span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">  <span class="attr">fooMethod</span>: <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;fooMethod 被调用&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子孙组件</span></span><br><span class="line"><span class="attr">inject</span>: [<span class="string">&#x27;foo&#x27;</span>,<span class="string">&#x27;fooMethod&#x27;</span>], <span class="comment">// 数组或对象，注入到子组件</span></span><br><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">fooMethod</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">foo</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="template-标签"><a href="#template-标签" class="headerlink" title="template 标签"></a>template 标签</h2><blockquote>
<p>可看作一个不可见的包裹元素，主要用于分组的条件判断和列表渲染。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 条件渲染：通过 key 实现切换时清空内容。</span></span><br><span class="line">&lt;template v-<span class="keyword">if</span>=<span class="string">&quot;loginType === &#x27;username&#x27;&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your username&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your email address&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// 列表渲染</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in items&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; item.msg &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;divider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br></pre></td></tr></table></figure>


<h2 id="内置组件"><a href="#内置组件" class="headerlink" title="内置组件"></a>内置组件</h2><ul>
<li><strong>transition</strong>：单个元素&#x2F;组件的过渡效果</li>
<li><strong>transition-group</strong>：多个元素&#x2F;组件的过渡效果</li>
<li><strong>component</strong>：支持两个属性 is、inline-template</li>
<li><strong>keep-alive</strong>：保留组件状态或避免重新渲染</li>
<li><strong>slot</strong>：替换 slot 元素实现内容嵌套</li>
</ul>
<h2 id="特殊特性"><a href="#特殊特性" class="headerlink" title="特殊特性"></a>特殊特性</h2><ul>
<li><strong>key</strong>  <ul>
<li>管理可复用的元素：<code>&lt;router-view :key=&quot;$route.fullPath&quot;&gt;</code></li>
<li>减少运算来提高循环性能：<code>v-for=&quot;item in items&quot; :key=&quot;item.id&quot;</code></li>
</ul>
</li>
<li><strong>is</strong><ul>
<li>使用 v-bind:is 实现动态组件的切换效果<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- change: this.index = (++this.ndex)%3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">change</span>=<span class="string">&quot;change&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">&quot;fade&quot;</span> <span class="attr">appear</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;views[index]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">&quot;move&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;out-in&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- include：字符串/正则，只有匹配的组件被缓存 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- exclude：字符串/正则，任何匹配的组件都不会被缓存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">&quot;tagList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>用于在 ul 等受限制的 html 元素中绑定组件：<code>&lt;li is=&quot;com1&quot;&gt;&lt;/li&gt;</code></li>
</ul>
</li>
<li><strong>slot</strong> <ul>
<li>配合 slot 内置组件实现嵌套内容的相应显示。</li>
<li>没有 slot 时不显示嵌套内容，多个 slot 时需使用具名插槽 (添加 name 属性)。<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">is</span>=<span class="string">&quot;lis_slot&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;first&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;print&quot;</span>&gt;</span>first<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;second&quot;</span>&gt;</span>second<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- lis_slot.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;first&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;second&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><strong>ref</strong>  <ul>
<li>获取当前 DOM 元素：<code>&lt;li ref=&quot;cur&quot;、this.$refs.cur&gt;&lt;/li&gt;</code></li>
<li>获取子组件实例对象：<code>&lt;my-com ref=&quot;com&quot;&gt;&lt;/my-com&gt;、this.$refs.com</code></li>
</ul>
</li>
</ul>
<h1 id="七、插件开发"><a href="#七、插件开发" class="headerlink" title="七、插件开发"></a>七、插件开发</h1><blockquote>
<p>本质是一个必须提供一个公开接口的对象或函数，用来扩展 vue 功能而实现组件无法实现的很多需求。插件可以封装组件，组件可以暴露数据给插件。</p>
</blockquote>
<h2 id="常规写法"><a href="#常规写法" class="headerlink" title="常规写法"></a>常规写法</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// toast.js</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Toast</span> = &#123;&#125;;        </span><br><span class="line"><span class="title class_">Toast</span>.<span class="property">install</span> = <span class="keyword">function</span> (<span class="params">Vue, options</span>) &#123; </span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$msg</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Toast</span>;      </span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js：Vue.use() 会自动调用 install() 并阻止相同插件注册多次</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Toast</span> <span class="keyword">from</span> <span class="string">&#x27;./toast.js&#x27;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Toast</span>);  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$msg</span>);   <span class="comment">// Hello World</span></span><br></pre></td></tr></table></figure>


<h2 id="模板写法"><a href="#模板写法" class="headerlink" title="模板写法"></a>模板写法</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">install</span>: <span class="keyword">function</span> (<span class="params">Vue, options</span>) &#123; <span class="comment">//options一般是对象</span></span><br><span class="line">    <span class="comment">// 添加全局方法和属性</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property">myProperty</span> = <span class="string">&#x27;Hello Vue&#x27;</span>,    </span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property">myGlobalMethod</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;, </span><br><span class="line">            </span><br><span class="line">    <span class="comment">// 添加全局资源：指令、过滤器、过渡等</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, <span class="keyword">function</span>(<span class="params">el, binding, vnode, oldVnode</span>)&#123; &#125;)  </span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">filter</span>(<span class="string">&#x27;formatTime&#x27;</span>, <span class="keyword">function</span> (<span class="params">value</span>)&#123; &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加组件选项：混入 Vue 实例本身没有的方法</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;        </span><br><span class="line">      <span class="title function_">created</span>(<span class="params"></span>)&#123; &#125;,</span><br><span class="line">      <span class="attr">methods</span>: &#123; &#125;</span><br><span class="line">    &#125;) </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加实例方法：调用时使用 this.$get()</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$get</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>JS 框架</category>
      </categories>
      <tags>
        <tag>JS 框架</tag>
      </tags>
  </entry>
  <entry>
    <title>JS 编程范式</title>
    <url>/2019/06/01/4-6-js%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="一、编程范式"><a href="#一、编程范式" class="headerlink" title="一、编程范式"></a>一、编程范式</h1><blockquote>
<p>即编程语言典型的编程风格&#x2F;方式，每种编程语言都适用于多种范式，它是程序员看待程序的观点，比如面向对象编程中的程序是一系列相互作用的对象、函数式编程中则是一个无状态的函数组合序列。</p>
</blockquote>
<ul>
<li><strong>命令式编程</strong>：注重执行过程的面向过程编程（解答题），根据步骤依次执行代码来解决问题。优点是性能高、不需要实例化等操作，缺点是依赖和影响外部变量、代码可读性低。</li>
<li><strong>声明式编程</strong>：注重执行结果的正则表达式、函数式编程（选择题），通过固定的函数或规则处理声明的变量来得到结果。优点是不依赖和影响外部变量、代码方便维护，缺点是占用资源较多、性能较差。</li>
<li><strong>面向对象编程</strong>：根据功能将问题分解并封装为包含属性和方法的各个对象。优点是复用性和可扩展性高、代码方便维护，缺点是代码可能冗余、性能较低。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 命令式</span></span><br><span class="line"><span class="keyword">var</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> doubled = []</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numbers.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> newNumber = numbers[i] * <span class="number">2</span></span><br><span class="line">  doubled.<span class="title function_">push</span>(newNumber)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 声明式</span></span><br><span class="line"><span class="comment">*   map 接受的是一个纯函数；它不具有任何副作用 (不会改变外部状态)</span></span><br><span class="line"><span class="comment">*   map 函数所做的事情是将直接遍历整个数组的过程归纳抽离出来，让我们专注于描述想要的是什么</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">var</span> doubled = numbers.<span class="property">map</span> (<span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n * <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(doubled)   <span class="comment">// [2, 4, 6, 8, 10]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 面向对象</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">Task</span> = <span class="keyword">function</span>(<span class="params">nums</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">nums</span> = nums;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Task</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">square</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> squares = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="variable language_">this</span>.<span class="property">nums</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        squares.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">nums</span>[i]*<span class="variable language_">this</span>.<span class="property">nums</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> squares;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title class_">Task</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sum</span> = <span class="keyword">function</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        res += arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> t = <span class="keyword">new</span> <span class="title class_">Task</span>([<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>]);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(t.<span class="title function_">sum</span>(t.<span class="title function_">square</span>()));  <span class="comment">// 56</span></span><br><span class="line">&#125;())</span><br></pre></td></tr></table></figure>


<h1 id="二、常用编程模式"><a href="#二、常用编程模式" class="headerlink" title="二、常用编程模式"></a>二、常用编程模式</h1><blockquote>
<p>模块化编程和异步编程内容较多，下面详述。</p>
</blockquote>
<h2 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h2><blockquote>
<p>注重结果而不在乎过程，过程交给别人处理，提倡函数封装性思想。实现方式是将实现逻辑封装为 API 并相互调用。优点是避免状态共享、可变数据及副作用的产生。</p>
</blockquote>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li><strong>函数</strong>：指数学中的函数而不是指命令式编程中的函数。自变量的映射，一个函数的值仅决定于函数参数的值而不依赖其他状态。</li>
<li><strong>纯函数</strong>：相同输入永远会得到相同输出的函数。没有任何副作用，不依赖、不改变外部状态。比如 slice 不会改变原数组而是纯函数，splice 会改变原数组而不符合条件。</li>
<li><strong>变量和表达式</strong>：变量指值的名称而非命令式编程中的变量 (存储状态的内存单元)，变量值不可变。表达式指一个有返回值的运算过程，函数式编程要求只使用表达式而不使用语句。语句则是执行操作但没有返回值，比如命令式编程的条件语句、循环语句等控制语句。</li>
<li><strong>状态</strong>：程序是拥有状态的。程序执行到断点时就停留在了某个状态，它包括了当前定义的全部变量和一些当前系统的状态，比如打开的文件、网络的连接、申请的内存等。具体保存的信息和语言有关系。程序通过状态不断推进直至目标。函数式编程强调无状态并不是不保存状态，而是强调将状态锁定在函数的内部，不依赖于外部的任何状态。准确点说，它是通过函数创建新的参数或返回值来将保存程序的状态全部完全保存到栈上。</li>
<li><strong>函数柯里化</strong>：将一个低阶函数转换为高阶函数的过程。</li>
<li><strong>函数组合</strong>：不使用所要处理的值，只合成运算过程。为了解决嵌套过深的函数如洋葱代码 h(g(f(x)))，我们需要通过函数组合一起来用柯里化来优化，让多个函数像拼积木一样。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 柯里化之前</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x, y</span>) &#123; <span class="keyword">return</span> x + y &#125;</span><br><span class="line"><span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 柯里化之后</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addX</span>(<span class="params">y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">x</span>) &#123; <span class="keyword">return</span> x + y &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">addX</span>(<span class="number">2</span>)(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数组合</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">compose</span> = (<span class="params">f, g</span>) =&gt; (<span class="function"><span class="params">x</span> =&gt;</span> <span class="title function_">f</span>(<span class="title function_">g</span>(x)))</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">first</span> = arr =&gt; arr[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">var</span> reverse = arr = arr.<span class="title function_">reverse</span>()</span><br><span class="line"><span class="keyword">var</span> last = <span class="title function_">compose</span>(first, reverse)</span><br><span class="line"><span class="title function_">last</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])      <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li><strong>高阶函数</strong>：参数为函数或返回值为函数的函数。它提供了一种函数级别上的依赖注入（或反转控制）机制，可以将复用的粒度降低到函数级别。</li>
<li><strong>闭包</strong>：在形式上就是一个函数内部定义另一个函数，函数的堆栈在在函数返回后并不释放，可以理解为这些函数堆栈并不在栈上分配而是在堆上分配。</li>
<li><strong>访问权限控制</strong>：JS 中的作用域</li>
<li><strong>延长变量生命周期</strong>：面向对象语言里，函数内的变量是在栈上分配并在调用完成后销毁，变量的生命周期结束。而对象是在堆分配的，会常驻内存，除非被手动或自动回收掉。</li>
<li><strong>函子 Functor</strong>：遵守一些特定规则的容器类型，任何具有 map 方法的数据结构都可看作它的实现。它是一个对于函数调用的抽象，我们赋予容器自己去调用函数的能力。把东西装进一个容器，只留出一个接口 map 给容器外的函数，map 一个函数时，我们让容器自己来运行这个函数，这样容器就可以自由地选择何时何地如何操作这个函数。</li>
</ul>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><blockquote>
<p>由于命令式编程语言也可以通过类似函数指针的方式来实现高阶函数，函数式的最主要的好处主要是不变性带来的。</p>
</blockquote>
<ul>
<li><strong>引用透明</strong>：指函数的运行不依赖于外部变量或状态。没有可变的状态而只依赖于输入的参数，只要参数相同则引用函数所得到的返回值都是相同的。其它语言的函数返回值一般与系统状态有关。这样很不利于观察和理解程序的行为。</li>
<li><strong>没有副作用</strong>：副作用指函数内部与外部互动而产生运算以外的其他结果。</li>
<li><strong>无锁并发</strong>：没有副作用使得函数式编程各个独立的部分的执行顺序可以随意打乱。（多个线程之间）不共享状态，不会造成资源争用，则不需要用锁来保护可变状态，也就不会出现死锁，这样可以更好地进行无锁的并发操作。</li>
<li><strong>惰性求值</strong>：在将表达式赋值给变量（或称作绑定）时并不计算表达式的值，而在变量第一次被使用时才进行计算。这样就可以通过避免不必要的求值提升性能。</li>
</ul>
<h2 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h2><blockquote>
<p>将具体问题分解并抽象为一个个具体的对象，并且将对象及其公共的属性和方法封装成一个类，整个程序由对象之间的分工和合作完成。主要特点有封装 (只能通过对象来访问方法)、继承 (从已有对象上继承出新的对象)、多态 (多对象的不同形态)，极大提高了大型程序的重用性和可维护性。核心在于类的实现：js 基于 function 来模拟类，通过 prototype 属性来实现类方法的共享，ES6 class 是用来定义类的一个语法糖，通过 extends 来继承父类。类的定义如下：</p>
</blockquote>
<ul>
<li><strong>工厂模式</strong>：解决了重复实例化多个对象的问题，但是不能识别各自的实例化对象。</li>
<li><strong>构造函数模式</strong>：把函数当作一个类，实例化时它会隐式创建一个空对象并最后返回。建议首字母大写以区分普通函数，实例化的对象可以通过 instanceof 判断它的实例。</li>
<li><strong>原型模式</strong>：好处是可以让 <code>所有对象实例</code> 共享 <code>原型对象</code> 所包含的属性和方法。</li>
<li><strong>混合模式</strong>：可变属性写入构造函数，固定属性和方法写入原型对象，这样可以节省内存。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 工厂模式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">person</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;&#125;;     <span class="comment">// 原料</span></span><br><span class="line">  obj.<span class="property">name</span> = name;  <span class="comment">// 加工</span></span><br><span class="line">  obj.<span class="property">age</span> = age;    </span><br><span class="line">  obj.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)    </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj     </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="title function_">person</span>(<span class="string">&quot;tom&quot;</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数模式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>)&#123;     <span class="comment">// 类：模具</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;    </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)    </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;tom&quot;</span>, <span class="number">20</span>);  <span class="comment">// 实例化对象：产品</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2 <span class="keyword">instanceof</span> <span class="title class_">Person</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型模式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;  &#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&quot;tom&quot;</span>;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> = <span class="number">24</span>;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>) </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p3 = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 混合模式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;   </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p4 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br></pre></td></tr></table></figure>


<h2 id="面向切面编程"><a href="#面向切面编程" class="headerlink" title="面向切面编程"></a>面向切面编程</h2><blockquote>
<p>无侵入地将一个函数插入到另一个函数的前面或后面。</p>
</blockquote>
<div style="text-indent: 2em">主要功能是将日志统计、异常处理等一些跟核心业务逻辑模块无关的功能抽离出来并封装，然后动态插入到业务逻辑模块的指定位置。这样不仅简化了业务逻辑模块，而且方便统一管理功能模块。AOP 其实只是 OOP 的补充，OOP 从横向上区分出一个个的类，AOP 则从纵向上向对象中加入特定的代码。常用场景如下：`防止 window.onload 被二次覆盖、给 Ajax 请求动态添加参数、统计函数的执行时间、分离表单请求和校验、职责链模式、组合替代继承`。</div>


  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// before 切面：让一个函数在另一个函数之前执行</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">before</span> = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="variable language_">this</span>;     <span class="comment">// 保存原函数引用</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)   <span class="comment">// 执行新函数，修正 this</span></span><br><span class="line">    <span class="keyword">return</span> _self.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);  <span class="comment">// 执行原函数</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// after 切面：让一个函数在另一个函数之后执行</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">after</span> = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ret = _self.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;tangdy&#x27;</span>,</span><br><span class="line">  <span class="attr">getName</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">getName</span> = obj.<span class="property">getName</span>.<span class="title function_">before</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;before&quot;</span>)</span><br><span class="line">&#125;).<span class="title function_">after</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;after&quot;</span>)</span><br><span class="line">&#125;);</span><br><span class="line">obj.<span class="title function_">getName</span>();</span><br></pre></td></tr></table></figure>


<h2 id="事件驱动编程"><a href="#事件驱动编程" class="headerlink" title="事件驱动编程"></a>事件驱动编程</h2><blockquote>
<p>命令式编程的代码本身给出了程序执行的顺序，但事件驱动程序中的许多代码可能在完全不可预料的时刻被执行 (由用户与正在执行的程序的互动激发导致)。常用于用户与程序的交互，常用于 GUI (图形用户界面) 编程应用通过图形用户接口（鼠标、键盘、触摸板）进行交互式的互动，也可以用于异常的处理和响应用户自定义的事件等。实现事件驱动需要考虑事件定义、事件触发、事件转化、事件合并、事件排队、事件分派、事件处理、事件连带等实际问题，属于事件驱动的编程语言有：VB、C#、Java、Node.js 等。</p>
</blockquote>
<ul>
<li><strong>事件</strong>：通知某个特定的事情已经发生（事件发生具有随机性）。</li>
<li><strong>事件与轮询</strong>：事件是静静地等待事情的发生，轮询则是一种无休止地观察和判断。</li>
<li><strong>事件处理器</strong>：对事件做出响应时执行的代码，使得程序能够对用户行为做出反映。</li>
</ul>
<h1 id="三、模块化编程"><a href="#三、模块化编程" class="headerlink" title="三、模块化编程"></a>三、模块化编程</h1><div style="text-indent: 2em">早期引用 JS 文件时直接通过 script，但是随着项目的复杂度越来越大，这种方式带来了逻辑混乱、可维护性差等问题。所以将代码合理拆分到不同的文件里，每个实现特定功能的文件就是一个模块，文件路径就是模块名，这种组织代码的方式就是模块化。</div> 

<ul>
<li><strong>编程优势</strong><ul>
<li>开发效率高，有利于多人协同开发。</li>
<li>解决项目中的全局变量污染的问题。</li>
<li>功能单一，方便代码的复用和维护。</li>
<li>解决文件依赖问题，无需关注文件引用顺序。</li>
</ul>
</li>
<li><strong>执行环境</strong><ul>
<li>服务器端：相同代码需要多次执行、CPU 和内存资源是瓶颈、从磁盘加载。</li>
<li>浏览器端：代码从一个服务器端分发到多个客户端、网络是瓶颈、通过网络加载。</li>
</ul>
</li>
<li><strong>发展进程</strong><ol>
<li>闭包形式的函数 (命名空间)。</li>
<li>通过立即执行函数(IIFE) 创建命名空间。</li>
<li>服务器端运行时 NodeJS 的 CommonJS 规范。</li>
<li>浏览器端运行 JS 的 AMD&#x2F;CMD 模块定义规范。</li>
<li>兼容 AMD、CommonJS 的 UMD 规范。</li>
<li>通过语言标准支持的 ES Module。</li>
</ol>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 闭包</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Product</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">setName</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123; name = value &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> name &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">p.<span class="title function_">setName</span>(<span class="string">&quot;Fundebug&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>);        <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="title function_">getName</span>());   <span class="comment">// Fundebug</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 立即执行函数 IIFE</span></span><br><span class="line"><span class="keyword">var</span> <span class="variable language_">module</span> = (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">inc</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; count += <span class="number">1</span> &#125;,</span><br><span class="line">        <span class="attr">dec</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; count += -<span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="variable language_">module</span>.<span class="title function_">inc</span>();</span><br></pre></td></tr></table></figure>


<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><blockquote>
<p>服务器端的模块化开发规范，主要特点是同步加载模块，NodeJS 模块规范参照它实现。CommonJS 会在启动时把内置模块和加载过的模块放在本地硬盘，文件读取时不受限于网络而等待时间很短，所以在 Node 环境中使用同步加载的方式不会有很大问题。但是 CommonJS 如果应用在浏览器端，同步加载的机制会使得 JS 阻塞 UI 线程，造成页面卡顿，网速不好时还会导致浏览器假死。</p>
</blockquote>
<ul>
<li><strong>模块定义</strong>：NodeJs 为每个模块提供一个 exports 变量指向 module.exports，相当于在每个模块头部执行 <code>var exports = module.exports</code>。exports 默认是个空对象，可以添加属性和方法但不能被赋值，因为这样会切断了两者联系，而且不能导出需要new实例化的类。使用时建议 module.exports 导出对象和类、exports 导出普通函数和变量。</li>
<li><strong>模块加载</strong>：本质是读取模块内部的 module.exports 变量，特点是模块第一次加载并执行后就会缓存结果、模块的同步加载会阻塞下面代码的执行，方法有 require(加载其它模块)、require.resolve(解析模块标识符的绝对路径)。</li>
<li><strong>模块标识</strong>：require() 参数，require 根据其格式使用不同路径加载原则去寻找模块文件。取值范围为 模块名(小驼峰命名规范的字符串)、绝对路径(&#x2F; 开头)、相对路径(.&#x2F; 开头)。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导出一个要实例化的类  module.exports = exports = function ()&#123; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rocker.js </span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    thisl.<span class="property">about</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>, <span class="variable language_">this</span>.<span class="property">age</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引用</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Rocker</span> = <span class="built_in">require</span>(<span class="string">&#x27;./rocker.js&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> r = <span class="keyword">new</span> <span class="title class_">Rocker</span>(<span class="string">&#x27;Ozzy&#x27;</span>, <span class="number">62</span>)</span><br><span class="line">r.<span class="title function_">about</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出一个静态类 exports.funcName = function ()&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// hello.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello, world&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello, &#x27;</span> + name + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; hello, greet &#125;</span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">hello</span> = hello</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">greet</span> = greet</span><br><span class="line"><span class="comment">// 错误写法</span></span><br><span class="line"><span class="built_in">exports</span> = &#123; hello, greet &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引用</span></span><br><span class="line"><span class="keyword">var</span> hello = <span class="built_in">require</span>(<span class="string">&#x27;./hello.js&#x27;</span>)</span><br><span class="line">hello.<span class="title function_">hello</span>()  <span class="comment">// Hello, world</span></span><br></pre></td></tr></table></figure>


<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><blockquote>
<p>异步模块定义，浏览器端模块化开发规范。它允许异步和按需加载模块来解决代码阻塞和被依赖文件必须先加载的问题，用于项目开发时需要引用库函数 RequireJS，</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模块定义 define：可选模块标识, 依赖模块数组, 模块初始化的执行函数/对象</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;dependency&#x27;</span>], <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&#x27;Byron&#x27;</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">printName</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(name) &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; printName &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模块加载 require：依赖模块数组, 模块加载成功后的回调函数</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;myModule&#x27;</span>], <span class="keyword">function</span> (<span class="params">my</span>)&#123;</span><br><span class="line">　  my.<span class="title function_">printName</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><blockquote>
<p>AMD 基础上改进，浏览器的实现为 seaJS，主要区别是对依赖模块的执行时机处理不同：AMD 推崇依赖前置而在定义模块时声明其依赖模块，CMD 推崇就近依赖则只有在用到某个模块时再去加载。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义模块 index.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">name</span> = <span class="string">&#x27;index&#x27;</span>;</span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">hello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;index&#x27;</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">        <span class="attr">hello</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;index&#x27;</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载模块</span></span><br><span class="line">seajs.<span class="title function_">use</span>(<span class="string">&#x27;index&#x27;</span>, <span class="keyword">function</span>(<span class="params">my</span>) &#123;</span><br><span class="line">    my.<span class="title function_">hello</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h2><blockquote>
<p>兼容 AMD、commonJS 而提出了跨平台的解决方案。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 无导入导出规范，只有如下的常规写法来检测 JS 环境</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params">root, factory</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="property">amd</span>) &#123;</span><br><span class="line">        <span class="comment">// AMD</span></span><br><span class="line">        <span class="title function_">define</span>([<span class="string">&#x27;jquery&#x27;</span>], factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// CommonJS</span></span><br><span class="line">        <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>(<span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 挂载到全局：root 即 window</span></span><br><span class="line">        root.<span class="property">returnExports</span> = <span class="title function_">factory</span>(root.<span class="property">jQuery</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params">$</span>) &#123;</span><br><span class="line">    <span class="comment">// 方法</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">myFunc</span>(<span class="params"></span>)&#123; &#125;;</span><br><span class="line">    <span class="comment">// 暴露公共方法</span></span><br><span class="line">    <span class="keyword">return</span> myFunc;</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>


<h2 id="ES-Module"><a href="#ES-Module" class="headerlink" title="ES Module"></a>ES Module</h2><blockquote>
<p>CommonJS&#x2F;AMD 规范都只能在运行时确定依赖，ES6 module 模块编译时就能确定模块的依赖关系，以及输入和输出的变量，这种加载方式称为异步按需加载、静态加载。 </p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导出错误写法</span></span><br><span class="line"><span class="keyword">export</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> m;</span><br><span class="line"><span class="keyword">if</span> (x === <span class="number">2</span>) &#123; <span class="keyword">import</span> <span class="title class_">MyModual</span> <span class="keyword">from</span> <span class="string">&#x27;./myModual&#x27;</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出正确写法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> m = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;m&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123;n <span class="keyword">as</span> m&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> n;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入写法</span></span><br><span class="line"><span class="keyword">import</span> &#123;m, n&#125; <span class="keyword">from</span> <span class="string">&#x27;./myModual&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyModual</span> <span class="keyword">from</span> <span class="string">&#x27;./myModual&#x27;</span>;</span><br><span class="line"><span class="title function_">import</span>(<span class="string">&#x27;./myModule.js&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123;export1, export2&#125;</span>) =&gt;</span> &#123; &#125;)</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">import</span>(<span class="string">&#x27;./m1.js&#x27;</span>), <span class="title function_">import</span>(<span class="string">&#x27;./m2.js&#x27;</span>), <span class="title function_">import</span>(<span class="string">&#x27;./m3.js&#x27;</span>)])</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">[module1, module2, module3]</span>) =&gt;</span> &#123; &#125;)</span><br></pre></td></tr></table></figure>


<h1 id="四、异步编程"><a href="#四、异步编程" class="headerlink" title="四、异步编程"></a>四、异步编程</h1><h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><blockquote>
<p>作为参数传递到其它函数执行，优点是使用简单，缺点是层层嵌套而不利于代码维护、每个事件只能指定一个回调函数、各个模块之间高度耦合而导致流程混乱。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 同步操作变为异步</span></span><br><span class="line"><span class="title function_">f1</span>(f2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span> (callback) &#123;</span><br><span class="line">　　 <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;  </span><br><span class="line">        <span class="title function_">callback</span>()  </span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="事件监听"><a href="#事件监听" class="headerlink" title="事件监听"></a>事件监听</h2><blockquote>
<p>采用事件驱动模式，优点是可以绑定多个事件、每个事件可以指定多个回调函数、可以去耦合而有利于实现模块化，缺点则是整个程序变成事件驱动型，运行流程不清晰。常用的监听函数有：on、bind、listen、observe、addEventListener。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// f1 执行完成后立即触发 done 事件从而执行 f2</span></span><br><span class="line">f1.<span class="title function_">on</span>(<span class="string">&quot;done&quot;</span>, f2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span> () &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;  </span><br><span class="line">        f1.<span class="title function_">trigger</span>(<span class="string">&quot;done&quot;</span>)  </span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a>发布订阅</h2><blockquote>
<p>即观察者模式，它定义了一种一对多的关系，通过让多个观察者同时监听某个对象并在对象更新时执行相应操作。主要优点有：通过广播通信即可自动通知所有已经订阅过的对象、目标对象与观察者之间的抽象耦合关系能够单独扩展和重用、目标对象与观察者存在一种动态关联而增加了灵活性。缺点：目标与观察者之间的依赖关系并没有完全解除并且可能循环引用、观察者对象较多时消息发布会降低程序的效率。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// f1 执行完成后向信号中心 jQuery 发布 done 信号，从而引发 f2 的执行</span></span><br><span class="line">jQuery.<span class="title function_">subscribe</span>(<span class="string">&quot;done&quot;</span>, f2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// f1 的代码</span></span><br><span class="line">        jQuery.<span class="title function_">publish</span>(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<h2 id="Promise-对象"><a href="#Promise-对象" class="headerlink" title="Promise 对象"></a>Promise 对象</h2><blockquote>
<p>表示一个异步操作的代理对象，用来解决回调地狱和并发 IO 操作的问题并能够更好地进行错误捕获。只有异步操作的结果可以决定 Promise 对象的当前状态，状态只能从 <strong>pending(等待)</strong> 转变为 <strong>fulfilled(已完成)</strong> &#x2F; <strong>rejected(已失败)</strong> 并且不能继续改变。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建实例：构造函数接收一个 executor 函数，操作完成后执行其参数 resolve/reject。</span></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 原生方法：then (reject 时触发)、catch (resolve 时触发)、finally (一定触发)。</span></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">val</span> =&gt;</span> &#123;   <span class="comment">// 抛出错误</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(val)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;         <span class="comment">// 不会执行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;     <span class="comment">// 接收错误</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;         <span class="comment">// 继续执行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;).<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;      <span class="comment">// 一般用于结束动画等</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 语法糖</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">42</span>).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;)  <span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">42</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>(value) <span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;出错了&quot;</span>));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并多个实例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">timerPromisefy</span>(<span class="params">delay</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(delay)</span><br><span class="line">        &#125;, delay)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当数组中所有 Promise 对象被 resolve 之后，该方法才执行 </span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([ <span class="title function_">timerPromisefy</span>(<span class="number">1</span>), <span class="title function_">timerPromisefy</span>(<span class="number">10</span>)])</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 任何一个 promise 变为 resolve/reject，程序就停止运行</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([ <span class="title function_">timerPromisefy</span>(<span class="number">1</span>), <span class="title function_">timerPromisefy</span>(<span class="number">10</span>)])</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片加载完成后播放音乐</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">loadImg</span>([img, img_1, img_2]).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">playMusic</span>()</span><br><span class="line">    &#125;, <span class="number">500</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadImg</span> = (<span class="params">img</span>) =&gt; &#123;  </span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(img)) &#123;</span><br><span class="line">        <span class="keyword">const</span> oImg = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">        oImg.<span class="property">src</span> = img</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">            oImg.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> arr = []</span><br><span class="line">    img.<span class="title function_">forEach</span>(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> oImg = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">        oImg.<span class="property">src</span> = val</span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">            oImg.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(arr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getBarcodeMaster</span> (data) &#123;</span><br><span class="line">    imanDialog.<span class="title function_">showLoading</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        <span class="title class_">Http</span>.<span class="title function_">post</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/api/getBarcodeMaster&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: data,</span><br><span class="line">            <span class="attr">timeout</span>: <span class="number">12000</span></span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">            imanDialog.<span class="title function_">hideLoading</span>()</span><br><span class="line">            <span class="title function_">resolve</span>(res)</span><br><span class="line">        &#125;, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">            imanDialog.<span class="title function_">hideLoading</span>()</span><br><span class="line">            <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">DataService</span>.<span class="title function_">getBarcodeMaster</span>(&#123;</span><br><span class="line">    <span class="attr">app</span>: $scope.<span class="property">app</span>,</span><br><span class="line">    <span class="attr">user</span>: $scope.<span class="property">user</span>,</span><br><span class="line">    <span class="attr">terminal</span>: umif.<span class="title function_">get</span>(<span class="string">&#x27;Terminal&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>()</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>()</span><br><span class="line">    <span class="keyword">return</span> imanDialog.<span class="title function_">showPopup</span>(&#123; <span class="attr">type</span>: <span class="number">1</span>, <span class="attr">scope</span>: $scope &#125;) </span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="async-x2F-await-异步函数"><a href="#async-x2F-await-异步函数" class="headerlink" title="async&#x2F;await 异步函数"></a>async&#x2F;await 异步函数</h2><blockquote>
<p>一个用同步思维解决异步问题的方案，代码简洁而且更符合编写习惯。async 声明会返回一个 promise 对象的异步函数，await 表示等待后面的异步函数返回结果之后再执行并且只能用于 async 函数内部。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">getDistributionPlan</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> app = req.<span class="property">body</span>.<span class="property">app</span></span><br><span class="line">    <span class="keyword">let</span> user = req.<span class="property">body</span>.<span class="property">user</span></span><br><span class="line">    <span class="keyword">let</span> terminal = req.<span class="property">body</span>.<span class="property">terminal</span></span><br><span class="line">    <span class="keyword">let</span> newErr = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">        newErr.<span class="property">leval</span> = <span class="number">9</span>;</span><br><span class="line">        newErr.<span class="property">title</span> = <span class="string">&quot;参数错误&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title function_">centerBizLogMsg</span>(app, user, terminal, <span class="string">&#x27;getDistributionPlan&#x27;</span>, req.<span class="property">body</span>)</span><br><span class="line">        <span class="keyword">let</span> userGroups = <span class="keyword">await</span> entityFun.<span class="title function_">find</span>(<span class="string">&#x27;ShiftGroupUser&#x27;</span>, &#123;</span><br><span class="line">            <span class="title class_">Person</span>: user.<span class="property">_id</span>,</span><br><span class="line">            <span class="string">&#x27;Department.IsShift&#x27;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">let</span> departments = userGroups.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">Department</span>.<span class="title function_">toString</span>())</span><br><span class="line">        <span class="keyword">let</span> distributionPlanList = <span class="keyword">await</span> entityFun.<span class="title function_">find</span>(<span class="string">&#x27;DistributionPlan&#x27;</span>, &#123;</span><br><span class="line">            <span class="title class_">DistShiftGroup</span>: &#123; <span class="attr">$in</span>: departments &#125;,</span><br><span class="line">            <span class="attr">$where</span>: <span class="string">&quot;this.DistQty &gt; this.TotalDistQty&quot;</span></span><br><span class="line">            <span class="title class_">Status</span>: <span class="title class_">LogisticsEnum</span>.<span class="property">DistributionPlanStatus</span>.<span class="property">Confirmed</span>.<span class="property">Value</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="title class_">DistributionTime</span>: <span class="number">1</span></span><br><span class="line">        &#125;, [</span><br><span class="line">            &#123; <span class="attr">path</span>: <span class="string">&#x27;ItemMaster&#x27;</span>, <span class="attr">model</span>: <span class="string">&#x27;ItemMaster&#x27;</span>, <span class="attr">select</span>: <span class="string">&#x27;Name Code&#x27;</span> &#125;</span><br><span class="line">        ])</span><br><span class="line">        <span class="keyword">if</span> (distributionPlanList.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            newErr.<span class="property">message</span> = <span class="string">&#x27;未找到配送计划！&#x27;</span>;</span><br><span class="line">            res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: <span class="literal">null</span>, <span class="title class_">Error</span>: newErr &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: distributionPlanList, <span class="title class_">Error</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        newErr.<span class="property">message</span> = error.<span class="property">message</span>;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="title class_">Data</span>: <span class="literal">null</span>, <span class="title class_">Error</span>: newErr &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="五、设计模式"><a href="#五、设计模式" class="headerlink" title="五、设计模式"></a>五、设计模式</h1><blockquote>
<p>设计模式是对软件设计开发过程中反复出现的某类问题的通用解决方案，更多的是指导思想和方法论，而不是现成的代码，目的是为了可重用代码、让代码更容易被他人理解、保证代码可靠性。</p>
</blockquote>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><blockquote>
<p>仅允许类或对象具有单个实例，并且它使用全局变量来存储该实例。<strong>实现方法</strong>是判断是否存在该对象的实例，如果已存在则不再创建。<strong>使用场景</strong>适用于业务场景中只能存在一个的实例，比如弹窗、购物车。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 懒汉式：类加载时不创建实例，所以类加载速度快，但运行时获取对象的速度慢。</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">ShopCar</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 定义单例代码</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            buy (good) &#123; <span class="variable language_">this</span>.<span class="property">goods</span>.<span class="title function_">push</span>(good) &#125;,</span><br><span class="line">            <span class="attr">goods</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">getInstance</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!instance) &#123; instance = <span class="title function_">init</span>() &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 饿汉式：类加载时完成了初始化，所以类加载较慢，但获取对象的速度快。</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ShopCar</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> instance = <span class="title function_">init</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">init</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            buy (good) &#123; <span class="variable language_">this</span>.<span class="property">goods</span>.<span class="title function_">push</span>(good) &#125;,</span><br><span class="line">            <span class="attr">goods</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">getInstance</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car1 = <span class="title class_">ShopCar</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"><span class="keyword">let</span> car2 = <span class="title class_">ShopCar</span>.<span class="title function_">getInstance</span>();</span><br><span class="line">car1.<span class="title function_">buy</span>(<span class="string">&#x27;橘子&#x27;</span>);</span><br><span class="line">car2.<span class="title function_">buy</span>(<span class="string">&#x27;苹果&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car1.<span class="property">goods</span>);     <span class="comment">// [ &#x27;橘子&#x27;, &#x27;苹果&#x27; ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car1 === car2);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>


<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><blockquote>
<p>定义一系列的算法，将每一个算法封装并让它们可以相互替换。<strong>实现方法</strong>是定义一组可变的策略类封装具体算法，定义一组不变的环境类将请求委托给某一个策略类。<strong>使用场景</strong>适用于业务场景中需要判断多种条件，甚至包含复杂条件嵌套的，可以使用策略模式来提升代码的可维护性和可读性。比如支付、博客权限校验。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义几个策略类</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">PaymentMethodStrategy</span> = &#123;</span><br><span class="line">    <span class="title class_">BankAccount</span>: <span class="keyword">function</span> (<span class="params">money</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> money &gt; <span class="number">50</span> ? money * <span class="number">0.7</span> : money;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">CreditCard</span>: <span class="keyword">function</span> (<span class="params">money</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> money * <span class="number">0.8</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">Alipay</span>: <span class="keyword">function</span> (<span class="params">money</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;; </span><br><span class="line"><span class="comment">// 环境类</span></span><br><span class="line"><span class="keyword">var</span> userPay = <span class="keyword">function</span> (<span class="params">selectedStrategy, money</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">PaymentMethodStrategy</span>[selectedStrategy](money);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;银行卡支付：&#x27;</span> + <span class="title function_">userPay</span>(<span class="string">&#x27;BankAccount&#x27;</span>, <span class="number">100</span>)); <span class="comment">// 70</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;支付宝支付：&#x27;</span> + <span class="title function_">userPay</span>(<span class="string">&#x27;Alipay&#x27;</span>, <span class="number">100</span>));      <span class="comment">// 100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;信用卡支付：&#x27;</span> + <span class="title function_">userPay</span>(<span class="string">&#x27;CreditCard&#x27;</span>, <span class="number">100</span>));  <span class="comment">// 80</span></span><br></pre></td></tr></table></figure>


<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><blockquote>
<p>即订阅-发布模式，是对象的行为模式，在对象之间定义了一个被观察者对多个观察者的依赖关系，当被观察者发生变化时会通知所有的观察者对象做出对应操作。<strong>使用场景</strong>适用于业务场景中当一个对象的状态发生变化时，需要自动通知其它关联对象并自动更新状态或执行方法。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建一个群来保存通知，通知变化之后通知每个家长：被观察者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Group</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&#x27;暂无通知&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">parents</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getMessage</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">message</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setMassage</span>(<span class="params">message</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">message</span> = message;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">notifyAllObservers</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">notifyAllObservers</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">parents</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">parent</span>) =&gt;</span> &#123;</span><br><span class="line">            parent.<span class="title function_">update</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">attach</span>(<span class="params">parent</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">parents</span>.<span class="title function_">push</span>(parent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 观察者：每个家长</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, group</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">group</span> = group;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">group</span>.<span class="title function_">attach</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> 收到通知: <span class="subst">$&#123;<span class="variable language_">this</span>.group.getMessage()&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> group = <span class="keyword">new</span> <span class="title class_">Group</span>();</span><br><span class="line"><span class="keyword">let</span> t1 = <span class="keyword">new</span> <span class="title class_">Parent</span>(<span class="string">&#x27;李妈妈&#x27;</span>, group);</span><br><span class="line"><span class="keyword">let</span> t2 = <span class="keyword">new</span> <span class="title class_">Parent</span>(<span class="string">&#x27;王爸爸&#x27;</span>, group);</span><br><span class="line"><span class="keyword">let</span> t3 = <span class="keyword">new</span> <span class="title class_">Parent</span>(<span class="string">&#x27;张爷爷&#x27;</span>, group);</span><br><span class="line">group.<span class="title function_">setMassage</span>(<span class="string">&#x27;开家长会&#x27;</span>);</span><br><span class="line">group.<span class="title function_">setMassage</span>(<span class="string">&#x27;开运动会&#x27;</span>); </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  李妈妈 收到通知: 开家长会</span></span><br><span class="line"><span class="comment">  王爸爸 收到通知: 开家长会</span></span><br><span class="line"><span class="comment">  张爷爷 收到通知: 开家长会</span></span><br><span class="line"><span class="comment">  李妈妈 收到通知: 开运动会</span></span><br><span class="line"><span class="comment">  王爸爸 收到通知: 开运动会</span></span><br><span class="line"><span class="comment">  张爷爷 收到通知: 开运动会</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>


<h2 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h2><blockquote>
<p>不改变原代码的同时增加额外功能。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Man</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">run</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;跑步&#x27;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Decorator</span> = <span class="keyword">function</span> (<span class="params">old</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldAbility</span> = old.<span class="property">run</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fly</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;具备飞行能力&#x27;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newAbility</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">oldAbility</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">fly</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> man = <span class="keyword">new</span> <span class="title class_">Man</span>();</span><br><span class="line"><span class="keyword">const</span> superMan = <span class="keyword">new</span> <span class="title class_">Decorator</span>(man);</span><br><span class="line">superMan.<span class="title function_">fly</span>();     <span class="comment">// 具备飞行能力</span></span><br></pre></td></tr></table></figure>


<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><blockquote>
<p>给某个对象提供一个代理对象，并由代理对象控制对原对象的引用，即中介。<strong>实现方法</strong>是定义一个委托者和一个代理，需要委托的事情在代理中完成。<strong>使用场景</strong>是有时需要代理对象帮助过滤掉一些请求或者开销大的对象。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Letter</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 暗恋人小明</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">XiaoMing</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="title function_">sendLetter</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        target.<span class="title function_">receiveLetter</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 代理小华</span></span><br><span class="line"><span class="keyword">let</span> xiaoHua = &#123;</span><br><span class="line">    <span class="title function_">receiveLetter</span>(<span class="params">customer</span>) &#123;</span><br><span class="line">        <span class="title class_">XiaoHong</span>.<span class="title function_">listenGoodMood</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">XiaoHong</span>.<span class="title function_">receiveLetter</span>(<span class="keyword">new</span> <span class="title class_">Letter</span>(customer + <span class="string">&#x27;的情书&#x27;</span>));</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 心仪对象小红</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">XiaoHong</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">    <span class="title function_">receiveLetter</span>(<span class="params">letter</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;收到：&#x27;</span> + letter.<span class="property">name</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">listenGoodMood</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">fn</span>();</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">XiaoMing</span>.<span class="title function_">sendLetter</span>(xiaoHua);  <span class="comment">// 小红收到：小明的情书</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 复议后新分数比以前大 10 分才有权利去更新成绩</span></span><br><span class="line"><span class="keyword">const</span> scoreList = &#123;</span><br><span class="line">    <span class="string">&#x27;wang&#x27;</span>: <span class="number">90</span>,</span><br><span class="line">    <span class="string">&#x27;li&#x27;</span>: <span class="number">60</span>,</span><br><span class="line">    <span class="string">&#x27;wu&#x27;</span>: <span class="number">100</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> yyProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(scoreList, &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params">scoreList, name</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (scoreList[name] &gt; <span class="number">69</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;输出成绩&#x27;</span>) <span class="keyword">return</span> scoreList[name]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;不及格的成绩无法公示&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">scoreList, name, val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val - scoreList[name] &gt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;修改成绩&#x27;</span>) scoreList[name] = val</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;无法修改成绩&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;) </span><br><span class="line">yyProxy[<span class="string">&#x27;wang&#x27;</span>] = <span class="number">98</span>   <span class="comment">// 无法修改成绩</span></span><br><span class="line">yyProxy[<span class="string">&quot;li&quot;</span>] = <span class="number">80</span>     <span class="comment">// 修改成绩</span></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>JS 实现页面的通信和交互</title>
    <url>/2019/05/28/4-5-js%E4%BA%A4%E4%BA%92/</url>
    <content><![CDATA[<h1 id="一、网络通信"><a href="#一、网络通信" class="headerlink" title="一、网络通信"></a>一、网络通信</h1><h2 id="OSI-网络模型"><a href="#OSI-网络模型" class="headerlink" title="OSI 网络模型"></a>OSI 网络模型</h2><blockquote>
<p>IP 协议对应于网络层，TCP&#x2F;UDP 协议对应于传输层，HTTP 协议对应于应用层，注意 OSI 并不包含 Socket。</p>
</blockquote>
  <div align="center">
      <img src="/images/web/network.png" alt="网络模型" width="100%">
  </div>


<h2 id="TCP、UDP-协议"><a href="#TCP、UDP-协议" class="headerlink" title="TCP、UDP 协议"></a>TCP、UDP 协议</h2><blockquote>
<p>TCP 是面向链接的，虽然说网络的不安全不稳定特性决定了多少次握手都不能保证连接的可靠性，但 TCP 的三次握手在最低限度上保证了连接的可靠性。UDP 则是无连接的、不可靠的一种数据传输协议，UDP 传送数据前并不与对方建立连接，对接收到的数据也不发送确认信号，发送端不知道数据是否会正确接收而且也不会重发，但是数据传输效率和实时性更好。　 </p>
</blockquote>
  <div align="center">
      <img src="/images/web/tcp.png" alt="TCP 连接" width="100%">
  </div>

<h2 id="HTTP-协议"><a href="#HTTP-协议" class="headerlink" title="HTTP 协议"></a>HTTP 协议</h2><blockquote>
<p>基于 TCP&#x2F;IP 协议的一个超文本传输协议，用于定义客户端与服务器通信的格式，具有单向请求、无状态等特点。WEB 使用 HTTP 协议作为应用层协议来封装 HTTP 文本信息，然后使用 TCP&#x2F;IP 做传输层协议将它发到网络上。我们在传输数据时可以只使用 TCP&#x2F;IP 协议，但是那样会没有应用层而导致无法识别数据内容，如果想要使传输的数据有意义则必须使用应用层协议。</p>
</blockquote>
<ul>
<li><strong>HTTP 请求流程</strong><div align="center">
  <img src="/images/web/http_req.png" alt="HTTP 请求流程" width="100%">
</div></li>
<li><strong>域名解析过程</strong><div align="center">
  <img src="/images/web/domain.png" alt="域名解析过程" width="100%">
</div></li>
<li><strong>HTTP 报文</strong>：HTTP 通信的传输单位，可分为请求报文和响应报文，内部结构如下：<ul>
<li>请求行：用于说明请求方法、请求地址、http 版本号。</li>
<li>响应行：用于说明服务器 http 版本号、响应状态码、状态码的原因短句。</li>
<li>头部字段：分为 通用首部字段、请求首部字段、响应首部字段、实体首部字段。</li>
<li>实体部分：可以用实体首部字段加以说明，content-type 说明实体内容的类型。</li>
</ul>
</li>
<li>操作方式<ul>
<li>浏览器的 url 地址栏。 </li>
<li>XMLHttpRequest 对象。</li>
<li>页面有 src 属性的标签（img、script、link 等）。</li>
<li>带有 action 属性的 form 表单。</li>
</ul>
</li>
<li>连接方式：实际上是 TCP 协议的长&#x2F;短连接，区别在于数据传输后是否立即关闭连接。<ul>
<li><strong>短连接</strong>：HTTP1.0 默认方式。每次 HTTP 操作则建立一次连接，任务结束就立即关闭。常用于并发量大但用户无需频繁操作的场景，比如浏览器网址的 http 服务。</li>
<li><strong>长连接</strong>：HTTP1.1 默认方式。任务结束后不会立即关闭连接，再次请求时继续使用。HTTP 响应头添加 <code>Connection: keep-alive</code>，可以在服务器设定连接时间。</li>
</ul>
</li>
</ul>
<h2 id="Socket-编程接口"><a href="#Socket-编程接口" class="headerlink" title="Socket 编程接口"></a>Socket 编程接口</h2><blockquote>
<p>TCP&#x2F;IP 只是一个协议栈，和操作系统的运行机制一样必须要具体实现并提供对外的操作接口。操作系统会提供标准的 Win32 等编程接口，TCP&#x2F;IP 也必须对外提供编程接口，这就是 Socket。Socket 的出现只是可以更方便的使用 TCP&#x2F;IP 协议栈而已，它对 TCP&#x2F;IP 进行了抽象并封装了一些基础的函数接口：create、listen、accept、connect、read、write。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 不同语言都有对应的建立 Socket 服务端和客户端的库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Nodejs 服务端</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>();</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">client</span>) =&gt;</span> &#123;</span><br><span class="line">    client.<span class="title function_">write</span>(<span class="string">&#x27;Hi!\n&#x27;</span>);    <span class="comment">// 服务端向客户端输出信息，使用 write()</span></span><br><span class="line">    client.<span class="title function_">write</span>(<span class="string">&#x27;Bye!\n&#x27;</span>);</span><br><span class="line">    <span class="comment">//client.end();           // 服务端结束该次会话</span></span><br><span class="line">&#125;);</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Nodejs 客户端</span></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> net.<span class="title class_">Socket</span>();</span><br><span class="line">client.<span class="title function_">connect</span>(<span class="number">9000</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;data&#x27;</span>, chunk.<span class="title function_">toString</span>())</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Socket 长连接：在一个 TCP 连接上连续发送多个数据包，可通过计时器实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Socket 连接池：维护着一定数量 Socket 长连接的集合。它能自动检测 Socket</span></span><br><span class="line"><span class="comment">// 长连接的有效性，剔除无效的连接并补充连接池中长连接的数量。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Nodejs Socket 连接池 generic-pool 模块的源码</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> genericPool = <span class="built_in">require</span>(<span class="string">&#x27;generic-pool&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createPool</span>(<span class="params">conifg</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> options = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;</span><br><span class="line">        <span class="attr">fifo</span>: <span class="literal">true</span>,                          <span class="comment">// 是否优先使用老的资源</span></span><br><span class="line">        <span class="attr">priorityRange</span>: <span class="number">1</span>,                    <span class="comment">// 优先级</span></span><br><span class="line">        <span class="attr">testOnBorrow</span>: <span class="literal">true</span>,                  <span class="comment">// 是否开启获取验证</span></span><br><span class="line">        <span class="comment">// acquireTimeoutMillis: 10 * 1000,  // 获取的超时时间</span></span><br><span class="line">        <span class="attr">autostart</span>: <span class="literal">true</span>,                     <span class="comment">// 自动初始化和释放调度启用</span></span><br><span class="line">        <span class="attr">min</span>: <span class="number">10</span>,                             <span class="comment">// 连接池保持的长连接最小数量</span></span><br><span class="line">        <span class="attr">max</span>: <span class="number">0</span>,                              <span class="comment">// 最大连接池保持的长连接数量</span></span><br><span class="line">        <span class="attr">evictionRunIntervalMillis</span>: <span class="number">0</span>,        <span class="comment">// 资源释放检验间隔检查</span></span><br><span class="line">        <span class="attr">numTestsPerEvictionRun</span>: <span class="number">3</span>,           <span class="comment">// 每次释放资源数量</span></span><br><span class="line">        <span class="attr">softIdleTimeoutMillis</span>: -<span class="number">1</span>,           <span class="comment">// 可用的&gt;min 且空闲时间时释放</span></span><br><span class="line">        <span class="attr">idleTimeoutMillis</span>: <span class="number">30000</span>             <span class="comment">// 强制释放</span></span><br><span class="line">        <span class="comment">// maxWaitingClients: 50             // 最大等待</span></span><br><span class="line">    &#125;, conifg.<span class="property">options</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> factory = &#123;</span><br><span class="line">        <span class="comment">// 创建连接</span></span><br><span class="line">        <span class="attr">create</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> socket = <span class="keyword">new</span> net.<span class="title class_">Socket</span>();</span><br><span class="line">                socket.<span class="title function_">setKeepAlive</span>(<span class="literal">true</span>);</span><br><span class="line">                socket.<span class="title function_">connect</span>(conifg.<span class="property">port</span>, conifg.<span class="property">host</span>);</span><br><span class="line">                <span class="comment">// TODO 心跳包的处理逻辑</span></span><br><span class="line">                socket.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(socket);</span><br><span class="line">                &#125;);</span><br><span class="line">                socket.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;  <span class="comment">// 先 end 再 close</span></span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">                socket.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 销毁连接</span></span><br><span class="line">        <span class="attr">destroy</span>: <span class="keyword">function</span> (<span class="params">socket</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 不会触发 end， 第一次会触发 close，有 message 则触发 error</span></span><br><span class="line">                socket.<span class="title function_">destroy</span>();</span><br><span class="line">                <span class="title function_">resolve</span>();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 获取资源池校验资源有效性</span></span><br><span class="line">        <span class="attr">validate</span>: <span class="keyword">function</span> (<span class="params">socket</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (socket.<span class="property">destroyed</span> || !socket.<span class="property">readable</span> || !socket.<span class="property">writable</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_">resolve</span>(<span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> pool = genericPool.<span class="title function_">createPool</span>(factory, options);</span><br><span class="line">    pool.<span class="title function_">on</span>(<span class="string">&#x27;factoryCreateError&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;   <span class="comment">// 监听新建长连接出错则返回错误</span></span><br><span class="line">        <span class="keyword">const</span> clientResourceRequest = pool.<span class="property">_waitingClientsQueue</span>.<span class="title function_">dequeue</span>();</span><br><span class="line">        <span class="keyword">if</span> (clientResourceRequest) &#123;</span><br><span class="line">            clientResourceRequest.<span class="title function_">reject</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> pool;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="二、Ajax-请求"><a href="#二、Ajax-请求" class="headerlink" title="二、Ajax 请求"></a>二、Ajax 请求</h1><blockquote>
<p>异步网络请求，在页面不跳转不刷新的情况下实现局部加载，减少了数据传输量。</p>
</blockquote>
<h2 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h2><div style="text-indent: 2em">在用户和服务器之间加了―个中间层 (Ajax 引擎)，通过 XmlHttpRequest 对象来向服务器发异步请求并获取数据，然后通过 js 操作 DOM 而更新页面，这样就让用户操作与服务器响应实现了异步化，从而 js 可以及时向服务器提出请求和处理响应而不阻塞用户，达到无刷新的效果。注意如果出现乱码问题就是因为编码格式冲突，发送中文数据时通过 encodeURI() 编码，接收中文数据时通过 decodeURI() 解码即可。</div>

<ul>
<li><strong>优点</strong><ul>
<li>使用异步方式与服务器通信，响应速度更快。</li>
<li>基于标准化的并被广泛支持的技术，不需要下载插件或者小程序。</li>
<li>页面无刷新，在页面内与服务器通信，减少用户等待时间，增强了用户体验。</li>
<li>可以把一些原本服务器的工作转接到客户端，利用客户端闲置的能力来处理，减轻了服务器和带宽的负担，节约空间和宽带租用成本。</li>
</ul>
</li>
<li><strong>缺点</strong><ul>
<li>对搜索引擎的支持比较弱。</li>
<li>可能会影响程序中的异常处理机制。</li>
<li>无法进行操作的后退，即不支持浏览器的页面后退。</li>
<li>安全问题，对一些网站攻击，比如 csrf、xxs、sql 注入等不能很好地防御。</li>
</ul>
</li>
</ul>
<h2 id="重点注意"><a href="#重点注意" class="headerlink" title="重点注意"></a>重点注意</h2><h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3><ol>
<li><strong>区别</strong><br>* method：<code>GET、POST</code>。<br>* 请求头：POST 发送数据时必须设置。<br>* 安全性：GET 请求时暴露参数数据，安全性较低。<br>* 长度限制：GET 有长度限制，不适合发送大量数据。<br>* 请求缓存：GET 请求可以被缓存和保存，而 POST 请求不能。<br>* 参数位置：<code>url?参数=值&amp;参数=值、xhr.send(&quot;参数=值&amp;参数=值&quot;)</code>。</li>
<li><strong>场景</strong><br>* GET：安全性要求不高时，从服务器获取数据。<br>* POST：对于大量数据、密码数据等，提交到服务器处理。</li>
</ol>
<h3 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h3><ol>
<li><strong>JSON</strong>：处理大量数据的规范格式。<br>* 对象转字符串：<code>JSON.stringify(json_obj)</code><br>* 字符串转对象：<code>JSON.parse(json_str) / eval(&#39;(&#39;+json_str+&#39;)&#39;)</code><br>* eval：不推荐使用，因为它会把 js 数据而不只是 json_str 都转为 json 对象。</li>
<li><strong>FormData</strong>：处理包括图片和文件的表单数据并通过 post 方式发送到服务端。</li>
</ol>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1、实例一个空 FormData 对象之后 append 键值对</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> formdata = <span class="keyword">new</span> <span class="title class_">FormData</span>() </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;file&quot;</span>).<span class="property">files</span>[<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">    formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file)</span></span><br><span class="line"><span class="language-javascript">                              </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2、form元素对象 作为参数传入  </span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;form&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> formdata = <span class="keyword">new</span> <span class="title class_">FormData</span>(form);                          </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 3、getFormData 方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> formobj =  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;form&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> formdata = formobj.<span class="title function_">getFormData</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 其它 API：has、getAll、forEach</span></span></span><br><span class="line"><span class="language-javascript">    formdata.<span class="title function_">delete</span>(<span class="string">&quot;file&quot;</span>)   </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> file = formdata.<span class="title function_">get</span>(<span class="string">&quot;file&quot;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>       </span><br></pre></td></tr></table></figure>


<h3 id="请求体类型"><a href="#请求体类型" class="headerlink" title="请求体类型"></a>请求体类型</h3><blockquote>
<p>ContentType，告诉服务器发送数据的格式</p>
</blockquote>
<ul>
<li><code>application/x-www-form-urlencoded</code>：jquery ajax 默认，查询字符串格式。</li>
<li><code>multipart/form-data</code>：常用于表单上传文件，设置 form enctype 为该类型。</li>
<li><code>application/json</code>：axios 默认类型，使用 json 格式的数据。</li>
</ul>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><h3 id="原生写法"><a href="#原生写法" class="headerlink" title="原生写法"></a>原生写法</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、创建 XMLHttpRequest 对象：用来和服务器交换数据的 js 内置对象</span></span><br><span class="line"><span class="keyword">var</span> xhr;</span><br><span class="line"><span class="keyword">if</span>(<span class="title class_">XMLHttpRequest</span>)&#123;</span><br><span class="line">    xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();   <span class="comment">// w3c 标准</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    xhr = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&#x27;Microsoft.XMLHTTP&#x27;</span>)  <span class="comment">// IE6、IE5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、连接服务器和发送请求</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// GET </span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, url?参数=值, <span class="literal">true</span>);   <span class="comment">// true 表示请求异步处理</span></span><br><span class="line">xhr.<span class="title function_">send</span>();    </span><br><span class="line"></span><br><span class="line"><span class="comment">// POST 必须设置请求头</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, url, <span class="literal">true</span>);   </span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="string">&quot;参数=值&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、监听回调函数状态和处理响应数据</span></span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 判断响应是否接收完成、服务器是否成功处理请求</span></span><br><span class="line">    <span class="keyword">if</span>(xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> ==<span class="number">200</span>)&#123;</span><br><span class="line">        show.<span class="property">innerHTML</span> = xhr.<span class="property">responseText</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="Ajax-封装"><a href="#Ajax-封装" class="headerlink" title="Ajax 封装"></a>Ajax 封装</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">requestUrl</span>(<span class="params">url, type, data, callback, error, <span class="keyword">async</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">async</span> = (<span class="keyword">async</span> == <span class="literal">null</span> || </span><br><span class="line">                <span class="keyword">async</span>.<span class="title function_">toString</span>() == <span class="string">&quot;&quot;</span> || </span><br><span class="line">                <span class="title function_">typeof</span>(<span class="keyword">async</span>) == <span class="string">&quot;undefined&quot;</span>) ? <span class="literal">true</span> : !!<span class="keyword">async</span>;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">method</span>: type,</span><br><span class="line">        <span class="attr">async</span>: <span class="keyword">async</span>,</span><br><span class="line">        <span class="attr">data</span>: data</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_data.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="title function_">callback</span>(_data.<span class="property">data</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">typeof</span>(error) == <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">error</span>(_data)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">alert</span>(_data.<span class="property">data</span>.<span class="property">errMsg</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">fail</span>(<span class="keyword">function</span>(<span class="params"> jqXHR, textStatus </span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">requestUrl</span>(url, type, data, callback, error, <span class="keyword">async</span>);</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="JQuery-写法"><a href="#JQuery-写法" class="headerlink" title="JQuery 写法"></a>JQuery 写法</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">get</span>(url?参数=值, calback)</span><br><span class="line"></span><br><span class="line">$.<span class="title function_">post</span>(url, &#123;参数：值&#125;, callback)</span><br><span class="line"></span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>:       <span class="comment">// 数据的提交方式：get、post</span></span><br><span class="line">    <span class="attr">url</span>:        <span class="comment">// 请求地址</span></span><br><span class="line">    <span class="attr">async</span>:      <span class="comment">// 是否支持异步刷新，默认 true</span></span><br><span class="line">    <span class="attr">data</span>:       <span class="comment">// 需要提交的数据</span></span><br><span class="line">    <span class="attr">dataType</span>:   <span class="comment">// 服务器返回数据的类型，html、json, jsonp 等</span></span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123; &#125;  <span class="comment">// 请求成功后的回调函数 </span></span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;&#125;     <span class="comment">// 请求失败后的回调函数 </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="Token-令牌"><a href="#Token-令牌" class="headerlink" title="Token 令牌"></a>Token 令牌</h2><blockquote>
<p>遵从 oauth2.0 规范的授权令牌，它是一种身份&#x2F;权限的认证方式。</p>
</blockquote>
<ol>
<li>应用<br>* 客户端登录等首次请求发送时，服务端根据算法和编码方式生成后返回。<br>* 客户端再次发起请求时，服务端验证通过后返回请求数据，否则失败。</li>
<li>优势<br>* 可以避免 CSRF 攻击。<br>* 完全由应用管理，可以避开同源策略。<br>* 可扩展性强(不用存储)，还可用于 APP。<br>* 可以是无状态的，可以在多个服务间共享。</li>
</ol>
<h1 id="三、跨域方案"><a href="#三、跨域方案" class="headerlink" title="三、跨域方案"></a>三、跨域方案</h1>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">浏览器的同源策略：浏览器出于安全方面的考虑而只允许与本域下的接口交互，</span><br><span class="line">不同源的脚本在没有明确授权时不能读写对方资源，这样阻止恶意修改和攻击但</span><br><span class="line">也产生了跨域问题，浏览器可以设置开启跨域但不是一个好方案。</span><br><span class="line"></span><br><span class="line">同源条件：protocol（协议）、domain（域名）、port（端口）三者一致。</span><br><span class="line"></span><br><span class="line">协议      域名              端口  路径    参数            锚点</span><br><span class="line"><span class="attr">http</span>:<span class="comment">//  www.example.com  :80   /home  ?name=a&amp;age=20  #app</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">开启跨域模式：通过 <span class="title class_">Chrome</span> <span class="variable constant_">CORS</span> 插件或手动设置，但这种方式不建议使用。</span><br><span class="line"></span><br><span class="line">浏览器跨域原因：浏览器端允许打开多个页面，但页面之间的需要统一规范来约定，</span><br><span class="line">跨域规范就是通过限制不同源的请求、限制 dom 操作而实现安全性。</span><br></pre></td></tr></table></figure>

<h2 id="CORS-跨域资源共享"><a href="#CORS-跨域资源共享" class="headerlink" title="CORS 跨域资源共享"></a>CORS 跨域资源共享</h2><blockquote>
<p>一个 W3C 标准&#x2F;机制，Web 应用使用自定义 HTTP 头部告诉浏览器向跨域服务器发起 HTTP 请求，注意低版本浏览器不支持。</p>
</blockquote>
<ul>
<li><strong>简单请求</strong>：不会触发 CORS 预检请求。条件如下：<ul>
<li>请求方法：GET&#x2F;HEAD&#x2F;POST。</li>
<li>人为设置以下之外的请求头：Accept、Accept-Language、Content-Language、Content-Type、DPR、Downlink、Save-Data、Viewport-Width、Width。</li>
<li>Content-Type：text&#x2F;plain、multipart&#x2F;form-data、application&#x2F;x-www-form-urlencoded。</li>
<li>请求中的对象 XMLHttpRequest.upload 没有注册任何事件监听器。</li>
<li>请求中没有使用 ReadableStream 对象。</li>
</ul>
</li>
<li><strong>非简单请求</strong>：除以上情况之外。</li>
<li><strong>Node 解决方案</strong></li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 简单请求</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:8080/api/corslist&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非简单请求</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:8080/api/corslist&quot;</span>, &#123; <span class="attr">header</span>: &#123; <span class="attr">cc</span>: <span class="string">&quot;xxx&quot;</span> &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node 原生方式</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.<span class="title function_">set</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, ctx.<span class="property">headers</span>.<span class="property">origin</span>);</span><br><span class="line">    ctx.<span class="title function_">set</span>(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    ctx.<span class="title function_">set</span>(<span class="string">&quot;Access-Control-Request-Method&quot;</span>, <span class="string">&quot;PUT,POST,GET,DELETE,OPTIONS&quot;</span>);</span><br><span class="line">    ctx.<span class="title function_">set</span>(</span><br><span class="line">        <span class="string">&quot;Access-Control-Allow-Headers&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin, X-Requested-With, Content-Type, Accept, cc&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">method</span> === <span class="string">&quot;OPTIONS&quot;</span>) &#123;</span><br><span class="line">        ctx.<span class="property">status</span> = <span class="number">204</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Node 第三方中间件</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&quot;koa-cors&quot;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br></pre></td></tr></table></figure>


<h2 id="Node-正向代理"><a href="#Node-正向代理" class="headerlink" title="Node 正向代理"></a>Node 正向代理</h2><blockquote>
<p>利用服务端请求不会跨域的特性，让接口和当前站点同域。</p>
</blockquote>
<h3 id="cli-工具"><a href="#cli-工具" class="headerlink" title="cli 工具"></a>cli 工具</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端请求：浏览器跨域请求默认不传递 cookie，可设置 withCredentials</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">withCredentials</span> = <span class="literal">true</span>;</span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;/api/corslist&quot;</span>)</span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;/api/login&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端</span></span><br><span class="line"><span class="comment">// Webpack 4.x</span></span><br><span class="line"><span class="attr">proxy</span>: &#123;</span><br><span class="line">    <span class="string">&quot;/api&quot;</span>: &#123; <span class="attr">target</span>: <span class="string">&quot;http://localhost:8080&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Vue-cli：版本 2.x 使用 proxyTable，版本 3.0 使用 proxy</span></span><br><span class="line"><span class="comment">// 配置一个代理</span></span><br><span class="line"><span class="comment">// proxy: &#x27;http://localhost:8000&#x27;  </span></span><br><span class="line"><span class="comment">// 配置多个代理：</span></span><br><span class="line"><span class="attr">proxy</span>: &#123;                             </span><br><span class="line">    <span class="string">&quot;/api&quot;</span>: &#123;     <span class="comment">// 请求地址</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://172.16.12:70&quot;</span>,  <span class="comment">// 实际映射的目标地址</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,             <span class="comment">// 是否跨域</span></span><br><span class="line">        <span class="attr">ws</span>: <span class="literal">true</span>,                       <span class="comment">// websocket 支持</span></span><br><span class="line">        <span class="attr">secure</span>: <span class="literal">false</span>,                  <span class="comment">// https 需开启</span></span><br><span class="line">        <span class="attr">pathRewrite</span>:&#123; <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;     <span class="comment">// 重定向</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Parcel (2.x)</span></span><br><span class="line">.<span class="property">proxyrc</span>&#123;  </span><br><span class="line">    <span class="string">&quot;/api&quot;</span>: &#123;  <span class="string">&quot;target&quot;</span>: <span class="string">&quot;http://localhost:8080&quot;</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="cors-anywhere"><a href="#cors-anywhere" class="headerlink" title="cors-anywhere"></a>cors-anywhere</h3><blockquote>
<p>CORS 标头被添加到代理请求的 NodeJS 代理库，无法专递 cookie 而可能因为不太安全。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端请求</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">withCredentials</span> = <span class="literal">true</span>;</span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:7777/http://127.0.0.1:8080/api/corslist&quot;</span>)</span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;http://127.0.0.1:7777/http://127.0.0.1:8080/api/login&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端</span></span><br><span class="line"><span class="keyword">var</span> host = process.<span class="property">env</span>.<span class="property">HOST</span> || <span class="string">&quot;0.0.0.0&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> port = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">7777</span>;</span><br><span class="line"><span class="keyword">var</span> cors_proxy = <span class="built_in">require</span>(<span class="string">&quot;cors-anywhere&quot;</span>);</span><br><span class="line">cors_proxy</span><br><span class="line">.<span class="title function_">createServer</span>(&#123;    </span><br><span class="line">    <span class="attr">originWhitelist</span>: [],</span><br><span class="line">    <span class="attr">requireHeader</span>: [<span class="string">&quot;origin&quot;</span>, <span class="string">&quot;x-requested-with&quot;</span>],    </span><br><span class="line">    <span class="attr">removeHeaders</span>: [<span class="string">&quot;cookie&quot;</span>, <span class="string">&quot;cookie2&quot;</span>]  </span><br><span class="line">&#125;)  </span><br><span class="line">.<span class="title function_">listen</span>(port, host, <span class="keyword">function</span>(<span class="params"></span>) &#123;    </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Running CORS Anywhere on &quot;</span> + host + <span class="string">&quot;:&quot;</span> + port);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="charles"><a href="#charles" class="headerlink" title="charles"></a>charles</h3><blockquote>
<p>一个测试、开发的神器，本质是请求的拦截与代理，代码。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端请求</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">withCredentials</span> = <span class="literal">true</span>;</span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;/api/corslist&quot;</span>)</span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;/api/login&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/corslist&quot;</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ctx.<span class="property">body</span> = &#123; <span class="attr">data</span>: [&#123; <span class="attr">name</span>: <span class="string">&quot;闯哥的笔记&quot;</span> &#125;] &#125;;</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/login&quot;</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ctx.<span class="property">cookies</span>.<span class="title function_">set</span>(<span class="string">&quot;token&quot;</span>, token, &#123; <span class="attr">expires</span>: <span class="keyword">new</span> <span class="title class_">Date</span>() &#125;)</span><br><span class="line">    ctx.<span class="property">body</span> = &#123;  <span class="attr">msg</span>: <span class="string">&quot;成功&quot;</span>, <span class="attr">code</span>: <span class="number">0</span> &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Nginx-反向代理"><a href="#Nginx-反向代理" class="headerlink" title="Nginx 反向代理"></a>Nginx 反向代理</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配置</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen      <span class="number">80</span>;         <span class="comment">// 监听端口</span></span><br><span class="line">    server_name <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>;  <span class="comment">// 监听地址</span></span><br><span class="line">    location /api &#123;         <span class="comment">// 重定向地址</span></span><br><span class="line">        proxy_pass <span class="attr">http</span>:<span class="comment">//localhost:8080;</span></span><br><span class="line">    &#125;        </span><br><span class="line">    location / &#123;            <span class="comment">// 根目录地址    </span></span><br><span class="line">        proxy_pass <span class="attr">http</span>:<span class="comment">//localhost:8000;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动、重启命令</span></span><br><span class="line">sudo nginx</span><br><span class="line">sudo nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前后端代码同上 charles</span></span><br></pre></td></tr></table></figure>


<h2 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h2><blockquote>
<p>利用 script 标签没有跨域限制的特性来实现跨域读取数据等，是一种非强制性协议而非新技术，也和 json、ajax 没有关系。</p>
</blockquote>
<ol>
<li>定义数据处理函数：<code>var handler = function(data)&#123; &#125;</code>。</li>
<li>创建 script 标签，src 的地址设置为 <code>url?callback=handler</code>。</li>
<li>服务端在收到请求后，解析参数并返回数据，输出 fun(data) 字符串。</li>
<li>fun(data) 会放到 script 标签中作为 js 执行，即此时会调用函数。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 后端实现</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">path</span> === <span class="string">&quot;/api/jsonp&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; cb, msg &#125; = ctx.<span class="property">query</span>;</span><br><span class="line">        ctx.<span class="property">body</span> = <span class="string">`<span class="subst">$&#123;cb&#125;</span>(<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123; msg &#125;)&#125;</span>)`</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通 js</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">window</span>.<span class="property">handler</span> = <span class="keyword">function</span>(<span class="params">res</span>) &#123;  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080/api/jsonp?msg=hello&amp;callback=handler&quot;</span>  </span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// jQuery Ajax</span></span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="attr">async</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/api/jsonp&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;  <span class="attr">msg</span>: <span class="string">&quot;hello&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;jsonp&quot;</span>,</span><br><span class="line">    <span class="attr">jsonp</span>: <span class="string">&quot;callback&quot;</span>,         <span class="comment">// 回调参数 </span></span><br><span class="line">    <span class="attr">jsonpCallback</span>: <span class="string">&quot;handler&quot;</span>   <span class="comment">// jsonp 自定义回调函数  </span></span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    &#125;，</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h2><blockquote>
<p>规范定义了一种客户端和服务器之间存在持久连接的**全双工通信协议(又称双向通信)**，它没有跨域的限制但和 HTTP 都是基于 TCP 协议的应用层协议，两者有良好的兼容性但没有联系。它能更好地节省服务器资源和带宽并可以实现实时通讯。</p>
</blockquote>
<h3 id="实时通信"><a href="#实时通信" class="headerlink" title="实时通信"></a>实时通信</h3><ul>
<li><strong>Ajax 轮询</strong><ul>
<li>原理：客户端设置 计时器，每隔一段时间就向服务器发送一次请求。</li>
<li>缺点：只能由客户端发起请求，而且需要服务器有很快的 资源处理速度。</li>
</ul>
</li>
<li><strong>http 长轮询</strong><ul>
<li>原理：客户端发起请求建立连接后，服务器等到有内容更新时才响应。</li>
<li>缺点：采用阻塞模型，占用的资源空间更多而需要服务器有很高的并发处理能力。</li>
</ul>
<p>  </p>
</li>
<li><strong>WebSocket</strong>：只需要通过一个握手即可实现客户端与服务端通信，不需要询问和等待。</li>
</ul>
<h3 id="连接过程"><a href="#连接过程" class="headerlink" title="连接过程"></a>连接过程</h3><blockquote>
<p>WebSocket 在建立握手时传输数据通过 HTTP，但建立后传输时不需要 HTTP。Socket 则是应用层与 TCP&#x2F;IP 通信的中间软件抽象层，本质一组接口而并非一个协议。</p>
</blockquote>
<ol>
<li>浏览器、服务器通过 TCP 三次握手建立连接 (通信基础)。</li>
<li>浏览器通过向服务器发起一个包含 WebSocket 支持版本号等附加头信息的 HTTP 请求。</li>
<li>服务器同样采用 HTTP 协议返回应答信息。</li>
<li>当收到连接成功的信息后通过 TCP 通道进行传输通信。</li>
<li>客户端&#x2F;服务器端 关闭连接前可以自由传输数据。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端：(&#x27;WebSocket&#x27; in window) 可判断是否支持</span></span><br><span class="line"><span class="keyword">let</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://10.148.221.210:5000&#x27;</span>)  </span><br><span class="line">ws.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 0、1、2、3 ：正在连接、连接成功、连接正在关闭、连接失败或已关闭</span></span><br><span class="line">    <span class="keyword">if</span> (socket.<span class="property">readyState</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        ws.<span class="title function_">send</span>(<span class="string">&quot;connect success&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">ws.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">msg</span>)&#123; &#125;</span><br><span class="line">ws.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;)</span><br><span class="line">ws.<span class="title function_">close</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后端</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WebSocket</span> = <span class="built_in">require</span>(<span class="string">&quot;ws&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> <span class="title class_">WebSocket</span>.<span class="title class_">Server</span>(&#123; <span class="attr">port</span>: <span class="number">8080</span> &#125;);</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="keyword">function</span>(<span class="params">socket</span>) &#123;</span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&quot;message&quot;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        socket.<span class="title function_">send</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage"></a>window.postMessage</h2><blockquote>
<p>采用异步方式支持跨域通信的 HTML5 API，主要功能有：页面和其打开的新窗口的数据传递、多窗口之间消息传递、页面与嵌套的 iframe 消息传递。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">index.html</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;load()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">load</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        iframe.<span class="property">contentWindow</span>.<span class="title function_">postMessage</span>(<span class="string">&quot;笔记&quot;</span>, <span class="string">&quot;http://localhost:8080&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="property">onmessage</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">another.html</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onmessage</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>);   <span class="comment">// 笔记</span></span></span><br><span class="line"><span class="language-javascript">        e.<span class="property">source</span>.<span class="title function_">postMessage</span>(e.<span class="property">data</span>, e.<span class="property">origin</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="document-domain-Iframe"><a href="#document-domain-Iframe" class="headerlink" title="document.domain + Iframe"></a>document.domain + Iframe</h2><blockquote>
<p>该方式只能用于二级域名相同的情况下，比如 a.test.com、b.test.com。只需要给页面添加 document.domain &#x3D;’test.com’ 表示二级域名都相同就可以实现跨域。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">www.   baidu.  com     .</span><br><span class="line">三级域  二级域   顶级域   根域</span><br><span class="line"></span><br><span class="line">// a.test.com</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://b.test.com/b.html&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;load()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&quot;test.com&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">load</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(frame.<span class="property">contentWindow</span>.<span class="property">a</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// b.test.com</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&quot;test.com&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> a = <span class="number">100</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="window-location-hash-Iframe"><a href="#window-location-hash-Iframe" class="headerlink" title="window.location.hash + Iframe"></a>window.location.hash + Iframe</h2><blockquote>
<p>通过一个非跨域的中间页面来传递 hash 数据：a.html –&gt; c.html –&gt; b.html –&gt; a.html。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">a.html</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080/hash/c.html#name1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onhashchange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">hash</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">b.html</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">parent</span>.<span class="property">parent</span>.<span class="property">location</span>.<span class="property">hash</span> = location.<span class="property">hash</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">c.html</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> iframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;iframe&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    iframe.<span class="property">src</span> = <span class="string">&quot;http://localhost:8000/hash/b.html#name2&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(iframe);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="window-name-Iframe"><a href="#window-name-Iframe" class="headerlink" title="window.name + Iframe"></a>window.name + Iframe</h2><blockquote>
<p>window.location 变化后重新加载，window.name 属性可以保持不变。具体实现：通过 iframe src 属性由外域转向本地域，跨域数据即由 iframe window.name 从外域传递到本地域。这就安全地绕过了浏览器的跨域访问限制。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">a.html</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080/name/c.html&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;load()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> first = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// onload 事件会触发2次，第1次加载跨域页，并留存数据于 window.name</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">load</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (first) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 第1次onload(跨域页)成功后，切换到同域代理页面</span></span></span><br><span class="line"><span class="language-javascript">            iframe.<span class="property">src</span> = <span class="string">&quot;http://localhost:8000/name/b.html&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            first = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 第2次onload(同域b.html页)成功后，读取同域window.name中数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(iframe.<span class="property">contentWindow</span>.<span class="property">name</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">b.html：中间代理页，与 a.html 同域，内容为空。</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">c.html</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">name</span> = <span class="string">&quot;笔记&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="四、页面操作"><a href="#四、页面操作" class="headerlink" title="四、页面操作"></a>四、页面操作</h1><h2 id="页面更新"><a href="#页面更新" class="headerlink" title="页面更新"></a>页面更新</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 刷新当前页面</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>()</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">replace</span>(url)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳转到新页面</span></span><br><span class="line">&lt;a href=<span class="string">&quot;url&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = url</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开新页面</span></span><br><span class="line">&lt;a href=<span class="string">&quot;url&quot;</span> target=<span class="string">&quot;_blank&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">open</span>(url, <span class="string">&quot;_blank&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2><blockquote>
<p>浏览器中的文件地址打不开时就会变为下载。注意 ios 页面通过 location.href 指向下载地址后会直接预览，返回时会丢失全局数据而导致页面报错，只能使用 window.open。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 1、location、window.open 下载文件</span></span><br><span class="line"> location.<span class="property">href</span> = <span class="string">&quot;http://baidu.com/?name=a&quot;</span></span><br><span class="line"> <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;http://baidu.com/&#x27;</span>, <span class="string">&#x27;_blank&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">file_download</span> (data, fileName) &#123;</span><br><span class="line">     <span class="keyword">var</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">     link.<span class="property">download</span> = fileName</span><br><span class="line">     link.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">// 2、通过 Blob 下载文本文件</span></span><br><span class="line">     <span class="keyword">var</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([data])</span><br><span class="line">     link.<span class="property">href</span> = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(blob)</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 3、通过 base64 下载任意文件</span></span><br><span class="line">     <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">     <span class="keyword">var</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">     <span class="keyword">var</span> width = data.<span class="property">width</span>;</span><br><span class="line">     <span class="keyword">var</span> height = data.<span class="property">height</span>;</span><br><span class="line">     context.<span class="title function_">drawImage</span>(data, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     link.<span class="property">href</span> = context.<span class="title function_">toDataURL</span>(<span class="string">&#x27;image/png&#x27;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(link)</span><br><span class="line">     link.<span class="title function_">click</span>()</span><br><span class="line">     <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(link)</span><br><span class="line">     <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">revokeObjectURL</span>(link.<span class="property">href</span>)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


<h2 id="PDF-预览"><a href="#PDF-预览" class="headerlink" title="PDF 预览"></a>PDF 预览</h2><blockquote>
<p>通过标签直接加载的方案都是将 pdf 内容全部下载完成之后才开始渲染，文件较大时需要用户等待很长时间，为了实现高性能的在线预览则需要实现分片加载。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基于 PDF.js 库进行深度定制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 1、下载分片：通过服务器获取分片 url 并下载</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> loadStatus：保存加载状态 (等待、已下载)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> pages：保存已经下载的分片</span></span><br><span class="line"><span class="comment">***/</span></span><br><span class="line"><span class="keyword">const</span> loadStatus = &#123; <span class="attr">WAIT</span>: <span class="number">0</span>, <span class="attr">LOADED</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> &#123; startPage, totalPage, url &#125; = <span class="keyword">await</span> <span class="title function_">fetchPdfFragment</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> pages = <span class="title function_">initPages</span>(totalPage);</span><br><span class="line"><span class="keyword">const</span> loadingTask = <span class="variable constant_">PDFJS</span>.<span class="title function_">getDocument</span>(url);</span><br><span class="line">loadingTask.<span class="property">promise</span>.<span class="title function_">then</span>(<span class="function">(<span class="params">pdfDoc</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pdfDoc.<span class="property">numPages</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pageIndex = startPage + i;</span><br><span class="line">        <span class="keyword">const</span> page = pages[pageIndex - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (page.<span class="property">loadStatus</span> !== loadStatus.<span class="property">LOADED</span>) &#123;</span><br><span class="line">            pdfDoc.<span class="title function_">getPage</span>(i + <span class="number">1</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">pdfPage</span>) =&gt;</span> &#123;</span><br><span class="line">                page.<span class="property">pdfPage</span> = pdfPage;</span><br><span class="line">                page.<span class="property">loadStatus</span> = loadStatus.<span class="property">LOADED</span>;</span><br><span class="line">                <span class="title function_">startRenderPages</span>();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initPages</span> (totalPage) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; totalPage; i += <span class="number">1</span>) &#123;</span><br><span class="line">        pages.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">pageNo</span>: i + <span class="number">1</span>, </span><br><span class="line">            <span class="attr">dom</span>: <span class="literal">null</span>, </span><br><span class="line">            <span class="attr">pdfPage</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">loadStatus</span>: loadStatus.<span class="property">WAIT</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、渲染分片</span></span><br><span class="line"><span class="keyword">const</span> viewport = pdfPage.<span class="title function_">getViewport</span>(&#123; <span class="attr">scale</span>: <span class="number">1</span>, <span class="attr">rotation</span>: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> pageSize = &#123; <span class="attr">width</span>: viewport.<span class="property">width</span>, <span class="attr">height</span>: viewport.<span class="property">height</span> &#125;</span><br><span class="line"><span class="keyword">const</span> contentView = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">contentView.<span class="property">style</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.pageSize.width&#125;</span>px`</span>;</span><br><span class="line">contentView.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;(totalPage * (pageSize.height + <span class="number">10</span>))&#125;</span>px`</span>;</span><br><span class="line">pdfContainer.<span class="title function_">appendChild</span>(contentView);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 pdf 的页码来将其内容渲染到指定区域</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderPageContent</span> (page) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; pdfPage, pageNo, dom &#125; = page;</span><br><span class="line">    <span class="keyword">if</span> (dom) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">const</span> viewport = pdfPage.<span class="title function_">getViewport</span>(&#123; <span class="attr">scale</span>: <span class="number">1</span>, <span class="attr">rotation</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">    canvas.<span class="property">height</span> = pageSize.<span class="property">height</span>;</span><br><span class="line">    canvas.<span class="property">width</span> = pageSize.<span class="property">width</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> pageDom = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    pageDom.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    pageDom.<span class="property">style</span>.<span class="property">top</span> = <span class="string">`<span class="subst">$&#123;((pageNo - <span class="number">1</span>) * (pageSize.height + <span class="number">10</span>))&#125;</span>px`</span>;</span><br><span class="line">    pageDom.<span class="property">style</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;pageSize.width&#125;</span>px`</span>;</span><br><span class="line">    pageDom.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;pageSize.height&#125;</span>px`</span>;</span><br><span class="line">    pageDom.<span class="title function_">appendChild</span>(canvas);</span><br><span class="line">  </span><br><span class="line">    pdfPage.<span class="title function_">render</span>(&#123; <span class="attr">canvasContext</span>: context, viewport &#125;);</span><br><span class="line">    page.<span class="property">dom</span> = pageDom;</span><br><span class="line">    contentView.<span class="title function_">appendChild</span>(pageDom);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 滚动加载：监听滚动触发 scrollPdf，防抖保证不会一次产生过多请求</span></span><br><span class="line">scrollPdf = _.<span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> scrollTop = pdfContainer.<span class="property">scrollTop</span>;</span><br><span class="line">    <span class="keyword">const</span> height = pdfContainer.<span class="property">height</span>;</span><br><span class="line">    <span class="comment">// 根据内容可视区域中心点计算页码, 没有滚动时，指向第一页</span></span><br><span class="line">    <span class="keyword">const</span> index = <span class="title class_">Math</span>.<span class="title function_">ceil</span>((scrollTop + height/<span class="number">2</span>) / (pageSize.<span class="property">height</span> + <span class="number">10</span>));</span><br><span class="line">    <span class="keyword">const</span> pageIndex = scrollTop &gt; <span class="number">0</span> ? index : <span class="number">1</span>;</span><br><span class="line">    <span class="title function_">loadBefore</span>(pageIndex);</span><br><span class="line">    <span class="title function_">loadAfter</span>(pageIndex);</span><br><span class="line">&#125;, <span class="number">200</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadBefore</span> (pageIndex) &#123;  <span class="comment">// 获取当前页之前页面的分片</span></span><br><span class="line">    <span class="comment">// 假定每个分片的大小是 5 页</span></span><br><span class="line">    <span class="keyword">const</span> start = (<span class="title class_">Math</span>.<span class="title function_">floor</span>(pageIndex/<span class="number">5</span>) * <span class="number">5</span>) - (<span class="number">5</span> - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (start &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> prevPage = pages[start - <span class="number">1</span>] || &#123;&#125;;</span><br><span class="line">        prevPage.<span class="property">loadStatus</span> ===loadStatus.<span class="property">WAIT</span> &amp;&amp; <span class="title function_">loadPdfData</span>(start);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadAfter</span> (pageIndex) &#123;  <span class="comment">// 获取当前页之后页面的分片</span></span><br><span class="line">    <span class="keyword">const</span> start = (<span class="title class_">Math</span>.<span class="title function_">floor</span>(pageIndex/<span class="number">5</span>) * <span class="number">5</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (start &lt;= pages.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> nextPage = pages[start - <span class="number">1</span>] || &#123;&#125;;</span><br><span class="line">        nextPage.<span class="property">loadStatus</span> ===loadStatus.<span class="property">WAIT</span> &amp;&amp; <span class="title function_">loadPdfData</span>(start);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、性能优化：文件页数过多时一直滚动渲染可能导致页面卡顿，需要清除可视范围外的页面元素。</span></span><br><span class="line"><span class="comment">// 获取需要渲染的范围</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRenderScope</span> (pageIndex) &#123;</span><br><span class="line">    <span class="keyword">const</span> pagesToRender = [];</span><br><span class="line">    <span class="keyword">let</span> i = pageIndex - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> j = pageIndex + <span class="number">1</span>;</span><br><span class="line">    pagesToRender.<span class="title function_">push</span>(pages[pageIndex - <span class="number">1</span>]);</span><br><span class="line">    <span class="comment">// 根据当前的可视范围内的页码，我们前后只保留 10 页</span></span><br><span class="line">    <span class="keyword">while</span> (pagesToRender.<span class="property">length</span> &lt; <span class="number">10</span> &amp;&amp; pagesToRender.<span class="property">length</span> &lt; pages.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            pagesToRender.<span class="title function_">push</span>(pages[i - <span class="number">1</span>]);</span><br><span class="line">            i -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pagesToRender.<span class="property">length</span> &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j &lt;= pages.<span class="property">length</span>) &#123;</span><br><span class="line">            pagesToRender.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">pages</span>[j - <span class="number">1</span>]);</span><br><span class="line">            j += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pagesToRender;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染需要展示的页面，不需展示的页码将其清除</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderPages</span> (pageIndex) &#123;</span><br><span class="line">    <span class="keyword">const</span> pagesToRender = <span class="title function_">getRenderScope</span>(pageIndex);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">of</span> pages) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pagesToRender.<span class="title function_">includes</span>(i)) &#123;</span><br><span class="line">            i.<span class="property">loadStatus</span> === loadStatus.<span class="property">LOADED</span> ? </span><br><span class="line">            <span class="title function_">renderPageContent</span>(i) : <span class="title function_">renderPageLoading</span>(）;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">clearPage</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 清除页面 dom</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearPage</span> (page) &#123;</span><br><span class="line">    <span class="keyword">if</span> (page.<span class="property">dom</span>) &#123;</span><br><span class="line">       contentView.<span class="title function_">removeChild</span>(page.<span class="property">dom</span>);</span><br><span class="line">       page.<span class="property">dom</span> = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 页面正在下载时渲染 loading 视图</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderPageLoading</span> (page) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; pageNo, dom &#125; = page;</span><br><span class="line">    <span class="keyword">if</span> (dom) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">    <span class="keyword">const</span> pageDom = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    pageDom.<span class="property">style</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;pageSize.width&#125;</span>px`</span>;</span><br><span class="line">    pageDom.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;pageSize.height&#125;</span>px`</span>;</span><br><span class="line">    pageDom.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    pageDom.<span class="property">style</span>.<span class="property">top</span> = <span class="string">`<span class="subst">$&#123;((pageNo - <span class="number">1</span>) * (pageSize.height + <span class="number">10</span>))&#125;</span>px`</span>;</span><br><span class="line">    <span class="comment">// 此处在 dom 上添加 loading 组件，省略实现</span></span><br><span class="line">    page.<span class="property">dom</span> = pageDom;</span><br><span class="line">    contentView.<span class="title function_">appendChild</span>(pageDom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、表单上传</span></span><br><span class="line">&lt;form action=<span class="string">&quot;/save&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/form&gt;</span><br><span class="line">$(<span class="string">&#x27;#form&#x27;</span>).<span class="title function_">ajaxSubmit</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123; &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、模拟表单数据上传</span></span><br><span class="line">&lt;input id=<span class="string">&quot;fileinfo&quot;</span> type=<span class="string">&quot;file&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">formData.<span class="title function_">append</span>(<span class="string">&quot;files&quot;</span>, $(<span class="string">&quot;.notFormFile&quot;</span>)[<span class="number">0</span>].<span class="property">files</span>[<span class="number">0</span>])</span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;save&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: formData,</span><br><span class="line">    <span class="attr">processData</span>: <span class="literal">false</span>,           <span class="comment">// 不处理发送数据</span></span><br><span class="line">    <span class="attr">contentType</span>: <span class="literal">false</span>,           <span class="comment">// 不设置 Content-Type</span></span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123; &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、分片上传</span></span><br><span class="line">&lt;input type=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span> multiple&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>分片上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="keyword">let</span> files = $(<span class="string">&#x27;#file&#x27;</span>)[<span class="number">0</span>].<span class="property">files</span></span><br><span class="line"><span class="title function_">upload</span>(files[<span class="number">0</span>], <span class="number">0</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">upload</span> (file, skip) &#123;</span><br><span class="line">    <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    <span class="keyword">var</span> blockSize = <span class="number">1000000</span>;</span><br><span class="line">    <span class="keyword">var</span> nextSize = <span class="title class_">Math</span>.<span class="title function_">min</span>((skip + <span class="number">1</span>) * blockSize, file.<span class="property">size</span>);             </span><br><span class="line">    <span class="keyword">var</span> fileData = file.<span class="title function_">slice</span>(skip * blockSize, nextSize);</span><br><span class="line">    formData.<span class="title function_">append</span>(<span class="string">&quot;file&quot;</span>, fileData);</span><br><span class="line">    formData.<span class="title function_">append</span>(<span class="string">&quot;fileName&quot;</span>, file.<span class="property">name</span>);</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/save&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: formData,</span><br><span class="line">        <span class="attr">processData</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`已上传<span class="subst">$&#123;skip+<span class="number">1</span>&#125;</span>`</span>)</span><br><span class="line">            <span class="keyword">if</span> (file.<span class="property">size</span> &lt;= nextSize) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;上传完成&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">upload</span>(file, ++skip)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、拖拽、粘贴上传：ondrop、onpaste</span></span><br><span class="line">&lt;textarea placeholder=<span class="string">&quot;请将文件拖拽或直接粘贴到这里&quot;</span>&gt;&lt;/textarea&gt;</span><br><span class="line">$(<span class="string">&quot;textarea&quot;</span>).<span class="property">ondrop</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="comment">// 拖拽数据</span></span><br><span class="line">    <span class="keyword">var</span> file = event.<span class="property">dataTransfer</span>.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 粘贴数据</span></span><br><span class="line">    <span class="keyword">var</span> clipboard = event.<span class="property">clipboardData</span>.<span class="property">items</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (clipboard.<span class="property">kind</span> == <span class="string">&#x27;file&#x27;</span> || </span><br><span class="line">        clipboard.<span class="property">type</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;image&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        file = clipboard.<span class="title function_">getAsFile</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    formData.<span class="title function_">append</span>(<span class="string">&quot;files&quot;</span>, files);</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/save&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: formData,</span><br><span class="line">        <span class="attr">processData</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123; &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6 ～ ES9 新特性</title>
    <url>/2019/05/23/4-5-ES%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<h1 id="一、ES6"><a href="#一、ES6" class="headerlink" title="一、ES6"></a>一、ES6</h1><h2 id="let-const"><a href="#let-const" class="headerlink" title="let const"></a>let const</h2><blockquote>
<p><code>一对花括号包裹的代码被称为一个代码块，比如 for 循环、if 条件判断等</code>。块级作用域的引入意味着不再需要通过创建函数来定义一个新的作用域，而只需要使用大括号 { } 即可以创建一个新的作用域，其中的变量必须先声明后使用，相同作用域内不允许重复声明。var 声明的变量可以在代码块外面使用而没有块级作用域，let、const 声明的变量在代码块外面使用会报错而都有块级作用域。</p>
</blockquote>
<ul>
<li><strong>var</strong><ul>
<li>声明变量或常量，可以重复声明和赋值。</li>
<li>变量提升现象：变量可以在声明之前使用。</li>
<li>函数作用域：函数内部的变量只能在函数内部访问。</li>
</ul>
</li>
<li><strong>let</strong><ul>
<li>声明变量，可以重复赋值。</li>
<li>暂时性死区：变量在声明之前使用会报错。</li>
<li>块级作用域：声明的变量只能在其所在的代码块内才能访问。</li>
</ul>
</li>
<li><strong>const</strong><ul>
<li>声明常量，不允许重新赋值。</li>
<li>存在暂时性死区和块级作用域。</li>
<li>常量名建议写成纯大写字母表示。</li>
</ul>
</li>
</ul>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5 </span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;lux&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello&#x27;</span> + name)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6：$&#123;&#125;</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;lux&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`hello <span class="subst">$&#123;name&#125;</span>`</span>)  <span class="comment">// hello lux</span></span><br></pre></td></tr></table></figure>


<h3 id="多行字符串"><a href="#多行字符串" class="headerlink" title="多行字符串"></a>多行字符串</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5：反斜杠</span></span><br><span class="line"><span class="keyword">var</span> msg = <span class="string">&quot;Hi \</span></span><br><span class="line"><span class="string">man&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6：反引号</span></span><br><span class="line"><span class="keyword">const</span> template = <span class="string">`welcome</span></span><br><span class="line"><span class="string">    to</span></span><br><span class="line"><span class="string">world`</span></span><br></pre></td></tr></table></figure>


<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// includes：判断是否包含</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;hahay&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">includes</span>(<span class="string">&#x27;y&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// repeat: 获取字符串重复n次</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;he&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">repeat</span>(<span class="number">3</span>)) <span class="comment">// &#x27;hehehe&#x27;</span></span><br><span class="line"><span class="comment">// 如果带有小数，先进行 Math.floor(num) 处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// startsWith、endsWith：判断是否以给定文本 开始、结束</span></span><br><span class="line"><span class="keyword">const</span> str =  <span class="string">&#x27;hello world!&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">startsWith</span>(<span class="string">&#x27;hello&#x27;</span>))  <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">endsWith</span>(<span class="string">&#x27;!&#x27;</span>))        <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// padStart、padEnd：若字符串不够指定长度则在 头部、尾部 补全</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    <span class="keyword">const</span> hours = now.<span class="title function_">getHours</span>().<span class="title function_">toString</span>()</span><br><span class="line">    <span class="keyword">const</span> minutes = now.<span class="title function_">getMinutes</span>().<span class="title function_">toString</span>()</span><br><span class="line">    <span class="keyword">const</span> seconds = now.<span class="title function_">getSeconds</span>().<span class="title function_">toString</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;hours.padStart(<span class="number">2</span>, <span class="number">0</span>)&#125;</span>:<span class="subst">$&#123;minutes.padStart(<span class="number">2</span>, <span class="number">0</span>)&#125;</span>:<span class="subst">$&#123;seconds.padStart(<span class="number">2</span>, <span class="number">0</span>)&#125;</span>`</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>


<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><ul>
<li>省略 return 关键字</li>
<li>不需要 function 关键字</li>
<li>始终指向当前上下文的 this 对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只有一个参数时不需要 ()</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">f</span> = n =&gt; n  </span><br><span class="line"><span class="keyword">let</span> <span class="title function_">f</span> = (<span class="params"></span>) =&gt; <span class="number">5</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 只有一条返回语句时不需要 &#123;&#125;</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].<span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回对象则需要括号包裹</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">obj</span> = name =&gt; (&#123;<span class="string">&quot;name&quot;</span>:name&#125;) </span><br></pre></td></tr></table></figure>


<h3 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h3><ul>
<li>默认参数：定义函数时指定</li>
<li>Rest 参数：获取函数的不定参数</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">x=<span class="number">1</span>, y=<span class="number">1</span></span>)&#123;  </span><br><span class="line">  <span class="keyword">return</span> x + y;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rest 参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x, ...params</span>)&#123; </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params) </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>, <span class="number">2</span>)      <span class="comment">// [2]</span></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)   <span class="comment">// [2, 3]</span></span><br></pre></td></tr></table></figure>


<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 属性简写：属性名相同</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">people</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; name, age &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> user = &#123; name &#125;;  <span class="comment">// &#123; name: &quot;bar&quot; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法简写</span></span><br><span class="line"><span class="keyword">const</span> people = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;lux&#x27;</span>,</span><br><span class="line">  getName () &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 浅拷贝方法</span></span><br><span class="line"><span class="keyword">const</span> target = &#123;&#125;   </span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(target, &#123; <span class="attr">name</span>: <span class="string">&#x27;Lisa&#x27;</span> &#125;, &#123; <span class="attr">age</span>: <span class="number">18</span> &#125;)</span><br></pre></td></tr></table></figure>


<h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><blockquote>
<p>自动提取数组或对象中的值并赋值给变量，要求前后结构相同或包含。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 对象：变量须与属性同名但不分顺序</span></span><br><span class="line"><span class="keyword">let</span> &#123; name, age &#125; = &#123; <span class="attr">name</span>: <span class="string">&#x27;lux&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;name&#125;</span>: <span class="subst">$&#123;age&#125;</span>`</span>)  <span class="comment">// lux : 20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> &#123;foo&#125; = &#123;<span class="attr">bar</span>: <span class="string">&#x27;baz&#x27;</span>&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo)           <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">name</span>: a &#125; = &#123; <span class="attr">name</span>: <span class="string">&quot;Lisa&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name, a)    <span class="comment">// &quot;&quot; Lisa</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组：变量值由其位置决定</span></span><br><span class="line"><span class="keyword">let</span> [x, y] = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="keyword">let</span> [a, ...b] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不完全解构</span></span><br><span class="line"><span class="keyword">let</span> [x, y] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认值</span></span><br><span class="line">[x, y = <span class="string">&#x27;b&#x27;</span>] = [<span class="string">&#x27;a&#x27;</span>]    <span class="comment">// x=&#x27;a&#x27;, y=&#x27;b&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码重构：最后一行即可</span></span><br><span class="line"><span class="keyword">var</span> body = request.<span class="property">body</span></span><br><span class="line"><span class="keyword">var</span> username = body.<span class="property">username</span></span><br><span class="line"><span class="keyword">var</span> password = body.<span class="property">password</span></span><br><span class="line"><span class="keyword">const</span> &#123; body, <span class="attr">body</span>: &#123; username, password &#125; &#125; = request </span><br></pre></td></tr></table></figure>


<h2 id="Spread-扩展运算符"><a href="#Spread-扩展运算符" class="headerlink" title="Spread 扩展运算符"></a>Spread 扩展运算符</h2><blockquote>
<p>Rest 参数的逆运算，用于将数组或对象展开成一系列用逗号隔开的值。</p>
</blockquote>
<ul>
<li>合并对象或数组：参数位置不限制。</li>
<li>配合解构赋值：必须将参数放到最后，否则报错。  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">const</span> color = [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> colorful = [...color, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;pink&#x27;</span>]  </span><br><span class="line"><span class="keyword">const</span> [first, ...colorful] = color  <span class="comment">// [&#x27;yellow&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;lux&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;</span><br><span class="line"><span class="keyword">const</span> userinfo = &#123; ...user, <span class="attr">address</span>: <span class="string">&#x27;shanghai&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">const</span> &#123; name, ...userinfo &#125; = user   <span class="comment">// &#123;age: 20&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Symbol-类型"><a href="#Symbol-类型" class="headerlink" title="Symbol 类型"></a>Symbol 类型</h2><blockquote>
<p>一种新的原始数据类型，Symbol 值类似于字符串但每一个都表示独一无二的值。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建</span></span><br><span class="line"><span class="keyword">var</span> s1 = <span class="title class_">Symbol</span>();          </span><br><span class="line"><span class="keyword">var</span> s2 = <span class="title class_">Symbol</span>();</span><br><span class="line"><span class="keyword">var</span> s3 = <span class="title class_">Symbol</span>(<span class="string">&quot;foo&quot;</span>);      <span class="comment">// 传入字符串表示描述信息</span></span><br><span class="line"><span class="keyword">var</span> s4 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&quot;foo&quot;</span>);  <span class="comment">// 有则返回，无则创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何两个 Symbol 值都不相等</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> s1, s1 == s2)   <span class="comment">// symbol false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(s3))     <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(s4))     <span class="comment">// foo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能与其他类型的值进行运算，否则会报错</span></span><br><span class="line"><span class="comment">// var k = s1 + 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以转为字符串、布尔值</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="title class_">String</span>(s1)</span><br><span class="line"><span class="keyword">var</span> bl = <span class="title class_">Boolean</span>(s1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为对象属性名：不能使用点操作</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; [s1]: <span class="string">&#x27;hello&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">obj[s1] = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, s1, &#123; <span class="attr">value</span>: <span class="string">&#x27;hello&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性名的遍历</span></span><br><span class="line"><span class="keyword">var</span> sKey = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(obj)  <span class="comment">// 返回Symbol键名</span></span><br><span class="line"><span class="keyword">var</span> aKey = <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(obj)               <span class="comment">// 返回所有键名</span></span><br></pre></td></tr></table></figure>


<h2 id="for-of-遍历"><a href="#for-of-遍历" class="headerlink" title="for-of 遍历"></a>for-of 遍历</h2><ul>
<li>方式对比<ul>
<li>forEach：无法跳出循环，即 break、return 命令都不奏效。</li>
<li>for-in：主要是为遍历对象而设计的，不适用于遍历数组。</li>
<li>for-of：调用遍历器接口，使用范围较广。</li>
</ul>
</li>
<li>使用技巧<ul>
<li>类似数组的对象：通过 Array.from 方法转为数组。</li>
<li>普通对象：通过 Object.keys 方法将键名生成数组、通过 Generator 函数将对象重新包装。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arrLike = &#123; <span class="attr">length</span>: <span class="number">2</span>, <span class="number">0</span>: <span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;b&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(arrLike)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;Jane&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(obj[key]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Iterator-遍历器"><a href="#Iterator-遍历器" class="headerlink" title="Iterator 遍历器"></a>Iterator 遍历器</h2><blockquote>
<p>本质是一种有 next() 方法的指针对象，第几次调用就指向第几个成员</p>
</blockquote>
<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ul>
<li>为各种数据结构提供一个统一的、简便的访问接口（统一）</li>
<li>使得数据结构的成员能够按某种次序排列（按序）</li>
<li>配合 for-of 实现遍历</li>
</ul>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><blockquote>
<p>本质是一个生成遍历器的函数，不同于 forEach 等遍历方法</p>
</blockquote>
  <div style="text-indent: 2em">默认部署在数据结构的 Symbol.iterator 属性，它是当前数据结构默认的遍历器生成函数，执行这个函数就会返回一个遍历器。原生具备 Iterator 接口的数据结构如下：Array、TypedArray、Map、Set、String，只有这些数据结构不需要自定义遍历器生成函数并部署，循环遍历时可以直接通过 for-of 循环或 while 判断对象的 done 属性。</div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原生接口</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> iter = arr[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iter.<span class="title function_">next</span>())  <span class="comment">// &#123;value: &quot;a&quot;, done: false&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义接口</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 对象属性组成的数组</span></span><br><span class="line">    <span class="keyword">const</span> ks = <span class="title class_">Object</span>.<span class="title function_">keys</span>(that);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">next</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">value</span>: that[ks[index++]],</span><br><span class="line">          <span class="attr">done</span>: (index &gt; ks.<span class="property">length</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> v <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(v);      <span class="comment">// 1</span></span><br><span class="line">  <span class="keyword">break</span>;      <span class="comment">// 触发 return </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><blockquote>
<p>任何接受数组作为参数的场景都默认调用了遍历器接口，比如 Array.from、Object.keys、Promise.all、Map()。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 解构赋值</span></span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>().<span class="title function_">add</span>(<span class="string">&#x27;a&#x27;</span>).<span class="title function_">add</span>(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> [first, ...rest] = set;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展运算符</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">[...str] <span class="comment">//  [&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// yield*</span></span><br><span class="line"><span class="keyword">let</span> generator = <span class="keyword">function</span>* () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span>* [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> iterator = <span class="title function_">generator</span>();</span><br><span class="line">iterator.<span class="title function_">next</span>()</span><br></pre></td></tr></table></figure>


<h2 id="Promise-对象"><a href="#Promise-对象" class="headerlink" title="Promise 对象"></a>Promise 对象</h2><blockquote>
<p>处理异步操作的对象，可以通过链式调用的方式来组织代码，让代码更加直观</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建promise</span></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="comment">// 进行一些异步或耗时操作</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="comment">/* 如果成功 */</span> ) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;Stuff worked!&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="title class_">Error</span>(<span class="string">&quot;It broke&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定处理程序</span></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">&#125;, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="Generators-函数"><a href="#Generators-函数" class="headerlink" title="Generators 函数"></a>Generators 函数</h2><h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><ul>
<li><strong>定义</strong><ul>
<li>function 关键字和函数名之间有一个星号。</li>
<li>内部使用 yield 语句，定义不同的内部状态。</li>
<li>作为对象属性时可以简写。</li>
</ul>
</li>
<li><strong>调用</strong><ul>
<li>直接调用 Generator函数并不会执行和返回运行结果，而是返回一个遍历器对象。</li>
<li>依次调用遍历器对象的 next 方法，从上次暂停地方执行到 yield&#x2F;return 语句而可以遍历 Generator 函数内部的每一个状态。</li>
</ul>
</li>
<li><strong>原理</strong><ul>
<li>通过 yield 语句实现传出返回对象。</li>
<li>yield 表达式本身没有返回值，可以通过 next(value) 将传入参数作为上一个 yield 语句的返回值。</li>
</ul>
</li>
<li><strong>yield 语句</strong> <ul>
<li>只能用于 Generator 函数内部。</li>
<li>如果用于其它表达式中，则必须放到圆括号里面。</li>
<li>用作函数参数或放在赋值表达式的右边时，可以不加括号。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">200</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">300</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> f = <span class="title function_">foo</span>();				</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f.<span class="title function_">next</span>());  <span class="comment">// &#123; value: 100, done: false &#125;	</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f.<span class="title function_">next</span>());	<span class="comment">// &#123; value: 200, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f.<span class="title function_">next</span>());	<span class="comment">// &#123; value: 300, done: true &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f.<span class="title function_">next</span>());	<span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>异步编程：将异步操作写到 yield 语句，等到调用 next 方法时再继续执行。</li>
<li>控制流管理：执行多步的耗时操作时，通过回调函数或 Promise 方式都不简洁。</li>
<li>部署 Iterator 接口：利用 Generator 函数，可以在任意对象上部署 Iterator 接口。</li>
<li>作为数据结构：可以返回一系列的值，所以它可以对任意表达式提供类似数组的接口。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 异步操作的同步化表达</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">loadUI</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">showLoading</span>();</span><br><span class="line">  <span class="keyword">yield</span> <span class="title function_">loadUIDataAsynchronously</span>();</span><br><span class="line">  <span class="title function_">hideLoading</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> loader = <span class="title function_">loadUI</span>();</span><br><span class="line">loader.<span class="title function_">next</span>()  <span class="comment">// 加载</span></span><br><span class="line">loader.<span class="title function_">next</span>()  <span class="comment">// 隐藏</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制流管理</span></span><br><span class="line"><span class="title function_">step1</span>(<span class="keyword">function</span> (<span class="params">value1</span>) &#123;</span><br><span class="line">  <span class="title function_">step2</span>(value1, <span class="keyword">function</span>(<span class="params">value2</span>) &#123;</span><br><span class="line">    <span class="title function_">step3</span>(value2, <span class="keyword">function</span>(<span class="params">value3</span>) &#123;</span><br><span class="line">      <span class="comment">// Do something with value3</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(step1)</span><br><span class="line">  .<span class="title function_">then</span>(step2)</span><br><span class="line">  .<span class="title function_">then</span>(step3)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">value3</span>) &#123;</span><br><span class="line">      <span class="comment">// Do something with value3</span></span><br><span class="line">  &#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;&#125;)</span><br><span class="line">  .<span class="title function_">done</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">longRunningTask</span>(<span class="params">value1</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> value2 = <span class="keyword">yield</span> <span class="title function_">step1</span>(value1);</span><br><span class="line">    <span class="keyword">var</span> value3 = <span class="keyword">yield</span> <span class="title function_">step2</span>(value2);</span><br><span class="line">    <span class="keyword">var</span> value4 = <span class="keyword">yield</span> <span class="title function_">step3</span>(value3);</span><br><span class="line">    <span class="keyword">var</span> value5 = <span class="keyword">yield</span> <span class="title function_">step4</span>(value4);</span><br><span class="line">    <span class="comment">// Do something with value4</span></span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 部署 Iterator 接口</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">iterEntries</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i &lt; keys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> key = keys[i];</span><br><span class="line">    <span class="keyword">yield</span> [key, obj[key]];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myObj = &#123; <span class="attr">foo</span>: <span class="number">3</span>, <span class="attr">bar</span>: <span class="number">7</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> <span class="title function_">iterEntries</span>(myObj)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为数据结构</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doStuff</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    fs.<span class="property">readFile</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="string">&#x27;hello.txt&#x27;</span>),</span><br><span class="line">    fs.<span class="property">readFile</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="string">&#x27;world.txt&#x27;</span>),</span><br><span class="line">    fs.<span class="property">readFile</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="string">&#x27;and-such.txt&#x27;</span>)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> *<span class="title function_">doStuff</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> fs.<span class="property">readFile</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="string">&#x27;hello.txt&#x27;</span>);</span><br><span class="line">  <span class="keyword">yield</span> fs.<span class="property">readFile</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="string">&#x27;world.txt&#x27;</span>);</span><br><span class="line">  <span class="keyword">yield</span> fs.<span class="property">readFile</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="string">&#x27;and-such.txt&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (task <span class="keyword">of</span> <span class="title function_">doStuff</span>()) &#123;</span><br><span class="line">    <span class="comment">// task是一个函数，可以像回调函数那样使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Moudle-模块"><a href="#Moudle-模块" class="headerlink" title="Moudle 模块"></a>Moudle 模块</h2>  <div style="text-indent: 2em">ES5 不支持原生的模块化，ES6 内置模块功能借鉴了 CommonJS、AMD，根据功能将代码封装到不同模块。每一个模块都有独立的作用域和命名空间，可以防止命名冲突。当前模块通过 export (default) 定义对外暴露的接口，通过 import 实现加载外部模块。</div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// export：可以有多个，需要加 &#123;&#125;，加载时不可改变变量名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> name = <span class="string">&#x27;Mark&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;name, age&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setName</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  name = <span class="string">&#x27;Mark&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;        <span class="comment">// 别名：允许使用两次</span></span><br><span class="line">  name <span class="keyword">as</span> v1,</span><br><span class="line">  name <span class="keyword">as</span> v2,</span><br><span class="line">  setName <span class="keyword">as</span> setNameV</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;  </span><br><span class="line"><span class="keyword">import</span> &#123; name <span class="keyword">as</span> userName &#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; name, age &#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;  </span><br><span class="line"><span class="keyword">import</span> &#123; setName &#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;  </span><br><span class="line"><span class="keyword">import</span> &#123; v1, v2, setNameV &#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./lib&quot;</span>;       <span class="comment">// 整个模块</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> userinfo <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>; <span class="comment">// 模块别名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// export default：最多有一个，不需要 &#123;&#125;，加载时可以自定义变量名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> name;   <span class="comment">// 等同于 export &#123; name as default &#125;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> setName;  </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; name, setName &#125;  <span class="comment">// 作为对象导出</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> userName <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> setUserName <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> userObj <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同写法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> name;  == <span class="keyword">export</span> &#123;name <span class="keyword">as</span> <span class="keyword">default</span>&#125;;</span><br><span class="line"><span class="keyword">import</span> n <span class="keyword">from</span> <span class="string">&#x27;./lib&#x27;</span>; == <span class="keyword">import</span> &#123;<span class="keyword">default</span> <span class="keyword">as</span> n&#125; <span class="keyword">from</span> <span class="string">&#x27;./lib&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复合写法</span></span><br><span class="line"><span class="keyword">export</span> &#123; foo, bar &#125; <span class="keyword">from</span> <span class="string">&#x27;./lib&#x27;</span>; <span class="comment">// 转发变量而并没有导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; foo, bar &#125; <span class="keyword">from</span> <span class="string">&#x27;./lib&#x27;</span> &amp;&amp; <span class="keyword">export</span> &#123; foo, bar &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; foo <span class="keyword">as</span> myFoo &#125; <span class="keyword">from</span> <span class="string">&#x27;./lib&#x27;</span>; <span class="comment">// 改名并转发变量</span></span><br><span class="line"><span class="keyword">import</span> &#123;foo&#125; <span class="keyword">from</span> <span class="string">&#x27;./lib&#x27;</span> &amp;&amp; <span class="keyword">export</span> &#123;foo <span class="keyword">as</span> myFoo&#125;</span><br></pre></td></tr></table></figure>


<h2 id="class-类"><a href="#class-类" class="headerlink" title="class 类"></a>class 类</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><blockquote>
<p>本质是扩充原型，使其所有实例可以访问相应的属性、方法。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 原型方法</span></span><br><span class="line">  <span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;prototype&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 静态属性和方法</span></span><br><span class="line">  <span class="title class_">User</span>.<span class="property">age</span> = <span class="number">20</span>;</span><br><span class="line">  <span class="title class_">User</span>.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;static&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">User</span> = user;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="comment">// 构造函数：实例化时默认执行(返回实例对象 this)</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 原型方法</span></span><br><span class="line">  <span class="title function_">getName</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 静态方法：不会被实例继承，只能通过类来直接调用</span></span><br><span class="line">  <span class="keyword">static</span> age = <span class="number">20</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">run</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;static&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">run</span>();</span><br><span class="line"><span class="keyword">var</span> u = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">20</span>);</span><br><span class="line">u.<span class="title function_">getName</span>();</span><br></pre></td></tr></table></figure>


<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><blockquote>
<p>本质是延长原型链，将父类的实例置于子类原型链上，使子类的实例可以访问父类及其原型链上的所有属性和方法。</p>
</blockquote>
<ul>
<li><strong>constructor</strong>：子类继承父类时的构造方法，默认返回实例对象 this。主要用于初始化数据、绑定属性和方法。new 实例时会自动补上而可以省略。</li>
<li><strong>super</strong>：子类必须在 constructor 调用它之后才能继承父类的属性和方法，否则新建实例时会报错。这是因为子类自己的 this 对象必须先通过父类的构造函数完成塑造，得到父类同样的实例属性和方法，然后再对其进行加工，加上子类自己的属性和方法。子类如果不调用 super() 就得不到 this 对象。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Father</span>(<span class="params">name, age</span>)&#123;  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age; </span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Father</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5 </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params">name, age, address</span>)&#123;</span><br><span class="line">  <span class="comment">// Father.apply(this, arguments);</span></span><br><span class="line">  <span class="title class_">Father</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">address</span> = address;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6：super 在不同调用场景指向不同</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Father</span>&#123;</span><br><span class="line">  <span class="title function_">constructor</span> (name, age, address) &#123;</span><br><span class="line">    <span class="comment">// 作为函数调用，表示父类的构造函数：继承时必须调用</span></span><br><span class="line">    <span class="variable language_">super</span>();  <span class="comment">// </span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">address</span> = address;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">height</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 作为对象在普通方法时，指向父类的原型对象</span></span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">height</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">weight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 作为对象在静态方法时，指向父类</span></span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">weight</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="存取器"><a href="#存取器" class="headerlink" title="存取器"></a>存取器</h3><blockquote>
<p>通过 <code>getters/setters</code> 来截取对对象成员的访问。 它能帮助你有效的控制对对象成员的访问  对某个属性设置存值函数和取值函数，拦截该属性的存取行为。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只有 getter 没有 setter 时无法进行赋值操作</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123; <span class="comment">//构造函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">name</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span>.<span class="title function_">toUpperCase</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="comment">// 对 this.name 赋则会调用 set name 导致无限递归</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sayName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>);    <span class="comment">// TOM</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">_name</span>);   <span class="comment">// tom</span></span><br><span class="line">p.<span class="title function_">sayName</span>();            <span class="comment">// TOM</span></span><br></pre></td></tr></table></figure>


<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">p</span>: <span class="string">&#x27;Hello World&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">set</span>(obj, <span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line">map.<span class="title function_">get</span>(obj)      <span class="comment">// OK</span></span><br><span class="line"></span><br><span class="line">map.<span class="title function_">has</span>(obj)      <span class="comment">// true</span></span><br><span class="line">map.<span class="title function_">delete</span>(obj)   <span class="comment">// true</span></span><br><span class="line">map.<span class="title function_">has</span>(obj)      <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储无重复值的有序列表</span></span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">1</span>);</span><br><span class="line">set.<span class="title function_">add</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set.<span class="property">size</span>);    <span class="comment">// 2       </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set.<span class="title function_">has</span>(<span class="number">5</span>));  <span class="comment">// false</span></span><br></pre></td></tr></table></figure>


<h1 id="二、ES7"><a href="#二、ES7" class="headerlink" title="二、ES7"></a>二、ES7</h1><h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><blockquote>
<p>通过装饰器函数可以对类、类成员 (类的属性或方法) 进行修饰，从而进行一些相关功能定制。函数有三个参数：<code>target</code> (类的原型)、<code>name</code> (类&#x2F;属性&#x2F;方法的名字)、<code>descriptor</code> (将传递给 Object.defineProperty)。</p>
</blockquote>
<h3 id="装饰模式"><a href="#装饰模式" class="headerlink" title="装饰模式"></a>装饰模式</h3><ul>
<li>包装模式：它们都是通过封装其他对象达到设计目的，但是形态有很大区别<ul>
<li>适配器模式：比如连接不同数据库时需要包装已有接口而实现适配数据库。类似手机使用转接口来适配插座。</li>
<li>装饰器模式：旨在促进代码复用 (可看作继承)，希望为对象添加额外功能而又不需要改变原有接口。类似手机添加一个外壳而并不影响原有的通话、充电等功能。</li>
</ul>
</li>
<li>应用场景<ul>
<li>经典应用：AOP 编程，包括 安全检查、缓存、调试、持久化等。</li>
<li>具体实例：比如日志系统，它的作用是记录系统的行为操作，在不影响原有系统功能的基础上增加记录环节，类似你佩戴了一个智能手环。</li>
</ul>
</li>
</ul>
<h3 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 装饰类成员</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line">  @log</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @unenumerable</span><br><span class="line">  @readonly</span><br><span class="line">  name = <span class="string">&quot;alibaba&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">readonly</span>(<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">  descriptor.<span class="property">writable</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unenumerable</span>(<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">  descriptor.<span class="property">enumerable</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> original = descriptor.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> original === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    descriptor.<span class="property">value</span> = <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Arguments: <span class="subst">$&#123;args&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> result = original.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Result: <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Error: <span class="subst">$&#123;e&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> e = <span class="keyword">new</span> <span class="title class_">Example</span>();</span><br><span class="line">e.<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">e.<span class="property">name</span> = <span class="string">&#x27;antd&#x27;</span>; <span class="comment">// Error</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doge</span>(<span class="params">tar</span>) &#123;</span><br><span class="line">  tar.<span class="property">isDoge</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">@doge</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> &#123; &#125;</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property">isDoge</span> <span class="comment">//  true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doge</span> (par) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">tar</span>) &#123;</span><br><span class="line">    tar.<span class="property">isDoge</span> = par;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_">doge</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> &#123; &#125;</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property">isDoge</span> <span class="comment">//  false</span></span><br></pre></td></tr></table></figure>


<h3 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// react、redux 库的结合使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正常使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReactComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123; &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="title class_">MyReactComponent</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用装饰器</span></span><br><span class="line">@<span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyReactComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="arr-includes"><a href="#arr-includes" class="headerlink" title="arr.includes"></a>arr.includes</h2><blockquote>
<p>判断数组是否包含一个指定值</p>
</blockquote>
<ul>
<li>参数<ul>
<li>要搜索的值</li>
<li>搜索的开始索引</li>
</ul>
</li>
<li>区别<ul>
<li>返回布尔值，indexOf 返回数值</li>
<li>可用来判断数组是否包含 NaN，而 indexOf 不行</li>
<li>对于数组中的空值，includes 返回 undefined，而 indexOf 不会</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, , <span class="number">3</span>, <span class="title class_">NaN</span>]</span><br><span class="line">arr.<span class="title function_">includes</span>(<span class="number">1</span>)          <span class="comment">// true</span></span><br><span class="line">arr.<span class="title function_">includes</span>(<span class="number">1</span>, <span class="number">1</span>)       <span class="comment">// false</span></span><br><span class="line">arr.<span class="title function_">includes</span>(<span class="title class_">NaN</span>)        <span class="comment">// true</span></span><br><span class="line">arr.<span class="title function_">includes</span>(<span class="literal">undefined</span>)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>


<h2 id="求幂运算符"><a href="#求幂运算符" class="headerlink" title="求幂运算符"></a>求幂运算符</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 运算符 **  </span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">2</span></span><br><span class="line">a **= <span class="number">3</span></span><br><span class="line">a == <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">3</span>) == <span class="number">2</span> ** <span class="number">3</span>   <span class="comment">// 8    </span></span><br></pre></td></tr></table></figure>
<h1 id="三、ES8"><a href="#三、ES8" class="headerlink" title="三、ES8"></a>三、ES8</h1><h2 id="async-x2F-await"><a href="#async-x2F-await" class="headerlink" title="async&#x2F;await"></a>async&#x2F;await</h2><blockquote>
<p>async 可看作多个异步操作包装成的一个 Promise 对象，await 是 then() 的语法糖</p>
</blockquote>
<h3 id="本质"><a href="#本质" class="headerlink" title="本质"></a>本质</h3><blockquote>
<p>async 函数是对 Generator 函数的改进，使用时将它的 星号、yield 分别替换为 async、await 即可，优点如下：</p>
</blockquote>
<ul>
<li>内置执行器：Generator 函数的执行必须依靠 co 模块的执行器，而 async 函数自带</li>
<li>更好的语义：async、await 分别表示函数里有异步操作、需要等待后面表达式<br>  的执行结果，语义比较清楚</li>
<li>更广的适用性：co 模块约定 yield 命令后面只能是 Thunk 函数或 Promise 对象，<br>  而 await 命令后面可以是 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。</li>
<li>返回 Promise 对象：可以用 then 方法指定下一步的操作</li>
</ul>
<h3 id="基础使用-1"><a href="#基础使用-1" class="headerlink" title="基础使用"></a>基础使用</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">login</span>(<span class="params">userName</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="string">&#x27;1001&#x27;</span>);</span><br><span class="line">        &#125;, <span class="number">600</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getData</span>(<span class="params">userId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (userId === <span class="string">&#x27;1001&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="string">&#x27;Success&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="string">&#x27;Fail&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">600</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不使用 async/await</span></span><br><span class="line"><span class="title function_">doLogin</span>(<span class="params">userName</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">login</span>(userName)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="variable language_">this</span>.<span class="property">getData</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 async/await</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">doLogin2</span>(<span class="params">userName</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userId=<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">login</span>(userName);</span><br><span class="line">    <span class="keyword">const</span> result=<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getData</span>(userId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">doLogin</span>()   <span class="comment">// Success</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">doLogin2</span>()  <span class="comment">// Succes</span></span><br></pre></td></tr></table></figure>


<h2 id="SharedArrayBuffer-Atomics"><a href="#SharedArrayBuffer-Atomics" class="headerlink" title="SharedArrayBuffer-Atomics"></a>SharedArrayBuffer-Atomics</h2><blockquote>
<p> 用于从共享内存位置读取和写入</p>
</blockquote>
<ul>
<li>并行：同时执行多个任务<ul>
<li>JavaScript 在单线程中执行任务<ul>
<li>同步任务直接在单线程中排队执行</li>
<li>异步任务通过回调函数将结果重新放入到单线程等待执行调用</li>
</ul>
</li>
<li>Web Worker 引入了多线程并行处理任务<ul>
<li>主线程用来与用户互动</li>
<li>Worker 线程用来承担计算任务</li>
<li>每个线程的数据都是隔离的，通过 postMessage() 通信</li>
</ul>
</li>
<li>WebGL 用于 GPU 计算来并行处理数据</li>
</ul>
</li>
<li>并发：在重叠的时间段内执行几个任务<ul>
<li>SharedArrayBuffer：允许 Worker 线程与主线程共享同一块内存</li>
<li>Atomics: 用于处理 worker 共同操作同一内存地址时引起的冲突等问题</li>
</ul>
</li>
</ul>
<h2 id="Object-values-x2F-entries"><a href="#Object-values-x2F-entries" class="headerlink" title="Object.values&#x2F;entries"></a>Object.values&#x2F;entries</h2><ul>
<li>Object.values：返回自身属性值的数组</li>
<li>Object.entries：返回自身属性的键值对的数组</li>
<li>Object.getOwnPropertyDescriptors：返回自身属性的描述对象</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; </span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Jine&quot;</span>,</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">age</span>() &#123; <span class="keyword">return</span> <span class="string">&#x27;18&#x27;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">values</span>(obj)   <span class="comment">// [&quot;Jine&quot;, &quot;18&quot;]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(obj)  <span class="comment">// [[&quot;name&quot;, &quot;Jine&quot;], [&quot;age&quot;, &quot;18&quot;]]</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&quot;name&quot;</span>)  <span class="comment">// 单个属性</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(obj)         <span class="comment">// 所有属性</span></span><br></pre></td></tr></table></figure>


<h2 id="String-padStart-x2F-padEnd"><a href="#String-padStart-x2F-padEnd" class="headerlink" title="String.padStart&#x2F;padEnd"></a>String.padStart&#x2F;padEnd</h2><blockquote>
<p>用于填补字符串的首部或尾部来达到给定长度，参数为 目标长度和可选的填充字符</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;a&quot;</span>.<span class="title function_">padStart</span>(<span class="number">2</span>)         <span class="comment">//  a </span></span><br><span class="line"><span class="string">&quot;a&quot;</span>.<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;bc&quot;</span>)   <span class="comment">// ba</span></span><br><span class="line"><span class="string">&quot;a&quot;</span>.<span class="title function_">padEnd</span>(<span class="number">3</span>, <span class="string">&quot;b&quot;</span>)      <span class="comment">// abb</span></span><br></pre></td></tr></table></figure>


<h1 id="四、ES9"><a href="#四、ES9" class="headerlink" title="四、ES9"></a>四、ES9</h1><blockquote>
<p>正则命名捕获组、反向断言、Unicode 转义等略过</p>
</blockquote>
<h2 id="异步迭代"><a href="#异步迭代" class="headerlink" title="异步迭代"></a>异步迭代</h2><blockquote>
<p>允许 async&#x2F;await 和 for-of 一起使用，以串行的方式执行异步操作</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES6 同步迭代器</span></span><br><span class="line"><span class="keyword">const</span> items = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> item <span class="keyword">of</span> items) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item);  <span class="comment">// a b   </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步迭代器：返回一个 Promise</span></span><br><span class="line"><span class="keyword">const</span> promises = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(<span class="number">2</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(<span class="number">3</span>)),</span><br><span class="line">]</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> p <span class="keyword">of</span> promises) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>(); <span class="comment">//1 ,2 3</span></span><br></pre></td></tr></table></figure>



<h2 id="Promise-finally"><a href="#Promise-finally" class="headerlink" title="Promise.finally"></a>Promise.finally</h2><blockquote>
<p>指定最终一定会执行的逻辑处理</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">42</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span>&#123; &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123; &#125;)</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123; &#125;) </span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>JS 扩展</category>
      </categories>
      <tags>
        <tag>JS 扩展</tag>
      </tags>
  </entry>
  <entry>
    <title>JS 数据结构</title>
    <url>/2019/05/20/4-4-js%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><blockquote>
<p>计算机存储、组织数据的方式。</p>
</blockquote>
<h2 id="逻辑结构"><a href="#逻辑结构" class="headerlink" title="逻辑结构"></a>逻辑结构</h2><blockquote>
<p>数据组织方式。</p>
</blockquote>
<ul>
<li><strong>集合结构</strong><ul>
<li>操作：并集、交集、补集。</li>
<li>特点：集合由一组无序且唯一的项组成、单个数据元素之间没有任何关系。</li>
</ul>
</li>
<li><strong>线性结构</strong><ul>
<li>类型：线性表，包括 堆、栈、队列、一维数组。</li>
<li>特点：数据元素是有序的、数据元素之间存在 一对一 的层次关系。</li>
</ul>
</li>
<li><strong>树形结构</strong><ul>
<li>类型：树。</li>
<li>特点：数据元素之间存在 一对多 的层次关系。</li>
</ul>
</li>
<li><strong>图形结构</strong><ul>
<li>类型：图。</li>
<li>特点：数据元素之间是 多对多 的层次关系。</li>
</ul>
</li>
</ul>
<h2 id="物理结构"><a href="#物理结构" class="headerlink" title="物理结构"></a>物理结构</h2><blockquote>
<p>数据存储方式。</p>
</blockquote>
<ul>
<li><strong>顺序存储</strong><ul>
<li>内存：元素连续放置，基于位置关系访问</li>
<li>优点：随机访问</li>
<li>缺点：插入删除效率低，大小固定</li>
</ul>
</li>
<li><strong>链式存储</strong><ul>
<li>内存：元素并不连续放置，基于引用指针关系访问</li>
<li>优点：大小动态扩展，插入删除效率高</li>
<li>缺点：访问链表元素需要循环查找，不能随机访问</li>
</ul>
</li>
<li><strong>索引存储</strong><ul>
<li>内存：整体无序但索引块之间有序</li>
<li>优点：对顺序查找的一种改进，查找效率高</li>
<li>缺点：需要额外空间存储索引表</li>
</ul>
</li>
<li><strong>散列存储</strong><ul>
<li>内存：数据元素根据函数计算存储位置</li>
<li>优点：基于数据本身查找，查找和存取效率高</li>
<li>缺点：存取随机而不利于顺序查找，存储位置可能相同而冲突</li>
</ul>
</li>
</ul>
<h1 id="一、栈"><a href="#一、栈" class="headerlink" title="一、栈"></a>一、栈</h1><ul>
<li>一种遵循先进后出原则的特殊线性表</li>
<li>它基于数组或链表实现，只能在栈顶增删元素</li>
<li>新元素靠近栈顶，旧元素靠近栈底，类似叠起来的书</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义栈类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 底层数据结构是数组</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 入栈</span></span><br><span class="line">  <span class="title function_">push</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">push</span>(element)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 出栈</span></span><br><span class="line">  <span class="title function_">pop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">pop</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 末位</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">peek</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>[<span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是否为空栈</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">isEmpty</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 尺寸</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">size</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清空栈</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用栈类</span></span><br><span class="line"><span class="keyword">const</span> stack = <span class="keyword">new</span> <span class="title class_">Stack</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stack.<span class="property">isEmpty</span>)  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">stack.<span class="title function_">push</span>(<span class="number">5</span>)</span><br><span class="line">stack.<span class="title function_">push</span>(<span class="number">8</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stack.<span class="property">peek</span>)     <span class="comment">// 8</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stack.<span class="property">size</span>)     <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>


<h1 id="二、队列"><a href="#二、队列" class="headerlink" title="二、队列"></a>二、队列</h1><ul>
<li>一种遵循先进先出原则的特殊线性表</li>
<li>只能队尾添加、队首删除元素，类似排队人群</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Queue</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">items</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = items || []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 循环队列</span></span><br><span class="line">  <span class="title function_">enqueue</span>(<span class="params">element</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">push</span>(element)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 优先队列：根据优先级增删</span></span><br><span class="line">  <span class="title function_">enqueue</span>(<span class="params">element, priority</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> queueElement = &#123; element, priority &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isEmpty</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">push</span>(queueElement)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> preIndex = <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> queueElement.<span class="property">priority</span> &lt; item.<span class="property">priority</span>)</span><br><span class="line">        <span class="keyword">if</span> (preIndex &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">splice</span>(preIndex, <span class="number">0</span>, queueElement)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">push</span>(queueElement)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">dequeue</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">shift</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">front</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">size</span>()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">isEmpty</span>()&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">print</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">items</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> <span class="title class_">Queue</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通队列</span></span><br><span class="line">queue.<span class="title function_">enqueue</span>(<span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">queue.<span class="title function_">enqueue</span>(<span class="string">&#x27;Jack&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(queue.<span class="property">size</span>)     <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(queue.<span class="property">isEmpty</span>)  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 优先队列</span></span><br><span class="line">queue.<span class="title function_">enqueue</span>(<span class="string">&#x27;Surmon&#x27;</span>, <span class="number">3</span>)</span><br><span class="line">queue.<span class="title function_">enqueue</span>(<span class="string">&#x27;John&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">queue.<span class="title function_">enqueue</span>(<span class="string">&#x27;Jack&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">queue.<span class="title function_">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环队列</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoopQueue</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Queue</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">items</span>) &#123;</span><br><span class="line">      <span class="variable language_">super</span>(items)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getIndex</span>(<span class="params">index</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> length = <span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span></span><br><span class="line">      <span class="keyword">return</span> index &gt; length ? (index % length) : index</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">find</span>(<span class="params">index</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">isEmpty</span> ? <span class="variable language_">this</span>.<span class="property">items</span>[<span class="variable language_">this</span>.<span class="title function_">getIndex</span>(index)] : <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> loopQueue = <span class="keyword">new</span> <span class="title class_">LoopQueue</span>([<span class="string">&#x27;Surmon&#x27;</span>])</span><br><span class="line">loopQueue.<span class="title function_">enqueue</span>(<span class="string">&#x27;SkyRover&#x27;</span>)</span><br><span class="line">loopQueue.<span class="title function_">enqueue</span>(<span class="string">&#x27;Even&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(loopQueue.<span class="property">size</span>)      <span class="comment">// 3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(loopQueue.<span class="title function_">find</span>(<span class="number">26</span>))  <span class="comment">// &#x27;Evan&#x27;</span></span><br></pre></td></tr></table></figure>


<h1 id="三、链表"><a href="#三、链表" class="headerlink" title="三、链表"></a>三、链表</h1><blockquote>
<p>链接方式存储数据的线性表。链表的每个数据单元就是一个节点，包含节点信息、指向后一个节点的引用地址 (称为”链”) </p>
</blockquote>
  <div style="text-indent: 2em">数组是存储多个元素时最常用的数据结构，但是在很多编程语言中，数组的长度固定，当数组填满后再添加元素比较困难，删除和添加元素时需要将数组中的所有元素变换位置，操作成本较高。JS 数组并不存在上述问题，主要是因为它们被作为对象实现，不过效率较低。线性表的顺序存储结构由于存储元素不连续都会有以上问题，链表就是针对它的优化结果。</div>
        

<h2 id="链表类型"><a href="#链表类型" class="headerlink" title="链表类型"></a>链表类型</h2><ul>
<li>单链表：单一的向下传递，每个节点只记录下一个节点的信息</li>
<li>静态链表：基于数组实现的链表，每个节点包含了数据和指向地址</li>
<li>循环链表：由于单链表到达尾部时回溯到头部很麻烦，所以首尾相连形成循环</li>
<li>双向链表：基于单链表增加前指针，每个节点都保存两个分别指向前后节点的地址</li>
</ul>
<h2 id="单链表"><a href="#单链表" class="headerlink" title="单链表"></a>单链表</h2><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3>  <div align="center">
      <img src="/images/js/link-list.png" alt="单链表结构" width="100%">
  </div>
  
<ul>
<li>data中保存着数据，next保存着下一个链表的引用</li>
<li>我们将链表的尾元素指向了 null 节点，表示链接结束的位置</li>
<li>可以说 data2 跟在 data1 后面，但不能说 data2 是链表中的第二个元素</li>
</ul>
<h3 id="节点操作"><a href="#节点操作" class="headerlink" title="节点操作"></a>节点操作</h3>  <div align="center">
      <img src="/images/js/link-opration.png" alt="单链表节点操作" width="100%">
  </div>

<ul>
<li>插入：修改前驱节点而使其指向新节点，并将新节点指向原前驱节点指向的节点</li>
<li>删除：将待删节点的前驱节点指向待删节点的，同时将待删节点指向 null</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 链表节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span> = element  <span class="comment">// 数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">next</span> = <span class="literal">null</span>        <span class="comment">// 指针 </span></span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LinkedList</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">head</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 追加元素</span></span><br><span class="line">  <span class="title function_">append</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">new</span> <span class="title class_">Node</span>(element)</span><br><span class="line">    <span class="keyword">let</span> current = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">head</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span> = node</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        current = <span class="variable language_">this</span>.<span class="property">head</span></span><br><span class="line">        <span class="keyword">while</span>(current.<span class="property">next</span>) &#123;</span><br><span class="line">            current = current.<span class="property">next</span></span><br><span class="line">        &#125;</span><br><span class="line">        current.<span class="property">next</span> = node</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span>++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 任意位置插入元素</span></span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">position, element</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &gt;= <span class="number">0</span> &amp;&amp; position &lt;= <span class="variable language_">this</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> node = <span class="keyword">new</span> <span class="title class_">Node</span>(element)</span><br><span class="line">      <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span></span><br><span class="line">      <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">      <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">head</span> = node</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">while</span> (index++ &lt; position) &#123;</span><br><span class="line">            previous = current</span><br><span class="line">            current = current.<span class="property">next</span></span><br><span class="line">          &#125;</span><br><span class="line">          node.<span class="property">next</span> = current</span><br><span class="line">          previous.<span class="property">next</span> = node</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">length</span>++</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 移除指定位置元素</span></span><br><span class="line">  <span class="title function_">removeAt</span>(<span class="params">position</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查越界值</span></span><br><span class="line">    <span class="keyword">if</span> (position &gt; -<span class="number">1</span> &amp;&amp; position &lt; length) &#123;</span><br><span class="line">        <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span></span><br><span class="line">        <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">head</span> = current.<span class="property">next</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (index++ &lt; position) &#123;</span><br><span class="line">                previous = current</span><br><span class="line">                current = current.<span class="property">next</span></span><br><span class="line">            &#125;</span><br><span class="line">            previous.<span class="property">next</span> = current.<span class="property">next</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">length</span>--</span><br><span class="line">        <span class="keyword">return</span> current.<span class="property">element</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 寻找元素下标</span></span><br><span class="line">  <span class="title function_">findIndex</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span></span><br><span class="line">    <span class="keyword">let</span> index = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (current) &#123;</span><br><span class="line">      <span class="keyword">if</span> (element === current.<span class="property">element</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> index + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">      index++</span><br><span class="line">      current = current.<span class="property">next</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除指定文档</span></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="variable language_">this</span>.<span class="title function_">indexOf</span>(element)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">removeAt</span>(index)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">isEmpty</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">size</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 转为字符串</span></span><br><span class="line">  <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span></span><br><span class="line">    <span class="keyword">let</span> string = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> (current) &#123;</span><br><span class="line">      string += <span class="string">` <span class="subst">$&#123;current.element&#125;</span>`</span></span><br><span class="line">      current = current.<span class="property">next</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> linkedList = <span class="keyword">new</span> <span class="title class_">LinkedList</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(linkedList)</span><br><span class="line"></span><br><span class="line">linkedList.<span class="title function_">append</span>(<span class="number">2</span>)</span><br><span class="line">linkedList.<span class="title function_">append</span>(<span class="number">6</span>)</span><br><span class="line">linkedList.<span class="title function_">insert</span>(<span class="number">3</span>, <span class="number">18</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(linkedList)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(linkedList.<span class="title function_">findIndex</span>(<span class="number">24</span>))</span><br></pre></td></tr></table></figure>

<h2 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 链表节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span> = element</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prev</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">next</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 双向链表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoublyLinkedList</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">head</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tail</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 任意位置插入元素</span></span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">position, element</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &gt;= <span class="number">0</span> &amp;&amp; position &lt;= <span class="variable language_">this</span>.<span class="property">length</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> <span class="title class_">Node</span>(element)</span><br><span class="line">        <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span></span><br><span class="line">        <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">        <span class="comment">// 首位</span></span><br><span class="line">        <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!head)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">head</span> = node</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">tail</span> = node</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                node.<span class="property">next</span> = current</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">head</span> = node</span><br><span class="line">                current.<span class="property">prev</span> = node</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// 末位</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position === <span class="variable language_">this</span>.<span class="property">length</span>) &#123;</span><br><span class="line">            current = <span class="variable language_">this</span>.<span class="property">tail</span></span><br><span class="line">            current.<span class="property">next</span> = node</span><br><span class="line">            node.<span class="property">prev</span> = current</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">tail</span> = node</span><br><span class="line">        <span class="comment">// 中位</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (index++ &lt; position) &#123;</span><br><span class="line">              previous = current</span><br><span class="line">              current = current.<span class="property">next</span></span><br><span class="line">            &#125;</span><br><span class="line">            node.<span class="property">next</span> = current</span><br><span class="line">            previous.<span class="property">next</span> = node</span><br><span class="line">            current.<span class="property">prev</span> = node</span><br><span class="line">            node.<span class="property">prev</span> = previous</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">length</span>++</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 移除指定位置元素</span></span><br><span class="line">  <span class="title function_">removeAt</span>(<span class="params">position</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &gt; -<span class="number">1</span> &amp;&amp; position &lt; <span class="variable language_">this</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span></span><br><span class="line">        <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 首位</span></span><br><span class="line">        <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">head</span> = <span class="variable language_">this</span>.<span class="property">head</span>.<span class="property">next</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">head</span>.<span class="property">prev</span> = <span class="literal">null</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">tail</span> = <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 末位</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position === <span class="variable language_">this</span>.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">tail</span> = <span class="variable language_">this</span>.<span class="property">tail</span>.<span class="property">prev</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">tail</span>.<span class="property">next</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 中位</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (index++ &lt; position) &#123;</span><br><span class="line">              previous = current</span><br><span class="line">              current = current.<span class="property">next</span></span><br><span class="line">            &#125;</span><br><span class="line">            previous.<span class="property">next</span> = current.<span class="property">next</span></span><br><span class="line">            current.<span class="property">next</span>.<span class="property">prev</span> = previous</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span>--</span><br><span class="line">    <span class="keyword">return</span> current.<span class="property">element</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="四、集合"><a href="#四、集合" class="headerlink" title="四、集合"></a>四、集合</h1><blockquote>
<p>由一组无序且唯一的项组成，操作方法可分为 并集、交集、差集。集合、字典、散列表都可以存储不重复的数据。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Set</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">has</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">hasOwnProperty</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">add</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">has</span>(value)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">items</span>[value] = value</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(value)) &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">items</span>[value]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">size</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">items</span>).<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">values</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">items</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 并集</span></span><br><span class="line">  <span class="title function_">union</span>(<span class="params">otherSet</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> unionSet = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">values</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> unionSet.<span class="title function_">add</span>(<span class="variable language_">this</span>.<span class="property">values</span>[i]))</span><br><span class="line">    otherSet.<span class="property">values</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> unionSet.<span class="title function_">add</span>(otherSet.<span class="property">values</span>[i]))</span><br><span class="line">    <span class="keyword">return</span> unionSet</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 交集</span></span><br><span class="line">  <span class="title function_">intersection</span>(<span class="params">otherSet</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> intersectionSet = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">values</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (otherSet.<span class="title function_">has</span>(v)) &#123;</span><br><span class="line">            intersectionSet.<span class="title function_">add</span>(v)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> intersectionSet</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 差集</span></span><br><span class="line">  <span class="title function_">difference</span>(<span class="params">otherSet</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> differenceSet = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">values</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!otherSet.<span class="title function_">has</span>(v)) &#123;</span><br><span class="line">            differenceSet.<span class="title function_">add</span>(v)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> differenceSet</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 子集</span></span><br><span class="line">  <span class="title function_">subset</span>(<span class="params">otherSet</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">size</span> &gt; otherSet.<span class="property">size</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">values</span>.<span class="title function_">some</span>(<span class="function"><span class="params">v</span> =&gt;</span> !otherSet.<span class="title function_">has</span>(v))</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> set1 = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">set1.<span class="title function_">add</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">set2.<span class="title function_">add</span>(<span class="number">1</span>);</span><br><span class="line">set2.<span class="title function_">add</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set1.<span class="property">values</span>)   </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set1.<span class="title function_">has</span>(<span class="number">1</span>))  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 并集</span></span><br><span class="line"><span class="keyword">let</span> set11 = set1.<span class="title function_">union</span>(set2);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set11.<span class="property">values</span>);  <span class="comment">// [1,2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 交集</span></span><br><span class="line"><span class="keyword">let</span> set12  = set1.<span class="title function_">intersection</span>(set2);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set12.<span class="property">values</span>);  <span class="comment">// [1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 差集</span></span><br><span class="line"><span class="keyword">let</span> set13 = set2.<span class="title function_">difference</span>(set1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set13.<span class="property">values</span>); <span class="comment">// [2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断子集</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set1.<span class="title function_">subset</span>(set2)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>


<h1 id="五、字典"><a href="#五、字典" class="headerlink" title="五、字典"></a>五、字典</h1><blockquote>
<p>即映射，以键值对 { key: value } 的形式存储不重复的数据，Object 对象是字典在 Js 中的实现。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dictionary</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span>[key] = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">items</span>[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">keys</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">items</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">values</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 ES7 values</span></span><br><span class="line">    <span class="comment">// return Object.values(this.items)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过循环生成一个数组并输出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">items</span>).<span class="title function_">reduce</span>(<span class="function">(<span class="params">r, c, i</span>) =&gt;</span> &#123;</span><br><span class="line">        r.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">items</span>[c])</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    &#125;, [])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dictionary = <span class="keyword">new</span> <span class="title class_">Dictionary</span>()</span><br><span class="line">dictionary.<span class="title function_">set</span>(<span class="string">&#x27;Gandalf&#x27;</span>, <span class="string">&#x27;gandalf@email.com&#x27;</span>)</span><br><span class="line">dictionary.<span class="title function_">set</span>(<span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;johnsnow@email.com&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dictionary)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dictionary.<span class="property">keys</span>) </span><br></pre></td></tr></table></figure>


<h1 id="六、散列表"><a href="#六、散列表" class="headerlink" title="六、散列表"></a>六、散列表</h1><blockquote>
<p>又称哈希表，是根据关键字而直接访问内存存储位置的数据结构。</p>
</blockquote>
  <div style="text-indent: 2em">通过计算一个数据关键字的函数，将所需查询的数据内容映射到表中的一个存放位置来访问记录，这加快了查找速度。这个映射函数称做散列函数，存放记录的数组称做散列表。简单来说，通过散列函数将要检索的项与索引（散列值）关联起来，生成一种便于搜索的数据结构（散列表）。</div>
        
<ul>
<li>散列函数<ul>
<li>原则：函数本身便于计算、计算出来的地址分布均匀。</li>
<li>方法：数字分析法、平方取中法、分段叠加法、除留余数法。</li>
</ul>
</li>
<li>处理冲突：键值不同的元素可能会映射到散列表的同一地址，称为 hash 冲突。<ul>
<li>拉链法&#x2F;分离链接：将所有散列地址相同的记录都放入一个线性链表。</li>
<li>开放定址法：冲突时寻找散列表中的空地址。线性探测 (顺序查看表中下一单元)、二次探测 (在表的左右进行跳跃式探测)、随机探测 (建立一个伪随机数发生器)。</li>
<li>再散列法：冲突时通过其它散列函数计算地址。</li>
<li>建立公共溢出区：将所有和散列表冲突的元素都放入溢出表。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HashTable</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">table</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 散列函数</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">loseloseHashCode</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> hash = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> codePoint <span class="keyword">of</span> key) &#123;</span><br><span class="line">      hash += codePoint.<span class="title function_">charCodeAt</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hash % <span class="number">37</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不考虑冲突</span></span><br><span class="line">  <span class="title function_">put</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;position&#125;</span> - <span class="subst">$&#123;key&#125;</span>`</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">table</span>[position] = value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">table</span>[<span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">table</span>[<span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)] = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 分离链接处理冲突：需要一个辅助类 LinkedList 表示要加入的元素</span></span><br><span class="line">  <span class="title function_">put</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">table</span>[position] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">table</span>[position] = <span class="keyword">new</span> <span class="title class_">LinkedList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">table</span>[position].<span class="title function_">append</span>(&#123; key, value &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">table</span>[position] === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getElementValue</span> = node =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (!node &amp;&amp; !node.<span class="property">element</span>) <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="title function_">is</span>(node.<span class="property">element</span>.<span class="property">key</span>, key)) &#123;</span><br><span class="line">          <span class="keyword">return</span> node.<span class="property">element</span>.<span class="property">value</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">getElementValue</span>(node.<span class="property">next</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getElementValue</span>(<span class="variable language_">this</span>.<span class="property">table</span>[position].<span class="property">head</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">table</span>[position] === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getElementValue</span> = node =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (!node &amp;&amp; !node.<span class="property">element</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="title function_">is</span>(node.<span class="property">element</span>.<span class="property">key</span>, key)) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">table</span>[position].<span class="title function_">remove</span>(node.<span class="property">element</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">table</span>[position].<span class="property">isEmpty</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">table</span>[position] = <span class="literal">undefined</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">getElementValue</span>(node.<span class="property">next</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getElementValue</span>(<span class="variable language_">this</span>.<span class="property">table</span>[position].<span class="property">head</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 线性探查</span></span><br><span class="line">  <span class="title function_">put</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">table</span>[position] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">table</span>[position] = &#123; key, value &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> index = ++position</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable language_">this</span>.<span class="property">table</span>[index] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">          index++</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">table</span>[index] = &#123; key, value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">table</span>[position].<span class="title function_">append</span>(&#123; key, value &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getElementValue</span> = index =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">table</span>[index] === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="variable language_">this</span>.<span class="property">table</span>[index].<span class="property">key</span>, key)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">table</span>[index].<span class="property">value</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">getElementValue</span>(index + <span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getElementValue</span>(position)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="title class_">HashTable</span>.<span class="title function_">loseloseHashCode</span>(key)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">removeElementValue</span> = index =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">table</span>[index] === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="variable language_">this</span>.<span class="property">table</span>[index].<span class="property">key</span>, key)) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">table</span>[index] = <span class="literal">undefined</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">removeElementValue</span>(index + <span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">removeElementValue</span>(position)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hash = <span class="keyword">new</span> <span class="title class_">HashTable</span>()</span><br><span class="line">hash.<span class="title function_">put</span>(<span class="string">&#x27;Surmon&#x27;</span>, <span class="string">&#x27;surmon.me@email.com&#x27;</span>)  <span class="comment">// 19 - Surmon</span></span><br><span class="line">hash.<span class="title function_">put</span>(<span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;johnsnow@email.com&#x27;</span>)     <span class="comment">// 29 - John</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hash.<span class="title function_">get</span>(<span class="string">&#x27;Surmon&#x27;</span>))  <span class="comment">// surmon.me@email.com</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hash.<span class="title function_">get</span>(<span class="string">&#x27;Loiane&#x27;</span>))  <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hash)</span><br></pre></td></tr></table></figure>


<h1 id="七、树"><a href="#七、树" class="headerlink" title="七、树"></a>七、树</h1><blockquote>
<p>一对多的非线性结构、分层数据的抽象模型。树状结构分为树和二叉树，树的操作比较复杂但可以转换为二叉树处理。</p>
</blockquote>
<h2 id="树"><a href="#树" class="headerlink" title="树"></a>树</h2><blockquote>
<p>n 个相同类型的数据元素的有限集合，树的集合为森林。主要属性有：<strong>节点</strong> (树中的数据元素。根节点 (没有父节点)、<strong>分支节点</strong> (有子节点)、<strong>叶子节点</strong> (没有子节点))、<strong>子树</strong> (节点组成的树)、<strong>层级</strong> (可以按照节点级别分层)、<strong>深度</strong> (节点到根节点的节点数量)、<strong>高度</strong> (所有节点深度中的最大值)、权值。</p>
</blockquote>
<ul>
<li><strong>无序树</strong>：子节点之间没有顺序关系，又称自由树。</li>
<li><strong>有序树</strong>：子节点之间有顺序关系。<ul>
<li><strong>二叉树</strong>：每个节点最多含有两个子树<ul>
<li>完全二叉树：最后一层右边可能满或不满，左边和其余层都是满的。堆就是一个完全二叉树。</li>
<li>满二叉树：所有叶节点都在最底层的完全二叉树</li>
<li>排序二叉树：有序二叉树、二叉查找树、二叉搜索树</li>
<li>平衡二叉树：AVL树，任何节点的左右子树的高度差不超过 1</li>
</ul>
</li>
<li><strong>哈夫曼树</strong>：最优二叉树，带权路径最短的二叉树<ul>
<li>路径长度：两个节点之间所经过的分支数目</li>
<li>树带权路径长度：所有叶子节点的带权路径长度之和</li>
<li>节点带权路径长度：节点到根节点的分支数目和该节点权值的乘积</li>
</ul>
</li>
<li><strong>B 树</strong>：一种对读写操作进行优化的自平衡的二叉查找树，能够保持数据有序，拥有多余两个子树。</li>
</ul>
</li>
</ul>
<h2 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h2><h3 id="遍历方式"><a href="#遍历方式" class="headerlink" title="遍历方式"></a>遍历方式</h3><ul>
<li>中序遍历<ul>
<li>顺序：左侧子节点、节点本身、右侧子节点</li>
<li>应用：排序操作</li>
</ul>
</li>
<li>前序遍历<ul>
<li>顺序：节点本身、左侧子节点、右侧子节点</li>
<li>应用：打印一个结构化的文档</li>
</ul>
</li>
<li>后序遍历<ul>
<li>顺序：左侧子节点、节点本身、右侧子节点</li>
<li>应用：计算目录及其子目录的文件空间</li>
</ul>
</li>
</ul>
<h3 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h3>  <div align="center">  
      <img src="/images/js/binary-order.png" alt="二叉树顺序存储结构" width="100%">
  </div>
  <div align="center">
      <img src="/images/js/binary-link.png" alt="二叉树链式存储结构" width="100%">
  </div>


  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 顺序存储结构</span></span><br><span class="line"><span class="keyword">var</span> tree = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, , <span class="number">6</span>, , , <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式存储结构</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryNode</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">key, left = <span class="literal">null</span>, right = <span class="literal">null</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">left</span> = left</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">right</span> = right</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="基础定义"><a href="#基础定义" class="headerlink" title="基础定义"></a>基础定义</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="comment">// 数据元素</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key </span><br><span class="line">    <span class="comment">// 指向左右节点的指针</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">left</span> = <span class="literal">null</span>    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">right</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinarySearchTree</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">root</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newNode = <span class="keyword">new</span> <span class="title class_">Node</span>(key)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">insertNode</span> = (<span class="params">node, newNode</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (newNode.<span class="property">key</span> &lt; node.<span class="property">key</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (node.<span class="property">left</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">                node.<span class="property">left</span> = newNode</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">insertNode</span>(node.<span class="property">left</span>, newNode)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (node.<span class="property">right</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">                node.<span class="property">right</span> = newNode</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">insertNode</span>(node.<span class="property">right</span>, newNode)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">root</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span> = newNode</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">insertNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, newNode)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 中序遍历</span></span><br><span class="line">  <span class="title function_">inOrderTraverse</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">inOrderTraverseNode</span> = (<span class="params">node, callback</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="title function_">inOrderTraverseNode</span>(node.<span class="property">left</span>, callback)</span><br><span class="line">            <span class="title function_">callback</span>(node.<span class="property">key</span>)</span><br><span class="line">            <span class="title function_">inOrderTraverseNode</span>(node.<span class="property">right</span>, callback)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">inOrderTraverseNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 先序遍历</span></span><br><span class="line">  <span class="title function_">preOrderTraverse</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">preOrderTraverseNode</span> = (<span class="params">node, callback</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="title function_">callback</span>(node.<span class="property">key</span>)</span><br><span class="line">          <span class="title function_">preOrderTraverseNode</span>(node.<span class="property">left</span>, callback)</span><br><span class="line">          <span class="title function_">preOrderTraverseNode</span>(node.<span class="property">right</span>, callback)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">preOrderTraverseNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 后序遍历</span></span><br><span class="line">  <span class="title function_">postOrderTraverse</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">postOrderTraverseNode</span> = (<span class="params">node, callback</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="title function_">postOrderTraverseNode</span>(node.<span class="property">left</span>, callback)</span><br><span class="line">          <span class="title function_">postOrderTraverseNode</span>(node.<span class="property">right</span>, callback)</span><br><span class="line">          <span class="title function_">callback</span>(node.<span class="property">key</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">postOrderTraverseNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">min</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">minNode</span> = node =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> node ? (node.<span class="property">left</span> ? <span class="title function_">minNode</span>(node.<span class="property">left</span>) : node) : <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">minNode</span>(node || <span class="variable language_">this</span>.<span class="property">root</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">max</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">maxNode</span> = node =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> node ? (node.<span class="property">right</span> ? <span class="title function_">maxNode</span>(node.<span class="property">right</span>) : node) : <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">maxNode</span>(node || <span class="variable language_">this</span>.<span class="property">root</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">search</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">searchNode</span> = (<span class="params">node, key</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (node === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">key</span> === key) <span class="keyword">return</span> node</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">searchNode</span>((key &lt; node.<span class="property">key</span>) ? node.<span class="property">left</span> : node.<span class="property">right</span>, key)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">searchNode</span>(root, key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_removeNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_removeNode</span>(<span class="params">node, key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (node === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (key &lt; node.<span class="property">key</span>) &#123;</span><br><span class="line">        node.<span class="property">left</span> = <span class="variable language_">this</span>.<span class="title function_">_removeNode</span>(node.<span class="property">left</span>, key)</span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key &gt; node.<span class="property">key</span>) &#123;</span><br><span class="line">        node.<span class="property">right</span> = <span class="variable language_">this</span>.<span class="title function_">_removeNode</span>(node.<span class="property">right</span>, key)</span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">left</span> === <span class="literal">null</span> &amp;&amp; node.<span class="property">right</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">left</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node.<span class="property">right</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.<span class="property">right</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node.<span class="property">left</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> minNode = <span class="variable language_">this</span>.<span class="title function_">_findMinNode</span>(node.<span class="property">right</span>)</span><br><span class="line">            node.<span class="property">key</span> = minNode.<span class="property">key</span></span><br><span class="line">            node.<span class="property">right</span> = <span class="variable language_">this</span>.<span class="title function_">_removeNode</span>(node.<span class="property">right</span>, minNode.<span class="property">key</span>)</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tree = <span class="keyword">new</span> <span class="title class_">BinarySearchTree</span>()</span><br><span class="line">tree.<span class="title function_">insert</span>(<span class="number">11</span>)</span><br><span class="line">tree.<span class="title function_">insert</span>(<span class="number">7</span>)</span><br><span class="line">tree.<span class="title function_">insert</span>(<span class="number">5</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tree)</span><br><span class="line">tree.<span class="title function_">inOrderTraverse</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(value) &#125;)</span><br></pre></td></tr></table></figure>


<h1 id="八、图"><a href="#八、图" class="headerlink" title="八、图"></a>八、图</h1><blockquote>
<p>由一系列顶点和连接顶点的边组成的一种非线性数据结构，可以用来表示任何二元关系。</p>
</blockquote>
<h2 id="图的表示"><a href="#图的表示" class="headerlink" title="图的表示"></a>图的表示</h2><blockquote>
<p>没有绝对正确的表示方式，采用哪种方式取决于图的类型和待解决的问题。</p>
</blockquote>
<h3 id="邻接矩阵"><a href="#邻接矩阵" class="headerlink" title="邻接矩阵"></a>邻接矩阵</h3><blockquote>
<p>使用一个二维数组来表示图中顶点之间的连接，如果索引为 i、j 的两个节点连接，则 arr[i][j] &#x3D;&#x3D;&#x3D; 1，否则为 0。缺点是只有一个相邻顶点的顶点也需要一整行来表示连接，浪费内存。</p>
</blockquote>
  <div align="center">
      <img src="/images/js/near-matrix.png" alt="邻接矩阵" width="100%">
  </div>


<h3 id="邻接表"><a href="#邻接表" class="headerlink" title="邻接表"></a>邻接表</h3><blockquote>
<p>由图中每个顶点的相邻顶点列表所组成。只要能表示一对多的数据结构都可以用来描述邻接表，比如多维数组、链表、散列表、字典等。</p>
</blockquote>
  <div align="center">
      <img src="/images/js/near-table.png" alt="邻接表" width="100%">
  </div>

<h3 id="关联矩阵"><a href="#关联矩阵" class="headerlink" title="关联矩阵"></a>关联矩阵</h3><blockquote>
<p>矩阵的行列分别表示顶点和边，使用二维数组表示两者之间的连通性，如果顶点A 是边 E 的入射点，则 array[A][E] &#x3D;&#x3D;&#x3D; 1，否则为 0。通常用于边的数量比顶点少的情况，以节省空间和内存。</p>
</blockquote>
  <div align="center">
      <img src="/images/js/near-table.png" alt="关联矩阵" width="100%">
  </div>

    
<h2 id="图的遍历"><a href="#图的遍历" class="headerlink" title="图的遍历"></a>图的遍历</h2><blockquote>
<p>可以用来寻找特定的顶点或寻找两个顶点之间的路径，检查图是否连通，检查图是否含有环等。思路是追踪每个第一次访问的节点，并且追踪有哪些节点还没有被完全探索。</p>
</blockquote>
<ul>
<li>广度优先搜索：一层一层的遍历顶点</li>
<li>深度优先搜索：选择一个路径一直深入遍历直到尽头，再递归回去选择未访问的顶点</li>
</ul>
<h2 id="创建图类"><a href="#创建图类" class="headerlink" title="创建图类"></a>创建图类</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Graph</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vertices</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">adjList</span> = <span class="keyword">new</span> <span class="title class_">Dictionary</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加顶点</span></span><br><span class="line">  <span class="title function_">addVertex</span>(<span class="params">v</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vertices</span>.<span class="title function_">push</span>(v)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">set</span>(v, [])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加线</span></span><br><span class="line">  <span class="title function_">addEdge</span>(<span class="params">v, w</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">get</span>(v).<span class="title function_">push</span>(w)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">get</span>(w).<span class="title function_">push</span>(v)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">vertices</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">r, v, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">get</span>(v).<span class="title function_">reduce</span>(<span class="function">(<span class="params">r, w, i</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> r + <span class="string">`<span class="subst">$&#123;w&#125;</span> `</span></span><br><span class="line">        &#125;, <span class="string">`<span class="subst">$&#123;r&#125;</span>\n<span class="subst">$&#123;v&#125;</span> =&gt; `</span>)</span><br><span class="line">    &#125;, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 构建顶点之间的路径</span></span><br><span class="line">  <span class="title function_">distance</span>(<span class="params">fromVertex</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> vertices = <span class="variable language_">this</span>.<span class="property">vertices</span></span><br><span class="line">    <span class="keyword">const</span> &#123; distances, predecessors &#125; = <span class="variable language_">this</span>.<span class="title function_">bfs</span>(fromVertex)</span><br><span class="line">    vertices.<span class="title function_">forEach</span>(<span class="function"><span class="params">toVertex</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!!distances[toVertex]) &#123;</span><br><span class="line">            <span class="keyword">let</span> preVertex = predecessors[toVertex]</span><br><span class="line">            <span class="keyword">let</span> slug = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">while</span> (fromVertex !== preVertex) &#123;</span><br><span class="line">                slug = <span class="string">`<span class="subst">$&#123;preVertex&#125;</span> - <span class="subst">$&#123;slug&#125;</span>`</span></span><br><span class="line">                preVertex = predecessors[preVertex]</span><br><span class="line">            &#125;</span><br><span class="line">            slug = <span class="string">`<span class="subst">$&#123;fromVertex&#125;</span> - <span class="subst">$&#123;slug&#125;</span><span class="subst">$&#123;toVertex&#125;</span>`</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(slug)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 广度优先搜索算法</span></span><br><span class="line">  <span class="title function_">bfs</span>(<span class="params">v, callback</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> read = []</span><br><span class="line">      <span class="keyword">const</span> distances = []</span><br><span class="line">      <span class="keyword">const</span> predecessors = []</span><br><span class="line">      <span class="keyword">const</span> adjList = <span class="variable language_">this</span>.<span class="property">adjList</span></span><br><span class="line">      <span class="keyword">const</span> pending = [v || <span class="variable language_">this</span>.<span class="property">vertices</span>[<span class="number">0</span>]]</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">readVertices</span> = vertices =&gt; &#123;</span><br><span class="line">        vertices.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            read.<span class="title function_">push</span>(key)</span><br><span class="line">            pending.<span class="title function_">shift</span>()</span><br><span class="line">            distances[key] = distances[key] || <span class="number">0</span></span><br><span class="line">            predecessors[key] = predecessors[key] || <span class="literal">null</span></span><br><span class="line">            adjList.<span class="title function_">get</span>(key).<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!pending.<span class="title function_">includes</span>(v) &amp;&amp; !read.<span class="title function_">includes</span>(v)) &#123;</span><br><span class="line">                    pending.<span class="title function_">push</span>(v)</span><br><span class="line">                    distances[v] = distances[key] + <span class="number">1</span></span><br><span class="line">                    predecessors[v] = key</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">if</span> (callback) <span class="title function_">callback</span>(key)</span><br><span class="line">            <span class="keyword">if</span> (pending.<span class="property">length</span>) <span class="title function_">readVertices</span>(pending)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">readVertices</span>(pending)</span><br><span class="line">      <span class="keyword">return</span> &#123; distances, predecessors &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 深度优先搜索算法</span></span><br><span class="line">  <span class="title function_">dfs</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> readTimer = <span class="number">0</span></span><br><span class="line">      <span class="keyword">const</span> read = []</span><br><span class="line">      <span class="keyword">const</span> readTimes = []</span><br><span class="line">      <span class="keyword">const</span> finishedTimes = []</span><br><span class="line">      <span class="keyword">const</span> predecessors = []</span><br><span class="line">      <span class="keyword">const</span> adjList = <span class="variable language_">this</span>.<span class="property">adjList</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">readVertices</span> = (<span class="params">vertices, predecessor</span>) =&gt; &#123;</span><br><span class="line">        vertices.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            readTimer++</span><br><span class="line">            <span class="keyword">if</span> (adjList.<span class="title function_">get</span>(key).<span class="title function_">every</span>(<span class="function"><span class="params">v</span> =&gt;</span> read.<span class="title function_">includes</span>(v)) &amp;&amp; !finishedTimes[key]) &#123;</span><br><span class="line">                finishedTimes[key] = readTimer</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (read.<span class="title function_">includes</span>(key)) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            readTimes[key] = readTimer</span><br><span class="line">            read.<span class="title function_">push</span>(key)</span><br><span class="line">            <span class="keyword">if</span> (callback) <span class="title function_">callback</span>(key)</span><br><span class="line">            predecessors[key] = predecessors[key] || predecessor || <span class="literal">null</span></span><br><span class="line">            <span class="keyword">if</span> (read.<span class="property">length</span> !== <span class="variable language_">this</span>.<span class="property">vertices</span>.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="title function_">readVertices</span>(adjList.<span class="title function_">get</span>(key), key)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">readVertices</span>(adjList.<span class="property">keys</span>)</span><br><span class="line">      <span class="keyword">return</span> &#123; readTimes, finishedTimes, predecessors &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> graph = <span class="keyword">new</span> <span class="title class_">Graph</span>()</span><br><span class="line"><span class="keyword">const</span> vertices = [<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;D&#x27;</span>];</span><br><span class="line">vertices.<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> graph.<span class="title function_">addVertex</span>(v))</span><br><span class="line"></span><br><span class="line">graph.<span class="title function_">addEdge</span>(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">graph.<span class="title function_">addEdge</span>(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">graph.<span class="title function_">addEdge</span>(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">graph.<span class="title function_">addEdge</span>(<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(graph.<span class="title function_">toString</span>())  </span><br><span class="line">graph.<span class="title function_">bfs</span>(graph.<span class="property">vertices</span>[<span class="number">0</span>], <span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Visited: &#x27;</span> + value))</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>JS 数据类型</title>
    <url>/2019/05/18/4-3-js%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h1 id="一、字符串"><a href="#一、字符串" class="headerlink" title="一、字符串"></a>一、字符串</h1><blockquote>
<p>用于存储和处理文本，可看作类数组</p>
</blockquote>
<h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str_1 = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">var</span> str_2 = <span class="title class_">String</span>(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> str_3 = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;hello str&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><ul>
<li>length：长度</li>
<li>prototype：原型属性，保存当前对象的原型对象</li>
<li>constructor：引用属性，保存当前对象的构造函数</li>
</ul>
<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><ul>
<li>字符索引：<code>charAt、indexOf</code></li>
<li>正则匹配：<code>match、search、replace</code></li>
<li>分割为数组：<code>split</code></li>
<li>字符串连接：<code>concat</code></li>
<li>裁剪字符串：<code>slice、substr、substring</code></li>
</ul>
<h2 id="扩展方法"><a href="#扩展方法" class="headerlink" title="扩展方法"></a>扩展方法</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 调用方式</span></span><br><span class="line"><span class="keyword">var</span> eg1 = <span class="string">&quot; ab &quot;</span>.<span class="title function_">trim</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除左边的空格</span></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">LTrim</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">replace</span>(<span class="regexp">/(^\s*)/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除右边的空格</span></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">Rtrim</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">replace</span>(<span class="regexp">/(\s*$)/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//去除前后空格</span></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">Trim</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">replace</span>(<span class="regexp">/(^\s*)|(\s*$)/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　</p>
<h1 id="二、对象"><a href="#二、对象" class="headerlink" title="二、对象"></a>二、对象</h1><blockquote>
<p>由方法和属性作为键值对组成的一个无序集合。可看作是一个黑盒子，使用时只关注它的对外接口而不需要了解内部结构</p>
</blockquote>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ol>
<li>内部对象<br><div style="text-indent: 2em">包括<code>Array、Boolean、Date、Function、Global、Math、Number、Object、RegExp、String以及 Error、ReferenceError等各种错误类对象</code>。其中 <code>Global 和 Math</code> 这两个对象又被称为“内置对象”，这两个对象在脚本程序初始化时被创建，不必实例化这两个对象。</div></li>
<li>宿主对象<br><div style="text-indent: 2em">执行JS脚本的环境提供的对象。对于嵌入到网页中的JS来说，其宿主对象就是浏览器提供的对象，所以又称为浏览器对象，如<code>Window、Documen、Element、form、image</code>等。不同的浏览器提供的宿主对象可能不同，即使提供的对象相同，其实现方式也大相径庭，这也带来了浏览器兼容问题，增加开发难度。</div></li>
<li>自定义对象<br><div style="text-indent: 2em">开发人员自己定义的对象，用于扩展 JS 应用和功能。</div></li>
</ol>
<h2 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h2><blockquote>
<p><code>字面量方式 和 new Object()</code> 是两种最常用的对象创建方式，但是在使用同一接口创建多个对象时会产生大量重复代码，为了简化代码量并提高可维护性，项目开发时一般使用面向对象写法。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、字面量创建</span></span><br><span class="line"><span class="keyword">var</span> p1 = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;lisa&quot;</span>,</span><br><span class="line">        <span class="attr">say</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 报错, null / &quot;&quot; 都可以</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="string">&quot;name&quot;</span>: <span class="title class_">None</span> &#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、Object.create 将对象继承到 __proto__ 属性上</span></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="title class_">Object</span>.<span class="title function_">create</span>(&#123; <span class="attr">x</span>: <span class="number">1</span> &#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">__proto__</span>)   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、new 继承构造函数的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建系统内置对象</span></span><br><span class="line"><span class="keyword">var</span> p3 = <span class="keyword">new</span> <span class="title class_">Object</span>(&#123; <span class="attr">x</span>: <span class="number">1</span> &#125;)  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p3) </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;ys&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建自定义对象 </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p4 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;tom&quot;</span>);</span><br></pre></td></tr></table></figure>


<h2 id="拷贝"><a href="#拷贝" class="headerlink" title="拷贝"></a>拷贝</h2><ul>
<li><strong>赋值</strong><ul>
<li><code>=、new Object</code> </li>
<li>原始对象和目标对象指向同一内存地址，任何修改都会相互影响</li>
</ul>
</li>
<li><strong>浅拷贝</strong><ul>
<li><code>Object.assign / $.extend (target, [objN])</code> </li>
<li>只有目标对象的内层对象修改时才会影响原始对象</li>
</ul>
</li>
<li><strong>深拷贝</strong><ul>
<li><code>for in / JSON.parse(JSON.stringify(obj)) / $.extend(true, target, [objN])</code></li>
<li>目标对象的任何修改都不会影响到原始对象</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 赋值</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">age</span>: <span class="number">18</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> _obj = obj;</span><br><span class="line">_obj.<span class="property">age</span> = <span class="number">20</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">age</span>, _obj.<span class="property">age</span>); <span class="comment">// 20 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 浅拷贝</span></span><br><span class="line"><span class="keyword">var</span> boy = &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123; <span class="attr">home</span>: <span class="string">&#x27;北京&#x27;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> _boy = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, boy);</span><br><span class="line">_boy.<span class="property">age</span> = <span class="number">20</span>;</span><br><span class="line">_boy.<span class="property">address</span>.<span class="property">home</span> = <span class="string">&quot;上海&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(boy.<span class="property">age</span>, _boy.<span class="property">age</span>);   <span class="comment">// 18 20</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(boy.<span class="property">address</span>.<span class="property">home</span>, _boy.<span class="property">address</span>.<span class="property">home</span>); <span class="comment">// 上海 上海</span></span><br></pre></td></tr></table></figure>
<h2 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h2><ul>
<li><strong>数据属性</strong>：包含一个数据值的位置，用于读取和写入值<ul>
<li>Configurable：配置，表示能否删除</li>
<li>Enumerable：枚举，表示能否通过 for-in 循环</li>
<li>Writable：可写，表示能否修改属性值</li>
<li>Value：属性的数据值，表示读写属性值的位置</li>
</ul>
</li>
<li><strong>访问器属性</strong><ul>
<li>即存取器属性，是一组获取和设置值的函数</li>
<li>设置 get&#x2F;set 特性之后，属性就会变成访问器属性</li>
<li>不能直接定义，必须使用 Object.defineProperty() 来定义</li>
<li>分类：Configurable、Enumerable、Get、Set</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cat = &#123; </span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Jine&quot;</span>, </span><br><span class="line">  <span class="attr">_year</span>: <span class="number">2020</span>    <span class="comment">// 私有属性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看属性</span></span><br><span class="line"><span class="keyword">var</span> prop = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(cat, <span class="string">&quot;name&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置数据属性</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(cat, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置访问器属性</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(dog, <span class="string">&#x27;year&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_year</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">newVal</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_year</span> = newVal</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化对象属性值</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  <span class="attr">_name</span>: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">name</span>() &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span> + <span class="string">&quot;_s&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">n</span>) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_name</span> = n </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">person.<span class="property">name</span> = <span class="string">&#x27;Lisa&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>);  <span class="comment">// Lisa_s</span></span><br></pre></td></tr></table></figure>


<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;tom&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取</span></span><br><span class="line"><span class="comment">// 点操作后只能是属性名，有横杠时须去掉并把后面的首字母大写</span></span><br><span class="line"><span class="keyword">var</span> name = obj.<span class="property">name</span>   </span><br><span class="line"> <span class="comment">// 中括号中可放属性名或变量名  </span></span><br><span class="line"><span class="keyword">var</span> age = obj[<span class="string">&#x27;age&#x27;</span>]  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改</span></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&quot;新属性值&quot;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法</span></span><br><span class="line">obj.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>) &#125;    </span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">age</span>          </span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断类型</span></span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="title class_">Object</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断对象实例是否包含某个属性</span></span><br><span class="line">obj.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;name&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断对象实例及其原型中是否包含某个属性</span></span><br><span class="line"><span class="string">&quot;name&quot;</span> <span class="keyword">in</span> obj</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断`obj`是否为空</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isEmptyObject</span>(<span class="params">obj</span>)&#123;  </span><br><span class="line">  <span class="keyword">if</span>(!obj || <span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span> || <span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ! <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="property">length</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h2><div style="text-indent: 2em">每个对象都会在其内部初始化一个属性，就是 prototype (原型)，当我们访问一个对象的属性时，如果这个对象内部没有这个属性则去 prototype 里找这个属性，这个 prototype 又会有自己的 prototype，直到 null 结束，如果没有则返回undefined，这就是原型链的运行原理，即查找顺序：`实例对象 obj --> 原型对象 fn.prototype --> Object.prototype -->  null`</div>

<ol>
<li>相互关系：<code>obj.constructor.prototype = obj.__proto__</code></li>
<li>函数对象：通过 new Function() 创建都是函数对象，其他的都是普通对象。每个对象都有 <code>__proto__</code> 属性指向原型对象，但只有函数对象才有 <code>prototype</code> 属性</li>
<li>原型对象：一个普通对象。所有的原型对象都会自动获得一个指向其构造函数的指针 <code>constructor</code>，构造函数通过 <code>prototype</code> 属性指向它的原型对象，可以说 原型对象 <code>Person.prototype</code> 就是构造函数 <code>Person</code> 的一个实例</li>
<li>原型链继承：利用原型让一个引用类型继承另一个引用类型的属性和方法，即让原型对象等于另一个类型的实例，这样就可以通过 <code>__proto__</code> 属性构成实例与原型的链条, 从而实现继承。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s1 = <span class="keyword">new</span> <span class="title class_">Son</span>(<span class="string">&quot;son1&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="keyword">new</span> <span class="title class_">Son</span>(<span class="string">&quot;son2&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1.<span class="property">__proto__</span> == s2.<span class="property">__proto__</span>)</span><br></pre></td></tr></table></figure>


<h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><div style="text-indent: 2em">JSON 是一种轻量级的数据交互方式，可以存储和传输数据而显示更丰富的信息，一般作为前后端交互的数据格式。</div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// json 对象转为字符串</span></span><br><span class="line"><span class="keyword">var</span> json_1 = &#123; <span class="attr">name</span>: <span class="string">&quot;tom&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;</span><br><span class="line"><span class="keyword">var</span> strJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(json)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// json 字符串转为对象</span></span><br><span class="line"><span class="keyword">var</span> strJson = <span class="string">&#x27;&#123; name: &quot;tom&quot;, age: 18 &#125;&#x27;</span></span><br><span class="line"><span class="keyword">var</span> json_2 = <span class="built_in">eval</span>(<span class="string">&#x27;(&#x27;</span> +strJson+ <span class="string">&#x27;)&#x27;</span>);   <span class="comment">// 不建议使用</span></span><br><span class="line"><span class="keyword">var</span> json_3 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(strJson)        <span class="comment">// 接近 W3C 标准</span></span><br></pre></td></tr></table></figure>


<h2 id="类数组对象"><a href="#类数组对象" class="headerlink" title="类数组对象"></a>类数组对象</h2><div style="text-indent: 2em">拥有一个length属性和若干索引属性的对象，常见的有 `arguments、document.forms、document.getElementsByClassName`。arguments 是函数中自动创建的一种类数组对象，用来模拟函数重载效果（根据传入参数个数执行不同函数）。</div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 转换为数组</span></span><br><span class="line"><span class="keyword">var</span> arrayLike = &#123; <span class="string">&#x27;0&#x27;</span> : <span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;1&#x27;</span> : <span class="string">&#x27;b&#x27;</span>, length : <span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> arr1 = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(arrayLike);</span><br><span class="line"><span class="keyword">var</span> arr2 = [].<span class="property">slice</span>.<span class="title function_">call</span>(arrayLike);</span><br><span class="line"><span class="keyword">var</span> arr3 = <span class="title class_">Array</span>.<span class="title function_">from</span>(arrayLike);</span><br><span class="line"></span><br><span class="line"><span class="comment">// arguments 重载</span></span><br><span class="line"><span class="keyword">var</span> checkout = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  　　<span class="keyword">if</span>(<span class="variable language_">arguments</span>.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">  　　　　<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;微信&quot;</span>);</span><br><span class="line">  　　&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">arguments</span>.<span class="property">length</span>==<span class="number">1</span>)&#123;</span><br><span class="line">  　　　　<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;现金&quot;</span>);</span><br><span class="line">  　　&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  　　　　<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;刷卡&quot;</span>);</span><br><span class="line">  　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">checkout</span>();      <span class="comment">// 微信</span></span><br><span class="line"><span class="title function_">checkout</span>(<span class="number">100</span>);   <span class="comment">// 现金</span></span><br><span class="line"><span class="title function_">checkout</span>(<span class="number">1</span>, <span class="number">2</span>);  <span class="comment">// 刷卡</span></span><br></pre></td></tr></table></figure>



<h1 id="三、数组"><a href="#三、数组" class="headerlink" title="三、数组"></a>三、数组</h1><blockquote>
<p>一组数据的有序集合，表现形式是内存中的一段连续的内存地址</p>
</blockquote>
<h2 id="创建-2"><a href="#创建-2" class="headerlink" title="创建"></a>创建</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 直接创建 </span></span><br><span class="line"><span class="keyword">var</span> arr = []            <span class="comment">// 空数组</span></span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]    <span class="comment">// 三个元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过构造函数</span></span><br><span class="line"><span class="keyword">var</span> arr1 = <span class="keyword">new</span> <span class="title class_">Array</span>()    <span class="comment">// 空数组</span></span><br><span class="line"><span class="keyword">var</span> arr2 = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>)    <span class="comment">// 长度为10 </span></span><br><span class="line"><span class="keyword">var</span> arr3 =  <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1</span>, <span class="number">2</span>)   <span class="comment">// 两个元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组中是否存在下标为 1 的元素</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">in</span> arr </span><br></pre></td></tr></table></figure>

<h2 id="拷贝-1"><a href="#拷贝-1" class="headerlink" title="拷贝"></a>拷贝</h2><ul>
<li>浅拷贝<ul>
<li><code>arr.slice(0)、arr.concat()</code></li>
<li>如果数组元素都是基本类型，原始数组和目标数组的修改互不影响</li>
<li>如果数组元素是对象或数组，这样会只拷贝引用而导致修改时相互影响</li>
</ul>
</li>
<li>深拷贝<ul>
<li><code>JSON.parse(JSON.stringify(arr))</code></li>
<li>不论数组元素是什么类型，原始数组和目标数组的修改都会互不影响</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 浅拷贝</span></span><br><span class="line"><span class="keyword">var</span> shallowCopy = <span class="keyword">function</span> (<span class="params">obj</span>) &#123; </span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span>; </span><br><span class="line">  <span class="keyword">var</span> newObj = obj <span class="keyword">instanceof</span> <span class="title class_">Array</span> ? [] : &#123;&#125;; </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">      newObj[key] = obj[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 深拷贝</span></span><br><span class="line"><span class="keyword">var</span> deepCopy = <span class="keyword">function</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> newObj = obj <span class="keyword">instanceof</span> <span class="title class_">Array</span> ? [] : &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">      newObj[key] = <span class="keyword">typeof</span> obj[key] === <span class="string">&#x27;object&#x27;</span> ? <span class="title function_">deepCopy</span>(obj[key]) : obj[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="特殊数组"><a href="#特殊数组" class="headerlink" title="特殊数组"></a>特殊数组</h2><ul>
<li>多维数组：元素是数组</li>
<li>稀疏数组：索引不连续，length值大于实际元素个数</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 二维数组</span></span><br><span class="line"><span class="keyword">var</span> arr = [ [<span class="number">1</span>, <span class="number">2</span>], [<span class="number">1</span>, ‘good’] ]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 稀疏数组</span></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line">arr[<span class="number">20</span>] = <span class="string">&quot;hello&quot;</span>;</span><br></pre></td></tr></table></figure>


<h2 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h2><ol>
<li>基础<br>* 读写：<code>索引/属性</code><br>* 添加：<code>arr[index] = new</code><br>* 删除：<code>delete arr[index]</code><br>* 遍历：<code>for</code></li>
<li>ES3<br>* 添加：<code>push、unshift、concat</code><br>* 删除：<code>pop、shift</code><br>* 裁剪：<code>slice、splice</code><br>* 排序：<code>sort、reverse</code><br>* 转换：<code>join、toString</code></li>
<li>ES5<br>* 位置：<code>indexOf、lastIndexOf</code><br>* 迭代：<code>every、some、filter、forEach、map</code><br>* 累计：<code>reduce</code></li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 元素读写</span></span><br><span class="line"> <span class="keyword">var</span> arr = [<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br><span class="line"> consloe.<span class="title function_">log</span>(arr.<span class="property">length</span>)</span><br><span class="line"> consloe.<span class="title function_">log</span>(arr[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"> arr[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"> arr[-<span class="number">1.23</span>] = <span class="literal">true</span>  <span class="comment">// 超出范围时就不是索引，而是属性</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 判断是否数组</span></span><br><span class="line"> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(arr)   </span><br><span class="line"> arr <span class="keyword">instanceof</span> <span class="title class_">Array</span></span><br><span class="line"> arr.<span class="property">constructor</span> === <span class="title class_">Array</span></span><br><span class="line"> arr.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">apply</span>([<span class="title class_">Array</span>])</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 判断元素         </span></span><br><span class="line"> arr.<span class="title function_">every</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">     <span class="keyword">return</span> item &gt; <span class="number">5</span></span><br><span class="line"> &#125;) </span><br><span class="line"></span><br><span class="line"> <span class="comment">// 排序</span></span><br><span class="line">arr.<span class="title function_">sort</span>(<span class="keyword">function</span>(<span class="params">a, b</span>)&#123; </span><br><span class="line">     <span class="keyword">return</span> a-b</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 遍历</span></span><br><span class="line"> arr.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">value, index, arr</span>)&#123; &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 映射返回新数组，原数组不改变</span></span><br><span class="line"> arr.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">value, index, arr</span>)&#123; </span><br><span class="line">     <span class="keyword">return</span> value * <span class="number">2</span>    </span><br><span class="line"> &#125;)</span><br><span class="line"> arr.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item + <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 过滤不符合条件的元素</span></span><br><span class="line"> arr.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">value, index</span>)&#123; </span><br><span class="line">     <span class="keyword">return</span> value % <span class="number">2</span> !== <span class="number">0</span></span><br><span class="line"> &#125;)          </span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 累计</span></span><br><span class="line"> <span class="keyword">const</span> <span class="title function_">count</span> = arr =&gt; &#123;</span><br><span class="line">     <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">pre, cur</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> pre + cur</span><br><span class="line">     &#125;, <span class="number">0</span>) </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


<h2 id="扩展方法-1"><a href="#扩展方法-1" class="headerlink" title="扩展方法"></a>扩展方法</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 最大值</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">max</span>(...arr)</span><br><span class="line"><span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, arr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最小值</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">min</span>(...arr)</span><br><span class="line"><span class="title class_">Math</span>.<span class="property">min</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, arr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组去重</span></span><br><span class="line">[...<span class="keyword">new</span> <span class="title class_">Set</span>(arr)]  </span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="keyword">new</span> <span class="title class_">Set</span>(arr))   <span class="comment">// Set 有元素唯一的特性</span></span><br></pre></td></tr></table></figure>
<h1 id="四、Base64"><a href="#四、Base64" class="headerlink" title="四、Base64"></a>四、Base64</h1><h2 id="使用原因"><a href="#使用原因" class="headerlink" title="使用原因"></a>使用原因</h2><ul>
<li><strong>字节</strong>：存储二进制数据的基本单位，可表示的范围是 0～255 (十六进制：0x00～0xFF)，其中 ASCII 值的范围为 0～127 (十六进制：0x00～0x7F)，而超过 ASCII 范围的 128～255 (十六进制：0x80 ～ 0xFF) 之间的值是不可见字符。</li>
<li><strong>ASCII</strong>：美国信息交换标准代码) 是基于拉丁字母的一套电脑编码系统，主要用于显示现代英语，其扩展版本可以部分支持其他西欧语言。其中 0～31、127 是控制字符(33 个)，32～126 是可打印字符(95 个)。</li>
<li><strong>传输问题</strong>：当不可见字符在网络上传输时一般需要经过多个路由设备，但是不同设备对字符的处理方式有些不同而可能导致字符被处理错误，常见的有中文乱码、图片失败等。</li>
</ul>
<h2 id="base64-简介"><a href="#base64-简介" class="headerlink" title="base64 简介"></a>base64 简介</h2><ul>
<li><strong>base64</strong>：基于 64 个可打印字符 <code>A-Z、a-z、0-9、+、/</code> 来表示二进制数据的一种方法。常用于处理文本数据的场合，表示、传输、存储一些二进制数据，包括 MIME 电子邮件、XML 复杂数据。</li>
<li><strong>编码规则</strong>：一种将二进制序列的数据转换为字符串的算法，只是无法直接看到明文但并非加密。中文通过 utf-8、gbk 等编码方式获取不同结果，图像和文本等转换为二进制序列后才能进行 Base64 编码。</li>
<li><strong>base64 编码</strong>：由于 2⁶ &#x3D; 64，所以每 6 个比特为一个单元并对应某个可打印字符。3 个字节有 24 个比特并对应 4 个 base64 单元，即 3 个字节可由 4 个可打印字符来表示并对应 24 个二进制位。</li>
</ul>
<h2 id="图片应用"><a href="#图片应用" class="headerlink" title="图片应用"></a>图片应用</h2><blockquote>
<p>base64Url 字符串作为图片地址、图片上传时一般使用截取 <code>data:image/png;base64</code> 的纯字符串。编码后的数据体积一般会变大，浏览器不会缓存 base64Url 图片而需要每次访问页面时下载一次，所以不适合大量使用和复杂图片。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@title</span> 图片预览</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@method</span> changeImg        图片选中：获取 file 对象</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@method</span> fileReader       图片读取：file 转 base64</span></span><br><span class="line"><span class="comment">  * &lt;input type=&quot;file&quot; accept=&quot;image/*&quot; capture=&quot;camera&quot; </span></span><br><span class="line"><span class="comment">    <span class="doctag">@change</span>=&quot;changeImg&quot; /&gt;</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">async</span> changeImg (e) &#123;</span><br><span class="line">    <span class="keyword">let</span> file = e.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">let</span> base64Img = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">fileReader</span>(file);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="keyword">async</span> clickImg () &#123;</span><br><span class="line">    <span class="keyword">let</span> base64Img = <span class="title function_">getBase64Image</span>(<span class="string">&quot;./pic.png&quot;</span>, <span class="number">0.8</span>);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 图片文件</span></span><br><span class="line">fileReader (file, maxSize) &#123;</span><br><span class="line">    <span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">    reader.<span class="title function_">readAsDataURL</span>(file);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span></span><br><span class="line">        (reader.<span class="property">onloadend</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(reader.<span class="property">result</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// Base64 格式</span></span><br><span class="line">getBase64Img (url, quality = <span class="number">0.5</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">src</span> = url</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        img.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">            canvas.<span class="property">width</span> = img.<span class="property">width</span>;</span><br><span class="line">            canvas.<span class="property">height</span> = img.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">            ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, img.<span class="property">width</span>, img.<span class="property">height</span>);</span><br><span class="line">            dataURL = canvas.<span class="title function_">toDataURL</span>(<span class="string">&#x27;image/png&#x27;</span>, quality);</span><br><span class="line">            <span class="title function_">resolve</span>(dataURL)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式转换</span></span><br><span class="line">dataUrlToBlob (dataurl, mimeType = <span class="string">&#x27;text/plain&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> bytes = <span class="variable language_">window</span>.<span class="title function_">atob</span>(dataurl.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">let</span> ab = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(bytes.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">let</span> ia = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(ab);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; bytes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        ia[i] = bytes.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Blob</span>([ab], &#123; <span class="attr">type</span>: mimeType &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">dataUrlToFile (dataurl, filename = <span class="string">&#x27;file.txt&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = dataurl.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>),</span><br><span class="line">    mime = arr[<span class="number">0</span>].<span class="title function_">match</span>(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>],</span><br><span class="line">    bstr = <span class="title function_">atob</span>(arr[<span class="number">1</span>]),</span><br><span class="line">    n = bstr.<span class="property">length</span>,</span><br><span class="line">    u8arr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(n);</span><br><span class="line">    <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">        u8arr[n] = bstr.<span class="title function_">charCodeAt</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">File</span>([u8arr], filename, &#123; <span class="attr">type</span>: mime &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="编码解码"><a href="#编码解码" class="headerlink" title="编码解码"></a>编码解码</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原生 API：编码、解码、中文编码时需要先进行 URI 组件编码</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">btoa</span>(<span class="string">&#x27;xiaomabuhei&#x27;</span>)     </span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">atob</span>(<span class="string">&#x27;eGlhb21hYnVoZWk=&#x27;</span>)  </span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">btoa</span>(<span class="variable language_">window</span>.<span class="built_in">encodeURIComponent</span>(<span class="string">&#x27;小黑马&#x27;</span>))</span><br><span class="line"><span class="variable language_">window</span>.<span class="built_in">decodeURIComponent</span>(<span class="variable language_">window</span>.<span class="title function_">atob</span>(baseStr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装 JS</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Base64</span> = &#123;</span><br><span class="line">  <span class="attr">_keyStr</span>: <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">encode</span>: <span class="keyword">function</span>(<span class="params">input</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> output = <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    <span class="keyword">var</span> chr1, chr2, chr3, enc1, enc2, enc3, enc4;  </span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;  </span><br><span class="line">    input = <span class="title class_">Base64</span>.<span class="title function_">_utf8_encode</span>(input);  </span><br><span class="line">    <span class="keyword">while</span> (i &lt; input.<span class="property">length</span>) &#123;  </span><br><span class="line">        chr1 = input.<span class="title function_">charCodeAt</span>(i++);  </span><br><span class="line">        chr2 = input.<span class="title function_">charCodeAt</span>(i++);  </span><br><span class="line">        chr3 = input.<span class="title function_">charCodeAt</span>(i++);  </span><br><span class="line">        enc1 = chr1 &gt;&gt; <span class="number">2</span>;  </span><br><span class="line">        enc2 = ((chr1 &amp; <span class="number">3</span>) &lt;&lt; <span class="number">4</span>) | (chr2 &gt;&gt; <span class="number">4</span>);  </span><br><span class="line">        enc3 = ((chr2 &amp; <span class="number">15</span>) &lt;&lt; <span class="number">2</span>) | (chr3 &gt;&gt; <span class="number">6</span>);  </span><br><span class="line">        enc4 = chr3 &amp; <span class="number">63</span>;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isNaN</span>(chr2)) &#123;  </span><br><span class="line">            enc3 = enc4 = <span class="number">64</span>;  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">isNaN</span>(chr3)) &#123;  </span><br><span class="line">            enc4 = <span class="number">64</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        output = output +  </span><br><span class="line">        _keyStr.<span class="title function_">charAt</span>(enc1) + _keyStr.<span class="title function_">charAt</span>(enc2) +  </span><br><span class="line">        _keyStr.<span class="title function_">charAt</span>(enc3) + _keyStr.<span class="title function_">charAt</span>(enc4);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> output; </span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">decode</span>: <span class="keyword">function</span>(<span class="params">input</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> output = <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    <span class="keyword">var</span> chr1, chr2, chr3;  </span><br><span class="line">    <span class="keyword">var</span> enc1, enc2, enc3, enc4;  </span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;  </span><br><span class="line">    input = input.<span class="title function_">replace</span>(<span class="regexp">/[^A-Za-z0-9\+\/\=]/g</span>, <span class="string">&quot;&quot;</span>);  </span><br><span class="line">    <span class="keyword">while</span> (i &lt; input.<span class="property">length</span>) &#123;  </span><br><span class="line">        enc1 = _keyStr.<span class="title function_">indexOf</span>(input.<span class="title function_">charAt</span>(i++));  </span><br><span class="line">        enc2 = _keyStr.<span class="title function_">indexOf</span>(input.<span class="title function_">charAt</span>(i++));  </span><br><span class="line">        enc3 = _keyStr.<span class="title function_">indexOf</span>(input.<span class="title function_">charAt</span>(i++));  </span><br><span class="line">        enc4 = _keyStr.<span class="title function_">indexOf</span>(input.<span class="title function_">charAt</span>(i++));  </span><br><span class="line">        chr1 = (enc1 &lt;&lt; <span class="number">2</span>) | (enc2 &gt;&gt; <span class="number">4</span>);  </span><br><span class="line">        chr2 = ((enc2 &amp; <span class="number">15</span>) &lt;&lt; <span class="number">4</span>) | (enc3 &gt;&gt; <span class="number">2</span>);  </span><br><span class="line">        chr3 = ((enc3 &amp; <span class="number">3</span>) &lt;&lt; <span class="number">6</span>) | enc4;  </span><br><span class="line">        output = output + <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(chr1);  </span><br><span class="line">        <span class="keyword">if</span> (enc3 != <span class="number">64</span>) &#123;  </span><br><span class="line">            output = output + <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(chr2);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (enc4 != <span class="number">64</span>) &#123;  </span><br><span class="line">            output = output + <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(chr3);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    output = <span class="title class_">Base64</span>.<span class="title function_">_utf8_decode</span>(output);  </span><br><span class="line">    <span class="keyword">return</span> output;  </span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">_utf8_encode</span>: <span class="keyword">function</span>(<span class="params">string</span>) &#123;</span><br><span class="line">    string = string.<span class="title function_">replace</span>(<span class="regexp">/\r\n/g</span>, <span class="string">&quot;\n&quot;</span>);  </span><br><span class="line">    <span class="keyword">var</span> utftext = <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; string.<span class="property">length</span>; n++) &#123;  </span><br><span class="line">        <span class="keyword">var</span> c = string.<span class="title function_">charCodeAt</span>(n);  </span><br><span class="line">        <span class="keyword">if</span> (c &lt; <span class="number">128</span>) &#123;  </span><br><span class="line">            utftext += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(c);  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>((c &gt; <span class="number">127</span>) &amp;&amp; (c &lt; <span class="number">2048</span>)) &#123;  </span><br><span class="line">            utftext += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((c &gt;&gt; <span class="number">6</span>) | <span class="number">192</span>);  </span><br><span class="line">            utftext += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((c &amp; <span class="number">63</span>) | <span class="number">128</span>);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            utftext += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((c &gt;&gt; <span class="number">12</span>) | <span class="number">224</span>);  </span><br><span class="line">            utftext += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(((c &gt;&gt; <span class="number">6</span>) &amp; <span class="number">63</span>) | <span class="number">128</span>);  </span><br><span class="line">            utftext += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((c &amp; <span class="number">63</span>) | <span class="number">128</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line"></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> utftext; </span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">_utf8_decode</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> string = <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">var</span> c = c1 = c2 = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">while</span> ( i &lt; utftext.<span class="property">length</span> ) &#123;  </span><br><span class="line">        c = utftext.<span class="title function_">charCodeAt</span>(i);  </span><br><span class="line">        <span class="keyword">if</span> (c &lt; <span class="number">128</span>) &#123;  </span><br><span class="line">            string += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(c);  </span><br><span class="line">            i++;  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>((c &gt; <span class="number">191</span>) &amp;&amp; (c &lt; <span class="number">224</span>)) &#123;  </span><br><span class="line">            c2 = utftext.<span class="title function_">charCodeAt</span>(i+<span class="number">1</span>);  </span><br><span class="line">            string += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(((c &amp; <span class="number">31</span>) &lt;&lt; <span class="number">6</span>) | (c2 &amp; <span class="number">63</span>));  </span><br><span class="line">            i += <span class="number">2</span>;  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            c2 = utftext.<span class="title function_">charCodeAt</span>(i+<span class="number">1</span>);  </span><br><span class="line">            c3 = utftext.<span class="title function_">charCodeAt</span>(i+<span class="number">2</span>);  </span><br><span class="line">            string += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(((c &amp; <span class="number">15</span>) &lt;&lt; <span class="number">12</span>) | ((c2 &amp; <span class="number">63</span>) &lt;&lt; <span class="number">6</span>) | (c3 &amp; <span class="number">63</span>));  </span><br><span class="line">            i += <span class="number">3</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> string;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="五、二进制对象"><a href="#五、二进制对象" class="headerlink" title="五、二进制对象"></a>五、二进制对象</h1><div style="text-indent: 2em">JS 最初无法处理文件、网络流等二进制编码格式的数据，只能先使用 charCodeAt() 逐字节读取或转换为 Base64 格式，但是处理速度慢而且容易出错。JS 后来通过引入 API 可以处理二进制数据但没有标准，所以 Web、NodeJS 各自处理而导致二进制处理方式有些不同。</div> 

<ul>
<li><strong>Blob</strong>：Web 一个专门用于支持文件操作的二进制对象。</li>
<li><strong>ArrayBuffer</strong>：Web Node 通用的二进制缓冲区，只读的类数组对象。</li>
<li><strong>Buffer</strong>：NodeJS 提供的一个二进制缓冲区，常用来处理 I&#x2F;O 操作。</li>
</ul>
<h2 id="Web-Node-通用"><a href="#Web-Node-通用" class="headerlink" title="Web Node 通用"></a>Web Node 通用</h2><ul>
<li><strong>ArrayBuffer</strong>：表示内存中存储了一段二进制数据的缓冲区对象，本质是一串数字组成的乱码而且没有格式。它不能直接被操作，只能通过 TypedArray、DataView 进行读写。</li>
<li><strong>TypedArray</strong>：数据类型相同而且没有空位的类数组对象，本质是二进制数据的抽象数据结构，用于以指定格式读写二进制数据但本身并不存储。主要包括三类视图：有符号整数 (Int8Array、Int16Array、Int32Array)、无符号整数 (Uint8Array、Uint16Array、Uint32Array)、浮点数 (Float32Array、Float64Array)。<br>  <strong>DataView</strong>：TypedArray 的强化版视图，成员可以是不同的数据类型，而且读写时可以自行设定大小端字节序。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、ArrayBuffer：创建、裁剪</span></span><br><span class="line"><span class="keyword">let</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>)    </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buffer.<span class="property">byteLength</span>)     <span class="comment">// 8 字节  </span></span><br><span class="line"><span class="title class_">ArrayBuffer</span>.<span class="title function_">isView</span>(buffer)         <span class="comment">// 是否为视图实例</span></span><br><span class="line"><span class="keyword">let</span> buffer1 = buffer.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">1</span>)   <span class="comment">// 裁剪缓冲区</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、TypedArray：直接创建、buffer 转换、操作元素</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="keyword">new</span> <span class="title class_">Float64Array</span>(<span class="number">8</span>)</span><br><span class="line"><span class="keyword">let</span> u = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buffer, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i &lt; f.<span class="property">byteLength</span>; i++)&#123; &#125;</span><br><span class="line"><span class="comment">// 与普通数组互转</span></span><br><span class="line"><span class="keyword">let</span> _f = <span class="title class_">Array</span>.<span class="title function_">from</span>(f)</span><br><span class="line"><span class="keyword">let</span> _u = <span class="title class_">Array</span>.<span class="title function_">apply</span>([], u)</span><br><span class="line"><span class="keyword">let</span> u = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="comment">// 与字符串互转</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="title class_">String</span>.<span class="property">fromCharCode</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, buffer)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">strToBuf</span> (str) &#123;</span><br><span class="line">    <span class="comment">// 每个字符占用 2 个字节</span></span><br><span class="line">    <span class="keyword">let</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(str.<span class="property">length</span>*<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">let</span> bufView = <span class="keyword">new</span> <span class="title class_">Uint16Array</span>(buf)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i &lt; str.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        bufView[i] = str.<span class="title function_">charCodeAt</span>(i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bufView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、DataView：独有方法写入参数为 开始位置、写入数据、大/小端读取</span></span><br><span class="line"><span class="keyword">let</span> dataView = <span class="keyword">new</span> <span class="title class_">DataView</span>(buffer)</span><br><span class="line">dataView.<span class="title function_">getInt8</span>(<span class="number">0</span>)</span><br><span class="line">dataView.<span class="title function_">setInt8</span>(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">dataView.<span class="title function_">setInt32</span>(<span class="number">0</span>, <span class="number">25</span>, <span class="literal">false</span>) </span><br></pre></td></tr></table></figure>

<h2 id="web-环境特有"><a href="#web-环境特有" class="headerlink" title="web 环境特有"></a>web 环境特有</h2><ul>
<li><p><strong>Blob 对象</strong>：表示一个不可变的文件对象，它提供了一系列操作文件的接口。</p>
</li>
<li><p><strong>Blob 功能</strong></p>
<ul>
<li>文件下载：通过 URL.createObjectURL(blob) 生成 blobUrl 赋值给 a.download。</li>
<li>图片展示：通过 URL.createObjectURL(blob) 生成 blobUrl 赋值给 img.src。</li>
<li>分片上传：通过 blob.slice 分割二进制数据上传。</li>
<li>文件读取：通过 FileReader 将 blob&#x2F;flie 转化为文本。</li>
</ul>
</li>
<li><p><strong>Blob 派生对象</strong>：继承于底层对象 blob 并进行了扩展，但其内容一样无法修改。</p>
<ul>
<li><strong>File 对象</strong>：保存文件的相关信息并允许 Js 访问。主要包括：input 元素选择文件后返回的 FileList 对象、普通元素被拖拽时返回的 DataTransfer 对象、HTMLCanvasElement 执行 mozGetAsFile() 方法后的返回结果。</li>
<li><strong>FileReader 对象</strong>：提供了异步读取文件或二进制数据并保存到 result 属性的接口：readAsText、readAsDataURL、readAsBinaryString、readAsArrayBuffer。</li>
<li><strong>URL 对象</strong>：通过内存文件创建出一个临时指向 File&#x2F;Blob 对象的 url。注意：网页刷新或关闭会导致 url 失效、同样的 blob 在不同的事件调用中会得到不同 url。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 1、Blob 对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 创建：new Blob(二进制对象或字符串的数组, 数据类型)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> 裁剪：blob.slice(start, end, contentType)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> canvas.toBlob(callback, type, options)</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="string">&quot;Hello World&quot;</span>], &#123;<span class="attr">type</span>:<span class="string">&quot;text/plain&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>)</span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([buffer], &#123;<span class="attr">type</span>:<span class="string">&quot;text/plain&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> uArr = <span class="keyword">new</span> <span class="title class_">Uint16Array</span>([<span class="number">97</span>, <span class="number">32</span>, <span class="number">72</span>, <span class="number">100</span>]);</span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([uArr]);</span><br><span class="line"></span><br><span class="line">blob.<span class="title function_">slice</span>(<span class="number">1</span>, <span class="number">5</span>)   <span class="comment">// 裁剪并返回新对象</span></span><br><span class="line">blob.<span class="title function_">close</span>()       <span class="comment">// 释放对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">canvas.<span class="title function_">toBlob</span>(<span class="keyword">function</span>(<span class="params">blob</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(blob)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">blobToFile</span> (blob, fileName) &#123;</span><br><span class="line">    blob.<span class="property">lastModifiedDate</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    blob.<span class="property">name</span> = fileName;</span><br><span class="line">    <span class="keyword">return</span> blob;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、File 对象：选择文件后获取文件信息、拖动结束时获取拖动数据</span></span><br><span class="line"><span class="keyword">var</span> fileInput = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#fileInput&quot;</span>);</span><br><span class="line">fileInput.<span class="title function_">addEventListener</span>(<span class="string">&quot;change&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> fileList = fileInput.<span class="property">files</span></span><br><span class="line">    <span class="keyword">var</span> file = fileList[<span class="number">0</span>];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(file.<span class="property">name</span>, file.<span class="property">size</span>)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> box = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;#box&quot;</span>);</span><br><span class="line">box.<span class="property">ondrop</span> = <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="comment">// 拖动的默认处理方式是在新窗口打开</span></span><br><span class="line">    event.<span class="title function_">preventDefault</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">dataTransfer</span>.<span class="property">files</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 3、FileReader 读取数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> readAsText(file, encoding)：返回纯文本，编码格式默认 UTF-8</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> readAsDataURL(file)：返回 Base64 编码的 dataURL 字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> readAsBinaryString(file)：返回原始二进制字符串（每个字符表示一字节）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> readAsArrayBuffer(file)：返回包含文件内容的 ArrayBuffer 对象</span></span><br><span class="line"><span class="comment"> **/</span> </span><br><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">reader.<span class="title function_">readAsArrayBuffer</span>(file);</span><br><span class="line"></span><br><span class="line">reder.<span class="property">onprogress</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;      <span class="comment">// 更新</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(reader.<span class="property">result</span>)  </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">result</span>)</span><br><span class="line">&#125;</span><br><span class="line">reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;         <span class="comment">// 成功</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(reader.<span class="property">result</span>)  </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">result</span>)</span><br><span class="line">&#125;</span><br><span class="line">reader.<span class="property">onloadstart</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; &#125;  <span class="comment">// 开始</span></span><br><span class="line">reader.<span class="property">onloadend</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; &#125;    <span class="comment">// 完成</span></span><br><span class="line">reader.<span class="property">onabort</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; &#125;      <span class="comment">// 中止</span></span><br><span class="line">reader.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; &#125;      <span class="comment">// 出错</span></span><br><span class="line">reader.<span class="title function_">abort</span>() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、URL 对象：在网页插入图片</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">img.<span class="property">src</span> = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(file);   <span class="comment">// 生成</span></span><br><span class="line">img.<span class="property">width</span> = <span class="number">60</span>;</span><br><span class="line">img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">revokeObjectURL</span>(<span class="variable language_">this</span>.<span class="property">src</span>);     <span class="comment">// 释放</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(img);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Node-环境特有"><a href="#Node-环境特有" class="headerlink" title="Node 环境特有"></a>Node 环境特有</h2><blockquote>
<p>Buffer 表示 V8 堆内存之外的一块原始内存，并不会占用 NodeJS 进程内存，常用来存储需要占用大量内存的数据。它继承于 Uint8Array 并实现了更多的接口，对象中的每个元素储存着 2 位 16 进制的数据，代表内存的一个字节。注意一个 Buffer 对象的大小在创建时就会固定下来，即创建之后不可改变。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> 创建</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> new Buffer：已弃用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Buffer.from：参数可为 string、buffer、array、object</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Buffer.alloc：指定大小并已经初始化数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@prame</span> Buffer.allocUnsafe：指定大小但并不初始化数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>([<span class="number">0x62</span>, <span class="number">0x75</span>, <span class="number">0x66</span>]);</span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">5</span>, <span class="string">&#x27;aG8Q=&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">allocUnsafe</span>(<span class="number">10</span>);  <span class="comment">// 一个参数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="property">length</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断</span></span><br><span class="line"><span class="title class_">Buffer</span>.<span class="title function_">isBuffer</span>(buf);           <span class="comment">// 是否 buffer 对象     </span></span><br><span class="line"><span class="title class_">Buffer</span>.<span class="title function_">isEncoding</span>(<span class="string">&#x27;base64&#x27;</span>);    <span class="comment">// 是否支持指定编码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作</span></span><br><span class="line">buf.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">buf.<span class="title function_">compare</span>(_buf)</span><br><span class="line">buf.<span class="title function_">copy</span>(buf, <span class="number">2</span>)</span><br><span class="line">buf.<span class="title function_">indexOf</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">buf.<span class="title function_">fill</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"><span class="title class_">Buffer</span>.<span class="title function_">concat</span>([buf, buf])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读写</span></span><br><span class="line"><span class="keyword">var</span> value = buf.<span class="title function_">readInt32LE</span>(<span class="number">0</span>)</span><br><span class="line">buf.<span class="title function_">writeFloatLE</span>(<span class="number">3.</span> <span class="number">16</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换</span></span><br><span class="line">buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">buf.<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>)             <span class="comment">// test</span></span><br><span class="line">buf.<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>, <span class="number">0</span>, <span class="number">2</span>)       <span class="comment">// te</span></span><br><span class="line">buf.<span class="title function_">toJSON</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// stream 转 buffer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">streamToBuffer</span>(<span class="params">stream</span>) &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> buffers = [];</span><br><span class="line">        stream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, reject);</span><br><span class="line">        stream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> buffers.<span class="title function_">push</span>(data))</span><br><span class="line">        stream.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="title class_">Buffer</span>.<span class="title function_">concat</span>(buffers)))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// buffer 转 stream</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Duplex</span> = <span class="built_in">require</span>(<span class="string">&#x27;stream&#x27;</span>).<span class="property">Duplex</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bufferToStream</span>(<span class="params">buffer</span>) &#123;  </span><br><span class="line">    <span class="keyword">let</span> stream = <span class="keyword">new</span> <span class="title class_">Duplex</span>();</span><br><span class="line">    stream.<span class="title function_">push</span>(buffer);</span><br><span class="line">    stream.<span class="title function_">push</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> stream;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>JS 主要内容</title>
    <url>/2019/05/15/4-1-js%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="一、Javascript"><a href="#一、Javascript" class="headerlink" title="一、Javascript"></a>一、Javascript</h1><blockquote>
<p>JavaScript 由对象组成，一切皆为对象</p>
</blockquote>
<h2 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h2><ul>
<li><strong>ECMAScript</strong>：核心，描述了JS的语法和基本对象</li>
<li><strong>DOM</strong>：文档对象模型，处理网页内容的方法和接口</li>
<li><strong>BOM</strong>：浏览器对象模型，与浏览器交互的方法和接口</li>
</ul>
<h2 id="语言特点"><a href="#语言特点" class="headerlink" title="语言特点"></a>语言特点</h2><ul>
<li>解释型的脚本语言：在程序的运行过程中逐行进行解释</li>
<li>语法简单：使用弱类型的变量，对数据类型也没有严格要求</li>
<li>事件驱动：通过事件对用户操作做出响应</li>
<li>跨平台性：不依赖于操作系统，只需要兼容浏览器即可</li>
</ul>
<h2 id="历史演变"><a href="#历史演变" class="headerlink" title="历史演变"></a>历史演变</h2><ul>
<li>始于1995年，前身为网景公司开发的 LiveScript，用来处理 以前由服务端负责的数据验证</li>
<li>后更名为JavaScript，功能演变为：前后端数据交互、页面特效、服务端开发 NodeJS</li>
<li>JS 的很多语法和 Java、C# 语法相似，和 Java 毫无关系</li>
</ul>
<h1 id="二、ECMAScript"><a href="#二、ECMAScript" class="headerlink" title="二、ECMAScript"></a>二、ECMAScript</h1><blockquote>
<p>一种根据 ECMA-262 标准制定的通用脚本语言规范，JavaScript 是遵守该标准实现的一种脚本语言</p>
</blockquote>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3><ul>
<li>方法：匈牙利命名法、驼峰命名法</li>
<li>规则<ul>
<li>首字符：英文字母、下划线</li>
<li>组成：英文字母、下划线、数字</li>
<li>禁忌：关键字、保留字</li>
</ul>
</li>
</ul>
<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><ul>
<li>显式声明：<code>var 变量名</code></li>
<li>错误用法：没有类型、重复声明、隐式声明、不声明直接使用</li>
<li>正确用法：先声明后读写、先赋值后运算</li>
</ul>
<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><ol>
<li>全局变量</li>
</ol>
<ul>
<li>包含：在函数外定义的变量，没有使用 var 的变量</li>
<li>调用：任何位置</li>
</ul>
<ol start="2">
<li>局部变量</li>
</ol>
<ul>
<li>包含：在函数内使用 var 声明的变量，函数的参数变量</li>
<li>调用：当前函数体内</li>
</ul>
<ol start="3">
<li>优先级</li>
</ol>
<ul>
<li>局部变量 &gt; 同名参数变量 &gt; 同名全局变量</li>
</ul>
<ol start="4">
<li>特性</li>
</ol>
<ul>
<li>忽略块级用域<ul>
<li>ES6之前，js的作用域只有 函数作用域和全局作用域</li>
<li>ES6中定义了块级作用域，有“暂时性死区”的特性（声明前不可用）</li>
</ul>
</li>
<li>作用域链<ul>
<li>内层函数可以访问外层函数的局部变量</li>
<li>外层函数不能访问内层函数的局部变量<br>生命周期</li>
<li>全局变量除非被显式删除，否则一直存在</li>
<li>局部变量从声明开始到函数运行完毕或被显式删除</li>
<li>回收机制有 标记清除、引用计数</li>
</ul>
</li>
</ul>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="attr">say</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(say)</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">say</span>()   <span class="comment">// 报错，没有在函数作用域内创建 fn</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a);   <span class="comment">// 2，遵循就近原则</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a);   <span class="comment">// undefined，变量提升</span></span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test2</span>(); </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test3</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a);   <span class="comment">// 1，重新赋值而未重新声明</span></span><br><span class="line">  a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test3</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test4</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(b); <span class="comment">// 报错，let 不能变量提升</span></span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test4</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test5</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">  &#123; <span class="keyword">let</span> a = <span class="number">2</span>; &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a);  <span class="comment">// 1，console不在块级作用域中</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test5</span>();</span><br></pre></td></tr></table></figure>


<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><blockquote>
<p>分为原始数据和引用数据，js 变量的类型会根据其所赋值的数据类型来决定</p>
</blockquote>
<h3 id="基本数据"><a href="#基本数据" class="headerlink" title="基本数据"></a>基本数据</h3><ul>
<li>即原始值：<code>Number、String、Boolean、undefined、Null、symbol、BigInt</code></li>
<li>6 个假值：<code>0、&quot; &quot;、undefined、null、NaN、false</code></li>
<li>存储方式：存储在栈中的简单数据段。js 可按值访问其实际保存的值，复制时则会创建其副本。</li>
<li>检测方法：<code>typeof</code></li>
</ul>
<h3 id="引用数据"><a href="#引用数据" class="headerlink" title="引用数据"></a>引用数据</h3><ul>
<li>即引用值：<code>Object</code></li>
<li>检测方法：<code>instanceof</code></li>
<li>存储方式：存储在堆中的对象。js按引用访问其值，即访问时先从栈中读取内存地址（大小固定，保存于栈中），然后再找到保存在堆内存中的值。复制时只是复制了地址，两个对象实际指向的都是同一个值。</li>
</ul>
<h3 id="栈和堆"><a href="#栈和堆" class="headerlink" title="栈和堆"></a>栈和堆</h3><ul>
<li><strong>栈 stack</strong>：可理解为一个无盖水缸，它会自动分配内存空间和释放。用于存储基本数据类型，具有空间大小固定和先进后出的特点。</li>
<li><strong>堆 heap</strong>：可理解为封闭盒子，动态分配内存，大小不固定而且不会自动释放。用于存储基本数据类型包装起来的类，实际上保存的不是变量本身，而是指向该对象的指针。</li>
</ul>
<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><ul>
<li>强制转换：<code>Boolean()、Number()、String()</code></li>
<li>普通转换：<code>parseInt()、parseFloat()、num.toString()</code></li>
</ul>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><ul>
<li>算术运算符：<code>+、-、*、/、%、++、--</code></li>
<li>赋值运算符：<code>=、+=、-=、*=、/=</code></li>
<li>字符串运算符：<code>+、+=</code></li>
<li>比较运算符：<code>&gt;、&lt;、&gt;=、&lt;=、==、!=、===、!==</code></li>
<li>逻辑运算符：<code>&amp;&amp;、||、!</code></li>
<li>三元运算符：<code>?:</code></li>
</ul>
<h2 id="流程语句"><a href="#流程语句" class="headerlink" title="流程语句"></a>流程语句</h2><h3 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h3><ul>
<li>while：<code>while(条件表达式) &#123; 代码段 &#125;</code></li>
<li>do-while：<code>do&#123; 代码段 &#125; while(条件表达式)</code></li>
<li>for：<code>for(循环变量 = 初值; 循环条件; 递增/递减)&#123; 代码段 &#125;</code></li>
<li>for-in：<code>for(声明变量 in 对象)&#123; 代码段 &#125;</code></li>
</ul>
<h3 id="跳转语句"><a href="#跳转语句" class="headerlink" title="跳转语句"></a>跳转语句</h3><ul>
<li>return：终止函数体的运行，并返回一个 值</li>
<li>break：终止整个循环，不再判断</li>
<li>continue：结束本次循环，判断是否执行下次循环</li>
</ul>
<h3 id="选择语句"><a href="#选择语句" class="headerlink" title="选择语句"></a>选择语句</h3><ul>
<li>if：<code>if(条件1)&#123; &#125; else if(条件2)&#123; &#125; else&#123; &#125;</code></li>
<li>switch：<code>switch(条件)&#123; case 1: break; default: break; &#125;</code></li>
<li>三元表达式：<code>var res = x&gt;0 ? 1 : (x=0 ? -1 : 2)</code></li>
</ul>
<h3 id="异常处理语句"><a href="#异常处理语句" class="headerlink" title="异常处理语句"></a>异常处理语句</h3><ul>
<li>throw：主动抛出异常</li>
<li>try：指明需要处理的代码段</li>
<li>catch：捕获异常</li>
<li>finally：后期处理</li>
</ul>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><blockquote>
<p>一段可以反复调用的代码块</p>
</blockquote>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul>
<li>普通函数</li>
<li>函数对象：通过 new Function() 创建的对象。</li>
<li>构造函数：类的标示 (class 是其语法糖)，为初始化的对象添加属性和方法。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、普通函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>)&#123;  &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式    </span></span><br><span class="line"><span class="keyword">var</span> f2 = <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调函数 callback：特定条件下调用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">num, callback</span>)&#123;   </span><br><span class="line">  <span class="keyword">if</span>(num == <span class="number">3</span>)&#123;</span><br><span class="line">      <span class="title function_">callback</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自执行函数 IIFE：独立作用域而不会污染全局环境</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params">x, y</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x + y);</span><br><span class="line">&#125;)(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">;(<span class="keyword">function</span>(<span class="params"></span>)&#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、函数对象</span></span><br><span class="line"><span class="keyword">var</span> f4 = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;console.log(str)&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、构造函数：首字母大写</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>)&#123; </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">// return 基本类型则被忽略</span></span><br><span class="line">  <span class="comment">// return &#123; &#x27;Jack&#x27;: 18 &#125;; // return 引用类型则被返回</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eat</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;;  </span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>


<h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><ul>
<li>函数模式：<code>fn()</code></li>
<li>方法模式：<code>obj.fn()、绑定 html 标签</code></li>
<li>构造器模式：<code>new</code></li>
<li>上下文模式：<code>call / apply</code></li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">m, n</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">return</span> m + n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 函数调用</span></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="title function_">foo</span>(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// 以 window 为上下文调用</span></span><br><span class="line"><span class="keyword">var</span> f1 = foo.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">5</span>])</span><br><span class="line"><span class="keyword">var</span> f1 = foo.<span class="title function_">call</span>(<span class="literal">null</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">getAge</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">age</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法调用</span></span><br><span class="line"><span class="keyword">var</span> f2 = obj.<span class="title function_">getAge</span>();</span><br><span class="line"><span class="comment">//  以 obj 为上下文调用</span></span><br><span class="line"><span class="keyword">var</span> f2 = obj.<span class="property">getAge</span>.<span class="title function_">apply</span>(obj);</span><br><span class="line"><span class="keyword">var</span> f2 = obj.<span class="property">getAge</span>.<span class="title function_">call</span>(obj);</span><br></pre></td></tr></table></figure>


<h3 id="函数前置"><a href="#函数前置" class="headerlink" title="函数前置"></a>函数前置</h3><div style="text-indent: 2em">函数声明会被 js解析器 优先读取，有重名的只留一个（变量和函数重名只留函数）。表达式只有在执行该语句时才会被逐行解析，而函数只有在被调用时才执行内部封装的函数体。</div>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">f1</span>() </span><br><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;   <span class="comment">//报错</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">f2</span>() </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params"></span>)&#123; &#125;        <span class="comment">// 正常 </span></span><br></pre></td></tr></table></figure>


<h3 id="函数标识"><a href="#函数标识" class="headerlink" title="函数标识"></a>函数标识</h3><ul>
<li>this：指向当前操作对象</li>
<li>callee：指向参数集合所属对象</li>
<li>prototype：指向函数附带的原型对象</li>
<li>constructor：指向创建该对象的构造函数</li>
</ul>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><blockquote>
<p>指有权访问另一个函数作用域变量的函数，一般是定义在外层函数中的内层函数，主要是用来设计私有的方法和变量。</p>
</blockquote>
<div style="text-indent: 2em">局部变量无法共享和长久的保存，而全局变量可能造成变量污染，所以我们希望有一种机制既可以长久的保存变量以便反复使用，但又不会造成全局污染。闭包的优点是可以避免全局变量的污染，缺点是闭包会常驻内存，会增大内存使用量，使用不当很容易造成内存泄露。</div>

<ul>
<li>特性：函数嵌套函数、函数内部可以引用外部的参数和变量、参数和变量不会被垃圾回收机制回收。</li>
<li>用途：数据缓存、封装私有变量、封装自定义插件、实现类和继承。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 异步获取数据并缓存</span></span><br><span class="line"><span class="keyword">const</span> getList = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> data = &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> packageOptions = &#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;/names&#x27;</span>,</span><br><span class="line">                <span class="attr">params</span>: &#123;</span><br><span class="line">                    <span class="attr">normal</span>: <span class="number">1</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">rsp</span>) &#123;</span><br><span class="line">                    data = rsp.<span class="property">data</span></span><br><span class="line">                    <span class="title function_">resolve</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="title function_">ajax</span>(packageOptions);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 闭包存储data</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable constant_">JONS</span>.<span class="title function_">stringify</span>(data) === <span class="string">&#x27;&#123;&#125;&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">getData</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;)() </span><br><span class="line"><span class="title function_">getList</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装私有变量</span></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">function</span>(<span class="params"></span>)&#123;     </span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&quot;default&quot;</span>;       </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> &#123;    </span><br><span class="line">        getName : <span class="keyword">function</span>(<span class="params"></span>)&#123;    </span><br><span class="line">            <span class="keyword">return</span> name;    </span><br><span class="line">        &#125;,    </span><br><span class="line">        setName : <span class="keyword">function</span>(<span class="params">newName</span>)&#123;    </span><br><span class="line">            name = newName;    </span><br><span class="line">      &#125;    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;();    </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>);       <span class="comment">// undefined    </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="title function_">getName</span>());  <span class="comment">// default  </span></span><br><span class="line">person.<span class="title function_">setName</span>(<span class="string">&quot;chuang&quot;</span>);    </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="title function_">getName</span>());  <span class="comment">// chuang  </span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装插件：匿名自执行函数执行完后会立刻释放资源</span></span><br><span class="line">;(<span class="keyword">function</span>(<span class="params"><span class="variable language_">document</span></span>) &#123; </span><br><span class="line">  <span class="keyword">var</span> obj = &#123;</span><br><span class="line">        <span class="attr">setColor</span>: <span class="keyword">function</span>(<span class="params">id, color</span>) &#123;</span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(id).<span class="property">style</span>.<span class="property">color</span> = color;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">view</span> = obj;  <span class="comment">// 暴露接口</span></span><br><span class="line">&#125;)(<span class="variable language_">document</span>);</span><br><span class="line">view.<span class="title function_">setColor</span>(<span class="string">&#x27;main&#x27;</span>,<span class="string">&#x27;red&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类和继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;    </span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">&quot;default&quot;</span>;       </span><br><span class="line">     </span><br><span class="line">  <span class="keyword">return</span> &#123;    </span><br><span class="line">     <span class="attr">getName</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;    </span><br><span class="line">         <span class="keyword">return</span> name;    </span><br><span class="line">     &#125;,    </span><br><span class="line">     <span class="attr">setName</span>: <span class="keyword">function</span>(<span class="params">newName</span>)&#123;    </span><br><span class="line">         name = newName;    </span><br><span class="line">     &#125;    </span><br><span class="line">  &#125;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p.<span class="title function_">setName</span>(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="title function_">getName</span>());</span><br></pre></td></tr></table></figure>


<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><blockquote>
<p>使用 <code>RegExp</code> 对象表示并由元字符、字符串和量词组成，用于描述字符串的匹配规则</p>
</blockquote>
<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><ol>
<li>方式<br>* 字面量：<code>/pattern/attributes</code>，特殊字符不需要转义，不支持字符串拼接<br>* 实例化：<code>new RegExp(“pattern”, “attributes”)</code>，特殊字符需要转义，支持字符串拼接</li>
<li>参数<br>* pattern：正则表达式<br>* attributes：匹配模式，<code>g、i、m</code> 分别表示 全局匹配、忽略大小写、多行匹配</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regExp = <span class="string">&#x27;ab&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字面量 </span></span><br><span class="line"><span class="keyword">var</span> reg_1 = <span class="regexp">/regExp/</span>;</span><br><span class="line"><span class="keyword">var</span> reg_1 = <span class="regexp">/^[a-zA-Z0-9]&#123;3,8&#125;$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">var</span> reg_2 = <span class="keyword">new</span> <span class="title class_">RegExp</span>(regExp+<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> reg_2 = <span class="keyword">new</span> <span class="title class_">RegExp</span>(“[a-zA-<span class="variable constant_">Z0</span>-<span class="number">9</span>]&#123;<span class="number">3</span>,<span class="number">8</span>&#125;”);</span><br></pre></td></tr></table></figure>

<h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3>  <div align="center">
      <img src="/images/js/regExp.png" alt="regExp" width="100%">
  </div>



<h2 id="全局对象"><a href="#全局对象" class="headerlink" title="全局对象"></a>全局对象</h2><blockquote>
<p>Window 对象，表示允许 JavaScript 代码访问的 Web 浏览器窗口</p>
</blockquote>
<h3 id="全局函数"><a href="#全局函数" class="headerlink" title="全局函数"></a>全局函数</h3><ul>
<li>编码：<code>encodeURI、encodeURIComponent、escape</code></li>
<li>解码：<code>decodeURI、decodeURIComponent、unescape</code></li>
<li>检测：<code>isNaN、isFinite</code></li>
<li>转换：<code>eval、String、Number</code></li>
<li>解析：<code>parseInt、parseFloat</code></li>
</ul>
<h3 id="全局属性"><a href="#全局属性" class="headerlink" title="全局属性"></a>全局属性</h3><ul>
<li>NaN：不是数字值</li>
<li>undefined：未定义的值</li>
<li>Infinity：正无穷大的数值</li>
</ul>
<h2 id="计时器"><a href="#计时器" class="headerlink" title="计时器"></a>计时器</h2><div style="text-indent: 2em">requestAnimationFrame 采用系统时间间隔来保持最佳绘制效率而不需要手动设置，这样就不会因间隔时间过短而会造成 过度绘制并增加开销，也不会因时间太长则导致 动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。</div>

<ul>
<li><strong>setTimeout</strong>：延时执行指定代码, 取消时使用 clearTimeout</li>
<li><strong>setInterval</strong>：间隔时间重复执行代码, 取消时使用 clearInterval</li>
<li><strong>requestAnimationFrame</strong>：在浏览器每次刷新页面之前执行代码，时间间隔由浏览器刷新频率决定，取消时使用 cancelAnimationFrame</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> box = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;box&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> timer = <span class="title function_">requestAnimationFrame</span>(<span class="keyword">function</span> <span class="title function_">step</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">var</span> width = <span class="built_in">parseInt</span>(box.<span class="property">style</span>.<span class="property">width</span>);</span><br><span class="line">      <span class="keyword">if</span>(width &lt; <span class="number">500</span>)&#123;</span><br><span class="line">          box.<span class="property">style</span>.<span class="property">width</span> = width + <span class="number">10</span>;</span><br><span class="line">          <span class="title function_">requestAnimationFrame</span>(step);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="title function_">cancelAnimationFrame</span>(timer);</span><br><span class="line">      &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="this-指向"><a href="#this-指向" class="headerlink" title="this 指向"></a>this 指向</h2><blockquote>
<p>this 代表当前方法执行时自动生成的一个上下文对象。</p>
</blockquote>
<ul>
<li>元素绑定事件：指向当前操作的元素。</li>
<li>普通函数：指向点前面的对象，没有点则指向 window (js 严格模式下是 undefined)。</li>
<li>构造函数：指向生成的对象实例，而且 this 指向无法改变。new 的过程是在内部新建一个空对象，添加构造函数的属性和方法并返回该对象。</li>
<li>箭头函数：指向定义时所在的对象，因为它没有自身的 this，使用的是外层 this。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 普通函数</span></span><br><span class="line"><span class="keyword">let</span> fn = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;哈哈哈&#x27;</span>,</span><br><span class="line">  <span class="attr">fn</span>: fn</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>();       <span class="comment">// window</span></span><br><span class="line">obj.<span class="title function_">fn</span>();   <span class="comment">// obj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>)&#123; </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)  <span class="comment">// p：&#123;name: &quot;Tom&quot;, age: 20&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Tony&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)  <span class="comment">// Window</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">b</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)  <span class="comment">// obj</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">a</span>()</span><br><span class="line">obj.<span class="title function_">b</span>()</span><br></pre></td></tr></table></figure>


<h2 id="apply、call、bind"><a href="#apply、call、bind" class="headerlink" title="apply、call、bind"></a>apply、call、bind</h2><h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><blockquote>
<p>相同点：用来改变 this 指向、第一个参数是 this 要指向的对象 (默认 window)。区别如下：</p>
</blockquote>
<ul>
<li>参数：call 单个传递、apply 数组、bind 值或数组。</li>
<li>功能：call、apply 函数直接执行，bind 函数会返回一个绑定了新 this 的函数但不会执行。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基础使用</span></span><br><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">name</span>: <span class="string">&#x27;linxin&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">x, y</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)  <span class="comment">// a</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f.<span class="title function_">apply</span>(a, [<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">f.<span class="title function_">call</span>(a, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">f.<span class="title function_">bind</span>(a, <span class="number">1</span>, <span class="number">2</span>)()</span><br></pre></td></tr></table></figure>


<h3 id="call-应用场景"><a href="#call-应用场景" class="headerlink" title="call 应用场景"></a>call 应用场景</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、改变 this 指向</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;linxin&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line">foo.<span class="title function_">call</span>(obj);   <span class="comment">// linxin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、借用别的对象的方法</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Person1</span>  = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;linxin&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Person2</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">getname</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 使用 Person1 对象代替 this 对象，所以 Person2 继承了 Person1 的属性和方法</span></span><br><span class="line">  <span class="title class_">Person1</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="title class_">Person2</span>();</span><br><span class="line">person.<span class="title function_">getname</span>();  <span class="comment">// linxin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、调用函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;linxin&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">fn.<span class="title function_">call</span>();  <span class="comment">// linxin</span></span><br></pre></td></tr></table></figure>


<h3 id="call-拓展用法"><a href="#call-拓展用法" class="headerlink" title="call 拓展用法"></a>call 拓展用法</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、利用 call 判断数据类型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="string">&quot;qq&quot;</span>))        <span class="comment">// [Object String]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="number">12</span>))          <span class="comment">// [object Number]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">undefined</span>))   <span class="comment">// [object Undefined]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、利用 call 翻转字符串：将字符串转化为数组，通过数组的 reverse 将字符串翻转过来</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;abcdefg&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> a =  <span class="title class_">Array</span>.<span class="title function_">from</span>(str).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>)  <span class="comment">// gfedcba</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">reverse</span>.<span class="title function_">call</span>(str.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>)).<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>)  <span class="comment">// gfedcba</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、利用 apply 求最大值：执行 Math.max(1, 2, 3, 5)，然后将内部的 this 改为 arr</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">56</span>, <span class="number">889</span>]</span><br><span class="line"><span class="comment">// 第一个 arr 表示让 arr 借用 max 方法，第二个 arr 表示传给 max 的数据</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(arr, arr)) </span><br></pre></td></tr></table></figure>


<h2 id="JS-算法"><a href="#JS-算法" class="headerlink" title="JS 算法"></a>JS 算法</h2><ul>
<li>排序算法<ul>
<li><strong>冒泡排序</strong>：比较任何两个相邻元素，如果第一个比第二个大则交换位置。元素向上移动到正确顺序，类似气泡上升至表面而得名。</li>
<li><strong>选择排序</strong>：每次从元素中选出最小或最大值，存放在序列的起始位置，以此循环至排序完毕。</li>
<li><strong>插入排序</strong>：将一个数据插入到已经排好序的有序数据中，从而得到一个新的、个数加一的有序数据，适用于少量数据的排序。</li>
<li><strong>归并排序</strong>：将原始序列切分成较小的序列直到无法再切分，然后将小序列排序后归并成大序列，直到最后只有一个排序完毕的大序列。</li>
<li><strong>快速排序</strong>：通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另外一部分的所有数据都要小，然后再按此方法对这两部分数据分别进行上述递归排序，以此达到整个数据变成有序序列。</li>
</ul>
</li>
<li>搜索算法<ul>
<li><strong>顺序搜索</strong>：让目标元素与列表中的每一个元素逐个比较，直到找出与给定元素相同的元素为止，缺点是效率低下。</li>
<li><strong>二分搜索</strong>：在一个有序列表，以中间值为基准拆分为两个子列表，拿目标元素与中间值作比较从而再在目标的子列表中递归此方法，直至找到目标元素。</li>
</ul>
</li>
<li>其他<ul>
<li><strong>贪心算法</strong>：在对问题求解时，不考虑全局，总是做出局部最优解的方法。</li>
<li><strong>动态规划</strong>：在对问题求解时，由以求出的局部最优解来推导全局最优解。</li>
<li><strong>复杂度</strong>：一个方法在执行的整个生命周期所需要占用的时间、空间等资源。</li>
</ul>
</li>
</ul>
<h1 id="三、DOM"><a href="#三、DOM" class="headerlink" title="三、DOM"></a>三、DOM</h1><blockquote>
<p>文档对象模型，用于操作 HTML 和 XML 文档（浏览器内容）的编程接口</p>
</blockquote>
<h2 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h2><div style="text-indent: 2em">DOM 将整个文档（XML文档和HTML文档）看作一个树形结构，并用document对象表示该文档，并规定其中每个成分都是一个节点（Node），JavaScript 通过 DOM API 可以操作到每个节点。</div>

<h3 id="节点信息"><a href="#节点信息" class="headerlink" title="节点信息"></a>节点信息</h3><ul>
<li><code>nodeType</code>：节点类型</li>
<li><code>nodeName</code>：节点名称</li>
<li><code>nodeValue</code>：节点值</li>
</ul>
<h3 id="节点类型"><a href="#节点类型" class="headerlink" title="节点类型"></a>节点类型</h3><ul>
<li>文档节点：整个文档</li>
<li>注释节点：文档注释</li>
<li>元素节点：html 标签</li>
<li>文本节点：元素&#x2F;属性节点中的文本内容</li>
<li>属性节点：元素节点的属性</li>
</ul>
  <div align="center">
      <img src="/images/js/domNodes.png" alt="节点类型" width="100%">
  </div>


<h3 id="文档节点"><a href="#文档节点" class="headerlink" title="文档节点"></a>文档节点</h3><ul>
<li>标签：<code>document.documentElement/body/forms</code></li>
<li>信息：<code>document.URL/domain/readyState</code></li>
<li>方法：<code>document.write/writeln/open/close</code></li>
</ul>
<h3 id="元素节点"><a href="#元素节点" class="headerlink" title="元素节点"></a>元素节点</h3><blockquote>
<p>文本节点、属性节点都属于元素节点的子节点，操作时都需要先获取 元素节点</p>
</blockquote>
<ol>
<li>获取<br>* document<ul>
<li><code>document.getElementById/TagName/ClassName/Name</code></li>
<li><code>document.querySelector [All]</code></li>
<li><code>document.documentElement</code></li>
<li><code>document.body</code></li>
<li><code>document.forms</code> <ul>
<li>节点指针</li>
</ul>
</li>
<li>父节点：<code>parentNode</code></li>
<li>同级节点：<code>previousSibling、nextSibling</code></li>
<li>子节点：<code>firstChild、lastChild、childNodes、children</code></li>
</ul>
</li>
<li>操作<br>* 创建：<code>createElement、createAttribute、createTextNode</code><br>* 插入：<code>appendChild、insertBefore</code><br>* 替换：<code>replaceChild</code><br>* 复制：<code>cloneNode</code><br>* 删除：<code>removeChild</code><br>* 样式：<code>dom.style.样式名</code><ul>
<li>样式名必须使用驼峰命名法</li>
<li>修改 class 时必须使用 className</li>
</ul>
</li>
<li>属性<br>* 获取：<code>getAttribute</code><br>* 设置：<code>setAttribute</code><br>* 移除：<code>removeAttribute</code></li>
<li>文本<br>* 获取：<code>innerHTML / innerText</code><br>* 设置：<code>dom.innerHTML / innerText = &quot;new&quot;</code><br>* 表单元素：<code>input.value、input.value = “new”</code></li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置元素属性</span></span><br><span class="line"><span class="keyword">var</span> box = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;box&quot;</span>);</span><br><span class="line">box.<span class="title function_">setAttribute</span>(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;this is box&quot;</span>);  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(box.<span class="title function_">getAttribute</span>(<span class="string">&quot;title&quot;</span>));  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 创建属性节点</span></span><br><span class="line"><span class="keyword">var</span> placeholder = <span class="variable language_">document</span>.<span class="title function_">createAttribute</span>(<span class="string">&quot;placeholder&quot;</span>);</span><br><span class="line">placeholder.<span class="property">nodeValue</span> = <span class="string">&quot;请输入姓名&quot;</span>; </span><br><span class="line">box.<span class="title function_">setAttributeNode</span>(placeholder);  </span><br></pre></td></tr></table></figure>


<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><h3 id="DOM0-级"><a href="#DOM0-级" class="headerlink" title="DOM0 级"></a>DOM0 级</h3><blockquote>
<p>在 DOM 中直接绑定事件</p>
</blockquote>
<ul>
<li>绑定：<code>DOM.onclick = function()&#123; &#125;</code></li>
<li>移除：<code>DOM.onclick = null / &quot;&quot;</code></li>
</ul>
<h3 id="DOM2-级"><a href="#DOM2-级" class="headerlink" title="DOM2 级"></a>DOM2 级</h3><blockquote>
<p>使用事件监听绑定事件，浏览器监听到用户执行相关操作做出响应</p>
</blockquote>
<ol>
<li>主流浏览器<br>* 绑定：<code>DOM.addEventListener(&#39;click&#39;, fn, false)</code><br>* 移除：<code>DOM.removeEventListener(&#39;click&#39;, fn)</code><br>* 参数：false 时在冒泡阶段执行，true 则在捕获阶段执行</li>
<li>IE8及以下<br>* 绑定：<code>DOM.attachEvent(&#39;onclick&#39;, fn)</code><br>* 移除：<code>DOM.detachEvent(&#39;click&#39;, fn)</code></li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// DOM0 级事件可能被覆盖：2，3，4</span></span><br><span class="line"><span class="keyword">var</span> box = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#box&#x27;</span>)</span><br><span class="line">box.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">box.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">box.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br><span class="line">box.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="number">4</span>)</span><br><span class="line">&#125;)  </span><br></pre></td></tr></table></figure>

<h3 id="事件流"><a href="#事件流" class="headerlink" title="事件流"></a>事件流</h3><blockquote>
<p>事件的执行顺序</p>
</blockquote>
<ul>
<li>事件冒泡：事件从事件目标元素开始触发，向上触发到最外层的 document 对象</li>
<li>事件捕获：与冒泡相反</li>
<li>DOM 事件流：DOM 先捕获到目标元素，然后冒泡到最外层</li>
</ul>
<h3 id="事件对象"><a href="#事件对象" class="headerlink" title="事件对象"></a>事件对象</h3><blockquote>
<p>触发 DOM 上的某个事件时会产生一个事件对象 event，它包含着所有与事件有关的信息</p>
</blockquote>
<ol>
<li>属性：鼠标 &#x2F; 键盘属性、IE 属性、标准 Event 属性</li>
<li>方法：stopPropagation、preventDefault</li>
<li>事件<br>* 鼠标事件：<code>click、dbclick、mousedown、mousemove、mouseout、mouseover、mouseup</code><br>* 键盘事件：<code>keydown、keypress、keyup</code><br>* HTML事件：<code>load、unload、resize、change、scroll、focus、blur、select、reset、submit</code></li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> <span class="title class_">Event</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 页面加载完成后</span></span><br><span class="line">    <span class="attr">readyEvent</span>: <span class="keyword">function</span>(<span class="params">fn</span>) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (fn == <span class="literal">null</span>) &#123; </span><br><span class="line">            fn = <span class="variable language_">document</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">var</span> oldonload = <span class="variable language_">window</span>.<span class="property">onload</span>; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span>.<span class="property">onload</span> != <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">onload</span> = fn; </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; </span><br><span class="line">                <span class="title function_">oldonload</span>(); </span><br><span class="line">                <span class="title function_">fn</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定事件</span></span><br><span class="line">    <span class="attr">addEvent</span>: <span class="keyword">function</span>(<span class="params">element, type, handler</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span> (element.<span class="property">addEventListener</span>) &#123;    </span><br><span class="line">              element.<span class="title function_">addEventListener</span>(type, handler, <span class="literal">false</span>); <span class="comment">// DOM2</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (element.<span class="property">attachEvent</span>) &#123; </span><br><span class="line">            element.<span class="title function_">attachEvent</span>(<span class="string">&#x27;on&#x27;</span> + type, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                  handler.<span class="title function_">call</span>(element);     <span class="comment">// 兼容IE</span></span><br><span class="line">            &#125;); </span><br><span class="line">        &#125;<span class="keyword">else</span> &#123; </span><br><span class="line">            element[<span class="string">&#x27;on&#x27;</span> + type] = handler;  <span class="comment">// DOM0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除事件 </span></span><br><span class="line">    <span class="attr">removeEvent</span>: <span class="keyword">function</span>(<span class="params">element, type, handler</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (element.<span class="property">removeEventListener</span>) &#123;</span><br><span class="line">            element.<span class="title function_">removeEventListener</span>(type, handler, <span class="literal">false</span>); </span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (element.<span class="property">datachEvent</span>) &#123; </span><br><span class="line">            element.<span class="title function_">datachEvent</span>(<span class="string">&#x27;on&#x27;</span> + type, handler); </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            element[<span class="string">&#x27;on&#x27;</span> + type] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取应用到元素上的所有样式</span></span><br><span class="line">    <span class="attr">getStyle</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> style = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">getComputedStyle</span>)&#123;</span><br><span class="line">            style = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(obj,<span class="literal">null</span>);  <span class="comment">// W3C</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            style = obj.<span class="property">currentStyle</span>;   <span class="comment">// IE</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> style;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取事件对象，确保随时可以使用</span></span><br><span class="line">    <span class="attr">getEvent</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123; </span><br><span class="line">        <span class="keyword">var</span> ev = e || <span class="variable language_">window</span>.<span class="property">event</span>;</span><br><span class="line">        <span class="keyword">if</span>(!ev)&#123; </span><br><span class="line">            <span class="keyword">var</span> c = <span class="variable language_">this</span>.<span class="property">getEvent</span>.<span class="property">caller</span>; </span><br><span class="line">            <span class="keyword">while</span>(c) &#123; </span><br><span class="line">                ev = c.<span class="property">argument</span>[<span class="number">0</span>]; </span><br><span class="line">                <span class="keyword">if</span> (ev &amp;&amp; <span class="title class_">Event</span> == ev.<span class="property">constructor</span>) &#123;</span><br><span class="line">                        <span class="keyword">break</span>; </span><br><span class="line">                &#125; </span><br><span class="line">                c = c.<span class="property">caller</span>; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> ev; </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取触发事件的元素 </span></span><br><span class="line">    <span class="attr">getTarget</span>: <span class="keyword">function</span>(<span class="params">event</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> event.<span class="property">target</span> || event.<span class="property">srcElemnt</span>; </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 阻止冒泡，比如 父子元素都有事件时阻止同时触发</span></span><br><span class="line">    <span class="attr">stopPropagation</span>: <span class="keyword">function</span>(<span class="params">ev</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span> (ev.<span class="property">stopPropagation</span>) &#123; </span><br><span class="line">            ev.<span class="title function_">stopPropagation</span>(); </span><br><span class="line">        &#125;<span class="keyword">else</span> &#123; </span><br><span class="line">            ev.<span class="property">cancelBubble</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="attr">stop_propagation</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">var</span> e = <span class="variable language_">window</span>.<span class="property">event</span> || <span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">caller</span>.<span class="property">arguments</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span>(e &amp;&amp; e.<span class="property">stopPropagation</span>)&#123; </span><br><span class="line">            e.<span class="title function_">stopPropagation</span>();   </span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">event</span>)&#123; </span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">event</span>.<span class="property">cancelBubble</span> = <span class="literal">true</span>;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 阻止浏览器默认行为，比如 点击提交按钮时阻止默认提交表单、a链接阻止默认跳转</span></span><br><span class="line">    <span class="attr">preventDefault</span>: <span class="keyword">function</span>(<span class="params">ev</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ev.<span class="property">preventDefault</span>) &#123; </span><br><span class="line">            ev.<span class="title function_">preventDefault</span>(); </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            ev.<span class="property">returnValue</span> = <span class="literal">false</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h3><blockquote>
<p>利用事件冒泡原理，将本该元素执行的事件委托给了它的父元素执行  </p>
</blockquote>
<ol>
<li>优势：节省内存而提升性能、减少 DOM 操作而提高运行效率。</li>
<li>适用场景：给多个同类元素绑定相同事件、给动态生成的新元素绑定事件。</li>
<li>实现代码  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为三个同级的 input 绑定点击事件</span></span><br><span class="line"><span class="keyword">var</span> box = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;box&quot;</span>);</span><br><span class="line"><span class="comment">// box.on(&quot;click&quot;, &quot;input&quot;, callback) </span></span><br><span class="line">box.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params">ev</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ev = ev || <span class="variable language_">window</span>.<span class="property">event</span>;</span><br><span class="line">  <span class="keyword">var</span> target = ev.<span class="property">target</span> || ev.<span class="property">srcElement</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断元素：target.className == &quot;box&quot;</span></span><br><span class="line">  <span class="keyword">if</span>(target.<span class="property">nodeName</span>.<span class="title function_">toLocaleLowerCase</span>() == <span class="string">&#x27;input&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">switch</span>(target.<span class="property">id</span>)&#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span> :</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;remove&#x27;</span> :</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;select&#x27;</span> :</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;选择&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为添加的子元素绑定事件</span></span><br><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> oUl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ul1&quot;</span>);</span><br><span class="line">oUl.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="keyword">function</span>(<span class="params">ev</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ev = ev || <span class="variable language_">window</span>.<span class="property">event</span>;</span><br><span class="line">    <span class="keyword">var</span> target = ev.<span class="property">target</span> || ev.<span class="property">srcElement</span>;</span><br><span class="line">    <span class="keyword">if</span>(target.<span class="property">nodeName</span>.<span class="title function_">toLocaleLowerCase</span>() == <span class="string">&#x27;li&#x27;</span>)&#123;</span><br><span class="line">        ev.<span class="property">target</span>.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;black&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">btn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> oLi = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">    oLi.<span class="property">innerHTML</span> = <span class="number">4</span>;</span><br><span class="line">    oUl.<span class="title function_">appendChild</span>(oLi);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="四、BOM"><a href="#四、BOM" class="headerlink" title="四、BOM"></a>四、BOM</h1><blockquote>
<p>浏览器对象模型，用于操作浏览器本身的应用编程接口  </p>
</blockquote>
  <div align="center">
      <img src="/images/js/bom.png" alt="BOM" width="100%">
  </div>


<h1 id="五、JS-工具库"><a href="#五、JS-工具库" class="headerlink" title="五、JS 工具库"></a>五、JS 工具库</h1><h2 id="jquery-库"><a href="#jquery-库" class="headerlink" title="jquery 库"></a>jquery 库</h2><h3 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h3><ul>
<li>对象转换   <ul>
<li>DOM 转为 jq：<code>var $btn = $(btn)</code></li>
<li>jq 转为 DOM：<code>var btn = $btn[0] / $btn.get(0)</code></li>
</ul>
</li>
<li>动画实现<ul>
<li>显示隐藏：show&#x2F;hide(speed, callback)</li>
<li>滑入滑出：slideDown&#x2F;Up&#x2F;Toggle(speed, callback)</li>
<li>淡出淡入：fadeIn&#x2F;Out&#x2F;Toggle(speed, callback)</li>
<li>自定义动画：animate(prop, speed, easing, callback)</li>
</ul>
</li>
<li>操作样式<ul>
<li>css 操作：<code>css(&quot;width&quot;)、css(&quot;width&quot;, &quot;0&quot;)、css(&#123;&quot;color&quot;: &quot;red&quot;&#125;)</code></li>
<li>class 操作：addClass、removeClass、toggleClass、hasClass、is</li>
</ul>
</li>
<li>操作 DOM<ul>
<li>创建：<code>var $h3 = $(&#39;h3&#39;)</code></li>
<li>插入：<code>父.append/prepend(子)、子.appendTo(父)、同胞.before/after(&#39;插入同胞&#39;)、插入同胞.insertBefore/After(&#39;同胞&#39;)</code></li>
<li>删除：<code>$(&#39;#box&#39;).remove()、$(&#39;ul&#39;).remove(&#39;l1&#39;)</code></li>
<li>克隆：clone()，传入 true 时克隆结构加事件，否则只克隆结构。</li>
<li>清空子元素：empty()、html()，不会清理子元素事件而造成内存泄漏，不推荐。</li>
</ul>
</li>
<li>操作属性<ul>
<li>读取移除：attr&#x2F;prop(name)、removeAttr&#x2F;Prop(name)</li>
<li>方法区别：操作元素的固有属性 prop、处理元素的自定义属性 attr</li>
<li>设置属性：<code>img.attr(&#39;src&#39;, &#39;1.png&#39;)、div.attr(&#123;&#39;class&#39;: &#39;a&#39; &#125;)</code></li>
</ul>
</li>
<li>操作内容<ul>
<li>表单元素：val(value)</li>
<li>普通元素：html(str)、text(str)</li>
</ul>
</li>
</ul>
<h3 id="事件机制"><a href="#事件机制" class="headerlink" title="事件机制"></a>事件机制</h3><ul>
<li>发展历程<ol>
<li>简单绑定：一次只能绑定一个事件，<code>click(handler)、scroll(handler)</code></li>
<li>bind 绑定：不支持动态元素绑定事件 <code>bind(&quot;click mouseenter&quot;, handler)</code></li>
<li>on 绑定</li>
</ol>
<ul>
<li>自身绑定：<code>on(事件名称, 事件处理函数)</code></li>
<li>事件委托<code>on(事件名称, 可选后代元素, 传递数据, 事件处理函数)</code></li>
<li>事件解绑：<code>off()</code> 解绑元素的所有事件、<code>off(&quot;click&quot;, &quot;**&quot;)</code> 解绑元素的所有代理事件但不会解绑自身事件。</li>
<li>先解绑再绑定：<code>$(&#39;#btn&#39;).off(&#39;click&#39;).on(&#39;click&#39;, callback)</code> 防止事件累加，导致点击一次而事件执行多次。</li>
</ul>
</li>
<li>事件触发<ul>
<li>直接调用：<code>$(&#39;div&#39;).click()</code></li>
<li>trigger：会触发浏览器默认操作，<code>$(&#39;input&#39;).trigger(&#39;focus&#39;)</code></li>
<li>triggerHandler：不触发默认操作，<code>$(&#39;input&#39;).triggerHandler(&#39;focus&#39;)</code></li>
</ul>
</li>
<li>事件委托<ol>
<li>把事件绑定在父元素上。</li>
<li>点击子元素时会触发事件冒泡。</li>
<li>父元素的事件响应时获取触发该事件的元素。</li>
<li>如果该元素和 on 绑定的元素相匹配则触发事件处理函数。</li>
</ol>
</li>
</ul>
<h3 id="编程思想"><a href="#编程思想" class="headerlink" title="编程思想"></a>编程思想</h3><ul>
<li>js、jquery：可共存但不可混用，jquery 通过 return this 支持链式编程。</li>
<li>隐式迭代：方法内部为所有匹配元素进行循环遍历，但注意设置全部元素而获取首个元素的值，比如 <code>$(&#39;div&#39;).css(&#39;color&#39;, &#39;red&#39;)、$(&#39;li&#39;).css(&#39;width&#39;)</code>。</li>
<li>多库共存：多个引用库的 $ 符号可能冲突，解决方案为 <code>(function($)&#123; &#125;)(jQuery)、jQuery(function($)&#123; &#125;)、$.noConflict()</code>。</li>
</ul>
<h3 id="插件机制"><a href="#插件机制" class="headerlink" title="插件机制"></a>插件机制</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ======== 插件开发：为 jQuery 原型添加功能函数来扩展功能 ==========</span></span><br><span class="line"><span class="comment">// 1、类级别：扩展 jquery 类本身，只能通过 jq/$ 类调用 $.hello()、$.myExtend.hello()</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params">$</span>)&#123;</span><br><span class="line">    $.<span class="title function_">extend</span>(&#123;  <span class="attr">hello</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125; &#125;)</span><br><span class="line">    $.<span class="title function_">myExtend</span>(&#123; <span class="attr">hello</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;  &#125;)</span><br><span class="line">&#125;)(jQuery)</span><br><span class="line"><span class="comment">// 2、对象级别：扩展 jquery 原型对象，每个 jquery 实例对象都能调用 $(&quot;#box&quot;).myAnimate()</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params">$</span>)&#123;</span><br><span class="line">    <span class="comment">// $.fn.pluginName = $.fn.extend(pluginName) = $.prototype.extend(pluginName)</span></span><br><span class="line">    $.fn.<span class="title function_">extend</span>(&#123;  <span class="attr">myAnimate</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125; &#125;)</span><br><span class="line">    $.fn.<span class="property">myAnimate</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;</span><br><span class="line">&#125;)(jQuery) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@title</span> 插件模板</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@desp</span>  分号：开头是为了避免别人的代码不规范引起错误，结尾是为了避免压缩出错。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@params</span> window、document：快速查找，而且也便于代码压缩，比如 window 可能被压缩为 w。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@params</span> undefined：保证原生，防止他人把其定义为别的。</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">;(<span class="keyword">function</span>(<span class="params">win, doc, $, <span class="literal">undefined</span></span>)&#123;             <span class="comment">// 没有第四个参数</span></span><br><span class="line">    $.fn.<span class="title function_">extend</span>(&#123;</span><br><span class="line">        <span class="string">&quot;pluginName&quot;</span>: <span class="keyword">function</span> (<span class="params">opt</span>) &#123; &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> defaults = &#123; &#125;</span><br><span class="line">    $.fn.<span class="property">pluginName</span> = <span class="keyword">function</span> (<span class="params">opt</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> set = $.<span class="title function_">extend</span>(&#123;&#125;, defaults, opt)   <span class="comment">// 合并默认配置和用户配置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>;     <span class="comment">// 支持链式调用</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;(<span class="variable language_">window</span>, <span class="variable language_">document</span>, jQuery))</span><br></pre></td></tr></table></figure>


<h2 id="Lodash"><a href="#Lodash" class="headerlink" title="Lodash"></a>Lodash</h2><blockquote>
<p>一个轻量级的 Js 原生工具函数库，不需要引入其他第三方依赖。它内部封装了很多对字符串、数组、对象等常见数据类型的处理函数，可以极大提高开发效率。</p>
</blockquote>
<ul>
<li>辅助函数<ul>
<li><strong>Array</strong>：适合于数组，比如填充数据、查找元素、数组分片等。</li>
<li><strong>Collocation</strong>：适用于数组和对象，部分适用于字符串，比如分组、查找、过滤等。</li>
<li><strong>Function</strong>：适用于函数，比如节流、延迟、缓存、设置钩子等。</li>
<li><strong>Lang</strong>：普遍适用于各种类型，常用于执行类型判断和类型转换。</li>
<li><strong>Math</strong>：使用与数值类型，常用于执行数学运算。</li>
<li><strong>Number</strong>：适用于生成随机数，比较数值与数值区间的关系。</li>
<li><strong>Object</strong>：适用于对象类型，常用于对象的创建、扩展、类型转换、检索、集合等。</li>
<li><strong>Seq</strong>：常用于创建链式调用，提高执行性能（惰性计算）。</li>
<li><strong>String</strong>：适用于字符串类型。</li>
</ul>
</li>
<li>lodash&#x2F;fp 模块：提供了更接近函数式编程的开发方式，主要特点如下。<ul>
<li><strong>Rearragned Arguments</strong>：重新调整参数位置，便于函数之间的聚合。</li>
<li><strong>Capped Iteratee Argument</strong>：封装 Iteratee 参数。</li>
<li><strong>Fixed Arity</strong>：固化参数个数，便于柯里化。</li>
<li><strong>New Methods</strong></li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装引用</span></span><br><span class="line">npm i lodash -S</span><br><span class="line">npm i babel-plugin-lodash -D</span><br><span class="line"></span><br><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>:[ <span class="string">&quot;lodash&quot;</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常见用法</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash/fp&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、N 次循环</span></span><br><span class="line">_.<span class="title function_">times</span>(<span class="number">5</span>,<span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、深层查找属性值</span></span><br><span class="line"><span class="keyword">var</span> ownerArr = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;Colin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pets&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;dog1&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;dog2&quot;</span>&#125;]</span><br><span class="line">  &#125;, </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pets&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;dog3&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;dog4&quot;</span>&#125;]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">var</span> lodashMap = _.<span class="title function_">map</span>(ownerArr, <span class="string">&#x27;pets[0].name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、深克隆对象</span></span><br><span class="line"><span class="keyword">var</span> objB = _.<span class="title function_">cloneDeep</span>(objA)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、在指定范围内获取一个随机值</span></span><br><span class="line"><span class="keyword">var</span> randomNum = _.<span class="title function_">random</span>(<span class="number">15</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5、扩展对象</span></span><br><span class="line"><span class="keyword">var</span> objA = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;戈德斯文&quot;</span>, <span class="string">&quot;car&quot;</span>: <span class="string">&quot;宝马&quot;</span>&#125;</span><br><span class="line"><span class="keyword">var</span> objB = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;柴硕&quot;</span>, <span class="string">&quot;loveEat&quot;</span>: <span class="literal">true</span>&#125;</span><br><span class="line"><span class="keyword">var</span> target = _.<span class="title function_">assign</span>(objA, objB)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6、从列表中随机的选择列表项</span></span><br><span class="line"><span class="keyword">var</span> smartTeam = [<span class="string">&quot;戈德斯文&quot;</span>, <span class="string">&quot;杨海月&quot;</span>, <span class="string">&quot;柴硕&quot;</span>, <span class="string">&quot;师贝贝&quot;</span>]</span><br><span class="line"><span class="keyword">var</span> randomSmarter = _.<span class="title function_">sample</span>(smartTeam)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7、判断对象中是否含有某元素：查询的对象、元素、开始下标</span></span><br><span class="line"><span class="keyword">var</span> smartPerson = &#123;</span><br><span class="line">  <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;戈德斯文&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sm = _.<span class="title function_">includes</span>(smartPerson, <span class="string">&#x27;戈德斯文&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> st = _.<span class="title function_">includes</span>(smartTeam, <span class="string">&#x27;杨海月&#x27;</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8、遍历循环</span></span><br><span class="line">_.<span class="title function_">forEach</span>([<span class="number">1</span>, <span class="number">3</span>] , <span class="keyword">function</span>(<span class="params">value, key</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key,value);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9、遍历循环执行某个方法</span></span><br><span class="line"><span class="keyword">var</span> users = [</span><br><span class="line">  &#123; <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;barney&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;fred&#x27;</span> &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">var</span> mapUser = _.<span class="title function_">map</span>(users, <span class="string">&#x27;user&#x27;</span>)  <span class="comment">// [&#x27;barney&#x27;, &#x27;fred&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 10、检验值是否为空</span></span><br><span class="line">_.<span class="title function_">isEmpty</span>(<span class="literal">null</span>)         <span class="comment">// =&gt; true</span></span><br><span class="line">_.<span class="title function_">isEmpty</span>(<span class="literal">true</span>)         <span class="comment">// =&gt; true</span></span><br><span class="line">_.<span class="title function_">isEmpty</span>(<span class="number">1</span>)            <span class="comment">// =&gt; true</span></span><br><span class="line">_.<span class="title function_">isEmpty</span>([<span class="number">1</span>, <span class="number">2</span>])       <span class="comment">// =&gt; false</span></span><br><span class="line">_.<span class="title function_">isEmpty</span>(&#123; <span class="string">&#x27;a&#x27;</span>: <span class="number">1</span> &#125;)   <span class="comment">// =&gt; false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 11、查找属性</span></span><br><span class="line"><span class="keyword">var</span> users = [</span><br><span class="line">  &#123;<span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;barney&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">36</span>, <span class="string">&#x27;active&#x27;</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;fred&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">40</span>, <span class="string">&#x27;active&#x27;</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;pebbles&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;active&#x27;</span>: <span class="literal">true</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// find 返回真值的第一个元素</span></span><br><span class="line">_.<span class="title function_">find</span>(users, <span class="keyword">function</span> (<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> o.<span class="property">age</span> &lt; <span class="number">40</span>;</span><br><span class="line">&#125;)</span><br><span class="line">_.<span class="title function_">find</span>(users, &#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;active&#x27;</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">_.<span class="title function_">find</span>(users, [<span class="string">&#x27;active&#x27;</span>, <span class="literal">false</span>])</span><br><span class="line">_.<span class="title function_">find</span>(users, <span class="string">&#x27;active&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// filter：返回真值的所有元素的数组，reject 是其反向方法</span></span><br><span class="line">_.<span class="title function_">filter</span>(users, &#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;active&#x27;</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">_.<span class="title function_">filter</span>(users, [<span class="string">&#x27;active&#x27;</span>, <span class="literal">false</span>])</span><br><span class="line">_.<span class="title function_">filter</span>(users, <span class="string">&#x27;active&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 12、数组去重</span></span><br><span class="line"><span class="keyword">var</span> arr2 = _.<span class="title function_">uniq</span>(arr1);</span><br><span class="line">_.<span class="title function_">uniqBy</span>([<span class="number">2.1</span>, <span class="number">1.2</span>, <span class="number">2.3</span>], <span class="title class_">Math</span>.<span class="property">floor</span>)  <span class="comment">// [2.1, 1.2]</span></span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS 预处理工具</title>
    <url>/2019/05/12/3-3-css%E9%A2%84%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h1 id="一、出现需求"><a href="#一、出现需求" class="headerlink" title="一、出现需求"></a>一、出现需求</h1><div style="text-indent: 2em">css 只能用来写样式但不能实现真正的编程，而预处理器为 CSS 增加了编程特性，让它更加简洁的同时不再需要考虑浏览器的兼容问题，适应性和可读性更好，可以进行模块化开发，节省开发时间而且方便后期维护等。目前最主流的三个预处理器有 Less、Sass、Stylus</div>

<div style="text-indent: 2em">最早也是最成熟的是 Sass，它使用 以严格的缩进式语法规则书写而不带 {} 和 ; 的缩排语法，后来为了方便习惯 css 的开发人员而升级为Scss，Scss 兼容 Sass 语法而且书写规则类似css。Less 受 Sass 的影响较大，更容易上手但编程功能不够，Stylus主要用来给 Node 项目进行 css 预处理支持</div>
    

<h1 id="二、基础语法"><a href="#二、基础语法" class="headerlink" title="二、基础语法"></a>二、基础语法</h1><h2 id="引用-import"><a href="#引用-import" class="headerlink" title="引用 @import"></a>引用 <code>@import</code></h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 直接引用文件</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;index.css&quot;</span>, <span class="string">&quot;index2.scss&quot;</span>;   <span class="comment">// 导入多个文件</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;http://foo.com/bar&quot;</span>;</span><br><span class="line"><span class="keyword">@import</span> url(foo);</span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;_index.scss&quot;</span>;  <span class="comment">// 避免引入文件被编译</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;colors&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量插值</span></span><br><span class="line"><span class="variable">$device</span>: mobile;</span><br><span class="line"><span class="keyword">@import</span> url(styles.#&#123;<span class="variable">$device</span>&#125;<span class="selector-class">.css</span>);</span><br></pre></td></tr></table></figure>

<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  单行注释(不会被编译到css文件中);</span></span><br><span class="line"><span class="comment">/*  多行注释(在非压缩模式下会被编译到css文件中)  */</span></span><br><span class="line"><span class="comment">/*! 重要注释(各种压缩模式下都会被编译到css文件中)  */</span></span><br></pre></td></tr></table></figure>

<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ul>
<li><strong>变量名</strong>：以$开头,可用作选择器&#x2F;属性(值)&#x2F;字符串;</li>
<li><strong>变量值</strong>：数字、字符串(可不带引号)、布尔值、空值(null)、List(列表，类似数组)、Map(映射，类似对象)</li>
<li><strong>注意</strong>：当使用 #{} 时,带引号的字符串将被编译为 不带引号的字符串(为了便于使用);</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局颜色</span></span><br><span class="line"><span class="variable">$color-primary</span>: <span class="number">#3ecacb</span>;</span><br><span class="line"><span class="variable">$color-success</span>: <span class="number">#4fc48d</span>;</span><br><span class="line"><span class="variable">$color-warning</span>: <span class="number">#f3d93f</span>;</span><br><span class="line"><span class="variable">$color-danger</span>: <span class="number">#f6588e</span>;</span><br><span class="line"><span class="variable">$color-info</span>: <span class="number">#27c6fa</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局图片</span></span><br><span class="line"><span class="variable">$common-path</span>: <span class="string">&#x27;./primary/assets/img/&#x27;</span>;</span><br><span class="line"><span class="variable">$icon-see</span>: <span class="variable">$common-path</span> + <span class="string">&#x27;icon-see.png&#x27;</span>;</span><br><span class="line"><span class="variable">$icon-play</span>: <span class="variable">$common-path</span> + <span class="string">&#x27;icon-play.png&#x27;</span>;</span><br><span class="line"><span class="variable">$icon-comment</span>: <span class="variable">$common-path</span> + <span class="string">&#x27;icon-comment.png&#x27;</span>;</span><br><span class="line"><span class="variable">$icon-checkbox</span>: <span class="variable">$common-path</span> + <span class="string">&#x27;icon-checkbox.png&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础使用</span></span><br><span class="line"><span class="variable">$width</span>: <span class="number">1px</span>;             <span class="comment">// 全局变量(定义在所有选择器外)</span></span><br><span class="line"><span class="variable">$width2</span>: <span class="number">2px</span>;    </span><br><span class="line"><span class="variable">$width2</span>: <span class="number">3px</span> !default;   <span class="comment">// 默认变量(无值时起作用)</span></span><br><span class="line"><span class="variable">$pos</span>: bottom;</span><br><span class="line"><span class="selector-class">.aa</span> &#123;</span><br><span class="line">    <span class="variable">$fs</span>: <span class="number">14px</span>;           <span class="comment">// 局部变量(定义在选择器内)</span></span><br><span class="line">    <span class="variable">$lh</span>: <span class="number">1.5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">width</span>: <span class="variable">$width</span>;                  <span class="comment">// 常规使用($var)</span></span><br><span class="line">    <span class="attribute">border</span>-#&#123;<span class="variable">$pos</span>&#125;: <span class="number">1px</span> solid red;  <span class="comment">// 拼字符串(#&#123;$var&#125;)</span></span><br><span class="line">    <span class="attribute">font</span>: #&#123;<span class="variable">$fs</span>&#125;/#&#123;lh&#125; sans-serif;  <span class="comment">// 复杂属性值(#&#123;$var&#125;)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bb</span> &#123;</span><br><span class="line">    <span class="variable">$width</span>: <span class="number">3px</span> !global;            <span class="comment">// 覆盖全局变量</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="variable">$width</span> + <span class="variable">$width2</span>;        <span class="comment">// 用于计算($var + $var)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@mixin</span> link-style(<span class="variable">$sel</span>) &#123;</span><br><span class="line">    <span class="selector-tag">li</span> #&#123;<span class="variable">$sel</span>&#125; &#123;                    <span class="comment">// 作为选择器(#&#123;$var&#125;)</span></span><br><span class="line">        <span class="attribute">color</span>: red;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@include</span> link-style(<span class="string">&quot;a&quot;</span>);</span><br></pre></td></tr></table></figure>


<h2 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 选择器嵌套</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">    <span class="selector-tag">p</span> &#123; <span class="attribute">color</span>: green; &#125;</span><br><span class="line">    <span class="comment">// 使用 &amp; 表示在嵌套中对父元素的引用</span></span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123; <span class="attribute">color</span>: blue; &#125;</span><br><span class="line">    <span class="comment">// 选择器嵌套多层后让某个选择器跳出根元素</span></span><br><span class="line">    <span class="keyword">@at-root</span> .d &#123;  </span><br><span class="line">        <span class="attribute">color</span>: green;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 属性嵌套</span></span><br><span class="line"><span class="selector-class">.div</span> &#123;</span><br><span class="line">    <span class="comment">// 嵌套属性后须写冒号</span></span><br><span class="line">    <span class="attribute">border</span>: &#123;   </span><br><span class="line">        style: solid;</span><br><span class="line">        <span class="attribute">left</span>: &#123; <span class="attribute">width</span>: <span class="number">4px</span>; <span class="attribute">color</span>: <span class="number">#888</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="混合宏-mixin"><a href="#混合宏-mixin" class="headerlink" title="混合宏 @mixin"></a>混合宏 <code>@mixin</code></h2><ul>
<li>@mixin 定义可重用的代码段，@include 调用</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 无参 </span></span><br><span class="line"><span class="keyword">@mixin</span> aa &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bb</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> aa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数为数组 </span></span><br><span class="line"><span class="variable">$margin</span>: <span class="number">100px</span>;</span><br><span class="line"><span class="variable">$left</span>: <span class="number">10px</span>;</span><br><span class="line"><span class="keyword">@mixin</span> aa(<span class="variable">$left</span>, <span class="variable">$margin</span>) &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="variable">$margin</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="variable">$left</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bb</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> aa(<span class="variable">$left</span>, <span class="variable">$margin</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数为对象 </span></span><br><span class="line"><span class="variable">$map</span>: (left: <span class="number">10px</span>, width: <span class="number">100px</span>);</span><br><span class="line"><span class="keyword">@mixin</span> aa(<span class="variable">$left</span>, <span class="variable">$width</span>) &#123;</span><br><span class="line">    <span class="comment">// 接收参数为key值</span></span><br><span class="line">    <span class="attribute">left</span>: <span class="variable">$left</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="variable">$width</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> aa(<span class="variable">$map</span>...); <span class="comment">// 传递参数为对象名+...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认参数(不传参数时会用默认参数)</span></span><br><span class="line"><span class="keyword">@mixin</span> aa(<span class="variable">$left</span>: <span class="number">10px</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不定参数 </span></span><br><span class="line"><span class="keyword">@mixin</span> box-shadow(<span class="variable">$shadows</span>...) &#123;</span><br><span class="line">    <span class="comment">// 不定参数用 ...</span></span><br><span class="line">    -moz-<span class="attribute">box-shadow</span>: <span class="variable">$shadows</span>;</span><br><span class="line">    -webkit-<span class="attribute">box-shadow</span>: <span class="variable">$shadows</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="variable">$shadows</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.shadows</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> box-shadow(<span class="number">2px</span> <span class="number">2px</span> <span class="number">2px</span> <span class="number">#eee</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 浏览器前缀设置 </span></span><br><span class="line"><span class="keyword">@mixin</span> rounded(<span class="variable">$vert</span>, <span class="variable">$horz</span>, <span class="variable">$radius</span>: <span class="number">10px</span>) &#123;</span><br><span class="line">    <span class="attribute">border</span>-#&#123;<span class="variable">$vert</span>&#125;-#&#123;<span class="variable">$horz</span>&#125;-radius: <span class="variable">$radius</span>;</span><br><span class="line">    -moz-<span class="attribute">border-radius</span>-#&#123;<span class="variable">$vert</span>&#125;#&#123;<span class="variable">$horz</span>&#125;: <span class="variable">$radius</span>;</span><br><span class="line">    -webkit-<span class="attribute">border</span>-#&#123;<span class="variable">$vert</span>&#125;-#&#123;<span class="variable">$horz</span>&#125;-radius: <span class="variable">$radius</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#navbar</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> rounded(top, left);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#footer</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> rounded(top, left, <span class="number">5px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="继承-extend"><a href="#继承-extend" class="headerlink" title="继承 @extend"></a>继承 <code>@extend</code></h2><ul>
<li>不管是否调用，基类的样式都将会出现在编译出来的 CSS 代码中</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-bor</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-red</span> &#123;</span><br><span class="line">    <span class="keyword">@extend</span> .btn; <span class="comment">//多个扩展</span></span><br><span class="line">    <span class="keyword">@extend</span> .btn-bor !optional; </span><br><span class="line">    <span class="comment">// 用optional直接跳过空样式,防止元素不存在而导致报错</span></span><br><span class="line">    <span class="attribute">border-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hoverlink</span> &#123;</span><br><span class="line">    <span class="keyword">@extend</span> <span class="attribute">a</span>:<span class="attribute">hover</span>;   <span class="comment">//@extend可扩展任何选择器</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配合占位选择器(%扩展单一选择器,编译后不在css)使用</span></span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">div</span>%box &#123;</span><br><span class="line">    -webkit-<span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    -moz-<span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bor-box</span> &#123;</span><br><span class="line">    <span class="keyword">@extend</span> %box; <span class="comment">//此时才会编译产生</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 编译为 .container div.bor-box &#123; &#125; </span></span><br></pre></td></tr></table></figure>


<h2 id="占位符-placeholder"><a href="#占位符-placeholder" class="headerlink" title="占位符 %placeholder"></a>占位符 <code>%placeholder</code></h2><ul>
<li>一个独立定义的声明块，不调用时不会编译生成 CSS</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">%mt&#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">5px</span>;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.block</span> &#123;</span><br><span class="line">    <span class="keyword">@extend</span> %mt;</span><br><span class="line">    <span class="selector-tag">span</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>:block;</span><br><span class="line">        <span class="keyword">@extend</span> %mt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: orange;</span><br><span class="line">    <span class="keyword">@extend</span> %mt;</span><br><span class="line">    <span class="selector-tag">span</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>:block;</span><br><span class="line">        <span class="keyword">@extend</span> %mt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、进阶语法"><a href="#三、进阶语法" class="headerlink" title="三、进阶语法"></a>三、进阶语法</h1><h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><ul>
<li>可单独使用或结合 @else (if) 使用</li>
<li>使用 not&#x2F;or&#x2F;and 分别表示非&#x2F;或&#x2F;与，如 @if not($var)</li>
<li>使用 !&#x3D;&#x2F;&#x3D;&#x3D; 分别表示(不)等于，如 @if $a !&#x3D;0</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@mixin</span> blockOrHidden(<span class="variable">$boolean</span>:true) &#123;</span><br><span class="line">    <span class="keyword">@if</span> <span class="variable">$boolean</span> &#123;</span><br><span class="line">        <span class="keyword">@debug</span> <span class="string">&quot;$boolean is #&#123;$boolean&#125;&quot;</span>;</span><br><span class="line">        <span class="attribute">display</span>: block; <span class="comment">//参数为真，显示</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@else</span> &#123;</span><br><span class="line">        <span class="keyword">@debug</span> <span class="string">&quot;$boolean is #&#123;$boolean&#125;&quot;</span>;</span><br><span class="line">        <span class="attribute">display</span>: none; <span class="comment">//参数为假，不显示</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.block</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> blockOrHidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hidden</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> blockOrHidden(false);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<h2 id="循环-list-x2F-map"><a href="#循环-list-x2F-map" class="headerlink" title="循环 list&#x2F;map"></a>循环 list&#x2F;map</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// list(用空格/逗号隔开项):</span></span><br><span class="line"><span class="variable">$name</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>;</span><br><span class="line"><span class="variable">$px</span>: <span class="number">5px</span> <span class="number">10px</span> <span class="number">15px</span> <span class="number">20px</span>; </span><br><span class="line"><span class="variable">$sel2</span>: (sel1: <span class="string">&quot;span&quot;</span>, sel2: <span class="string">&quot;div&quot;</span>) </span><br><span class="line"></span><br><span class="line">// Map</span><br><span class="line"><span class="variable">$map</span>: (key1: <span class="number">1</span>, key2: <span class="number">2</span>, key3: <span class="number">3</span>);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// for循环</span></span><br><span class="line"><span class="keyword">@for</span> <span class="variable">$var</span> from &lt;start&gt; through &lt;end&gt; // 包含end值</span><br><span class="line"><span class="keyword">@for</span> <span class="variable">$var</span> from &lt;start&gt; to &lt;end&gt;      // 不包含end值</span><br><span class="line">  </span><br><span class="line">// each循环:</span><br><span class="line"><span class="keyword">@each</span> <span class="variable">$var</span> in list/map</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// while</span><br><span class="line"><span class="variable">$i</span>: <span class="number">2</span>;</span><br><span class="line"><span class="keyword">@while</span> <span class="variable">$i</span>&gt;<span class="number">0</span> &#123;   	<span class="comment">// 条件为 true 就会执行</span></span><br><span class="line">    <span class="selector-class">.color</span>#&#123;<span class="variable">$i</span>&#125; &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#222</span> * <span class="variable">$i</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$i</span>:<span class="variable">$i</span> - <span class="number">1</span>;     <span class="comment">// 不能写成 $i:$i-1，因为会被当成字符串</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for循环 </span></span><br><span class="line"><span class="variable">$arr</span>: ( (theme: dark, size: <span class="number">40px</span>), </span><br><span class="line">    (theme: light, size: <span class="number">32px</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">@for</span> <span class="variable">$i</span> from <span class="number">1</span> through length(<span class="variable">$arr</span>) &#123;</span><br><span class="line">    <span class="variable">$item</span>: <span class="built_in">nth</span>(<span class="variable">$arr</span>, <span class="variable">$i</span>);             <span class="comment">// 获取数组中第i项的值</span></span><br><span class="line">    .#&#123;<span class="built_in">map-get</span>($item, theme)&#125; &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="built_in">map-get</span>(<span class="variable">$item</span>, size);  <span class="comment">// 获取指定键值</span></span><br><span class="line">        <span class="attribute">height</span>: <span class="built_in">map-get</span>(<span class="variable">$item</span>, size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// each循环</span></span><br><span class="line"><span class="variable">$margins</span>: <span class="number">5px</span> <span class="number">10px</span>, <span class="number">15px</span> <span class="number">20px</span>;    <span class="comment">// 两个项</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="built_in">nth</span>(<span class="variable">$margins</span>, <span class="number">1</span>) <span class="built_in">nth</span>(<span class="variable">$margins</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="built_in">nth</span>(<span class="variable">$margins</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$sel2</span>: (sel1: <span class="string">&quot;span&quot;</span>, sel2: <span class="string">&quot;div&quot;</span>);  <span class="comment">// Map形式</span></span><br><span class="line"><span class="keyword">@each</span> <span class="variable">$s</span> in <span class="variable">$sel2</span> &#123;</span><br><span class="line">    .#&#123;<span class="variable">$s</span>&#125; &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$headers</span>: (h1:<span class="number">2em</span>, h2:<span class="number">1.5em</span>, h3:<span class="number">1.2em</span>);</span><br><span class="line"><span class="keyword">@each</span> <span class="variable">$header</span>, <span class="variable">$size</span> in <span class="variable">$headers</span> &#123;</span><br><span class="line">    #&#123;<span class="variable">$header</span>&#125; &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="variable">$size</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="函数和运算"><a href="#函数和运算" class="headerlink" title="函数和运算"></a>函数和运算</h2><ol>
<li><strong>自定义</strong><br>* @fuction 定义，@return 返回结果</li>
<li><strong>三元条件</strong><br>* if($condition, $if-true, $if-false)：条件成立时返回值1，否则返回值2</li>
<li><strong>颜色</strong><br>* rgb&#x2F;rgba()：创建颜色<br>* alpha&#x2F;opacity($color)：获取颜色透明度值<br>* rgba($color, $alpha)：改变颜色透明度值<br>* mix($color1, $color2, [$weight])：混合颜色<br>* lighten&#x2F;darken($color, $percent)：变浅&#x2F;加深</li>
<li><strong>数字</strong><br>* random()：随机数<br>* min&#x2F;max($nums…)：最小值&#x2F;最大值<br>* floor&#x2F;ceil($value)：向下&#x2F;上整数<br>* percentage&#x2F;abs&#x2F;round($val)：百分比值&#x2F;绝对值&#x2F;取整</li>
<li><strong>字符串</strong><br>* quote&#x2F;unquote($string)：给字符串添加&#x2F;删除引号<br>* to-upper&#x2F;lower-case()：字符串大小写字母转换</li>
<li><strong>List</strong><br>* length($list)：获取长度<br>* nth($list, i)：获取列表项（索引i从1开始）<br>* append($px, 11px)：添加新值<br>* join($list1, $list2)：列表合并<br>* zip($lists…)：合并多个表为多维列表<br>* index($list, $value)：返回该值在列表中的索引	</li>
<li><strong>Map</strong><br>* map-keys&#x2F;values($map)：获取所有key&#x2F;values<br>* map-get&#x2F;remove($map, key)：获取&#x2F;删除指定项<br>* map-has-key($map, key)：判断是否有key<br>* map-merge($map1, $map2)：合并map<br>* keywords($args)：返回函数参数(可动态设置key和value)</li>
<li><strong>Introspection</strong><br>* type-of($value)：返回值的类型<br>* unit($number)：返回值的单位<br>* unitless($number)：判断该值是否带有单位<br>* commparable($num, $num)：判断两个值是否可做加减和合并</li>
</ol>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@function</span> colors(<span class="variable">$color</span>) &#123;</span><br><span class="line">    <span class="variable">$names</span>: <span class="built_in">map-keys</span>(<span class="variable">$social-colors</span>);</span><br><span class="line">    <span class="keyword">@if</span> <span class="keyword">not</span> index(<span class="variable">$names</span>, <span class="variable">$color</span>) &#123;</span><br><span class="line">        <span class="keyword">@warn</span> <span class="string">&quot;Waring: `#&#123;$color&#125; is not a valid color name.`&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@return</span> map-get(<span class="variable">$social-colors</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-weibo</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">colors</span>(weibo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$social-colors</span>: (</span><br><span class="line">    dribble: <span class="number">#ea4c89</span>,</span><br><span class="line">    facebook: <span class="number">#3b5998</span>,</span><br><span class="line">    github: <span class="number">#171515</span>,</span><br><span class="line">    google: <span class="number">#db4437</span>,</span><br><span class="line">    twitter: <span class="number">#55acee</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">@each</span> <span class="variable">$name</span> in map-keys(<span class="variable">$social-colors</span>) &#123;</span><br><span class="line">    <span class="selector-class">.btn-</span>#&#123;<span class="variable">$name</span>&#125; &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">colors</span>(<span class="variable">$name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@for</span> <span class="variable">$i</span> from <span class="number">1</span> through length(map-keys(<span class="variable">$social-colors</span>)) &#123;</span><br><span class="line">    <span class="selector-class">.btn-</span>#&#123;<span class="built_in">nth</span>(map-keys($social-colors), <span class="variable">$i</span>)&#125; &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">colors</span>(<span class="built_in">nth</span>(<span class="built_in">map-keys</span>(<span class="variable">$social-colors</span>), <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 类似于控制台输出信息</span></span><br><span class="line"><span class="keyword">@debug</span> <span class="string">&#x27;This is adebug&#x27;</span>;</span><br><span class="line"><span class="keyword">@warn</span> <span class="string">&#x27;Warn&#x27;</span>;</span><br><span class="line"><span class="keyword">@error</span> <span class="string">&#x27;Error&#x27;</span>;</span><br></pre></td></tr></table></figure>


<h1 id="四、相关插件"><a href="#四、相关插件" class="headerlink" title="四、相关插件"></a>四、相关插件</h1><h2 id="stylelint-样式代码检查"><a href="#stylelint-样式代码检查" class="headerlink" title="stylelint 样式代码检查"></a>stylelint 样式代码检查</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">npm install gulp stylelint gulp-postscss  postcss-reporter </span><br><span class="line">stylelint-config-standard --save-dev</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根目录新建 gulpfile.js</span></span><br><span class="line"><span class="keyword">var</span> reporter = <span class="built_in">require</span>(<span class="string">&#x27;postcss-reporter&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> stylelint = <span class="built_in">require</span>(<span class="string">&#x27;stylelint&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> stylelintConfig = &#123; </span><br><span class="line">    <span class="comment">// 标准校验规则插件，具体校验规则可查看官网</span></span><br><span class="line">    <span class="string">&#x27;extends&#x27;</span>: <span class="string">&#x27;stylelint-config-standard&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;rules&#x27;</span>: &#123;    </span><br><span class="line">        <span class="string">&#x27;at-rule-no-unknown&#x27;</span>: [</span><br><span class="line">            <span class="literal">true</span>, </span><br><span class="line">            &#123;<span class="string">&#x27;ignoreAtRules&#x27;</span>: [<span class="string">&#x27;extend&#x27;</span>, <span class="string">&#x27;include&#x27;</span>, <span class="string">&#x27;mixin&#x27;</span>, <span class="string">&#x27;for&#x27;</span>]&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;scss-lint&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="keyword">var</span> processors = [    </span><br><span class="line">        <span class="title function_">stylelint</span>(stylelintConfig),    </span><br><span class="line">        <span class="title function_">reporter</span>(&#123;      </span><br><span class="line">            <span class="attr">clearMessages</span>: <span class="literal">true</span>,      </span><br><span class="line">            <span class="attr">throwError</span>: <span class="literal">true</span>    </span><br><span class="line">        &#125;)  </span><br><span class="line">    ];  </span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(  </span><br><span class="line">        [<span class="string">&#x27;src/style/*.scss&#x27;</span>]       <span class="comment">// 需要工具检查的 scss 文件 </span></span><br><span class="line">    ).<span class="title function_">pipe</span>(<span class="title function_">postcss</span>(processors));</span><br><span class="line">&#125;);</span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;default&#x27;</span>, [<span class="string">&#x27;scss-lint&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="stylefmt-样式自动修复"><a href="#stylefmt-样式自动修复" class="headerlink" title="stylefmt 样式自动修复"></a>stylefmt 样式自动修复</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一个基于 stylelint 的代码修正工具，它支持基于 stylelint 的代码规范约定配置，</span></span><br><span class="line"><span class="comment">// 对可修正的地方作格式化输出。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// gulpfile.js</span></span><br><span class="line"><span class="keyword">var</span> stylefmt = <span class="built_in">require</span>(<span class="string">&#x27;gulp-stylefmt&#x27;</span>);</span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;stylefmt&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>([<span class="string">&#x27;src/style/student/index.scss&#x27;</span>])</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">stylefmt</span>(stylelintConfig))</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;src/style/dest/student&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;fix&#x27;</span>, [<span class="string">&#x27;stylefmt&#x27;</span>]);</span><br></pre></td></tr></table></figure>


<h2 id="gulp-sass-编译-scss-语法"><a href="#gulp-sass-编译-scss-语法" class="headerlink" title="gulp-sass 编译 scss 语法"></a>gulp-sass 编译 scss 语法</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// gulpfile.js</span></span><br><span class="line"><span class="keyword">var</span> gulpsass = <span class="built_in">require</span>(<span class="string">&#x27;gulp-sass&#x27;</span>);</span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;gulpsass&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;src/style/components/hwIcon.scss&#x27;</span>)    </span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">gulpsass</span>().<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, gulpsass.<span class="property">logError</span>))   </span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;src/style/dest&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;watch&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    gulp.<span class="title function_">watch</span>(<span class="string">&#x27;src/style/components/hwIcon.scss&#x27;</span>, [<span class="string">&#x27;gulpsass&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>








]]></content>
      <categories>
        <category>HTML CSS</category>
      </categories>
      <tags>
        <tag>HTML CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS 样式</title>
    <url>/2019/05/08/3-2-css/</url>
    <content><![CDATA[<h1 id="一、浏览器兼容"><a href="#一、浏览器兼容" class="headerlink" title="一、浏览器兼容"></a>一、浏览器兼容</h1><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ul>
<li>img 之间出现间距：浮动。</li>
<li>上下 margin 重合问题：上下选一个。</li>
<li>opacity、placeholder、outline、伪元素、z-index：<code>css hack</code>。</li>
<li>li 元素使用 display: inline-block 时会出现缝隙：<code>浮动、font-size: 0</code>。</li>
<li>子元素的 margin-top 会出现在父元素的上方：父元素 <code>overflow: hidden / border: 1px solid transparent / padding-top</code>。</li>
</ul>
<h2 id="css-hack"><a href="#css-hack" class="headerlink" title="css hack"></a>css hack</h2><blockquote>
<p>针对不同的浏览器写不同的 CSS 来解决浏览器兼容。</p>
</blockquote>
<ul>
<li>选择器前缀法：@media screen</li>
<li>CSS 属性前缀法：-webkit-、-moz-、-ms-、-o-</li>
<li>IE 条件注释语句：解决 IE 兼容问题</li>
</ul>
<h1 id="二、CSS3"><a href="#二、CSS3" class="headerlink" title="二、CSS3"></a>二、CSS3</h1><h2 id="css-单位"><a href="#css-单位" class="headerlink" title="css 单位"></a>css 单位</h2><ul>
<li><strong>rem</strong>: 相对于根元素字体尺寸</li>
<li><strong>em</strong>: 相对于父级元素的字体尺寸</li>
<li><strong>%</strong>: 百分比，相对于父元素的尺寸</li>
<li><strong>px</strong>: 像素，相对于用户设备分辨率的最基本单元</li>
<li>pt：Word等办公软件中使用的字体大小单位</li>
<li>dp：安卓开发时使用的长度单位</li>
<li>sp：安卓开发时使用的字体大小单位</li>
<li>vw：视窗宽度，1vw等于视窗宽度的 1%</li>
<li>vh：视窗高度，1vh等于视窗高度的 1%</li>
<li>vmin &#x2F; vmax：vw和vh中较 小&#x2F;大 的那个</li>
</ul>
<h2 id="引用字体"><a href="#引用字体" class="headerlink" title="引用字体"></a>引用字体</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;                       </span><br><span class="line">    <span class="attribute">font-family</span>: ArtifaktBlod;     </span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;fonts/ArtifaktElementOfc-Bold.ttf&#x27;</span>);    </span><br><span class="line">&#125;  </span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: ArtifaktBlod;          </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h2><ol>
<li><strong>转换属性</strong><br>* transform-origin：指定元素变换的中心点<br>* transform-style：指定场景为 2D 或 3D<br>* perspective：指定 3D 的视距<br>* perspective-origin：设置视距的基点<br>* backface-visibility：是否可以看见 3D 场景背面</li>
<li><strong>2D变换</strong><br>* translate：位移，translate &#x2F; translateX &#x2F; translateY<br>* scale：缩放，scale &#x2F; scaleX &#x2F; scaleY<br>* rotate：旋转，rotate<br>* skew：变形，skew &#x2F; skewX &#x2F; skewY<br>* matrix：矩阵，是所有 2D 变换的本质</li>
<li><strong>3D变换</strong><br>* translate3d：位移，translate3d &#x2F; translateZ<br>* scale3d：缩放，scale3d &#x2F; scaleZ<br>* rotate3d：旋转，rotate3d &#x2F; rotateX &#x2F; rotateY &#x2F; rotateZ<br>* matrix3d：矩阵，是所有 3D 变换的本质</li>
</ol>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.img</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">30deg</span>);</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">200px</span> <span class="number">300px</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等价于 </span></span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">200px</span>, <span class="number">300px</span>) </span><br><span class="line">              <span class="built_in">rotate</span>(<span class="number">30deg</span>)</span><br><span class="line">              <span class="built_in">translate</span>(-<span class="number">200px</span>, -<span class="number">300px</span>); </span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">transform-style</span>: preserve-<span class="number">3</span>d;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* perspective() 配合 transform 其他函数一起使用，</span></span><br><span class="line"><span class="comment">    仅表示当前变形元素的视距 */</span></span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">perspective</span>(<span class="number">200px</span>) <span class="built_in">rotateY</span>(<span class="number">45deg</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// perspective 指定子元素共享的视距 </span></span><br><span class="line">    <span class="attribute">perspective</span>: <span class="number">100px</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// center表示眼睛在场景正中心</span></span><br><span class="line">    <span class="attribute">perspective-origin</span>: center;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">img</span> &#123;</span><br><span class="line">        <span class="comment">// 父元素不指定 3D 则失效 </span></span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translateZ</span>(<span class="number">16px</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 让背面不可见，旋转时常用</span></span><br><span class="line">        <span class="attribute">backface-visibility</span>: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="transition-过渡"><a href="#transition-过渡" class="headerlink" title="transition 过渡"></a>transition 过渡</h2><ol>
<li><strong>过渡效果</strong>：默认样式中定义元素的初始样式和过渡函数，然后定义过渡后的元素样式</li>
<li><strong>缩写语法</strong>：<code>transition：过渡属性 过渡时间 [过渡曲线] [时间延迟]</code></li>
</ol>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: orange;</span><br><span class="line">    <span class="comment">/* transition: width 1s ease-in, backgroundColor 1s ease-in; */</span></span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">1s</span> ease-in .<span class="number">2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="animation-动画"><a href="#animation-动画" class="headerlink" title="animation 动画"></a>animation 动画</h2><ol>
<li><strong>动画效果</strong>：通过 animation 绑定 @keyframes 定义的动画，自动实现一种或多种形态同时变化的效果</li>
<li><strong>动画定义</strong>：<code>@keyframes 动画名&#123; 百分比 或 from、to &#125;</code></li>
<li><strong>动画绑定</strong>：<code>animation: 动画名 时间 动画曲线 延迟时间 播放次数 是否逆向播放 [非动画时间的状态]</code></li>
<li><strong>动画暂停</strong>：<code>animation-play-state: paused;</code></li>
</ol>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123; </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#f00</span>; </span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">36px</span>; </span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> change &#123;</span><br><span class="line">    <span class="number">0%</span>   &#123; <span class="attribute">text-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="number">#f00</span> &#125;</span><br><span class="line">    <span class="number">50%</span>  &#123; <span class="attribute">text-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">40px</span> <span class="number">#f00</span> &#125;</span><br><span class="line">    <span class="number">100%</span> &#123; <span class="attribute">text-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="number">#f00</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: change <span class="number">1s</span> ease-in infinite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-class">.stop</span> &#123;</span><br><span class="line">    <span class="attribute">animation-play-state</span>: paused;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、组件样式"><a href="#三、组件样式" class="headerlink" title="三、组件样式"></a>三、组件样式</h1><blockquote>
<p>只在当前组件生效，不影响全局样式。</p>
</blockquote>
<h2 id="Scoped"><a href="#Scoped" class="headerlink" title="Scoped"></a>Scoped</h2><blockquote>
<p>缺点：可能影响其它相同类名的组件样式而不能完全避免冲突、增加了每个样式的权重而导致必须全局修改、增加了标签渲染时间。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在元素中添加了一个唯一属性用来区分 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#f00</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h1</span><span class="selector-attr">[data-v-4c3b6c1c]</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#f00</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><blockquote>
<p>CSS 模块化的一种方式而并非官方标准和浏览器的特性，它重新生成类名而有效避开了 css 权重和类名重复的问题。注意它需要安装 css-loader 插件并进行配置 (Vue 等框架已经集成)，所有类名都要通过 :class 进行绑定。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;css.wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">:class</span>=<span class="string">&quot;css.input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">module</span>=<span class="string">&quot;css&quot;</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input</span> &#123; &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// css-loader 默认配置</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">modules</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">importLoaders</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">localIdentName</span>: <span class="string">&#x27;[hash:base64]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 vue-loader 自定义配置</span></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="string">&#x27;\.vue$&#x27;</span>,</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;vue-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">cssModules</span>: &#123;</span><br><span class="line">          <span class="comment">// 格式化类名：当前文件名、当前类名、hash 字符串</span></span><br><span class="line">          <span class="attr">localIdentName</span>: <span class="string">&#x27;[name]**[local]-[hash:base64:5]&#x27;</span>,</span><br><span class="line">          <span class="comment">// only 只支持驼峰绑定类名，true 支持驼峰和中括号</span></span><br><span class="line">          <span class="attr">camelCase</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="四、PC-端样式"><a href="#四、PC-端样式" class="headerlink" title="四、PC 端样式"></a>四、PC 端样式</h1><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* reset.css  */</span></span><br><span class="line"><span class="selector-tag">body</span>, <span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>, hr, <span class="selector-tag">p</span>, <span class="selector-tag">blockquote</span>, <span class="selector-tag">dl</span>, <span class="selector-tag">dt</span>, <span class="selector-tag">dd</span>, <span class="selector-tag">ul</span>, <span class="selector-tag">ol</span>, <span class="selector-tag">li</span>, pre, <span class="selector-tag">form</span>, <span class="selector-tag">fieldset</span>, <span class="selector-tag">legend</span>, <span class="selector-tag">button</span>, <span class="selector-tag">input</span>, <span class="selector-tag">textarea</span>, <span class="selector-tag">th</span>, <span class="selector-tag">td</span> &#123; <span class="attribute">margin</span>:<span class="number">0</span>; <span class="attribute">padding</span>:<span class="number">0</span>; &#125; </span><br><span class="line"><span class="selector-tag">body</span>, <span class="selector-tag">button</span>, <span class="selector-tag">input</span>, select, <span class="selector-tag">textarea</span> &#123; <span class="attribute">font</span>:<span class="number">12px</span>/<span class="number">1.5</span>tahoma, arial, \<span class="number">5</span>b8b\<span class="number">4</span>f53; &#125; </span><br><span class="line"><span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>&#123; <span class="attribute">font-size</span>:<span class="number">100%</span>; &#125; </span><br><span class="line"><span class="selector-tag">address</span>, <span class="selector-tag">cite</span>, <span class="selector-tag">dfn</span>, <span class="selector-tag">em</span>, <span class="selector-tag">var</span> &#123; <span class="attribute">font-style</span>:normal; &#125; </span><br><span class="line"><span class="selector-tag">code</span>, <span class="selector-tag">kbd</span>, pre, <span class="selector-tag">samp</span> &#123; <span class="attribute">font-family</span>:couriernew, courier, monospace; &#125; </span><br><span class="line">small&#123; <span class="attribute">font-size</span>:<span class="number">12px</span>; &#125; </span><br><span class="line"><span class="selector-tag">ul</span>, <span class="selector-tag">ol</span> &#123; <span class="attribute">list-style</span>:none; &#125; </span><br><span class="line"><span class="selector-tag">a</span> &#123; <span class="attribute">text-decoration</span>:none; <span class="attribute">color</span>: <span class="number">#3D3F40</span>; &#125; </span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123; <span class="attribute">color</span>: <span class="number">#62B060</span>; &#125; </span><br><span class="line"><span class="selector-tag">sup</span> &#123; <span class="attribute">vertical-align</span>:text-top; &#125; </span><br><span class="line">sub&#123; <span class="attribute">vertical-align</span>:text-bottom; &#125; </span><br><span class="line"><span class="selector-tag">fieldset</span>, <span class="selector-tag">img</span> &#123; <span class="attribute">border</span>:<span class="number">0</span>; &#125; </span><br><span class="line"><span class="selector-tag">button</span>, <span class="selector-tag">input</span>, select, <span class="selector-tag">textarea</span> &#123; <span class="attribute">font-size</span>:<span class="number">100%</span>; &#125; </span><br><span class="line"><span class="selector-tag">table</span> &#123; <span class="attribute">border-collapse</span>:collapse; <span class="attribute">border-spacing</span>:<span class="number">0</span>; &#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">    -webkit-<span class="attribute">font-smoothing</span>: antialiased;  <span class="comment">/* 设置字体平滑 */</span></span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&quot;Microsoft YaHei&quot;</span>, <span class="string">&#x27;Muli&#x27;</span>, <span class="string">&quot;Helvetica&quot;</span>, Arial, sans-serif;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="滚动条"><a href="#滚动条" class="headerlink" title="滚动条"></a>滚动条</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*  定义滚动条样式   */</span>   </span><br><span class="line">::-webkit-scrollbar &#123;   </span><br><span class="line"><span class="comment">/* ::-webkit-scrollbar:horizontal  */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">10px</span>;   </span><br><span class="line">    <span class="attribute">height</span>: <span class="number">10px</span>;  <span class="comment">/*  高宽分别对应横竖滚动条的尺寸  */</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#F5F5F5</span>;   </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">/*定义滚动条轨道 内阴影+圆角*/</span>   </span><br><span class="line">::-webkit-scrollbar-track &#123;   </span><br><span class="line">    <span class="attribute">box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.3</span>);     </span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;   </span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#F5F5F5</span>;   </span><br><span class="line">&#125;   </span><br><span class="line"><span class="comment">/*定义滑块 内阴影+圆角*/</span>   </span><br><span class="line">::-webkit-scrollbar-thumb &#123;   </span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;   </span><br><span class="line">    <span class="attribute">box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">3</span>);   </span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#C0C0C0</span>;   </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>


<h2 id="元素居中"><a href="#元素居中" class="headerlink" title="元素居中"></a>元素居中</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="selector-class">.child</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="selector-class">.child</span> &#123;</span><br><span class="line">        justify-self: center;</span><br><span class="line">        <span class="attribute">align-self</span>: center;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    &amp;<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.child</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="布局方式"><a href="#布局方式" class="headerlink" title="布局方式"></a>布局方式</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 左边固定右边自适应的两列布局（定位和flex方式略） */</span></span><br><span class="line"><span class="selector-class">.parent</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;            </span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;               </span><br><span class="line">    <span class="attribute">visibility</span>: hidden;     </span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.parent</span> &#123;  </span><br><span class="line">    *zoom : <span class="number">1</span>      </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">120px</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 两边固定中间自适应的三列布局 (浮动和定位略) */</span></span><br><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span>,<span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.middle</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">200px</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 移动端窗口居中布局 */</span></span><br><span class="line"><span class="selector-class">.text_box</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#eff1f2</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50vh</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text_box</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50vh</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="瀑布流布局"><a href="#瀑布流布局" class="headerlink" title="瀑布流布局"></a>瀑布流布局</h2><div style="text-indent: 2em">原理是页面容器内的多个高度不固定的 div 之间按照一定的间隔参差不齐的无序浮动，鼠标滚动时不断在容器内的尾部加载数据并自动加载到空缺位置，不断循环。</div>
<div style="text-indent: 2em">核心是基于一个网格的布局，而且每行包含的项目列表高度是随机的（随自身内容动态改变高度），同时每个项目列表呈堆栈形式排列，最关键的是，堆栈之间彼此之间没有多余的间距差存大。</div>

  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 大层 */</span></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 瀑布流层 */</span></span><br><span class="line"><span class="selector-class">.waterfall</span> &#123;</span><br><span class="line">    <span class="attribute">column-count</span>: <span class="number">4</span>;</span><br><span class="line">    <span class="attribute">column-gap</span>: <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 一个内容层 */</span></span><br><span class="line"><span class="selector-class">.item</span> &#123; </span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    -webkit-column-<span class="attribute">break-inside</span>: avoid; <span class="comment">/* Chrome, Safari, Opera */</span></span><br><span class="line">    <span class="attribute">page-break-inside</span>: avoid;  <span class="comment">/* Firefox */</span></span><br><span class="line">    <span class="attribute">break-inside</span>: avoid;       <span class="comment">/* IE 10+ */</span></span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>:<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="表单元素"><a href="#表单元素" class="headerlink" title="表单元素"></a>表单元素</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 清除默认框 */</span></span><br><span class="line"><span class="selector-tag">input</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: none / <span class="number">0</span> ;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 清除下拉框默认选择样式 */</span></span><br><span class="line">select&#123;</span><br><span class="line">    appearance: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 隐藏下拉箭头 */</span></span><br><span class="line">select::-ms-expand &#123; </span><br><span class="line">    <span class="attribute">display</span>: none; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 应用于有焦点的元素(输入框, 超链接)具有焦点的时间内*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:focus</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123; </span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">1px</span>  dotted red; </span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:focus</span>&#123; </span><br><span class="line">    <span class="attribute">background</span>: yellow; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* placeholder 颜色 */</span></span><br><span class="line">::-webkit-input-placeholder&#123;  </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#d3d3d3</span>; </span><br><span class="line">&#125; </span><br><span class="line">:-moz-placeholder&#123;  </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#d3d3d3</span>; </span><br><span class="line">&#125; </span><br><span class="line">::-moz-placeholder&#123; </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#d3d3d3</span>;</span><br><span class="line">&#125; </span><br><span class="line">:-ms-input-placeholder&#123;  </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#d3d3d3</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<h2 id="文本对齐"><a href="#文本对齐" class="headerlink" title="文本对齐"></a>文本对齐</h2><blockquote>
<p>一行居中、多行左对齐</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">text-align</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文本超出省略"><a href="#文本超出省略" class="headerlink" title="文本超出省略"></a>文本超出省略</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 单行文本 */</span></span><br><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;  </span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;  </span><br><span class="line">    <span class="attribute">word-break</span>: break-all;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 多行文本 */</span></span><br><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">word-break</span>: break-all;</span><br><span class="line">    <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">    line-clamp: <span class="number">3</span>;</span><br><span class="line">    -webkit-line-clamp: <span class="number">3</span>;</span><br><span class="line">    -webkit-box-orient: vertical;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 跨浏览器兼容方法 */</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">42px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;...&quot;</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20px</span> <span class="number">1px</span> <span class="number">45px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">ellipsis_bg.png</span>) repeat-y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="常用特殊图形"><a href="#常用特殊图形" class="headerlink" title="常用特殊图形"></a>常用特殊图形</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 三角形：原理是相邻边框连接处是均分</span></span><br><span class="line"><span class="selector-class">.triangle</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">50px</span> solid black;</span><br><span class="line">    <span class="attribute">border-right</span>: <span class="number">50px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">50px</span> solid transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头</span></span><br><span class="line"><span class="selector-class">.border-triangle-top</span>(@brcolor: #fbfdff, @bgcolor: #fff, </span><br><span class="line">@brwidth: <span class="number">8px</span>, @width: <span class="number">100%</span>, @height: <span class="number">40px</span>) &#123;</span><br><span class="line">    <span class="attribute">width</span>: @width;</span><br><span class="line">    <span class="attribute">height</span>: @height;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    &amp;<span class="selector-pseudo">:after</span>,</span><br><span class="line">    &amp;<span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">border</span>: @brwidth solid transparent;</span><br><span class="line">        <span class="attribute">border-bottom-color</span>: @brcolor;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">margin-left</span>: -@brwidth;</span><br><span class="line">        <span class="attribute">top</span>: -@brwidth * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">        <span class="attribute">border-bottom-color</span>: @bgcolor;</span><br><span class="line">        <span class="attribute">top</span>: -@brwidth * <span class="number">2</span> + <span class="number">1px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-triangle-bottom</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">5px</span> <span class="number">#d9d9d9</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">18px</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-tag">span</span>&#123;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">text-align</span>: left;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">        &amp;<span class="selector-class">.t-left</span>&#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-pseudo">:after</span>,</span><br><span class="line">    &amp;<span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">border</span>: <span class="number">4px</span> solid transparent;</span><br><span class="line">        <span class="attribute">border-top-color</span>: <span class="number">#d9d9d9</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">margin-left</span>: -<span class="number">4px</span>;</span><br><span class="line">        <span class="attribute">bottom</span>: -<span class="number">8px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">        <span class="attribute">border-top-color</span>: <span class="number">#fff</span>;</span><br><span class="line">        <span class="attribute">bottom</span>: -<span class="number">7px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;div class=&quot;title&quot; data-title=&quot;hello world&quot;&gt;title悬浮框&lt;/div&gt;</span></span><br><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.title</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">attr</span>(data-title);</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 半圆</span></span><br><span class="line"><span class="selector-class">.semi-circle</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50px</span> <span class="number">50px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 半椭圆</span></span><br><span class="line"><span class="selector-class">.semiellipse</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">100%</span> <span class="number">0</span> <span class="number">0</span> <span class="number">100%</span> /<span class="number">50%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 椭圆</span></span><br><span class="line"><span class="selector-class">.ellipse</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50px</span>/<span class="number">25px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 梯形</span></span><br><span class="line"><span class="selector-class">.echelon</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">100px</span> solid;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent transparent <span class="number">#c00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 三栏</span></span><br><span class="line"><span class="selector-class">.three-cols</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">30px</span> solid;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">30px</span> solid;</span><br><span class="line">    <span class="attribute">background-color</span>: currentColor;</span><br><span class="line">    <span class="attribute">background-clip</span>: content-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多层阴影</span></span><br><span class="line"><span class="selector-class">.shadows</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">5px</span> solid black;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> green,<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 眼睛</span></span><br><span class="line"><span class="selector-class">.eye</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">10px</span> solid;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: currentColor;</span><br><span class="line">    <span class="attribute">background-clip</span>: content-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 放大镜</span></span><br><span class="line"><span class="selector-class">.magnifier</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#333</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.magnifier</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;    </span><br><span class="line">    <span class="attribute">width</span>: <span class="number">8px</span>;    </span><br><span class="line">    <span class="attribute">height</span>: <span class="number">60px</span>;    </span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;    </span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#333</span>;    </span><br><span class="line">    <span class="attribute">position</span>: absolute;    </span><br><span class="line">    <span class="attribute">right</span>: -<span class="number">22px</span>;    </span><br><span class="line">    <span class="attribute">top</span>: <span class="number">38px</span>;    </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索框：聚焦时变长 &lt;input class=&quot;search&quot; type=&quot;text&quot;&gt;</span></span><br><span class="line"><span class="selector-class">.search</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">2px</span> solid lightblue;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    <span class="attribute">text-indent</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    -webkit-<span class="attribute">transition</span>: width <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.search</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 卡券效果 &lt;p class=&quot;coupon&quot;&gt;&lt;span&gt;200&lt;/span&gt;优惠券&lt;/p&gt;</span></span><br><span class="line"><span class="selector-class">.coupon</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">drop-shadow</span>(<span class="number">2px</span> <span class="number">2px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">2</span>));</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">radial-gradient</span>(circle at right bottom, </span><br><span class="line">      transparent <span class="number">10px</span>, <span class="number">#ffffff</span> <span class="number">0</span>) top right /<span class="number">50%</span> <span class="number">51px</span> no-repeat,</span><br><span class="line">      <span class="built_in">radial-gradient</span>(circle at left bottom, transparent <span class="number">10px</span>, <span class="number">#ffffff</span> <span class="number">0</span>) </span><br><span class="line">      top left / <span class="number">50%</span> <span class="number">51px</span> no-repeat,</span><br><span class="line">      <span class="built_in">radial-gradient</span>(circle at right top, transparent <span class="number">10px</span>, <span class="number">#ffffff</span> <span class="number">0</span>) </span><br><span class="line">      bottom right / <span class="number">50%</span> <span class="number">51px</span> no-repeat,</span><br><span class="line">      <span class="built_in">radial-gradient</span>(circle at left top, transparent <span class="number">10px</span>, <span class="number">#ffffff</span> <span class="number">0</span>) </span><br><span class="line">      bottom left / <span class="number">50%</span> <span class="number">51px</span> no-repeat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.coupon</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="五、移动端样式"><a href="#五、移动端样式" class="headerlink" title="五、移动端样式"></a>五、移动端样式</h1><h2 id="reset-css"><a href="#reset-css" class="headerlink" title="reset.css"></a>reset.css</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>&#123;</span><br><span class="line">    -webkit-text-size-adjust: none;</span><br><span class="line">    <span class="comment">/* 禁用长按选中、复制文本功能 */</span></span><br><span class="line">    -webkit-user-select: none;</span><br><span class="line">    -webkit-touch-callout: none;</span><br><span class="line">    <span class="comment">/* 取消可点击元素点击时的背景色 */</span></span><br><span class="line">    -webkit-tap-highlight-<span class="attribute">color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fbfbfb</span>;</span><br><span class="line">    -webkit-<span class="attribute">overflow</span>-scrolling: touch;  <span class="comment">/* 滚动条上下拉动时卡顿 */</span></span><br><span class="line">    <span class="attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="string">&quot;PingFang SC&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Helvetica Neue&quot;</span>,STHeiti,<span class="string">&quot;Microsoft Yahei&quot;</span>,Tahoma,Simsun,sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span>,<span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>,<span class="selector-tag">p</span>,<span class="selector-tag">dl</span>,<span class="selector-tag">dd</span>,<span class="selector-tag">ul</span>,<span class="selector-tag">ol</span>,</span><br><span class="line">pre,<span class="selector-tag">form</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">th</span>,<span class="selector-tag">td</span>,select &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>; </span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>; </span><br><span class="line">    <span class="attribute">text-indent</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span>&#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 取消聚焦高亮效果 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:focus</span>, <span class="selector-tag">button</span><span class="selector-pseudo">:focus</span>, <span class="selector-tag">input</span><span class="selector-pseudo">:focus</span>, <span class="selector-tag">textarea</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ol</span>,<span class="selector-tag">ul</span>,<span class="selector-tag">li</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span>, <span class="selector-tag">input</span>, <span class="selector-tag">button</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">textarea</span>&#123; </span><br><span class="line">    <span class="attribute">resize</span>: none; </span><br><span class="line">    <span class="attribute">overflow</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:disabled</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: .<span class="number">65</span>;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span>::-webkit-input-placeholder,</span><br><span class="line">textarea::-webkit-input-placeholder&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span>:-moz-placeholder,</span><br><span class="line">textarea:-moz-placeholder&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span>:-ms-input-placeholder,</span><br><span class="line">textarea:-ms-input-placeholder&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span>,</span><br><span class="line"><span class="selector-tag">input</span>,</span><br><span class="line"><span class="selector-tag">textarea</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: inherit;</span><br><span class="line">    <span class="attribute">font</span>: inherit;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:disabled</span>, </span><br><span class="line"><span class="selector-tag">textarea</span><span class="selector-pseudo">:disabled</span> &#123;</span><br><span class="line">    -webkit-text-fill-<span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">    -webkit-<span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.shadow</span>&#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">6px</span> <span class="number">6px</span> <span class="number">#c8c8c8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 隐藏滚动条 */</span></span><br><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 开启硬件加速，解决页面闪白，保证动画流畅 */</span></span><br><span class="line"><span class="selector-class">.animation</span> &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="媒体查询"><a href="#媒体查询" class="headerlink" title="媒体查询"></a>媒体查询</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* rem 配置 */</span></span><br><span class="line"><span class="selector-tag">html</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">10px</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>:<span class="number">321px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">375px</span>)&#123;</span><br><span class="line">    <span class="selector-tag">html</span>&#123; <span class="attribute">font-size</span>: <span class="number">11px</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>:<span class="number">376px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">414px</span>)&#123;</span><br><span class="line">    <span class="selector-tag">html</span>&#123; <span class="attribute">font-size</span>: <span class="number">12px</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>:<span class="number">415px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">639px</span>)&#123;</span><br><span class="line">    <span class="selector-tag">html</span>&#123; <span class="attribute">font-size</span>: <span class="number">15px</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>:<span class="number">640px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">719px</span>)&#123;</span><br><span class="line">    <span class="selector-tag">html</span>&#123; <span class="attribute">font-size</span>: <span class="number">20px</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>:<span class="number">720px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">749px</span>)&#123;</span><br><span class="line">    <span class="selector-tag">html</span>&#123; <span class="attribute">font-size</span>: <span class="number">22.5px</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>:<span class="number">750px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">799px</span>)&#123;</span><br><span class="line">    <span class="selector-tag">html</span>&#123; <span class="attribute">font-size</span>: <span class="number">23.5px</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>:<span class="number">800px</span>)&#123;</span><br><span class="line">    <span class="selector-tag">html</span>&#123; <span class="attribute">font-size</span>: <span class="number">25px</span> &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 竖屏时的样式 */</span></span><br><span class="line"><span class="keyword">@media</span> all <span class="keyword">and</span> (<span class="attribute">orientation</span>:portrait)&#123;   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 横屏时的样式 */</span></span><br><span class="line"><span class="keyword">@media</span> all <span class="keyword">and</span> (<span class="attribute">orientation</span>:landscape)&#123;   &#125;</span><br></pre></td></tr></table></figure>


<h2 id="表单标签"><a href="#表单标签" class="headerlink" title="表单标签"></a>表单标签</h2>  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* input placeholder 出现文本位置偏上 */</span></span><br><span class="line"><span class="selector-tag">input</span>&#123;</span><br><span class="line">    <span class="attribute">line-height</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 输入框 placeholder 的颜色值改变 */</span></span><br><span class="line">::-webkit-input-placeholder &#123;  </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>; </span><br><span class="line">&#125;</span><br><span class="line">:-moz-placeholder &#123;  </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>; </span><br><span class="line">&#125;</span><br><span class="line">::-moz-placeholder &#123;  </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>; </span><br><span class="line">&#125;</span><br><span class="line">:-ms-input-placeholder &#123;  </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:focus</span>::-webkit-input-placeholder&#123; </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* IOS Input Disabled 默认样式问题 */</span></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:disabled</span>, <span class="selector-tag">textarea</span><span class="selector-pseudo">:disabled</span> &#123;</span><br><span class="line">    -webkit-text-fill-<span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">    -webkit-<span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 改变选中内容的背景颜色：字体颜色换成 color */</span></span><br><span class="line"><span class="selector-pseudo">::selection</span> &#123; </span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#FFF</span>; </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>; </span><br><span class="line">&#125; </span><br><span class="line">::-moz-selection &#123; </span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#FFF</span>; </span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>; </span><br><span class="line">&#125; </span><br><span class="line">::-webkit-selection &#123; </span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#FFF</span>; </span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* 禁用 select 默认下拉箭头 */</span></span><br><span class="line">select::-ms-expand &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 禁用 radio 和 checkbox 默认样式 */</span></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=radio]</span>::-ms-check, </span><br><span class="line">input[type=checkbox]::-ms-check</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 禁用表单输入框默认清除按钮 */</span></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=text]</span>::-ms-clear,</span><br><span class="line">input[type=tel]::-ms-clear,</span><br><span class="line">input[type=number]::-ms-clear &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 重置默认外观 */</span></span><br><span class="line"><span class="selector-tag">input</span>, select &#123; </span><br><span class="line">    <span class="comment">/* 清除默认内阴影 */</span></span><br><span class="line">    -webkit-appearance:none; </span><br><span class="line">    appearance: none; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 禁止winphone默认触摸事件 (e.preventDefault无效) */</span></span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    -ms-touch-action: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1px-border"><a href="#1px-border" class="headerlink" title="1px border"></a>1px border</h2>  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 法一</span></span><br><span class="line"><span class="selector-class">.border_1px</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="selector-class">.border_1px</span> &#123;</span><br><span class="line">        <span class="attribute">border-bottom</span>: none;</span><br><span class="line">        <span class="attribute">border-width</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">border-image</span>: <span class="built_in">url</span>(../img/<span class="number">1px</span>line.png) <span class="number">0</span> <span class="number">0</span> <span class="number">2</span> <span class="number">0</span> stretch;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 法二</span></span><br><span class="line"><span class="selector-class">.border_1px</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border_1px</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>:<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">50%</span> <span class="number">0%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="selector-class">.border_1px</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="selector-class">.border_1px</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.33</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单一边框</span></span><br><span class="line"><span class="selector-class">.hair-line</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hair-line</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="number">#dcdcdc</span>;</span><br><span class="line">    <span class="attribute">border-style</span>: solid;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0.5</span>);</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hair-line--b</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom-width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hair-line--t</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">border-top-width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hair-line--r</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">border-right-width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hair-line--l</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">border-left-width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hair-line--a</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="六、动画效果"><a href="#六、动画效果" class="headerlink" title="六、动画效果"></a>六、动画效果</h1><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><ol>
<li>通过定时器 <code>setTimeout、setIterval</code> 间隔改变元素样式，但经常导致页面频繁性重排重绘而消耗性能。</li>
<li>通过浏览器用于定时循环操作的接口 <code>requestAnimationFrame</code> 实现最佳动画效果：它可看作一个性能优化版的 setTimeout，但并不指定回调函数运行时间而是跟着浏览器内建的刷新频率来执行回调。</li>
<li>复杂动画交互建议使用 RAF、setInterval&#x2F;setTimeout 降级处理。</li>
</ol>
<h3 id="CSS3"><a href="#CSS3" class="headerlink" title="CSS3"></a>CSS3</h3><blockquote>
<p><code>transition、animation</code> 摆脱了 js 的控制，并且可以利用硬件加速以及实现复杂动画效果。比如在移动端开发时使用 transition 会让页面变慢甚至卡顿，通过添加 <code>transform: translate3D(0,0,0) / translateZ(0)</code> 来开启移动端动画的 GPU 加速可以让动画过程更加流畅。</p>
</blockquote>
<h3 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a>HTML5</h3><ul>
<li><code>svg</code>：使用 XML 格式定义基于矢量的图形并嵌入到 HTML 使用。</li>
<li><code>canvas</code>：可用于实现复杂动画，可通过 js 渲染控制动画的执行。</li>
<li><code>WebGL</code>：可看作是浏览器提供的接口，门槛较高而一般使用封装后的 Three.js。</li>
</ul>
<h2 id="常用的库"><a href="#常用的库" class="headerlink" title="常用的库"></a>常用的库</h2><ul>
<li><code>Animate.css</code>：CSS3 动画库，运动元素添加类名。</li>
<li><code>Tween.js</code>：包含各种经典算法的补间动画，以平滑效果变化。</li>
<li><code>Three.js</code>：实现 3D 程序的 js 类库，封装了 webgl 接口。</li>
<li><code>swiper.animate.js</code>：移动端触摸滑块类库，初始化回调中使用并在运动元素添加类名。</li>
</ul>
<h2 id="加载动画"><a href="#加载动画" class="headerlink" title="加载动画"></a>加载动画</h2><blockquote>
<p>精彩动画：<a href="https://mp.weixin.qq.com/s/ShPvRu6bo7c-ETlHAQrLZQ">https://mp.weixin.qq.com/s/ShPvRu6bo7c-ETlHAQrLZQ</a></p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.loading-box</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>: <span class="number">9999</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">6</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.loading-box</span> <span class="selector-tag">img</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">120px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-top</span>: <span class="number">40vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: rotating <span class="number">1s</span> <span class="built_in">steps</span>(<span class="number">12</span>, end) infinite;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="keyword">@keyframes</span> rotating &#123;</span></span><br><span class="line"><span class="language-css">      <span class="number">0%</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="number">100%</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">1turn</span>);</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loading-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/mobile/loading.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 圆环 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.app_loading</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100vw</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#0c0d22</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">opacity</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transition</span>: opacity <span class="number">1s</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>: <span class="number">9999</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">pointer-events</span>: none;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.text_box</span> <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#eff1f2</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">50vw</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">50vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.text_box</span> <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">50vw</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">50vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.text_box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">25vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">25vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: box_fade <span class="number">3s</span> <span class="number">0s</span> ease-in infinite;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.text_box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">45vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">45vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: box_fade <span class="number">3s</span> .<span class="number">4s</span> ease-in infinite;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.text_box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">65vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">65vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: box_fade <span class="number">3s</span> .<span class="number">8s</span> ease-in infinite;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.text_box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">85vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">85vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: box_fade <span class="number">3s</span> <span class="number">1.2s</span> ease-in infinite;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="keyword">@keyframes</span> box_fade &#123;</span></span><br><span class="line"><span class="language-css">      <span class="number">0%</span> &#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">      <span class="number">30%</span> &#123; <span class="attribute">opacity</span>: .<span class="number">6</span>; &#125;</span></span><br><span class="line"><span class="language-css">      <span class="number">60%</span> &#123; <span class="attribute">opacity</span>: .<span class="number">2</span>; &#125;</span></span><br><span class="line"><span class="language-css">      <span class="number">100%</span> &#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.starline</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="comment">/* background: pink; */</span></span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.starline</span> <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">2px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-image</span>: <span class="built_in">-webkit-linear-gradient</span>(right, </span></span><br><span class="line"><span class="language-css">          <span class="built_in">rgba</span>(<span class="number">225</span>, <span class="number">225</span>, <span class="number">225</span>, <span class="number">0</span>), <span class="built_in">rgba</span>(<span class="number">225</span>, <span class="number">225</span>, <span class="number">225</span>, <span class="number">1</span>));</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.starline</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: -<span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: -<span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: xmove <span class="number">12s</span> ease-out infinite;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(-<span class="number">45deg</span>) <span class="built_in">translate3d</span>(-<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="keyword">@keyframes</span> xmove &#123;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">to</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(-<span class="number">45deg</span>) <span class="built_in">translate3d</span>(-<span class="number">800px</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.starline</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: -<span class="number">120px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: ymove <span class="number">8s</span> ease-out infinite;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(-<span class="number">45deg</span>) <span class="built_in">translate3d</span>(-<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="keyword">@keyframes</span> ymove &#123;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">to</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(-<span class="number">45deg</span>) <span class="built_in">translate3d</span>(-<span class="number">800px</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.starline</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: -<span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: zmove <span class="number">16s</span> ease-out infinite;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(-<span class="number">45deg</span>) <span class="built_in">translate3d</span>(-<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="keyword">@keyframes</span> zmove &#123;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">to</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(-<span class="number">45deg</span>) <span class="built_in">translate3d</span>(-<span class="number">800px</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app_loading&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text_box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;starline&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>HTML CSS</category>
      </categories>
      <tags>
        <tag>HTML CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML 元素</title>
    <url>/2019/05/06/3-1-html/</url>
    <content><![CDATA[<h1 id="入门基础"><a href="#入门基础" class="headerlink" title="入门基础"></a>入门基础</h1><h2 id="元素分类"><a href="#元素分类" class="headerlink" title="元素分类"></a>元素分类</h2><ul>
<li>行内元素：一行可放多个、宽高不可设置、宽度包裹内容。常用的有：<code>i、a、span、label、strong</code>。</li>
<li>块级元素：独占一行、可设宽高、不设宽度时默认是其父元素的 100%。6个属性：<code>width、height、background、border、padding、margin</code>。常用的有：<code>h、p、ul、div、table</code>。</li>
<li>行内块元素：一行多个、可设宽高。常用的有：<code>img、input、button</code>。</li>
</ul>
<h2 id="布局模型"><a href="#布局模型" class="headerlink" title="布局模型"></a>布局模型</h2><blockquote>
<p>整体布局用浮动、局部布局用定位。</p>
</blockquote>
<ol>
<li>流动模型：浏览器默认文档流。块级元素自下而上、内联元素自左而右按顺序排列。</li>
<li>层模型：定位流。父元素相对定位，子元素绝对&#x2F;固定定位，z-index 定义堆叠顺序。</li>
<li>浮动模型：浮动流。浮动元素脱离文档流而释放空间，但不遮挡后面内容。<br>* float：设计初衷是文字环绕效果，主要特性有包裹性、破坏性。<br>* 清除浮动：清除对后面元素的影响，但父元素有浮动&#x2F;绝对定位时不需要。<br>* 清除方法：<code>给父元素指定高度、在浮动元素后面添加 clear: both、给浮动元素父元素添加 overflow: hidden/auto、底部添加伪元素 after</code>。<br><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 清除浮动经典方法 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;       <span class="comment">/* 添加内容为空 */</span>   </span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;           <span class="comment">/* 不占空间 */</span></span><br><span class="line">  <span class="attribute">visibility</span>: hidden;  <span class="comment">/* 不可见  */</span>   </span><br><span class="line">  <span class="attribute">clear</span>: both</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span> &#123;  </span><br><span class="line">  *zoom : <span class="number">1</span>;   <span class="comment">/* 兼容低版本浏览器 */</span>   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="小知识"><a href="#小知识" class="headerlink" title="小知识"></a>小知识</h2><ul>
<li><strong>文件引入优先级</strong>：就近原则，距离相应代码近的引入方式优先级高。</li>
<li><strong>浏览器读取规则</strong>：从右向左，因为相比从左到右匹配更快、性能更优。</li>
<li><strong>元素隐藏方法</strong>：display、Opacity、visibility、hide、遮罩等。</li>
<li><strong>伪类和伪元素</strong><ul>
<li>伪类：<code>:hover、:active、:first-child</code>等用于向已有元素添加特殊效果。</li>
<li>伪元素：<code>::before、::after</code>等用于新建抽象元素并添加样式而实现特殊效果。</li>
</ul>
</li>
</ul>
<hr>
<p>以下为 HTML5 新特性：</p>
<h1 id="一、audio、video"><a href="#一、audio、video" class="headerlink" title="一、audio、video"></a>一、audio、video</h1><blockquote>
<p>支持的格式：Ogg、MP3、WAV</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    src：地址、preload：预加载、autoplay：自动播放</span></span><br><span class="line"><span class="comment">    loop：循环播放、controls：浏览器自带的控制条 </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">&quot;music/bg.mp3&quot;</span> <span class="attr">autoplay</span>&gt;</span>不支持提示语句<span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">id</span>=<span class="string">&quot;audio&quot;</span> <span class="attr">loop</span> <span class="attr">controls</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">&quot;music/bg.ogg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;audio/ogg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">&quot;music/bg.mp3&quot;</span> <span class="attr">type</span>=<span class="string">&quot;audio/mpeg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  优先播放音乐 bg.ogg，不支持播放 bg.mp3</span><br><span class="line"><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- width/height：video 独有属性、poster：视频封面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;video.mp4&quot;</span> <span class="attr">width</span>=<span class="string">&quot;400&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">loop</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">preload</span>=<span class="string">&quot;auto&quot;</span> <span class="attr">poster</span>=<span class="string">&quot;video.jpg&quot;</span> <span class="attr">controls</span> <span class="attr">autobuffer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">&quot;movie.ogg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;video/ogg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">&quot;movie.mp4&quot;</span> <span class="attr">type</span>=<span class="string">&quot;video/mp4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  您的浏览器不支持 video 标签</span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h2><h3 id="标签属性"><a href="#标签属性" class="headerlink" title="标签属性"></a>标签属性</h3>  <figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">src：视频的URL</span><br><span class="line">poster：视频封面，没有播放时显示的图片</span><br><span class="line">preload：预加载</span><br><span class="line">autoplay：自动播放</span><br><span class="line">loop：循环播放</span><br><span class="line">controls：浏览器自带的控制条</span><br><span class="line">width：视频宽度</span><br><span class="line">height：视频高度</span><br><span class="line"><span class="attribute">webkit-playsinline</span><span class="operator">=</span><span class="string">&quot;true&quot;</span> IOS下防止全屏播放</span><br><span class="line"><span class="attribute">playsinline</span><span class="operator">=</span><span class="string">&quot;true&quot;</span> 同上</span><br><span class="line"><span class="attribute">x-webkit-airplay</span><span class="operator">=</span><span class="string">&quot;true&quot;</span> 支持ios的AirPlay功能</span><br><span class="line"><span class="attribute">x5-video-player-type</span><span class="operator">=</span><span class="string">&quot;h5&quot;</span> 启用同层H5播放器</span><br><span class="line"><span class="attribute">x5-video-player-fullscreen</span><span class="operator">=</span><span class="string">&quot;true&quot;</span> 全屏设置</span><br><span class="line"><span class="attribute">x5-video-orientation</span><span class="operator">=</span><span class="string">&quot;portraint&quot;</span> 竖屏</span><br><span class="line"><span class="attribute">style</span><span class="operator">=</span><span class="string">&quot;object-fit:fill&quot;</span> 封面铺满</span><br><span class="line"><span class="attribute">muted</span><span class="operator">=</span><span class="string">&quot;true&quot;</span> 静音播放</span><br></pre></td></tr></table></figure>


<h3 id="标签样式"><a href="#标签样式" class="headerlink" title="标签样式"></a>标签样式</h3><blockquote>
<p>chrome 调试方式：F12、右上方三个点、setting、Perferences、勾选 Show user agent shadow Dom，然后就可以查看 video 标签的控制栏 dom 结构。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全屏按钮</span></span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-fullscreen-button &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 播放按钮</span></span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-play-button &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 进度条</span></span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-timeline &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观看的当前时间</span></span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-current-time-display &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 剩余时间</span></span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-time-remaining-display &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 音量按钮</span></span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-mute-button &#123; &#125;</span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-toggle-closed-captions-button &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 音量的控制条</span></span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-volume-slider &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//所有控件</span></span><br><span class="line"><span class="attr">video</span>::-webkit-media-controls-enclosure &#123; &#125;</span><br></pre></td></tr></table></figure>


<h3 id="对象属性"><a href="#对象属性" class="headerlink" title="对象属性"></a>对象属性</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 错误状态</span></span><br><span class="line">$video.<span class="property">error</span>;      <span class="comment">// null: 正常  </span></span><br><span class="line">$video.<span class="property">error</span>.<span class="property">code</span>; <span class="comment">// 1.用户终止 2.网络错误 3.解码错误 4.URL无效 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 网络状态</span></span><br><span class="line">$video.<span class="property">currentSrc</span>;         <span class="comment">// 当前资源的 URL  </span></span><br><span class="line">$video.<span class="property">src</span> = value;        <span class="comment">// 设置当前资源的 URL  </span></span><br><span class="line">$video.<span class="title function_">canPlayType</span>(type);  <span class="comment">// 是否能播放某种格式的资源  </span></span><br><span class="line">$video.<span class="property">networkState</span>;       <span class="comment">// 视频的当前网络状态</span></span><br><span class="line">$video.<span class="property">buffered</span>;           <span class="comment">// 获取已缓冲区域</span></span><br><span class="line">$video.<span class="property">buffered</span>.<span class="title function_">end</span>(<span class="number">0</span>)     <span class="comment">// 获取最后一刻的数据</span></span><br><span class="line">$video.<span class="title function_">load</span>();             <span class="comment">// 重新加载 src 指定的资源 </span></span><br><span class="line">$video.<span class="property">preload</span>;            <span class="comment">// 是否预加载视频</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备状态</span></span><br><span class="line">$video.<span class="property">readyState</span>;    <span class="comment">// 视频是否已准备好播放</span></span><br><span class="line">$video.<span class="property">seeking</span>;       <span class="comment">// 是否正在寻址 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 播放状态</span></span><br><span class="line">$video.<span class="property">currentTime</span> = value; <span class="comment">// 当前播放位置  </span></span><br><span class="line">$video.<span class="property">duration</span>;            <span class="comment">// 当前资源长度  </span></span><br><span class="line">$video.<span class="property">paused</span>;              <span class="comment">// 是否暂停  </span></span><br><span class="line">$video.<span class="property">defaultPlaybackRate</span> = value;  <span class="comment">// 默认的回放速度</span></span><br><span class="line">$video.<span class="property">playbackRate</span> = value;         <span class="comment">// 当前播放速度 </span></span><br><span class="line">$video.<span class="property">seekable</span>;    <span class="comment">// 返回可以寻址的区域 </span></span><br><span class="line">$video.<span class="property">ended</span>;       <span class="comment">// 是否结束  </span></span><br><span class="line">$video.<span class="property">autoPlay</span>;    <span class="comment">// 是否自动播放  </span></span><br><span class="line">$video.<span class="property">loop</span>;        <span class="comment">// 是否循环播放  </span></span><br><span class="line">$video.<span class="title function_">play</span>();      <span class="comment">// 播放  </span></span><br><span class="line">$video.<span class="title function_">pause</span>();     <span class="comment">//暂停  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 相关控制</span></span><br><span class="line">$video.<span class="property">controls</span>;         <span class="comment">// 是否有默认控制条  </span></span><br><span class="line">$video.<span class="property">volume</span> = value;   <span class="comment">// 音量  </span></span><br><span class="line">$video.<span class="property">muted</span> = value;    <span class="comment">// 静音</span></span><br></pre></td></tr></table></figure>


<h3 id="对象方法"><a href="#对象方法" class="headerlink" title="对象方法"></a>对象方法</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">loadstart         <span class="comment">// 客户端开始请求数据  </span></span><br><span class="line">*progress         <span class="comment">// 客户端正在请求数据  </span></span><br><span class="line">suspend           <span class="comment">// 延迟下载  </span></span><br><span class="line">abort             <span class="comment">// 客户端主动终止下载（不是因为错误引起） </span></span><br><span class="line">*error            <span class="comment">// 请求数据时遇到错误  </span></span><br><span class="line">stalled           <span class="comment">// 网速失速  </span></span><br><span class="line">*play             <span class="comment">// 开始播放时触发  </span></span><br><span class="line">*pause            <span class="comment">// 暂停时触发  </span></span><br><span class="line">loadedmetadata    <span class="comment">// 成功获取资源长度  </span></span><br><span class="line">*waiting          <span class="comment">// 等待数据，并非错误  </span></span><br><span class="line">*playing          <span class="comment">// 开始回放  </span></span><br><span class="line">canplay           <span class="comment">// 可以播放，但中途可能因为加载而暂停  </span></span><br><span class="line">*canplaythrough   <span class="comment">// 可以播放  </span></span><br><span class="line">seeking           <span class="comment">// 资源寻找中  </span></span><br><span class="line">seeked            <span class="comment">// 资源寻找完毕  </span></span><br><span class="line">*timeupdate       <span class="comment">// 播放时间改变  </span></span><br><span class="line">*ended            <span class="comment">// 播放结束  </span></span><br><span class="line">ratechange        <span class="comment">// 播放速率改变  </span></span><br><span class="line">durationchange    <span class="comment">// 资源长度改变  </span></span><br><span class="line">*volumechange     <span class="comment">// 音量改变         </span></span><br></pre></td></tr></table></figure>


<h2 id="自动播放"><a href="#自动播放" class="headerlink" title="自动播放"></a>自动播放</h2><blockquote>
<p>ios、Android、微信为了节省流量而规定忽视 autoplay 属性。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ios、Android：循环播放失效时方案相似</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchstart&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;audio&#x27;</span>).<span class="title function_">play</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微信</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;WeixinJSBridgeReady&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;audios&#x27;</span>).<span class="title function_">play</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 针对苹果的手机微信端</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">autoPlayVideo</span>(<span class="params"></span>)&#123;</span><br><span class="line">  wx.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="attr">debug</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">appId</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">timestamp</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">nonceStr</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">signature</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">jsApiList</span>:[]</span><br><span class="line">  &#125;)</span><br><span class="line">  wx.<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> autoplayVideo = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;audio&quot;</span>);</span><br><span class="line">    autoplayVideo.<span class="title function_">play</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="用户权限"><a href="#用户权限" class="headerlink" title="用户权限"></a>用户权限</h2><blockquote>
<p>navigator.getUserMedia 可以提示用户需要权限去使用像摄像头、麦克风等媒体设备。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 兼容写法</span></span><br><span class="line">navigator.<span class="property">getMedia</span> = (navigator.<span class="property">getUserMedia</span> ||</span><br><span class="line">  navigator.<span class="property">webkitGetUserMedia</span> ||</span><br><span class="line">  navigator.<span class="property">mozGetUserMedia</span> ||</span><br><span class="line">  navigator.<span class="property">msGetUserMedia</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户摄像头并提供拍照功能：video、canvas、button</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 获取元素，创建设置等等</span></span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>),</span><br><span class="line">  context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>),</span><br><span class="line">  video = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;video&quot;</span>),</span><br><span class="line">  videoObj = &#123; <span class="string">&quot;video&quot;</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  errBack = <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Video capture error: &quot;</span>, error.<span class="property">code</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加 video 监听器</span></span><br><span class="line">  <span class="keyword">if</span>(navigator.<span class="property">getUserMedia</span>) &#123; <span class="comment">// 标准</span></span><br><span class="line">      navigator.<span class="title function_">getUserMedia</span>(videoObj, <span class="keyword">function</span>(<span class="params">stream</span>) &#123;</span><br><span class="line">          video.<span class="property">src</span> = stream;</span><br><span class="line">          video.<span class="title function_">play</span>();</span><br><span class="line">      &#125;, errBack);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(navigator.<span class="property">webkitGetUserMedia</span>) &#123; <span class="comment">// WebKit 前缀</span></span><br><span class="line">      navigator.<span class="title function_">webkitGetUserMedia</span>(videoObj, <span class="keyword">function</span>(<span class="params">stream</span>)&#123;</span><br><span class="line">          video.<span class="property">src</span> = <span class="variable language_">window</span>.<span class="property">webkitURL</span>.<span class="title function_">createObjectURL</span>(stream);</span><br><span class="line">          video.<span class="title function_">play</span>();</span><br><span class="line">      &#125;, errBack);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(navigator.<span class="property">mozGetUserMedia</span>) &#123;    <span class="comment">// Firefox 前缀</span></span><br><span class="line">      navigator.<span class="title function_">mozGetUserMedia</span>(videoObj, <span class="keyword">function</span>(<span class="params">stream</span>)&#123;</span><br><span class="line">          video.<span class="property">src</span> = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(stream);</span><br><span class="line">          video.<span class="title function_">play</span>();</span><br><span class="line">      &#125;, errBack);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;snap&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      context.<span class="title function_">drawImage</span>(video, <span class="number">0</span>, <span class="number">0</span>, <span class="number">640</span>, <span class="number">480</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>


<h1 id="二、Canvas"><a href="#二、Canvas" class="headerlink" title="二、Canvas"></a>二、Canvas</h1><blockquote>
<p>提供了一系列绘图方法的对象。</p>
</blockquote>
<h2 id="绘制图形"><a href="#绘制图形" class="headerlink" title="绘制图形"></a>绘制图形</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(canvas.<span class="property">getContext</span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线段 </span></span><br><span class="line">ctx.<span class="title function_">moveTo</span>(<span class="number">100</span>, <span class="number">20</span>); </span><br><span class="line">ctx.<span class="title function_">lineTo</span>(<span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">ctx.<span class="property">lineWidth</span> = <span class="number">5</span>; </span><br><span class="line">ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;#CC0000&#x27;</span>; </span><br><span class="line">ctx.<span class="title function_">stroke</span>();    <span class="comment">// 绘制</span></span><br><span class="line"></span><br><span class="line">ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">ctx.<span class="property">strokeStyle</span> = <span class="string">&quot;#ff0000&quot;</span>;</span><br><span class="line">ctx.<span class="title function_">lineTo</span>(<span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">ctx.<span class="title function_">lineTo</span>(<span class="number">20</span>, <span class="number">70</span>);</span><br><span class="line">ctx.<span class="title function_">lineTo</span>(<span class="number">70</span>, <span class="number">70</span>);</span><br><span class="line">ctx.<span class="title function_">closePath</span>();</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 路径：填充</span></span><br><span class="line">ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">ctx.<span class="title function_">arc</span>(<span class="number">240</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">2</span> , <span class="literal">false</span>);</span><br><span class="line">ctx.<span class="title function_">closePath</span>();</span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#0000ff&#x27;</span>;</span><br><span class="line">ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路径：填充 + 边框</span></span><br><span class="line">ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">ctx.<span class="title function_">arc</span>(<span class="number">300</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">2</span> , <span class="literal">false</span>);</span><br><span class="line">ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;#0000ff&#x27;</span>;</span><br><span class="line">ctx.<span class="title function_">closePath</span>();</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgba(0,0,255,0.2)&#x27;</span>;</span><br><span class="line">ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 贝塞尔曲线</span></span><br><span class="line">ctx.<span class="title function_">moveTo</span>(<span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">ctx.<span class="property">lineWidth</span> = <span class="number">10</span>;</span><br><span class="line">ctx.<span class="property">strokeStyle</span> = <span class="string">&quot;skyblue&quot;</span>;</span><br><span class="line">ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">300</span>, <span class="number">50</span>, <span class="number">500</span>, <span class="number">50</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line"><span class="comment">// 蓝色填充矩形</span></span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;#0000ff&quot;</span>;</span><br><span class="line">ctx.<span class="title function_">fillRect</span>(<span class="number">20</span>, <span class="number">100</span>, <span class="number">60</span>, <span class="number">60</span>);    </span><br><span class="line"></span><br><span class="line"><span class="comment">// 红色边框矩形</span></span><br><span class="line">ctx.<span class="property">lineWidth</span> = <span class="number">10</span>; </span><br><span class="line">ctx.<span class="title function_">strokeRect</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>, <span class="number">60</span>);  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 圆</span></span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;#0000ff&quot;</span>;</span><br><span class="line">ctx.<span class="property">strokeStyle</span> = <span class="string">&quot;#ff0000&quot;</span>;</span><br><span class="line">ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">ctx.<span class="title function_">arc</span>(<span class="number">50</span>, <span class="number">240</span>, <span class="number">40</span>, <span class="number">0</span>, <span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>, <span class="literal">true</span>);</span><br><span class="line">ctx.<span class="title function_">closePath</span>();</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br><span class="line">ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;pink&quot;</span>;</span><br><span class="line">ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">ctx.<span class="title function_">arc</span>(<span class="number">50</span>, <span class="number">240</span>, <span class="number">20</span>, <span class="number">0</span>, <span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>, <span class="literal">true</span>);</span><br><span class="line">ctx.<span class="title function_">closePath</span>();</span><br><span class="line">ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文本</span></span><br><span class="line">ctx.<span class="property">font</span> = <span class="string">&quot;Bold 20px Arial&quot;</span>; </span><br><span class="line">ctx.<span class="property">textAlign</span> = <span class="string">&quot;left&quot;</span>;</span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;#008600&quot;</span>; </span><br><span class="line">ctx.<span class="title function_">fillText</span>(<span class="string">&quot;Hello!&quot;</span>, <span class="number">10</span>, <span class="number">50</span>); </span><br><span class="line">ctx.<span class="title function_">strokeText</span>(<span class="string">&quot;Hello!&quot;</span>, <span class="number">10</span>, <span class="number">100</span>); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 渐变色</span></span><br><span class="line"><span class="keyword">var</span> grd = ctx.<span class="title function_">createLinearGradient</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">200</span>);</span><br><span class="line">grd.<span class="title function_">addColorStop</span>(<span class="number">0</span>,<span class="string">&quot;#ff0000&quot;</span>);</span><br><span class="line">grd.<span class="title function_">addColorStop</span>(<span class="number">1</span>,<span class="string">&quot;#0000ff&quot;</span>);</span><br><span class="line">ctx.<span class="property">fillStyle</span> = grd;</span><br><span class="line">ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>,<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 阴影</span></span><br><span class="line">ctx.<span class="property">shadowOffsetX</span> = <span class="number">10</span>; </span><br><span class="line">ctx.<span class="property">shadowOffsetY</span> = <span class="number">10</span>; </span><br><span class="line">ctx.<span class="property">shadowBlur</span> = <span class="number">5</span>; </span><br><span class="line">ctx.<span class="property">shadowColor</span> = <span class="string">&quot;rgba(0,0,0,0.5)&quot;</span>; </span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;#CC0000&quot;</span>; </span><br><span class="line">ctx.<span class="title function_">fillRect</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">200</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>


<h2 id="绘制图像"><a href="#绘制图像" class="headerlink" title="绘制图像"></a>绘制图像</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// canvas id=&quot;canvas&quot; width=&quot;400&quot; height=&quot;400&quot;</span></span><br><span class="line"><span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">image.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 图片绘制</span></span><br><span class="line">  <span class="comment">// ctx.drawImage(image, 0, 0)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 图片裁剪</span></span><br><span class="line">  ctx.<span class="title function_">beginPath</span>(); </span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>, <span class="literal">true</span>); </span><br><span class="line">  ctx.<span class="title function_">clip</span>();          </span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(image, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">image.<span class="property">src</span> = <span class="string">&#x27;./mobile-type.png&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取图片保存地址</span></span><br><span class="line"><span class="keyword">let</span> src = canvas.<span class="title function_">toDataURL</span>(<span class="string">&#x27;image/png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="动画效果"><a href="#动画效果" class="headerlink" title="动画效果"></a>动画效果</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> y = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">var</span> speed = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animation</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">  x += speed;</span><br><span class="line">  <span class="keyword">if</span>(x &lt;= <span class="number">0</span> || x &gt;= <span class="number">475</span>)&#123;</span><br><span class="line">      speed = -speed;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">draw</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">  context.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">500</span>, <span class="number">170</span>);</span><br><span class="line">  context.<span class="property">fillStyle</span> = <span class="string">&quot;#ff00ff&quot;</span>;</span><br><span class="line">  context.<span class="title function_">fillRect</span>(x, y, <span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">animation</span>()</span><br></pre></td></tr></table></figure>


<h2 id="像素处理"><a href="#像素处理" class="headerlink" title="像素处理"></a>像素处理</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取图像数据</span></span><br><span class="line"><span class="keyword">let</span> imgData = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 处理图像数据</span></span><br><span class="line"><span class="title function_">filter</span>(imageData);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重新绘制图像</span></span><br><span class="line">ctx.<span class="title function_">putImageData</span>(imageData, <span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>


<h1 id="三、WebSocket"><a href="#三、WebSocket" class="headerlink" title="三、WebSocket"></a>三、WebSocket</h1>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8080&#x27;</span>);</span><br><span class="line"></span><br><span class="line">socket.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  socket.<span class="title function_">send</span>(<span class="string">&#x27;hello HTML5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  socket.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;receive a message&#x27;</span>, event)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  socket.<span class="property">onclose</span> = <span class="keyword">function</span>(<span class="params">ev</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;socket has closed&#x27;</span>, event)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  socket.<span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="四、Web-Worker"><a href="#四、Web-Worker" class="headerlink" title="四、Web Worker"></a>四、Web Worker</h1><h2 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h2><ul>
<li>在当前 js 的主线程中，通过 Worker 类加载一个 js 文件来开辟一个新的线程</li>
<li>新线程可以加载 JS 进行大量的复杂运算，同时主线程不需要挂起等待而是执行其它代码</li>
<li>新线程创建时，它的脚本文件生成的两个对象和一套 API 可以实现主线程和子线程的数据通信<ul>
<li><strong>worker 对象</strong>：主线程脚本中通过构造函数显式创建，通过实例方法获取</li>
<li><strong>WorkerGlobalScope 对象</strong>：子线程脚本中隐式创建的全局对象，通过 this 获取</li>
<li><strong>API 接口</strong>：主线程和子线程脚本间进行数据传输的接口，主要为 postMessage、onmessage</li>
</ul>
</li>
</ul>
<h2 id="Web-主线程"><a href="#Web-主线程" class="headerlink" title="Web 主线程"></a>Web 主线程</h2><ol>
<li>创建新线程：<code>var worker = new Worker(url)</code></li>
<li>发送数据：<code>worker.postMessage(data)</code></li>
<li>接收数据：<code>worker.onmessage = fn</code></li>
<li>结束新线程：<code>worker.terminate()</code></li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 判断当前浏览器是否支持 web worker</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> (<span class="title class_">Worker</span>) != <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (w) == <span class="string">&quot;undefined&quot;</span>) &#123;       </span><br><span class="line">        w = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&quot;webworker.js&quot;</span>); </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">// 事件处理函数，用来处理后端的 web worker 传递的消息  </span></span><br><span class="line">    w.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123; </span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载一个 JS 文件来创建一个 worker，同时返回一个 worker 实例</span></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&quot;worker.js&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向 worker 发送数据</span></span><br><span class="line">worker.<span class="title function_">postMessage</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收 worker 发送的数据</span></span><br><span class="line">worker.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>)&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异常处理</span></span><br><span class="line">worker.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">  <span class="comment">// 错误所在的代码文件和行数、错误信息</span></span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;Line #&quot;</span> + err.<span class="property">lineno</span> + <span class="string">&quot; - &quot;</span> + err.<span class="property">message</span> + <span class="string">&quot; in &quot;</span> + err.<span class="property">filename</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结束 worker</span></span><br><span class="line">worker.<span class="title function_">terminate</span>()  </span><br></pre></td></tr></table></figure>
<h2 id="worker-新线程"><a href="#worker-新线程" class="headerlink" title="worker 新线程"></a>worker 新线程</h2><blockquote>
<p>全局变量 this 省略</p>
</blockquote>
<ol>
<li>发送数据：<code>postMessage(data)</code></li>
<li>接收数据：<code>onmessage = fn</code></li>
<li>加载脚本：<code>importScripts(&#39;a.js&#39;, &#39;b.js&#39;)</code></li>
<li>结束自身：<code>self.close()</code></li>
</ol>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li>用来进行处理大量的复杂计算而不挂起主线程。</li>
<li>可以在 worker 中通过 <code>importScripts(url) </code>加载其它脚本文件。</li>
<li>可以使用 <code>setTimeout、clearTimeout、setInterval、clearInterval</code>。</li>
<li>可以使用 <code>XMLHttpRequest</code> 来发送请求。</li>
<li>可以访问 <code>navigator、location</code> 对象。</li>
</ul>
<h2 id="操作限制"><a href="#操作限制" class="headerlink" title="操作限制"></a>操作限制</h2><blockquote>
<p>Worker 线程脚本</p>
</blockquote>
<ul>
<li><strong>脚本限制</strong>：无法调用 alert、confirm 等函数。</li>
<li><strong>同源限制</strong>：不能跨域加载脚本文件，它必须与主线程的脚本文件同源。</li>
<li><strong>通信限制</strong>：Worker 线程和主线程不在同一个上下文环境，它们不能直接通信。</li>
<li><strong>文件限制</strong>：无法读取本地文件，所加载的脚本必须 来自网络或通过服务器打开。</li>
<li><strong>DOM 限制</strong>：无法访问 DOM 节点、无法访问 window、document 等全局变量。</li>
</ul>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ul>
<li><strong>专用线程</strong>：只能被创建它的页面访问，随当前页面的关闭而结束，通信通过 onmessage()、postmessage()。</li>
<li><strong>共享线程</strong>：可以被多个页面访问，connect 后通过 port 属性实现通信。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ---------- 专用线程 -----------</span></span><br><span class="line"><span class="comment">// 主线程 index.html/script</span></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&quot;worker.js&quot;</span>); </span><br><span class="line">worker.<span class="title function_">postMessage</span>(<span class="string">&quot;hello world&quot;</span>);      <span class="comment">// 发送数据</span></span><br><span class="line">worker.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;   <span class="comment">// 接收数据</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">data</span>);             </span><br><span class="line">  worker.<span class="title function_">terminate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子线程：worker.js </span></span><br><span class="line">onmessage = <span class="keyword">function</span> (<span class="params">event</span>)&#123;          <span class="comment">// 接收数据</span></span><br><span class="line">  <span class="keyword">var</span> d = event.<span class="property">data</span>;    </span><br><span class="line">  <span class="title function_">postMessage</span>(<span class="string">&quot;已收到：&quot;</span> + d);        <span class="comment">// 发送数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过服务器打开文件：直接打开会报错</span></span><br><span class="line">live-server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------- 共享线程 -----------</span></span><br><span class="line"><span class="comment">// 主线程 </span></span><br><span class="line">worker.<span class="property">port</span>.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">e</span>)&#123;&#125;</span><br><span class="line">worker.<span class="property">port</span>.<span class="title function_">postMessage</span>(<span class="string">&#x27;data&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子线程 </span></span><br><span class="line"><span class="title function_">addEventListener</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> port = event.<span class="property">ports</span>[<span class="number">0</span>]</span><br><span class="line">  <span class="comment">// 接收</span></span><br><span class="line">  port.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">data</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 发送</span></span><br><span class="line">  port.<span class="title function_">postMessage</span>(<span class="string">&quot;data&quot;</span>);</span><br><span class="line">  port.<span class="title function_">start</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h1 id="五、拖放操作"><a href="#五、拖放操作" class="headerlink" title="五、拖放操作"></a>五、拖放操作</h1><h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><blockquote>
<p>事件对象为 被拖拽的元素、放置的目标元素 (拖放范围)。</p>
</blockquote>
<ul>
<li>拖拽元素：dragstart、drag、dragend</li>
<li>目标元素：dragenter、dragover (拖拽)、dragleave (拖出)、drop (拖入后释放鼠标)</li>
<li>执行顺序：drop 是否触发分类<ul>
<li>触发：<code>dragstart、drag、dragenter、dragover、drop、dragend</code></li>
<li>不触发：<code>dragstart、drag、dragenter、dragover、dragleave、dragend</code></li>
</ul>
</li>
</ul>
<h2 id="dataTransfer-对象"><a href="#dataTransfer-对象" class="headerlink" title="dataTransfer 对象"></a>dataTransfer 对象</h2><blockquote>
<p>拖动时回调函数接受的事件参数。注意火狐浏览器下必须设置它的 setData 方法才可以拖拽除图片外的其他标签。</p>
</blockquote>
<ul>
<li>属性：dropEffect(元素行为和相应光标)、effectAllowed(允许拖动元素的光标样式)、files(被拖放的文件对象)。</li>
<li>方法：getData、setData、clearData、setDragImage(指定拖动时显示的图像)、addElement(添加被拖拽元素)。</li>
</ul>
<h2 id="拖拽上传预览图片"><a href="#拖拽上传预览图片" class="headerlink" title="拖拽上传预览图片"></a>拖拽上传预览图片</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> list = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> box = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;box&#x27;</span>);</span><br><span class="line">  box.<span class="property">ondragenter</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;可以释放&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  box.<span class="property">ondragover</span> = <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  box.<span class="property">ondragleave</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;请拖拽到此区域&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  box.<span class="property">ondrop</span> = <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="comment">// 连续触发事件阻止冒泡</span></span><br><span class="line">    event.<span class="title function_">preventDefault</span>(); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数据对象</span></span><br><span class="line">    <span class="keyword">var</span> fs = event.<span class="property">dataTransfer</span>.<span class="property">files</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i &gt; fs.<span class="property">length</span>; i++)&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 读取文件信息的接口对象</span></span><br><span class="line">      <span class="keyword">var</span> fr = <span class="keyword">new</span> <span class="title class_">FileReader</span>();  </span><br><span class="line">      <span class="keyword">if</span>( fs[i].<span class="property">type</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;image&#x27;</span>)!=-<span class="number">1</span> )&#123;</span><br><span class="line">          fr.<span class="title function_">readAsDataURL</span>( fs[i] );</span><br><span class="line">          fr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> oLi = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> oImg = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">            oImg.<span class="property">src</span> = <span class="variable language_">this</span>.<span class="property">result</span>;</span><br><span class="line">            oLi.<span class="title function_">appendChild</span>( oImg );</span><br><span class="line">            list.<span class="title function_">appendChild</span>( oLi );</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="title function_">alert</span>(<span class="string">&#x27;请拖放图片指定格式&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="六、地理定位"><a href="#六、地理定位" class="headerlink" title="六、地理定位"></a>六、地理定位</h1><blockquote>
<p>常用的地理位置定位方式：HTML5、百度地图、高德地图。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// HTML5 定位</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> options = &#123;</span><br><span class="line">    <span class="attr">enableHighAccuracy</span>: <span class="literal">true</span>,  <span class="comment">// 是否要求高精度</span></span><br><span class="line">    <span class="attr">maximumAge</span>: <span class="number">1000</span>           <span class="comment">// 应用缓存时间</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (navigator.<span class="property">geolocation</span>) &#123;</span><br><span class="line">      navigator.<span class="property">geolocation</span>.<span class="title function_">getCurrentPosition</span>(<span class="function"><span class="params">position</span> =&gt;</span>  &#123;</span><br><span class="line">        <span class="keyword">var</span> latitude = position.<span class="property">coords</span>.<span class="property">latitude</span>;    </span><br><span class="line">        <span class="keyword">var</span> longitude = position.<span class="property">coords</span>.<span class="property">longitude</span>;  </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`纬度：<span class="subst">$&#123;latitude&#125;</span>, 经度：<span class="subst">$&#123;longitude&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">      &#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">        <span class="comment">// 常见错误：需要用户授权、仅限 HTTPS、需要翻墙 (谷歌浏览器)</span></span><br><span class="line">      &#125;, options);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 浏览器不支持</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 百度地图：申请密钥之后以参数形式引入，然后即可调用</span></span><br><span class="line"><span class="comment">// script src=&quot;http://api.map.baidu.com/api?v=2.0&amp;ak=zbLUqlSrM&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Map</span>(<span class="string">&quot;allmap&quot;</span>); <span class="comment">// 创建Map实例</span></span><br><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(<span class="number">116.404</span>, <span class="number">39.915</span>)</span><br><span class="line">map.<span class="title function_">centerAndZoom</span>(point, <span class="number">15</span>)   <span class="comment">// 初始化地图，设置中心点坐标和地图级别</span></span><br><span class="line"><span class="comment">// map.centerAndZoom(&quot;上海&quot;,15)</span></span><br><span class="line"></span><br><span class="line">map.<span class="title function_">addControl</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">MapTypeControl</span>())    <span class="comment">// 添加地图类型控件</span></span><br><span class="line">map.<span class="title function_">setCurrentCity</span>(<span class="string">&quot;北京&quot;</span>)                   <span class="comment">// 设置地图显示的城市</span></span><br><span class="line">map.<span class="title function_">enableScrollWheelZoom</span>(<span class="literal">true</span>)             <span class="comment">// 开启鼠标滚轮缩放</span></span><br></pre></td></tr></table></figure>


<h1 id="七、全屏模式"><a href="#七、全屏模式" class="headerlink" title="七、全屏模式"></a>七、全屏模式</h1>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 启动全屏模式  </span></span><br><span class="line"><span class="title function_">launchFullScreen</span>(<span class="variable language_">document</span>.<span class="property">documentElement</span>);   <span class="comment">// 整个页面  </span></span><br><span class="line"><span class="title function_">launchFullScreen</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;video&quot;</span>)); <span class="comment">// 单独元素 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消全屏  </span></span><br><span class="line"><span class="title function_">cancelFullscreen</span>(); </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">launchFullScreen</span>(<span class="params">element</span>) &#123;  </span><br><span class="line">  <span class="keyword">if</span>(element.<span class="property">requestFullScreen</span>) &#123;  </span><br><span class="line">      element.<span class="title function_">requestFullScreen</span>();  </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(element.<span class="property">mozRequestFullScreen</span>) &#123;  </span><br><span class="line">      element.<span class="title function_">mozRequestFullScreen</span>();  </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(element.<span class="property">webkitRequestFullScreen</span>) &#123;  </span><br><span class="line">      element.<span class="title function_">webkitRequestFullScreen</span>();  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cancelFullscreen</span>(<span class="params"></span>) &#123;  </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable language_">document</span>.<span class="property">cancelFullScreen</span>) &#123;  </span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">cancelFullScreen</span>();  </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">document</span>.<span class="property">mozCancelFullScreen</span>) &#123;  </span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">mozCancelFullScreen</span>();  </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">document</span>.<span class="property">webkitCancelFullScreen</span>) &#123;  </span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">webkitCancelFullScreen</span>();  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 全屏元素</span></span><br><span class="line"><span class="keyword">var</span> fullscreenEle = <span class="variable language_">document</span>.<span class="property">fullscreenElement</span> ||</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">mozFullScreenElement</span> ||</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">webkitFullscreenElement</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否全屏</span></span><br><span class="line"><span class="keyword">var</span> isFullscreen = <span class="variable language_">document</span>.<span class="property">fullscreenEnabled</span> ||</span><br><span class="line">                    <span class="variable language_">window</span>.<span class="property">fullScreen</span> ||</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">webkitIsFullScreen</span> ||</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">msFullscreenEnabled</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全屏事件</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fullscreenchange&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fullscreenerror&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123; &#125;)</span><br></pre></td></tr></table></figure>
<h1 id="八、数据储存"><a href="#八、数据储存" class="headerlink" title="八、数据储存"></a>八、数据储存</h1><blockquote>
<p>客户端存储方式：localStorage、sessionStorage、cookie、UserData、webSQL、IndexedDB、HTML5 离线存储等。</p>
</blockquote>
<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><blockquote>
<p>随着每次 http 请求头信息一起发送，无形中增加了网络流量，而且能存储的数据容量较小，适用于购物车、客户端登录等场景</p>
</blockquote>
<ul>
<li>优点：可控制过期时间、可扩展和可用性比较好、可加密而减少被破解的可能性。</li>
<li>缺点：在请求头上携带数据而安全性差、数量和长度有限制(最多 20 条、最长 40k)。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setCookie</span>(<span class="params">key, value, expireTime</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> cookie = key + <span class="string">&#x27;=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(value);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> expireTime !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> expire = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    expire.<span class="title function_">setTime</span>(expire.<span class="title function_">getTime</span>() + expireTime);</span><br><span class="line">    cookie += <span class="string">&#x27;;expires=&#x27;</span> + expire.<span class="title function_">toUTCString</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">cookie</span> = cookie + <span class="string">&#x27;;domain=&#x27;</span> + location.<span class="property">hostname</span> + <span class="string">&#x27;;path=/&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCookie</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> cookie = <span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">replace</span>(<span class="regexp">/;\s*/g</span>, <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">  cookie = <span class="title function_">parseParam</span>(cookie, <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> cookie[key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delCookie</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  exp.<span class="title function_">setTime</span>(exp.<span class="title function_">getTime</span>() - <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">var</span> cval = <span class="variable language_">this</span>.<span class="title function_">getCookie</span>(key);</span><br><span class="line">  <span class="keyword">if</span> (cval != <span class="literal">null</span>)</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">cookie</span> = key + <span class="string">&quot;=&quot;</span> + cval + <span class="string">&quot;;expires=&quot;</span> + exp.<span class="title function_">toGMTString</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h2><blockquote>
<p>本地存储方式可以长期存储数据，没有时间限制，而且可以储存电话本等大量数据。</p>
</blockquote>
<ul>
<li>特点：同源策略限制、只在本地存储、永久保存、同浏览器共享。</li>
<li>优点<ul>
<li>扩展了 cookie 的 4k 限制。</li>
<li>可以将请求数据直接存储到本地，节约带宽。</li>
<li>遵循同源策略，不同网站之间不能直接共用。</li>
</ul>
</li>
<li>缺点<ul>
<li>需要手动删除，否则长期存在。</li>
<li>浏览器大小不一，版本的支持也不一样。</li>
<li>只支持存储 string 类型的数据，JSON 对象需要转换。</li>
<li>本质是对字符串的读取，如果存储内容多则会消耗内存空间而导致页面变卡。</li>
</ul>
</li>
<li>应用场景<ul>
<li>多页面访问共同数据：可以在多个标签页中共享数据。</li>
<li>数据比较大的临时保存方案：比如在线编辑文章时的自动保存。</li>
</ul>
</li>
<li>API<ul>
<li>存储：<code>localStorage.setItem(key, value)</code>。</li>
<li>读取：<code>localStorage.getItem(key)</code>(单个)、<code>localStorage.valueOf()</code>(全部)。</li>
<li>删除：<code>localStorage.removeItem(key)</code>(单个)、<code>localStorage.clear()</code>(全部)。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setStore</span> = (<span class="params">name, content</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!name) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> content !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    content = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(content);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(name, content);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getStore</span> = name =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!name) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">removeStore</span> = name =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!name) <span class="keyword">return</span>;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">removeItem</span>(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="sessionStorage"><a href="#sessionStorage" class="headerlink" title="sessionStorage"></a>sessionStorage</h2><blockquote>
<p>会话存储，关闭浏览器之后数据就会消失。非常适合单页应用程序，便于各业务模块之间的传值</p>
</blockquote>
<ul>
<li>特点<ul>
<li><strong>同源策略限制</strong> </li>
<li><strong>单标签页限制</strong>：同一个标签页中的同源页面共享数据。</li>
<li><strong>只在本地存储</strong>：数据只会在存储在本地，并在标签页关闭后清除。</li>
<li><strong>存储方式</strong>：采用键值对的方式，注意 value 值必须为字符串类型。</li>
<li><strong>存储上限限制</strong>：不同的浏览器存储的上限不同，但大多数限制在 5MB 以下。</li>
</ul>
</li>
<li>API<ul>
<li>存储：<code>sessionStorage.setItem(key, value)</code></li>
<li>读取<ul>
<li>单个：<code>sessionStorage.getItem(key)</code></li>
<li>全部：<code>sessionStorage.valueOf()</code></li>
</ul>
</li>
<li>删除<ul>
<li>单个：<code>sessionStorage.removeItem(key)</code></li>
<li>全部：<code>sessionStorage.clear()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="以上区别"><a href="#以上区别" class="headerlink" title="以上区别"></a>以上区别</h2><ul>
<li>传递<ul>
<li>cookie 数据通常经过加密，而且会在浏览器和服务器间来回传递。</li>
<li>后两个不会自动把数据发给服务器，仅在本地保存。</li>
</ul>
</li>
<li>存储大小<ul>
<li>cookie 数据大小不能超过4k，始终在同源的 http 请求中携带。</li>
<li>后两个虽然也有存储大小的限制但比 cookie 大得多，可以达到 5M 及以上。</li>
</ul>
</li>
<li>生命周期<ul>
<li>cookie 数据只在过期时间之前一直有效。</li>
<li>localStorage存储持久数据，不要不主动删除数据就有效有效。</li>
<li>sessionStorage数据在当前浏览器窗口关闭后自动删除。</li>
</ul>
</li>
<li>作用域    <ul>
<li>sessionStorage 不在不同浏览器窗口中共享。</li>
<li>另外两个在所有同源窗口中都共享。</li>
</ul>
</li>
</ul>
<h2 id="临时数据"><a href="#临时数据" class="headerlink" title="临时数据"></a>临时数据</h2><blockquote>
<p>html 标签上添加自定义属性来存储和操作数据，注意 js 可以动态添加和删除，但不能删除行内添加的。</p>
</blockquote>
<ul>
<li>html：<code>div data-name=&quot;值&quot;</code>，name 为自定义属性名</li>
<li>注意：<code>data-e-name：eName, data-myName：myname</code></li>
<li>原生 js<ul>
<li>获取：<code>div.dataset.name</code></li>
<li>设置：<code>div.dataset.name = new</code></li>
<li>删除：<code>div.dataset.name = null</code></li>
</ul>
</li>
<li>jQuery<ul>
<li>获取：<code>$(&quot;div&quot;).data(&quot;name&quot;)</code></li>
<li>设置：<code>$(&quot;div&quot;).data(&quot;name&quot;, &quot;new&quot;)</code></li>
<li>删除：<code>$(&quot;div&quot;).removeDate(&quot;name&quot;)</code></li>
</ul>
</li>
</ul>
<h2 id="离线存储"><a href="#离线存储" class="headerlink" title="离线存储"></a>离线存储</h2><blockquote>
<p>Application Cache 应用程序缓存，常用于存储网页</p>
</blockquote>
<ul>
<li>优势<ul>
<li>加载快：已缓存资源加载速度块</li>
<li>离线浏览：用户可以在应用离线时使用</li>
<li>减少服务器负载：浏览器只从服务器下载更新过的资源</li>
</ul>
</li>
<li>使用<ul>
<li>html 标签添加 manifest 属性：html manifest&#x3D;”.&#x2F;js&#x2F;demo.manifest”</li>
<li>编写 manifest 文件：用于告知浏览器需要缓存和不需要缓存的内容</li>
</ul>
</li>
</ul>
<h1 id="九、其它"><a href="#九、其它" class="headerlink" title="九、其它"></a>九、其它</h1><ul>
<li>普通元素<ul>
<li>新增标签：<code>nav、header、aside、section、footer、canvas、video、output、...</code></li>
<li>新增属性：<code>contextmenu、contentEditable、hidden、draggable、data-*</code></li>
</ul>
</li>
<li>表单元素<ul>
<li>输入验证：<code>邮箱、地址、日期、数字、电话、范围、搜索、颜色</code></li>
<li>新增属性：<code>required、pattern、autofocus、autocomplete、novalidate、multiple</code></li>
</ul>
</li>
<li>超链接<ul>
<li>短信：<code>&lt;a href=&#39;sms:15919218899&#39;&gt;&lt;/a&gt;</code></li>
<li>电话：<code>&lt;a href=&quot;tel:15919218899&quot;&gt;&lt;/a&gt;</code></li>
<li>邮件：<code>&lt;a href=&quot;mailto:99519876@qq.com&quot;&gt;&lt;/a&gt;</code></li>
<li>地图：<code>&lt;a href=&quot;http://map.baidu.com/mobile/search...&quot;&gt;&lt;/a&gt;</code></li>
<li>QQ客服：<code>&lt;a target=&quot;_blank&quot; href=&quot;http://wpa.qq.com/msgrd?v=3&amp;...&quot;&gt;&lt;/a&gt;</code></li>
</ul>
</li>
<li>History<ul>
<li>功能：实现无刷新更新地址</li>
<li>API：<code>history.pushState、history.replaceState</code></li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>HTML CSS</category>
      </categories>
      <tags>
        <tag>HTML CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Three.js 绘图插件</title>
    <url>/2019/03/10/2-5-web%E7%BB%98%E5%9B%BE/</url>
    <content><![CDATA[<h1 id="一、WebGL-原生绘图"><a href="#一、WebGL-原生绘图" class="headerlink" title="一、WebGL 原生绘图"></a>一、WebGL 原生绘图</h1><h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><h3 id="OpenGL、WebGL"><a href="#OpenGL、WebGL" class="headerlink" title="OpenGL、WebGL"></a>OpenGL、WebGL</h3><ul>
<li><strong>OpenGL</strong>：最常用的跨平台图形库，用于渲染 2D、3D 矢量图形的跨语言、跨平台的应用程序编程接口</li>
<li><strong>OpenGL ES</strong>：OpenGL API 的子集 GPU，是针对手机、PDA 和游戏主机等嵌入式设备而专门设计的接口</li>
<li><strong>GLSL</strong>：OpenGL ES 着色语言，用于OpenGL中着色编程的语言。在图形卡的GPU上执行，代替了固定的渲染管线的一部分，使渲染管线中不同层次具有可编程性，如视图转换、投影转换等。  </li>
<li><strong>WebGL</strong>：基于 OpenGL 设计的面向 web 的图形标准，它提供的一系列 Js API 对显卡的硬件细节进行了封装抽象，可用于控制 GPU渲染管线(显卡硬件) 进行图形渲染，从而获得了较高性能。</li>
<li><strong>WebGL程序</strong>：主要组成是 js控制代码 和 计算机的图形处理单元GPU。而 GPU 核心即着色程序 program 由顶点和片元两个着色器组成，使用 GLSL 编写并通过常以字符串的形式存放在Js中等待调用 (浏览器不识别 GLSL)。</li>
</ul>
<h3 id="CPU、GPU"><a href="#CPU、GPU" class="headerlink" title="CPU、GPU"></a>CPU、GPU</h3><blockquote>
<p>图像处理主要偏简单的矩阵运算，逻辑判断等很少。两者的设计架构不同。GPU很适合做简单的并发计算，应用于图像处理、深度学习等领域加快速度，引爆了人工智能</p>
</blockquote>
<ul>
<li><strong>CPU</strong><ul>
<li>可看作”万能教授”，但运算效率较低</li>
<li>中央处理器，计算机的运算和控制核心</li>
<li>需要很强的通用性来处理各种不同的数据类型和逻辑判断</li>
</ul>
</li>
<li><strong>GPU</strong><ul>
<li>可看作”专业学生”，用来实现硬件加速计算，执行重复运算效率高</li>
<li>图像处理器，是显卡的处理器和核心，也是图像运算工作的微处理器</li>
<li>专为执行复杂的数学和几何计算而设计，用于将 CPU 从图形处理的任务中解放出来而去执行其他更多的系统任务，提高计算机的整体性能</li>
</ul>
</li>
</ul>
<h3 id="图形渲染"><a href="#图形渲染" class="headerlink" title="图形渲染"></a>图形渲染</h3>  <div style="text-indent: 2em">渲染是从使用计算机程序模型生成图像的过程。在图形中一个虚拟场景的呈现需要使用 几何、视点、纹理、光照和阴影等通过一个渲染程序传递信息描述，输出一个数字图像。渲染可以在本地或远程上进行。复杂图像所需的硬件资源可以在专用服务器上完成，即基于服务器的绘制。渲染也可以通过在本地CPU完成, 即基于客户端的渲染。所以渲染类型如下：</div>

<ul>
<li><strong>软件渲染</strong>：所有的渲染是在 CPU 的帮助下计算完成。 </li>
<li><strong>硬件渲染</strong>：所有的图形计算都由 GPU (图形处理单元)完成的。</li>
</ul>
<h3 id="图形术语"><a href="#图形术语" class="headerlink" title="图形术语"></a>图形术语</h3><ul>
<li><strong>坐标系</strong>：x、y、z 轴<ul>
<li>无论画布多大，WebGL 上的坐标被限制为 (1, 1, 1)、(-1, -1, -1)。</li>
<li>WebGL 在 GPU 上的主要工作是将顶点数据通过矩阵变换转换到裁剪空间坐标，然后基于空间坐标绘制像素点。</li>
</ul>
</li>
<li><strong>缓冲</strong><ul>
<li>缓冲区对象，即将发送到 GPU 的一些二进制数据序列。</li>
<li>用于存储要绘制模型的各种数据，比如顶点、颜色等。</li>
<li>驻留在 GPU 存储器却可以被直接呈现，提高了性能。</li>
</ul>
</li>
<li><strong>图元</strong>：几何顶点的组合(点、线段和三角面)，一般是三角形。</li>
<li><strong>网格</strong>：使用顶点所绘的 2D、3D 模型，它的每个面被称为 一个片元 (一般是三角形)。</li>
<li><strong>片元和像素</strong><ul>
<li>在光栅化中纹理映射之后图元信息转化为了像素。</li>
<li>片元包括 像素点及其颜色、深度和纹理数据等信息。</li>
</ul>
</li>
<li><strong>着色器</strong><ul>
<li>现代 GPU 中的顶点处理和片段处理等可编程部分被称为着色器。</li>
<li>主要包括顶点着色器和片元着色器，可理解为运行在显卡中的指令和数据。</li>
<li>着色器程序使用的是 GLSL ES 语言，所以在 Js 中需要存放在字符串中等待调用编译，通过编译处理后传递给 顶点&#x2F;片元 着色器执行。</li>
</ul>
</li>
<li><strong>纹理图像</strong><ul>
<li>将一张真实图片贴到一个几何图像表面称为 纹理映射，映射的图像为纹理图像。</li>
<li>组成纹理图像的像素称为纹素，而纹理坐标 是纹理图像上的坐标，通过纹理坐标可以在纹理图像上获取纹素颜色。</li>
</ul>
</li>
<li><strong>绘图</strong><ul>
<li>WebGL 只能绘制 点、线和三角形，其他都是由它们合成后绘制到三维空间。</li>
<li>WebGL 中的顶点、颜色、纹理等几何详细信息存储在缓冲区对象，然后被传递到GPU上的着色器程序来创建图形对象。</li>
</ul>
</li>
</ul>
<h2 id="程序实现"><a href="#程序实现" class="headerlink" title="程序实现"></a>程序实现</h2><blockquote>
<p>程序代码是 Js、OpenGL 的组合，两者分别负责与 CPU、GPU 通信</p>
</blockquote>
<h3 id="显卡内部结构"><a href="#显卡内部结构" class="headerlink" title="显卡内部结构"></a>显卡内部结构</h3><blockquote>
<p>电脑一般都具有独立显卡</p>
</blockquote>
<ul>
<li><strong>GPU</strong>：渲染管线：可编程的着色器、不可编程的光栅器等，用于和 GPU 传递数据。</li>
<li><strong>显存</strong>：GPU 读写数据的存储区，主要组成有：<code>顶点缓存</code>(存储顶点的位置、颜色等数据)、<code>渲染缓存</code>(接收渲染管线生成数据)、<code>纹理缓存</code>(用于实现纹理贴图)、<code>帧缓存</code>(颜色缓存、深度缓存、模板缓存)。</li>
</ul>
<h3 id="图像绘制流程"><a href="#图像绘制流程" class="headerlink" title="图像绘制流程"></a>图像绘制流程</h3><blockquote>
<p>上线网站的 WebGL 相关文件会放在远程的服务器硬盘存储器。网页 http 请求后，CPU 将顶点坐标等数据 和 WebGL 程序代码 传递给 GPU 存储。</p>
</blockquote>
<ol>
<li>浏览器解析硬盘的 WebGL 文件，CPU 分配内存并将数据传递给 GPU 存储数据和程序代码</li>
<li>CPU 执行程序初始化并调用 GPU 存储的程序代码，初始化着色器时把处理好的 着色器程序 和 矩阵等数据 发送给 GPU 处理器</li>
<li>GPU 通过矩阵变换和光栅化等操作将图像信息转化为像素并写入显卡的帧缓存 (包括颜色、透明度等)</li>
<li>显示器扫描读取显存中的像素数据，然后显示到浏览器 canvas</li>
</ol>
<h3 id="GPU-处理流程"><a href="#GPU-处理流程" class="headerlink" title="GPU 处理流程"></a>GPU 处理流程</h3><blockquote>
<p>获取顶点坐标、图元装配、光栅化(生成片元, 即一个个像素点)、存储在缓存区</p>
</blockquote>
<ol>
<li><strong>数据准备</strong>：<code>uv</code>(贴图坐标)、<code>索引</code>(顶点绘制顺序)、<code>矩阵数据</code>(uniform 变量传递给顶点着色器)、<code>顶点坐标</code>(attribute 变量传递给顶点着色器，一般由三维软件导出)。</li>
<li><strong>图元装配</strong><br>* 顶点着色器(Js 定义的程序代码，初始化后会传递给 GPU) 将顶点坐标转换为图元。<br>* 本质：GPU 逐顶点数量执行顶点着色器，通过矩阵变换将 3D 坐标转为 2D 图形。</li>
<li><strong>光栅化</strong><br>* 片元着色器(处理模型的颜色、质地、光照效果、阴影) 将图元转换为像素点。<br>* 本质：GPU 逐片元数量执行片元着色器，为每个片元进行着色。</li>
<li><strong>存储到缓存区</strong>：片元只要通过了检测和融合 (融合单元主要实现透明度效果)，就可以存储到颜色缓存区，最终完成整个渲染。</li>
</ol>
<h2 id="绘图流程"><a href="#绘图流程" class="headerlink" title="绘图流程"></a>绘图流程</h2><ol>
<li><strong>初始化绘图上下文</strong>：<code>canvas.getContext(&quot;webgl&quot;, &#123; // 配置选项 &#125;</code>。</li>
<li><strong>初始化着色器程序</strong>：创建顶点着色器程序、片段着色器程序，然后通过 js 将这两个着色器 link 到一个 program (着色程序) 并提交到 GPU。</li>
<li><strong>建立模型和数据缓存</strong>：创建缓冲区对象并绑定到目标，然后写入顶点数据并连接所分配的变量。创建纹理并加载纹理图像，配置属性并在 webgl 中使用</li>
<li><strong>图像绘制和动画</strong>：简单图形 <code>gl.drawArrays(mode, first, count)</code>、复杂的三维图形：<code>gl.drawElements(mode, count, type, offset)</code>。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">webGLStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 初始化上下文</span></span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;myCanvas&quot;</span>);</span><br><span class="line">    <span class="title function_">initGL</span>(canvas);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化着色器</span></span><br><span class="line">    <span class="title function_">initShader</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化缓冲区</span></span><br><span class="line">    <span class="title function_">initBuffers</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化纹理图片</span></span><br><span class="line">    <span class="title function_">initTexture</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定清空画布的颜色，</span></span><br><span class="line">    gl.<span class="title function_">clearColor</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清除颜色缓冲区 (使用定义的颜色来填充相应区域)</span></span><br><span class="line">    gl.<span class="title function_">clear</span>(gl.<span class="property">COLOR_BUFFER_BIT</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开启隐藏面消除的功能  启用深度测试</span></span><br><span class="line">    gl.<span class="title function_">enable</span>(gl.<span class="property">DEPTH_TEST</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始绘制场景</span></span><br><span class="line">    <span class="title function_">drawScene</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="二、Three-js-基础使用"><a href="#二、Three-js-基础使用" class="headerlink" title="二、Three.js 基础使用"></a>二、Three.js 基础使用</h1><blockquote>
<p>将创建好的物体添加到场景中，然后通过相机渲染到渲染器，从而呈现到网页。</p>
</blockquote>
<h2 id="对比-WebGL"><a href="#对比-WebGL" class="headerlink" title="对比 WebGL"></a>对比 WebGL</h2><ul>
<li>WebGL：浏览器提供的原生 API，需要数学和图形学的知识，学习和开发的成本较高。</li>
<li>Three.js：可看作是一款 webGL 框架。它将复杂接口简单化，上手比较容易。简化的工作主要有：<code>辅助导出模型数据、自动生成各种矩阵、生成了顶点着色器、辅助生成材质并配置灯光、根据设置的材质生成片元着色器</code>。</li>
</ul>
<h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><ol>
<li>创建场景：构建一个三维空间。</li>
<li>创建相机：选择一个观察点，并确定观察方向&#x2F;角度等。</li>
<li>创建物体并添加至场景中：在场景中添加供观察的物体。</li>
<li>创建渲染器并渲染场景：将观察到的场景渲染到屏幕上。</li>
</ol>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 绘制网格线</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initGrid</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 场景</span></span><br><span class="line">  <span class="keyword">var</span> scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 相机</span></span><br><span class="line">  <span class="keyword">var</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrthographicCamera</span>(-<span class="number">5</span>, <span class="number">5</span>, <span class="number">3.75</span>, -<span class="number">3.75</span>, <span class="number">0.1</span>, <span class="number">100</span>);</span><br><span class="line">  camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>, -<span class="number">25</span>, <span class="number">0</span>);</span><br><span class="line">  camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">  scene.<span class="title function_">add</span>(camera);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染器</span></span><br><span class="line">  <span class="keyword">var</span> renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>(&#123; <span class="attr">antialias</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  renderer.<span class="title function_">setSize</span>(<span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line">  renderer.<span class="property">autoClear</span> = <span class="literal">false</span>;</span><br><span class="line">  renderer.<span class="title function_">setClearColor</span>(<span class="number">0x000000</span>);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义一个几何体</span></span><br><span class="line">  <span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>();</span><br><span class="line">  geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">  geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">      <span class="comment">// 定义竖着的线段</span></span><br><span class="line">      <span class="keyword">var</span> line = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geometry, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">          <span class="attr">color</span>: <span class="number">0xffffff</span>,</span><br><span class="line">      &#125;));</span><br><span class="line">      <span class="comment">// 线段之间的间隔为 0.8，-2 是为了达到田字格的效果</span></span><br><span class="line">      line.<span class="property">position</span>.<span class="property">z</span> = (i * <span class="number">0.8</span>) - <span class="number">2</span>;</span><br><span class="line">      scene.<span class="title function_">add</span>(line);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 定义横着的线段</span></span><br><span class="line">      <span class="keyword">var</span> line = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geometry, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">          <span class="attr">color</span>: <span class="number">0xffffff</span>,</span><br><span class="line">          <span class="attr">opacity</span>: <span class="number">0.2</span></span><br><span class="line">      &#125;));</span><br><span class="line">      line.<span class="property">position</span>.<span class="property">x</span> = (i * <span class="number">0.8</span>) - <span class="number">2</span>;</span><br><span class="line">      line.<span class="property">rotation</span>.<span class="property">y</span> = <span class="number">90</span> * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span>;</span><br><span class="line">      scene.<span class="title function_">add</span>(line);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 渲染</span></span><br><span class="line">      renderer.<span class="title function_">render</span>(scene, camera);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="场景动画"><a href="#场景动画" class="headerlink" title="场景动画"></a>场景动画</h2><blockquote>
<p>在循环渲染(即重绘，循环绘制新场景) 的过程中不断改变 <code>物体属性(scale、rotation、position、material) 或相机属性(位置、方向、面向坐标)</code>，让场景动起来。</p>
</blockquote>
<ul>
<li><strong>直接实现</strong><ul>
<li>物体移动而摄像机不动：<code>mesh.position.x -= 1</code></li>
<li>摄像机移动而物体不动：<code>camera.position.x = camera.position.x + 1</code></li>
</ul>
</li>
<li><strong>Tween.js</strong><ul>
<li>引入后可以定义某个属性值的过渡而实现复杂动画</li>
<li>它会自动计算出起止的所有中间值，这个过程叫做 tweening 补间</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 旋转的正方体</span></span><br><span class="line"><span class="keyword">var</span> scene, camera, renderer, mesh, stats;</span><br><span class="line"><span class="title function_">initThree</span>();</span><br><span class="line"><span class="title function_">animation</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initThree</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 创建场景对象 (插入光照/物体)</span></span><br><span class="line">  scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建相机对象</span></span><br><span class="line">  <span class="keyword">var</span> aspect = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">  camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>( <span class="number">70</span>, aspect, <span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 光照设置</span></span><br><span class="line">  <span class="keyword">var</span> light = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>( <span class="number">0xffffff</span> );</span><br><span class="line">  light.<span class="property">position</span>.<span class="title function_">set</span>( <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span> ).<span class="title function_">normalize</span>();  <span class="comment">// 光源位置</span></span><br><span class="line">  scene.<span class="title function_">add</span>(light);    <span class="comment">// 将光照插入场景</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建网络模型</span></span><br><span class="line">  <span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>( <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>);  <span class="comment">// 立方体几何对象</span></span><br><span class="line">  <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;        <span class="comment">// 材质对象</span></span><br><span class="line">          <span class="attr">color</span>: <span class="number">0x0033ff</span>, </span><br><span class="line">          <span class="attr">specular</span>: <span class="number">0x555555</span>, </span><br><span class="line">          <span class="attr">shininess</span>: <span class="number">30</span> </span><br><span class="line">  &#125;);</span><br><span class="line">  mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material );   <span class="comment">// 网格模型对象</span></span><br><span class="line">  mesh.<span class="property">position</span>.<span class="property">z</span> = -<span class="number">50</span>;</span><br><span class="line">  scene.<span class="title function_">add</span>(mesh);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建渲染器对象</span></span><br><span class="line">  renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>(&#123; <span class="attr">antialias</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>)</span><br><span class="line">  renderer.<span class="title function_">clear</span>()                        </span><br><span class="line">  renderer.<span class="title function_">setClearColor</span>(<span class="number">0xb9d3ff</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>( <span class="string">&#x27;resize&#x27;</span>, onWindowResize, <span class="literal">false</span> );</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onWindowResize</span>(<span class="params"></span>) &#123;</span><br><span class="line">      camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">      camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">      renderer.<span class="title function_">setSize</span>( <span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span> );</span><br><span class="line">      <span class="title function_">render</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 执行渲染</span></span><br><span class="line">  <span class="title function_">render</span>();         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene, camera)    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单动画：在循环渲染过程中不断改变 物体/相机的属性，从而让场景动起来</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animation</span>(<span class="params"></span>) &#123;</span><br><span class="line">    mesh.<span class="property">rotation</span>.<span class="property">x</span> += <span class="number">.04</span>;</span><br><span class="line">    mesh.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">.02</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animation);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mesh.material = new THREE.MeshLambertMaterial(&#123;</span></span><br><span class="line">    <span class="comment">//     color: 0xff0000</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// mesh.position.z = 1;</span></span><br><span class="line">    <span class="comment">// mesh.position.set(1.5, -0.5, 0);</span></span><br><span class="line">    <span class="comment">// mesh.position = new THREE.Vector3(1.5, -0.5, 0);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新性能插件     </span></span><br><span class="line">    <span class="comment">// stats.update();  </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 让物体运动</span></span><br><span class="line">    <span class="comment">// TWEEN.update();   </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复杂动画：Tween 的任何一个函数返回的都是自身，支持链式编程</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initTween</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(mesh.<span class="property">position</span>)    <span class="comment">// 要改变属性的对象</span></span><br><span class="line">            .<span class="title function_">to</span>( &#123; <span class="attr">x</span>: -<span class="number">400</span> &#125;, <span class="number">3000</span> )  <span class="comment">// 目标值和需要时间</span></span><br><span class="line">            .<span class="title function_">repeat</span>( <span class="title class_">Infinity</span> )       <span class="comment">// 重复无穷次</span></span><br><span class="line">            .<span class="title function_">start</span>();                 <span class="comment">// 开始动画</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="性能检测"><a href="#性能检测" class="headerlink" title="性能检测"></a>性能检测</h2><blockquote>
<p>引用插件 stats.js 之后可以在场景中的左上角看到视图小框，点击切换可看到以下信息。</p>
</blockquote>
<ul>
<li>**38 MS (19-74)**：MS 表示渲染一帧需要的毫秒数，其值越小越好。</li>
<li>**34 FPS (30-34)**：FPS 表示每秒渲染的帧数，其值越大越好，括号内表示帧率范围。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 动画性能检测： http://www.wjceo.com/lib/js/libs/stats.min.js</span></span><br><span class="line">stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数为 0 时显示 FPS 界面，参数为 1 时显示 MS 界面</span></span><br><span class="line">stats.<span class="title function_">setMode</span>(<span class="number">1</span>);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// stats 的界面对应左上角</span></span><br><span class="line">stats.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">stats.<span class="property">domElement</span>.<span class="property">left</span> = <span class="string">&#x27;0px&#x27;</span>;</span><br><span class="line">stats.<span class="property">domElement</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(stats.<span class="property">dom</span>);</span><br></pre></td></tr></table></figure>


<h2 id="绘图要素"><a href="#绘图要素" class="headerlink" title="绘图要素"></a>绘图要素</h2><blockquote>
<p>绘图页面中必备且唯一的要素：camera、scene、renderer</p>
</blockquote>
<ul>
<li><strong>Scene</strong>：场景（三维空间），是物体、光源等元素的容器 </li>
<li><strong>Camera</strong>：相机（观察者），控制视角位置、范围和焦点位置 </li>
<li><strong>Object3D</strong>：物体（三维模型），包括二维的点线面、三维的粒子等</li>
<li><strong>Light</strong>：光源，包括全局光、平行光、点光源等</li>
<li><strong>Renderer</strong>：渲染器（画布），用于渲染场景及其物体</li>
<li><strong>Control</strong>：控制器（相机控件），可通过键盘、鼠标控制相机</li>
</ul>
<h3 id="相机"><a href="#相机" class="headerlink" title="相机"></a>相机</h3><ul>
<li><strong>正投影相机</strong>：OrthographicCamera，物体的实际尺寸而远近相同。<ul>
<li>参数：视角、窗口的长宽比、近远裁面的距离</li>
<li>OrthographicCamera(left, right, top, bottom, near, far)</li>
</ul>
</li>
<li><strong>透视投影相机</strong>：PerspectiveCamera，类似人眼而近大远小。</li>
<li><strong>3D 相机</strong>：StereoCamera，合成两个相机的拍摄结果，用于 3D 立体影像或视差屏障等效果。</li>
<li><strong>全景相机</strong>：CubeCamera，可以 360 度拍摄。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 属性设置</span></span><br><span class="line">camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>, -<span class="number">1</span>, <span class="number">5</span>);    <span class="comment">// 设定相机位置 </span></span><br><span class="line">camera.<span class="property">up</span>.<span class="property">x</span> = <span class="number">0</span>;                 <span class="comment">// 相机以哪个方向为上方</span></span><br><span class="line">camera.<span class="title function_">lookAt</span>(scene.<span class="property">position</span>);   <span class="comment">// 相机面向哪个坐标(默认面向z轴负方向)</span></span><br><span class="line">camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>));  <span class="comment">// 相机往x轴移动10单位 </span></span><br></pre></td></tr></table></figure>


<h3 id="物体"><a href="#物体" class="headerlink" title="物体"></a>物体</h3><blockquote>
<p>Object3D 是它们的基类。创建时需要 几何体和材质，几何体定义模型的形状 (骨架)，材质定义几何图形的表面效果 (皮肤，包括颜色、纹理、透明度、质感等)。</p>
</blockquote>
<ul>
<li><p>分类</p>
<ul>
<li><strong>Line</strong>：线段模型，由线条组成</li>
<li><strong>Mesh</strong>：网格模型，由三角面和四边形面组成</li>
<li><strong>Points</strong>：粒子系统，使用一堆点的集合来描述</li>
<li><strong>Sprite</strong>：精灵图，指包含于场景中的二维图像或动画，用于加载纹理(不接受阴影)。</li>
</ul>
</li>
<li><p>几何体</p>
<ul>
<li><strong>构造函数创建</strong>：Geometry 是它们的基类<ul>
<li><strong>二维平面</strong><ul>
<li>圆平面：CircleGeometry </li>
<li>矩形平面：PlaneGeometry</li>
</ul>
</li>
<li><strong>三维几何体</strong><ul>
<li>立方体：BoxGeometry、CubeGeometry(旧版本)</li>
<li>球体：SphereGeometry    </li>
<li>圆柱：CylinderGeometry</li>
<li>圆环：TorusGeometry</li>
<li>环面：TorusKnotGeometry</li>
<li>多面体：PolyhedronGeometry</li>
<li>正四面体：TetrahedronGeometry</li>
<li>正八面体：OctahedronGeometry</li>
<li>正二十面体：IcosahedronGeometry</li>
<li>复杂几何体<ul>
<li>凸面体：ConvexGeometry</li>
<li>扫描体：LatheGeometry</li>
<li>管状体：TubeGeometry</li>
<li>拉伸几何体：ExtrudeGeometry</li>
<li>参数几何体：ParameterGeometry</li>
<li>文本几何体：TextGeometry</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>自定义创建</strong><ul>
<li><strong>三维</strong><ul>
<li>几何体：Geometry</li>
<li>顶点：Vector3</li>
<li>顶面：Face3</li>
</ul>
</li>
<li><strong>二维</strong><ul>
<li>平面：Shape</li>
<li>线条<ul>
<li>直线：moveTo、lineTo </li>
<li>圆弧：arc、absarc </li>
<li>椭圆：ellipse、absellipse </li>
<li>贝塞尔曲线：quadraticCurveTo</li>
</ul>
</li>
<li>几何体          <ul>
<li>makeGeometry</li>
<li>createPointsGeometry</li>
<li>createSpacedPointsGeometry</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initShape</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 模型对象和材质对象 </span></span><br><span class="line">  <span class="keyword">var</span> geometry, material;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// -------------- 构造函数创建 ---------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 矩形平面：PlanGeometry(长,宽, 长的分割, 宽的分割) </span></span><br><span class="line">  <span class="keyword">let</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">100</span>, <span class="number">50</span>)</span><br><span class="line">  <span class="keyword">let</span> planeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0xffffff</span> &#125;)</span><br><span class="line">  <span class="keyword">let</span> plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,planeMaterial)</span><br><span class="line">  plane.<span class="property">receiveShadow</span> = <span class="literal">true</span>        <span class="comment">// 接收阴影</span></span><br><span class="line">  plane.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="number">0.5</span>*<span class="title class_">Math</span>.<span class="property">PI</span>   <span class="comment">// x 轴旋转 -90 度</span></span><br><span class="line">  plane.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">  scene.<span class="title function_">add</span>( plane )</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 圆平面：CircleGeometry(半径, 切片数, 开始, 跨过角度)  </span></span><br><span class="line">  <span class="comment">// 切片数越大则越接近圆, 参数为3(最小值)是三角形, 参数为4则是矩形</span></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CircleGeometry</span>(<span class="number">3</span>, <span class="number">100</span>)</span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0xffffff</span> &#125;)</span><br><span class="line">  <span class="keyword">let</span> circle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 圆环：TorusGeometry(半径, 管道半径, 纬度分割, 经度分割, 圆环面的弧度)</span></span><br><span class="line">  <span class="comment">// 最后一个参数 控制是否绘制完整一个圆环</span></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TorusGeometry</span>(<span class="number">5</span>, <span class="number">1</span>, <span class="number">50</span>, <span class="number">50</span>)  </span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0x7777ff</span> &#125;)</span><br><span class="line">  <span class="keyword">let</span> torus = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 立方体：BoxGeometry(长, 宽, 高, 长的分割, 宽的分割, 高的分割)</span></span><br><span class="line">  <span class="comment">// 旧版本用CubeGeometry</span></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0xff0000</span> &#125;)</span><br><span class="line">  <span class="keyword">let</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 球体：SphereGeometry(半径, 经度切片, 纬度切片, 经度开始, 经度跨过, 纬度开始, 纬度跨过)</span></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">4</span>, <span class="number">20</span>, <span class="number">20</span>)</span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0x7777ff</span> &#125; )</span><br><span class="line">  <span class="keyword">let</span> sphere = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material)</span><br><span class="line">  sphere.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">1.5</span>,<span class="number">1.5</span>,<span class="number">1.5</span>);  <span class="comment">//缩放</span></span><br><span class="line">    </span><br><span class="line">        </span><br><span class="line">  <span class="comment">// 圆柱：CylinderGeometry(顶部面积, 底部面积, 高, 圆分割, 高分割, 是否没有顶面和底面) </span></span><br><span class="line">  <span class="comment">// 顶部或底部为0，则变成圆锥</span></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CylinderGeometry</span>(<span class="number">2</span>, <span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0x7777ff</span> &#125;)</span><br><span class="line">  <span class="keyword">let</span> cylinder = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 正 20 面体 </span></span><br><span class="line">  meometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">IcosahedronGeometry</span>(<span class="number">4</span>, <span class="number">0</span>);   </span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>( &#123;<span class="attr">color</span>: <span class="number">0x7777ff</span>&#125; )</span><br><span class="line">  <span class="keyword">let</span> icosahedron = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// -------------- 自定义创建 ---------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 点模型</span></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>();    <span class="comment">// 声明一个空几何体对象</span></span><br><span class="line">  <span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);   <span class="comment">// 顶点1坐标</span></span><br><span class="line">  <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="number">0</span>);   <span class="comment">// 顶点2坐标</span></span><br><span class="line">  <span class="keyword">var</span> p3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">15</span>, <span class="number">15</span>, <span class="number">0</span>);  <span class="comment">// 顶点3坐标</span></span><br><span class="line">  geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(p1,p2,p3);       <span class="comment">// 顶点坐标添加到geometry对象</span></span><br><span class="line"></span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointsMaterial</span>(&#123;  <span class="comment">// 点对象像素的颜色尺寸</span></span><br><span class="line">      <span class="attr">color</span>: <span class="number">0x0000ff</span>,</span><br><span class="line">      <span class="attr">size</span>: <span class="number">10.0</span>       </span><br><span class="line">  &#125;); </span><br><span class="line">  <span class="keyword">var</span> points = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(geometry, material);</span><br><span class="line">  scene.<span class="title function_">add</span>(points);        <span class="comment">// 点模型添加到场景中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 线条</span></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>();</span><br><span class="line">  <span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="number">0</span>);</span><br><span class="line">  geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(p1, p2);           <span class="comment">// vertices 存放坐标</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> color1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xFF0000</span>);  </span><br><span class="line">  <span class="keyword">var</span> color2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x0000FF</span>);   </span><br><span class="line">  geometry.<span class="property">colors</span>.<span class="title function_">push</span>(color1, color2);      <span class="comment">// colors 存放顶点颜色</span></span><br><span class="line">  </span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">      <span class="comment">// color: 0x0000ff,        // 线条颜色，用16进制表示，默认白色</span></span><br><span class="line">      <span class="attr">vertexColors</span>: <span class="variable constant_">THREE</span>.<span class="property">VertexColors</span>,  <span class="comment">// 线条材质是否使用顶点颜色</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">var</span> line = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geometry, material);</span><br><span class="line">  scene.<span class="title function_">add</span>(line);  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 三角面和矩形 </span></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>(); </span><br><span class="line">  <span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>); </span><br><span class="line">  <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">80</span>, <span class="number">0</span>, <span class="number">0</span>); </span><br><span class="line">  <span class="keyword">var</span> p3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">80</span>, <span class="number">0</span>); </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建三角面及其法向量 (平面的法向量垂直于平面本身)</span></span><br><span class="line">  geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(p1, p2, p3); </span><br><span class="line">  <span class="keyword">var</span> normal = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> ); </span><br><span class="line">  <span class="keyword">var</span> face = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>( <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, normal); </span><br><span class="line">  <span class="keyword">var</span> color1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xFF0000</span>);  <span class="comment">// 红色</span></span><br><span class="line">  <span class="keyword">var</span> color2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x00FF00</span>);  <span class="comment">// 绿色</span></span><br><span class="line">  <span class="keyword">var</span> color3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x0000FF</span>);  <span class="comment">// 蓝色</span></span><br><span class="line">  face.<span class="property">vertexColors</span>.<span class="title function_">push</span>(color1, color2, color3);  <span class="comment">// 定义顶点颜色</span></span><br><span class="line">  geometry.<span class="property">faces</span>.<span class="title function_">push</span>(face); </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建矩形平面</span></span><br><span class="line">  <span class="keyword">var</span> p4 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">80</span>, <span class="number">0</span>); </span><br><span class="line">  geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(p1, p2, p3, p4); </span><br><span class="line">  <span class="keyword">var</span> normal = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>); </span><br><span class="line">  <span class="keyword">var</span> face0 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, normal); </span><br><span class="line">  <span class="keyword">var</span> face1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, normal); </span><br><span class="line">  geometry.<span class="property">faces</span>.<span class="title function_">push</span>(face0, face1); </span><br><span class="line"></span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">      <span class="attr">color</span>: <span class="number">0x0000ff</span>,         </span><br><span class="line">      <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>   <span class="comment">// 两面可见</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry,material);</span><br><span class="line">  scene.<span class="title function_">add</span>(mesh);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 二维图形：ShapeGeometry(shapes, options)  </span></span><br><span class="line">  <span class="comment">// shapes 参数: THREE.Shape对象可单个传入, 多个时传数组</span></span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">0</span>, y = <span class="number">0</span></span><br><span class="line">  <span class="keyword">var</span> heartShape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()  <span class="comment">// 心形</span></span><br><span class="line"></span><br><span class="line">  heartShape.<span class="title function_">moveTo</span>( x + <span class="number">5</span>, y + <span class="number">5</span> )</span><br><span class="line">  heartShape.<span class="title function_">bezierCurveTo</span>( x + <span class="number">5</span>, y + <span class="number">5</span>, x + <span class="number">4</span>, y, x, y )</span><br><span class="line">  heartShape.<span class="title function_">bezierCurveTo</span>( x - <span class="number">6</span>, y, x - <span class="number">6</span>, y + <span class="number">7</span>,x - <span class="number">6</span>, y + <span class="number">7</span> )</span><br><span class="line">  heartShape.<span class="title function_">bezierCurveTo</span>( x - <span class="number">6</span>, y + <span class="number">11</span>, x - <span class="number">3</span>, y + <span class="number">15.4</span>, x + <span class="number">5</span>, y + <span class="number">19</span> )</span><br><span class="line">  heartShape.<span class="title function_">bezierCurveTo</span>( x + <span class="number">12</span>, y + <span class="number">15.4</span>, x + <span class="number">16</span>, y + <span class="number">11</span>, x + <span class="number">16</span>, y + <span class="number">7</span> )</span><br><span class="line">  heartShape.<span class="title function_">bezierCurveTo</span>( x + <span class="number">16</span>, y + <span class="number">7</span>, x + <span class="number">16</span>, y, x + <span class="number">10</span>, y )</span><br><span class="line">  heartShape.<span class="title function_">bezierCurveTo</span>( x + <span class="number">7</span>, y, x + <span class="number">5</span>, y + <span class="number">5</span>, x + <span class="number">5</span>, y + <span class="number">5</span> )</span><br><span class="line"></span><br><span class="line">  geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ShapeGeometry</span>( heartShape )</span><br><span class="line">  material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>( &#123; <span class="attr">color</span>: <span class="number">0x00ff00</span> &#125; )</span><br><span class="line">  <span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>( geometry, material ) </span><br><span class="line">  scene.<span class="title function_">add</span>( mesh )</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 几何体 </span></span><br><span class="line">  <span class="comment">// 1.创建顶点</span></span><br><span class="line">  <span class="keyword">var</span> vertices = [</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,-<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.创建面</span></span><br><span class="line">  <span class="keyword">var</span> faces = [</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">0</span>,<span class="number">4</span>,<span class="number">1</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>),</span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Face3</span>(<span class="number">5</span>,<span class="number">1</span>,<span class="number">4</span>),</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.创建几何体架构</span></span><br><span class="line">  <span class="keyword">var</span> geom = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>()</span><br><span class="line">  geom.<span class="property">vertices</span> = vertices</span><br><span class="line">  geom.<span class="property">faces</span> = faces</span><br><span class="line">  geom.<span class="title function_">computeFaceNormals</span>()  <span class="comment">//计算法向量, 这决定了对光做出的反应</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.添加材质</span></span><br><span class="line">  <span class="keyword">var</span> materials = [</span><br><span class="line">      <span class="comment">// 几何体面的材质 (Lambert材质适合光照)</span></span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; </span><br><span class="line">          <span class="attr">opacity</span>: <span class="number">0.8</span>, </span><br><span class="line">          <span class="attr">color</span>:<span class="number">0x44e144</span>, </span><br><span class="line">          <span class="attr">transparent</span>: <span class="literal">true</span> </span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 一个几何体框架的材质</span></span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">          <span class="attr">color</span>:<span class="number">0x008800</span>,</span><br><span class="line">          <span class="attr">wireframe</span>:<span class="literal">true</span></span><br><span class="line">      &#125;),</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5.创建几何体(传入结构, 材质)</span></span><br><span class="line">  mesh = <span class="variable constant_">THREE</span>.<span class="property">SceneUtils</span>.<span class="title function_">createMultiMaterialObject</span>(geom, materials) </span><br><span class="line">  mesh.<span class="property">name</span> = <span class="string">&#x27;源&#x27;</span></span><br><span class="line">  mesh.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">      e.<span class="property">castShadow</span> = <span class="literal">true</span>  <span class="comment">//可以生成影子</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6.添加进场景中</span></span><br><span class="line">  scene.<span class="title function_">add</span>(mesh);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="材质"><a href="#材质" class="headerlink" title="材质"></a>材质</h3><blockquote>
<p>三维物体表面各个可视属性（颜色、纹理、光滑度、透明度、反射率、反光度等）的结合，决定了物体的外观效果。THREE.Material 是材质的基类，拥有所有材质的公有属性，它派生出的各种材质如下：</p>
</blockquote>
<ul>
<li><strong>MeshBasicMaterial</strong>：基础材质，用于显示几何体的线框并给几何体赋予一种简单的颜色。特点：材质颜色如果没有指定则随机、物体颜色始终是材质颜色并且不会因光照产生明暗、阴影效果。</li>
<li><strong>MeshLambertMaterial</strong>：朗伯材质，用于创建 暗淡的、不光亮的表面。特点：可以通过 emissive 属性给材质添加亮色、在物体表面均匀地散射灯光，比如纸的表面粗糙但亮度均匀。</li>
<li><strong>MeshPhongMaterial</strong>：Phong 式材质，用于创建金属类光亮的表面。特点：反光强度更大、会给表面添加金属光泽、可通过 shininess 属性改变反光强度。</li>
<li><strong>MeshStandardMaterial</strong>：网格标准材质，用于创建暗淡的、有金属性光泽的表面。特点：MeshLambertMaterial 和 MeshPhoneMaterial 的结合、同时具有粗糙度和金属性的材质并且可以改变这些属性。</li>
<li><strong>MeshDepthMaterial</strong>：深度材质，根据内容所在的深度对网格对象的灰度级别从黑到白绘制。</li>
<li><strong>MeshNormalMaterial</strong>：法向材质，根据面的法线或朝向使用不同的颜色来渲染网格的面。</li>
<li><strong>MeshFaceMaterial</strong>：面材质，一个可以为几何体的各个表面指定不同颜色的容器。</li>
<li><strong>ShaderMaterial</strong>：着色器材质，允许使用自定义的着色器程序，比如顶点的放置方式、像素的着色方式。</li>
<li><strong>LineBasicMaterial</strong>：直线基础材质，用于在 THREE.Line 中创建着色的直线。</li>
<li><strong>LineDashMaterial</strong>：虚线材质，允许创建出一种虚线的效果。</li>
<li><strong>PointsMaterial</strong>：粒子材质，适用于粒子系统、模拟雪花雨等。</li>
<li><strong>SpriteMaterial</strong>：雪碧材质，用于加载图像纹理、canvas 创建的纹理等。</li>
</ul>
<h3 id="光源"><a href="#光源" class="headerlink" title="光源"></a>光源</h3><blockquote>
<p>THREE.Light 是所有光源的基类，其构造函数接受 hex(一个16进制的颜色值)作为参数。但要让光源具有颜色之外的特性。我们需要使用由基类派生出来的其他种类光源，注意环境光、方向光的光强不受距离远近影响。</p>
</blockquote>
<h4 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h4><ul>
<li><strong>AmbientLight</strong><ul>
<li>名称：环境光</li>
<li>功能：弱化阴影、添加颜色</li>
<li>光线：来自各个方向并均匀反射到物体表面</li>
<li>特点：影响整个场景、没有特定来源、不会影响生成阴影、不能作为场景唯一光源</li>
</ul>
</li>
<li><strong>DirectionLight</strong><ul>
<li>名称：平行光、方向光</li>
<li>功能：常用于实现阴影效果</li>
<li>光线：一组没有衰减的平行光线，类似太阳光</li>
<li>特点：产生阴影、光强相同、效果只与方向有关</li>
</ul>
</li>
<li><strong>PointLight</strong><ul>
<li>名称：点光源</li>
<li>光线：单点发光但辐射四面八方</li>
<li>特点：类似蜡烛和灯泡、单点发光、不产生阴影</li>
</ul>
</li>
<li><strong>SpotLight</strong><ul>
<li>名称：聚光灯      </li>
<li>功能：实现阴影效果，类似台灯、手电筒</li>
<li>光线：从一个锥体中射出并在物体上产生聚光的效果</li>
<li>特点：距离越远则光强越弱、光强衰减指数越大则光强衰减越快</li>
</ul>
</li>
</ul>
<h4 id="影响材质"><a href="#影响材质" class="headerlink" title="影响材质"></a>影响材质</h4><blockquote>
<p>只有在正常的光照条件下，我们才能容易分辨物体的材质。</p>
</blockquote>
<ul>
<li>没有任何光源时，材质颜色最终是黑色 (离开光时材质无法体现)。</li>
<li>Lambert 材质会受环境光的影响而呈现环境光的颜色，与材质本身颜色关系不大。</li>
<li>只有环境光时，灯光位置不影响材质效果(阴影等)。只有其他光源时，能照射到的地方为 光源颜色，不能照射的地方则呈现暗色(黑色)。</li>
<li>当混合光源存在时，单一光源能照射的地方呈现为 对应的光源颜色，多种光源都能照射到的地方是 颜色相加结果，都不能照射到的则呈现 暗色&#x2F;环境光颜色。<ul>
<li>光源：环境光为 绿色(0x00FF00)，平行光为 红色(0xFF0000)</li>
<li>效果：平行光照射到的地方呈现黄色(颜色值相加：0xFFFF00)，其它呈现绿色</li>
</ul>
</li>
</ul>
<h4 id="阴影效果"><a href="#阴影效果" class="headerlink" title="阴影效果"></a>阴影效果</h4>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initShadow</span>(<span class="params"></span>) &#123; </span><br><span class="line">  <span class="comment">// 告诉render我要渲染阴影</span></span><br><span class="line">  renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 让物体(立方体)投射阴影</span></span><br><span class="line">  <span class="keyword">var</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>)</span><br><span class="line">  <span class="keyword">var</span> mat = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhoneMaterial</span>(&#123;<span class="attr">color</span>:<span class="number">0xffffff</span>&#125;)</span><br><span class="line">  <span class="keyword">var</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo,mat)</span><br><span class="line">  box.<span class="property">castShadow</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 让其他物体(平面)接受阴影</span></span><br><span class="line">  <span class="keyword">var</span> geo_2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">100</span>,<span class="number">50</span>,<span class="number">32</span>,<span class="number">32</span>)</span><br><span class="line">  <span class="keyword">var</span> mat_2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhoneMaterial</span>(&#123;<span class="attr">color</span>:<span class="number">0xeeeeee</span>, <span class="attr">side</span>:<span class="variable constant_">THREE</span>.<span class="property">DoubleSize</span>&#125;)</span><br><span class="line">  <span class="keyword">var</span> plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo_2, mat_2)</span><br><span class="line">  plane.<span class="property">receiveShadow</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 告诉光源需要投射阴影</span></span><br><span class="line">  <span class="keyword">var</span> light = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>(<span class="number">0xffffff</span>)</span><br><span class="line">  light.<span class="property">castShadow</span> = <span class="literal">true</span> </span><br><span class="line">  scene.<span class="title function_">add</span>(light)    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="渲染器"><a href="#渲染器" class="headerlink" title="渲染器"></a>渲染器</h3><ul>
<li><strong>WebGLRender</strong>：使用 WebGL 渲染图形</li>
<li><strong>WebGLRenderTarget</strong>：渲染一个缓冲区</li>
<li><strong>WebGLRenderTargetCube</strong>：用于 CubeCamera</li>
<li><strong>CSS3DRenderer</strong>：基于 CSS3，简化版为 2D</li>
<li><strong>SVGRenderer</strong>：使用 SVG 渲染几何数据</li>
</ul>
<h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><ul>
<li><strong>FlyControls</strong>：飞行控制，用键盘和鼠标控制相机的移动和转动</li>
<li><strong>OrbitControls</strong>：轨道控制器，模拟轨道卫星旋转平移并用键盘、鼠标控制相机位置</li>
<li><strong>PointerLockControls</strong>：指针锁定，鼠标离开画布依然能被捕捉到鼠标交互而常用于游戏</li>
<li><strong>TrackballControls</strong>：轨迹球控制器，通过键盘和鼠标控制前后左右平移和缩放场景</li>
<li><strong>TransformControls</strong>：变换物体控制器，可以通过鼠标对物体的进行拖放等操作</li>
</ul>
<h1 id="三、Three-js-纹理"><a href="#三、Three-js-纹理" class="headerlink" title="三、Three.js 纹理"></a>三、Three.js 纹理</h1><h2 id="纹理贴图"><a href="#纹理贴图" class="headerlink" title="纹理贴图"></a>纹理贴图</h2><blockquote>
<p>WebGL 提供了简单的纹理贴图功能，如果要实现凹凸、法线、环境等高级贴图功能则需要一定的算法。three.js 对常用的贴图算法进行了封装，可以用来实现各种贴图</p>
</blockquote>
<ul>
<li><strong>纹理</strong><ul>
<li>定义：3D模型的皮肤 (图片)</li>
<li>本质：存储在 内存&#x2F;显存，由像素点组成的图像数据</li>
<li>用法：将纹理数据以一定规则映射到几何体(一般是三角形)</li>
</ul>
</li>
<li><strong>纹理贴图</strong><ul>
<li>定义：一个应用在物体表面用来 反射&#x2F;折射 的图</li>
<li>本质：将存储在内存中的 位图(Bitmap) 映射到物体的表面 </li>
<li>功能：减少了在场景中制作几何体和纹理的计算量，提高了模型渲染性能</li>
</ul>
</li>
</ul>
<h2 id="UV-贴图"><a href="#UV-贴图" class="headerlink" title="UV 贴图"></a>UV 贴图</h2>  <div style="text-indent: 2em">随着 3D 模型的面越来越多，为每个面创建贴图不现实，`UV 贴图则是将 2D 纹理贴图映射到 3D 模型表面最灵活的一种方式`。在这个过程中，三维模型曲面网格的顶点坐标系 (x, y, z) 被展平映射到二维的纹理坐标系 (u, v)，将图像上的每一个点精确对应到模型物体的表面。</div>
  <div align="center">
    <img src="/images/js/texture-map.png" alt="Texture Mapping" width="100%">
  </div>
             
<ul>
<li>UV 映射<ul>
<li>本质：纹理映射，将纹理坐标映射到顶点坐标</li>
<li>优势：减少 http 请求，减轻了服务器负担</li>
<li>劣势：增加了图片解析时间，可能影响性能，而且合成后不好修改</li>
</ul>
</li>
<li>贴图处理<ul>
<li>简单模型<ul>
<li>处理：硬纸盒(立方体) 沿折痕剪开后放到 桌面( UV 坐标系)</li>
<li>贴图：可以使用一张贴图映射到所有几何体的一个面或所有表面</li>
<li>映射方式<ul>
<li>球体：一个封闭的球体曲面对应一张图片，比如世界地图和地球仪</li>
<li>圆柱：圆柱面和两个底面 分别对应一张图片</li>
<li>立方体：六个平面分别对应六张图片</li>
</ul>
</li>
</ul>
</li>
<li>复杂模型<ul>
<li>处理：分解成多个三维体，份数越多越高清则工作量和难度就越大。</li>
<li>贴图：将大图分割碎片化之后解析，然后使用 canvas 拼接</li>
<li>优势：极大减少了图片加载时间而提高了用户体验</li>
<li>劣势：增加服务器的负担，严重时可能导致崩溃</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="纹理创建"><a href="#纹理创建" class="headerlink" title="纹理创建"></a>纹理创建</h2><ul>
<li>基类：Texture     </li>
<li>加载器<ul>
<li>新版：TextureLoader.load(url)</li>
<li>旧版：ImageUtils.loadTexture(url)</li>
</ul>
</li>
<li>属性设置<ul>
<li>重复：texture.wrapS&#x2F;wrapT   </li>
<li>缩放：texture.magFilter&#x2F;minFilter   </li>
<li>重复次数：texture.repeat.set(20, 20)</li>
</ul>
</li>
<li>扩展方法    <ul>
<li>直接创建：DataTexture<ul>
<li>深度纹理：DepthTexture</li>
<li>视频纹理：VideoTexture</li>
<li>三维纹理：DataTexture3D</li>
<li>立方体纹理：CubeTexture</li>
</ul>
</li>
<li>基于canvas：CanvasTexture</li>
<li>基于压缩数据：CompressedTexture</li>
</ul>
</li>
</ul>
<h2 id="纹理类型"><a href="#纹理类型" class="headerlink" title="纹理类型"></a>纹理类型</h2><h3 id="图片纹理"><a href="#图片纹理" class="headerlink" title="图片纹理"></a>图片纹理</h3><ul>
<li>功能：直接在物体表面应用图片。</li>
<li>实现方式<ol>
<li>创建一个几何体对象 (用于纹理映射)</li>
<li>创建一个纹理对象 (加载一张图片作为纹理贴图)</li>
<li>将纹理对象赋值给材质对象的 map 属性</li>
<li>将 几何体 和 纹理材质 整合到一个物体上</li>
</ol>
</li>
<li>图片不显示<ul>
<li>图片异步加载问题：使用渲染循环、在纹理回调中重绘。</li>
<li>Chrome 同源限制：降低浏览器的安全级别、将外部文件放到本机服务器作为网络文件访问。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用图片纹理</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMesh</span>(<span class="params">shape, imgUrl</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> geometry, material</span><br><span class="line">  <span class="keyword">switch</span>(shape)&#123;</span><br><span class="line">    <span class="comment">// 矩形平面</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;plane&quot;</span>: </span><br><span class="line">      geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">300</span>, <span class="number">200</span>);</span><br><span class="line">      <span class="comment">// 设置纹理坐标，必须逆时针方向</span></span><br><span class="line">      geometry.<span class="property">vertices</span>[<span class="number">0</span>].<span class="property">uv</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      geometry.<span class="property">vertices</span>[<span class="number">1</span>].<span class="property">uv</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">0.5</span>, <span class="number">0</span>);</span><br><span class="line">      geometry.<span class="property">vertices</span>[<span class="number">2</span>].<span class="property">uv</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">      geometry.<span class="property">vertices</span>[<span class="number">3</span>].<span class="property">uv</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">0</span>, <span class="number">0.5</span>);</span><br><span class="line">      <span class="keyword">var</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>( imgUrl );</span><br><span class="line">      material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123; <span class="attr">map</span>: texture &#125;);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 立方体</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;box&quot;</span>: </span><br><span class="line">      geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">300</span>, <span class="number">200</span>, <span class="number">150</span>); </span><br><span class="line">      <span class="keyword">if</span>(imgUrl)&#123;</span><br><span class="line">        <span class="comment">// 六个面相同贴图</span></span><br><span class="line">        <span class="keyword">var</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>( imgUrl );</span><br><span class="line">        material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123; <span class="attr">map</span>: texture &#125;);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 六个面不同贴图</span></span><br><span class="line">        material = []</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &gt; <span class="number">7</span>; i++)&#123;  </span><br><span class="line">          <span class="keyword">var</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;./imgs/&#x27;</span> + i + <span class="string">&#x27;.jpg&#x27;</span>);</span><br><span class="line">          material.<span class="title function_">push</span>( <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123; <span class="attr">map</span>: texture &#125;) );</span><br><span class="line">        &#125; </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material);</span><br><span class="line">  <span class="keyword">return</span> mesh;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 一幅图片多个精灵, 即把一幅外部图片中包含的所有精灵存入一个精灵材质数组</span></span><br><span class="line"><span class="keyword">var</span> spriteMaterials = [];</span><br><span class="line"><span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &gt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> spriteMaterial = material.<span class="title function_">clone</span>();</span><br><span class="line">  <span class="comment">// 每种精灵必须单独加载同一幅外部图片</span></span><br><span class="line">  spriteMaterial.<span class="property">map</span> = loader.<span class="title function_">load</span>(<span class="string">&#x27;./assets/textures/sprite-sheet.png&#x27;</span>);</span><br><span class="line">  <span class="comment">// 水平方向(从左)和垂直方向(从上), 偏移比例, 取值 0~1</span></span><br><span class="line">  spriteMaterial.<span class="property">map</span>.<span class="property">offset</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">0.2</span> * (i % <span class="number">5</span>), <span class="number">0</span>); </span><br><span class="line">  <span class="comment">// 从 offset 处开始向右下截取的比例, 取值 0~1</span></span><br><span class="line">  spriteMaterial.<span class="property">map</span>.<span class="property">repeat</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">1</span> / <span class="number">5</span>, <span class="number">1</span>);</span><br><span class="line">  spriteMaterials.<span class="title function_">push</span>(spriteMaterial);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="凹凸贴图"><a href="#凹凸贴图" class="headerlink" title="凹凸贴图"></a>凹凸贴图</h3><ul>
<li>功能：创建凹凸和皱纹。</li>
<li>实现方式<ol>
<li>使用一张灰度图创建纹理。</li>
<li>将纹理赋给材质的 bumpMap 属性。</li>
<li>调整 bumpScale (深度) 获得凹凸效果。</li>
</ol>
</li>
<li>适用场景<ul>
<li>它只保存了像素和高度而没有坡度的方向性信息，只是在某个方向看着很立体，而且所能达到的厚度和细节程度有限，适用于光线变化不大和物体不转动的场景。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用凹凸纹理贴图创建皱纹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMesh</span>(<span class="params">geom, img, bump</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;./imgs/&#x27;</span>+img);</span><br><span class="line">  <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123; <span class="attr">map</span>: texture &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(bump)&#123;</span><br><span class="line">    <span class="keyword">var</span> bump = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;./imgs/&#x27;</span>+bump);</span><br><span class="line">    material.<span class="property">bumpMap</span> = bump;</span><br><span class="line">    material.<span class="property">bumpScale</span> = <span class="number">0.2</span>;   <span class="comment">// 凹凸的高度，负数表示凹下去的深度。</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geom, material);</span><br><span class="line">  <span class="keyword">return</span> mesh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="法向贴图"><a href="#法向贴图" class="headerlink" title="法向贴图"></a>法向贴图</h3><ul>
<li>功能：创建更加细致的凹凸和皱纹。</li>
<li>优势：只需要使用 很少的顶点和面。</li>
<li>实现方式：创建一张法向图片来保存纹理图片像素点的法向量信息、合并两个图片的信息而形成一个细节丰富的立体纹理图片、通过设置 normalScale 属性指定凹凸的程度。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用法向贴图创建更加细致的凹凸和皱褶</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMesh</span>(<span class="params">geom, img, normal</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;./imgs/&#x27;</span>+img);</span><br><span class="line">  <span class="keyword">var</span> normalTexture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;./imgs/&#x27;</span>+normal);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">map</span>: texture,</span><br><span class="line">        <span class="attr">normalMap</span>: normalTexture,</span><br><span class="line">        <span class="attr">bumpScale</span>:<span class="number">0.2</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geom, material);</span><br><span class="line">  <span class="keyword">return</span> mesh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="光照贴图"><a href="#光照贴图" class="headerlink" title="光照贴图"></a>光照贴图</h3><ul>
<li>功能：创建假阴影。</li>
<li>本质：使用 图片 模拟真实阴影，只对静态场景有效果。</li>
<li>实现：将阴影图片赋值给材质的 lightMap 属性。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用光照贴图创建阴影效果</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMesh</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> groundGeom = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">95</span>, <span class="number">95</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">var</span> lm = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&quot;./lightmap.png&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> wood = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&quot;./floor-wood.jpg&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> groundMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">map</span>: wood,</span><br><span class="line">        <span class="attr">lightMap</span>: lm,</span><br><span class="line">        <span class="attr">color</span>: <span class="number">0x777777</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 为光照贴图明确指定 UV 映射</span></span><br><span class="line">  groundGeom.<span class="property">faceVertexUvs</span>[<span class="number">1</span>] = groundGeom.<span class="property">faceVertexUvs</span>[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="光亮贴图"><a href="#光亮贴图" class="headerlink" title="光亮贴图"></a>光亮贴图</h3><ul>
<li>功能：指定材质某部分的高光效果。</li>
<li>实现：将纹理赋给材质的属性 specularMap、设置高光颜色和强度 specular shininess。</li>
</ul>
<h3 id="环境贴图"><a href="#环境贴图" class="headerlink" title="环境贴图"></a>环境贴图</h3><ul>
<li>功能：创建虚假的反光、高光等效果。</li>
<li>本质：使用一张 全景图片 模拟真实的环境。</li>
<li>实现：将图片渲染成无缝的环境盒子并应用到特定对象。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用环境贴图产生反光效果</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMesh</span>(<span class="params">geom</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> planetTexture = <span class="variable constant_">THREE</span>.<span class="property">ImageUtils</span>.<span class="title function_">loadTexture</span>(<span class="string">&quot;../planets/Earth.png&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> specularTexture = <span class="variable constant_">THREE</span>.<span class="property">ImageUtils</span>.<span class="title function_">loadTexture</span>(<span class="string">&quot;../EarthSpec.png&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> normalTexture = <span class="variable constant_">THREE</span>.<span class="property">ImageUtils</span>.<span class="title function_">loadTexture</span>(<span class="string">&quot;../EarthNormal.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> planetMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>();</span><br><span class="line">  planetMaterial.<span class="property">specularMap</span> = specularTexture;</span><br><span class="line">  planetMaterial.<span class="property">specular</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xff0000</span>);</span><br><span class="line">  planetMaterial.<span class="property">shininess</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  planetMaterial.<span class="property">normalMap</span> = normalTexture;</span><br><span class="line">  <span class="comment">// planetMaterial.map = planetTexture;</span></span><br><span class="line">  <span class="comment">// planetMaterial.shininess = 150;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> mesh = <span class="variable constant_">THREE</span>.<span class="property">SceneUtils</span>.<span class="title function_">createMultiMaterialObject</span>(geom, [planetMaterial]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mesh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义-UV-贴图"><a href="#自定义-UV-贴图" class="headerlink" title="自定义 UV 贴图"></a>自定义 UV 贴图</h3><ul>
<li>画布纹理: 使用 canvas 绘制文字、特殊图形等。 </li>
<li>视频纹理: 使用 Video 创建动态纹理。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用画布作为纹理</span></span><br><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>); </span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas-output&#x27;</span>).<span class="title function_">appendChild</span>(canvas);</span><br><span class="line">$(<span class="string">&#x27;#canvas-output&#x27;</span>).<span class="title function_">literallycanvas</span>(&#123;</span><br><span class="line">    <span class="attr">imageURLPrefix</span>: <span class="string">&#x27;../libs/literally/img&#x27;</span></span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMesh</span>(<span class="params">geom</span>) &#123;</span><br><span class="line">  <span class="comment">//将画布直接传入材质的构造函数即可</span></span><br><span class="line">  <span class="keyword">var</span> canvasMap = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Texture</span>(canvas);</span><br><span class="line">  <span class="keyword">var</span> mat = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>();</span><br><span class="line">  mat.<span class="property">map</span> = canvasMap;</span><br><span class="line">  <span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geom, mat);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mesh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用视频作为纹理</span></span><br><span class="line"><span class="keyword">var</span> video = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;video&#x27;</span>);</span><br><span class="line">texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Texture</span>(video);</span><br><span class="line">texture.<span class="property">minFilter</span> = <span class="variable constant_">THREE</span>.<span class="property">LinearFilter</span>;</span><br><span class="line">texture.<span class="property">magFilter</span> = <span class="variable constant_">THREE</span>.<span class="property">LinearFilter</span>;</span><br><span class="line">texture.<span class="property">format</span> = <span class="variable constant_">THREE</span>.<span class="property">RGBFormat</span>;</span><br><span class="line">texture.<span class="property">generateMipmaps</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;  <span class="comment">// 更新纹理</span></span><br><span class="line">  stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (video.<span class="property">readyState</span> === video.<span class="property">HAVE_ENOUGH_DATA</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (texture) texture.<span class="property">needsUpdate</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (controls.<span class="property">rotate</span>) &#123;</span><br><span class="line">      cube.<span class="property">rotation</span>.<span class="property">x</span> += -<span class="number">0.01</span>;</span><br><span class="line">      cube.<span class="property">rotation</span>.<span class="property">y</span> += -<span class="number">0.01</span>;</span><br><span class="line">      cube.<span class="property">rotation</span>.<span class="property">z</span> += -<span class="number">0.01</span>;</span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">  <span class="title function_">requestAnimationFrame</span>(render);</span><br><span class="line">  webGLRenderer.<span class="title function_">render</span>(scene, camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Sprite 创建文字</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createSpriteText</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 先用画布将文字画出</span></span><br><span class="line">  <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&quot;#ffff00&quot;</span>;</span><br><span class="line">  ctx.<span class="property">font</span> = <span class="string">&quot;Bold 100px Arial&quot;</span>;</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把整个 canvas 作为纹理，字尽量大一些来撑满画布，但不要溢出</span></span><br><span class="line">  ctx.<span class="title function_">fillText</span>(<span class="string">&quot;ABCDRE&quot;</span>,<span class="number">4</span>,<span class="number">104</span>);</span><br><span class="line">  <span class="keyword">let</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Texture</span>(canvas);</span><br><span class="line">  texture.<span class="property">needsUpdate</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//使用 Sprite 显示文字</span></span><br><span class="line">  <span class="keyword">let</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpriteMaterial</span>(&#123;<span class="attr">map</span>:texture&#125;);</span><br><span class="line">  <span class="keyword">let</span> textObj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Sprite</span>(material);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 精灵很小，要放大</span></span><br><span class="line">  textObj.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.5</span> * <span class="number">100</span>, <span class="number">0.25</span> * <span class="number">100</span>, <span class="number">0.75</span> * <span class="number">100</span>);</span><br><span class="line">  textObj.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">98</span>);</span><br><span class="line">  <span class="keyword">return</span> textObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Sprite 创建一个圆</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createSpriteShape</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1、创建画布，不设置宽高则使用默认的，可能导致图像变形</span></span><br><span class="line">  <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">  canvas.<span class="property">width</span> = <span class="number">120</span>;</span><br><span class="line">  canvas.<span class="property">height</span> = <span class="number">120</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2、创建图形 </span></span><br><span class="line">  <span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&quot;#ff0000&quot;</span>;</span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">50</span>,<span class="number">50</span>,<span class="number">50</span>,<span class="number">0</span>,<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">  ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3、将 canvas 作为纹理，创建 Sprite</span></span><br><span class="line">  <span class="keyword">let</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Texture</span>(canvas);</span><br><span class="line">  texture.<span class="property">needsUpdate</span> = <span class="literal">true</span>;  <span class="comment">// 注意这句不能少</span></span><br><span class="line">  <span class="keyword">let</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpriteMaterial</span>(&#123;<span class="attr">map</span>:texture&#125;);</span><br><span class="line">  <span class="keyword">let</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Sprite</span>(material);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4、放大图片，精灵默认很小</span></span><br><span class="line">  mesh.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> mesh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>








]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>Web 图片、视频、图表</title>
    <url>/2019/03/02/2-4-web%E5%9B%BE%E5%83%8F/</url>
    <content><![CDATA[<h1 id="一、Web-图片"><a href="#一、Web-图片" class="headerlink" title="一、Web 图片"></a>一、Web 图片</h1><h2 id="图片获取"><a href="#图片获取" class="headerlink" title="图片获取"></a>图片获取</h2><blockquote>
<p>本地图片信息获取的两种方式：H5 input 选择图片、native jsBridge 扫描或导入扫描身份证、银行卡等。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> H5 图片预览上传</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> changeImg        图片选中：获取 file 对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> fileReader       图片读取：file 转 base64</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> compress         图片压缩：缩放比例、图片质量等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> dataURLtoFile    格式转换：base64 转 file</span></span><br><span class="line"><span class="comment"> * &lt;input type=&quot;file&quot; accept=&quot;image/*&quot; capture=&quot;camera&quot; <span class="doctag">@change</span>=&quot;changeImg&quot; /&gt;</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">changeImg</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> file = e.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 图片预览</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">base64Img</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">fileReader</span>(file);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">uploadFile</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 截取 data:image/png;base64 后面的纯字符串、file 对象</span></span><br><span class="line">    <span class="keyword">let</span> baseImg = <span class="variable language_">this</span>.<span class="property">base64Img</span>.<span class="title function_">substring</span>(<span class="variable language_">this</span>.<span class="property">base64Img</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;,&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">let</span> file = <span class="variable language_">this</span>.<span class="title function_">dataURLtoFile</span>(baseImg)</span><br><span class="line">    <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    formData.<span class="title function_">append</span>(<span class="string">&quot;image&quot;</span>, file);</span><br><span class="line">    <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/unload&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: formData,</span><br><span class="line">        <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&quot;multipart/form-data&quot;</span> &#125;,</span><br><span class="line">        <span class="attr">responseType</span>: <span class="string">&quot;json&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">fileReader</span>(<span class="params">file, maxSize</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">    reader.<span class="title function_">readAsDataURL</span>(file);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span></span><br><span class="line">        (reader.<span class="property">onloadend</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(reader.<span class="property">result</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">compress</span>(<span class="params">baseUrl, file, maxSize = <span class="number">1</span>, scale = <span class="number">1</span>, quality = <span class="number">0.9</span></span>) &#123;</span><br><span class="line">    <span class="comment">// file.size 获取字节数：1MB = 1024KB，1KB = 1024字节</span></span><br><span class="line">    <span class="keyword">if</span> (file.<span class="property">size</span> &lt; maxSize * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> baseUrl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">src</span> = baseUrl;</span><br><span class="line">    img.<span class="title function_">setAttribute</span>(<span class="string">&quot;crossOrigin&quot;</span>, <span class="string">&quot;Anonymous&quot;</span>); <span class="comment">// url 为外域时需要</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> </span><br><span class="line">        (img.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>),</span><br><span class="line">            ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>),</span><br><span class="line">            w = img.<span class="property">width</span> * scale,</span><br><span class="line">            h = img.<span class="property">height</span> * scale;</span><br><span class="line">          canvas.<span class="property">width</span> = w;</span><br><span class="line">          canvas.<span class="property">height</span> = h;</span><br><span class="line">          ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">          <span class="keyword">let</span> baseImg = canvas.<span class="title function_">toDataURL</span>(<span class="string">&quot;image/png&quot;</span>, quality)</span><br><span class="line">          <span class="title function_">resolve</span>(baseImg);</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">dataURLtoFile</span>(<span class="params">dataurl, filename</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = dataurl.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>), mime = arr[<span class="number">0</span>].<span class="title function_">match</span>(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>],</span><br><span class="line">        bstr = <span class="title function_">atob</span>(arr[<span class="number">1</span>]), n = bstr.<span class="property">length</span>, u8arr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(n);</span><br><span class="line">    <span class="keyword">while</span>(n--)&#123;</span><br><span class="line">        u8arr[n] = bstr.<span class="title function_">charCodeAt</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">File</span>([u8arr], filename, &#123;<span class="attr">type</span>: mime&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span> Native 扫描方式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> idCardScan     呼叫身份证扫描</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method</span> getBank        导入银行卡</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">idCardScan</span> = <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="title function_">clearTimer</span>()</span><br><span class="line">    <span class="keyword">const</span> idcard = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            options = options ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(options) : <span class="literal">undefined</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">HQAppJSInterface</span>.<span class="title function_">requestScanCertificateCard</span>(options)</span><br><span class="line">            <span class="variable language_">window</span>.**tid = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">status</span>) &#123;</span><br><span class="line">                    <span class="title function_">clearTimer</span>()</span><br><span class="line">                    <span class="title function_">resolve</span>(<span class="title class_">SetCustomerRules</span>(<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">value</span>))</span><br><span class="line">                    <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">                    <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">idCard</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="comment">// reject(&#x27;fail&#x27;)</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">30</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="title function_">checkload</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">idcard</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">getBank</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">clearTimer</span>()</span><br><span class="line">  <span class="keyword">let</span> bank = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">HQAppJSInterface</span>.<span class="title function_">requestScanBankCard</span>()</span><br><span class="line">          <span class="variable language_">window</span>.**tid = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">status</span>) &#123;</span><br><span class="line">                  <span class="title function_">clearTimer</span>()</span><br><span class="line">                  <span class="title function_">resolve</span>(<span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">value</span>)</span><br><span class="line">                  <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">                  <span class="variable language_">window</span>.<span class="property">jsBridge</span>.<span class="property">status</span>.<span class="property">bank</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="title function_">reject</span>(<span class="string">&#x27;fail&#x27;</span>)</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;, <span class="number">30</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="title function_">checkload</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">bank</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件中触发方法</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">idCardScan</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$emit(<span class="string">&#x27;scan&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res))</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">idCardScan</span>(&#123; <span class="attr">skipOCR</span>: <span class="string">&#x27;Y&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>


<h2 id="OCR-识别"><a href="#OCR-识别" class="headerlink" title="OCR 识别"></a>OCR 识别</h2><blockquote>
<p>指将图片上的文字位置和内容智能识别为文字信息并返回，目前支持的场景有：<code>身份证识别、银行卡识别、名片识别、营业执照识别、行驶证驾驶证识别、车牌号识别、通用印刷体识别、手写体识别</code>。</p>
</blockquote>
  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// infoScan.vue：扫描识别组件，前端将图片信息传给后台对接 ocr 识别平台返回结果即可。</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span> <span class="attr">scan</span> @<span class="attr">click</span>=<span class="string">&quot;nativeScan&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-if</span>=<span class="string">&quot;h5&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;h5Scan&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Icon</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;HqScan&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">h5</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    nativeScan () &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">h5</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="title function_">getBank</span>()</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="title function_">report</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(res))</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 读取并压缩，然后上传并识别图片</span></span></span><br><span class="line"><span class="language-javascript">    h5Scan ($event) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> file = $event.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> file = e.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">fileReader</span>(file)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">image</span> =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="title function_">compress</span>(file, img)))</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">img</span> =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="variable language_">this</span>.<span class="title function_">recognition</span>(img), <span class="variable language_">this</span>.<span class="title function_">upload</span>(img)]))</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="variable language_">this</span>.<span class="property">merge</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="variable language_">this</span>.<span class="property">report</span>, toast)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    upload (file) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="title function_">fetch</span>(<span class="variable constant_">API</span>.<span class="property">UPLOAD</span>, &#123; file &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; url: [url] &#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(url)</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="variable language_">this</span>.<span class="property">reject</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    recognition (image) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// OCR 识别：将图片信息发给后端即可</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">post</span>(<span class="variable constant_">API</span>.<span class="property">OCR</span>.<span class="property">BANK</span>, &#123; image &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> code = data[<span class="string">&#x27;rsp_code&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (code === <span class="string">&#x27;0000&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(data)</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code === <span class="string">&#x27;1111&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(data[<span class="string">&#x27;error_msg&#x27;</span>])</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;银行卡识别失败&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    merge ([info, cardImgUrl]) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">toast</span>(<span class="string">&#x27;扫描成功&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123; ...info, cardImgUrl &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    reject (data) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(data)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    report (data) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;scan&#x27;</span>, data)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.wrap</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        -webkit-appearance: button;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="人脸识别"><a href="#人脸识别" class="headerlink" title="人脸识别"></a>人脸识别</h2><blockquote>
<p>主要有两大步骤：<code>1、人脸检测：找出人脸位置，用于美颜、换肤、抠图、换脸。2、人脸识别：识别用户，用于会员、支付</code>。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 身份证等资料上传接口：获取 uniqueUserId</span></span><br><span class="line">    <span class="title function_">fileUpload</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/insure/ocrIdentityVerify&quot;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: params,</span><br><span class="line">            <span class="attr">headers</span>: &#123; <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;multipart/form-data&quot;</span> &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">faceRecognition</span>(res.<span class="property">data</span>.<span class="property">uniqueUserId</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 人脸识别接口：获取人脸识别的跳转地址，并拼接上当前地址用于识别成功后返回原页面</span></span><br><span class="line">    <span class="title function_">faceRecognition</span>(<span class="params">uniqueUserId</span>)&#123;</span><br><span class="line">        <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/insure/biometricsSigForInsure&quot;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123; uniqueUserId &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span> &amp;&amp; res.<span class="property">success</span>) &#123;</span><br><span class="line">                <span class="comment">// 存储 uniqueTbUserId</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">saveUniqueUserId</span>(uniqueUserId);</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = res.<span class="property">data</span> + </span><br><span class="line">                <span class="built_in">encodeURIComponent</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * 查询人脸识别的结果，未通过人脸识别或者出错跳转订单详情</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> ticket 人脸识别返回</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> uniqueUserId   OCR识别返回</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">faceRecognitionResult</span>(<span class="params">ticket, uniqueUserId</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> resData = <span class="keyword">await</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/insure/biometricsResultForInsure&quot;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">ticket</span>: ticket,</span><br><span class="line">                <span class="attr">uniqueUserId</span>: uniqueUserId</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ticket &#125; = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">UniqueUserParms</span> = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;UniqueUserParms&quot;</span>)</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">UniqueUserParms</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">UniqueUserParms</span>) || &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span>(ticket &amp;&amp; <span class="title class_">UniqueUserParms</span>.<span class="property">uniqueTbUserId</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">faceRecognitionResult</span>(ticket, <span class="title class_">UniqueUserParms</span>.<span class="property">uniqueTbUserId</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="二、Video-视频"><a href="#二、Video-视频" class="headerlink" title="二、Video 视频"></a>二、Video 视频</h1><blockquote>
<p>自定义封装视频控件的样式和功能。</p>
</blockquote>
<h2 id="组件封装"><a href="#组件封装" class="headerlink" title="组件封装"></a>组件封装</h2>  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;video-controls&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;playControl&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">      &#x27;play-control&#x27;:true, </span></span></span><br><span class="line"><span class="string"><span class="tag">      playing:paused, </span></span></span><br><span class="line"><span class="string"><span class="tag">      paused: !paused&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;current&quot;</span> <span class="attr">class</span>=<span class="string">&quot;current-time&quot;</span>&gt;</span>&#123;&#123;currentTime&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;progress&quot;</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleJumpProgress&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">ref</span>=<span class="string">&quot;slider&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;width: progress*100 + &#x27;%&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;duration-time&quot;</span>&gt;</span>&#123;&#123;totalTime&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Draggable</span> <span class="keyword">from</span> <span class="string">&quot;./draggable&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;video-controls&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: [<span class="string">&quot;video&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">paused</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">currentTime</span>: <span class="string">&quot;00:00&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">totalTime</span>: <span class="string">&quot;00:00&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">progress</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    handleJumpProgress,</span></span><br><span class="line"><span class="language-javascript">    handleDragProgress,</span></span><br><span class="line"><span class="language-javascript">    handleDurationChange,</span></span><br><span class="line"><span class="language-javascript">    handleTimeUpdate,</span></span><br><span class="line"><span class="language-javascript">    handleClickPlayControl</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">draggable</span> = <span class="title class_">Draggable</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">progress</span>, <span class="variable language_">this</span>.<span class="property">handleDragProgress</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">video</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;durationchange&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleDurationChange</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">video</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;timeupdate&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleTimeUpdate</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">video</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;play&quot;</span>, <span class="function"><span class="params">e</span> =&gt;</span> (<span class="variable language_">this</span>.<span class="property">paused</span> = <span class="literal">false</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">video</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;pause&quot;</span>, <span class="function"><span class="params">e</span> =&gt;</span> (<span class="variable language_">this</span>.<span class="property">paused</span> = <span class="literal">true</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">playControl</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleClickPlayControl</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">destroyed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">draggable</span>.<span class="title function_">destroy</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">handleClickPlayControl</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">paused</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">video</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">video</span>.<span class="title function_">pause</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">handleTimeUpdate</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">currentTime</span> = <span class="title function_">formatTime</span>(e.<span class="property">target</span>.<span class="property">currentTime</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">progress</span> = e.<span class="property">target</span>.<span class="property">currentTime</span> / e.<span class="property">target</span>.<span class="property">duration</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">paused</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">handleDurationChange</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">totalTime</span> = <span class="title function_">formatTime</span>(e.<span class="property">target</span>.<span class="property">duration</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">handleDragProgress</span>(<span class="params">delt</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> &#123; progress, slider &#125; = <span class="variable language_">this</span>.<span class="property">$refs</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> w = slider.<span class="property">offsetWidth</span> + delt;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span> (w &gt; progress.<span class="property">offsetWidth</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    w = progress.<span class="property">offsetWidth</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (w &lt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    w = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">progress</span> = w / progress.<span class="property">offsetWidth</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">video</span>.<span class="property">currentTime</span> = <span class="variable language_">this</span>.<span class="property">progress</span> * <span class="variable language_">this</span>.<span class="property">video</span>.<span class="property">duration</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">handleJumpProgress</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> target = e.<span class="property">currentTarget</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> rect = target.<span class="title function_">getBoundingClientRect</span>();</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> clickX = e.<span class="property">clientX</span> - rect.<span class="property">left</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">progress</span> = clickX / rect.<span class="property">width</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">video</span>.<span class="property">currentTime</span> = <span class="variable language_">this</span>.<span class="property">progress</span> * <span class="variable language_">this</span>.<span class="property">video</span>.<span class="property">duration</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">formatTime</span>(<span class="params">seconds</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> m = <span class="title class_">Math</span>.<span class="title function_">floor</span>(seconds / <span class="number">60</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> s = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(seconds % <span class="number">60</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> <span class="title function_">formatNumber</span>(m) + <span class="string">&quot;:&quot;</span> + <span class="title function_">formatNumber</span>(s);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">formatNumber</span>(<span class="params">num</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> num &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + num : num;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.video-controls</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">left</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">right</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">line-height</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.play-control</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-top</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.playing</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-top</span>: <span class="number">8px</span> solid transparent;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-left</span>: <span class="number">12px</span> solid <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-bottom</span>: <span class="number">8px</span> solid transparent;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">vertical-align</span>: top;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.paused</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-left</span>: <span class="number">2px</span> solid <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-right</span>: <span class="number">2px</span> solid <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.progress</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    &amp;<span class="selector-pseudo">::before</span>,</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">i</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">2px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-top</span>: -<span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#818a95</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">i</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>: <span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">i</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: -<span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: -<span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.current-time</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: left;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.duration-time</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// draggable.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Draggable</span>(<span class="params">el, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> startX = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> isTouchStart = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  el.<span class="title function_">addEventListener</span>(<span class="string">&quot;touchstart&quot;</span>, handleDown);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;touchmove&quot;</span>, handleMove);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchend&#x27;</span>, handleUp);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleDown</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    isTouchStart = <span class="literal">true</span>;</span><br><span class="line">    startX = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">pageX</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleMove</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isTouchStart) &#123;</span><br><span class="line">      <span class="keyword">let</span> deltX = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">pageX</span> - startX;</span><br><span class="line">      startX = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">pageX</span>;</span><br><span class="line">      <span class="title function_">callback</span>(deltX);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleUp</span>(<span class="params"></span>) &#123;</span><br><span class="line">    isTouchStart = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    el.<span class="title function_">removeEventListener</span>(<span class="string">&quot;touchstart&quot;</span>, handleDown);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;touchmove&quot;</span>, handleMove);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;touchup&#x27;</span>, handleUp);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123; destroy &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="组件使用"><a href="#组件使用" class="headerlink" title="组件使用"></a>组件使用</h2>  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;video-player&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">&quot;video&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">autoplay</span></span></span><br><span class="line"><span class="tag">      <span class="attr">preload</span></span></span><br><span class="line"><span class="tag">      <span class="attr">disablePictureInPicture</span></span></span><br><span class="line"><span class="tag">      <span class="attr">controlslist</span>=<span class="string">&quot;nodownload nofullscreen&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">playsinline</span></span></span><br><span class="line"><span class="tag">      <span class="attr">webkit-playsinline</span></span></span><br><span class="line"><span class="tag">      <span class="attr">x5-video-player-type</span>=<span class="string">&quot;h5&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">play</span>=<span class="string">&quot;isPaused = false&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">pause</span>=<span class="string">&quot;isPaused = true&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">contextmenu</span>=<span class="string">&quot;handleContext&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">fullscreenchange</span>=<span class="string">&quot;handleFullScreenChange&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">&quot;60&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;images/icon-play.png&quot;</span> </span></span><br><span class="line"><span class="tag">      @<span class="attr">click</span>=<span class="string">&quot;playVideo&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;&#123;&#x27;shown&#x27;: isPaused&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video-control</span> <span class="attr">v-if</span>=<span class="string">&quot;video&quot;</span> <span class="attr">:video</span>=<span class="string">&quot;video&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">VideoControl</span> <span class="keyword">from</span> <span class="string">&quot;@/components/Controls.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;video-player&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123; <span class="title class_">VideoControl</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">video</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">isPaused</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">curIndex</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">videoList</span>: []</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">playVideo</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> video = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">video</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (video.<span class="property">paused</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        video.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        video.<span class="title function_">pause</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleContext</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    onTap,</span></span><br><span class="line"><span class="language-javascript">    handleFullScreenChange,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">getVideoUrl</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">onTap</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">video</span>, <span class="variable language_">this</span>.<span class="property">playVideo</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">video</span> = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">video</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">video</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;ended&quot;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">curIndex</span> &lt; <span class="variable language_">this</span>.<span class="property">videoList</span>.<span class="property">length</span> - <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">curIndex</span>++;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">video</span>.<span class="property">src</span> = res.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">video</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">onTap</span>(<span class="params">el, callback</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> touchStarted = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">  el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchstart&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    touchStarted = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      touchStarted = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">500</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    touchStarted = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchend&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (touchStarted) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">callback</span>(e)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.video-player</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">video</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#243c70</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">object-fit</span>: fill;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    &amp;<span class="selector-class">.shown</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">opacity</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h1 id="三、Agora-声网"><a href="#三、Agora-声网" class="headerlink" title="三、Agora 声网"></a>三、Agora 声网</h1><blockquote>
<p>一个专注移动端的高清实时通话云服务解决方案，运用场景有：<code>语音通话（一对一、多对多）、视频通话（一对一、多对多）、互动直播（语音、视频）、互动游戏（游戏内置实时语音、视频通话）、录制（服务端录制）、信令（呼叫、消息传递、状态同步等）</code>。</p>
</blockquote>
<h2 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h2><blockquote>
<p>WebRTC 是一个开源项目，旨在使得浏览器能为实时通信 RTC 提供简单的 JS 接口，即让浏览器提供 JS 的即时通信接口。为了简洁快速的进行开发，我们需要基于 WebRTC 进行优化集中的 anyRTC，anyRTC 是为开发者提供实时音视频 API，只需集成 anyRTC SDK 即可调用不同 API 在应用内构建多种实时互动场景。</p>
</blockquote>
<ul>
<li><strong>引用 anyRTC</strong><ul>
<li>npm 导入：<code>npm i ar-rtm-sdk -S、import ArRTM from &quot;ar-rtm-sdk&quot;</code></li>
<li>script 导入：<code>&lt;script src=&quot;https://ardw.anyrtc.io/sdk/web/ArRTM@latest.js&quot;&gt;&lt;/script&gt;</code></li>
</ul>
</li>
<li><strong>RTM 实时消息 api</strong><ul>
<li>创建 RTM 实时消息引擎：createInstance</li>
<li>登录：login</li>
<li>退出登录： logout</li>
<li>事件监听：on</li>
<li>主叫：createLocallnuvitation</li>
<li>发送呼叫邀请：send</li>
<li>取消呼叫邀请：cancel</li>
<li>接受呼叫邀请：accept</li>
<li>拒绝呼叫邀请：refuse</li>
</ul>
</li>
<li><strong>RTC 实时音视频 api</strong><ul>
<li>创建 RTC 音视频引擎：createClient</li>
<li>创建本地音频视频：createMicrophoneAndCameraTracks</li>
<li>加入频道：join</li>
<li>离开频道：leave</li>
<li>开启本地视频发送：publish</li>
<li>关闭本地视频发送：unpublish</li>
<li>订阅拉流：subscribe</li>
<li>取消订阅：unsubscribe</li>
<li>静音&#x2F;取消静音：setEnabled</li>
</ul>
</li>
</ul>
<h2 id="RTM-相关"><a href="#RTM-相关" class="headerlink" title="RTM 相关"></a>RTM 相关</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> rtmClient = <span class="title class_">ArRTM</span>.<span class="title function_">createInstance</span>(<span class="title class_">App</span> <span class="variable constant_">ID</span> );</span><br><span class="line">rtmClient.<span class="title function_">login</span>(&#123;<span class="attr">uid</span>: 用户id&#125;)； <span class="comment">// 用户 id 唯一，登录成功后才可以使用 RTM</span></span><br><span class="line"><span class="comment">// rtmClient.logout();          //  退出登录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ======================= 被邀请用户(接受者) ========================</span></span><br><span class="line"><span class="comment">// 收到主叫邀请用户</span></span><br><span class="line">rtmClient.<span class="title function_">on</span>(<span class="string">&quot;RemoteInvitationReceived&quot;</span>, <span class="keyword">function</span> (<span class="params">remoteInvitation</span>) &#123;</span><br><span class="line">  <span class="comment">// 返回给被叫：接受呼叫邀请成功。</span></span><br><span class="line">  remoteInvitation.<span class="title function_">on</span>(<span class="string">&quot;RemoteInvitationAccepted&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">      <span class="comment">// 获取传过来的频道房间</span></span><br><span class="line">      <span class="keyword">var</span> invitationResponse = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(response);</span><br><span class="line">      <span class="comment">// 加入实时通讯频道</span></span><br><span class="line">      <span class="keyword">await</span> rtcClient.<span class="title function_">join</span>(<span class="title class_">App</span> <span class="variable constant_">ID</span>, invitationContent.<span class="property">ChanId</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">      <span class="comment">// 采集并发布媒体流</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 返回给被叫：拒绝呼叫邀请成功。</span></span><br><span class="line">  remoteInvitation.<span class="title function_">on</span>(<span class="string">&quot;RemoteInvitationRefused&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;);</span><br><span class="line">  <span class="comment">// 返回给被叫：主叫已取消呼叫邀请。</span></span><br><span class="line">  remoteInvitation.<span class="title function_">on</span>(<span class="string">&quot;RemoteInvitationCanceled&quot;</span>, <span class="keyword">function</span> (<span class="params">content</span>) &#123;&#125;);</span><br><span class="line">  <span class="comment">// 返回给被叫：呼叫邀请进程失败。</span></span><br><span class="line">  remoteInvitation.<span class="title function_">on</span>(<span class="string">&quot;RemoteInvitationFailure&quot;</span>, <span class="keyword">function</span> (<span class="params">reason</span>) &#123;&#125;);</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 接受邀请</span></span><br><span class="line">  remoteInvitation.<span class="title function_">accept</span>();   <span class="comment">//拒绝邀请</span></span><br><span class="line">  <span class="comment">// remoteInvitation.refuse();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ========================= 主叫邀请(发起者) ==========================</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 查询被邀请用户的状态 被邀请用户id calleeId 唯一</span></span><br><span class="line"><span class="keyword">var</span> userOnlineResults = <span class="keyword">await</span> rtmClient.<span class="title function_">queryPeersOnlineStatus</span>([calleeId]);</span><br><span class="line"><span class="keyword">if</span> (!userOnlineResults[calleeId] || !userOnlineResults[calleeId]) &#123;</span><br><span class="line">  <span class="comment">// 不允许呼叫，因为对方不在线</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建呼叫邀请</span></span><br><span class="line"><span class="keyword">var</span> localInvitation = rtmClient.<span class="title function_">createLocalInvitation</span>(calleeId);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将呼叫邀请的内容 设置为视频通讯时使用的频道id - 进入同一个频道</span></span><br><span class="line">localInvitation.<span class="property">content</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">    <span class="title class_">ChanId</span>: <span class="string">&quot;4562&quot;</span> , <span class="comment">//符合命名规则即可</span></span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送呼叫邀请</span></span><br><span class="line">localInvitation.<span class="title function_">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回给主叫：被叫已收到呼叫邀请。</span></span><br><span class="line">localInvitation.<span class="title function_">on</span>(<span class="string">&quot;LocalInvitationReceivedByPeer&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 对方收到邀请，说明对方已经上线，这个时候应该监听对方的在线状态</span></span><br><span class="line">    <span class="comment">// 如果对方离线 主动取消邀请（防止对方刷新或掉线时无法通知服务端）</span></span><br><span class="line">    rtmClient.<span class="title function_">subscribePeersOnlineStatus</span>([localInvitation.<span class="property">calleeId</span>]);</span><br><span class="line">    rtmClient.<span class="title function_">on</span>(<span class="string">&quot;PeersOnlineStatusChanged&quot;</span>, <span class="function">(<span class="params">userOnlineStatus</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userOnlineStatus[localInvitation.<span class="property">calleeId</span>] === <span class="string">&quot;OFFLINE&quot;</span> &amp;&amp; </span><br><span class="line">        <span class="title class_">Store</span>.<span class="property">iscalling</span>) &#123;</span><br><span class="line">            localInvitation.<span class="title function_">cancel</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 返回给主叫：被叫已接受呼叫邀请。</span></span><br><span class="line">localInvitation.<span class="title function_">on</span>(<span class="string">&quot;LocalInvitationAccepted&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取传过来的频道房间</span></span><br><span class="line">    <span class="keyword">var</span> invitationResponse = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(response);	 <span class="comment">// 加入实时通讯频道</span></span><br><span class="line">    <span class="keyword">await</span> rtcClient.<span class="title function_">join</span>(<span class="title class_">App</span> <span class="variable constant_">ID</span>, invitationContent.<span class="property">ChanId</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">    <span class="comment">// 采集并发布媒体流</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 远端用户拒绝了你的呼叫邀请</span></span><br><span class="line">localInvitation.<span class="title function_">on</span>(<span class="string">&quot;LocalInvitationRefused&quot;</span>, <span class="keyword">function</span> (<span class="params">response</span>) &#123;&#125;);</span><br><span class="line"><span class="comment">// 返回给主叫：呼叫邀请已被成功取消。</span></span><br><span class="line">localInvitation.<span class="title function_">on</span>(<span class="string">&quot;LocalInvitationCanceled&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;);</span><br><span class="line"><span class="comment">// 返回给主叫：呼叫邀请进程失败。</span></span><br><span class="line">localInvitation.<span class="title function_">on</span>(<span class="string">&quot;LocalInvitationFailure&quot;</span>, <span class="keyword">function</span> (<span class="params">reason</span>) &#123;&#125;);</span><br><span class="line">.......</span><br><span class="line"><span class="comment">// 发起者取消呼叫</span></span><br><span class="line"><span class="comment">// localInvitation.cancel();</span></span><br><span class="line">.......</span><br></pre></td></tr></table></figure>

<h2 id="RTC-相关"><a href="#RTC-相关" class="headerlink" title="RTC 相关"></a>RTC 相关</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建 rtc 实例</span></span><br><span class="line"><span class="keyword">var</span> rtcClient = <span class="title class_">ArRTC</span>.<span class="title function_">createClient</span>(&#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;vp8&quot;</span>,      <span class="comment">// 编码格式</span></span><br><span class="line">    <span class="attr">codec</span>: rtc        <span class="comment">// 使用场景</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采集视频、音频 并进行预览、发布</span></span><br><span class="line">......</span><br><span class="line"><span class="comment">// 采集视频、音频设备</span></span><br><span class="line"><span class="keyword">var</span> [cameras, microhones] = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">      <span class="title class_">ArRTC</span>.<span class="title function_">getCameras</span>(),</span><br><span class="line">      <span class="title class_">ArRTC</span>.<span class="title function_">getMicrophones</span>(),</span><br><span class="line">    ]);</span><br><span class="line"><span class="keyword">if</span> (cameras.<span class="property">length</span> === <span class="number">0</span> &amp;&amp; microhones.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;上麦失败！确实麦克风和摄像头&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (cameras.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; microhones.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; </span><br><span class="line">    <span class="comment">// 创建音频、视频轨道</span></span><br><span class="line">    [audioTrack, videoTrack] = <span class="keyword">await</span> <span class="title class_">ArRTC</span>.<span class="title function_">createMicrophoneAndCameraTracks</span>(<span class="literal">null</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">encoderConfig</span>: &#123; </span><br><span class="line">            <span class="attr">bitrateMax</span>: <span class="number">1130</span>, </span><br><span class="line">            <span class="attr">frameRate</span>: <span class="number">15</span>, </span><br><span class="line">            <span class="attr">height</span>: <span class="number">180</span>, </span><br><span class="line">            <span class="attr">width</span>: <span class="number">320</span> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!videoTrack &amp;&amp; !audioTrack) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;没有设备无法发布媒体流&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 预览本地图像 documentId 存放容器的id（html中的属性id)</span></span><br><span class="line">videoTrack &amp;&amp; videoTrack.<span class="title function_">play</span>(documentId);</span><br><span class="line"><span class="comment">// 把用户设置为主播角色</span></span><br><span class="line">rtcClient.<span class="title function_">setClientRole</span>(<span class="string">&quot;host&quot;</span>);</span><br><span class="line"><span class="comment">// 发布</span></span><br><span class="line">rtcClient.<span class="title function_">publish</span>([videoTrack, audioTrack])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听相关回调</span></span><br><span class="line"><span class="comment">// 通知远端用户发布了新的音频或者视频</span></span><br><span class="line">rtcClient.<span class="title function_">on</span>(<span class="string">&quot;user-published&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">user, mediaType</span>) &#123;</span><br><span class="line">    <span class="comment">// 订阅发布的音频或者视频</span></span><br><span class="line">    <span class="keyword">await</span> rtcClient.<span class="title function_">subscribe</span>(user, mediaType);	</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 通知远端用户取消发布了音频或视频</span></span><br><span class="line">rtcClient.<span class="title function_">on</span>(<span class="string">&quot;user-unpublished&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">user, mediaType</span>) &#123;&#125;);</span><br><span class="line"><span class="comment">// 远端用户加入频道</span></span><br><span class="line">rtcClient.<span class="title function_">on</span>(<span class="string">&quot;user-joined&quot;</span>, <span class="keyword">function</span> (<span class="params">user</span>) &#123;&#125;);</span><br><span class="line"><span class="comment">// 远端用户离线</span></span><br><span class="line">rtcClient.<span class="title function_">on</span>(<span class="string">&quot;user-left&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 释放资源				</span></span><br><span class="line">  videoTrack &amp;&amp; (videoTrack.<span class="title function_">close</span>(), videoTrack = <span class="literal">null</span>);</span><br><span class="line">  audioTrack &amp;&amp; (audioTrack.<span class="title function_">close</span>(), audioTrack = <span class="literal">null</span>);</span><br><span class="line">  rtcClient.<span class="title function_">leave</span>();  <span class="comment">// 离开</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// SDK 与服务器的连接状态发生改变回调</span></span><br><span class="line">rtcClient.<span class="title function_">on</span>(<span class="string">&quot;connection-state-change&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">ConnectionState</span>) &#123;&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 视频开关</span></span><br><span class="line">videoTrack.<span class="property">isMuted</span> = !videoTrack.<span class="property">isMuted</span>;</span><br><span class="line">videoTrack.<span class="title function_">setEnabled</span>(!videoTrack.<span class="property">isMuted</span>);</span><br><span class="line"><span class="comment">// 音频开关</span></span><br><span class="line">audioTrack.<span class="property">isMuted</span> = !audioTrack.<span class="property">isMuted</span>;</span><br><span class="line">audioTrack.<span class="title function_">setEnabled</span>(!audioTrack.<span class="property">isMuted</span>);</span><br></pre></td></tr></table></figure>


<h2 id="web-集成"><a href="#web-集成" class="headerlink" title="web 集成"></a>web 集成</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> rtc.js：创建本地的音视频流并监听远端的音视频流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> AgoraRTC：软件包安装命令为 npm i agora-rtc-sdk -S</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> UID：同一个频道不能重复，PC 使用当年*2+随机数，小程序使用当年+随机数</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AgoraRTC</span> <span class="keyword">from</span> <span class="string">&#x27;agora-rtc-sdk&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> appId = <span class="string">&#x27;cf95ca211f164383b833f2e9bcdae701&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> videoContainerId = <span class="string">&#x27;control_panel_remote_video&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> localVideoContainerId = <span class="string">&#x27;control_panel_local_video&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createRtcClient</span>(<span class="params">&#123;channel, UID, token&#125;, onAfterJoin</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> client = <span class="title class_">AgoraRTC</span>.<span class="title function_">createClient</span>(&#123; </span><br><span class="line">      <span class="comment">// live：直播模式，用户分为主播和观众。rtc：通信模式，任何用户自由说话</span></span><br><span class="line">      <span class="attr">mode</span>: <span class="string">&#x27;live&#x27;</span>, </span><br><span class="line">      <span class="comment">// 编解码可选 h264、vp8。与小程序链接时则必须使用 h264</span></span><br><span class="line">      <span class="attr">codec</span>: <span class="string">&quot;h264&quot;</span>  </span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> localStream;</span><br><span class="line">  <span class="keyword">let</span> audioMuted = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">AgoraRTC</span>.<span class="property">Logger</span>.<span class="title function_">setLogLevel</span>(-<span class="number">1</span>);</span><br><span class="line">  <span class="title class_">AgoraRTC</span>.<span class="property">Logger</span>.<span class="title function_">enableLogUpload</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 Client 对象 </span></span><br><span class="line">  client.<span class="title function_">init</span>(appId, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    client.<span class="title function_">join</span>(token, channel, <span class="variable constant_">UID</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建并初始化本地的音视频流</span></span><br><span class="line">      localStream = <span class="title class_">AgoraRTC</span>.<span class="title function_">createStream</span>(&#123; </span><br><span class="line">        <span class="attr">streamID</span>: <span class="variable constant_">UID</span>, </span><br><span class="line">        <span class="attr">audio</span>: <span class="literal">true</span>, </span><br><span class="line">        <span class="attr">video</span>: <span class="literal">true</span>, </span><br><span class="line">        <span class="attr">screen</span>: <span class="literal">false</span> </span><br><span class="line">      &#125;);</span><br><span class="line">      localStream.<span class="title function_">setVideoProfile</span>(<span class="string">&#x27;360p_3&#x27;</span>);</span><br><span class="line">      localStream.<span class="title function_">setAudioProfile</span>(<span class="string">&#x27;speech_standard&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      localStream.<span class="title function_">init</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        client.<span class="title function_">publish</span>(localStream, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Publish local stream error: &quot;</span>, err)</span><br><span class="line">        &#125;);</span><br><span class="line">        localStream.<span class="title function_">play</span>(localVideoContainerId)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听远端的音视频流</span></span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;stream-added&#x27;</span>, <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> stream = evt.<span class="property">stream</span>;</span><br><span class="line">    <span class="keyword">var</span> uid = stream.<span class="title function_">getId</span>();</span><br><span class="line"></span><br><span class="line">    client.<span class="title function_">subscribe</span>(stream);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (onAfterJoin &amp;&amp; !client.<span class="property">clientUID</span>) &#123;</span><br><span class="line">      <span class="comment">// 视频录制：须放到客户进入频道拿到 uid 之后触发</span></span><br><span class="line">      client.<span class="property">clientUID</span> = uid;</span><br><span class="line">      <span class="title function_">onAfterJoin</span>(uid)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;stream-subscribed&#x27;</span>, <span class="keyword">function</span>(<span class="params">evt</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> remoteStream = evt.<span class="property">stream</span>;</span><br><span class="line">    remoteStream.<span class="title function_">play</span>(videoContainerId, &#123; <span class="attr">fit</span>: <span class="string">&#x27;contain&#x27;</span> &#125;, <span class="keyword">function</span> (<span class="params">err</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (err.<span class="property">status</span> !== <span class="string">&quot;aborted&quot;</span>) &#123;</span><br><span class="line">        <span class="title class_">Notification</span>.<span class="title function_">warning</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;远端视频播放失败，点此重试&#x27;</span>,</span><br><span class="line">          <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">            remoteStream.<span class="title function_">resume</span>()</span><br><span class="line">              .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;resume-remote-success, 恢复成功：&#x27;</span> + result)</span><br><span class="line">                notify.<span class="title function_">close</span>();</span><br><span class="line">              &#125;)</span><br><span class="line">              .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;resume-remote-fail, 恢复失败：&#x27;</span> + reason)</span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;stream-removed&#x27;</span>, <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> stream = evt.<span class="property">stream</span>;</span><br><span class="line">    stream.<span class="title function_">stop</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Remote stream is removed &quot;</span> + stream.<span class="title function_">getId</span>());</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用户主动挂断，client.destroy 触发而离开频道，不触发 peer-leave</span></span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&quot;peer-leave&quot;</span>, <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> uid = evt.<span class="property">uid</span>;</span><br><span class="line">    <span class="title function_">writeLog</span>(<span class="string">&quot;remote left user&quot;</span>, uid);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(videoContainerId).<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  client.<span class="property">destroy</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    client.<span class="title function_">leave</span>();</span><br><span class="line">    <span class="keyword">if</span> (localStream) &#123;</span><br><span class="line">      client.<span class="title function_">unpublish</span>(localStream);</span><br><span class="line">      localStream.<span class="title function_">stop</span>();</span><br><span class="line">      localStream.<span class="title function_">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> lcontainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(localVideoContainerId);</span><br><span class="line">    <span class="keyword">if</span> (lcontainer) &#123;</span><br><span class="line">      lcontainer.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    client = <span class="literal">null</span>;</span><br><span class="line">    localStream = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;rtc client destroyed!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  client.<span class="property">toggleAudio</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (audioMuted) &#123;</span><br><span class="line">      <span class="keyword">if</span> (localStream.<span class="title function_">unmuteAudio</span>()) &#123;</span><br><span class="line">        audioMuted = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (localStream.<span class="title function_">muteAudio</span>()) &#123;</span><br><span class="line">        audioMuted = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> audioMuted;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  client.<span class="property">muteVideo</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    localStream.<span class="title function_">muteVideo</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> client;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> store.js</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> roomNo：上线时获取的房间号，下线则清除</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> UID：同一个频道不能重复，PC 使用当年*2+随机数，小程序使用当年+随机数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rtcClientTickTimer：设定通话时间超过30分钟则提示，无操作则自动结束</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">UID</span> = <span class="built_in">parseInt</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>() * <span class="number">2</span> + <span class="string">&#x27;&#x27;</span> + </span><br><span class="line"><span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100000</span>));</span><br><span class="line"><span class="keyword">let</span> currentRtcClient = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> rtcClientTickTimer = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doCreateRtcClient</span>(<span class="params">roomNo, reconnect</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(curRtcClient) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  </span><br><span class="line">    videoService.<span class="title function_">getAgoraToken</span>(&#123; <span class="attr">uid</span>: <span class="variable constant_">UID</span>, roomNo &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">success</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="property">value</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(res)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">token</span> =&gt;</span> &#123;</span><br><span class="line">        curRtcClient = <span class="title function_">createRtcClient</span>(&#123; </span><br><span class="line">            <span class="attr">channel</span>: roomNo, <span class="variable constant_">UID</span>, token </span><br><span class="line">        &#125;,  <span class="function"><span class="params">uid</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (reconnect !== <span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="comment">// 开始视频录制</span></span><br><span class="line">                videoService.<span class="title function_">beginRecord</span>(roomNo, uid).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (res.<span class="property">success</span>) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">                    <span class="title function_">notify</span>(<span class="string">&#x27;启用视频录制失败（不影响报案）&#x27;</span>, <span class="string">&#x27;warning&#x27;</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="title function_">longComunicationConfirm</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">notify</span>(<span class="string">&#x27;建立通话失败&#x27;</span>, <span class="string">&#x27;warning&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">longComunicationConfirm</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hostname</span> !== <span class="string">&#x27;video-claim.zhongan.io&#x27;</span>) &#123;</span><br><span class="line">        rtcClientTickTimer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">showConfirm</span>(<span class="string">&#x27;通话时间过长，为避免通话时间浪费，无操作30s后自动退出！&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">confirmButtonText</span>: <span class="string">&#x27;继续通话&#x27;</span>,</span><br><span class="line">                <span class="attr">cancelButtonText</span>: <span class="string">&#x27;结束通话&#x27;</span>,</span><br><span class="line">                <span class="attr">showClose</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">showCancelButton</span>: <span class="literal">false</span></span><br><span class="line">            &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">clearTimeout</span>(rtcClientTickTimer);</span><br><span class="line">                <span class="comment">// 如果已经主动挂断，则无需再次提示</span></span><br><span class="line">                <span class="keyword">if</span> (rtcClientTickTimer &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="title function_">longComunicationConfirm</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            rtcClientTickTimer = <span class="built_in">setTimeout</span>(destroyRtcClient, <span class="number">30</span> * <span class="number">1000</span>)</span><br><span class="line">        &#125;, <span class="number">30</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">destroyRtcClient</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curRtcClient) &#123;</span><br><span class="line">        curRtcClient.<span class="title function_">destroy</span>();</span><br><span class="line">        curRtcClient = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ping.<span class="title function_">stop</span>();</span><br><span class="line">    logger.<span class="title function_">send</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;destroyRtcClient&#x27;</span> &#125;);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(rtcClientTickTimer);</span><br><span class="line">    rtcClientTickTimer = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="小程序集成"><a href="#小程序集成" class="headerlink" title="小程序集成"></a>小程序集成</h2><blockquote>
<p>开启小程序支持的服务、创建微信小程序组件 <code>&lt;live-pusher&gt;、&lt;live-player&gt;</code>、直接引用 SDK (<code>require(&#39;../lib/Agora.2.4.1.js&#39;)</code>) 并创建音视频流对象 (API 同上)。</p>
</blockquote>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">live-pusher</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">url</span>=<span class="string">&quot;&#123;&#123;pushUrl&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">autopush</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">mode</span>=<span class="string">&quot;RTC&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">enable-camera</span>=<span class="string">&quot;&#123;&#123;enableCamera&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">device-position</span>=<span class="string">&quot;&#123;&#123;devicePosition&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">waiting-image</span>=<span class="string">&quot;/images/connecting.jpg&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">background-mute</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">auto-pause-if-open-native</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">bindstatechange</span>=<span class="string">&quot;handlePusherStateChange&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">bindnetstatus</span>=<span class="string">&quot;handlePusherNetStatusChange&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">binderror</span>=<span class="string">&quot;handlePusherError&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">live-player</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">hidden</span>=<span class="string">&quot;&#123;&#123;!enableCamera&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;playUrl&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">mode</span>=<span class="string">&quot;RTC&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">autoplay</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">sound-mode</span>=<span class="string">&quot;speaker&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">object-fit</span>=<span class="string">&quot;fillCrop&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">auto-pause-if-open-native</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">bindstatechange</span>=<span class="string">&quot;handlePlayerStateChange&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">bindnetstatus</span>=<span class="string">&quot;handlePlayerNetStatusChange&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="四、ECharts"><a href="#四、ECharts" class="headerlink" title="四、ECharts"></a>四、ECharts</h1><blockquote>
<p>一个免费的、功能强大的、可视化的一个库，可以非常简单的往软件产品中添加直观的、动态的和高度可定制化的图表。它是一个全新的基于矢量图形库 zrender 的使用纯 JavaScript 打造完成的 canvas 库。</p>
</blockquote>
<h2 id="引用方式"><a href="#引用方式" class="headerlink" title="引用方式"></a>引用方式</h2><h3 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h3><blockquote>
<p>安装：<code>cnpm install echarts -S</code></p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局引用</span></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$echarts</span> = echarts</span><br><span class="line"><span class="comment">// 组件使用</span></span><br><span class="line">&lt;div ref=<span class="string">&quot;chart&quot;</span> style=<span class="string">&quot;width:500px;height:500px&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">　　initCharts () &#123;</span><br><span class="line">  　　<span class="keyword">let</span> myChart = <span class="variable language_">this</span>.<span class="property">$echarts</span>.<span class="title function_">init</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">chart</span>);</span><br><span class="line">  　　<span class="comment">// 绘制图表</span></span><br><span class="line">  　　myChart.<span class="title function_">setOption</span>(&#123; &#125;)</span><br><span class="line">　　&#125;</span><br><span class="line">　  &#125;,</span><br><span class="line">　  mounted () &#123;</span><br><span class="line">　　  <span class="variable language_">this</span>.<span class="title function_">initCharts</span>();</span><br><span class="line">　  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按需引用：组件中直接使用</span></span><br><span class="line"><span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> echarts = <span class="built_in">require</span>(<span class="string">&#x27;echarts&#x27;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    initCharts () &#123;</span><br><span class="line">      <span class="keyword">let</span> myChart = echarts.<span class="title function_">init</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">chart</span>);</span><br><span class="line">      myChart.<span class="title function_">setOption</span>(&#123; &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;</span><br><span class="line">　　 <span class="variable language_">this</span>.<span class="title function_">initCharts</span>();</span><br><span class="line">　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="react"><a href="#react" class="headerlink" title="react"></a>react</h3><ol>
<li>安装<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install --save echarts-<span class="keyword">for</span>-react</span><br><span class="line">npm install echarts --save  <span class="comment">// 如果有报错找不到 echarts 模块则安装</span></span><br></pre></td></tr></table></figure></li>
<li>引入模块和组件<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局引用</span></span><br><span class="line"><span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span> </span><br><span class="line"><span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts/lib/echarts&#x27;</span></span><br><span class="line">&lt;<span class="title class_">ReactEcharts</span> option=&#123;<span class="variable language_">this</span>.<span class="title function_">getOption</span>()&#125; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按需引用</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Card</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> echartTheme <span class="keyword">from</span> <span class="string">&#x27;./../themeLight&#x27;</span></span><br><span class="line"><span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts/lib/echarts&#x27;</span></span><br><span class="line"><span class="comment">//导入折线图</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;echarts/lib/chart/line&#x27;</span>;  <span class="comment">//折线图是line,饼图改为pie,柱形图改为bar</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;echarts/lib/component/tooltip&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;echarts/lib/component/title&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;echarts/lib/component/legend&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;echarts/lib/component/markPoint&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactEcharts</span> <span class="keyword">from</span> <span class="string">&#x27;echarts-for-react&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Line</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">  <span class="title function_">componentWillMount</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//主题的设置要在willmounted中设置</span></span><br><span class="line">    echarts.<span class="title function_">registerTheme</span>(<span class="string">&#x27;Imooc&#x27;</span>,echartTheme);</span><br><span class="line">  &#125;</span><br><span class="line">  getOption =<span class="function">()=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> option = &#123;</span><br><span class="line">      <span class="attr">title</span>:&#123;</span><br><span class="line">        <span class="attr">text</span>:<span class="string">&#x27;用户骑行订单&#x27;</span>,</span><br><span class="line">        <span class="attr">x</span>:<span class="string">&#x27;center&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">tooltip</span>:&#123;</span><br><span class="line">        <span class="attr">trigger</span>:<span class="string">&#x27;axis&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">xAxis</span>:&#123;</span><br><span class="line">        <span class="attr">data</span>:[<span class="string">&#x27;周一&#x27;</span>,<span class="string">&#x27;周二&#x27;</span>,<span class="string">&#x27;周三&#x27;</span>,<span class="string">&#x27;周四&#x27;</span>,<span class="string">&#x27;周五&#x27;</span>,<span class="string">&#x27;周六&#x27;</span>,<span class="string">&#x27;周日&#x27;</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">yAxis</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&#x27;value&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">series</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>:<span class="string">&#x27;OFO订单量&#x27;</span>,</span><br><span class="line">          <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,   <span class="comment">//这块要定义type类型，柱形图是bar,饼图是pie</span></span><br><span class="line">          <span class="attr">data</span>:[<span class="number">1000</span>,<span class="number">2000</span>,<span class="number">1500</span>,<span class="number">3000</span>,<span class="number">2000</span>,<span class="number">1200</span>,<span class="number">800</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> option</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Card</span> <span class="attr">title</span>=<span class="string">&quot;折线图表之一&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ReactEcharts</span> <span class="attr">option</span>=<span class="string">&#123;this.getOption()&#125;</span> <span class="attr">theme</span>=<span class="string">&quot;Imooc&quot;</span>  <span class="attr">style</span>=<span class="string">&#123;&#123;height:</span>&#x27;<span class="attr">400px</span>&#x27;&#125;&#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>添加 option 参数</li>
</ol>
<h2 id="配置选项"><a href="#配置选项" class="headerlink" title="配置选项"></a>配置选项</h2><blockquote>
<p>图表选项 option 包含了图表实例任何可配置的选项：<code>公共选项、组件选项、数据选项</code></p>
</blockquote>
<ul>
<li><a href="https://www.jianshu.com/p/62b95115f522">https://www.jianshu.com/p/62b95115f522</a></li>
<li><a href="https://my.oschina.net/u/3363053/blog/900173">https://my.oschina.net/u/3363053/blog/900173</a></li>
</ul>
<h2 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initEachart</span>(<span class="params">list</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> callNumList = list || [];</span><br><span class="line">  <span class="keyword">let</span> mainEcharts = echarts.<span class="title function_">init</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">echart</span>);</span><br><span class="line">  mainEcharts.<span class="title function_">setOption</span>(&#123;</span><br><span class="line">    <span class="attr">xAxis</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;category&quot;</span>,</span><br><span class="line">      <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">data</span>: [<span class="string">&quot;0点&quot;</span>, <span class="string">&quot;1点&quot;</span>, <span class="string">&quot;2点&quot;</span>, <span class="string">&quot;3点&quot;</span>, <span class="string">&quot;4点&quot;</span>, <span class="string">&quot;5点&quot;</span>, <span class="string">&quot;6点&quot;</span>, <span class="string">&quot;7点&quot;</span>, <span class="string">&quot;8点&quot;</span>,</span><br><span class="line">            <span class="string">&quot;9点&quot;</span>, <span class="string">&quot;10点&quot;</span>, <span class="string">&quot;11点&quot;</span>, <span class="string">&quot;12点&quot;</span>, <span class="string">&quot;13点&quot;</span>, <span class="string">&quot;14点&quot;</span>, <span class="string">&quot;15点&quot;</span>, <span class="string">&quot;16点&quot;</span>,</span><br><span class="line">            <span class="string">&quot;17点&quot;</span>, <span class="string">&quot;18点&quot;</span>, <span class="string">&quot;19点&quot;</span>, <span class="string">&quot;20点&quot;</span>, <span class="string">&quot;21点&quot;</span>, <span class="string">&quot;22点&quot;</span>, <span class="string">&quot;23点&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">splitLine</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">lineStyle</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;#F8F8F8&quot;</span> &#125; &#125;,</span><br><span class="line">      <span class="attr">axisTick</span>: &#123; <span class="attr">show</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      <span class="attr">axisLine</span>: &#123; <span class="attr">lineStyle</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;#475669&quot;</span> &#125; &#125;,</span><br><span class="line">      <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">          <span class="attr">interval</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">formatter</span>: <span class="keyword">function</span>(<span class="params">value, index</span>) &#123;</span><br><span class="line">              <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="string">&quot;\t\t\t\t\t&quot;</span> + value;</span><br><span class="line">              &#125;   <span class="keyword">else</span> <span class="keyword">if</span> (index == <span class="number">23</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> value + <span class="string">&quot;\t\t\t\t\t&quot;</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="keyword">return</span> value;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">color</span>: [<span class="string">&quot;#3B8EFF&quot;</span>],</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;</span><br><span class="line">      <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;value&quot;</span>,</span><br><span class="line">      <span class="attr">splitLine</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">lineStyle</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;#F8F8F8&quot;</span> &#125;&#125;,</span><br><span class="line">      <span class="attr">axisTick</span>: &#123; <span class="attr">show</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      <span class="attr">axisLine</span>: &#123; <span class="attr">lineStyle</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;#475669&quot;</span> &#125; &#125;,</span><br><span class="line">      <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">          <span class="attr">formatter</span>: <span class="keyword">function</span>(<span class="params">value, index</span>) &#123;</span><br><span class="line">              <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> value + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == <span class="number">3</span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span> + value;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="keyword">return</span> value;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">data</span>: callNumList,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>,</span><br><span class="line">        <span class="attr">smooth</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">areaStyle</span>: &#123; <span class="attr">normal</span>: &#123; <span class="attr">opacity</span>: <span class="string">&quot;0.2&quot;</span> &#125; &#125;,</span><br><span class="line">        <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">          <span class="attr">normal</span>: &#123; <span class="attr">label</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">position</span>: [<span class="number">6</span>, -<span class="number">14</span>] &#125; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">grid</span>: &#123; <span class="attr">left</span>: <span class="string">&quot;40&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;30&quot;</span>, <span class="attr">top</span>: <span class="string">&quot;20&quot;</span>, <span class="attr">bottom</span>: <span class="string">&quot;30&quot;</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>








]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>web 开发工具</title>
    <url>/2019/02/23/2-3-web%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h1 id="一、操作电脑"><a href="#一、操作电脑" class="headerlink" title="一、操作电脑"></a>一、操作电脑</h1><blockquote>
<p>mac 安装包管理工具 Homebrew：<code>/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</code>。</p>
</blockquote>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><ul>
<li><strong>Windows</strong>：人妻，什么都有，还常附带不想要的东西。基于 Basic 开发的微软系统，功能强大但安全堪忧，适用于正常办公以及游戏。</li>
<li><strong>Mac OS&#x2F;OSX</strong>：女友，带着有面子但必须按照它的规则。基于 linux 开发的苹果系统，应用软件较少但较安全，适用于高端移动化处理。</li>
<li><strong>Linux</strong>：小萝莉，你让它干嘛就干嘛。一种自由的、开放源码的类 Unix 操作系统，可安装到手机电脑等各种计算机硬件设备，网络功能强大并且对内存等硬件的消耗小，优点是其易用性和丰富的应用软件，多用于网络服务器。</li>
</ul>
<h2 id="操作接口"><a href="#操作接口" class="headerlink" title="操作接口"></a>操作接口</h2><ul>
<li><strong>终端 terminal</strong>：用于人与计算机进行交互的输入输出接口。本质是通过电缆、网络等连接主机的外部附加设备，一台计算机可以连接个终端。</li>
<li><strong>控制台 console</strong>：用于管理主机的特殊终端，只允许管理员使用。本质是直接和计算机相连接的原生设备，一台计算机一般只能有一个控制台。</li>
<li><strong>命令解释器 shell</strong>：提供用户界面的程序而用于与计算机内核交互。本质是接受用户指令后调用其他程序与内核交互完成指令。一般分为 <strong>命令行shell、图形shell，分别提供 命令行界面 CLI、图形用户界面 GUI</strong>。批处理：将一系列命令按照一定顺序集合为一个可执行的文本文件，在window系统的扩展名为 bat&#x2F;cmd，双击文件即可运行。</li>
<li><strong>终端与 shell 的分工</strong>：终端从用户接受 鼠标键盘等设备的输入信息，然后发送给 shell。shell 从终端获取用户指令，解析后发给计算机内核执行，并返回结果给终端。</li>
</ul>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><blockquote>
<p>从硬件上来说是一台配置比较高的电脑，从软件角度用来处理客户端请求的服务器可分为以下两种：</p>
</blockquote>
<ul>
<li>分类       <ul>
<li><strong>web&#x2F;HTTP 服务器</strong>：比如 Apache、Nginx。专注于处理 HTTP 协议、传递本地磁盘上的静态资源给客户端，常用于提供代理服务。</li>
<li><strong>应用服务器</strong>：比如 WebLogic、Tomcat。提供可以处理业务逻辑的方法，常用来加载动态内容和处理响应数据并返回给客户端，但则只能访问其安装目录中的文件。</li>
</ul>
</li>
<li>代理<ul>
<li><strong>代理服务器</strong>：具有转发功能，扮演了服务器和客户端的中间人角色。接收客户端发送的请求并转发给服务器，同时接收服务器返回的响应并转发给客户端。</li>
<li><strong>正向代理</strong>：隐藏了真实的客户端，客户端请求都被代理服务器代替去请求。比如翻墙的原理就是在国外搭建一台代理服务器，代理去访问国外网址并返回结果给国内客户端。</li>
<li><strong>反向代理</strong>：隐藏了真实的服务端，反向代理服务器会帮客户端把请求转发到真实服务器。常用来做负载均衡，比如访问百度时会有很多服务器接收服务。</li>
<li><strong>应用</strong>：web 项目开发时联合使用 apache + tomcat + nginx。访问静态、动态资源时使用 apache&#x2F;tomcat 解析。nginx 作为反向代理服务器，同时支持高并发。</li>
</ul>
</li>
</ul>
<h1 id="二、开发调试"><a href="#二、开发调试" class="headerlink" title="二、开发调试"></a>二、开发调试</h1><h2 id="浏览器-chrome"><a href="#浏览器-chrome" class="headerlink" title="浏览器 chrome"></a>浏览器 chrome</h2><ul>
<li>搜索匹配：Google 输入框中所有空格都被理解为加号。<ul>
<li>完整匹配：<code>mysql foreign key</code>（引号）</li>
<li>筛选：<code>mysql key * nodejs</code>（加减号）</li>
<li>返回所有：<code>mysql connect error *</code>（加通配符）</li>
<li>站内搜索：<code>mysql foreign key site:stackoverflow.com</code></li>
<li>加速：输入网址后点击 Tab，这样可直接使用该站点的站内搜索</li>
</ul>
</li>
<li>调试 JS<ul>
<li><strong>断点调试</strong>：开发者工具、Sources 菜单、点击文件的行号列、点击文件左下角的 {} 格式化压缩代码、点击右侧 Breakpoints 可查看所有断点、点击右侧 scope 可查看断点数据的信息。</li>
<li><strong>Debug 断点</strong>：异步加载时可能有些 JS 代码在 Sources 中无法找到，这时可在文件中添加 <code>debugger;</code>，注意调试后需要删除该断点语句。</li>
<li><strong>Network 抓包</strong>：抓包指将网络传输发送与接收的数据包进行截获、编辑、重发等操作，调试时常用来获取 HTTP 信息并分析。</li>
</ul>
</li>
<li>扩展插件<ul>
<li><strong>谷歌访问助手</strong>：下载安装包、更多工具、扩展程序、直接拖拽、添加扩展。安装后可通过谷歌网上商店添加扩展插件。</li>
<li><strong>常用插件</strong>：掘金、FeHelper、JSONView、What runs、Clear Cache、Code Plunker、Vue.js devtools、AngularJS Batarang、React Developer Tools。</li>
</ul>
</li>
<li>黑科技<ul>
<li><strong>翻墙</strong>：配置 VPN 虚拟专用网络、配置 proxy 代理地址（setting system、proxy settings、LAN setting、proxy server、配置 Address、Port）、</li>
<li><strong>解析 VIP</strong>：打开网站 <a href="https://greasyfork.org/zh-CN">Greasy Fork</a>、搜索 VIP 视频解析、安装脚本。</li>
<li>其它：视频广告过滤、电脑管家上网防护等。</li>
</ul>
</li>
</ul>
<h2 id="代码编辑-vscode"><a href="#代码编辑-vscode" class="headerlink" title="代码编辑 vscode"></a>代码编辑 vscode</h2><blockquote>
<p>常用的扩展插件和用户配置如下：</p>
</blockquote>
<ul>
<li>显示效果类<ul>
<li><strong>Dracula Official</strong>：高亮主题</li>
<li><strong>vscode-icon</strong>：让资源树目录加上图标</li>
<li><strong>Bracket Pair Colorizer</strong>：每一对括号用不同颜色区别</li>
<li><strong>Open-In-Browser</strong>：直接在浏览器中打开文件的快捷菜单 <code>alt + b</code></li>
</ul>
</li>
<li>辅助编辑类<ul>
<li><strong>HTML Snippets</strong>：html 语法填充</li>
<li><strong>HTML CSS Support</strong>：代码自动补全</li>
<li><strong>CSS Peek</strong>：css 代码追踪跳转</li>
<li><strong>Path Autocomplete</strong>：智能补全路径</li>
<li><strong>Path Intellisense</strong>：智能提示路径</li>
<li><strong>Auto Close Tag</strong>：自动闭合 HTML 标签</li>
<li><strong>Auto Rename Tag</strong>：自动修改匹配的标签</li>
<li><strong>JavaScript code snippets</strong>：JS 语法提示</li>
</ul>
</li>
<li>规范代码类<ul>
<li><strong>ESlint</strong>：检测 js、ts</li>
<li><strong>Stylelint</strong>：检测 css、scss</li>
<li><strong>Prettier</strong>：代码格式化 <code>alt + shift + F</code></li>
<li><strong>EditorConfig for VS Code</strong>：统一跨编辑器编码风格 .editorconfig</li>
<li><strong>Prettier</strong>：统一项目风格而格式化文件 .prettierrc</li>
</ul>
</li>
<li>框架插件类<ul>
<li><strong>Volar</strong>：语法高亮</li>
<li><strong>Vue3 Snippets</strong>：代码提示</li>
<li><strong>TypeScript Vue Plugin</strong>：tsx vue 语法</li>
<li><strong>React Style Helper</strong>：自动补全</li>
<li><strong>Typescript React code snippets</strong>：tsx react 语法</li>
<li><strong>ES7 React&#x2F;Redux&#x2F;React-Native snippets</strong>：语法提示</li>
<li><strong>Angular Snippets</strong>：语法提示</li>
<li><strong>Angular Files</strong>：生成文件模版</li>
<li><strong>Angular Follow Selector</strong>：文件跳转</li>
<li><strong>Angular Language Service</strong>：语法校验</li>
<li><strong>wxml</strong>：小程序代码格式化和高亮显示</li>
<li><strong>minapp</strong>：小程序代码智能补全</li>
<li><strong>wechat-snippet</strong>：代码提示</li>
</ul>
</li>
<li>开发调试类<ul>
<li><strong>npm</strong>：运行 npm 命令</li>
<li><strong>npm Intellisense</strong>：导入时提示已安装模块</li>
<li><strong>Python</strong>：添加对 py 文件的支持</li>
<li><strong>GitLens</strong>：简单实现 git 提交代码</li>
<li><strong>Git History</strong>：查看 git 提交日志</li>
<li><strong>Octotree</strong>：Github 项目代码树形展示</li>
<li><strong>Debugger for chrome</strong>：调试 Debug</li>
<li><strong>Code Runner</strong>：右键一键运行代码片段或文件</li>
<li><strong>REST Client</strong>：HTTP API 本地调试</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、常用快捷键</span></span><br><span class="line">ctrl + p                       <span class="comment">// 文件定位</span></span><br><span class="line">ctrl + <span class="title class_">Option</span> + ↑↓             <span class="comment">// 选中区域</span></span><br><span class="line">option + ↑↓                    <span class="comment">// 移动当前行代码</span></span><br><span class="line">ctrl + ←↑↓→                    <span class="comment">// 移动鼠标到行头/尾      </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、运行调试：.vscode/launch.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;configurations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;pwa-node&quot;</span>,   <span class="comment">// 调试器类型</span></span><br><span class="line">            <span class="string">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,  <span class="comment">// 请求方式：launch(启动)、attach(附加)</span></span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;umif&quot;</span>,       <span class="comment">// 启动配置名称</span></span><br><span class="line">            <span class="string">&quot;program&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/umif/server.js&quot;</span>, <span class="comment">// 入口文件</span></span><br><span class="line">            <span class="string">&quot;cwd&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/umif&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">            <span class="string">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;mes4pc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;program&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/mes4pc/server.js&quot;</span>,</span><br><span class="line">            <span class="string">&quot;cwd&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/mes4pc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;NODE_ENV&quot;</span>:<span class="string">&quot;production&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;node&quot;</span>,               </span><br><span class="line">            <span class="string">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,          </span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Hexo&quot;</span>,               </span><br><span class="line">            <span class="string">&quot;runtimeExecutable&quot;</span>: <span class="string">&quot;npm&quot;</span>,</span><br><span class="line">            <span class="string">&quot;cwd&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span>,  <span class="comment">// 启动目录</span></span><br><span class="line">            <span class="string">&quot;runtimeArgs&quot;</span>: [<span class="string">&quot;run-script&quot;</span>, <span class="string">&quot;debug&quot;</span>],   <span class="comment">// 传给执行工具的参数</span></span><br><span class="line">            <span class="string">&quot;skipFiles&quot;</span>: [<span class="string">&quot;&lt;node_internals&gt;/**/*.js&quot;</span>] <span class="comment">// 跳过 Node 内置模块</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、用户配置：ctrl + shift + p、User Settings</span></span><br><span class="line"><span class="comment">// 解决 vscode 卡顿 (cpu git 占用过高)</span></span><br><span class="line"><span class="string">&quot;search.followSymlinks&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;git.enabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;git.autorefresh&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消右侧预览功能</span></span><br><span class="line"><span class="string">&quot;editor.minimap.enabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">// 窗口失去焦点自动保存   </span></span><br><span class="line"><span class="string">&quot;files.autoSave&quot;</span>: <span class="string">&quot;onFocusChange&quot;</span>,</span><br><span class="line"><span class="comment">// 不再显示扩展建议的通知 </span></span><br><span class="line"><span class="string">&quot;extensions.ignoreRecommendations&quot;</span>: <span class="literal">true</span>,   </span><br><span class="line"><span class="comment">// 不再显示新版本消息   </span></span><br><span class="line"><span class="string">&quot;vsicons.dontShowNewVersionMessage&quot;</span>: <span class="literal">true</span>, </span><br><span class="line"><span class="comment">// 是否将打开的编辑器显示为预览</span></span><br><span class="line"><span class="string">&quot;workbench.editor.enablePreview&quot;</span>: <span class="literal">false</span>,   </span><br><span class="line"><span class="comment">// 字体字号</span></span><br><span class="line"><span class="string">&quot;editor.fontSize&quot;</span>: <span class="number">16</span>,</span><br><span class="line"><span class="comment">// 代码缩进</span></span><br><span class="line"><span class="string">&quot;editor.tabSize&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="comment">// eslint 验证和自动修复</span></span><br><span class="line"><span class="string">&quot;eslint.validate&quot;</span>: [  </span><br><span class="line">  <span class="string">&quot;javascript&quot;</span>,       </span><br><span class="line">  <span class="string">&quot;javascriptreact&quot;</span>,      </span><br><span class="line">  <span class="string">&quot;typescript&quot;</span>, </span><br><span class="line">  <span class="string">&quot;typescriptreact&quot;</span> </span><br><span class="line">  <span class="string">&quot;html&quot;</span>,</span><br><span class="line">  <span class="string">&quot;vue&quot;</span>,      </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;language&quot;</span>: <span class="string">&quot;vue&quot;</span>,           </span><br><span class="line">    <span class="string">&quot;autoFix&quot;</span>: <span class="literal">true</span>       </span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;language&quot;</span>: <span class="string">&quot;html&quot;</span>,           </span><br><span class="line">    <span class="string">&quot;autoFix&quot;</span>: <span class="literal">true</span>       </span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line"><span class="comment">// 代替 vscode 的 ts 语法智能提示</span></span><br><span class="line"><span class="string">&quot;typescript.tsdk&quot;</span>: <span class="string">&quot;./node_modules/typescript/lib&quot;</span>,</span><br><span class="line"><span class="string">&quot;editor.codeActionsOnSave&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;source.fixAll.eslint&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;source.fixAll.stylelint&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 使用 stylelint 自身的校验即可</span></span><br><span class="line"><span class="string">&quot;css.validate&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;less.validate&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;scss.validate&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">// 保存时自动格式化</span></span><br><span class="line"><span class="string">&quot;editor.formatOnSave&quot;</span>: <span class="literal">true</span></span><br><span class="line"><span class="comment">// 搜索排除下面的文件</span></span><br><span class="line"><span class="string">&quot;search.exclude&quot;</span>: &#123;           </span><br><span class="line">  <span class="string">&quot;**/node_modules&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;dist&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;yarn.lock&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// HTML Snippets 插件配置</span></span><br><span class="line"><span class="string">&quot;emmet.triggerExpansionOnTab&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;emmet.includeLanguages&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;wxml&quot;</span>: <span class="string">&quot;html&quot;</span>,</span><br><span class="line">  <span class="string">&quot;vue-html&quot;</span>: <span class="string">&quot;html&quot;</span>,</span><br><span class="line">  <span class="string">&quot;vue&quot;</span>: <span class="string">&quot;html&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 使对应扩展名的文件使用特定语言</span></span><br><span class="line"><span class="string">&quot;files.associations&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;*.tpl&quot;</span>: <span class="string">&quot;html&quot;</span>,</span><br><span class="line">  <span class="string">&quot;*.cjson&quot;</span>: <span class="string">&quot;jsonc&quot;</span>,</span><br><span class="line">  <span class="string">&quot;*.wxss&quot;</span>: <span class="string">&quot;css&quot;</span>,</span><br><span class="line">  <span class="string">&quot;*.wxs&quot;</span>: <span class="string">&quot;javascript&quot;</span>,</span><br><span class="line">  <span class="string">&quot;.**rc&quot;</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">  <span class="string">&quot;.sequelizerc&quot;</span>: <span class="string">&quot;javascript&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、requests.http：HTTP 请求执行后在右侧区域显示结果</span></span><br><span class="line"><span class="comment">// 执行方式：点击 Send Request、右键选择 Send Request、快捷键 Ctrl+Alt+R </span></span><br><span class="line"><span class="variable constant_">GET</span> <span class="attr">http</span>:<span class="comment">//localhost:5438/licence/query</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Type</span>: application/json</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">POST</span> <span class="attr">http</span>:<span class="comment">//localhost:5438/baiduAip</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Type</span>: application/json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;APP_ID&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;API_KEY&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;SECRET_KEY&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;请注意&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;speech&quot;</span>,</span><br><span class="line">  <span class="string">&quot;options&quot;</span>: &#123;<span class="string">&quot;spd&quot;</span>: <span class="number">5</span>, <span class="string">&quot;pit&quot;</span>: <span class="number">5</span>, <span class="string">&quot;per&quot;</span>: <span class="number">0</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">POST</span> <span class="attr">https</span>:<span class="comment">//api.example.com/login</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Type</span>: application/x-www-form-urlencoded</span><br><span class="line">name=foo</span><br><span class="line">&amp;password=bar</span><br></pre></td></tr></table></figure>

<h2 id="接口调试-Postman"><a href="#接口调试-Postman" class="headerlink" title="接口调试 Postman"></a>接口调试 Postman</h2>  <div align="center">
    <img src="/images/web/postman.png" alt="Postman" width="100%">
  </div>

<ul>
<li>接口请求：GET 请求时可以不输入请求头与请求参数，POST 请求时可输入参数值并设置参数格式 Content-Type 如下：<ul>
<li><strong>raw</strong>：可上传 text、json、xml、html 等任意格式的文本。</li>
<li><strong>form-data</strong>：即 multipart&#x2F;form-data，可上传文件或数据。</li>
<li><strong>x-www-form-urlencoded</strong>：即 application&#x2F;x-www-from-urlencoded，它会将表单数据转换为键值对。</li>
<li><strong>binary</strong>：即 Content-Type:application&#x2F;octet-stream，但一次上传一个文件，并且只能上传二进制文件。</li>
</ul>
</li>
<li>Collections 集合：将多个接口请求放在一起并管理起来，一个工程创建一个 Collection 方便查找及统一处理数据。<ul>
<li>创建 Collections：点击加号图标并输入内容。</li>
<li>添加请求：可以通过 Add Folder 针对不同的请求方式做分组。</li>
</ul>
</li>
<li>身份验证 Authentication<ul>
<li><strong>Basic Auth</strong>：基础验证，会直接将用户名、密码的信息放在请求的 Header</li>
<li><strong>Digest Auth</strong>：使用当前值生成 authorization header，如果已经存在则会被移除</li>
<li><strong>OAuth 1.0</strong>：基于身份验证，可在 header 或查询参数中设置 value。</li>
<li><strong>OAuth 2.0</strong>：支持获得 token 并添加到 request</li>
</ul>
</li>
</ul>
<h2 id="移动端调试-vConsole"><a href="#移动端调试-vConsole" class="headerlink" title="移动端调试 vConsole"></a>移动端调试 vConsole</h2><blockquote>
<p>通过 vConsole.js 重写 console 方法，实现了类似于微信小程序的移动端调试效果。它是腾讯推出的一个轻量、可拓展、针对手机网页的前端开发者调试面板。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install vconsole</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">var</span> vConsole = <span class="keyword">new</span> <span class="title class_">VConsole</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello world&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="网站加速"><a href="#网站加速" class="headerlink" title="网站加速"></a>网站加速</h2><blockquote>
<p>github、apple 等网站无法访问或加载缓慢时，可以通过 ping 检测网站解析域名并将相应网站替换为速度快的 dns 服务器。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 解析域名</span></span><br><span class="line"><span class="attr">https</span>:<span class="comment">//ping.chinaz.com/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 编辑 /etc/hosts</span></span><br><span class="line"><span class="number">17.253</span><span class="number">.85</span><span class="number">.201</span>   developer.<span class="property">apple</span>.<span class="property">com</span></span><br><span class="line"><span class="number">17.253</span><span class="number">.85</span><span class="number">.202</span>   devstreaming-cdn.<span class="property">apple</span>.<span class="property">com</span></span><br><span class="line"><span class="number">104.26</span><span class="number">.7</span><span class="number">.173</span>    ionicframework.<span class="property">com</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新 DNS 缓存 </span></span><br><span class="line">dscacheutil -flushcache</span><br><span class="line"></span><br><span class="line"><span class="comment">// Warning: Changing a readonly file</span></span><br><span class="line">sudo rm -f /etc/.<span class="property">hosts</span>.<span class="property">swp</span></span><br><span class="line">sudo vim /etc/hosts</span><br></pre></td></tr></table></figure>


<h1 id="三、项目构建"><a href="#三、项目构建" class="headerlink" title="三、项目构建"></a>三、项目构建</h1><ul>
<li><code>Npm、Bower</code>：基于 NodeJS 的包管理工具，用来下载、安装、上传和管理已安装包。</li>
<li><code>Gulp、Grunt</code>：基于 NodeJS 的自动化构建工具，用来自动化完成一些常见的、重复的低技术含量任务。两者最大区别是 Gulp 采取流式接口。</li>
<li><code>Webpack、Browserify、RequireJS</code>：模块化解决方案。后两个只是支持打包。</li>
<li><code>ESLint、JSLint</code>：代码检测工具，常用于分析代码中潜在错误。</li>
<li><code>Yeoman、create-react-app、vue-cli、angular-cli</code>：脚手架工具，用于解决模块依赖、统一代码风格、减少重复工作量等问题，并创建一个易用的工作流来帮忙开发者快速新建项目。Yeoman 可用于创建任何类型的前端项目。</li>
<li><code>Git、Svn</code>：版本管理工具。Git 分布式管理指每台电脑都是一个版本仓库但有一个集中的服务中心 Github，可以离线在本地提交而只需要在提交和下载时联网。Svn 集中式管理指所有版本文件都集中存放到一个服务器，但开发时需要联网。</li>
</ul>
<h2 id="构建工具指标"><a href="#构建工具指标" class="headerlink" title="构建工具指标"></a>构建工具指标</h2><ul>
<li><strong>Code Splitting 代码分割</strong>：打包时拆分静态资源，页面加载时实现最合理的按需加载。</li>
<li><strong>Hashing 哈希</strong>：对打包资源进行版本信息的映射，最大化的利用缓存机制。比如热更新。</li>
<li><strong>Importing Modules 依赖机制</strong>：通过配置实现 CommonJS、AMD 等模块化规范。</li>
<li><strong>Non-JavaScript Resources</strong>：导入 html、css、image 等非 Js 资源的支持能力。</li>
<li><strong>Transformations 编译</strong>：压缩 JS 代码并删除无用代码。对于 jsx、.vue、es 等代码的编译不会内置到构建工具中，而是通过 Babel 等融合到工程化流程。构建工具只做份内的事情，其他扩展能力通过插件化机制来完成。</li>
</ul>
<h2 id="包管理工具"><a href="#包管理工具" class="headerlink" title="包管理工具"></a>包管理工具</h2><h3 id="Npm"><a href="#Npm" class="headerlink" title="Npm"></a>Npm</h3><ul>
<li>从 npm 服务器下载别人编写的三方包到本地使用。</li>
<li>从 npm 服务器下载并安装别人编写的命令行程序到本地使用。</li>
<li>将自己编写的包或命令行程序上传到 npm 服务器供别人使用。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 常用命令</span></span><br><span class="line">npm -v                    <span class="comment">// 查看版本</span></span><br><span class="line">npm list                  <span class="comment">// 当前目录已安装插件</span></span><br><span class="line">npm init                  <span class="comment">// 生成 package.json 文件</span></span><br><span class="line"></span><br><span class="line">npm i &lt;name&gt; -g           <span class="comment">//安装包</span></span><br><span class="line">npm uninstall &lt;name&gt;      <span class="comment">//卸载包</span></span><br><span class="line">npm update &lt;name&gt;         <span class="comment">//更新包</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@title</span> 可添加的修饰符</span></span><br><span class="line"><span class="comment">* <span class="doctag">@prame</span> -g               全局(不加则为本地安装)</span></span><br><span class="line"><span class="comment">* <span class="doctag">@prame</span> --no-save        不写入 package.json 的依赖</span></span><br><span class="line"><span class="comment">* <span class="doctag">@prame</span> -S / --save      生产环境还要用的依赖 (package.json/dependencies)</span></span><br><span class="line"><span class="comment">* <span class="doctag">@prame</span> -D / --save-dev  只用于开发环境的依赖 (package.json/devDependencies)</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line">npm run script-key        <span class="comment">// 执行package.json中 &quot;scripts&quot; 选项对应的js</span></span><br><span class="line">npm start                 <span class="comment">// 比较特殊</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布 npm 包</span></span><br><span class="line">cd test                 <span class="comment">// 选择目标文件夹</span></span><br><span class="line">npm init                <span class="comment">// 配置包的相关信息</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="number">1</span>      <span class="comment">// 编辑包 test/index.js</span></span><br><span class="line"></span><br><span class="line">npm adduser             <span class="comment">// 注册，第一次发布包</span></span><br><span class="line">npm login               <span class="comment">// 登录，非第一次发布包</span></span><br><span class="line"></span><br><span class="line">npm publish            <span class="comment">// 发布/更新包</span></span><br><span class="line">npm install 包名        <span class="comment">// npm官网搜索后验证下载</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 撤销发布的包要用force强制删除。超过24小时就不能删除了</span></span><br><span class="line">npm --force unpublish 包名</span><br></pre></td></tr></table></figure>

<h3 id="Npx"><a href="#Npx" class="headerlink" title="Npx"></a>Npx</h3><blockquote>
<p>如果你把 NPM 升级到最新版本 <a href="mailto:&#110;&#112;&#109;&#x40;&#53;&#x2e;&#x32;&#46;&#48;">&#110;&#112;&#109;&#x40;&#53;&#x2e;&#x32;&#46;&#48;</a>，它就会安装一个新的包 npx，它用来代替 npm 来直接执行包（package）命令。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 升级</span></span><br><span class="line">npm i npm@latest -g</span><br><span class="line">npm i cnpm -g --registry=<span class="attr">https</span>:<span class="comment">//registry.npmmirror.com/ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// npm 使用 create-react-app</span></span><br><span class="line">npm init</span><br><span class="line">npm install -g create-react-app</span><br><span class="line">create-react-app my-app</span><br><span class="line"></span><br><span class="line"><span class="comment">// npx 直接使用，包不存在时会自动下载</span></span><br><span class="line">npx create-react-app my-app</span><br></pre></td></tr></table></figure>

<h3 id="Yarn"><a href="#Yarn" class="headerlink" title="Yarn"></a>Yarn</h3><blockquote>
<p>Facebook 等公司开发的用于替换 npm 的包管理工具，它解决了 npm 存在的问题：1、安装时无法保证速度和版本统一，2、安装时允许运行代码而不能保证安全。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 常用命令</span></span><br><span class="line">yarn -v</span><br><span class="line">yarn init</span><br><span class="line"></span><br><span class="line">yarn === npm install</span><br><span class="line">yarn add lodash === npm i lodash --save</span><br><span class="line">yarn add lodash --dev === npm i lodash --save-dev</span><br><span class="line">yarn <span class="variable language_">global</span> add lodash === npm i lodash -g</span><br><span class="line">npm uninstall lodash --save === yarn remove lodash</span><br><span class="line">rm -rf node_modules &amp;&amp; npm install === yarn upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新淘宝源</span></span><br><span class="line">yarn config get registry</span><br><span class="line">yarn config set registry <span class="attr">https</span>:<span class="comment">//registry.npm.taobao.org</span></span><br></pre></td></tr></table></figure>

<h2 id="构建工具-Gulp"><a href="#构建工具-Gulp" class="headerlink" title="构建工具 Gulp"></a>构建工具 Gulp</h2><ul>
<li><strong>常用插件</strong><ul>
<li>gulp-minify-html：压缩 html</li>
<li>gulp-minify-css：压缩 css</li>
<li>gulp-uglify：压缩 js</li>
<li>gulp-smushit：压缩图片</li>
<li>gulp-concat：文件合并</li>
<li>gulp-rename：重命名</li>
<li>gulp-babel：编译 ES6</li>
<li>gulp-sass&#x2F;less：css 预处理</li>
<li>gulp-autoprefixer：自动添加 css 前缀。</li>
<li>browser-sync：自动刷新页面(非 gulp 插件)。</li>
</ul>
</li>
<li><strong>API</strong><ul>
<li>task：创建任务</li>
<li>run：运行任务</li>
<li>watch：监听任务</li>
<li>src：设置需处理的文件路径(正则&#x2F;数组)。</li>
<li>dest：设置生成文件的路径，一个任务可有多个生成路径。</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化目录</span></span><br><span class="line">├── app              <span class="comment">// 工作目录：源文件</span></span><br><span class="line">│   ├── js</span><br><span class="line">│   ├── <span class="title class_">Sass</span></span><br><span class="line">│   └── index.<span class="property">html</span></span><br><span class="line">│</span><br><span class="line">├── dist            <span class="comment">// 目标目录：编译、压缩后的文件</span></span><br><span class="line">└── release         <span class="comment">// 可以发布到服务器的文件目录</span></span><br><span class="line"></span><br><span class="line">cnpm install gulp -g  <span class="comment">// 全局安装，执行gulp任务</span></span><br><span class="line">cd <span class="title class_">GulpTest</span></span><br><span class="line">cnpm init      <span class="comment">// 生成package.json文件</span></span><br><span class="line">cnpm install gulp -S  <span class="comment">// 本地安装，使用gulp插件并避免版本冲突</span></span><br><span class="line">gulp -v       <span class="comment">// 查看版本</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置文件 gulpfile.js</span></span><br><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sass = <span class="built_in">require</span>(<span class="string">&quot;gulp-sass&quot;</span>);         <span class="comment">// 编译sass</span></span><br><span class="line"><span class="keyword">var</span> maps = <span class="built_in">require</span>(<span class="string">&quot;gulp-sourcemaps&quot;</span>);   <span class="comment">// 在浏览器显示scss样式以便调试</span></span><br><span class="line"><span class="keyword">var</span> autoprefixer = <span class="built_in">require</span>(<span class="string">&quot;gulp-autoprefixer&quot;</span>); <span class="comment">//自动添加前后缀</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">&quot;gulp-htmlmin&quot;</span>); <span class="comment">//html压缩</span></span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">&quot;gulp-uglify&quot;</span>); <span class="comment">//压缩js文件</span></span><br><span class="line"><span class="keyword">var</span> smushit = <span class="built_in">require</span>(<span class="string">&quot;gulp-smushit&quot;</span>); <span class="comment">//图片压缩</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">&quot;gulp-concat&quot;</span>); <span class="comment">//文件合并</span></span><br><span class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">&quot;gulp-babel&quot;</span>); <span class="comment">//将ES6代码编译成ES5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bs = <span class="built_in">require</span>(<span class="string">&quot;browser-sync&quot;</span>).<span class="title function_">create</span>(); <span class="comment">//页面同步</span></span><br><span class="line"><span class="keyword">var</span> reload = bs.<span class="property">reload</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&quot;default&quot;</span>, [<span class="string">&quot;server&quot;</span>, ]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打包任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;build&#x27;</span>, [<span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;css&#x27;</span>, <span class="string">&#x27;less&#x27;</span>, <span class="string">&#x27;js&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// sass 任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&quot;sass&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        gulp</span><br><span class="line">          .<span class="title function_">src</span>(<span class="string">&quot;./src/scss/*.scss&quot;</span>) <span class="comment">// 导入文件</span></span><br><span class="line">          .<span class="title function_">pipe</span>(maps.<span class="title function_">init</span>()) <span class="comment">// 将页面样式定义到scss</span></span><br><span class="line">          <span class="comment">// 转译scss到css,报错时输出错误信息,不终止程序运行</span></span><br><span class="line">          .<span class="title function_">pipe</span>(<span class="title function_">sass</span>(&#123;<span class="attr">outputStyle</span>: <span class="string">&quot;compressed&quot;</span> &#125;).<span class="title function_">on</span>(<span class="string">&quot;error&quot;</span>, sass.<span class="property">logError</span>))</span><br><span class="line"></span><br><span class="line">          .<span class="title function_">pipe</span>(<span class="title function_">autoprefixer</span>()) <span class="comment">// 自动添加前后缀</span></span><br><span class="line">          .<span class="title function_">pipe</span>(maps.<span class="title function_">write</span>(<span class="string">&quot;./&quot;</span>)) <span class="comment">// 生成map文件（和css文件放在一起）</span></span><br><span class="line">          .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&quot;./dist/css&quot;</span>)) <span class="comment">// 将生成的文件放到css文件夹中</span></span><br><span class="line">          .<span class="title function_">pipe</span>(<span class="title function_">reload</span>(&#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 任务完成后（监听关闭后），再有修改时重新启动监听时会重新执行以防报错</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 html</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&quot;mihtml&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> options = &#123;</span><br><span class="line">        <span class="attr">removeComments</span>: <span class="literal">true</span>,      <span class="comment">// 清除 HTML 注释</span></span><br><span class="line">        <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,  <span class="comment">// 压缩 HTML</span></span><br><span class="line">        <span class="attr">minfyJS</span>: <span class="literal">true</span>,   <span class="comment">// 压缩JS</span></span><br><span class="line">        <span class="attr">minfyCss</span>: <span class="literal">true</span>,  <span class="comment">// 压缩CSS</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> gulp</span><br><span class="line">      .<span class="title function_">src</span>(<span class="string">&quot;./src/html/*.html&quot;</span>)</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">htmlmin</span>(options))</span><br><span class="line">      .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&quot;./dist/html/&quot;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 js</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&quot;minijs&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp</span><br><span class="line">      .<span class="title function_">src</span>(<span class="string">&quot;!./src/js/*.js&quot;</span>) <span class="comment">// ! 表示除了...之外</span></span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">babel</span>())</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())        <span class="comment">// 压缩</span></span><br><span class="line">      <span class="comment">// .pipe(concat(&#x27;all.min.js&#x27;))   // 合并到 all.min.js</span></span><br><span class="line">      .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&quot;./dist/js/&quot;</span>));  <span class="comment">// 指定目录</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 img</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&quot;img&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp</span><br><span class="line">      .<span class="title function_">src</span>(<span class="string">&quot;./src/img/*.*&quot;</span>)</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">smushit</span>(&#123; <span class="attr">verbose</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">      .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&quot;./dist/img/&quot;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 生成服务并自动化监听项目</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&quot;server&quot;</span>, [<span class="string">&quot;sass&quot;</span>, <span class="string">&quot;mihtml&quot;</span>, <span class="string">&quot;minijs&quot;</span>], <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    bs.<span class="title function_">init</span>(&#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">8080</span>, </span><br><span class="line">        <span class="attr">open</span>: <span class="string">&quot;external&quot;</span>,    <span class="comment">// 启动时自动打开的网址</span></span><br><span class="line">        <span class="attr">server</span>: &#123;</span><br><span class="line">            <span class="attr">baseDir</span>: <span class="string">&#x27;./&#x27;</span>,</span><br><span class="line">            <span class="attr">index</span>: <span class="string">&#x27;dist/index.html&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// proxy: &#x27;localhost&#x27;  使用代理</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    gulp.<span class="title function_">task</span>(<span class="string">&quot;run&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        gulp.<span class="title function_">run</span>(<span class="string">&quot;lint&quot;</span>, <span class="string">&quot;sass&quot;</span>, <span class="string">&quot;scripts&quot;</span>);</span><br><span class="line">        <span class="comment">// 监听sass文件变化</span></span><br><span class="line">        gulp.<span class="title function_">watch</span>(<span class="string">&quot;src/sass/*.sass&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            gulp.<span class="title function_">run</span>(<span class="string">&quot;lint&quot;</span>, <span class="string">&quot;sass&quot;</span>, <span class="string">&quot;scripts&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听 html</span></span><br><span class="line">    gulp.<span class="title function_">watch</span>(<span class="string">&quot;./src/html/*.html&quot;</span>, [<span class="string">&quot;mihtml&quot;</span>]);</span><br><span class="line">    gulp.<span class="title function_">watch</span>(<span class="string">&quot;./dist/html/*.html&quot;</span>).<span class="title function_">on</span>(<span class="string">&quot;change&quot;</span>, reload);</span><br><span class="line">    <span class="comment">// 监听 scss</span></span><br><span class="line">    gulp.<span class="title function_">watch</span>(<span class="string">&quot;./src/scss/*.scss&quot;</span>, [<span class="string">&quot;sass&quot;</span>]);</span><br><span class="line">    gulp.<span class="title function_">watch</span>(<span class="string">&quot;./dist/css/*.css&quot;</span>).<span class="title function_">on</span>(<span class="string">&quot;change&quot;</span>, reload);</span><br><span class="line">    <span class="comment">// 监听 js</span></span><br><span class="line">    gulp.<span class="title function_">watch</span>(<span class="string">&quot;./src/js/*.js&quot;</span>, [<span class="string">&quot;minijs&quot;</span>]);</span><br><span class="line">    gulp.<span class="title function_">watch</span>(<span class="string">&quot;./dist/js/*js&quot;</span>).<span class="title function_">on</span>(<span class="string">&quot;change&quot;</span>, reload);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行 gulp： 定义 package.json scripts，npm install rimraf -g</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;gulp dev&quot;</span>,                   <span class="comment">// 执行 gulp dev 命令</span></span><br><span class="line">  <span class="string">&quot;clean&quot;</span>: <span class="string">&quot;rimraf dist&quot;</span>,                <span class="comment">// 清空 dist 目录文件</span></span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;rimraf dist &amp;&amp; gulp build&quot;</span>   <span class="comment">// 清空 dist 之后打包</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="打包工具-Webpack"><a href="#打包工具-Webpack" class="headerlink" title="打包工具 Webpack"></a>打包工具 Webpack</h2><blockquote>
<p>模块化打包工具的需求：能够将散落的模块打包到一起、能够编译代码的新特性、能够支持不同种类的前端资源模块。Webpack 通过 Loader 机制对零散的 Scss、TypeScript、ES6+ 等代码实现编译转换，然后整体或拆分打包到 JS 文件（拆分打包即打包初次加载时必须模块，其它模块则按需异步加载），在很多场景下可以替代 Gulp&#x2F;Grunt。</p>
</blockquote>
<ul>
<li>工具对比<ul>
<li><strong>Gulp&#x2F;Grunt</strong>：在一个配置文件指定对某些文件进行编译、组合、压缩等任务的具体步骤，工具会自动完成这些任务。</li>
<li><strong>Webpack</strong>：把项目当做一个整体并从根文件开始寻找所有依赖文件，使用 loaders 处理并将所有资源都转换成 js，然后用 CommonJS 机制 (require、module.exports) 管理起来。</li>
</ul>
</li>
<li>核心概念<ul>
<li><strong>Entry</strong>：webpack 开始构建的入口文件。</li>
<li><strong>Output</strong>：如何命名输出文件、输出目录。</li>
<li><strong>Loaders</strong>：解析文件的加载器，将 scss、ES6、图片等非 js 文件转换为 webpack 能够处理的模块。</li>
<li><strong>Plugins</strong>：扩展功能的插件，完成压缩文件等 loader 无法解决的功能。</li>
<li><strong>Chunk</strong>：取代 webpack3 CommonsChunkPlugin，最大特点是配置简单，设置 mode: production 之后则 webpack4 会自动开启 Code Splitting 将某些公共模块去重，打包成一个单独的 chunk。</li>
</ul>
</li>
<li>相关依赖<ul>
<li><strong>webpack</strong>：用于编译 JS 模块。</li>
<li><strong>webpack-cli</strong>：用于命令行中运行 webpack。</li>
<li>webpack-merge：提取公共配置，减少重复配置代码。<code>module.exports = WebpackMerge(baseConfig, &#123;&#125;)</code>。</li>
<li>cross-env：跨平台设置和使用环境变量。<code>scripts: &#123; build: &quot;cross-env NODE_ENV=prod webpack --config build/webpack.config.js&quot; &#125;</code>。</li>
<li>html-webpack-plugin：将打包后的 js 文件自动引入到 html 文件中。</li>
<li>webpack-dev-server：本地开启一个 http 服务，可配置端口、热更新等。</li>
<li>clean-webpack-plugin：每次打包前先处理掉之前的 dist 目录。</li>
<li>postcss-loader：补全浏览器前缀、压缩 CSS 等的 css 编译工具。</li>
</ul>
</li>
</ul>
<h3 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化目录：npm install webpack webpack-cli -D</span></span><br><span class="line"><span class="title class_">WebTest</span></span><br><span class="line">  ├── app              <span class="comment">// 工作目录：源文件</span></span><br><span class="line">  │   ├── main.<span class="property">js</span></span><br><span class="line">  │   └── hello.<span class="property">js</span></span><br><span class="line">  │</span><br><span class="line">  ├── dist            <span class="comment">// 目标目录：打包生成的 js 文件</span></span><br><span class="line">  │   └── index.<span class="property">html</span></span><br><span class="line">  │</span><br><span class="line">  ├── node_moudles</span><br><span class="line">  └── package.<span class="property">json</span></span><br><span class="line"></span><br><span class="line">cd <span class="title class_">WebTest</span></span><br><span class="line">cnpm install webpack webpack-cli -D</span><br><span class="line">cnpm init       <span class="comment">// 新建 package.json</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line">div id=<span class="string">&quot;app&quot;</span></span><br><span class="line">script src=<span class="string">&quot;bundle.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// hello.js</span></span><br><span class="line">moudle.<span class="property">exports</span> = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="built_in">require</span>(<span class="string">&quot;./hello.js&quot;</span>)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#app&quot;</span>).<span class="title function_">appendChild</span>(str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打包执行</span></span><br><span class="line">webpack app/main.<span class="property">js</span> dist/bundle.<span class="property">js</span></span><br></pre></td></tr></table></figure>

<h3 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h3><blockquote>
<p>项目根目录新建 webpack.config.js 文件并配置选项，然后在终端执行 webpack 就会被自动引用。项目开发时可以创建多个配置文件：webpack.dev.config.js、webpack.pub.config.js 分别用于开发和生产环境。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: **dirname + <span class="string">&#x27;/app/main.js&#x27;</span>, <span class="comment">// 唯一入口文件：**dirname 绝对路径</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,         <span class="comment">// 输出文件名</span></span><br><span class="line">      <span class="attr">path</span>: **dirname + <span class="string">&quot;/dist&quot;</span>,     <span class="comment">// 输出文件存放地址</span></span><br><span class="line">      <span class="comment">// path: path.resolve(**dirname, &#x27;dist&#x27;)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">      <span class="attr">rules</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">              <span class="attr">use</span>: [&#123;</span><br><span class="line">                  <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">                  <span class="comment">// loader: &#x27;url-loader&#x27;,</span></span><br><span class="line">                  <span class="attr">options</span>: &#123;</span><br><span class="line">                    <span class="comment">// 原文件名_哈希值.后缀</span></span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;[name]_[hash].[ext]&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 打包目录</span></span><br><span class="line">                    <span class="attr">outputPath</span>: <span class="string">&#x27;images/&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 超出 10kb 则不处理</span></span><br><span class="line">                    limit : <span class="number">10</span> * <span class="number">1024</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="comment">// css-loader 将多个 css 文件整合到一个文件</span></span><br><span class="line">              <span class="comment">// style-loader 把整合的 css 部分挂载到 head</span></span><br><span class="line">              <span class="attr">test</span>: <span class="regexp">/\.(sa|sc|c)ss$/</span>,</span><br><span class="line">              <span class="attr">use</span>: [</span><br><span class="line">                  <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">                  <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">              ],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">              <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">              <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">              <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">                      [<span class="string">&quot;@babel/preset-env&quot;</span>, &#123; <span class="string">&quot;useBuiltIns&quot;</span>: <span class="string">&quot;usage&quot;</span> &#125;]</span><br><span class="line">                  ]</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [ <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json：配置快捷执行方法，--config 指定配置文件</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>:<span class="string">&quot;webpack --config webpack.dev.config.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pub&quot;</span>:<span class="string">&quot;webpack --config webpack.pub.config.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack&quot;</span>,</span><br><span class="line">    <span class="string">&quot;server&quot;</span>: <span class="string">&quot;webpack-dev-server --inline&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行</span></span><br><span class="line">npx webpack --config webpack.<span class="property">config</span>.<span class="property">js</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h3 id="高级配置"><a href="#高级配置" class="headerlink" title="高级配置"></a>高级配置</h3><ul>
<li><strong>配置 Babel</strong><ul>
<li>功能：将 ES6、jsx 等语法编译为浏览器能够运行的 js</li>
<li>配置：webpack.config.js 或单独的 .babelrc 文件（webpack 会自动调用）</li>
</ul>
</li>
<li><strong>生成 Source Maps</strong>：有时打包后文件出错但不容易找到代码位置，而通过配置 devtool 选项后，webpack 就可以在打包时生成 source maps，这为我们提供了一种对应编译文件和源文件的方法，使得编译后的代码可读性更高和更容易调试。可选的四种配置如下：<ul>
<li>source-map：完整且功能完全的单独文件，但会减慢打包速度。</li>
<li>cheap-module-source-map：不带列映射，只能对应到具体的行。</li>
<li>eval-source-map：不影响速度且完整，但有隐患，可开发不可生产阶段。</li>
<li>cheap-module-eval-source-map：生成 Source Map 最快并且和 js 同行，不利于调试，推荐在大型项目考虑时间成本时使用。</li>
</ul>
</li>
<li><strong>构建本地服务器</strong>：Webpack 提供一个可选的本地开发服务器 webpack-dev-server，它基于 Node.js 构建而且可以实现浏览器监听代码修改并自动刷新等效果，配置前需要通过 npm 安装它作为项目依赖。</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: **dirname + <span class="string">&quot;/app/main.js&quot;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(**dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">contentBase</span>: <span class="string">&quot;./dist&quot;</span>,     <span class="comment">// 加载页面的所在目录</span></span><br><span class="line">        <span class="attr">historyApiFallback</span>: <span class="literal">true</span>,  <span class="comment">// 不跳转</span></span><br><span class="line">        <span class="attr">inline</span>: <span class="literal">true</span>,              <span class="comment">// 实时刷新</span></span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span>,                 <span class="comment">// 热更新，即不刷新浏览器的前提下刷新页面</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行</span></span><br><span class="line">npm run server</span><br></pre></td></tr></table></figure>


<h2 id="脚手架工具"><a href="#脚手架工具" class="headerlink" title="脚手架工具"></a>脚手架工具</h2><blockquote>
<p>用来创建项目基础结构、提供项目规范和约定，主要分为通用型和专用型两类。主要工作过程是通过命令行交互询问用户问题，然后根据用户回答的结果生成文件。</p>
</blockquote>
<h3 id="原生创建"><a href="#原生创建" class="headerlink" title="原生创建"></a>原生创建</h3><blockquote>
<p>通过命令行工具启动一个程序，在命令行交互中获取用户输入，然后创建对应的代码文件。下面通过原始方式来创建一个极简的脚手架工具。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、初始化目录、安装模板语法和命令行交互插件</span></span><br><span class="line">mkdir mycli &amp;&amp; npm init -y</span><br><span class="line">npm install ejs inquirer</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、代码修改</span></span><br><span class="line"><span class="comment">// mycli/package.json: 新增代码 &quot;bin&quot;: &quot;cli.js&quot; 指定入口文件</span></span><br><span class="line"><span class="comment">// cjs.js: 脚本命令代码添加首行文件头 #!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、创建模板文件：templete/index.html：&lt;title&gt;&lt;%= name %&gt;&lt;/title&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、编辑脚手架逻辑文件：cjs.js</span></span><br><span class="line">inquirer.<span class="title function_">prompt</span>([&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Project Name:&#x27;</span></span><br><span class="line">&#125;]).<span class="title function_">then</span>(<span class="function"><span class="params">answer</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> temp = path.<span class="title function_">join</span>(_darname, <span class="string">&#x27;templetes&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> dist = process.<span class="title function_">cwd</span>()</span><br><span class="line">    fs.<span class="title function_">readdir</span>(temp, <span class="function">(<span class="params">err, files</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err</span><br><span class="line">        files.<span class="title function_">forEach</span>(<span class="function"><span class="params">file</span> =&gt;</span> &#123;</span><br><span class="line">            ejs.<span class="title function_">renderFile</span>(path.<span class="title function_">join</span>(temp, file), answer, </span><br><span class="line">            <span class="function">(<span class="params">err, result</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err) <span class="keyword">throw</span> err</span><br><span class="line">                fs.<span class="title function_">writeFileSync</span>(path.<span class="title function_">join</span>(dist, file), result)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5、挂载、卸载</span></span><br><span class="line">npm link         <span class="comment">// 全局挂载后就可以使用 mycli 创建项目文件了</span></span><br><span class="line">npm unlink       <span class="comment">// 卸载命令行</span></span><br></pre></td></tr></table></figure>


<h3 id="Yeoman"><a href="#Yeoman" class="headerlink" title="Yeoman"></a>Yeoman</h3><blockquote>
<p>通用型脚手架工具，主要包括命令行管理工具 yo、生成器 generator。不同的生成器针对 app、小程序等不同项目，使用时安装 generator 并通过 yo 运行生成项目结构。</p>
</blockquote>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、基本使用</span></span><br><span class="line">npm install -g yo generator-webapp generator-node</span><br><span class="line">yo webapp || yo node</span><br><span class="line">npm run start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、自定义定制</span></span><br><span class="line">mkdir generator-sample        <span class="comment">// 新建 generator-[name]</span></span><br><span class="line">npm init -y                   <span class="comment">// -y 略过问答而使用默认值</span></span><br><span class="line">npm install yeoman-generator  <span class="comment">// 安装生成器基类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// generators/app/index.js：新建入口文件并编辑</span></span><br><span class="line"><span class="keyword">const</span> yeoman = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">    prompting () &#123;  <span class="comment">// 命令行交互</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">prompt</span>([&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;Your Project Name:&#x27;</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="variable language_">this</span>.<span class="property">appname</span></span><br><span class="line">        &#125;]).<span class="title function_">then</span>(<span class="function"><span class="params">answer</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">answer</span> = answer;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; </span><br><span class="line">    writing () &#123;   <span class="comment">// 文件写入</span></span><br><span class="line">        <span class="keyword">const</span> temp = <span class="variable language_">this</span>.<span class="title function_">templetePath</span>(<span class="string">&#x27;temp.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">const</span> output = <span class="variable language_">this</span>.<span class="title function_">destinationPath</span>(<span class="string">&quot;out.txt&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> context = <span class="variable language_">this</span>.<span class="property">answer</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">fs</span>.<span class="title function_">copyTpl</span>(temp, output, context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载命令</span></span><br><span class="line">npm link   <span class="comment">// 将 generator-sample 挂载为全局命令</span></span><br><span class="line">npm config get prefix   <span class="comment">// 查找 npm 全局目录命令</span></span><br><span class="line">yo sample     <span class="comment">// 挂载成功后用来在新目录生成文件内容</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、创建 Vue 脚手架</span></span><br><span class="line">mkdir generator-vue</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用模版：为了方便可以将 Vue 空项目代码复制到 generators/app/templates</span></span><br><span class="line"><span class="comment">// templates\public\index.html：不需要替换转义时可用两个 %% 屏蔽，重写时会跳过</span></span><br><span class="line"><span class="comment">// &lt;title&gt;&lt;%= name %&gt;&lt;/title&gt;  --&gt; &lt;title&gt;&lt;%%= name %%&gt;&lt;/title&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// generators/app/index.js</span></span><br><span class="line"><span class="keyword">const</span> yeoman = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">vueCli</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Generator</span> &#123;</span><br><span class="line">    prompting () &#123; &#125;</span><br><span class="line">    writing () &#123; </span><br><span class="line">        <span class="keyword">const</span> templetes = [</span><br><span class="line">            <span class="string">&#x27;public/index.html&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;src/assets/logo.png&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;src/compontents/Home.vue&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;src/router/index.js&#x27;</span>,</span><br><span class="line">            ...</span><br><span class="line">        ]</span><br><span class="line">        templetes.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">fs</span>.<span class="title function_">copyTpl</span>(</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">templetePath</span>(item), </span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">destinationPath</span>(item)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">answer</span></span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>


<h1 id="四、版本管理-Git"><a href="#四、版本管理-Git" class="headerlink" title="四、版本管理 Git"></a>四、版本管理 Git</h1><h2 id="Git-和-Github-的关系"><a href="#Git-和-Github-的关系" class="headerlink" title="Git 和 Github 的关系"></a>Git 和 Github 的关系</h2><ol>
<li>Git：指定了 remote 链接和用户信息（用户名+邮箱）之后，git 可以帮你将提交过到你本地分支的代码 push 到远程的 git 仓库（任意提供了 git 托管服务的服务器上都可以，包括你自己建的服务器   或者  GitHub 等网站提供的服务器）或者将远程仓库的代码 fetch 到本地。</li>
<li>Github：只是一个提供存储空间的服务器，用来存储 git 仓库。当然现在 Github 已经由一个存放 git 仓库的网站空间发展为了一个开源社区（不只具有存储 git 仓库的功能了），你可以参与别人的开源项目，也可以让别人参与你的开源项目。</li>
</ol>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2>  <div style="text-indent: 2em">开发者在自己的机器上更新服务器上的最新代码，然后根据需要创建分支，在该分支上提交本地修改的代码到远程仓库并通知主开发者合并代码。如果主开发者发现代码有冲突则让开发者修改后重新提交，没有冲突则合并代码。注意本地的 .git文件是指本地仓库，.git目录下存放着所有文件的版本和关联信息但默认隐藏。开发流程图如下</div>

  <div align="center">
    <img src="/images/web/git_work.png" alt="工作流程图" width="100%">
  </div>

<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2>  <div align="center">
    <img src="/images/web/git_order.png" alt="常用命令图" width="100%">
  </div>


<h2 id="基础配置-1"><a href="#基础配置-1" class="headerlink" title="基础配置"></a>基础配置</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">git config --<span class="variable language_">global</span> --list         <span class="comment">//查看全局配置</span></span><br><span class="line">git config --<span class="variable language_">global</span> user.<span class="property">name</span> <span class="string">&quot;chuanggefighting&quot;</span>    <span class="comment">//设置用户名</span></span><br><span class="line">git config --<span class="variable language_">global</span> user.<span class="property">email</span> <span class="string">&quot;17621538916@163.com&quot;</span>    <span class="comment">//设置邮箱</span></span><br></pre></td></tr></table></figure>


<h2 id="ssh-密钥配置"><a href="#ssh-密钥配置" class="headerlink" title="ssh 密钥配置"></a>ssh 密钥配置</h2><div style="text-indent: 2em">Git使用https协议，每次pull/push都要输入密码比较麻烦，而使用git协议后使用ssh密钥，这样可以省去每次都输密码。配置步骤如下：</div>

<ol>
<li>检测 SSH keys 是否存在：<code>cd ~/.ssh</code>。</li>
<li>创建 ssh key(生成密钥对)：<code>ssh-keygen -t rsa -C &quot;17621538916@163.com&quot;</code>：此时会提示自定义名称和 push 时的密码 (不是 git 登录密码), 一般推荐略过(直接三个回车), 如果看到成功保存信息则说明如果创建成功。</li>
<li>添加公钥到 github 等个人的远程仓库。</li>
<li>查看生成的公钥：<code>cat ~/.ssh/id_rsa.pub</code>。</li>
<li>登陆 github：点击头像、Settings、左栏点击 SSH and GPG keys、点击 New SSH key、复制上面的公钥内容并粘贴入”Key”，自定义 title、点击 Add key。</li>
<li>测试 SSH 的连接：<code>ssh -T git@github.com</code>。</li>
<li>输入 yes 后可看到信息。</li>
</ol>
<h2 id="代码提交命令"><a href="#代码提交命令" class="headerlink" title="代码提交命令"></a>代码提交命令</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 下载远程代码</span></span><br><span class="line">git clone url              <span class="comment">// 拉取远程主分支代码到本地</span></span><br><span class="line">git clone -b dev url       <span class="comment">// 拉取指定分支代码到本地</span></span><br><span class="line">git remote -v              <span class="comment">// 查询当前远程的版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 拉取远程代码并合并到本地</span></span><br><span class="line">git stash                  <span class="comment">// 保存本地修改 stash@&#123;0&#125;</span></span><br><span class="line">git stash save <span class="string">&quot;更新&quot;</span>       <span class="comment">// 存储时添加备注，方便查找</span></span><br><span class="line">git pull                   <span class="comment">// 拉取远程代码</span></span><br><span class="line">git checkout dev           <span class="comment">// 切换到本地其它分支</span></span><br><span class="line">git stash list             <span class="comment">// 查看所有的本地修改记录</span></span><br><span class="line">git stash pop              <span class="comment">// 合并最新修改到本地并删除</span></span><br><span class="line">git stash apply            <span class="comment">// 合并最新修改到本地但不删除</span></span><br><span class="line">git stash clear            <span class="comment">// 清空 stash</span></span><br><span class="line">git stash drop stash@&#123;$n&#125;  <span class="comment">// 删除某个 stash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 推送本地修改</span></span><br><span class="line">git status</span><br><span class="line">git add .       <span class="comment">// 指定需要提交到本地仓库的文件</span></span><br><span class="line">git status</span><br><span class="line">git commit -m <span class="string">&quot;create dev&quot;</span>  <span class="comment">// 提交代码到本地</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建分支</span></span><br><span class="line">git branch                 <span class="comment">// 查看本地分支</span></span><br><span class="line">git checkout -b dev        <span class="comment">// 新建并切换到该分支</span></span><br><span class="line">git push origin dev        <span class="comment">// 推送到远程仓库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 切换到本地不存在的远程分支</span></span><br><span class="line">git branch -a</span><br><span class="line">git checkout -b dev remotes/origin/dev</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除分支：强制删除 -D</span></span><br><span class="line">git branch -d dev</span><br><span class="line">git branch -r -d origin/dev</span><br><span class="line">git push origin :dev           <span class="comment">// 远程分支删除的简单方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并分支到当前分支</span></span><br><span class="line">git checkout master</span><br><span class="line">git merge dev         <span class="comment">// 每次都产生一个新节点，提交记录会分开显示</span></span><br><span class="line">git rebase dev   <span class="comment">// 不产生新节点，提交记录融合为一个清晰的线性提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// master 分支代码合并到某分支</span></span><br><span class="line">git checkout master</span><br><span class="line">git pull</span><br><span class="line">git checkout dev</span><br><span class="line">git merge master</span><br><span class="line">git push</span><br><span class="line"></span><br><span class="line"><span class="comment">// git pull --rebase 代码更整洁，推荐使用</span></span><br><span class="line">git pull = git fetch + git merge</span><br><span class="line">git pull --rebase = git fetch + git rebase</span><br><span class="line"><span class="comment">// 指定某个新分支在执行 git pull 时默认使用 rebase 方式</span></span><br><span class="line">git config branch.<span class="property">dev</span>.<span class="property">rebase</span> <span class="literal">true</span></span><br><span class="line">git config --<span class="variable language_">global</span> branch.<span class="property">autosetuprebase</span> always</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其它</span></span><br><span class="line">git fetch --all       <span class="comment">// 更新远程修改但不会 merge</span></span><br><span class="line">git reset --hard orgin/master  <span class="comment">// 强制更新(慎用)</span></span><br><span class="line">git remote set-url origin url  <span class="comment">// 修改远程仓库地址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// gitignore 不生效的解决方案</span></span><br><span class="line">git rm -r --cached .</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&#x27;update .gitignore&#x27;</span>  <span class="comment">// windows 命令</span></span><br><span class="line">git commit -m <span class="string">&quot;update .gitignore&quot;</span>  <span class="comment">// mac：需要双引号</span></span><br></pre></td></tr></table></figure>


<h2 id="把个人网页挂到-Github"><a href="#把个人网页挂到-Github" class="headerlink" title="把个人网页挂到 Github"></a>把个人网页挂到 Github</h2><ol>
<li><strong>Github 上建立仓库，比如 resume</strong>。</li>
<li><strong>进入新建仓库并选择 settings 进行仓库设置，滚动到页面底部 “Github Pages” 部分</strong>。<br>* Source -* master branch，保存后就会自动生成网址。<br>* 生成网址拼接文件路径后访问：chuanggefighting.github.io&#x2F;resume&#x2F;dist&#x2F;index.html。</li>
<li><strong>将仓库代码克隆到本地</strong>：删除除了 .git 以外的其他文件，然后通过以下命令测试。<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">git add *               <span class="comment">// 添加到暂存区</span></span><br><span class="line">git commit -m <span class="string">&#x27;del&#x27;</span>     <span class="comment">// 上传到本地仓库</span></span><br><span class="line">git push origin master  <span class="comment">// 上传到远程仓库</span></span><br></pre></td></tr></table></figure></li>
<li><strong>更新个人代码到远程仓库</strong></li>
</ol>
]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>web 开发须知</title>
    <url>/2019/02/17/2-1-web%E5%BC%80%E5%8F%91%E9%A1%BB%E7%9F%A5/</url>
    <content><![CDATA[<h1 id="一、技术网站"><a href="#一、技术网站" class="headerlink" title="一、技术网站"></a>一、技术网站</h1><blockquote>
<p>web 开发就是呈现用户可理解的界面并响应用户操作。wget 扒取网站源码：<code>brew install wget、wget -c -r -np -nc -L -k -p http://xxx.com</code>。</p>
</blockquote>
<ul>
<li>技术学习<ul>
<li><a href="https://www.docschina.org/">印记中文</a>：中文教程  </li>
<li><a href="http://tool.lu/">在线工具</a>：代码处理工具合集</li>
<li><a href="https://gitee.com/">码云</a>：代码托管中文网站</li>
<li><a href="https://github.com/">Github</a>：代码托管全球网站  </li>
<li><a href="https://stackoverflow.com/">Stack Overflow</a>：技术问答社区</li>
<li><a href="http://tool.chinaz.com/tools/openweb.aspx/">站长工具</a>：代码整理和测试</li>
<li><a href="https://animista.net/">CSS 动画</a>：CSS 动画  </li>
<li><a href="https://carbon.now.sh/">Carbon</a>：图片生成器</li>
<li><a href="https://www.favicon-generator.org/">Faviconer</a>：图标生成器 </li>
<li><a href="https://www.processon.com/">Slides</a>：WebPPT 编辑器</li>
<li><a href="https://learn-anything.xyz/">Learn Anything</a>：思维导图</li>
</ul>
</li>
<li>网站搭建<ul>
<li><strong>WordPress</strong>：开源的建站系统，从个人博客到企业电商平台都可以轻松实现。</li>
<li><strong>Docsify、Dumi</strong>：简单的文档站点生成器，区别是 Dumi 专为组件开发场景而生。</li>
<li><strong>Img Cook</strong>：阿里团队开发的页面生成器，通过人工智能根据设计稿一键生成代码。</li>
<li><strong>Ant Design Landing</strong>：蚂蚁开发的网站首页生成器，方便我们快速上线网站首页。</li>
<li><strong>腾讯兔小巢</strong>：腾讯提供的免费专业的产品反馈平台，可以为我们的产品一键生成一个专属的反馈论坛，从而省去了自己搭建社区的麻烦。</li>
<li><strong>百度统计</strong>：超级好用的中文网站分析平台，支持网站、APP、小程序、线下零售等各种场景，轻松满足我们网站的数据自动采集、统计和分析需求。</li>
<li><strong>One Nav</strong>：基于开源的 Web Stack 开发，提供了多引擎搜索、新闻、热榜等功能。</li>
<li><strong>Discuz</strong>：兼容 PC 端、移动端、微信生态的开源社区软件，无需开发即可拥有包括文章、视频、评论、点赞、关注、知识付费等的个人社区。</li>
<li><strong>编程主页</strong>：鱼皮开发的程序员精简主页，感兴趣的同学可以把代码拷到本地修改。</li>
<li><strong>后台管理</strong>：vue-element-admin 、react-admin 、go-admin 等都是开箱即用的模版，能省去重复搭建管理后台的麻烦。</li>
</ul>
</li>
</ul>
<h1 id="二、页面渲染"><a href="#二、页面渲染" class="headerlink" title="二、页面渲染"></a>二、页面渲染</h1><ul>
<li>架构选择前一定要考虑到客户端和服务器的环境差异，站在更高层面考虑。客户端是上网时使用的手机、电脑等机器，而服务器是性能较强大的机器，可保持长时间运行并保证可随时访问服务器上文件。</li>
<li>对于需要做 <strong>SEO</strong> 的项目，如果是一个后台应用，则只要首页做一些静态内容宣导即可。如果是内容型网站，那么可以考虑专门做一些页面给搜索引擎。</li>
<li>对于<strong>前端渲染首屏</strong>问题，我们可以采用分拆打包 (路由库)、交互优化 (加载动画)、部分同构 (使用同构把菜单和页面骨架渲染出来) 等一些方式合理利用同构。</li>
</ul>
<h2 id="客户端渲染"><a href="#客户端渲染" class="headerlink" title="客户端渲染"></a>客户端渲染</h2><ul>
<li><strong>实现原理</strong>：浏览器异步请求服务器获取数据、浏览器拼接数据和模板文件，将拼接好的 HTML 字符串直接解析并渲染到页面。</li>
<li><strong>优势</strong>：前后端分离设计，浏览器负责页面逻辑和渲染，服务器只需要提供接口而减少了服务器的压力。按需加载模式有更好的用户体验，传统模式通过服务器加载新页面。</li>
<li><strong>问题</strong>：SEO 只会从 HTML 中抓取数据而导致前端页面无法被抓取。用户首次加载页面时需要下载框架和应用程序的代码后再渲染页面，页面加载时间较长而可能导致白屏问题。</li>
</ul>
<h2 id="预渲染"><a href="#预渲染" class="headerlink" title="预渲染"></a>预渲染</h2><ul>
<li><strong>实现原理</strong>：构建阶段简单生成匹配特定路由的静态 html，用来改善少数营销页面的 SEO 而无需使用 web 服务器实时动态编译 HTML。</li>
<li><strong>优缺点</strong>：设置简单，并且可以将前端页面作为一个完全静态的站点。但是搜索引擎不能抓取到 网页内容和结构，而且不能插入动态数据。</li>
</ul>
<h2 id="服务端渲染"><a href="#服务端渲染" class="headerlink" title="服务端渲染"></a>服务端渲染</h2><ul>
<li><strong>实现原理</strong>：ASP、Java、PHP 等传统渲染机制，浏览器将服务端拼接生成的 html 字符串只是进行解析和渲染。</li>
<li><strong>优点</strong>：更好的 SEO 而使搜索引擎爬虫可以抓取渲染好的页面、更少的客户端电量消耗、更快的内容到达时间 (服务端返回渲染好的 HTML)。</li>
<li><strong>缺点</strong>：不利于前后端分离而开发效率低、更多的服务器端负载 (CPU 和内存资源)、更复杂的开发和部署 (兼容 Node 执行环境)。</li>
</ul>
<h2 id="同构渲染"><a href="#同构渲染" class="headerlink" title="同构渲染"></a>同构渲染</h2><ul>
<li><strong>实现原理</strong>：同构是指代码程序在服务器和客户端都可以运行 (兼容 Node.js)，浏览器将服务端拼接生成的 html 字符串插入到指定节点后渲染页面。</li>
<li><strong>优点</strong>：提高首屏渲染性能而避免白屏问题、对搜索引擎友好而有助于 SEO、前后端共用一套 Node.js 代码而节省开发时间。</li>
<li><strong>缺点</strong>：内存溢出、异步操作、大量计算和个性化缓存等性能、服务器端和浏览器的环境差异、复杂类型无法转义为字符串形式发送给前端。</li>
</ul>
<h1 id="三、浏览器渲染"><a href="#三、浏览器渲染" class="headerlink" title="三、浏览器渲染"></a>三、浏览器渲染</h1><blockquote>
<p>浏览器是 Html 解析和展示页面的工具，主要功能是将用户选择的 web 资源呈现出来。它需要从服务器请求资源并将其显示在浏览器窗口中，资源格式一般有 HTML、PDF、image 等。渲染引擎是用户直接相关并呈现用户所需页面的组成部分。</p>
</blockquote>
<h2 id="分层结构"><a href="#分层结构" class="headerlink" title="分层结构"></a>分层结构</h2><blockquote>
<p>浏览器的抽象分层结构图如下：</p>
</blockquote>
<ul>
<li><strong>用户界面</strong>：用于和用户进行交互的功能组件，如地址栏、返回、前进按钮等。</li>
<li><strong>浏览器引擎</strong>：用于查询和操作渲染引擎的界面。</li>
<li><strong>渲染引擎</strong>：负责显示请求的内容，如果请求 HTML 则它解析 HTML、CSS 并显示。</li>
<li><strong>网络</strong>：负责处理网络相关的事务，如 HTTP 请求等。</li>
<li><strong>UI 后端</strong>：负责绘制提示框等浏览器组件，底层使用操作系统的用户接口。</li>
<li><strong>Js 解释器</strong>：负责解析和执行 JavaScript 代码。</li>
<li><strong>数据存储</strong>：负责持久存储 cookie 和缓存等应用数据。</li>
</ul>
  <div align="center">
    <img src="/images/web/browserCom.png" alt="浏览器结构" width="100%">
  </div>


<h2 id="多进程机制"><a href="#多进程机制" class="headerlink" title="多进程机制"></a>多进程机制</h2><blockquote>
<p>浏览器是多进程的，每打开一个 Tab 页就相当于创建了一个独立的进程，单进程的话则会存在一个页面崩溃而影响整个浏览器。浏览器由于系统给它的进程分配了内存等资源而可以运行，当前进程里并发运行的线程会共享有限的内存地址空间。</p>
</blockquote>
<ul>
<li>进程和线程<ul>
<li><strong>CPU</strong>：工厂，是执行计算任务的计算机核心。</li>
<li><strong>进程</strong>：工厂车间，是资源分配和独立运行的 CPU 最小单位，用来完成一个任务。</li>
<li><strong>线程</strong>：车间工人，是可以独立运行的 CPU 最小单位，协同其它线程完成一个任务。</li>
</ul>
</li>
<li>模式类型<ul>
<li><strong>单线程</strong>：所有任务在主线程中排队执行。</li>
<li><strong>多线程</strong>：任务在各个线程中独立执行而互不影响，同一进程下的所有线程共享变量。</li>
<li><strong>多进程</strong>：多任务可以同时执行，各进程的变量互不影响，但消耗更多的内存等资源。</li>
<li><strong>协调机制</strong>：防止进程之间、线程之间产生冲突，允许进程之间、线程之间共享资源。</li>
</ul>
</li>
<li>多进程的优势<ul>
<li>多进程充分利用多核优势。</li>
<li>避免单个页面或插件崩溃而影响整个浏览器。</li>
<li>方便使用沙盒模型隔离插件等进程，提高浏览器稳定性。</li>
</ul>
</li>
<li>内部进程<ul>
<li><strong>Browser 进程</strong>：浏览器的主进程 (负责协调和主控)，只有一个。主要功能为绘制渲染进程的 Bitmap、浏览器界面的显示和操作、管理页面进程和网络资源。</li>
<li><strong>Render 进程</strong>：浏览器内核，内部是多线程的，默认每个 Tab 页面对应一个进程并互不影响。主要负责页面渲染、脚本执行、事件处理等。</li>
<li><strong>第三方插件进程</strong>：每种类型的插件对应一个进程。</li>
<li><strong>GPU 进程</strong>：用于 3D 绘制等，最多一个。</li>
</ul>
</li>
<li><strong>内核的多线程</strong>：为了防止出现同时修改元素属性和渲染界面时可能导致的渲染问题，浏览器设置 GUI 渲染线程和 JS 引擎线程为互斥关系，GUI 线程会在 JS 引擎执行时被挂起并保存到队列中等待执行，所以 JS 可能阻塞渲染。<ul>
<li><strong>GUI 渲染线程</strong>：负责渲染浏览器界面，解析 HTML、CSS 并构建 DOM、RenderObject 树等。当界面需要重绘或某种操作引发回流时就会执行。</li>
<li><strong>JS 引擎线程</strong>：即 JS 内核，负责解析执行 JS 脚本代码。一直通过事件循环机制查看并执行任务队列中的任务。</li>
<li><strong>事件触发线程</strong>：浏览器中用来控制事件循环的线程，该线程会将符合触发条件的事件添加到任务队列的队尾等待处理。</li>
<li><strong>定时触发器线程</strong>：setInterval、setTimeout 所在线程，用来在计时完毕后添加到事件队列中等待 JS 引擎空闲时执行。</li>
<li><strong>异步 http 请求线程</strong>：XMLHttpRequest 连接后是通过浏览器新开一个线程请求。当检测到状态变更时，如果设置了回调函数则异步线程就产生状态变更事件，将回调函数再放入事件队列中等待 Js 引擎执行。</li>
</ul>
</li>
<li><strong>内核和 Browser 的通信</strong><ul>
<li>1、Browser 进程收到用户请求，通过网络下载或本地加载获取页面内容。</li>
<li>2、Render 进程的接口收到 Browser 进程传递的请求后交给内部的 GUI 渲染线程执行并返回结果。渲染过程中可能存在：向 Browser 进程获取资源、需要 GPU 进程帮助渲染、JS 线程操作 DOM 导致回流并重绘。</li>
<li>3、Browser 进程接收到结果并将结果绘制出来。</li>
</ul>
</li>
</ul>
<h2 id="渲染机制"><a href="#渲染机制" class="headerlink" title="渲染机制"></a>渲染机制</h2><blockquote>
<p>即渲染引擎工作流，为了更好的用户体验，渲染引擎会尽可能早的将内容呈现到屏幕上，并不会等到所有 html 解析完成之后再去构建和布局 render tree。它是解析完一部分内容就显示一部分内容，同时可能还在网络下载其余内容。相关事件：DOM 树构建完成时触发 DOMContentLoaded 事件，页面加载完成时触发 load 事件。</p>
</blockquote>
<ol>
<li><strong>浏览器解析 url</strong><br>1. 用户输入 URL，浏览器解析后获取主机名和端口号。<br>2. 通过 DNS 查询将主机名转换成服务器 IP 的地址。<br>3. 浏览器建立一条与目标服务器的 TCP 连接（三次握手）。<br>4. 浏览器向服务器发送一条 HTTP 请求报文并获取服务器响应。<br>5. 浏览器关闭连接并重复请求至资源全部加载后，解析文档内容并渲染到页面。<br>6. 通过四次挥手关闭连接，解析结束。</li>
<li><strong>浏览器渲染</strong><br>1. 解析 HTML 标记并构建 DOM 树。<br>2. 解析 CSS 标记并构建 CSSOM 树。<br>3. 根据 DOM、CSSOM 构建渲染树，节点是包含颜色等属性的渲染对象。<br>4. 布局：根据渲染树进行布局，计算各个节点在页面的位置、大小等信息。<br>5. 绘制：调用渲染对象的 paint 方法，将它们的内容显示在屏幕并绘制基础组件。</li>
<li><strong>资源下载问题</strong><br>* 图片下载不会产生阻塞。<br>* css 下载时会阻塞渲染，但带有 media 属性除外：css 由单独的下载线程异步下载，加载时不会阻塞 DOM 树解析但会阻塞 render 树渲染。<br>* 遇到 script 标签时，DOM 构建停止直到 js 脚本下载并执行完毕，此时浏览器一般会下载其他资源但不会解析。如果 js 中有对 CSSOM 的操作，还会先确保 CSSOM 已经被下载并构建。</li>
<li><strong>重绘重排</strong><br>* 重绘：简单外观的改变而不会影响布局，比如 outline、visibility、color。<br>* 回流：布局或几何属性改变而重新计算布局，大部分都会会导致页面的重新渲染。<br>* 关系：重绘不一定会引发回流，回流必定会发生重绘，它们都会重新生成渲染树。</li>
</ol>
<h2 id="优化方案"><a href="#优化方案" class="headerlink" title="优化方案"></a>优化方案</h2><ul>
<li><strong>CSS</strong><ul>
<li>CSS 硬件加速。</li>
<li>避免使用 table 布局。</li>
<li>使用 transform 代替 top。</li>
<li>尽可能在 DOM 树的最末端改变 class。</li>
<li>避免使用 CSS 表达式，可能会引发回流。</li>
<li>避免设置多层内联样式，CSS 选择符从右往左匹配查找，避免节点层级过多。</li>
<li>使用 visibility 替换 display: none，前者引起重绘，后者引发回流。</li>
<li>将动画效果应用到 position: absolute&#x2F;fixed 的元素，避免影响其他布局。</li>
</ul>
</li>
<li><strong>Javascript</strong><ul>
<li>避免频繁操作样式，修改 class 最好。</li>
<li>避免频繁操作 DOM，合并多次修改为一次。</li>
<li>避免频繁读取会引发回流&#x2F;重绘的属性，将结果缓存。</li>
<li>对具有复杂动画的元素使用绝对定位，使它脱离文档流。</li>
</ul>
</li>
</ul>
<h1 id="四、JS-运行机制"><a href="#四、JS-运行机制" class="headerlink" title="四、JS 运行机制"></a>四、JS 运行机制</h1><h2 id="JS-引擎"><a href="#JS-引擎" class="headerlink" title="JS 引擎"></a>JS 引擎</h2><ul>
<li><strong>JS 引擎</strong>：能够读懂 JS 代码并能准确运行出结果的一段程序。</li>
<li><strong>V8 引擎</strong>：运行前将 JS 编译为本地的机器码并执行，主要用来提高性能。</li>
<li>对于 Java、C++、C 等静态语言处理上述事情的叫 <strong>编译器</strong>，而对于 JS 这样的动态语言则叫做 <strong>解释器</strong>。区别：编译器是将源代码编译为另外一种代码 (比如机器码或字节码)，解释器则是直接解析并将代码运行结果输出。</li>
</ul>
<h2 id="JS-线程"><a href="#JS-线程" class="headerlink" title="JS 线程"></a>JS 线程</h2><ul>
<li><strong>JS 单线程</strong>：同一时间只能执行一个任务而其他任务需要排队等待执行，这是因为 JS 用来和用户交互，而多线程同时操作可能会带来复杂的同步问题。浏览器中负责解释和执行代码的 JS 引擎线程称为<strong>主线程</strong>，处理耗时异步任务的其它线程称为<strong>工作线程</strong>。</li>
<li><strong>WebWorker</strong>：只属于某个页面而不会和其他页面的 Render 进程共享。Chrome Render 进程中可新建一个 Worker 线程。它是 HTML5 为了利用多核 CPU 的计算功能而允许 JS 脚本创建多个线程来处理耗时操作的新标准，但是 Worker 是 JS 引擎向浏览器申请开的子线程，它完全受主线程控制并且不能操作 DOM，所以并没有改变JS单线程的本质。</li>
<li><strong>SharedWorker</strong>：浏览器的所有页面共享。Chrome 可新建一个 SharedWorker 进程，但相同 JS 不论创建多少次也只会存在一个。</li>
</ul>
<h2 id="JS-任务"><a href="#JS-任务" class="headerlink" title="JS 任务"></a>JS 任务</h2><blockquote>
<p>所有同步任务都是在主线程上执行而形成一个执行栈，主线程解析异步操作后会将异步任务放到一个具有先进先出特点的任务队列，主线程将同步任务执行完之后会循环读取任务队列中的事件并放到执行栈执行 (这个过程叫事件循环)。</p>
</blockquote>
<ul>
<li><strong>同步任务</strong>：主线程的执行栈中排队执行的任务，类似银行排队办业务。</li>
<li><strong>异步任务</strong>：添加到任务列队中延迟执行的任务，类似餐厅点餐后等待。<ul>
<li><strong>宏任务</strong>：延时执行队列和普通消息队列等队列中的任务，主线程通过事件循环每次从队列中取出一个任务并执行，一个宏任务执行完之后会重新渲染页面。比如 script、setTimeout、setInterval、I&#x2F;O、UI render。</li>
<li><strong>微任务</strong>：宏任务中需要异步执行的所有任务，在主函数执行结束后和当前宏任务结束前全部执行，执行微任务过程中产生的微任务不会推迟到下个宏任务中执行。比如 Promise、async&#x2F;await、Object.observe、MutationObserver、process.nextTick。</li>
</ul>
</li>
<li><strong>常见异步任务</strong><ul>
<li><strong>onclick 等事件的销毁函数</strong>：当事件触发时，回调函数会被立即添加到任务队列中。由浏览器内核的 DOM Binding 模块处理。</li>
<li><strong>setInterval 等计时器</strong>：当定时器时间到，就把该事件放到 任务队列中 等待处理。由浏览器内核的 timer 模块进行延时处理。</li>
<li><strong>Ajax 请求</strong>：在网络请求完成返回之后，将回调函数添加到任务队列中。由浏览器内核的 network 模块处理。</li>
</ul>
</li>
</ul>
<h2 id="异步机制"><a href="#异步机制" class="headerlink" title="异步机制"></a>异步机制</h2><ol>
<li>JS 引擎线程首先将所有操作分为同步任务、异步宏任务、异步微任务，然后根据顺序依次执行：先同步任务后异步任务队列、先微任务后宏任务。</li>
<li>同步任务在主线程中会直接按顺序执行。异步任务则会被分发到任务队列，主线程空闲时读取队列任务，符合触发条件的会被分发到对应的工作线程执行并返回结果。</li>
<li>事件循环机制：主线程执行完所有同步任务之后空闲时，重复去任务队列中查看是否有可执行的异步任务，有则推入主进程的执行栈。<br>1. 执行一个宏任务（栈中没有就从事件队列中获取）。<br>2. 执行过程中如果遇到微任务，就将它添加到微任务的任务队列中。<br>3. 宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）。<br>4. 当前宏任务执行完毕，开始检查渲染，然后 GUI 线程接管渲染。<br>5. 渲染完毕后，JS 线程继续接管，开始下一个宏任务（从任务队列中获取）。</li>
</ol>
  <div align="center">
    <img src="/images/web/js-run.png" alt="执行机制" width="100%">
  </div>


  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 输出结果：1、7、6、8、2、4、3、5、9、11、10、12</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;6&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;7&#x27;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">    process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;10&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;11&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>第一轮事件循环</strong><br>* 整体 script 作为第一个宏任务进入主线程，执行 console.log 输出 1<br>* setTimeout，其回调函数被分发到宏任务队列，记为 setTimeout1<br>* process.nextTick()，其回调函数被分发到微任务队列，记为 process1<br>* Promise、new Promise 直接执行输出 7。then 被分发到微任务队列，记为 then1<br>* 第二个 setTimeout，其回调函数被分发到宏任务队列，记为 setTimeout2<br>* 执行两个微任务 process1、then1 输出 6、8<br>* 输出结果：1、7、6、8</li>
<li><strong>第二轮事件循环</strong><br>* 从宏任务 setTimeout1 开始，输出 2<br>* process.nextTick()，同样将其分发到微任务队列，记为 process2<br>* new Promise 立即执行输出 4，then 也分发到微任务队列，记为 then2<br>* 执行两个微任务 process2、then2 输出 3、5<br>* 输出结果：2、4、3、5</li>
<li><strong>第三轮事件循环</strong><br>* 此时只剩下 setTimeout2，执行输出 9<br>* process.nextTick() 分发到微任务队列，记为 process3<br>* new Promise 直接执行输出 11，then 分发到微任务队列，记为 then3<br>* 执行两个微任务 process3、then3 输出 10、12<br>* 输出结果：9、11、10、12</li>
</ol>
<h1 id="五、项目开发规范"><a href="#五、项目开发规范" class="headerlink" title="五、项目开发规范"></a>五、项目开发规范</h1><h2 id="代码规范工具"><a href="#代码规范工具" class="headerlink" title="代码规范工具"></a>代码规范工具</h2><blockquote>
<p>EditorConfig 统一编辑器风格 (写代码前起作用)、Prettier 统一项目风格 (保存代码后起作用)，ESlint 实时检查代码。具体使用时可以体验区别：editorConfig、prettiter 空格分别设置为 4、2，则代码编辑时回车为 4 格，保存后变成 2 格。</p>
</blockquote>
<ul>
<li><strong>EditorConfig</strong>：用于实现跨编辑器开发项目时保持一致的代码风格。编辑器插件和项目根目录配置文件为 <code>EditorConfig for VS Code、.editorconfig</code>。</li>
<li><strong>Prettier</strong>：用于格式化文件而统一项目的代码风格。可以通过执行命令来批量格式化文件、也可以通过配置编辑器实现文件保存时自动格式化。插件和配置文件为 <code>Prettier-Code formatter、.prettierrc</code>。</li>
<li><strong>ESlint</strong>：js 代码静态分析工具，用于实时检查编写代码，并提供错误提示和自动修复功能。插件和配置文件为 <code>ESlint、.eslintrc</code>。</li>
<li><strong>StyleLint</strong>：css 代码静态分析工具。插件和配置文件为 <code>StyleLint、.stylelintrc</code></li>
<li><strong>lint</strong>：package.json scripts 增加配置来实现执行命令校验。缓存区代码一般需要校验。</li>
</ul>
  <figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .editorconfig</span></span><br><span class="line"><span class="attr">root</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[*]</span></span><br><span class="line"><span class="attr">charset</span> = utf-<span class="number">8</span></span><br><span class="line"><span class="attr">indent_style</span> = space</span><br><span class="line"><span class="attr">indent_size</span> = <span class="number">2</span>                     <span class="comment"># 缩紧大小</span></span><br><span class="line"><span class="attr">charset</span> = utf-<span class="number">8</span>                     <span class="comment"># 编码格式</span></span><br><span class="line"><span class="attr">end_of_line</span> = lf                    <span class="comment"># 换行符格式</span></span><br><span class="line"><span class="attr">insert_final_newline</span> = <span class="literal">true</span>         <span class="comment"># 是否在文件最后插入一个空行</span></span><br><span class="line"><span class="attr">trim_trailing_whitespace</span> = <span class="literal">true</span>     <span class="comment"># 是否删除行尾的空格</span></span><br><span class="line"></span><br><span class="line"><span class="section">[*.md]</span></span><br><span class="line"><span class="attr">max_line_length</span> = <span class="number">0</span>                 <span class="comment"># 强制在指定字符数之后换行</span></span><br><span class="line"><span class="attr">trim_trailing_whitespace</span> = <span class="literal">false</span>    <span class="comment"># md 会用尾空格表示换行，不自动移除</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span> .prettierrc：npm install prettier -D</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;trailingComma&quot;</span>: <span class="string">&quot;all&quot;</span>,           <span class="regexp">//</span> 对象的最后一个属性末尾也添加 ,</span><br><span class="line">  <span class="string">&quot;tabWidth&quot;</span>: <span class="number">2</span>,                    <span class="regexp">//</span> 缩进大小</span><br><span class="line">  <span class="string">&quot;semi&quot;</span>: false,                    <span class="regexp">//</span> 分号是否添加</span><br><span class="line">  <span class="string">&quot;singleQuote&quot;</span>: true,              <span class="regexp">//</span> 是否单引号</span><br><span class="line">  <span class="string">&quot;jsxSingleQuote&quot;</span>: true,           <span class="regexp">//</span> jsx 语法下是否单引号</span><br><span class="line">  <span class="string">&quot;endOfLine&quot;</span>: <span class="string">&quot;lf&quot;</span>,                <span class="regexp">//</span> 与 .editorconfig 保持一致设置</span><br><span class="line">  <span class="string">&quot;printWidth&quot;</span>: <span class="number">120</span>,                <span class="regexp">//</span> 单行代码最长字符长度，超过则换行</span><br><span class="line">  <span class="string">&quot;bracketSpacing&quot;</span>: true,           <span class="regexp">//</span> 对象中的括号之间打印空格</span><br><span class="line">  <span class="string">&quot;arrowParens&quot;</span>: <span class="string">&quot;always&quot;</span>           <span class="regexp">//</span> 箭头函数的参数都用括号包裹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.js：npm install eslint eslint-config-prettier -D</span></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  env: &#123; browser: <span class="literal">true</span>, es2020: <span class="literal">true</span>, node: <span class="literal">true</span> &#125;,</span><br><span class="line">  extends: [                     <span class="comment">// 下载插件的预设规则</span></span><br><span class="line">    <span class="string">&#x27;airbnb&#x27;</span></span><br><span class="line">    <span class="string">&#x27;prettier&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prettier/@typescript-eslint&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prettier/react&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prettier/unicorn&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;plugin:react/recommended&#x27;</span>, </span><br><span class="line">  ],  </span><br><span class="line">  parser: <span class="string">&#x27;@typescript-eslint/parser&#x27;</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaFeatures: &#123; jsx: <span class="literal">true</span> &#125;,</span><br><span class="line">    ecmaVersion: <span class="number">11</span>,</span><br><span class="line">    sourceType: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  settings: &#123;</span><br><span class="line">    <span class="string">&#x27;import/resolver&#x27;</span>: &#123;     <span class="comment">// .ts、.tsx 文件互相引用时不报错</span></span><br><span class="line">      node: &#123; extensions: [<span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="string">&#x27;react&#x27;</span>, <span class="string">&#x27;@typescript-eslint&#x27;</span>],   <span class="comment">// npm 安装后才能使用的插件</span></span><br><span class="line">  rules: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// .stylelintrc.js</span></span><br><span class="line"> <span class="comment">// npm i stylelint stylelint-config-standard stylelint-config-prettier -D</span></span><br><span class="line"> module.exports = &#123;</span><br><span class="line">   <span class="keyword">extends</span>: [<span class="string">&#x27;stylelint-config-standard&#x27;</span>, <span class="string">&#x27;stylelint-config-prettier&#x27;</span>],</span><br><span class="line">   rules: &#123;</span><br><span class="line">     <span class="string">&#x27;comment-empty-line-before&#x27;</span>: <span class="keyword">null</span>,</span><br><span class="line">     <span class="string">&#x27;declaration-empty-line-before&#x27;</span>: <span class="keyword">null</span>,</span><br><span class="line">     <span class="string">&#x27;function-name-case&#x27;</span>: <span class="string">&#x27;lower&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;no-descending-specificity&#x27;</span>: <span class="keyword">null</span>,</span><br><span class="line">     <span class="string">&#x27;no-invalid-double-slash-comments&#x27;</span>: <span class="keyword">null</span>,</span><br><span class="line">     <span class="string">&#x27;rule-empty-line-before&#x27;</span>: <span class="string">&#x27;always&#x27;</span>,</span><br><span class="line">   &#125;,</span><br><span class="line">   ignoreFiles: [<span class="string">&#x27;node_modules/**/*&#x27;</span>, <span class="string">&#x27;build/**/*&#x27;</span>],</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// package.json：npm run lint-eslint 就会去检测 src 目录下文件</span></span><br><span class="line">scripts: &#123;</span><br><span class="line">   <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;npm run lint-eslint &amp;&amp; npm run lint-stylelint&quot;</span>,</span><br><span class="line">   <span class="string">&quot;lint-eslint&quot;</span>: <span class="string">&quot;eslint -c .eslintrc.js --ext .ts,.tsx,.js src&quot;</span>,</span><br><span class="line">   <span class="string">&quot;lint-stylelint&quot;</span>: <span class="string">&quot;stylelint --config .stylelintrc.js src/**/*.&#123;css,scss&#125;&quot;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


<h2 id="BEM-命名规范"><a href="#BEM-命名规范" class="headerlink" title="BEM 命名规范"></a>BEM 命名规范</h2><blockquote>
<p><strong>块 block、元素 element、修饰符 modifier</strong>，是由俄罗斯搜索引擎团队 Yandex 提出的一种 css 命名方案。主要用于团队开发的大型项目统一类名规范，<strong>主要特点有</strong>：减少了命名冲突的可能性、增强了语义化 (包含模块路径和状态等信息)、提高了可复用性 (scss 等编写代码方便)、提升了 css 性能 (一类元素对应一个类名，减少了后代选择器的使用)。</p>
</blockquote>
  <figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BEM 命名约定</span></span><br><span class="line"><span class="selector-class">.block</span> &#123; &#125;              <span class="comment">// 模块类名</span></span><br><span class="line"><span class="selector-class">.block</span>**element &#123; &#125;     <span class="comment">// 模块中的元素类名</span></span><br><span class="line"><span class="selector-class">.block--modifier</span> &#123; &#125;    <span class="comment">// 不同状态、版本的模块类名</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.c-row-age</span> &#123; &#125;          <span class="comment">// components/RowAge/index.js</span></span><br><span class="line"><span class="selector-class">.cc-addable-block</span> &#123; &#125;   <span class="comment">// components/common/AddableBlock/index.js</span></span><br><span class="line"><span class="selector-class">.cc-addable-block--disabled</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Element UI 命名</span></span><br><span class="line"><span class="selector-class">.el-input</span>,</span><br><span class="line"><span class="selector-class">.el-input</span>**inner &#123;  </span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.el-input</span><span class="selector-class">.is-focus</span> <span class="selector-class">.el-input</span>**inner &#123;  </span><br><span class="line">    <span class="attribute">border-color</span>: <span class="variable">$--input-focus-border</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.el-input</span>**<span class="attribute">icon</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.el-pagination--small</span> &#123;  </span><br><span class="line">    <span class="selector-class">.btn-prev</span>,  </span><br><span class="line">    <span class="selector-class">.btn-next</span>,  </span><br><span class="line">    <span class="selector-class">.el-pager</span> <span class="selector-tag">li</span> &#123;    </span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">3px</span>;   </span><br><span class="line">        <span class="attribute">min-width</span>: <span class="number">22px</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="CSS-书写规范"><a href="#CSS-书写规范" class="headerlink" title="CSS 书写规范"></a>CSS 书写规范</h2><ul>
<li><strong>属性顺序</strong><ul>
<li>位置：position、top、z-index、display、float</li>
<li>大小：width、height、padding、margin</li>
<li>文字：font、color、line-height、text-align</li>
<li>背景：background、border</li>
<li>其他：animation、transition</li>
</ul>
</li>
<li><strong>选择器命名</strong><ul>
<li>长名称或词组可以使用中横线 (.is-active)</li>
<li>不建议使用下划线 (JS 变量命名是用_)</li>
<li>尽量使用语义化、小写的英文单词</li>
</ul>
</li>
<li><strong>常用命名</strong><ul>
<li>样式文件：base.css、master.css、module.css、layout.css</li>
<li>结构：container、header、content、main、footer、column、wrapper</li>
<li>导航：nav、mainnav、topnav、sidebar、menu、submenu、title、summary</li>
<li>功能：logo、banner、login、loginbar、register、search、shop、title、status、btn、scroll、tab、list、tips、icon、note、guild、service</li>
</ul>
</li>
</ul>
<p>  　　</p>
<h2 id="Restful-接口"><a href="#Restful-接口" class="headerlink" title="Restful 接口"></a>Restful 接口</h2><blockquote>
<p>Restful 是一种架构风格的规范和约束而并非标准，基于它设计的软件可以更简洁、更有层次、更容易实现缓存等机制，常用于客户端和服务器交互类的软件。</p>
</blockquote>
<ul>
<li>常用架构<ul>
<li><strong>RESTful 架构</strong>：面向资源的架构，即针对资源设计接口。客户端操作通过资源对应的 URL 进行操作，从而访问服务器端资源。</li>
<li><strong>SOA 架构</strong>：面向服务的体系结构。SOA 将不同的功能组件视为一种服务并分别封装，降低了组件之间的耦合程度，增加了代码的复用程度。</li>
</ul>
</li>
<li>主要特点<ul>
<li><strong>资源</strong>；资源的标识，比如 html、jpg、json。</li>
<li><strong>URI</strong>：统一资源定位符，即每个 URI 对应一个具体的特定资源。</li>
<li><strong>无状态</strong>：所有资源都可以通过 URI 去定位，而不与其他资源产生耦合。</li>
<li><strong>统一接口</strong>：数据元操作 CURD 分别对应 http 的 get、post、put、delete。</li>
</ul>
</li>
<li>URI<ul>
<li>URL：是统一资源标识符而对应具体的资源地址，是属于 URI 的一部分。</li>
<li>版本：API 的版本号应该放入到 URI，比如 &#x2F;api.example.com&#x2F;v1&#x2F;zoos。</li>
<li><strong>规范</strong>：不用大写、用中杠不用下杠、参数列表要 encode、资源集合时使用复数形式如 zoos&#x2F;1&#x2F;animals、网址中一般只能有名词并对应数据库的表格名。</li>
<li><strong>通信</strong>：前后端统一使用 json 数据、客户端通过 url <code>？&amp; ,</code> 实现过滤、搜索等复杂操作、客户端 http 方法 (get&#x2F;post&#x2F;put&#x2F;delete) 对应服务器端数据元操作 (select&#x2F;create&#x2F;update&#x2F;delete)。</li>
</ul>
</li>
</ul>
<h2 id="框架选择"><a href="#框架选择" class="headerlink" title="框架选择"></a>框架选择</h2><ul>
<li>框架和库<ul>
<li><strong>类库</strong>：一个有组织的功能集合，用于提供特定功能的接口并被调用。</li>
<li><strong>框架</strong>：构建应用程序的整体架构，使开发者可以专注于逻辑处理而提高开发效率。。</li>
<li>联系：框架一般会集成大量库并在合适地方调用，有时称为库，区别在于思考角度。常用库 Echarts&#x2F;ElementUI、常用框架 Vue&#x2F;React&#x2F;AngularJS。</li>
</ul>
</li>
<li>框架发展<ul>
<li>*<em>完整应用程序的 MV</em> 框架 (Angular)**：Node&#x2F;Npm 尝试编译 JS 代码，AMD&#x2F;CommonJS 定义 JS 模块，Gulp&#x2F;Grunt 等构建工具将模块组合成一个应用，路由和模板等语法则降低了开发难度并提高了和用户体验。</li>
<li><strong>基于组件的 Vue、React</strong>：基于组件的应用程序消除了很多抽象概念并简化了代码的生命周期，一切都与组件而不是应用程序的生命周期联系在一起，这意味着框架可以专注于解决渲染问题，路由、通信和状态管理则交给开发人员自己配置。这个时代 JS 生态系统的发展主要有 SPA 单页面、SSR 渲染优化、Babel 转译器、ES 模块化、API 标准化，但是也存在状态管理、响应性、SPA 性能等问题。</li>
<li><strong>融合前后端的全栈式框架</strong>：Next.js (React)、Nuxt.js (Vue)、Remix (React)、SvelteKit (Svelte)、Gatsby (React)、Astro (Any)，这些元框架随着视图层的成熟而开始标准化路由器、构建系统等。随着服务器端和客户端的 JS 标准越来越接近，前后端代码也可能实现同构而解决渲染性能、请求代理等问题。</li>
</ul>
</li>
</ul>
<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2>  <div align="center"> 
    <img src="/images/mobile/optimization.png" alt="移动端优化" width="100%">
  </div>


<h1 id="六、网站安全规范"><a href="#六、网站安全规范" class="headerlink" title="六、网站安全规范"></a>六、网站安全规范</h1><ul>
<li>该用验证码的时候一定要添上。</li>
<li>谨慎用户输入信息，进行输入检查（客户端和服务端同时检查）。</li>
<li>在变量输出到 HTML 页面时，都应该进行编码或转义来预防XSS攻击。</li>
<li>尽量在重要请求上添加 Token 参数，注意 Token 要用足够安全的随机数生成算法。</li>
</ul>
<h2 id="XSS-跨站脚本攻击"><a href="#XSS-跨站脚本攻击" class="headerlink" title="XSS 跨站脚本攻击"></a>XSS 跨站脚本攻击</h2><blockquote>
<p>指黑客通过 “HTML 注入” 篡改了网页，插入了恶意的脚本（主要是 JS 脚本），从而在用户浏览网页时控制用户浏览器的一种攻击。常见的有 挂马、盗取用户 Cookie、钓鱼攻击、删除目标文章或恶意篡改数据、劫持用户 Web 行为甚至渗透内网、爆发 Web2.0 蠕虫、蠕虫式挂马攻击(刷广告&#x2F;刷浏量&#x2F;破坏网上数据)。</p>
</blockquote>
<ul>
<li><strong>常见类型</strong><ul>
<li><strong>反射型 XSS</strong>：即 HTML 注入、非持久型 XSS。把用户输入的数据反射给浏览器，即黑客往往需要诱使用户点击一个恶意链接后将用户输入的隐私数据拼接出 html 并执行恶意 js 脚本，这个过程像是<strong>一次反射</strong>。</li>
<li><strong>存储型 XSS</strong>：持久型 XSS，它会将用户输入的数据存储在攻击方的服务器，具有很强的<strong>稳定性</strong>，比如黑客写了一篇包含恶意 JS 脚本的博客文章并保存到服务端。</li>
<li><strong>DOM based XSS</strong>：效果同反射型 XSS，但是它是通过修改页面的<strong>DOM 节点</strong>形成的。比如通过修改 DOM 绑定方法来获取用户信息。</li>
</ul>
</li>
<li><strong>检测 XSS</strong><ul>
<li><strong>检测方式</strong>：用户可以在有关键字输入搜索的地方输入********后点击搜索，若弹框出现展示123，说明存在XSS漏洞，这说明前端并没有对用户输入的内容过滤处理。</li>
</ul>
</li>
<li><strong>XSS 攻击方式</strong><ul>
<li><strong>Cookie 劫持</strong>：通过伪装一些图片和按钮等诱使用户对其操作，使网页执行了攻击者的恶意脚本，使攻击者能够获取当前用户的Cookie信息。</li>
<li><strong>构造 GET&#x2F;POST 请求</strong>：若攻击者想删除某网站的一篇文章，首先获取文章 id，然后通过脚本插入图片发送一个 GET&#x2F;POST 请求。</li>
<li><strong>XSS 钓鱼</strong>：在对方不知情的情况下诱骗用户并得到对方的姓名、年龄、邮箱账号、甚至是银行卡密码等私人信息。比如某用户在已被攻击的某网站上操作黑客伪造的一个登录框输入个人信息，用户信息就会被上传到黑客的服务器上。</li>
<li><strong>获取用户真实 IP</strong>：通过第三方软件获取，比如客户端安装了 Java 环境 (JRE)，则可通过调用<code>Java Applet</code>的接口获取客户端本地的 IP 地址。</li>
</ul>
</li>
<li><strong>XSS 防御方式</strong><ul>
<li><strong>HttpOnly</strong>：浏览器禁止页面 JS 访问带有 HttpOnly 属性的 cookie，可解决 cookie 劫持问题。<code>response.setHeader(&quot;Set-Cookie&quot;,&quot;cookiename=value; Path=/;Domain=domainvalue;Max-Age=seconds;HTTPOnly&quot;)</code>。</li>
<li><strong>输入检查</strong>：检查是否包含 JavaScript、script 等敏感字符并将特殊字符转义处理，让一些基于特殊字符的攻击失效。现在的普遍做法是前后端都做输入检查，因为客户端的检查很容易被攻击者绕过。</li>
<li><strong>输出检查</strong>：在变量输出到 HTML 页面时，除了富文本外都使用编码或转义的方式。</li>
<li><strong>更严格的做法</strong>：除了数字和字母外的所有字符，都使用十六进制的方式进行编码。</li>
</ul>
</li>
</ul>
<h2 id="CSRF-跨站点请求伪造"><a href="#CSRF-跨站点请求伪造" class="headerlink" title="CSRF 跨站点请求伪造"></a>CSRF 跨站点请求伪造</h2><blockquote>
<p>指利用用户身份操作用户账户的一种攻击方式，即攻击者诱使用户访问一个第三方有害页面执行操作并获取用户信息，然后攻击者使用这个伪造的真实身份到某网站执行恶意操作。但是攻击者只有预测到 URL 的所有参数和参数值，才能成功地伪造一个请求 (他可以在安全站点里以自己的身份实际操作一下拿到参数)，反之则无法攻击成功。</p>
</blockquote>
<ul>
<li><strong>攻击方式</strong><ul>
<li><strong>浏览器 Cookie</strong>：Session Cookie (关闭失效)、Third-party Cookie (过期失效)。</li>
<li><strong>P3P Header 副作用</strong>：P3P Header 是 W3C 制定的隐私偏好平台，如果网站返回给浏览器的 HTTP 头包含，则表示允许浏览器发送第三方 Cookie，主要应用在广告等需要跨域访问的页面。</li>
<li><strong>GET&#x2F;POST 请求</strong>：通过 img&#x2F;iframe&#x2F;script 等带有 src 的标签发送 GET 请求，通过一个用户不可见的 iframe 窗口构造一个 form 表单发送 POST 请求。</li>
</ul>
</li>
<li><strong>防御方式</strong><ul>
<li><strong>验证码</strong>：CSRF 攻击过程中会在用户在不知情的情况下构造了网络请求，添加验证码后则强制用户必须与应用进行交互。缺点是网站不能给所有的操作都加上验证码。</li>
<li><strong>Referer Check</strong>：添加一个拦截器通过检查 HTTP 头中的 Referer 来判断请求来源是否合法。缺点是很多网站为了保护用户隐私而限制了 Referer 的发送、浏览器从 HTTPS 跳转到 HTTP 时出于安全考虑而不会发送 Referer。</li>
<li><strong>Anti CSRF Token</strong>：将参数加密或使用 Token 随机数，从而让攻击者无法猜测到参数值，也就无法构造请求的 URL 从而发起 CSRF 攻击。比如新增参数 Token <code>http://host/path/delete?username=abc&amp;item=123&amp;token=[random(seed)]</code>。优点是比检查 Referer 更安全并且不涉及用户隐私，缺点是 token 时需要所有请求都添加，加密时则使 URL 可读性变差、加密参数导致用户无法对页面进行搜索并给 DBA 工作带来困扰 (数据分析常需要用到参数的明文)。</li>
<li><strong>XSRF</strong>：当网站同时存在 XSS、CSRF 漏洞时，攻击者可以模拟客户端执行任意操作并在请求页面后读取页面内容的 Token 值，然后再构造出一个合法请求。</li>
</ul>
</li>
</ul>
<h2 id="ClickJacking-点击劫持"><a href="#ClickJacking-点击劫持" class="headerlink" title="ClickJacking 点击劫持"></a>ClickJacking 点击劫持</h2><blockquote>
<p>一种视觉上的欺骗手段。攻击者使用一个透明的、不可见的 iframe 覆盖在一个网页上，然后诱使不知情的用户在网页上进行点击。比如在访问某网页时点击空白区域，浏览器却意外打开了新葡京赌场的页面。防御方式如下：</p>
</blockquote>
<ul>
<li><strong>_X-Frame-Options HTTP 响应头</strong>：用来给浏览器指示一个页面能否在 frame&#x2F;iframe&#x2F;object 标签中展现的标记。它有三个可选的值：DENY (拒绝加载)、SAMEORIGIN (允许加载同源页面)、ALLOW-FROM (允许加载指定来源的页面)。</li>
<li><strong>禁止iframe的嵌套</strong>：<code>if(window.top.location !== window.loaction)&#123;window.top.location === window.self.location&#125;</code>。</li>
</ul>
<h2 id="其他安全问题"><a href="#其他安全问题" class="headerlink" title="其他安全问题"></a>其他安全问题</h2><ul>
<li><strong>跨域问题处理</strong>：当服务端设置 ‘Access-Control-Allow-Origin’ 时使用了通配符 “*”，允许来自任意域的跨域请求，这是极其危险的。</li>
<li><strong>postMessage 跨窗口传递信息</strong>：postMessage 允许每一个 window（包括当前窗口、弹出窗口、iframes等）对象往其它窗口发送文本消息，从而实现跨窗口的消息传递并且不受同源策略限制。必要时在接受窗口对接口的信息进行安全检查 (验证 Domain、URL)，以防止来自非法页面的消息，实际上是实现一次同源策略的验证过程。</li>
<li><strong>Web Storage</strong>：分为 Session Storage、Local Storage。虽然受同源策略的约束，但当存有敏感信息时也可能会成为攻击目标。</li>
</ul>
]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo + Github 搭建个人博客</title>
    <url>/2019/02/09/1-hexo%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h1 id="一、博客搭建"><a href="#一、博客搭建" class="headerlink" title="一、博客搭建"></a>一、博客搭建</h1><h2 id="安装-Node-js-和-Git"><a href="#安装-Node-js-和-Git" class="headerlink" title="安装 Node.js 和 Git"></a>安装 Node.js 和 Git</h2><blockquote>
<p>Git安装后可以创建 <code>ssh key</code> 并添加到 GitHub上, 这样配置之后就不再需要每次更新博客时都输入用户名和密码了</p>
</blockquote>
<h2 id="安装hexo博客框架"><a href="#安装hexo博客框架" class="headerlink" title="安装hexo博客框架"></a>安装hexo博客框架</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cnpm install -g hexo-cli    <span class="comment">// window安装</span></span><br><span class="line">sudo cnpm install -g hexo   <span class="comment">// mac安装</span></span><br><span class="line"></span><br><span class="line">cd blog            <span class="comment">//在新建的blog文件夹打开终端</span></span><br><span class="line">hexo init          <span class="comment">// 初始化</span></span><br><span class="line"></span><br><span class="line">hexo install       <span class="comment">// window安装依赖</span></span><br><span class="line">sudo npm install   <span class="comment">// mac安装依赖</span></span><br></pre></td></tr></table></figure>


<h2 id="测试本地运行（线下访问）"><a href="#测试本地运行（线下访问）" class="headerlink" title="测试本地运行（线下访问）"></a>测试本地运行（线下访问）</h2>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">hexo g     <span class="comment">// 生成静态文件, 即 hexo generate</span></span><br><span class="line"></span><br><span class="line">hexo s     <span class="comment">// 启动本地服务器, 即 hexo server</span></span><br></pre></td></tr></table></figure>

<h2 id="部署到云服务器（线上访问）"><a href="#部署到云服务器（线上访问）" class="headerlink" title="部署到云服务器（线上访问）"></a>部署到云服务器（线上访问）</h2><blockquote>
<p>Github 是外国网站且禁止百度爬虫访问，所以会导致百度搜不到你的网站。可以做两手准备：国内采用Coding托管，国外采用GitHub托管，建议两者的用户名和密码保持一致  </p>
</blockquote>
<h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><ol>
<li>新建项目<br> GitHub：<code>username.github.io</code><br> Coding：<a href="https://coding.net/">https://coding.net/</a></li>
<li>配置 SSH<br>* 检查：<code>cd ~/.ssh</code><br>* 生成：<code>ssh-keygen -t rsa -C &quot;17621538916@163.com&quot;</code><br>* 输入密码并回车<br>* 查看公钥：<code>cat ~/.ssh/id_rsa.pub</code> </li>
<li>添加公钥</li>
<li>基础配置<br>* 用户名：<code>git config --global user.name &quot;chuanggefighting&quot;</code><br>* 邮箱：<code>git config --global user.email &quot;17621538916@163.com&quot;</code> </li>
<li>测试连接：<code>ssh -T git@github.com、ssh -T git@git.coding.net</code></li>
<li>开启 Pages 服务</li>
</ol>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><blockquote>
<p>码云是国内的，访问速度较快，但是每次更新版本后需要手动部署</p>
</blockquote>
  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> </span><br><span class="line">    <span class="attr">github:</span> <span class="string">https://github.com/chuanggefighting/chuanggefighting.github.io.git</span></span><br><span class="line">    <span class="comment"># coding: https://git.coding.net/chuanggefighting/chuanggefighting.coding.me.git     # Coding</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">https://gitee.com/chuangges/chuangges.git</span>     <span class="comment"># 码云</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>


<h3 id="上传到服务器"><a href="#上传到服务器" class="headerlink" title="上传到服务器"></a>上传到服务器</h3>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cnpm install hexo-deployer-git --save  <span class="comment">// 安装git部署插件</span></span><br><span class="line"></span><br><span class="line">hexo clean              <span class="comment">// 清除缓存</span></span><br><span class="line">hexo n post             <span class="comment">// 新建文章，即 hexo new post </span></span><br><span class="line">hexo g                  <span class="comment">// 编译博文生成静态文件, 即 hexo generate</span></span><br><span class="line">hexo d                  <span class="comment">// 部署到github, 即 hexo deploy</span></span><br><span class="line">hexo hexo g -d          <span class="comment">// 简化命令, 部署前生成静态文件</span></span><br></pre></td></tr></table></figure>



<h2 id="创建新页面"><a href="#创建新页面" class="headerlink" title="创建新页面"></a>创建新页面</h2><ol>
<li><p><strong>增加关于页</strong><br>1. 取消 about 前面的 #<br>2. hexo new page about<br>3. blog&#x2F;sources&#x2F;about&#x2F;index.md：自定义内容</p>
</li>
<li><p><strong>增加标签页</strong><br>1. 首先取消 next&#x2F;config.yml 文件中 tags 前面的 #<br>2. hexo new page tags<br>3. blog&#x2F;sources&#x2F;about&#x2F;index.md：<code>type: tags</code><br><br/></p>
</li>
<li><p><strong>增加分类页</strong><br>1. 取消 categories 前面的 #<br>2. hexo new page “categories”<br>3. blog&#x2F;sources&#x2F;categories&#x2F;index.md：<code>type: categories</code><br><br/></p>
</li>
<li><p><strong>增加归档页</strong><br>1. 取消 categories 前面的 #<br>2. hexo new page “archive”<br>3. blog&#x2F;sources&#x2F;archive&#x2F;index.md：<code>type: archive</code></p>
</li>
</ol>
<h1 id="二、博客管理"><a href="#二、博客管理" class="headerlink" title="二、博客管理"></a>二、博客管理</h1><ol>
<li><strong>NexT主题配置文件</strong>   <div style="text-indent: 2em; margin-bottom: 25px">NexT主题由于频繁更新，为了避免升级报错可以另存为一份配置，然后操作这个配置文件即可。首先在 blog/source 目录下新建_data文件夹，然后去复制 blog/themes/next/_config.yml 到本地并改名为 next.yml，最后将 next.yml 放置在 _data 中即可，以后编辑next.yml即可配置主题。</div></li>
<li><strong>hexo博客源文件</strong>    <div style="text-indent: 2em; margin-bottom: 25px">hexo d 是把本地博客源文件生成的静态网页文件同步到github上而实现部署, 但是博客网站的本地源文件仍需要保存到个人电脑，为了方便在不同电脑上可以编辑管理，可以在github上另建分支，如 hexo分支 </div></li>
</ol>
<h1 id="三、博客个性化配置"><a href="#三、博客个性化配置" class="headerlink" title="三、博客个性化配置"></a>三、博客个性化配置</h1><ol>
<li><strong>Hexo配置</strong> (blog&#x2F;_config.yml)<br>* Site 站点配置(网站标题、作者、语言等)<br>* URL 网址配置(网址、根目录、链接格式等)<br>* Extensions 扩展配置(主题、插件等)<br>* 其他配置选项一般不需要修改</li>
<li><strong>主题配置</strong> (具体在博客优化部分)<br>* 安装主题：通过 git clone 下载到 blog&#x2F;themes<br>* 启动主题：修改 blog&#x2F;_config.yml 的theme选项<br>* 配置主题：修改 blog&#x2F;themes&#x2F;主题名&#x2F;_config.yml</li>
<li><strong>自定义域名配置</strong><br>* 购买域名<br>* 域名解析<br>* 添加CNAME</li>
</ol>
<h1 id="四、NexT主题优化"><a href="#四、NexT主题优化" class="headerlink" title="四、NexT主题优化"></a>四、NexT主题优化</h1><ol>
<li><strong>实用性优化</strong><br>* 添加RSS：hexo-generator-feed<br>* 添加标签、分类等页面<br>* 设置网站icon<br>* 添加侧边栏链接<br>* 增加版权信息<br>* 微信支付宝打赏功能<br>* 底部显示建站时间和图标的修改<br>* 外部链接优化：hexo-autonofollow<br>* 关闭网站动画：use_motion<br>* 设置第三方JS库：vendors<br>* 添加评论系统：leancloud<br>* 统计站点访客和阅读量：busuanzi<br>* 统计文章字数和阅读时间：symblos_count_time<br>* 添加文章分享功能：needmoreshare2<br>* 添加文章加密功能：hexo-blog-encrypt<br>* 添加图片的懒加载：hexo-lazyload-image<br>* 添加站内搜索功能：hexo-generator-searchdb<br>* 添加文章置顶功能：hexo-generator-index-pin-top<br>* 添加站点地图配置：hexo-generator-sitemap、hexo-generator-baidu-sitemap<br>* DaoVoice 在线联系</li>
<li><strong>博客个性化优化</strong><br>* 添加页面加载动画：pace<br>* 添加背景动画：canvas_nest<br>* 添加宠物：hexo-helper-live2d<br>* 添加顶部阅读进度：reading_progress<br>* 点击出现桃心效果：clicklove.js<br>* 添加代码块复制按钮：clickboard.js<br>* 文章末尾统一添加 “文本结束” 标记<br>* 修改文章底部标签样式<br>* 右上角的 Github 样式<br>* 修改作者头像并旋转<br>* 文章添加阴影效果</li>
</ol>
<h1 id="五、基于-Markdown-编写博文"><a href="#五、基于-Markdown-编写博文" class="headerlink" title="五、基于 Markdown 编写博文"></a>五、基于 Markdown 编写博文</h1><h2 id="创建文章"><a href="#创建文章" class="headerlink" title="创建文章"></a>创建文章</h2><ul>
<li>站点目录下执行命令 hexo new “title”</li>
<li>指定目录下直接创建 source&#x2F;_post&#x2F;title.md</li>
</ul>
<h2 id="初始化设置"><a href="#初始化设置" class="headerlink" title="初始化设置"></a>初始化设置</h2><div style="text-indent: 2em">使用命令创建文章时，Hexo 会根据文章的模板文件 /scaffolds/post.md 对新建文件进行初始化，可以根据需要自行修改。初始化后的文章头部除了可以设置文章标题、发布日期等基础信息外，还可以对文章添加标签、分类等，常用设置如下：</div> 

  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">my</span> <span class="string">blog</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019-02-04 20:45:30</span></span><br><span class="line"><span class="attr">tags:</span> [<span class="string">Hexo</span>, <span class="string">MarkDown</span>] </span><br><span class="line"><span class="attr">categories:</span> <span class="string">学习笔记</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Hexo</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">加密</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预览文章摘要</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">Markdown语法的格式和注意点</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 预览加密文章摘要</span></span><br><span class="line"><span class="attr">password:</span>        <span class="comment"># 文章密码</span></span><br><span class="line"><span class="attr">abstract:</span> <span class="string">enter</span> <span class="string">password</span> <span class="string">to</span> <span class="string">read</span>      <span class="comment"># 文章摘要</span></span><br><span class="line"><span class="attr">message:</span> <span class="string">My</span> <span class="string">Birthday</span>      <span class="comment"># 密码提示</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预览文章内容</span></span><br><span class="line"><span class="comment"># 在要显示的内容末尾添加more分隔符 &lt;!-- more --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>


<h2 id="编写文章（基于Markdown）"><a href="#编写文章（基于Markdown）" class="headerlink" title="编写文章（基于Markdown）"></a>编写文章（基于Markdown）</h2><h3 id="Markdown-简介"><a href="#Markdown-简介" class="headerlink" title="Markdown 简介"></a>Markdown 简介</h3> <div style="text-indent: 2em">Markdown是一种可以使用普通文本编辑器编写的轻量级标记语言，通过简单的标记语法使普通文本内容具有一定的格式，是一种适用于网络的书写语言，主要特点是易读易写、支持嵌入html标签和自动生成目录等。但是Hexo下使用的 Github风格的MarkDown（GFM）和 标准MarkDown（MD）在语法上稍有不同，以下主要介绍GFM语法。</div> 

<h3 id="MD-与-GFM-的区别"><a href="#MD-与-GFM-的区别" class="headerlink" title="MD 与 GFM 的区别"></a>MD 与 GFM 的区别</h3><ul>
<li>斜体：MD 使用 _ 或 *，GFM 只支持 *</li>
<li>自动链接：MD 使用 <URL>，GFM 可直接使用 URL</li>
<li>代码块：MD 使用 4个空格开头，GFM 还可以使用 ``` 格式</li>
<li>其他：GFM 可以指定语言高亮，而且增加了 删除线、表格、锚点等</li>
</ul>
<h3 id="常用语法"><a href="#常用语法" class="headerlink" title="常用语法"></a>常用语法</h3><ul>
<li>标题：根据 # 的数量显示几级标题（1～6）</li>
<li>引用：根据 &gt; 的数量显示几级引用文本</li>
<li>转义：使用 \ 显示文本中的一些字符</li>
<li>强调：使用 * 或 _ 显示 斜体、粗体、粗斜体（1～3），~~ 显示删除</li>
<li>链接：行内式 [名字](地址 “描述”)，参考式 [名字][网址变量]</li>
<li>列表：无序列表使用 -、+ 或 *，有序列表则使用数字加 .</li>
<li>代码：行内代码使用 `，代码块则使用 4个空格 或 ```</li>
<li>表格：- 和 | 分割行和列，: 控制对其方式</li>
<li>图片：链接方法前面加 !</li>
</ul>
  <figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">*斜体文本*  _斜体文本_  **粗体文本**  **粗体文本**  ***粗斜体文本***  **_粗斜体文本**_</span><br><span class="line">~~删除一段文本~~</span><br><span class="line"></span><br><span class="line">&gt; 动物</span><br><span class="line">&gt;&gt; 水生动物</span><br><span class="line"></span><br><span class="line">[my blog](https:<span class="regexp">//</span>chuanggefighting.github.io/)   </span><br><span class="line">[Google][<span class="number">1</span>] and [Baidu][<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>]: http:<span class="regexp">//g</span>oogle.com/   <span class="string">&quot;Google&quot;</span> </span><br><span class="line">[<span class="number">2</span>]: http:<span class="regexp">//</span>baidu.com/    <span class="string">&quot;Baidu&quot;</span></span><br><span class="line"></span><br><span class="line">Python</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">print <span class="string">&#x27;Hello World!</span></span><br></pre></td></tr></table></figure>
<p>  <em>斜体文本</em>  <em>斜体文本</em>  <strong>粗体文本</strong>  <strong>粗体文本</strong>  <em><strong>粗斜体文本</strong></em>  <strong>_粗斜体文本</strong>_<br>  <del>删除一段文本</del></p>
<blockquote>
<p>动物</p>
<blockquote>
<p>水生动物</p>
</blockquote>
</blockquote>
<p>  <a href="https://chuanggefighting.github.io/">my blog</a><br>  <a href="http://google.com/" title="Google">Google</a> &amp;#160;and&amp;#160; <a href="http://baidu.com/" title="Baidu">Baidu</a></p>
  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Hello World!</span></span><br></pre></td></tr></table></figure>


<h3 id="次常用语法"><a href="#次常用语法" class="headerlink" title="次常用语法"></a>次常用语法</h3><ul>
<li>分段：两个空格</li>
<li>分隔线：在一行中使用三个以上的 *、-、_</li>
<li>换行：两个空格 + 回车 （引用中换行省略回车）</li>
<li>首行缩进：使用转义字符代替空格，或者使用html标签</li>
<li>脚注：使用 [^name] 定义，用来解释专业词汇等</li>
</ul>
<h3 id="内嵌-Html-标签"><a href="#内嵌-Html-标签" class="headerlink" title="内嵌 Html 标签"></a>内嵌 Html 标签</h3>  <div style="text-indent: 2em">Markdown本身不支持修改字体、字号与颜色等功能，但是可以通过内嵌Html标签使普通文本内容具有一定的格式，常用如下：</div> 

<ul>
<li><font face="微软雅黑" color="red" size="3">字体及字体颜色和大小</font></li>
<li>换行<br/></li>
<li><u>下划线文本</u></li>
<li><span align="left">文本对齐</span></li>
<li><span style="text-indent: 2em">首行缩进</span></li>
</ul>
]]></content>
      <categories>
        <category>前端技术栈</category>
      </categories>
      <tags>
        <tag>前端技术栈</tag>
      </tags>
  </entry>
</search>
